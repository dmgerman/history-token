multiline_comment|/*&n; * INET&t;&t;An implementation of the TCP/IP protocol suite for the LINUX&n; *&t;&t;operating system.  INET is implemented using the  BSD Socket&n; *&t;&t;interface as the means of communication with the user level.&n; *&n; *&t;&t;Implementation of the Transmission Control Protocol(TCP).&n; *&n; * Version:&t;$Id: tcp_ipv4.c,v 1.240 2002/02/01 22:01:04 davem Exp $&n; *&n; *&t;&t;IPv4 specific functions&n; *&n; *&n; *&t;&t;code split from:&n; *&t;&t;linux/ipv4/tcp.c&n; *&t;&t;linux/ipv4/tcp_input.c&n; *&t;&t;linux/ipv4/tcp_output.c&n; *&n; *&t;&t;See tcp.c for author information&n; *&n; *&t;This program is free software; you can redistribute it and/or&n; *      modify it under the terms of the GNU General Public License&n; *      as published by the Free Software Foundation; either version&n; *      2 of the License, or (at your option) any later version.&n; */
multiline_comment|/*&n; * Changes:&n; *&t;&t;David S. Miller&t;:&t;New socket lookup architecture.&n; *&t;&t;&t;&t;&t;This code is dedicated to John Dyson.&n; *&t;&t;David S. Miller :&t;Change semantics of established hash,&n; *&t;&t;&t;&t;&t;half is devoted to TIME_WAIT sockets&n; *&t;&t;&t;&t;&t;and the rest go in the other half.&n; *&t;&t;Andi Kleen :&t;&t;Add support for syncookies and fixed&n; *&t;&t;&t;&t;&t;some bugs: ip options weren&squot;t passed to&n; *&t;&t;&t;&t;&t;the TCP layer, missed a check for an&n; *&t;&t;&t;&t;&t;ACK bit.&n; *&t;&t;Andi Kleen :&t;&t;Implemented fast path mtu discovery.&n; *&t;     &t;&t;&t;&t;Fixed many serious bugs in the&n; *&t;&t;&t;&t;&t;open_request handling and moved&n; *&t;&t;&t;&t;&t;most of it into the af independent code.&n; *&t;&t;&t;&t;&t;Added tail drop and some other bugfixes.&n; *&t;&t;&t;&t;&t;Added new listen sematics.&n; *&t;&t;Mike McLagan&t;:&t;Routing by source&n; *&t;Juan Jose Ciarlante:&t;&t;ip_dynaddr bits&n; *&t;&t;Andi Kleen:&t;&t;various fixes.&n; *&t;Vitaly E. Lavrov&t;:&t;Transparent proxy revived after year&n; *&t;&t;&t;&t;&t;coma.&n; *&t;Andi Kleen&t;&t;:&t;Fix new listen.&n; *&t;Andi Kleen&t;&t;:&t;Fix accept error reporting.&n; *&t;YOSHIFUJI Hideaki @USAGI and:&t;Support IPV6_V6ONLY socket option, which&n; *&t;Alexey Kuznetsov&t;&t;allow both IPv4 and IPv6 sockets to bind&n; *&t;&t;&t;&t;&t;a single port at the same time.&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/fcntl.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/random.h&gt;
macro_line|#include &lt;linux/cache.h&gt;
macro_line|#include &lt;linux/jhash.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/times.h&gt;
macro_line|#include &lt;net/icmp.h&gt;
macro_line|#include &lt;net/tcp.h&gt;
macro_line|#include &lt;net/ipv6.h&gt;
macro_line|#include &lt;net/inet_common.h&gt;
macro_line|#include &lt;net/xfrm.h&gt;
macro_line|#include &lt;linux/inet.h&gt;
macro_line|#include &lt;linux/ipv6.h&gt;
macro_line|#include &lt;linux/stddef.h&gt;
macro_line|#include &lt;linux/proc_fs.h&gt;
macro_line|#include &lt;linux/seq_file.h&gt;
r_extern
r_int
id|sysctl_ip_dynaddr
suffix:semicolon
DECL|variable|sysctl_tcp_tw_reuse
r_int
id|sysctl_tcp_tw_reuse
suffix:semicolon
DECL|variable|sysctl_tcp_low_latency
r_int
id|sysctl_tcp_low_latency
suffix:semicolon
multiline_comment|/* Check TCP sequence numbers in ICMP packets. */
DECL|macro|ICMP_MIN_LENGTH
mdefine_line|#define ICMP_MIN_LENGTH 8
multiline_comment|/* Socket used for sending RSTs */
DECL|variable|tcp_socket
r_static
r_struct
id|socket
op_star
id|tcp_socket
suffix:semicolon
r_void
id|tcp_v4_send_check
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_struct
id|tcphdr
op_star
id|th
comma
r_int
id|len
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
suffix:semicolon
DECL|variable|tcp_hashinfo
r_struct
id|tcp_hashinfo
id|__cacheline_aligned
id|tcp_hashinfo
op_assign
(brace
dot
id|__tcp_lhash_lock
op_assign
id|RW_LOCK_UNLOCKED
comma
dot
id|__tcp_lhash_users
op_assign
id|ATOMIC_INIT
c_func
(paren
l_int|0
)paren
comma
dot
id|__tcp_lhash_wait
op_assign
id|__WAIT_QUEUE_HEAD_INITIALIZER
c_func
(paren
id|tcp_hashinfo.__tcp_lhash_wait
)paren
comma
dot
id|__tcp_portalloc_lock
op_assign
id|SPIN_LOCK_UNLOCKED
)brace
suffix:semicolon
multiline_comment|/*&n; * This array holds the first and last local port number.&n; * For high-usage systems, use sysctl to change this to&n; * 32768-61000&n; */
DECL|variable|sysctl_local_port_range
r_int
id|sysctl_local_port_range
(braket
l_int|2
)braket
op_assign
(brace
l_int|1024
comma
l_int|4999
)brace
suffix:semicolon
DECL|variable|tcp_port_rover
r_int
id|tcp_port_rover
op_assign
l_int|1024
op_minus
l_int|1
suffix:semicolon
DECL|function|tcp_hashfn
r_static
id|__inline__
r_int
id|tcp_hashfn
c_func
(paren
id|__u32
id|laddr
comma
id|__u16
id|lport
comma
id|__u32
id|faddr
comma
id|__u16
id|fport
)paren
(brace
r_int
id|h
op_assign
(paren
id|laddr
op_xor
id|lport
)paren
op_xor
(paren
id|faddr
op_xor
id|fport
)paren
suffix:semicolon
id|h
op_xor_assign
id|h
op_rshift
l_int|16
suffix:semicolon
id|h
op_xor_assign
id|h
op_rshift
l_int|8
suffix:semicolon
r_return
id|h
op_amp
(paren
id|tcp_ehash_size
op_minus
l_int|1
)paren
suffix:semicolon
)brace
DECL|function|tcp_sk_hashfn
r_static
id|__inline__
r_int
id|tcp_sk_hashfn
c_func
(paren
r_struct
id|sock
op_star
id|sk
)paren
(brace
r_struct
id|inet_sock
op_star
id|inet
op_assign
id|inet_sk
c_func
(paren
id|sk
)paren
suffix:semicolon
id|__u32
id|laddr
op_assign
id|inet-&gt;rcv_saddr
suffix:semicolon
id|__u16
id|lport
op_assign
id|inet-&gt;num
suffix:semicolon
id|__u32
id|faddr
op_assign
id|inet-&gt;daddr
suffix:semicolon
id|__u16
id|fport
op_assign
id|inet-&gt;dport
suffix:semicolon
r_return
id|tcp_hashfn
c_func
(paren
id|laddr
comma
id|lport
comma
id|faddr
comma
id|fport
)paren
suffix:semicolon
)brace
multiline_comment|/* Allocate and initialize a new TCP local port bind bucket.&n; * The bindhash mutex for snum&squot;s hash chain must be held here.&n; */
DECL|function|tcp_bucket_create
r_struct
id|tcp_bind_bucket
op_star
id|tcp_bucket_create
c_func
(paren
r_struct
id|tcp_bind_hashbucket
op_star
id|head
comma
r_int
r_int
id|snum
)paren
(brace
r_struct
id|tcp_bind_bucket
op_star
id|tb
op_assign
id|kmem_cache_alloc
c_func
(paren
id|tcp_bucket_cachep
comma
id|SLAB_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tb
)paren
(brace
id|tb-&gt;port
op_assign
id|snum
suffix:semicolon
id|tb-&gt;fastreuse
op_assign
l_int|0
suffix:semicolon
id|INIT_HLIST_HEAD
c_func
(paren
op_amp
id|tb-&gt;owners
)paren
suffix:semicolon
id|hlist_add_head
c_func
(paren
op_amp
id|tb-&gt;node
comma
op_amp
id|head-&gt;chain
)paren
suffix:semicolon
)brace
r_return
id|tb
suffix:semicolon
)brace
multiline_comment|/* Caller must hold hashbucket lock for this tb with local BH disabled */
DECL|function|tcp_bucket_destroy
r_void
id|tcp_bucket_destroy
c_func
(paren
r_struct
id|tcp_bind_bucket
op_star
id|tb
)paren
(brace
r_if
c_cond
(paren
id|hlist_empty
c_func
(paren
op_amp
id|tb-&gt;owners
)paren
)paren
(brace
id|__hlist_del
c_func
(paren
op_amp
id|tb-&gt;node
)paren
suffix:semicolon
id|kmem_cache_free
c_func
(paren
id|tcp_bucket_cachep
comma
id|tb
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* Caller must disable local BH processing. */
DECL|function|__tcp_inherit_port
r_static
id|__inline__
r_void
id|__tcp_inherit_port
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_struct
id|sock
op_star
id|child
)paren
(brace
r_struct
id|tcp_bind_hashbucket
op_star
id|head
op_assign
op_amp
id|tcp_bhash
(braket
id|tcp_bhashfn
c_func
(paren
id|inet_sk
c_func
(paren
id|child
)paren
op_member_access_from_pointer
id|num
)paren
)braket
suffix:semicolon
r_struct
id|tcp_bind_bucket
op_star
id|tb
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|head-&gt;lock
)paren
suffix:semicolon
id|tb
op_assign
id|tcp_sk
c_func
(paren
id|sk
)paren
op_member_access_from_pointer
id|bind_hash
suffix:semicolon
id|sk_add_bind_node
c_func
(paren
id|child
comma
op_amp
id|tb-&gt;owners
)paren
suffix:semicolon
id|tcp_sk
c_func
(paren
id|child
)paren
op_member_access_from_pointer
id|bind_hash
op_assign
id|tb
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|head-&gt;lock
)paren
suffix:semicolon
)brace
DECL|function|tcp_inherit_port
r_inline
r_void
id|tcp_inherit_port
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_struct
id|sock
op_star
id|child
)paren
(brace
id|local_bh_disable
c_func
(paren
)paren
suffix:semicolon
id|__tcp_inherit_port
c_func
(paren
id|sk
comma
id|child
)paren
suffix:semicolon
id|local_bh_enable
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|tcp_bind_hash
r_void
id|tcp_bind_hash
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_struct
id|tcp_bind_bucket
op_star
id|tb
comma
r_int
r_int
id|snum
)paren
(brace
id|inet_sk
c_func
(paren
id|sk
)paren
op_member_access_from_pointer
id|num
op_assign
id|snum
suffix:semicolon
id|sk_add_bind_node
c_func
(paren
id|sk
comma
op_amp
id|tb-&gt;owners
)paren
suffix:semicolon
id|tcp_sk
c_func
(paren
id|sk
)paren
op_member_access_from_pointer
id|bind_hash
op_assign
id|tb
suffix:semicolon
)brace
DECL|function|tcp_bind_conflict
r_static
r_inline
r_int
id|tcp_bind_conflict
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_struct
id|tcp_bind_bucket
op_star
id|tb
)paren
(brace
r_const
id|u32
id|sk_rcv_saddr
op_assign
id|tcp_v4_rcv_saddr
c_func
(paren
id|sk
)paren
suffix:semicolon
r_struct
id|sock
op_star
id|sk2
suffix:semicolon
r_struct
id|hlist_node
op_star
id|node
suffix:semicolon
r_int
id|reuse
op_assign
id|sk-&gt;sk_reuse
suffix:semicolon
id|sk_for_each_bound
c_func
(paren
id|sk2
comma
id|node
comma
op_amp
id|tb-&gt;owners
)paren
(brace
r_if
c_cond
(paren
id|sk
op_ne
id|sk2
op_logical_and
op_logical_neg
id|tcp_v6_ipv6only
c_func
(paren
id|sk2
)paren
op_logical_and
(paren
op_logical_neg
id|sk-&gt;sk_bound_dev_if
op_logical_or
op_logical_neg
id|sk2-&gt;sk_bound_dev_if
op_logical_or
id|sk-&gt;sk_bound_dev_if
op_eq
id|sk2-&gt;sk_bound_dev_if
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|reuse
op_logical_or
op_logical_neg
id|sk2-&gt;sk_reuse
op_logical_or
id|sk2-&gt;sk_state
op_eq
id|TCP_LISTEN
)paren
(brace
r_const
id|u32
id|sk2_rcv_saddr
op_assign
id|tcp_v4_rcv_saddr
c_func
(paren
id|sk2
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sk2_rcv_saddr
op_logical_or
op_logical_neg
id|sk_rcv_saddr
op_logical_or
id|sk2_rcv_saddr
op_eq
id|sk_rcv_saddr
)paren
r_break
suffix:semicolon
)brace
)brace
)brace
r_return
id|node
op_ne
l_int|NULL
suffix:semicolon
)brace
multiline_comment|/* Obtain a reference to a local port for the given sock,&n; * if snum is zero it means select any available local port.&n; */
DECL|function|tcp_v4_get_port
r_static
r_int
id|tcp_v4_get_port
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_int
r_int
id|snum
)paren
(brace
r_struct
id|tcp_bind_hashbucket
op_star
id|head
suffix:semicolon
r_struct
id|hlist_node
op_star
id|node
suffix:semicolon
r_struct
id|tcp_bind_bucket
op_star
id|tb
suffix:semicolon
r_int
id|ret
suffix:semicolon
id|local_bh_disable
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|snum
)paren
(brace
r_int
id|low
op_assign
id|sysctl_local_port_range
(braket
l_int|0
)braket
suffix:semicolon
r_int
id|high
op_assign
id|sysctl_local_port_range
(braket
l_int|1
)braket
suffix:semicolon
r_int
id|remaining
op_assign
(paren
id|high
op_minus
id|low
)paren
op_plus
l_int|1
suffix:semicolon
r_int
id|rover
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|tcp_portalloc_lock
)paren
suffix:semicolon
id|rover
op_assign
id|tcp_port_rover
suffix:semicolon
r_do
(brace
id|rover
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|rover
template_param
id|high
)paren
id|rover
op_assign
id|low
suffix:semicolon
id|head
op_assign
op_amp
id|tcp_bhash
(braket
id|tcp_bhashfn
c_func
(paren
id|rover
)paren
)braket
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|head-&gt;lock
)paren
suffix:semicolon
id|tb_for_each
c_func
(paren
id|tb
comma
id|node
comma
op_amp
id|head-&gt;chain
)paren
r_if
c_cond
(paren
id|tb-&gt;port
op_eq
id|rover
)paren
r_goto
id|next
suffix:semicolon
r_break
suffix:semicolon
id|next
suffix:colon
id|spin_unlock
c_func
(paren
op_amp
id|head-&gt;lock
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
op_decrement
id|remaining
OG
l_int|0
)paren
suffix:semicolon
id|tcp_port_rover
op_assign
id|rover
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|tcp_portalloc_lock
)paren
suffix:semicolon
multiline_comment|/* Exhausted local port range during search? */
id|ret
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|remaining
op_le
l_int|0
)paren
r_goto
id|fail
suffix:semicolon
multiline_comment|/* OK, here is the one we will use.  HEAD is&n;&t;&t; * non-NULL and we hold it&squot;s mutex.&n;&t;&t; */
id|snum
op_assign
id|rover
suffix:semicolon
)brace
r_else
(brace
id|head
op_assign
op_amp
id|tcp_bhash
(braket
id|tcp_bhashfn
c_func
(paren
id|snum
)paren
)braket
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|head-&gt;lock
)paren
suffix:semicolon
id|tb_for_each
c_func
(paren
id|tb
comma
id|node
comma
op_amp
id|head-&gt;chain
)paren
r_if
c_cond
(paren
id|tb-&gt;port
op_eq
id|snum
)paren
r_goto
id|tb_found
suffix:semicolon
)brace
id|tb
op_assign
l_int|NULL
suffix:semicolon
r_goto
id|tb_not_found
suffix:semicolon
id|tb_found
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|hlist_empty
c_func
(paren
op_amp
id|tb-&gt;owners
)paren
)paren
(brace
r_if
c_cond
(paren
id|sk-&gt;sk_reuse
OG
l_int|1
)paren
r_goto
id|success
suffix:semicolon
r_if
c_cond
(paren
id|tb-&gt;fastreuse
OG
l_int|0
op_logical_and
id|sk-&gt;sk_reuse
op_logical_and
id|sk-&gt;sk_state
op_ne
id|TCP_LISTEN
)paren
(brace
r_goto
id|success
suffix:semicolon
)brace
r_else
(brace
id|ret
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|tcp_bind_conflict
c_func
(paren
id|sk
comma
id|tb
)paren
)paren
r_goto
id|fail_unlock
suffix:semicolon
)brace
)brace
id|tb_not_found
suffix:colon
id|ret
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|tb
op_logical_and
(paren
id|tb
op_assign
id|tcp_bucket_create
c_func
(paren
id|head
comma
id|snum
)paren
)paren
op_eq
l_int|NULL
)paren
r_goto
id|fail_unlock
suffix:semicolon
r_if
c_cond
(paren
id|hlist_empty
c_func
(paren
op_amp
id|tb-&gt;owners
)paren
)paren
(brace
r_if
c_cond
(paren
id|sk-&gt;sk_reuse
op_logical_and
id|sk-&gt;sk_state
op_ne
id|TCP_LISTEN
)paren
id|tb-&gt;fastreuse
op_assign
l_int|1
suffix:semicolon
r_else
id|tb-&gt;fastreuse
op_assign
l_int|0
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|tb-&gt;fastreuse
op_logical_and
(paren
op_logical_neg
id|sk-&gt;sk_reuse
op_logical_or
id|sk-&gt;sk_state
op_eq
id|TCP_LISTEN
)paren
)paren
id|tb-&gt;fastreuse
op_assign
l_int|0
suffix:semicolon
id|success
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|tcp_sk
c_func
(paren
id|sk
)paren
op_member_access_from_pointer
id|bind_hash
)paren
id|tcp_bind_hash
c_func
(paren
id|sk
comma
id|tb
comma
id|snum
)paren
suffix:semicolon
id|BUG_TRAP
c_func
(paren
id|tcp_sk
c_func
(paren
id|sk
)paren
op_member_access_from_pointer
id|bind_hash
op_eq
id|tb
)paren
suffix:semicolon
id|ret
op_assign
l_int|0
suffix:semicolon
id|fail_unlock
suffix:colon
id|spin_unlock
c_func
(paren
op_amp
id|head-&gt;lock
)paren
suffix:semicolon
id|fail
suffix:colon
id|local_bh_enable
c_func
(paren
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
multiline_comment|/* Get rid of any references to a local port held by the&n; * given sock.&n; */
DECL|function|__tcp_put_port
r_static
r_void
id|__tcp_put_port
c_func
(paren
r_struct
id|sock
op_star
id|sk
)paren
(brace
r_struct
id|inet_sock
op_star
id|inet
op_assign
id|inet_sk
c_func
(paren
id|sk
)paren
suffix:semicolon
r_struct
id|tcp_bind_hashbucket
op_star
id|head
op_assign
op_amp
id|tcp_bhash
(braket
id|tcp_bhashfn
c_func
(paren
id|inet-&gt;num
)paren
)braket
suffix:semicolon
r_struct
id|tcp_bind_bucket
op_star
id|tb
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|head-&gt;lock
)paren
suffix:semicolon
id|tb
op_assign
id|tcp_sk
c_func
(paren
id|sk
)paren
op_member_access_from_pointer
id|bind_hash
suffix:semicolon
id|__sk_del_bind_node
c_func
(paren
id|sk
)paren
suffix:semicolon
id|tcp_sk
c_func
(paren
id|sk
)paren
op_member_access_from_pointer
id|bind_hash
op_assign
l_int|NULL
suffix:semicolon
id|inet-&gt;num
op_assign
l_int|0
suffix:semicolon
id|tcp_bucket_destroy
c_func
(paren
id|tb
)paren
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|head-&gt;lock
)paren
suffix:semicolon
)brace
DECL|function|tcp_put_port
r_void
id|tcp_put_port
c_func
(paren
r_struct
id|sock
op_star
id|sk
)paren
(brace
id|local_bh_disable
c_func
(paren
)paren
suffix:semicolon
id|__tcp_put_port
c_func
(paren
id|sk
)paren
suffix:semicolon
id|local_bh_enable
c_func
(paren
)paren
suffix:semicolon
)brace
multiline_comment|/* This lock without WQ_FLAG_EXCLUSIVE is good on UP and it can be very bad on SMP.&n; * Look, when several writers sleep and reader wakes them up, all but one&n; * immediately hit write lock and grab all the cpus. Exclusive sleep solves&n; * this, _but_ remember, it adds useless work on UP machines (wake up each&n; * exclusive lock release). It should be ifdefed really.&n; */
DECL|function|tcp_listen_wlock
r_void
id|tcp_listen_wlock
c_func
(paren
r_void
)paren
(brace
id|write_lock
c_func
(paren
op_amp
id|tcp_lhash_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|atomic_read
c_func
(paren
op_amp
id|tcp_lhash_users
)paren
)paren
(brace
id|DEFINE_WAIT
c_func
(paren
id|wait
)paren
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
(brace
id|prepare_to_wait_exclusive
c_func
(paren
op_amp
id|tcp_lhash_wait
comma
op_amp
id|wait
comma
id|TASK_UNINTERRUPTIBLE
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|atomic_read
c_func
(paren
op_amp
id|tcp_lhash_users
)paren
)paren
r_break
suffix:semicolon
id|write_unlock_bh
c_func
(paren
op_amp
id|tcp_lhash_lock
)paren
suffix:semicolon
id|schedule
c_func
(paren
)paren
suffix:semicolon
id|write_lock_bh
c_func
(paren
op_amp
id|tcp_lhash_lock
)paren
suffix:semicolon
)brace
id|finish_wait
c_func
(paren
op_amp
id|tcp_lhash_wait
comma
op_amp
id|wait
)paren
suffix:semicolon
)brace
)brace
DECL|function|__tcp_v4_hash
r_static
id|__inline__
r_void
id|__tcp_v4_hash
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_const
r_int
id|listen_possible
)paren
(brace
r_struct
id|hlist_head
op_star
id|list
suffix:semicolon
id|rwlock_t
op_star
id|lock
suffix:semicolon
id|BUG_TRAP
c_func
(paren
id|sk_unhashed
c_func
(paren
id|sk
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|listen_possible
op_logical_and
id|sk-&gt;sk_state
op_eq
id|TCP_LISTEN
)paren
(brace
id|list
op_assign
op_amp
id|tcp_listening_hash
(braket
id|tcp_sk_listen_hashfn
c_func
(paren
id|sk
)paren
)braket
suffix:semicolon
id|lock
op_assign
op_amp
id|tcp_lhash_lock
suffix:semicolon
id|tcp_listen_wlock
c_func
(paren
)paren
suffix:semicolon
)brace
r_else
(brace
id|list
op_assign
op_amp
id|tcp_ehash
(braket
(paren
id|sk-&gt;sk_hashent
op_assign
id|tcp_sk_hashfn
c_func
(paren
id|sk
)paren
)paren
)braket
dot
id|chain
suffix:semicolon
id|lock
op_assign
op_amp
id|tcp_ehash
(braket
id|sk-&gt;sk_hashent
)braket
dot
id|lock
suffix:semicolon
id|write_lock
c_func
(paren
id|lock
)paren
suffix:semicolon
)brace
id|__sk_add_node
c_func
(paren
id|sk
comma
id|list
)paren
suffix:semicolon
id|sock_prot_inc_use
c_func
(paren
id|sk-&gt;sk_prot
)paren
suffix:semicolon
id|write_unlock
c_func
(paren
id|lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|listen_possible
op_logical_and
id|sk-&gt;sk_state
op_eq
id|TCP_LISTEN
)paren
id|wake_up
c_func
(paren
op_amp
id|tcp_lhash_wait
)paren
suffix:semicolon
)brace
DECL|function|tcp_v4_hash
r_static
r_void
id|tcp_v4_hash
c_func
(paren
r_struct
id|sock
op_star
id|sk
)paren
(brace
r_if
c_cond
(paren
id|sk-&gt;sk_state
op_ne
id|TCP_CLOSE
)paren
(brace
id|local_bh_disable
c_func
(paren
)paren
suffix:semicolon
id|__tcp_v4_hash
c_func
(paren
id|sk
comma
l_int|1
)paren
suffix:semicolon
id|local_bh_enable
c_func
(paren
)paren
suffix:semicolon
)brace
)brace
DECL|function|tcp_unhash
r_void
id|tcp_unhash
c_func
(paren
r_struct
id|sock
op_star
id|sk
)paren
(brace
id|rwlock_t
op_star
id|lock
suffix:semicolon
r_if
c_cond
(paren
id|sk_unhashed
c_func
(paren
id|sk
)paren
)paren
r_goto
id|ende
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;sk_state
op_eq
id|TCP_LISTEN
)paren
(brace
id|local_bh_disable
c_func
(paren
)paren
suffix:semicolon
id|tcp_listen_wlock
c_func
(paren
)paren
suffix:semicolon
id|lock
op_assign
op_amp
id|tcp_lhash_lock
suffix:semicolon
)brace
r_else
(brace
r_struct
id|tcp_ehash_bucket
op_star
id|head
op_assign
op_amp
id|tcp_ehash
(braket
id|sk-&gt;sk_hashent
)braket
suffix:semicolon
id|lock
op_assign
op_amp
id|head-&gt;lock
suffix:semicolon
id|write_lock_bh
c_func
(paren
op_amp
id|head-&gt;lock
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|__sk_del_node_init
c_func
(paren
id|sk
)paren
)paren
id|sock_prot_dec_use
c_func
(paren
id|sk-&gt;sk_prot
)paren
suffix:semicolon
id|write_unlock_bh
c_func
(paren
id|lock
)paren
suffix:semicolon
id|ende
suffix:colon
r_if
c_cond
(paren
id|sk-&gt;sk_state
op_eq
id|TCP_LISTEN
)paren
id|wake_up
c_func
(paren
op_amp
id|tcp_lhash_wait
)paren
suffix:semicolon
)brace
multiline_comment|/* Don&squot;t inline this cruft.  Here are some nice properties to&n; * exploit here.  The BSD API does not allow a listening TCP&n; * to specify the remote port nor the remote address for the&n; * connection.  So always assume those are both wildcarded&n; * during the search since they can never be otherwise.&n; */
DECL|function|__tcp_v4_lookup_listener
r_static
r_struct
id|sock
op_star
id|__tcp_v4_lookup_listener
c_func
(paren
r_struct
id|hlist_head
op_star
id|head
comma
id|u32
id|daddr
comma
r_int
r_int
id|hnum
comma
r_int
id|dif
)paren
(brace
r_struct
id|sock
op_star
id|result
op_assign
l_int|NULL
comma
op_star
id|sk
suffix:semicolon
r_struct
id|hlist_node
op_star
id|node
suffix:semicolon
r_int
id|score
comma
id|hiscore
suffix:semicolon
id|hiscore
op_assign
op_minus
l_int|1
suffix:semicolon
id|sk_for_each
c_func
(paren
id|sk
comma
id|node
comma
id|head
)paren
(brace
r_struct
id|inet_sock
op_star
id|inet
op_assign
id|inet_sk
c_func
(paren
id|sk
)paren
suffix:semicolon
r_if
c_cond
(paren
id|inet-&gt;num
op_eq
id|hnum
op_logical_and
op_logical_neg
id|ipv6_only_sock
c_func
(paren
id|sk
)paren
)paren
(brace
id|__u32
id|rcv_saddr
op_assign
id|inet-&gt;rcv_saddr
suffix:semicolon
id|score
op_assign
(paren
id|sk-&gt;sk_family
op_eq
id|PF_INET
ques
c_cond
l_int|1
suffix:colon
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rcv_saddr
)paren
(brace
r_if
c_cond
(paren
id|rcv_saddr
op_ne
id|daddr
)paren
r_continue
suffix:semicolon
id|score
op_add_assign
l_int|2
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sk-&gt;sk_bound_dev_if
)paren
(brace
r_if
c_cond
(paren
id|sk-&gt;sk_bound_dev_if
op_ne
id|dif
)paren
r_continue
suffix:semicolon
id|score
op_add_assign
l_int|2
suffix:semicolon
)brace
r_if
c_cond
(paren
id|score
op_eq
l_int|5
)paren
r_return
id|sk
suffix:semicolon
r_if
c_cond
(paren
id|score
OG
id|hiscore
)paren
(brace
id|hiscore
op_assign
id|score
suffix:semicolon
id|result
op_assign
id|sk
suffix:semicolon
)brace
)brace
)brace
r_return
id|result
suffix:semicolon
)brace
multiline_comment|/* Optimize the common listener case. */
DECL|function|tcp_v4_lookup_listener
r_static
r_inline
r_struct
id|sock
op_star
id|tcp_v4_lookup_listener
c_func
(paren
id|u32
id|daddr
comma
r_int
r_int
id|hnum
comma
r_int
id|dif
)paren
(brace
r_struct
id|sock
op_star
id|sk
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|hlist_head
op_star
id|head
suffix:semicolon
id|read_lock
c_func
(paren
op_amp
id|tcp_lhash_lock
)paren
suffix:semicolon
id|head
op_assign
op_amp
id|tcp_listening_hash
(braket
id|tcp_lhashfn
c_func
(paren
id|hnum
)paren
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|hlist_empty
c_func
(paren
id|head
)paren
)paren
(brace
r_struct
id|inet_sock
op_star
id|inet
op_assign
id|inet_sk
c_func
(paren
(paren
id|sk
op_assign
id|__sk_head
c_func
(paren
id|head
)paren
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|inet-&gt;num
op_eq
id|hnum
op_logical_and
op_logical_neg
id|sk-&gt;sk_node.next
op_logical_and
(paren
op_logical_neg
id|inet-&gt;rcv_saddr
op_logical_or
id|inet-&gt;rcv_saddr
op_eq
id|daddr
)paren
op_logical_and
(paren
id|sk-&gt;sk_family
op_eq
id|PF_INET
op_logical_or
op_logical_neg
id|ipv6_only_sock
c_func
(paren
id|sk
)paren
)paren
op_logical_and
op_logical_neg
id|sk-&gt;sk_bound_dev_if
)paren
r_goto
id|sherry_cache
suffix:semicolon
id|sk
op_assign
id|__tcp_v4_lookup_listener
c_func
(paren
id|head
comma
id|daddr
comma
id|hnum
comma
id|dif
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sk
)paren
(brace
id|sherry_cache
suffix:colon
id|sock_hold
c_func
(paren
id|sk
)paren
suffix:semicolon
)brace
id|read_unlock
c_func
(paren
op_amp
id|tcp_lhash_lock
)paren
suffix:semicolon
r_return
id|sk
suffix:semicolon
)brace
multiline_comment|/* Sockets in TCP_CLOSE state are _always_ taken out of the hash, so&n; * we need not check it for TCP lookups anymore, thanks Alexey. -DaveM&n; *&n; * Local BH must be disabled here.&n; */
DECL|function|__tcp_v4_lookup_established
r_static
r_inline
r_struct
id|sock
op_star
id|__tcp_v4_lookup_established
c_func
(paren
id|u32
id|saddr
comma
id|u16
id|sport
comma
id|u32
id|daddr
comma
id|u16
id|hnum
comma
r_int
id|dif
)paren
(brace
r_struct
id|tcp_ehash_bucket
op_star
id|head
suffix:semicolon
id|TCP_V4_ADDR_COOKIE
c_func
(paren
id|acookie
comma
id|saddr
comma
id|daddr
)paren
id|__u32
id|ports
op_assign
id|TCP_COMBINED_PORTS
c_func
(paren
id|sport
comma
id|hnum
)paren
suffix:semicolon
r_struct
id|sock
op_star
id|sk
suffix:semicolon
r_struct
id|hlist_node
op_star
id|node
suffix:semicolon
multiline_comment|/* Optimize here for direct hit, only listening connections can&n;&t; * have wildcards anyways.&n;&t; */
r_int
id|hash
op_assign
id|tcp_hashfn
c_func
(paren
id|daddr
comma
id|hnum
comma
id|saddr
comma
id|sport
)paren
suffix:semicolon
id|head
op_assign
op_amp
id|tcp_ehash
(braket
id|hash
)braket
suffix:semicolon
id|read_lock
c_func
(paren
op_amp
id|head-&gt;lock
)paren
suffix:semicolon
id|sk_for_each
c_func
(paren
id|sk
comma
id|node
comma
op_amp
id|head-&gt;chain
)paren
(brace
r_if
c_cond
(paren
id|TCP_IPV4_MATCH
c_func
(paren
id|sk
comma
id|acookie
comma
id|saddr
comma
id|daddr
comma
id|ports
comma
id|dif
)paren
)paren
r_goto
id|hit
suffix:semicolon
multiline_comment|/* You sunk my battleship! */
)brace
multiline_comment|/* Must check for a TIME_WAIT&squot;er before going to listener hash. */
id|sk_for_each
c_func
(paren
id|sk
comma
id|node
comma
op_amp
(paren
id|head
op_plus
id|tcp_ehash_size
)paren
op_member_access_from_pointer
id|chain
)paren
(brace
r_if
c_cond
(paren
id|TCP_IPV4_TW_MATCH
c_func
(paren
id|sk
comma
id|acookie
comma
id|saddr
comma
id|daddr
comma
id|ports
comma
id|dif
)paren
)paren
r_goto
id|hit
suffix:semicolon
)brace
id|sk
op_assign
l_int|NULL
suffix:semicolon
id|out
suffix:colon
id|read_unlock
c_func
(paren
op_amp
id|head-&gt;lock
)paren
suffix:semicolon
r_return
id|sk
suffix:semicolon
id|hit
suffix:colon
id|sock_hold
c_func
(paren
id|sk
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
DECL|function|__tcp_v4_lookup
r_static
r_inline
r_struct
id|sock
op_star
id|__tcp_v4_lookup
c_func
(paren
id|u32
id|saddr
comma
id|u16
id|sport
comma
id|u32
id|daddr
comma
id|u16
id|hnum
comma
r_int
id|dif
)paren
(brace
r_struct
id|sock
op_star
id|sk
op_assign
id|__tcp_v4_lookup_established
c_func
(paren
id|saddr
comma
id|sport
comma
id|daddr
comma
id|hnum
comma
id|dif
)paren
suffix:semicolon
r_return
id|sk
ques
c_cond
suffix:colon
id|tcp_v4_lookup_listener
c_func
(paren
id|daddr
comma
id|hnum
comma
id|dif
)paren
suffix:semicolon
)brace
DECL|function|tcp_v4_lookup
r_inline
r_struct
id|sock
op_star
id|tcp_v4_lookup
c_func
(paren
id|u32
id|saddr
comma
id|u16
id|sport
comma
id|u32
id|daddr
comma
id|u16
id|dport
comma
r_int
id|dif
)paren
(brace
r_struct
id|sock
op_star
id|sk
suffix:semicolon
id|local_bh_disable
c_func
(paren
)paren
suffix:semicolon
id|sk
op_assign
id|__tcp_v4_lookup
c_func
(paren
id|saddr
comma
id|sport
comma
id|daddr
comma
id|ntohs
c_func
(paren
id|dport
)paren
comma
id|dif
)paren
suffix:semicolon
id|local_bh_enable
c_func
(paren
)paren
suffix:semicolon
r_return
id|sk
suffix:semicolon
)brace
DECL|variable|tcp_v4_lookup
id|EXPORT_SYMBOL_GPL
c_func
(paren
id|tcp_v4_lookup
)paren
suffix:semicolon
DECL|function|tcp_v4_init_sequence
r_static
r_inline
id|__u32
id|tcp_v4_init_sequence
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_return
id|secure_tcp_sequence_number
c_func
(paren
id|skb-&gt;nh.iph-&gt;daddr
comma
id|skb-&gt;nh.iph-&gt;saddr
comma
id|skb-&gt;h.th-&gt;dest
comma
id|skb-&gt;h.th-&gt;source
)paren
suffix:semicolon
)brace
multiline_comment|/* called with local bh disabled */
DECL|function|__tcp_v4_check_established
r_static
r_int
id|__tcp_v4_check_established
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
id|__u16
id|lport
comma
r_struct
id|tcp_tw_bucket
op_star
op_star
id|twp
)paren
(brace
r_struct
id|inet_sock
op_star
id|inet
op_assign
id|inet_sk
c_func
(paren
id|sk
)paren
suffix:semicolon
id|u32
id|daddr
op_assign
id|inet-&gt;rcv_saddr
suffix:semicolon
id|u32
id|saddr
op_assign
id|inet-&gt;daddr
suffix:semicolon
r_int
id|dif
op_assign
id|sk-&gt;sk_bound_dev_if
suffix:semicolon
id|TCP_V4_ADDR_COOKIE
c_func
(paren
id|acookie
comma
id|saddr
comma
id|daddr
)paren
id|__u32
id|ports
op_assign
id|TCP_COMBINED_PORTS
c_func
(paren
id|inet-&gt;dport
comma
id|lport
)paren
suffix:semicolon
r_int
id|hash
op_assign
id|tcp_hashfn
c_func
(paren
id|daddr
comma
id|lport
comma
id|saddr
comma
id|inet-&gt;dport
)paren
suffix:semicolon
r_struct
id|tcp_ehash_bucket
op_star
id|head
op_assign
op_amp
id|tcp_ehash
(braket
id|hash
)braket
suffix:semicolon
r_struct
id|sock
op_star
id|sk2
suffix:semicolon
r_struct
id|hlist_node
op_star
id|node
suffix:semicolon
r_struct
id|tcp_tw_bucket
op_star
id|tw
suffix:semicolon
id|write_lock
c_func
(paren
op_amp
id|head-&gt;lock
)paren
suffix:semicolon
multiline_comment|/* Check TIME-WAIT sockets first. */
id|sk_for_each
c_func
(paren
id|sk2
comma
id|node
comma
op_amp
(paren
id|head
op_plus
id|tcp_ehash_size
)paren
op_member_access_from_pointer
id|chain
)paren
(brace
id|tw
op_assign
(paren
r_struct
id|tcp_tw_bucket
op_star
)paren
id|sk2
suffix:semicolon
r_if
c_cond
(paren
id|TCP_IPV4_TW_MATCH
c_func
(paren
id|sk2
comma
id|acookie
comma
id|saddr
comma
id|daddr
comma
id|ports
comma
id|dif
)paren
)paren
(brace
r_struct
id|tcp_opt
op_star
id|tp
op_assign
id|tcp_sk
c_func
(paren
id|sk
)paren
suffix:semicolon
multiline_comment|/* With PAWS, it is safe from the viewpoint&n;&t;&t;&t;   of data integrity. Even without PAWS it&n;&t;&t;&t;   is safe provided sequence spaces do not&n;&t;&t;&t;   overlap i.e. at data rates &lt;= 80Mbit/sec.&n;&n;&t;&t;&t;   Actually, the idea is close to VJ&squot;s one,&n;&t;&t;&t;   only timestamp cache is held not per host,&n;&t;&t;&t;   but per port pair and TW bucket is used&n;&t;&t;&t;   as state holder.&n;&n;&t;&t;&t;   If TW bucket has been already destroyed we&n;&t;&t;&t;   fall back to VJ&squot;s scheme and use initial&n;&t;&t;&t;   timestamp retrieved from peer table.&n;&t;&t;&t; */
r_if
c_cond
(paren
id|tw-&gt;tw_ts_recent_stamp
op_logical_and
(paren
op_logical_neg
id|twp
op_logical_or
(paren
id|sysctl_tcp_tw_reuse
op_logical_and
id|xtime.tv_sec
op_minus
id|tw-&gt;tw_ts_recent_stamp
OG
l_int|1
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
(paren
id|tp-&gt;write_seq
op_assign
id|tw-&gt;tw_snd_nxt
op_plus
l_int|65535
op_plus
l_int|2
)paren
op_eq
l_int|0
)paren
id|tp-&gt;write_seq
op_assign
l_int|1
suffix:semicolon
id|tp-&gt;ts_recent
op_assign
id|tw-&gt;tw_ts_recent
suffix:semicolon
id|tp-&gt;ts_recent_stamp
op_assign
id|tw-&gt;tw_ts_recent_stamp
suffix:semicolon
id|sock_hold
c_func
(paren
id|sk2
)paren
suffix:semicolon
r_goto
id|unique
suffix:semicolon
)brace
r_else
r_goto
id|not_unique
suffix:semicolon
)brace
)brace
id|tw
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/* And established part... */
id|sk_for_each
c_func
(paren
id|sk2
comma
id|node
comma
op_amp
id|head-&gt;chain
)paren
(brace
r_if
c_cond
(paren
id|TCP_IPV4_MATCH
c_func
(paren
id|sk2
comma
id|acookie
comma
id|saddr
comma
id|daddr
comma
id|ports
comma
id|dif
)paren
)paren
r_goto
id|not_unique
suffix:semicolon
)brace
id|unique
suffix:colon
multiline_comment|/* Must record num and sport now. Otherwise we will see&n;&t; * in hash table socket with a funny identity. */
id|inet-&gt;num
op_assign
id|lport
suffix:semicolon
id|inet-&gt;sport
op_assign
id|htons
c_func
(paren
id|lport
)paren
suffix:semicolon
id|sk-&gt;sk_hashent
op_assign
id|hash
suffix:semicolon
id|BUG_TRAP
c_func
(paren
id|sk_unhashed
c_func
(paren
id|sk
)paren
)paren
suffix:semicolon
id|__sk_add_node
c_func
(paren
id|sk
comma
op_amp
id|head-&gt;chain
)paren
suffix:semicolon
id|sock_prot_inc_use
c_func
(paren
id|sk-&gt;sk_prot
)paren
suffix:semicolon
id|write_unlock
c_func
(paren
op_amp
id|head-&gt;lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|twp
)paren
(brace
op_star
id|twp
op_assign
id|tw
suffix:semicolon
id|NET_INC_STATS_BH
c_func
(paren
id|LINUX_MIB_TIMEWAITRECYCLED
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|tw
)paren
(brace
multiline_comment|/* Silly. Should hash-dance instead... */
id|tcp_tw_deschedule
c_func
(paren
id|tw
)paren
suffix:semicolon
id|NET_INC_STATS_BH
c_func
(paren
id|LINUX_MIB_TIMEWAITRECYCLED
)paren
suffix:semicolon
id|tcp_tw_put
c_func
(paren
id|tw
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
id|not_unique
suffix:colon
id|write_unlock
c_func
(paren
op_amp
id|head-&gt;lock
)paren
suffix:semicolon
r_return
op_minus
id|EADDRNOTAVAIL
suffix:semicolon
)brace
DECL|function|connect_port_offset
r_static
r_inline
id|u32
id|connect_port_offset
c_func
(paren
r_const
r_struct
id|sock
op_star
id|sk
)paren
(brace
r_const
r_struct
id|inet_sock
op_star
id|inet
op_assign
id|inet_sk
c_func
(paren
id|sk
)paren
suffix:semicolon
r_return
id|secure_tcp_port_ephemeral
c_func
(paren
id|inet-&gt;rcv_saddr
comma
id|inet-&gt;daddr
comma
id|inet-&gt;dport
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Bind a port for a connect operation and hash it.&n; */
DECL|function|tcp_v4_hash_connect
r_static
r_inline
r_int
id|tcp_v4_hash_connect
c_func
(paren
r_struct
id|sock
op_star
id|sk
)paren
(brace
r_int
r_int
id|snum
op_assign
id|inet_sk
c_func
(paren
id|sk
)paren
op_member_access_from_pointer
id|num
suffix:semicolon
r_struct
id|tcp_bind_hashbucket
op_star
id|head
suffix:semicolon
r_struct
id|tcp_bind_bucket
op_star
id|tb
suffix:semicolon
r_int
id|ret
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|snum
)paren
(brace
r_int
id|low
op_assign
id|sysctl_local_port_range
(braket
l_int|0
)braket
suffix:semicolon
r_int
id|high
op_assign
id|sysctl_local_port_range
(braket
l_int|1
)braket
suffix:semicolon
r_int
id|range
op_assign
id|high
op_minus
id|low
suffix:semicolon
r_int
id|i
suffix:semicolon
r_int
id|port
suffix:semicolon
r_static
id|u32
id|hint
suffix:semicolon
id|u32
id|offset
op_assign
id|hint
op_plus
id|connect_port_offset
c_func
(paren
id|sk
)paren
suffix:semicolon
r_struct
id|hlist_node
op_star
id|node
suffix:semicolon
r_struct
id|tcp_tw_bucket
op_star
id|tw
op_assign
l_int|NULL
suffix:semicolon
id|local_bh_disable
c_func
(paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|1
suffix:semicolon
id|i
op_le
id|range
suffix:semicolon
id|i
op_increment
)paren
(brace
id|port
op_assign
id|low
op_plus
(paren
id|i
op_plus
id|offset
)paren
op_mod
id|range
suffix:semicolon
id|head
op_assign
op_amp
id|tcp_bhash
(braket
id|tcp_bhashfn
c_func
(paren
id|port
)paren
)braket
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|head-&gt;lock
)paren
suffix:semicolon
multiline_comment|/* Does not bother with rcv_saddr checks,&n; &t;&t;&t; * because the established check is already&n; &t;&t;&t; * unique enough.&n; &t;&t;&t; */
id|tb_for_each
c_func
(paren
id|tb
comma
id|node
comma
op_amp
id|head-&gt;chain
)paren
(brace
r_if
c_cond
(paren
id|tb-&gt;port
op_eq
id|port
)paren
(brace
id|BUG_TRAP
c_func
(paren
op_logical_neg
id|hlist_empty
c_func
(paren
op_amp
id|tb-&gt;owners
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tb-&gt;fastreuse
op_ge
l_int|0
)paren
r_goto
id|next_port
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|__tcp_v4_check_established
c_func
(paren
id|sk
comma
id|port
comma
op_amp
id|tw
)paren
)paren
r_goto
id|ok
suffix:semicolon
r_goto
id|next_port
suffix:semicolon
)brace
)brace
id|tb
op_assign
id|tcp_bucket_create
c_func
(paren
id|head
comma
id|port
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|tb
)paren
(brace
id|spin_unlock
c_func
(paren
op_amp
id|head-&gt;lock
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|tb-&gt;fastreuse
op_assign
op_minus
l_int|1
suffix:semicolon
r_goto
id|ok
suffix:semicolon
id|next_port
suffix:colon
id|spin_unlock
c_func
(paren
op_amp
id|head-&gt;lock
)paren
suffix:semicolon
)brace
id|local_bh_enable
c_func
(paren
)paren
suffix:semicolon
r_return
op_minus
id|EADDRNOTAVAIL
suffix:semicolon
id|ok
suffix:colon
id|hint
op_add_assign
id|i
suffix:semicolon
multiline_comment|/* Head lock still held and bh&squot;s disabled */
id|tcp_bind_hash
c_func
(paren
id|sk
comma
id|tb
comma
id|port
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sk_unhashed
c_func
(paren
id|sk
)paren
)paren
(brace
id|inet_sk
c_func
(paren
id|sk
)paren
op_member_access_from_pointer
id|sport
op_assign
id|htons
c_func
(paren
id|port
)paren
suffix:semicolon
id|__tcp_v4_hash
c_func
(paren
id|sk
comma
l_int|0
)paren
suffix:semicolon
)brace
id|spin_unlock
c_func
(paren
op_amp
id|head-&gt;lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tw
)paren
(brace
id|tcp_tw_deschedule
c_func
(paren
id|tw
)paren
suffix:semicolon
id|tcp_tw_put
c_func
(paren
id|tw
)paren
suffix:semicolon
)brace
id|ret
op_assign
l_int|0
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|head
op_assign
op_amp
id|tcp_bhash
(braket
id|tcp_bhashfn
c_func
(paren
id|snum
)paren
)braket
suffix:semicolon
id|tb
op_assign
id|tcp_sk
c_func
(paren
id|sk
)paren
op_member_access_from_pointer
id|bind_hash
suffix:semicolon
id|spin_lock_bh
c_func
(paren
op_amp
id|head-&gt;lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sk_head
c_func
(paren
op_amp
id|tb-&gt;owners
)paren
op_eq
id|sk
op_logical_and
op_logical_neg
id|sk-&gt;sk_bind_node.next
)paren
(brace
id|__tcp_v4_hash
c_func
(paren
id|sk
comma
l_int|0
)paren
suffix:semicolon
id|spin_unlock_bh
c_func
(paren
op_amp
id|head-&gt;lock
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|spin_unlock
c_func
(paren
op_amp
id|head-&gt;lock
)paren
suffix:semicolon
multiline_comment|/* No definite answer... Walk to established hash table */
id|ret
op_assign
id|__tcp_v4_check_established
c_func
(paren
id|sk
comma
id|snum
comma
l_int|NULL
)paren
suffix:semicolon
id|out
suffix:colon
id|local_bh_enable
c_func
(paren
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
)brace
multiline_comment|/* This will initiate an outgoing connection. */
DECL|function|tcp_v4_connect
r_int
id|tcp_v4_connect
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_struct
id|sockaddr
op_star
id|uaddr
comma
r_int
id|addr_len
)paren
(brace
r_struct
id|inet_sock
op_star
id|inet
op_assign
id|inet_sk
c_func
(paren
id|sk
)paren
suffix:semicolon
r_struct
id|tcp_opt
op_star
id|tp
op_assign
id|tcp_sk
c_func
(paren
id|sk
)paren
suffix:semicolon
r_struct
id|sockaddr_in
op_star
id|usin
op_assign
(paren
r_struct
id|sockaddr_in
op_star
)paren
id|uaddr
suffix:semicolon
r_struct
id|rtable
op_star
id|rt
suffix:semicolon
id|u32
id|daddr
comma
id|nexthop
suffix:semicolon
r_int
id|tmp
suffix:semicolon
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
id|addr_len
OL
r_sizeof
(paren
r_struct
id|sockaddr_in
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|usin-&gt;sin_family
op_ne
id|AF_INET
)paren
r_return
op_minus
id|EAFNOSUPPORT
suffix:semicolon
id|nexthop
op_assign
id|daddr
op_assign
id|usin-&gt;sin_addr.s_addr
suffix:semicolon
r_if
c_cond
(paren
id|inet-&gt;opt
op_logical_and
id|inet-&gt;opt-&gt;srr
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|daddr
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|nexthop
op_assign
id|inet-&gt;opt-&gt;faddr
suffix:semicolon
)brace
id|tmp
op_assign
id|ip_route_connect
c_func
(paren
op_amp
id|rt
comma
id|nexthop
comma
id|inet-&gt;saddr
comma
id|RT_CONN_FLAGS
c_func
(paren
id|sk
)paren
comma
id|sk-&gt;sk_bound_dev_if
comma
id|IPPROTO_TCP
comma
id|inet-&gt;sport
comma
id|usin-&gt;sin_port
comma
id|sk
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tmp
OL
l_int|0
)paren
r_return
id|tmp
suffix:semicolon
r_if
c_cond
(paren
id|rt-&gt;rt_flags
op_amp
(paren
id|RTCF_MULTICAST
op_or
id|RTCF_BROADCAST
)paren
)paren
(brace
id|ip_rt_put
c_func
(paren
id|rt
)paren
suffix:semicolon
r_return
op_minus
id|ENETUNREACH
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|inet-&gt;opt
op_logical_or
op_logical_neg
id|inet-&gt;opt-&gt;srr
)paren
id|daddr
op_assign
id|rt-&gt;rt_dst
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|inet-&gt;saddr
)paren
id|inet-&gt;saddr
op_assign
id|rt-&gt;rt_src
suffix:semicolon
id|inet-&gt;rcv_saddr
op_assign
id|inet-&gt;saddr
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;ts_recent_stamp
op_logical_and
id|inet-&gt;daddr
op_ne
id|daddr
)paren
(brace
multiline_comment|/* Reset inherited state */
id|tp-&gt;ts_recent
op_assign
l_int|0
suffix:semicolon
id|tp-&gt;ts_recent_stamp
op_assign
l_int|0
suffix:semicolon
id|tp-&gt;write_seq
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sysctl_tcp_tw_recycle
op_logical_and
op_logical_neg
id|tp-&gt;ts_recent_stamp
op_logical_and
id|rt-&gt;rt_dst
op_eq
id|daddr
)paren
(brace
r_struct
id|inet_peer
op_star
id|peer
op_assign
id|rt_get_peer
c_func
(paren
id|rt
)paren
suffix:semicolon
multiline_comment|/* VJ&squot;s idea. We save last timestamp seen from&n;&t;&t; * the destination in peer table, when entering state TIME-WAIT&n;&t;&t; * and initialize ts_recent from it, when trying new connection.&n;&t;&t; */
r_if
c_cond
(paren
id|peer
op_logical_and
id|peer-&gt;tcp_ts_stamp
op_plus
id|TCP_PAWS_MSL
op_ge
id|xtime.tv_sec
)paren
(brace
id|tp-&gt;ts_recent_stamp
op_assign
id|peer-&gt;tcp_ts_stamp
suffix:semicolon
id|tp-&gt;ts_recent
op_assign
id|peer-&gt;tcp_ts
suffix:semicolon
)brace
)brace
id|inet-&gt;dport
op_assign
id|usin-&gt;sin_port
suffix:semicolon
id|inet-&gt;daddr
op_assign
id|daddr
suffix:semicolon
id|tp-&gt;ext_header_len
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|inet-&gt;opt
)paren
id|tp-&gt;ext_header_len
op_assign
id|inet-&gt;opt-&gt;optlen
suffix:semicolon
id|tp-&gt;mss_clamp
op_assign
l_int|536
suffix:semicolon
multiline_comment|/* Socket identity is still unknown (sport may be zero).&n;&t; * However we set state to SYN-SENT and not releasing socket&n;&t; * lock select source port, enter ourselves into the hash tables and&n;&t; * complete initialization after this.&n;&t; */
id|tcp_set_state
c_func
(paren
id|sk
comma
id|TCP_SYN_SENT
)paren
suffix:semicolon
id|err
op_assign
id|tcp_v4_hash_connect
c_func
(paren
id|sk
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_goto
id|failure
suffix:semicolon
id|err
op_assign
id|ip_route_newports
c_func
(paren
op_amp
id|rt
comma
id|inet-&gt;sport
comma
id|inet-&gt;dport
comma
id|sk
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_goto
id|failure
suffix:semicolon
multiline_comment|/* OK, now commit destination to socket.  */
id|__sk_dst_set
c_func
(paren
id|sk
comma
op_amp
id|rt-&gt;u.dst
)paren
suffix:semicolon
id|tcp_v4_setup_caps
c_func
(paren
id|sk
comma
op_amp
id|rt-&gt;u.dst
)paren
suffix:semicolon
id|tp-&gt;ext2_header_len
op_assign
id|rt-&gt;u.dst.header_len
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|tp-&gt;write_seq
)paren
id|tp-&gt;write_seq
op_assign
id|secure_tcp_sequence_number
c_func
(paren
id|inet-&gt;saddr
comma
id|inet-&gt;daddr
comma
id|inet-&gt;sport
comma
id|usin-&gt;sin_port
)paren
suffix:semicolon
id|inet-&gt;id
op_assign
id|tp-&gt;write_seq
op_xor
id|jiffies
suffix:semicolon
id|err
op_assign
id|tcp_connect
c_func
(paren
id|sk
)paren
suffix:semicolon
id|rt
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_goto
id|failure
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|failure
suffix:colon
multiline_comment|/* This unhashes the socket and releases the local port, if necessary. */
id|tcp_set_state
c_func
(paren
id|sk
comma
id|TCP_CLOSE
)paren
suffix:semicolon
id|ip_rt_put
c_func
(paren
id|rt
)paren
suffix:semicolon
id|sk-&gt;sk_route_caps
op_assign
l_int|0
suffix:semicolon
id|inet-&gt;dport
op_assign
l_int|0
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|tcp_v4_iif
r_static
id|__inline__
r_int
id|tcp_v4_iif
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_return
(paren
(paren
r_struct
id|rtable
op_star
)paren
id|skb-&gt;dst
)paren
op_member_access_from_pointer
id|rt_iif
suffix:semicolon
)brace
DECL|function|tcp_v4_synq_hash
r_static
id|__inline__
id|u32
id|tcp_v4_synq_hash
c_func
(paren
id|u32
id|raddr
comma
id|u16
id|rport
comma
id|u32
id|rnd
)paren
(brace
r_return
(paren
id|jhash_2words
c_func
(paren
id|raddr
comma
(paren
id|u32
)paren
id|rport
comma
id|rnd
)paren
op_amp
(paren
id|TCP_SYNQ_HSIZE
op_minus
l_int|1
)paren
)paren
suffix:semicolon
)brace
DECL|function|tcp_v4_search_req
r_static
r_struct
id|open_request
op_star
id|tcp_v4_search_req
c_func
(paren
r_struct
id|tcp_opt
op_star
id|tp
comma
r_struct
id|open_request
op_star
op_star
op_star
id|prevp
comma
id|__u16
id|rport
comma
id|__u32
id|raddr
comma
id|__u32
id|laddr
)paren
(brace
r_struct
id|tcp_listen_opt
op_star
id|lopt
op_assign
id|tp-&gt;listen_opt
suffix:semicolon
r_struct
id|open_request
op_star
id|req
comma
op_star
op_star
id|prev
suffix:semicolon
r_for
c_loop
(paren
id|prev
op_assign
op_amp
id|lopt-&gt;syn_table
(braket
id|tcp_v4_synq_hash
c_func
(paren
id|raddr
comma
id|rport
comma
id|lopt-&gt;hash_rnd
)paren
)braket
suffix:semicolon
(paren
id|req
op_assign
op_star
id|prev
)paren
op_ne
l_int|NULL
suffix:semicolon
id|prev
op_assign
op_amp
id|req-&gt;dl_next
)paren
(brace
r_if
c_cond
(paren
id|req-&gt;rmt_port
op_eq
id|rport
op_logical_and
id|req-&gt;af.v4_req.rmt_addr
op_eq
id|raddr
op_logical_and
id|req-&gt;af.v4_req.loc_addr
op_eq
id|laddr
op_logical_and
id|TCP_INET_FAMILY
c_func
(paren
id|req
op_member_access_from_pointer
r_class
op_member_access_from_pointer
id|family
)paren
)paren
(brace
id|BUG_TRAP
c_func
(paren
op_logical_neg
id|req-&gt;sk
)paren
suffix:semicolon
op_star
id|prevp
op_assign
id|prev
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_return
id|req
suffix:semicolon
)brace
DECL|function|tcp_v4_synq_add
r_static
r_void
id|tcp_v4_synq_add
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_struct
id|open_request
op_star
id|req
)paren
(brace
r_struct
id|tcp_opt
op_star
id|tp
op_assign
id|tcp_sk
c_func
(paren
id|sk
)paren
suffix:semicolon
r_struct
id|tcp_listen_opt
op_star
id|lopt
op_assign
id|tp-&gt;listen_opt
suffix:semicolon
id|u32
id|h
op_assign
id|tcp_v4_synq_hash
c_func
(paren
id|req-&gt;af.v4_req.rmt_addr
comma
id|req-&gt;rmt_port
comma
id|lopt-&gt;hash_rnd
)paren
suffix:semicolon
id|req-&gt;expires
op_assign
id|jiffies
op_plus
id|TCP_TIMEOUT_INIT
suffix:semicolon
id|req-&gt;retrans
op_assign
l_int|0
suffix:semicolon
id|req-&gt;sk
op_assign
l_int|NULL
suffix:semicolon
id|req-&gt;dl_next
op_assign
id|lopt-&gt;syn_table
(braket
id|h
)braket
suffix:semicolon
id|write_lock
c_func
(paren
op_amp
id|tp-&gt;syn_wait_lock
)paren
suffix:semicolon
id|lopt-&gt;syn_table
(braket
id|h
)braket
op_assign
id|req
suffix:semicolon
id|write_unlock
c_func
(paren
op_amp
id|tp-&gt;syn_wait_lock
)paren
suffix:semicolon
id|tcp_synq_added
c_func
(paren
id|sk
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * This routine does path mtu discovery as defined in RFC1191.&n; */
DECL|function|do_pmtu_discovery
r_static
r_inline
r_void
id|do_pmtu_discovery
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_struct
id|iphdr
op_star
id|iph
comma
id|u32
id|mtu
)paren
(brace
r_struct
id|dst_entry
op_star
id|dst
suffix:semicolon
r_struct
id|inet_sock
op_star
id|inet
op_assign
id|inet_sk
c_func
(paren
id|sk
)paren
suffix:semicolon
r_struct
id|tcp_opt
op_star
id|tp
op_assign
id|tcp_sk
c_func
(paren
id|sk
)paren
suffix:semicolon
multiline_comment|/* We are not interested in TCP_LISTEN and open_requests (SYN-ACKs&n;&t; * send out by Linux are always &lt;576bytes so they should go through&n;&t; * unfragmented).&n;&t; */
r_if
c_cond
(paren
id|sk-&gt;sk_state
op_eq
id|TCP_LISTEN
)paren
r_return
suffix:semicolon
multiline_comment|/* We don&squot;t check in the destentry if pmtu discovery is forbidden&n;&t; * on this route. We just assume that no packet_to_big packets&n;&t; * are send back when pmtu discovery is not active.&n;     &t; * There is a small race when the user changes this flag in the&n;&t; * route, but I think that&squot;s acceptable.&n;&t; */
r_if
c_cond
(paren
(paren
id|dst
op_assign
id|__sk_dst_check
c_func
(paren
id|sk
comma
l_int|0
)paren
)paren
op_eq
l_int|NULL
)paren
r_return
suffix:semicolon
id|dst-&gt;ops
op_member_access_from_pointer
id|update_pmtu
c_func
(paren
id|dst
comma
id|mtu
)paren
suffix:semicolon
multiline_comment|/* Something is about to be wrong... Remember soft error&n;&t; * for the case, if this connection will not able to recover.&n;&t; */
r_if
c_cond
(paren
id|mtu
OL
id|dst_pmtu
c_func
(paren
id|dst
)paren
op_logical_and
id|ip_dont_fragment
c_func
(paren
id|sk
comma
id|dst
)paren
)paren
id|sk-&gt;sk_err_soft
op_assign
id|EMSGSIZE
suffix:semicolon
id|mtu
op_assign
id|dst_pmtu
c_func
(paren
id|dst
)paren
suffix:semicolon
r_if
c_cond
(paren
id|inet-&gt;pmtudisc
op_ne
id|IP_PMTUDISC_DONT
op_logical_and
id|tp-&gt;pmtu_cookie
OG
id|mtu
)paren
(brace
id|tcp_sync_mss
c_func
(paren
id|sk
comma
id|mtu
)paren
suffix:semicolon
multiline_comment|/* Resend the TCP packet because it&squot;s&n;&t;&t; * clear that the old packet has been&n;&t;&t; * dropped. This is the new &quot;fast&quot; path mtu&n;&t;&t; * discovery.&n;&t;&t; */
id|tcp_simple_retransmit
c_func
(paren
id|sk
)paren
suffix:semicolon
)brace
multiline_comment|/* else let the usual retransmit timer handle it */
)brace
multiline_comment|/*&n; * This routine is called by the ICMP module when it gets some&n; * sort of error condition.  If err &lt; 0 then the socket should&n; * be closed and the error returned to the user.  If err &gt; 0&n; * it&squot;s just the icmp type &lt;&lt; 8 | icmp code.  After adjustment&n; * header points to the first 8 bytes of the tcp header.  We need&n; * to find the appropriate port.&n; *&n; * The locking strategy used here is very &quot;optimistic&quot;. When&n; * someone else accesses the socket the ICMP is just dropped&n; * and for some paths there is no check at all.&n; * A more general error queue to queue errors for later handling&n; * is probably better.&n; *&n; */
DECL|function|tcp_v4_err
r_void
id|tcp_v4_err
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
id|u32
id|info
)paren
(brace
r_struct
id|iphdr
op_star
id|iph
op_assign
(paren
r_struct
id|iphdr
op_star
)paren
id|skb-&gt;data
suffix:semicolon
r_struct
id|tcphdr
op_star
id|th
op_assign
(paren
r_struct
id|tcphdr
op_star
)paren
(paren
id|skb-&gt;data
op_plus
(paren
id|iph-&gt;ihl
op_lshift
l_int|2
)paren
)paren
suffix:semicolon
r_struct
id|tcp_opt
op_star
id|tp
suffix:semicolon
r_struct
id|inet_sock
op_star
id|inet
suffix:semicolon
r_int
id|type
op_assign
id|skb-&gt;h.icmph-&gt;type
suffix:semicolon
r_int
id|code
op_assign
id|skb-&gt;h.icmph-&gt;code
suffix:semicolon
r_struct
id|sock
op_star
id|sk
suffix:semicolon
id|__u32
id|seq
suffix:semicolon
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
id|skb-&gt;len
OL
(paren
id|iph-&gt;ihl
op_lshift
l_int|2
)paren
op_plus
l_int|8
)paren
(brace
id|ICMP_INC_STATS_BH
c_func
(paren
id|ICMP_MIB_INERRORS
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|sk
op_assign
id|tcp_v4_lookup
c_func
(paren
id|iph-&gt;daddr
comma
id|th-&gt;dest
comma
id|iph-&gt;saddr
comma
id|th-&gt;source
comma
id|tcp_v4_iif
c_func
(paren
id|skb
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sk
)paren
(brace
id|ICMP_INC_STATS_BH
c_func
(paren
id|ICMP_MIB_INERRORS
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sk-&gt;sk_state
op_eq
id|TCP_TIME_WAIT
)paren
(brace
id|tcp_tw_put
c_func
(paren
(paren
r_struct
id|tcp_tw_bucket
op_star
)paren
id|sk
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|bh_lock_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
multiline_comment|/* If too many ICMPs get dropped on busy&n;&t; * servers this needs to be solved differently.&n;&t; */
r_if
c_cond
(paren
id|sock_owned_by_user
c_func
(paren
id|sk
)paren
)paren
id|NET_INC_STATS_BH
c_func
(paren
id|LINUX_MIB_LOCKDROPPEDICMPS
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;sk_state
op_eq
id|TCP_CLOSE
)paren
r_goto
id|out
suffix:semicolon
id|tp
op_assign
id|tcp_sk
c_func
(paren
id|sk
)paren
suffix:semicolon
id|seq
op_assign
id|ntohl
c_func
(paren
id|th-&gt;seq
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;sk_state
op_ne
id|TCP_LISTEN
op_logical_and
op_logical_neg
id|between
c_func
(paren
id|seq
comma
id|tp-&gt;snd_una
comma
id|tp-&gt;snd_nxt
)paren
)paren
(brace
id|NET_INC_STATS
c_func
(paren
id|LINUX_MIB_OUTOFWINDOWICMPS
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|type
)paren
(brace
r_case
id|ICMP_SOURCE_QUENCH
suffix:colon
multiline_comment|/* Just silently ignore these. */
r_goto
id|out
suffix:semicolon
r_case
id|ICMP_PARAMETERPROB
suffix:colon
id|err
op_assign
id|EPROTO
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ICMP_DEST_UNREACH
suffix:colon
r_if
c_cond
(paren
id|code
OG
id|NR_ICMP_UNREACH
)paren
r_goto
id|out
suffix:semicolon
r_if
c_cond
(paren
id|code
op_eq
id|ICMP_FRAG_NEEDED
)paren
(brace
multiline_comment|/* PMTU discovery (RFC1191) */
r_if
c_cond
(paren
op_logical_neg
id|sock_owned_by_user
c_func
(paren
id|sk
)paren
)paren
id|do_pmtu_discovery
c_func
(paren
id|sk
comma
id|iph
comma
id|info
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|err
op_assign
id|icmp_err_convert
(braket
id|code
)braket
dot
id|errno
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ICMP_TIME_EXCEEDED
suffix:colon
id|err
op_assign
id|EHOSTUNREACH
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_goto
id|out
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|sk-&gt;sk_state
)paren
(brace
r_struct
id|open_request
op_star
id|req
comma
op_star
op_star
id|prev
suffix:semicolon
r_case
id|TCP_LISTEN
suffix:colon
r_if
c_cond
(paren
id|sock_owned_by_user
c_func
(paren
id|sk
)paren
)paren
r_goto
id|out
suffix:semicolon
id|req
op_assign
id|tcp_v4_search_req
c_func
(paren
id|tp
comma
op_amp
id|prev
comma
id|th-&gt;dest
comma
id|iph-&gt;daddr
comma
id|iph-&gt;saddr
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|req
)paren
r_goto
id|out
suffix:semicolon
multiline_comment|/* ICMPs are not backlogged, hence we cannot get&n;&t;&t;   an established socket here.&n;&t;&t; */
id|BUG_TRAP
c_func
(paren
op_logical_neg
id|req-&gt;sk
)paren
suffix:semicolon
r_if
c_cond
(paren
id|seq
op_ne
id|req-&gt;snt_isn
)paren
(brace
id|NET_INC_STATS_BH
c_func
(paren
id|LINUX_MIB_OUTOFWINDOWICMPS
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
multiline_comment|/*&n;&t;&t; * Still in SYN_RECV, just remove it silently.&n;&t;&t; * There is no good way to pass the error to the newly&n;&t;&t; * created socket, and POSIX does not want network&n;&t;&t; * errors returned from accept().&n;&t;&t; */
id|tcp_synq_drop
c_func
(paren
id|sk
comma
id|req
comma
id|prev
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
r_case
id|TCP_SYN_SENT
suffix:colon
r_case
id|TCP_SYN_RECV
suffix:colon
multiline_comment|/* Cannot happen.&n;&t;&t;&t;       It can f.e. if SYNs crossed.&n;&t;&t;&t;     */
r_if
c_cond
(paren
op_logical_neg
id|sock_owned_by_user
c_func
(paren
id|sk
)paren
)paren
(brace
id|TCP_INC_STATS_BH
c_func
(paren
id|TCP_MIB_ATTEMPTFAILS
)paren
suffix:semicolon
id|sk-&gt;sk_err
op_assign
id|err
suffix:semicolon
id|sk
op_member_access_from_pointer
id|sk_error_report
c_func
(paren
id|sk
)paren
suffix:semicolon
id|tcp_done
c_func
(paren
id|sk
)paren
suffix:semicolon
)brace
r_else
(brace
id|sk-&gt;sk_err_soft
op_assign
id|err
suffix:semicolon
)brace
r_goto
id|out
suffix:semicolon
)brace
multiline_comment|/* If we&squot;ve already connected we will keep trying&n;&t; * until we time out, or the user gives up.&n;&t; *&n;&t; * rfc1122 4.2.3.9 allows to consider as hard errors&n;&t; * only PROTO_UNREACH and PORT_UNREACH (well, FRAG_FAILED too,&n;&t; * but it is obsoleted by pmtu discovery).&n;&t; *&n;&t; * Note, that in modern internet, where routing is unreliable&n;&t; * and in each dark corner broken firewalls sit, sending random&n;&t; * errors ordered by their masters even this two messages finally lose&n;&t; * their original sense (even Linux sends invalid PORT_UNREACHs)&n;&t; *&n;&t; * Now we are in compliance with RFCs.&n;&t; *&t;&t;&t;&t;&t;&t;&t;--ANK (980905)&n;&t; */
id|inet
op_assign
id|inet_sk
c_func
(paren
id|sk
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sock_owned_by_user
c_func
(paren
id|sk
)paren
op_logical_and
id|inet-&gt;recverr
)paren
(brace
id|sk-&gt;sk_err
op_assign
id|err
suffix:semicolon
id|sk
op_member_access_from_pointer
id|sk_error_report
c_func
(paren
id|sk
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* Only an error on timeout */
id|sk-&gt;sk_err_soft
op_assign
id|err
suffix:semicolon
)brace
id|out
suffix:colon
id|bh_unlock_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
id|sock_put
c_func
(paren
id|sk
)paren
suffix:semicolon
)brace
multiline_comment|/* This routine computes an IPv4 TCP checksum. */
DECL|function|tcp_v4_send_check
r_void
id|tcp_v4_send_check
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_struct
id|tcphdr
op_star
id|th
comma
r_int
id|len
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|inet_sock
op_star
id|inet
op_assign
id|inet_sk
c_func
(paren
id|sk
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb-&gt;ip_summed
op_eq
id|CHECKSUM_HW
)paren
(brace
id|th-&gt;check
op_assign
op_complement
id|tcp_v4_check
c_func
(paren
id|th
comma
id|len
comma
id|inet-&gt;saddr
comma
id|inet-&gt;daddr
comma
l_int|0
)paren
suffix:semicolon
id|skb-&gt;csum
op_assign
m_offsetof
(paren
r_struct
id|tcphdr
comma
id|check
)paren
suffix:semicolon
)brace
r_else
(brace
id|th-&gt;check
op_assign
id|tcp_v4_check
c_func
(paren
id|th
comma
id|len
comma
id|inet-&gt;saddr
comma
id|inet-&gt;daddr
comma
id|csum_partial
c_func
(paren
(paren
r_char
op_star
)paren
id|th
comma
id|th-&gt;doff
op_lshift
l_int|2
comma
id|skb-&gt;csum
)paren
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; *&t;This routine will send an RST to the other tcp.&n; *&n; *&t;Someone asks: why I NEVER use socket parameters (TOS, TTL etc.)&n; *&t;&t;      for reset.&n; *&t;Answer: if a packet caused RST, it is not for a socket&n; *&t;&t;existing in our system, if it is matched to a socket,&n; *&t;&t;it is just duplicate segment or bug in other side&squot;s TCP.&n; *&t;&t;So that we build reply only basing on parameters&n; *&t;&t;arrived with segment.&n; *&t;Exception: precedence violation. We do not implement it in any case.&n; */
DECL|function|tcp_v4_send_reset
r_static
r_void
id|tcp_v4_send_reset
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|tcphdr
op_star
id|th
op_assign
id|skb-&gt;h.th
suffix:semicolon
r_struct
id|tcphdr
id|rth
suffix:semicolon
r_struct
id|ip_reply_arg
id|arg
suffix:semicolon
multiline_comment|/* Never send a reset in response to a reset. */
r_if
c_cond
(paren
id|th-&gt;rst
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
(paren
(paren
r_struct
id|rtable
op_star
)paren
id|skb-&gt;dst
)paren
op_member_access_from_pointer
id|rt_type
op_ne
id|RTN_LOCAL
)paren
r_return
suffix:semicolon
multiline_comment|/* Swap the send and the receive. */
id|memset
c_func
(paren
op_amp
id|rth
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|tcphdr
)paren
)paren
suffix:semicolon
id|rth.dest
op_assign
id|th-&gt;source
suffix:semicolon
id|rth.source
op_assign
id|th-&gt;dest
suffix:semicolon
id|rth.doff
op_assign
r_sizeof
(paren
r_struct
id|tcphdr
)paren
op_div
l_int|4
suffix:semicolon
id|rth.rst
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|th-&gt;ack
)paren
(brace
id|rth.seq
op_assign
id|th-&gt;ack_seq
suffix:semicolon
)brace
r_else
(brace
id|rth.ack
op_assign
l_int|1
suffix:semicolon
id|rth.ack_seq
op_assign
id|htonl
c_func
(paren
id|ntohl
c_func
(paren
id|th-&gt;seq
)paren
op_plus
id|th-&gt;syn
op_plus
id|th-&gt;fin
op_plus
id|skb-&gt;len
op_minus
(paren
id|th-&gt;doff
op_lshift
l_int|2
)paren
)paren
suffix:semicolon
)brace
id|memset
c_func
(paren
op_amp
id|arg
comma
l_int|0
comma
r_sizeof
id|arg
)paren
suffix:semicolon
id|arg.iov
(braket
l_int|0
)braket
dot
id|iov_base
op_assign
(paren
r_int
r_char
op_star
)paren
op_amp
id|rth
suffix:semicolon
id|arg.iov
(braket
l_int|0
)braket
dot
id|iov_len
op_assign
r_sizeof
id|rth
suffix:semicolon
id|arg.csum
op_assign
id|csum_tcpudp_nofold
c_func
(paren
id|skb-&gt;nh.iph-&gt;daddr
comma
id|skb-&gt;nh.iph-&gt;saddr
comma
multiline_comment|/*XXX*/
r_sizeof
(paren
r_struct
id|tcphdr
)paren
comma
id|IPPROTO_TCP
comma
l_int|0
)paren
suffix:semicolon
id|arg.csumoffset
op_assign
m_offsetof
(paren
r_struct
id|tcphdr
comma
id|check
)paren
op_div
l_int|2
suffix:semicolon
id|ip_send_reply
c_func
(paren
id|tcp_socket-&gt;sk
comma
id|skb
comma
op_amp
id|arg
comma
r_sizeof
id|rth
)paren
suffix:semicolon
id|TCP_INC_STATS_BH
c_func
(paren
id|TCP_MIB_OUTSEGS
)paren
suffix:semicolon
id|TCP_INC_STATS_BH
c_func
(paren
id|TCP_MIB_OUTRSTS
)paren
suffix:semicolon
)brace
multiline_comment|/* The code following below sending ACKs in SYN-RECV and TIME-WAIT states&n;   outside socket context is ugly, certainly. What can I do?&n; */
DECL|function|tcp_v4_send_ack
r_static
r_void
id|tcp_v4_send_ack
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
id|u32
id|seq
comma
id|u32
id|ack
comma
id|u32
id|win
comma
id|u32
id|ts
)paren
(brace
r_struct
id|tcphdr
op_star
id|th
op_assign
id|skb-&gt;h.th
suffix:semicolon
r_struct
(brace
r_struct
id|tcphdr
id|th
suffix:semicolon
id|u32
id|tsopt
(braket
l_int|3
)braket
suffix:semicolon
)brace
id|rep
suffix:semicolon
r_struct
id|ip_reply_arg
id|arg
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|rep.th
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|tcphdr
)paren
)paren
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|arg
comma
l_int|0
comma
r_sizeof
id|arg
)paren
suffix:semicolon
id|arg.iov
(braket
l_int|0
)braket
dot
id|iov_base
op_assign
(paren
r_int
r_char
op_star
)paren
op_amp
id|rep
suffix:semicolon
id|arg.iov
(braket
l_int|0
)braket
dot
id|iov_len
op_assign
r_sizeof
(paren
id|rep.th
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ts
)paren
(brace
id|rep.tsopt
(braket
l_int|0
)braket
op_assign
id|htonl
c_func
(paren
(paren
id|TCPOPT_NOP
op_lshift
l_int|24
)paren
op_or
(paren
id|TCPOPT_NOP
op_lshift
l_int|16
)paren
op_or
(paren
id|TCPOPT_TIMESTAMP
op_lshift
l_int|8
)paren
op_or
id|TCPOLEN_TIMESTAMP
)paren
suffix:semicolon
id|rep.tsopt
(braket
l_int|1
)braket
op_assign
id|htonl
c_func
(paren
id|tcp_time_stamp
)paren
suffix:semicolon
id|rep.tsopt
(braket
l_int|2
)braket
op_assign
id|htonl
c_func
(paren
id|ts
)paren
suffix:semicolon
id|arg.iov
(braket
l_int|0
)braket
dot
id|iov_len
op_assign
r_sizeof
(paren
id|rep
)paren
suffix:semicolon
)brace
multiline_comment|/* Swap the send and the receive. */
id|rep.th.dest
op_assign
id|th-&gt;source
suffix:semicolon
id|rep.th.source
op_assign
id|th-&gt;dest
suffix:semicolon
id|rep.th.doff
op_assign
id|arg.iov
(braket
l_int|0
)braket
dot
id|iov_len
op_div
l_int|4
suffix:semicolon
id|rep.th.seq
op_assign
id|htonl
c_func
(paren
id|seq
)paren
suffix:semicolon
id|rep.th.ack_seq
op_assign
id|htonl
c_func
(paren
id|ack
)paren
suffix:semicolon
id|rep.th.ack
op_assign
l_int|1
suffix:semicolon
id|rep.th.window
op_assign
id|htons
c_func
(paren
id|win
)paren
suffix:semicolon
id|arg.csum
op_assign
id|csum_tcpudp_nofold
c_func
(paren
id|skb-&gt;nh.iph-&gt;daddr
comma
id|skb-&gt;nh.iph-&gt;saddr
comma
multiline_comment|/*XXX*/
id|arg.iov
(braket
l_int|0
)braket
dot
id|iov_len
comma
id|IPPROTO_TCP
comma
l_int|0
)paren
suffix:semicolon
id|arg.csumoffset
op_assign
m_offsetof
(paren
r_struct
id|tcphdr
comma
id|check
)paren
op_div
l_int|2
suffix:semicolon
id|ip_send_reply
c_func
(paren
id|tcp_socket-&gt;sk
comma
id|skb
comma
op_amp
id|arg
comma
id|arg.iov
(braket
l_int|0
)braket
dot
id|iov_len
)paren
suffix:semicolon
id|TCP_INC_STATS_BH
c_func
(paren
id|TCP_MIB_OUTSEGS
)paren
suffix:semicolon
)brace
DECL|function|tcp_v4_timewait_ack
r_static
r_void
id|tcp_v4_timewait_ack
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|tcp_tw_bucket
op_star
id|tw
op_assign
(paren
r_struct
id|tcp_tw_bucket
op_star
)paren
id|sk
suffix:semicolon
id|tcp_v4_send_ack
c_func
(paren
id|skb
comma
id|tw-&gt;tw_snd_nxt
comma
id|tw-&gt;tw_rcv_nxt
comma
id|tw-&gt;tw_rcv_wnd
op_rshift
id|tw-&gt;tw_rcv_wscale
comma
id|tw-&gt;tw_ts_recent
)paren
suffix:semicolon
id|tcp_tw_put
c_func
(paren
id|tw
)paren
suffix:semicolon
)brace
DECL|function|tcp_v4_or_send_ack
r_static
r_void
id|tcp_v4_or_send_ack
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|open_request
op_star
id|req
)paren
(brace
id|tcp_v4_send_ack
c_func
(paren
id|skb
comma
id|req-&gt;snt_isn
op_plus
l_int|1
comma
id|req-&gt;rcv_isn
op_plus
l_int|1
comma
id|req-&gt;rcv_wnd
comma
id|req-&gt;ts_recent
)paren
suffix:semicolon
)brace
DECL|function|tcp_v4_route_req
r_static
r_struct
id|dst_entry
op_star
id|tcp_v4_route_req
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_struct
id|open_request
op_star
id|req
)paren
(brace
r_struct
id|rtable
op_star
id|rt
suffix:semicolon
r_struct
id|ip_options
op_star
id|opt
op_assign
id|req-&gt;af.v4_req.opt
suffix:semicolon
r_struct
id|flowi
id|fl
op_assign
(brace
dot
id|oif
op_assign
id|sk-&gt;sk_bound_dev_if
comma
dot
id|nl_u
op_assign
(brace
dot
id|ip4_u
op_assign
(brace
dot
id|daddr
op_assign
(paren
(paren
id|opt
op_logical_and
id|opt-&gt;srr
)paren
ques
c_cond
id|opt-&gt;faddr
suffix:colon
id|req-&gt;af.v4_req.rmt_addr
)paren
comma
dot
id|saddr
op_assign
id|req-&gt;af.v4_req.loc_addr
comma
dot
id|tos
op_assign
id|RT_CONN_FLAGS
c_func
(paren
id|sk
)paren
)brace
)brace
comma
dot
id|proto
op_assign
id|IPPROTO_TCP
comma
dot
id|uli_u
op_assign
(brace
dot
id|ports
op_assign
(brace
dot
id|sport
op_assign
id|inet_sk
c_func
(paren
id|sk
)paren
op_member_access_from_pointer
id|sport
comma
dot
id|dport
op_assign
id|req-&gt;rmt_port
)brace
)brace
)brace
suffix:semicolon
r_if
c_cond
(paren
id|ip_route_output_flow
c_func
(paren
op_amp
id|rt
comma
op_amp
id|fl
comma
id|sk
comma
l_int|0
)paren
)paren
(brace
id|IP_INC_STATS_BH
c_func
(paren
id|IPSTATS_MIB_OUTNOROUTES
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|opt
op_logical_and
id|opt-&gt;is_strictroute
op_logical_and
id|rt-&gt;rt_dst
op_ne
id|rt-&gt;rt_gateway
)paren
(brace
id|ip_rt_put
c_func
(paren
id|rt
)paren
suffix:semicolon
id|IP_INC_STATS_BH
c_func
(paren
id|IPSTATS_MIB_OUTNOROUTES
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
r_return
op_amp
id|rt-&gt;u.dst
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;Send a SYN-ACK after having received an ACK.&n; *&t;This still operates on a open_request only, not on a big&n; *&t;socket.&n; */
DECL|function|tcp_v4_send_synack
r_static
r_int
id|tcp_v4_send_synack
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_struct
id|open_request
op_star
id|req
comma
r_struct
id|dst_entry
op_star
id|dst
)paren
(brace
r_int
id|err
op_assign
op_minus
l_int|1
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
multiline_comment|/* First, grab a route. */
r_if
c_cond
(paren
op_logical_neg
id|dst
op_logical_and
(paren
id|dst
op_assign
id|tcp_v4_route_req
c_func
(paren
id|sk
comma
id|req
)paren
)paren
op_eq
l_int|NULL
)paren
r_goto
id|out
suffix:semicolon
id|skb
op_assign
id|tcp_make_synack
c_func
(paren
id|sk
comma
id|dst
comma
id|req
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
)paren
(brace
r_struct
id|tcphdr
op_star
id|th
op_assign
id|skb-&gt;h.th
suffix:semicolon
id|th-&gt;check
op_assign
id|tcp_v4_check
c_func
(paren
id|th
comma
id|skb-&gt;len
comma
id|req-&gt;af.v4_req.loc_addr
comma
id|req-&gt;af.v4_req.rmt_addr
comma
id|csum_partial
c_func
(paren
(paren
r_char
op_star
)paren
id|th
comma
id|skb-&gt;len
comma
id|skb-&gt;csum
)paren
)paren
suffix:semicolon
id|err
op_assign
id|ip_build_and_send_pkt
c_func
(paren
id|skb
comma
id|sk
comma
id|req-&gt;af.v4_req.loc_addr
comma
id|req-&gt;af.v4_req.rmt_addr
comma
id|req-&gt;af.v4_req.opt
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
op_eq
id|NET_XMIT_CN
)paren
id|err
op_assign
l_int|0
suffix:semicolon
)brace
id|out
suffix:colon
id|dst_release
c_func
(paren
id|dst
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;IPv4 open_request destructor.&n; */
DECL|function|tcp_v4_or_free
r_static
r_void
id|tcp_v4_or_free
c_func
(paren
r_struct
id|open_request
op_star
id|req
)paren
(brace
r_if
c_cond
(paren
id|req-&gt;af.v4_req.opt
)paren
id|kfree
c_func
(paren
id|req-&gt;af.v4_req.opt
)paren
suffix:semicolon
)brace
DECL|function|syn_flood_warning
r_static
r_inline
r_void
id|syn_flood_warning
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_static
r_int
r_int
id|warntime
suffix:semicolon
r_if
c_cond
(paren
id|time_after
c_func
(paren
id|jiffies
comma
(paren
id|warntime
op_plus
id|HZ
op_star
l_int|60
)paren
)paren
)paren
(brace
id|warntime
op_assign
id|jiffies
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;possible SYN flooding on port %d. Sending cookies.&bslash;n&quot;
comma
id|ntohs
c_func
(paren
id|skb-&gt;h.th-&gt;dest
)paren
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; * Save and compile IPv4 options into the open_request if needed.&n; */
DECL|function|tcp_v4_save_options
r_static
r_inline
r_struct
id|ip_options
op_star
id|tcp_v4_save_options
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|ip_options
op_star
id|opt
op_assign
op_amp
(paren
id|IPCB
c_func
(paren
id|skb
)paren
op_member_access_from_pointer
id|opt
)paren
suffix:semicolon
r_struct
id|ip_options
op_star
id|dopt
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|opt
op_logical_and
id|opt-&gt;optlen
)paren
(brace
r_int
id|opt_size
op_assign
id|optlength
c_func
(paren
id|opt
)paren
suffix:semicolon
id|dopt
op_assign
id|kmalloc
c_func
(paren
id|opt_size
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dopt
)paren
(brace
r_if
c_cond
(paren
id|ip_options_echo
c_func
(paren
id|dopt
comma
id|skb
)paren
)paren
(brace
id|kfree
c_func
(paren
id|dopt
)paren
suffix:semicolon
id|dopt
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
)brace
r_return
id|dopt
suffix:semicolon
)brace
multiline_comment|/*&n; * Maximum number of SYN_RECV sockets in queue per LISTEN socket.&n; * One SYN_RECV socket costs about 80bytes on a 32bit machine.&n; * It would be better to replace it with a global counter for all sockets&n; * but then some measure against one socket starving all other sockets&n; * would be needed.&n; *&n; * It was 128 by default. Experiments with real servers show, that&n; * it is absolutely not enough even at 100conn/sec. 256 cures most&n; * of problems. This value is adjusted to 128 for very small machines&n; * (&lt;=32Mb of memory) and to 1024 on normal or better ones (&gt;=256Mb).&n; * Further increasing requires to change hash table size.&n; */
DECL|variable|sysctl_max_syn_backlog
r_int
id|sysctl_max_syn_backlog
op_assign
l_int|256
suffix:semicolon
DECL|variable|or_ipv4
r_struct
id|or_calltable
id|or_ipv4
op_assign
(brace
dot
id|family
op_assign
id|PF_INET
comma
dot
id|rtx_syn_ack
op_assign
id|tcp_v4_send_synack
comma
dot
id|send_ack
op_assign
id|tcp_v4_or_send_ack
comma
dot
id|destructor
op_assign
id|tcp_v4_or_free
comma
dot
id|send_reset
op_assign
id|tcp_v4_send_reset
comma
)brace
suffix:semicolon
DECL|function|tcp_v4_conn_request
r_int
id|tcp_v4_conn_request
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|tcp_opt
id|tp
suffix:semicolon
r_struct
id|open_request
op_star
id|req
suffix:semicolon
id|__u32
id|saddr
op_assign
id|skb-&gt;nh.iph-&gt;saddr
suffix:semicolon
id|__u32
id|daddr
op_assign
id|skb-&gt;nh.iph-&gt;daddr
suffix:semicolon
id|__u32
id|isn
op_assign
id|TCP_SKB_CB
c_func
(paren
id|skb
)paren
op_member_access_from_pointer
id|when
suffix:semicolon
r_struct
id|dst_entry
op_star
id|dst
op_assign
l_int|NULL
suffix:semicolon
macro_line|#ifdef CONFIG_SYN_COOKIES
r_int
id|want_cookie
op_assign
l_int|0
suffix:semicolon
macro_line|#else
mdefine_line|#define want_cookie 0 /* Argh, why doesn&squot;t gcc optimize this :( */
macro_line|#endif
multiline_comment|/* Never answer to SYNs send to broadcast or multicast */
r_if
c_cond
(paren
(paren
(paren
r_struct
id|rtable
op_star
)paren
id|skb-&gt;dst
)paren
op_member_access_from_pointer
id|rt_flags
op_amp
(paren
id|RTCF_BROADCAST
op_or
id|RTCF_MULTICAST
)paren
)paren
r_goto
id|drop
suffix:semicolon
multiline_comment|/* TW buckets are converted to open requests without&n;&t; * limitations, they conserve resources and peer is&n;&t; * evidently real one.&n;&t; */
r_if
c_cond
(paren
id|tcp_synq_is_full
c_func
(paren
id|sk
)paren
op_logical_and
op_logical_neg
id|isn
)paren
(brace
macro_line|#ifdef CONFIG_SYN_COOKIES
r_if
c_cond
(paren
id|sysctl_tcp_syncookies
)paren
(brace
id|want_cookie
op_assign
l_int|1
suffix:semicolon
)brace
r_else
macro_line|#endif
r_goto
id|drop
suffix:semicolon
)brace
multiline_comment|/* Accept backlog is full. If we have already queued enough&n;&t; * of warm entries in syn queue, drop request. It is better than&n;&t; * clogging syn queue with openreqs with exponentially increasing&n;&t; * timeout.&n;&t; */
r_if
c_cond
(paren
id|sk_acceptq_is_full
c_func
(paren
id|sk
)paren
op_logical_and
id|tcp_synq_young
c_func
(paren
id|sk
)paren
OG
l_int|1
)paren
r_goto
id|drop
suffix:semicolon
id|req
op_assign
id|tcp_openreq_alloc
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|req
)paren
r_goto
id|drop
suffix:semicolon
id|tcp_clear_options
c_func
(paren
op_amp
id|tp
)paren
suffix:semicolon
id|tp.mss_clamp
op_assign
l_int|536
suffix:semicolon
id|tp.user_mss
op_assign
id|tcp_sk
c_func
(paren
id|sk
)paren
op_member_access_from_pointer
id|user_mss
suffix:semicolon
id|tcp_parse_options
c_func
(paren
id|skb
comma
op_amp
id|tp
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|want_cookie
)paren
(brace
id|tcp_clear_options
c_func
(paren
op_amp
id|tp
)paren
suffix:semicolon
id|tp.saw_tstamp
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|tp.saw_tstamp
op_logical_and
op_logical_neg
id|tp.rcv_tsval
)paren
(brace
multiline_comment|/* Some OSes (unknown ones, but I see them on web server, which&n;&t;&t; * contains information interesting only for windows&squot;&n;&t;&t; * users) do not send their stamp in SYN. It is easy case.&n;&t;&t; * We simply do not advertise TS support.&n;&t;&t; */
id|tp.saw_tstamp
op_assign
l_int|0
suffix:semicolon
id|tp.tstamp_ok
op_assign
l_int|0
suffix:semicolon
)brace
id|tp.tstamp_ok
op_assign
id|tp.saw_tstamp
suffix:semicolon
id|tcp_openreq_init
c_func
(paren
id|req
comma
op_amp
id|tp
comma
id|skb
)paren
suffix:semicolon
id|req-&gt;af.v4_req.loc_addr
op_assign
id|daddr
suffix:semicolon
id|req-&gt;af.v4_req.rmt_addr
op_assign
id|saddr
suffix:semicolon
id|req-&gt;af.v4_req.opt
op_assign
id|tcp_v4_save_options
c_func
(paren
id|sk
comma
id|skb
)paren
suffix:semicolon
id|req
op_member_access_from_pointer
r_class
op_assign
op_amp
id|or_ipv4
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|want_cookie
)paren
id|TCP_ECN_create_request
c_func
(paren
id|req
comma
id|skb-&gt;h.th
)paren
suffix:semicolon
r_if
c_cond
(paren
id|want_cookie
)paren
(brace
macro_line|#ifdef CONFIG_SYN_COOKIES
id|syn_flood_warning
c_func
(paren
id|skb
)paren
suffix:semicolon
macro_line|#endif
id|isn
op_assign
id|cookie_v4_init_sequence
c_func
(paren
id|sk
comma
id|skb
comma
op_amp
id|req-&gt;mss
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|isn
)paren
(brace
r_struct
id|inet_peer
op_star
id|peer
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/* VJ&squot;s idea. We save last timestamp seen&n;&t;&t; * from the destination in peer table, when entering&n;&t;&t; * state TIME-WAIT, and check against it before&n;&t;&t; * accepting new connection request.&n;&t;&t; *&n;&t;&t; * If &quot;isn&quot; is not zero, this request hit alive&n;&t;&t; * timewait bucket, so that all the necessary checks&n;&t;&t; * are made in the function processing timewait state.&n;&t;&t; */
r_if
c_cond
(paren
id|tp.saw_tstamp
op_logical_and
id|sysctl_tcp_tw_recycle
op_logical_and
(paren
id|dst
op_assign
id|tcp_v4_route_req
c_func
(paren
id|sk
comma
id|req
)paren
)paren
op_ne
l_int|NULL
op_logical_and
(paren
id|peer
op_assign
id|rt_get_peer
c_func
(paren
(paren
r_struct
id|rtable
op_star
)paren
id|dst
)paren
)paren
op_ne
l_int|NULL
op_logical_and
id|peer-&gt;v4daddr
op_eq
id|saddr
)paren
(brace
r_if
c_cond
(paren
id|xtime.tv_sec
template_param
id|TCP_PAWS_WINDOW
)paren
(brace
id|NET_INC_STATS_BH
c_func
(paren
id|LINUX_MIB_PAWSPASSIVEREJECTED
)paren
suffix:semicolon
id|dst_release
c_func
(paren
id|dst
)paren
suffix:semicolon
r_goto
id|drop_and_free
suffix:semicolon
)brace
)brace
multiline_comment|/* Kill the following clause, if you dislike this way. */
r_else
r_if
c_cond
(paren
op_logical_neg
id|sysctl_tcp_syncookies
op_logical_and
(paren
id|sysctl_max_syn_backlog
op_minus
id|tcp_synq_len
c_func
(paren
id|sk
)paren
OL
(paren
id|sysctl_max_syn_backlog
op_rshift
l_int|2
)paren
)paren
op_logical_and
(paren
op_logical_neg
id|peer
op_logical_or
op_logical_neg
id|peer-&gt;tcp_ts_stamp
)paren
op_logical_and
(paren
op_logical_neg
id|dst
op_logical_or
op_logical_neg
id|dst_metric
c_func
(paren
id|dst
comma
id|RTAX_RTT
)paren
)paren
)paren
(brace
multiline_comment|/* Without syncookies last quarter of&n;&t;&t;&t; * backlog is filled with destinations,&n;&t;&t;&t; * proven to be alive.&n;&t;&t;&t; * It means that we continue to communicate&n;&t;&t;&t; * to destinations, already remembered&n;&t;&t;&t; * to the moment of synflood.&n;&t;&t;&t; */
id|NETDEBUG
c_func
(paren
r_if
(paren
id|net_ratelimit
c_func
(paren
)paren
)paren
"&bslash;"
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;TCP: drop open &quot;
l_string|&quot;request from %u.%u.&quot;
l_string|&quot;%u.%u/%u&bslash;n&quot;
comma
"&bslash;"
id|NIPQUAD
c_func
(paren
id|saddr
)paren
comma
id|ntohs
c_func
(paren
id|skb-&gt;h.th-&gt;source
)paren
)paren
)paren
suffix:semicolon
id|dst_release
c_func
(paren
id|dst
)paren
suffix:semicolon
r_goto
id|drop_and_free
suffix:semicolon
)brace
id|isn
op_assign
id|tcp_v4_init_sequence
c_func
(paren
id|sk
comma
id|skb
)paren
suffix:semicolon
)brace
id|req-&gt;snt_isn
op_assign
id|isn
suffix:semicolon
r_if
c_cond
(paren
id|tcp_v4_send_synack
c_func
(paren
id|sk
comma
id|req
comma
id|dst
)paren
)paren
r_goto
id|drop_and_free
suffix:semicolon
r_if
c_cond
(paren
id|want_cookie
)paren
(brace
id|tcp_openreq_free
c_func
(paren
id|req
)paren
suffix:semicolon
)brace
r_else
(brace
id|tcp_v4_synq_add
c_func
(paren
id|sk
comma
id|req
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
id|drop_and_free
suffix:colon
id|tcp_openreq_free
c_func
(paren
id|req
)paren
suffix:semicolon
id|drop
suffix:colon
id|TCP_INC_STATS_BH
c_func
(paren
id|TCP_MIB_ATTEMPTFAILS
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * The three way handshake has completed - we got a valid synack -&n; * now create the new socket.&n; */
DECL|function|tcp_v4_syn_recv_sock
r_struct
id|sock
op_star
id|tcp_v4_syn_recv_sock
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|open_request
op_star
id|req
comma
r_struct
id|dst_entry
op_star
id|dst
)paren
(brace
r_struct
id|inet_sock
op_star
id|newinet
suffix:semicolon
r_struct
id|tcp_opt
op_star
id|newtp
suffix:semicolon
r_struct
id|sock
op_star
id|newsk
suffix:semicolon
r_if
c_cond
(paren
id|sk_acceptq_is_full
c_func
(paren
id|sk
)paren
)paren
r_goto
id|exit_overflow
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dst
op_logical_and
(paren
id|dst
op_assign
id|tcp_v4_route_req
c_func
(paren
id|sk
comma
id|req
)paren
)paren
op_eq
l_int|NULL
)paren
r_goto
m_exit
suffix:semicolon
id|newsk
op_assign
id|tcp_create_openreq_child
c_func
(paren
id|sk
comma
id|req
comma
id|skb
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|newsk
)paren
r_goto
m_exit
suffix:semicolon
id|newsk-&gt;sk_dst_cache
op_assign
id|dst
suffix:semicolon
id|tcp_v4_setup_caps
c_func
(paren
id|newsk
comma
id|dst
)paren
suffix:semicolon
id|newtp
op_assign
id|tcp_sk
c_func
(paren
id|newsk
)paren
suffix:semicolon
id|newinet
op_assign
id|inet_sk
c_func
(paren
id|newsk
)paren
suffix:semicolon
id|newinet-&gt;daddr
op_assign
id|req-&gt;af.v4_req.rmt_addr
suffix:semicolon
id|newinet-&gt;rcv_saddr
op_assign
id|req-&gt;af.v4_req.loc_addr
suffix:semicolon
id|newinet-&gt;saddr
op_assign
id|req-&gt;af.v4_req.loc_addr
suffix:semicolon
id|newinet-&gt;opt
op_assign
id|req-&gt;af.v4_req.opt
suffix:semicolon
id|req-&gt;af.v4_req.opt
op_assign
l_int|NULL
suffix:semicolon
id|newinet-&gt;mc_index
op_assign
id|tcp_v4_iif
c_func
(paren
id|skb
)paren
suffix:semicolon
id|newinet-&gt;mc_ttl
op_assign
id|skb-&gt;nh.iph-&gt;ttl
suffix:semicolon
id|newtp-&gt;ext_header_len
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|newinet-&gt;opt
)paren
id|newtp-&gt;ext_header_len
op_assign
id|newinet-&gt;opt-&gt;optlen
suffix:semicolon
id|newtp-&gt;ext2_header_len
op_assign
id|dst-&gt;header_len
suffix:semicolon
id|newinet-&gt;id
op_assign
id|newtp-&gt;write_seq
op_xor
id|jiffies
suffix:semicolon
id|tcp_sync_mss
c_func
(paren
id|newsk
comma
id|dst_pmtu
c_func
(paren
id|dst
)paren
)paren
suffix:semicolon
id|newtp-&gt;advmss
op_assign
id|dst_metric
c_func
(paren
id|dst
comma
id|RTAX_ADVMSS
)paren
suffix:semicolon
id|tcp_initialize_rcv_mss
c_func
(paren
id|newsk
)paren
suffix:semicolon
id|__tcp_v4_hash
c_func
(paren
id|newsk
comma
l_int|0
)paren
suffix:semicolon
id|__tcp_inherit_port
c_func
(paren
id|sk
comma
id|newsk
)paren
suffix:semicolon
r_return
id|newsk
suffix:semicolon
id|exit_overflow
suffix:colon
id|NET_INC_STATS_BH
c_func
(paren
id|LINUX_MIB_LISTENOVERFLOWS
)paren
suffix:semicolon
m_exit
suffix:colon
id|NET_INC_STATS_BH
c_func
(paren
id|LINUX_MIB_LISTENDROPS
)paren
suffix:semicolon
id|dst_release
c_func
(paren
id|dst
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
DECL|function|tcp_v4_hnd_req
r_static
r_struct
id|sock
op_star
id|tcp_v4_hnd_req
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|tcphdr
op_star
id|th
op_assign
id|skb-&gt;h.th
suffix:semicolon
r_struct
id|iphdr
op_star
id|iph
op_assign
id|skb-&gt;nh.iph
suffix:semicolon
r_struct
id|tcp_opt
op_star
id|tp
op_assign
id|tcp_sk
c_func
(paren
id|sk
)paren
suffix:semicolon
r_struct
id|sock
op_star
id|nsk
suffix:semicolon
r_struct
id|open_request
op_star
op_star
id|prev
suffix:semicolon
multiline_comment|/* Find possible connection requests. */
r_struct
id|open_request
op_star
id|req
op_assign
id|tcp_v4_search_req
c_func
(paren
id|tp
comma
op_amp
id|prev
comma
id|th-&gt;source
comma
id|iph-&gt;saddr
comma
id|iph-&gt;daddr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|req
)paren
r_return
id|tcp_check_req
c_func
(paren
id|sk
comma
id|skb
comma
id|req
comma
id|prev
)paren
suffix:semicolon
id|nsk
op_assign
id|__tcp_v4_lookup_established
c_func
(paren
id|skb-&gt;nh.iph-&gt;saddr
comma
id|th-&gt;source
comma
id|skb-&gt;nh.iph-&gt;daddr
comma
id|ntohs
c_func
(paren
id|th-&gt;dest
)paren
comma
id|tcp_v4_iif
c_func
(paren
id|skb
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|nsk
)paren
(brace
r_if
c_cond
(paren
id|nsk-&gt;sk_state
op_ne
id|TCP_TIME_WAIT
)paren
(brace
id|bh_lock_sock
c_func
(paren
id|nsk
)paren
suffix:semicolon
r_return
id|nsk
suffix:semicolon
)brace
id|tcp_tw_put
c_func
(paren
(paren
r_struct
id|tcp_tw_bucket
op_star
)paren
id|nsk
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_SYN_COOKIES
r_if
c_cond
(paren
op_logical_neg
id|th-&gt;rst
op_logical_and
op_logical_neg
id|th-&gt;syn
op_logical_and
id|th-&gt;ack
)paren
id|sk
op_assign
id|cookie_v4_check
c_func
(paren
id|sk
comma
id|skb
comma
op_amp
(paren
id|IPCB
c_func
(paren
id|skb
)paren
op_member_access_from_pointer
id|opt
)paren
)paren
suffix:semicolon
macro_line|#endif
r_return
id|sk
suffix:semicolon
)brace
DECL|function|tcp_v4_checksum_init
r_static
r_int
id|tcp_v4_checksum_init
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_if
c_cond
(paren
id|skb-&gt;ip_summed
op_eq
id|CHECKSUM_HW
)paren
(brace
id|skb-&gt;ip_summed
op_assign
id|CHECKSUM_UNNECESSARY
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|tcp_v4_check
c_func
(paren
id|skb-&gt;h.th
comma
id|skb-&gt;len
comma
id|skb-&gt;nh.iph-&gt;saddr
comma
id|skb-&gt;nh.iph-&gt;daddr
comma
id|skb-&gt;csum
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|NETDEBUG
c_func
(paren
r_if
(paren
id|net_ratelimit
c_func
(paren
)paren
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;hw tcp v4 csum failed&bslash;n&quot;
)paren
)paren
suffix:semicolon
id|skb-&gt;ip_summed
op_assign
id|CHECKSUM_NONE
suffix:semicolon
)brace
r_if
c_cond
(paren
id|skb-&gt;len
op_le
l_int|76
)paren
(brace
r_if
c_cond
(paren
id|tcp_v4_check
c_func
(paren
id|skb-&gt;h.th
comma
id|skb-&gt;len
comma
id|skb-&gt;nh.iph-&gt;saddr
comma
id|skb-&gt;nh.iph-&gt;daddr
comma
id|skb_checksum
c_func
(paren
id|skb
comma
l_int|0
comma
id|skb-&gt;len
comma
l_int|0
)paren
)paren
)paren
r_return
op_minus
l_int|1
suffix:semicolon
id|skb-&gt;ip_summed
op_assign
id|CHECKSUM_UNNECESSARY
suffix:semicolon
)brace
r_else
(brace
id|skb-&gt;csum
op_assign
op_complement
id|tcp_v4_check
c_func
(paren
id|skb-&gt;h.th
comma
id|skb-&gt;len
comma
id|skb-&gt;nh.iph-&gt;saddr
comma
id|skb-&gt;nh.iph-&gt;daddr
comma
l_int|0
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* The socket must have it&squot;s spinlock held when we get&n; * here.&n; *&n; * We have a potential double-lock case here, so even when&n; * doing backlog processing we use the BH locking scheme.&n; * This is because we cannot sleep with the original spinlock&n; * held.&n; */
DECL|function|tcp_v4_do_rcv
r_int
id|tcp_v4_do_rcv
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_if
c_cond
(paren
id|sk-&gt;sk_state
op_eq
id|TCP_ESTABLISHED
)paren
(brace
multiline_comment|/* Fast path */
id|TCP_CHECK_TIMER
c_func
(paren
id|sk
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tcp_rcv_established
c_func
(paren
id|sk
comma
id|skb
comma
id|skb-&gt;h.th
comma
id|skb-&gt;len
)paren
)paren
r_goto
id|reset
suffix:semicolon
id|TCP_CHECK_TIMER
c_func
(paren
id|sk
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|skb-&gt;len
OL
(paren
id|skb-&gt;h.th-&gt;doff
op_lshift
l_int|2
)paren
op_logical_or
id|tcp_checksum_complete
c_func
(paren
id|skb
)paren
)paren
r_goto
id|csum_err
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;sk_state
op_eq
id|TCP_LISTEN
)paren
(brace
r_struct
id|sock
op_star
id|nsk
op_assign
id|tcp_v4_hnd_req
c_func
(paren
id|sk
comma
id|skb
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|nsk
)paren
r_goto
id|discard
suffix:semicolon
r_if
c_cond
(paren
id|nsk
op_ne
id|sk
)paren
(brace
r_if
c_cond
(paren
id|tcp_child_process
c_func
(paren
id|sk
comma
id|nsk
comma
id|skb
)paren
)paren
r_goto
id|reset
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
id|TCP_CHECK_TIMER
c_func
(paren
id|sk
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tcp_rcv_state_process
c_func
(paren
id|sk
comma
id|skb
comma
id|skb-&gt;h.th
comma
id|skb-&gt;len
)paren
)paren
r_goto
id|reset
suffix:semicolon
id|TCP_CHECK_TIMER
c_func
(paren
id|sk
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|reset
suffix:colon
id|tcp_v4_send_reset
c_func
(paren
id|skb
)paren
suffix:semicolon
id|discard
suffix:colon
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
multiline_comment|/* Be careful here. If this function gets more complicated and&n;&t; * gcc suffers from register pressure on the x86, sk (in %ebx)&n;&t; * might be destroyed here. This current version compiles correctly,&n;&t; * but you have been warned.&n;&t; */
r_return
l_int|0
suffix:semicolon
id|csum_err
suffix:colon
id|TCP_INC_STATS_BH
c_func
(paren
id|TCP_MIB_INERRS
)paren
suffix:semicolon
r_goto
id|discard
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;From tcp_input.c&n; */
DECL|function|tcp_v4_rcv
r_int
id|tcp_v4_rcv
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|tcphdr
op_star
id|th
suffix:semicolon
r_struct
id|sock
op_star
id|sk
suffix:semicolon
r_int
id|ret
suffix:semicolon
r_if
c_cond
(paren
id|skb-&gt;pkt_type
op_ne
id|PACKET_HOST
)paren
r_goto
id|discard_it
suffix:semicolon
multiline_comment|/* Count it even if it&squot;s bad */
id|TCP_INC_STATS_BH
c_func
(paren
id|TCP_MIB_INSEGS
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pskb_may_pull
c_func
(paren
id|skb
comma
r_sizeof
(paren
r_struct
id|tcphdr
)paren
)paren
)paren
r_goto
id|discard_it
suffix:semicolon
id|th
op_assign
id|skb-&gt;h.th
suffix:semicolon
r_if
c_cond
(paren
id|th-&gt;doff
OL
r_sizeof
(paren
r_struct
id|tcphdr
)paren
op_div
l_int|4
)paren
r_goto
id|bad_packet
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pskb_may_pull
c_func
(paren
id|skb
comma
id|th-&gt;doff
op_star
l_int|4
)paren
)paren
r_goto
id|discard_it
suffix:semicolon
multiline_comment|/* An explanation is required here, I think.&n;&t; * Packet length and doff are validated by header prediction,&n;&t; * provided case of th-&gt;doff==0 is elimineted.&n;&t; * So, we defer the checks. */
r_if
c_cond
(paren
(paren
id|skb-&gt;ip_summed
op_ne
id|CHECKSUM_UNNECESSARY
op_logical_and
id|tcp_v4_checksum_init
c_func
(paren
id|skb
)paren
OL
l_int|0
)paren
)paren
r_goto
id|bad_packet
suffix:semicolon
id|th
op_assign
id|skb-&gt;h.th
suffix:semicolon
id|TCP_SKB_CB
c_func
(paren
id|skb
)paren
op_member_access_from_pointer
id|seq
op_assign
id|ntohl
c_func
(paren
id|th-&gt;seq
)paren
suffix:semicolon
id|TCP_SKB_CB
c_func
(paren
id|skb
)paren
op_member_access_from_pointer
id|end_seq
op_assign
(paren
id|TCP_SKB_CB
c_func
(paren
id|skb
)paren
op_member_access_from_pointer
id|seq
op_plus
id|th-&gt;syn
op_plus
id|th-&gt;fin
op_plus
id|skb-&gt;len
op_minus
id|th-&gt;doff
op_star
l_int|4
)paren
suffix:semicolon
id|TCP_SKB_CB
c_func
(paren
id|skb
)paren
op_member_access_from_pointer
id|ack_seq
op_assign
id|ntohl
c_func
(paren
id|th-&gt;ack_seq
)paren
suffix:semicolon
id|TCP_SKB_CB
c_func
(paren
id|skb
)paren
op_member_access_from_pointer
id|when
op_assign
l_int|0
suffix:semicolon
id|TCP_SKB_CB
c_func
(paren
id|skb
)paren
op_member_access_from_pointer
id|flags
op_assign
id|skb-&gt;nh.iph-&gt;tos
suffix:semicolon
id|TCP_SKB_CB
c_func
(paren
id|skb
)paren
op_member_access_from_pointer
id|sacked
op_assign
l_int|0
suffix:semicolon
id|sk
op_assign
id|__tcp_v4_lookup
c_func
(paren
id|skb-&gt;nh.iph-&gt;saddr
comma
id|th-&gt;source
comma
id|skb-&gt;nh.iph-&gt;daddr
comma
id|ntohs
c_func
(paren
id|th-&gt;dest
)paren
comma
id|tcp_v4_iif
c_func
(paren
id|skb
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sk
)paren
r_goto
id|no_tcp_socket
suffix:semicolon
id|process
suffix:colon
r_if
c_cond
(paren
id|sk-&gt;sk_state
op_eq
id|TCP_TIME_WAIT
)paren
r_goto
id|do_time_wait
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|xfrm4_policy_check
c_func
(paren
id|sk
comma
id|XFRM_POLICY_IN
comma
id|skb
)paren
)paren
r_goto
id|discard_and_relse
suffix:semicolon
r_if
c_cond
(paren
id|sk_filter
c_func
(paren
id|sk
comma
id|skb
comma
l_int|0
)paren
)paren
r_goto
id|discard_and_relse
suffix:semicolon
id|skb-&gt;dev
op_assign
l_int|NULL
suffix:semicolon
id|bh_lock_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
id|ret
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sock_owned_by_user
c_func
(paren
id|sk
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|tcp_prequeue
c_func
(paren
id|sk
comma
id|skb
)paren
)paren
id|ret
op_assign
id|tcp_v4_do_rcv
c_func
(paren
id|sk
comma
id|skb
)paren
suffix:semicolon
)brace
r_else
id|sk_add_backlog
c_func
(paren
id|sk
comma
id|skb
)paren
suffix:semicolon
id|bh_unlock_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
id|sock_put
c_func
(paren
id|sk
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
id|no_tcp_socket
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|xfrm4_policy_check
c_func
(paren
l_int|NULL
comma
id|XFRM_POLICY_IN
comma
id|skb
)paren
)paren
r_goto
id|discard_it
suffix:semicolon
r_if
c_cond
(paren
id|skb-&gt;len
OL
(paren
id|th-&gt;doff
op_lshift
l_int|2
)paren
op_logical_or
id|tcp_checksum_complete
c_func
(paren
id|skb
)paren
)paren
(brace
id|bad_packet
suffix:colon
id|TCP_INC_STATS_BH
c_func
(paren
id|TCP_MIB_INERRS
)paren
suffix:semicolon
)brace
r_else
(brace
id|tcp_v4_send_reset
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
id|discard_it
suffix:colon
multiline_comment|/* Discard frame. */
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|discard_and_relse
suffix:colon
id|sock_put
c_func
(paren
id|sk
)paren
suffix:semicolon
r_goto
id|discard_it
suffix:semicolon
id|do_time_wait
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|xfrm4_policy_check
c_func
(paren
l_int|NULL
comma
id|XFRM_POLICY_IN
comma
id|skb
)paren
)paren
(brace
id|tcp_tw_put
c_func
(paren
(paren
r_struct
id|tcp_tw_bucket
op_star
)paren
id|sk
)paren
suffix:semicolon
r_goto
id|discard_it
suffix:semicolon
)brace
r_if
c_cond
(paren
id|skb-&gt;len
OL
(paren
id|th-&gt;doff
op_lshift
l_int|2
)paren
op_logical_or
id|tcp_checksum_complete
c_func
(paren
id|skb
)paren
)paren
(brace
id|TCP_INC_STATS_BH
c_func
(paren
id|TCP_MIB_INERRS
)paren
suffix:semicolon
id|tcp_tw_put
c_func
(paren
(paren
r_struct
id|tcp_tw_bucket
op_star
)paren
id|sk
)paren
suffix:semicolon
r_goto
id|discard_it
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|tcp_timewait_state_process
c_func
(paren
(paren
r_struct
id|tcp_tw_bucket
op_star
)paren
id|sk
comma
id|skb
comma
id|th
comma
id|skb-&gt;len
)paren
)paren
(brace
r_case
id|TCP_TW_SYN
suffix:colon
(brace
r_struct
id|sock
op_star
id|sk2
op_assign
id|tcp_v4_lookup_listener
c_func
(paren
id|skb-&gt;nh.iph-&gt;daddr
comma
id|ntohs
c_func
(paren
id|th-&gt;dest
)paren
comma
id|tcp_v4_iif
c_func
(paren
id|skb
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sk2
)paren
(brace
id|tcp_tw_deschedule
c_func
(paren
(paren
r_struct
id|tcp_tw_bucket
op_star
)paren
id|sk
)paren
suffix:semicolon
id|tcp_tw_put
c_func
(paren
(paren
r_struct
id|tcp_tw_bucket
op_star
)paren
id|sk
)paren
suffix:semicolon
id|sk
op_assign
id|sk2
suffix:semicolon
r_goto
id|process
suffix:semicolon
)brace
multiline_comment|/* Fall through to ACK */
)brace
r_case
id|TCP_TW_ACK
suffix:colon
id|tcp_v4_timewait_ack
c_func
(paren
id|sk
comma
id|skb
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|TCP_TW_RST
suffix:colon
r_goto
id|no_tcp_socket
suffix:semicolon
r_case
id|TCP_TW_SUCCESS
suffix:colon
suffix:semicolon
)brace
r_goto
id|discard_it
suffix:semicolon
)brace
multiline_comment|/* With per-bucket locks this operation is not-atomic, so that&n; * this version is not worse.&n; */
DECL|function|__tcp_v4_rehash
r_static
r_void
id|__tcp_v4_rehash
c_func
(paren
r_struct
id|sock
op_star
id|sk
)paren
(brace
id|sk-&gt;sk_prot
op_member_access_from_pointer
id|unhash
c_func
(paren
id|sk
)paren
suffix:semicolon
id|sk-&gt;sk_prot
op_member_access_from_pointer
id|hash
c_func
(paren
id|sk
)paren
suffix:semicolon
)brace
DECL|function|tcp_v4_reselect_saddr
r_static
r_int
id|tcp_v4_reselect_saddr
c_func
(paren
r_struct
id|sock
op_star
id|sk
)paren
(brace
r_struct
id|inet_sock
op_star
id|inet
op_assign
id|inet_sk
c_func
(paren
id|sk
)paren
suffix:semicolon
r_int
id|err
suffix:semicolon
r_struct
id|rtable
op_star
id|rt
suffix:semicolon
id|__u32
id|old_saddr
op_assign
id|inet-&gt;saddr
suffix:semicolon
id|__u32
id|new_saddr
suffix:semicolon
id|__u32
id|daddr
op_assign
id|inet-&gt;daddr
suffix:semicolon
r_if
c_cond
(paren
id|inet-&gt;opt
op_logical_and
id|inet-&gt;opt-&gt;srr
)paren
id|daddr
op_assign
id|inet-&gt;opt-&gt;faddr
suffix:semicolon
multiline_comment|/* Query new route. */
id|err
op_assign
id|ip_route_connect
c_func
(paren
op_amp
id|rt
comma
id|daddr
comma
l_int|0
comma
id|RT_TOS
c_func
(paren
id|inet-&gt;tos
)paren
op_or
id|sk-&gt;sk_localroute
comma
id|sk-&gt;sk_bound_dev_if
comma
id|IPPROTO_TCP
comma
id|inet-&gt;sport
comma
id|inet-&gt;dport
comma
id|sk
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_return
id|err
suffix:semicolon
id|__sk_dst_set
c_func
(paren
id|sk
comma
op_amp
id|rt-&gt;u.dst
)paren
suffix:semicolon
id|tcp_v4_setup_caps
c_func
(paren
id|sk
comma
op_amp
id|rt-&gt;u.dst
)paren
suffix:semicolon
id|tcp_sk
c_func
(paren
id|sk
)paren
op_member_access_from_pointer
id|ext2_header_len
op_assign
id|rt-&gt;u.dst.header_len
suffix:semicolon
id|new_saddr
op_assign
id|rt-&gt;rt_src
suffix:semicolon
r_if
c_cond
(paren
id|new_saddr
op_eq
id|old_saddr
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|sysctl_ip_dynaddr
OG
l_int|1
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;tcp_v4_rebuild_header(): shifting inet-&gt;&quot;
l_string|&quot;saddr from %d.%d.%d.%d to %d.%d.%d.%d&bslash;n&quot;
comma
id|NIPQUAD
c_func
(paren
id|old_saddr
)paren
comma
id|NIPQUAD
c_func
(paren
id|new_saddr
)paren
)paren
suffix:semicolon
)brace
id|inet-&gt;saddr
op_assign
id|new_saddr
suffix:semicolon
id|inet-&gt;rcv_saddr
op_assign
id|new_saddr
suffix:semicolon
multiline_comment|/* XXX The only one ugly spot where we need to&n;&t; * XXX really change the sockets identity after&n;&t; * XXX it has entered the hashes. -DaveM&n;&t; *&n;&t; * Besides that, it does not check for connection&n;&t; * uniqueness. Wait for troubles.&n;&t; */
id|__tcp_v4_rehash
c_func
(paren
id|sk
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|tcp_v4_rebuild_header
r_int
id|tcp_v4_rebuild_header
c_func
(paren
r_struct
id|sock
op_star
id|sk
)paren
(brace
r_struct
id|inet_sock
op_star
id|inet
op_assign
id|inet_sk
c_func
(paren
id|sk
)paren
suffix:semicolon
r_struct
id|rtable
op_star
id|rt
op_assign
(paren
r_struct
id|rtable
op_star
)paren
id|__sk_dst_check
c_func
(paren
id|sk
comma
l_int|0
)paren
suffix:semicolon
id|u32
id|daddr
suffix:semicolon
r_int
id|err
suffix:semicolon
multiline_comment|/* Route is OK, nothing to do. */
r_if
c_cond
(paren
id|rt
)paren
r_return
l_int|0
suffix:semicolon
multiline_comment|/* Reroute. */
id|daddr
op_assign
id|inet-&gt;daddr
suffix:semicolon
r_if
c_cond
(paren
id|inet-&gt;opt
op_logical_and
id|inet-&gt;opt-&gt;srr
)paren
id|daddr
op_assign
id|inet-&gt;opt-&gt;faddr
suffix:semicolon
(brace
r_struct
id|flowi
id|fl
op_assign
(brace
dot
id|oif
op_assign
id|sk-&gt;sk_bound_dev_if
comma
dot
id|nl_u
op_assign
(brace
dot
id|ip4_u
op_assign
(brace
dot
id|daddr
op_assign
id|daddr
comma
dot
id|saddr
op_assign
id|inet-&gt;saddr
comma
dot
id|tos
op_assign
id|RT_CONN_FLAGS
c_func
(paren
id|sk
)paren
)brace
)brace
comma
dot
id|proto
op_assign
id|IPPROTO_TCP
comma
dot
id|uli_u
op_assign
(brace
dot
id|ports
op_assign
(brace
dot
id|sport
op_assign
id|inet-&gt;sport
comma
dot
id|dport
op_assign
id|inet-&gt;dport
)brace
)brace
)brace
suffix:semicolon
id|err
op_assign
id|ip_route_output_flow
c_func
(paren
op_amp
id|rt
comma
op_amp
id|fl
comma
id|sk
comma
l_int|0
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|err
)paren
(brace
id|__sk_dst_set
c_func
(paren
id|sk
comma
op_amp
id|rt-&gt;u.dst
)paren
suffix:semicolon
id|tcp_v4_setup_caps
c_func
(paren
id|sk
comma
op_amp
id|rt-&gt;u.dst
)paren
suffix:semicolon
id|tcp_sk
c_func
(paren
id|sk
)paren
op_member_access_from_pointer
id|ext2_header_len
op_assign
id|rt-&gt;u.dst.header_len
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* Routing failed... */
id|sk-&gt;sk_route_caps
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sysctl_ip_dynaddr
op_logical_or
id|sk-&gt;sk_state
op_ne
id|TCP_SYN_SENT
op_logical_or
(paren
id|sk-&gt;sk_userlocks
op_amp
id|SOCK_BINDADDR_LOCK
)paren
op_logical_or
(paren
id|err
op_assign
id|tcp_v4_reselect_saddr
c_func
(paren
id|sk
)paren
)paren
op_ne
l_int|0
)paren
id|sk-&gt;sk_err_soft
op_assign
op_minus
id|err
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|v4_addr2sockaddr
r_static
r_void
id|v4_addr2sockaddr
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_struct
id|sockaddr
op_star
id|uaddr
)paren
(brace
r_struct
id|sockaddr_in
op_star
id|sin
op_assign
(paren
r_struct
id|sockaddr_in
op_star
)paren
id|uaddr
suffix:semicolon
r_struct
id|inet_sock
op_star
id|inet
op_assign
id|inet_sk
c_func
(paren
id|sk
)paren
suffix:semicolon
id|sin-&gt;sin_family
op_assign
id|AF_INET
suffix:semicolon
id|sin-&gt;sin_addr.s_addr
op_assign
id|inet-&gt;daddr
suffix:semicolon
id|sin-&gt;sin_port
op_assign
id|inet-&gt;dport
suffix:semicolon
)brace
multiline_comment|/* VJ&squot;s idea. Save last timestamp seen from this destination&n; * and hold it at least for normal timewait interval to use for duplicate&n; * segment detection in subsequent connections, before they enter synchronized&n; * state.&n; */
DECL|function|tcp_v4_remember_stamp
r_int
id|tcp_v4_remember_stamp
c_func
(paren
r_struct
id|sock
op_star
id|sk
)paren
(brace
r_struct
id|inet_sock
op_star
id|inet
op_assign
id|inet_sk
c_func
(paren
id|sk
)paren
suffix:semicolon
r_struct
id|tcp_opt
op_star
id|tp
op_assign
id|tcp_sk
c_func
(paren
id|sk
)paren
suffix:semicolon
r_struct
id|rtable
op_star
id|rt
op_assign
(paren
r_struct
id|rtable
op_star
)paren
id|__sk_dst_get
c_func
(paren
id|sk
)paren
suffix:semicolon
r_struct
id|inet_peer
op_star
id|peer
op_assign
l_int|NULL
suffix:semicolon
r_int
id|release_it
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|rt
op_logical_or
id|rt-&gt;rt_dst
op_ne
id|inet-&gt;daddr
)paren
(brace
id|peer
op_assign
id|inet_getpeer
c_func
(paren
id|inet-&gt;daddr
comma
l_int|1
)paren
suffix:semicolon
id|release_it
op_assign
l_int|1
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
op_logical_neg
id|rt-&gt;peer
)paren
id|rt_bind_peer
c_func
(paren
id|rt
comma
l_int|1
)paren
suffix:semicolon
id|peer
op_assign
id|rt-&gt;peer
suffix:semicolon
)brace
r_if
c_cond
(paren
id|peer
)paren
(brace
r_if
c_cond
(paren
(paren
id|s32
)paren
(paren
id|peer-&gt;tcp_ts
op_minus
id|tp-&gt;ts_recent
)paren
op_le
l_int|0
op_logical_or
(paren
id|peer-&gt;tcp_ts_stamp
op_plus
id|TCP_PAWS_MSL
OL
id|xtime.tv_sec
op_logical_and
id|peer-&gt;tcp_ts_stamp
op_le
id|tp-&gt;ts_recent_stamp
)paren
)paren
(brace
id|peer-&gt;tcp_ts_stamp
op_assign
id|tp-&gt;ts_recent_stamp
suffix:semicolon
id|peer-&gt;tcp_ts
op_assign
id|tp-&gt;ts_recent
suffix:semicolon
)brace
r_if
c_cond
(paren
id|release_it
)paren
id|inet_putpeer
c_func
(paren
id|peer
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|tcp_v4_tw_remember_stamp
r_int
id|tcp_v4_tw_remember_stamp
c_func
(paren
r_struct
id|tcp_tw_bucket
op_star
id|tw
)paren
(brace
r_struct
id|inet_peer
op_star
id|peer
op_assign
l_int|NULL
suffix:semicolon
id|peer
op_assign
id|inet_getpeer
c_func
(paren
id|tw-&gt;tw_daddr
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|peer
)paren
(brace
r_if
c_cond
(paren
(paren
id|s32
)paren
(paren
id|peer-&gt;tcp_ts
op_minus
id|tw-&gt;tw_ts_recent
)paren
op_le
l_int|0
op_logical_or
(paren
id|peer-&gt;tcp_ts_stamp
op_plus
id|TCP_PAWS_MSL
OL
id|xtime.tv_sec
op_logical_and
id|peer-&gt;tcp_ts_stamp
op_le
id|tw-&gt;tw_ts_recent_stamp
)paren
)paren
(brace
id|peer-&gt;tcp_ts_stamp
op_assign
id|tw-&gt;tw_ts_recent_stamp
suffix:semicolon
id|peer-&gt;tcp_ts
op_assign
id|tw-&gt;tw_ts_recent
suffix:semicolon
)brace
id|inet_putpeer
c_func
(paren
id|peer
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|ipv4_specific
r_struct
id|tcp_func
id|ipv4_specific
op_assign
(brace
dot
id|queue_xmit
op_assign
id|ip_queue_xmit
comma
dot
id|send_check
op_assign
id|tcp_v4_send_check
comma
dot
id|rebuild_header
op_assign
id|tcp_v4_rebuild_header
comma
dot
id|conn_request
op_assign
id|tcp_v4_conn_request
comma
dot
id|syn_recv_sock
op_assign
id|tcp_v4_syn_recv_sock
comma
dot
id|remember_stamp
op_assign
id|tcp_v4_remember_stamp
comma
dot
id|net_header_len
op_assign
r_sizeof
(paren
r_struct
id|iphdr
)paren
comma
dot
id|setsockopt
op_assign
id|ip_setsockopt
comma
dot
id|getsockopt
op_assign
id|ip_getsockopt
comma
dot
id|addr2sockaddr
op_assign
id|v4_addr2sockaddr
comma
dot
id|sockaddr_len
op_assign
r_sizeof
(paren
r_struct
id|sockaddr_in
)paren
comma
)brace
suffix:semicolon
multiline_comment|/* NOTE: A lot of things set to zero explicitly by call to&n; *       sk_alloc() so need not be done here.&n; */
DECL|function|tcp_v4_init_sock
r_static
r_int
id|tcp_v4_init_sock
c_func
(paren
r_struct
id|sock
op_star
id|sk
)paren
(brace
r_struct
id|tcp_opt
op_star
id|tp
op_assign
id|tcp_sk
c_func
(paren
id|sk
)paren
suffix:semicolon
id|skb_queue_head_init
c_func
(paren
op_amp
id|tp-&gt;out_of_order_queue
)paren
suffix:semicolon
id|tcp_init_xmit_timers
c_func
(paren
id|sk
)paren
suffix:semicolon
id|tcp_prequeue_init
c_func
(paren
id|tp
)paren
suffix:semicolon
id|tp-&gt;rto
op_assign
id|TCP_TIMEOUT_INIT
suffix:semicolon
id|tp-&gt;mdev
op_assign
id|TCP_TIMEOUT_INIT
suffix:semicolon
multiline_comment|/* So many TCP implementations out there (incorrectly) count the&n;&t; * initial SYN frame in their delayed-ACK and congestion control&n;&t; * algorithms that we must have the following bandaid to talk&n;&t; * efficiently to them.  -DaveM&n;&t; */
id|tp-&gt;snd_cwnd
op_assign
l_int|2
suffix:semicolon
multiline_comment|/* See draft-stevens-tcpca-spec-01 for discussion of the&n;&t; * initialization of these values.&n;&t; */
id|tp-&gt;snd_ssthresh
op_assign
l_int|0x7fffffff
suffix:semicolon
multiline_comment|/* Infinity */
id|tp-&gt;snd_cwnd_clamp
op_assign
op_complement
l_int|0
suffix:semicolon
id|tp-&gt;mss_cache_std
op_assign
id|tp-&gt;mss_cache
op_assign
l_int|536
suffix:semicolon
id|tp-&gt;reordering
op_assign
id|sysctl_tcp_reordering
suffix:semicolon
id|sk-&gt;sk_state
op_assign
id|TCP_CLOSE
suffix:semicolon
id|sk-&gt;sk_write_space
op_assign
id|sk_stream_write_space
suffix:semicolon
id|sk-&gt;sk_use_write_queue
op_assign
l_int|1
suffix:semicolon
id|tp-&gt;af_specific
op_assign
op_amp
id|ipv4_specific
suffix:semicolon
id|sk-&gt;sk_sndbuf
op_assign
id|sysctl_tcp_wmem
(braket
l_int|1
)braket
suffix:semicolon
id|sk-&gt;sk_rcvbuf
op_assign
id|sysctl_tcp_rmem
(braket
l_int|1
)braket
suffix:semicolon
id|atomic_inc
c_func
(paren
op_amp
id|tcp_sockets_allocated
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|tcp_v4_destroy_sock
r_int
id|tcp_v4_destroy_sock
c_func
(paren
r_struct
id|sock
op_star
id|sk
)paren
(brace
r_struct
id|tcp_opt
op_star
id|tp
op_assign
id|tcp_sk
c_func
(paren
id|sk
)paren
suffix:semicolon
id|tcp_clear_xmit_timers
c_func
(paren
id|sk
)paren
suffix:semicolon
multiline_comment|/* Cleanup up the write buffer. */
id|sk_stream_writequeue_purge
c_func
(paren
id|sk
)paren
suffix:semicolon
multiline_comment|/* Cleans up our, hopefully empty, out_of_order_queue. */
id|__skb_queue_purge
c_func
(paren
op_amp
id|tp-&gt;out_of_order_queue
)paren
suffix:semicolon
multiline_comment|/* Clean prequeue, it must be empty really */
id|__skb_queue_purge
c_func
(paren
op_amp
id|tp-&gt;ucopy.prequeue
)paren
suffix:semicolon
multiline_comment|/* Clean up a referenced TCP bind bucket. */
r_if
c_cond
(paren
id|tp-&gt;bind_hash
)paren
id|tcp_put_port
c_func
(paren
id|sk
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * If sendmsg cached page exists, toss it.&n;&t; */
r_if
c_cond
(paren
id|sk-&gt;sk_sndmsg_page
)paren
(brace
id|__free_page
c_func
(paren
id|sk-&gt;sk_sndmsg_page
)paren
suffix:semicolon
id|sk-&gt;sk_sndmsg_page
op_assign
l_int|NULL
suffix:semicolon
)brace
id|atomic_dec
c_func
(paren
op_amp
id|tcp_sockets_allocated
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|tcp_v4_destroy_sock
id|EXPORT_SYMBOL
c_func
(paren
id|tcp_v4_destroy_sock
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_PROC_FS
multiline_comment|/* Proc filesystem TCP sock list dumping. */
DECL|function|tw_head
r_static
r_inline
r_struct
id|tcp_tw_bucket
op_star
id|tw_head
c_func
(paren
r_struct
id|hlist_head
op_star
id|head
)paren
(brace
r_return
id|hlist_empty
c_func
(paren
id|head
)paren
ques
c_cond
l_int|NULL
suffix:colon
id|list_entry
c_func
(paren
id|head-&gt;first
comma
r_struct
id|tcp_tw_bucket
comma
id|tw_node
)paren
suffix:semicolon
)brace
DECL|function|tw_next
r_static
r_inline
r_struct
id|tcp_tw_bucket
op_star
id|tw_next
c_func
(paren
r_struct
id|tcp_tw_bucket
op_star
id|tw
)paren
(brace
r_return
id|tw-&gt;tw_node.next
ques
c_cond
id|hlist_entry
c_func
(paren
id|tw-&gt;tw_node.next
comma
id|typeof
c_func
(paren
op_star
id|tw
)paren
comma
id|tw_node
)paren
suffix:colon
l_int|NULL
suffix:semicolon
)brace
DECL|function|listening_get_next
r_static
r_void
op_star
id|listening_get_next
c_func
(paren
r_struct
id|seq_file
op_star
id|seq
comma
r_void
op_star
id|cur
)paren
(brace
r_struct
id|tcp_opt
op_star
id|tp
suffix:semicolon
r_struct
id|hlist_node
op_star
id|node
suffix:semicolon
r_struct
id|sock
op_star
id|sk
op_assign
id|cur
suffix:semicolon
r_struct
id|tcp_iter_state
op_star
id|st
op_assign
id|seq
op_member_access_from_pointer
r_private
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sk
)paren
(brace
id|st-&gt;bucket
op_assign
l_int|0
suffix:semicolon
id|sk
op_assign
id|sk_head
c_func
(paren
op_amp
id|tcp_listening_hash
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_goto
id|get_sk
suffix:semicolon
)brace
op_increment
id|st-&gt;num
suffix:semicolon
r_if
c_cond
(paren
id|st-&gt;state
op_eq
id|TCP_SEQ_STATE_OPENREQ
)paren
(brace
r_struct
id|open_request
op_star
id|req
op_assign
id|cur
suffix:semicolon
id|tp
op_assign
id|tcp_sk
c_func
(paren
id|st-&gt;syn_wait_sk
)paren
suffix:semicolon
id|req
op_assign
id|req-&gt;dl_next
suffix:semicolon
r_while
c_loop
(paren
l_int|1
)paren
(brace
r_while
c_loop
(paren
id|req
)paren
(brace
r_if
c_cond
(paren
id|req
op_member_access_from_pointer
r_class
op_member_access_from_pointer
id|family
op_eq
id|st-&gt;family
)paren
(brace
id|cur
op_assign
id|req
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|req
op_assign
id|req-&gt;dl_next
suffix:semicolon
)brace
r_if
c_cond
(paren
op_increment
id|st-&gt;sbucket
op_ge
id|TCP_SYNQ_HSIZE
)paren
r_break
suffix:semicolon
id|get_req
suffix:colon
id|req
op_assign
id|tp-&gt;listen_opt-&gt;syn_table
(braket
id|st-&gt;sbucket
)braket
suffix:semicolon
)brace
id|sk
op_assign
id|sk_next
c_func
(paren
id|st-&gt;syn_wait_sk
)paren
suffix:semicolon
id|st-&gt;state
op_assign
id|TCP_SEQ_STATE_LISTENING
suffix:semicolon
id|read_unlock_bh
c_func
(paren
op_amp
id|tp-&gt;syn_wait_lock
)paren
suffix:semicolon
)brace
r_else
(brace
id|tp
op_assign
id|tcp_sk
c_func
(paren
id|sk
)paren
suffix:semicolon
id|read_lock_bh
c_func
(paren
op_amp
id|tp-&gt;syn_wait_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;listen_opt
op_logical_and
id|tp-&gt;listen_opt-&gt;qlen
)paren
r_goto
id|start_req
suffix:semicolon
id|read_unlock_bh
c_func
(paren
op_amp
id|tp-&gt;syn_wait_lock
)paren
suffix:semicolon
id|sk
op_assign
id|sk_next
c_func
(paren
id|sk
)paren
suffix:semicolon
)brace
id|get_sk
suffix:colon
id|sk_for_each_from
c_func
(paren
id|sk
comma
id|node
)paren
(brace
r_if
c_cond
(paren
id|sk-&gt;sk_family
op_eq
id|st-&gt;family
)paren
(brace
id|cur
op_assign
id|sk
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|tp
op_assign
id|tcp_sk
c_func
(paren
id|sk
)paren
suffix:semicolon
id|read_lock_bh
c_func
(paren
op_amp
id|tp-&gt;syn_wait_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;listen_opt
op_logical_and
id|tp-&gt;listen_opt-&gt;qlen
)paren
(brace
id|start_req
suffix:colon
id|st-&gt;uid
op_assign
id|sock_i_uid
c_func
(paren
id|sk
)paren
suffix:semicolon
id|st-&gt;syn_wait_sk
op_assign
id|sk
suffix:semicolon
id|st-&gt;state
op_assign
id|TCP_SEQ_STATE_OPENREQ
suffix:semicolon
id|st-&gt;sbucket
op_assign
l_int|0
suffix:semicolon
r_goto
id|get_req
suffix:semicolon
)brace
id|read_unlock_bh
c_func
(paren
op_amp
id|tp-&gt;syn_wait_lock
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_increment
id|st-&gt;bucket
OL
id|TCP_LHTABLE_SIZE
)paren
(brace
id|sk
op_assign
id|sk_head
c_func
(paren
op_amp
id|tcp_listening_hash
(braket
id|st-&gt;bucket
)braket
)paren
suffix:semicolon
r_goto
id|get_sk
suffix:semicolon
)brace
id|cur
op_assign
l_int|NULL
suffix:semicolon
id|out
suffix:colon
r_return
id|cur
suffix:semicolon
)brace
DECL|function|listening_get_idx
r_static
r_void
op_star
id|listening_get_idx
c_func
(paren
r_struct
id|seq_file
op_star
id|seq
comma
id|loff_t
op_star
id|pos
)paren
(brace
r_void
op_star
id|rc
op_assign
id|listening_get_next
c_func
(paren
id|seq
comma
l_int|NULL
)paren
suffix:semicolon
r_while
c_loop
(paren
id|rc
op_logical_and
op_star
id|pos
)paren
(brace
id|rc
op_assign
id|listening_get_next
c_func
(paren
id|seq
comma
id|rc
)paren
suffix:semicolon
op_decrement
op_star
id|pos
suffix:semicolon
)brace
r_return
id|rc
suffix:semicolon
)brace
DECL|function|established_get_first
r_static
r_void
op_star
id|established_get_first
c_func
(paren
r_struct
id|seq_file
op_star
id|seq
)paren
(brace
r_struct
id|tcp_iter_state
op_star
id|st
op_assign
id|seq
op_member_access_from_pointer
r_private
suffix:semicolon
r_void
op_star
id|rc
op_assign
l_int|NULL
suffix:semicolon
r_for
c_loop
(paren
id|st-&gt;bucket
op_assign
l_int|0
suffix:semicolon
id|st-&gt;bucket
OL
id|tcp_ehash_size
suffix:semicolon
op_increment
id|st-&gt;bucket
)paren
(brace
r_struct
id|sock
op_star
id|sk
suffix:semicolon
r_struct
id|hlist_node
op_star
id|node
suffix:semicolon
r_struct
id|tcp_tw_bucket
op_star
id|tw
suffix:semicolon
multiline_comment|/* We can reschedule _before_ having picked the target: */
id|cond_resched_softirq
c_func
(paren
)paren
suffix:semicolon
id|read_lock
c_func
(paren
op_amp
id|tcp_ehash
(braket
id|st-&gt;bucket
)braket
dot
id|lock
)paren
suffix:semicolon
id|sk_for_each
c_func
(paren
id|sk
comma
id|node
comma
op_amp
id|tcp_ehash
(braket
id|st-&gt;bucket
)braket
dot
id|chain
)paren
(brace
r_if
c_cond
(paren
id|sk-&gt;sk_family
op_ne
id|st-&gt;family
)paren
(brace
r_continue
suffix:semicolon
)brace
id|rc
op_assign
id|sk
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|st-&gt;state
op_assign
id|TCP_SEQ_STATE_TIME_WAIT
suffix:semicolon
id|tw_for_each
c_func
(paren
id|tw
comma
id|node
comma
op_amp
id|tcp_ehash
(braket
id|st-&gt;bucket
op_plus
id|tcp_ehash_size
)braket
dot
id|chain
)paren
(brace
r_if
c_cond
(paren
id|tw-&gt;tw_family
op_ne
id|st-&gt;family
)paren
(brace
r_continue
suffix:semicolon
)brace
id|rc
op_assign
id|tw
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|read_unlock
c_func
(paren
op_amp
id|tcp_ehash
(braket
id|st-&gt;bucket
)braket
dot
id|lock
)paren
suffix:semicolon
id|st-&gt;state
op_assign
id|TCP_SEQ_STATE_ESTABLISHED
suffix:semicolon
)brace
id|out
suffix:colon
r_return
id|rc
suffix:semicolon
)brace
DECL|function|established_get_next
r_static
r_void
op_star
id|established_get_next
c_func
(paren
r_struct
id|seq_file
op_star
id|seq
comma
r_void
op_star
id|cur
)paren
(brace
r_struct
id|sock
op_star
id|sk
op_assign
id|cur
suffix:semicolon
r_struct
id|tcp_tw_bucket
op_star
id|tw
suffix:semicolon
r_struct
id|hlist_node
op_star
id|node
suffix:semicolon
r_struct
id|tcp_iter_state
op_star
id|st
op_assign
id|seq
op_member_access_from_pointer
r_private
suffix:semicolon
op_increment
id|st-&gt;num
suffix:semicolon
r_if
c_cond
(paren
id|st-&gt;state
op_eq
id|TCP_SEQ_STATE_TIME_WAIT
)paren
(brace
id|tw
op_assign
id|cur
suffix:semicolon
id|tw
op_assign
id|tw_next
c_func
(paren
id|tw
)paren
suffix:semicolon
id|get_tw
suffix:colon
r_while
c_loop
(paren
id|tw
op_logical_and
id|tw-&gt;tw_family
op_ne
id|st-&gt;family
)paren
(brace
id|tw
op_assign
id|tw_next
c_func
(paren
id|tw
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|tw
)paren
(brace
id|cur
op_assign
id|tw
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|read_unlock
c_func
(paren
op_amp
id|tcp_ehash
(braket
id|st-&gt;bucket
)braket
dot
id|lock
)paren
suffix:semicolon
id|st-&gt;state
op_assign
id|TCP_SEQ_STATE_ESTABLISHED
suffix:semicolon
multiline_comment|/* We can reschedule between buckets: */
id|cond_resched_softirq
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_increment
id|st-&gt;bucket
OL
id|tcp_ehash_size
)paren
(brace
id|read_lock
c_func
(paren
op_amp
id|tcp_ehash
(braket
id|st-&gt;bucket
)braket
dot
id|lock
)paren
suffix:semicolon
id|sk
op_assign
id|sk_head
c_func
(paren
op_amp
id|tcp_ehash
(braket
id|st-&gt;bucket
)braket
dot
id|chain
)paren
suffix:semicolon
)brace
r_else
(brace
id|cur
op_assign
l_int|NULL
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
)brace
r_else
id|sk
op_assign
id|sk_next
c_func
(paren
id|sk
)paren
suffix:semicolon
id|sk_for_each_from
c_func
(paren
id|sk
comma
id|node
)paren
(brace
r_if
c_cond
(paren
id|sk-&gt;sk_family
op_eq
id|st-&gt;family
)paren
r_goto
id|found
suffix:semicolon
)brace
id|st-&gt;state
op_assign
id|TCP_SEQ_STATE_TIME_WAIT
suffix:semicolon
id|tw
op_assign
id|tw_head
c_func
(paren
op_amp
id|tcp_ehash
(braket
id|st-&gt;bucket
op_plus
id|tcp_ehash_size
)braket
dot
id|chain
)paren
suffix:semicolon
r_goto
id|get_tw
suffix:semicolon
id|found
suffix:colon
id|cur
op_assign
id|sk
suffix:semicolon
id|out
suffix:colon
r_return
id|cur
suffix:semicolon
)brace
DECL|function|established_get_idx
r_static
r_void
op_star
id|established_get_idx
c_func
(paren
r_struct
id|seq_file
op_star
id|seq
comma
id|loff_t
id|pos
)paren
(brace
r_void
op_star
id|rc
op_assign
id|established_get_first
c_func
(paren
id|seq
)paren
suffix:semicolon
r_while
c_loop
(paren
id|rc
op_logical_and
id|pos
)paren
(brace
id|rc
op_assign
id|established_get_next
c_func
(paren
id|seq
comma
id|rc
)paren
suffix:semicolon
op_decrement
id|pos
suffix:semicolon
)brace
r_return
id|rc
suffix:semicolon
)brace
DECL|function|tcp_get_idx
r_static
r_void
op_star
id|tcp_get_idx
c_func
(paren
r_struct
id|seq_file
op_star
id|seq
comma
id|loff_t
id|pos
)paren
(brace
r_void
op_star
id|rc
suffix:semicolon
r_struct
id|tcp_iter_state
op_star
id|st
op_assign
id|seq
op_member_access_from_pointer
r_private
suffix:semicolon
id|tcp_listen_lock
c_func
(paren
)paren
suffix:semicolon
id|st-&gt;state
op_assign
id|TCP_SEQ_STATE_LISTENING
suffix:semicolon
id|rc
op_assign
id|listening_get_idx
c_func
(paren
id|seq
comma
op_amp
id|pos
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|rc
)paren
(brace
id|tcp_listen_unlock
c_func
(paren
)paren
suffix:semicolon
id|local_bh_disable
c_func
(paren
)paren
suffix:semicolon
id|st-&gt;state
op_assign
id|TCP_SEQ_STATE_ESTABLISHED
suffix:semicolon
id|rc
op_assign
id|established_get_idx
c_func
(paren
id|seq
comma
id|pos
)paren
suffix:semicolon
)brace
r_return
id|rc
suffix:semicolon
)brace
DECL|function|tcp_seq_start
r_static
r_void
op_star
id|tcp_seq_start
c_func
(paren
r_struct
id|seq_file
op_star
id|seq
comma
id|loff_t
op_star
id|pos
)paren
(brace
r_struct
id|tcp_iter_state
op_star
id|st
op_assign
id|seq
op_member_access_from_pointer
r_private
suffix:semicolon
id|st-&gt;state
op_assign
id|TCP_SEQ_STATE_LISTENING
suffix:semicolon
id|st-&gt;num
op_assign
l_int|0
suffix:semicolon
r_return
op_star
id|pos
ques
c_cond
id|tcp_get_idx
c_func
(paren
id|seq
comma
op_star
id|pos
op_minus
l_int|1
)paren
suffix:colon
id|SEQ_START_TOKEN
suffix:semicolon
)brace
DECL|function|tcp_seq_next
r_static
r_void
op_star
id|tcp_seq_next
c_func
(paren
r_struct
id|seq_file
op_star
id|seq
comma
r_void
op_star
id|v
comma
id|loff_t
op_star
id|pos
)paren
(brace
r_void
op_star
id|rc
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|tcp_iter_state
op_star
id|st
suffix:semicolon
r_if
c_cond
(paren
id|v
op_eq
id|SEQ_START_TOKEN
)paren
(brace
id|rc
op_assign
id|tcp_get_idx
c_func
(paren
id|seq
comma
l_int|0
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|st
op_assign
id|seq
op_member_access_from_pointer
r_private
suffix:semicolon
r_switch
c_cond
(paren
id|st-&gt;state
)paren
(brace
r_case
id|TCP_SEQ_STATE_OPENREQ
suffix:colon
r_case
id|TCP_SEQ_STATE_LISTENING
suffix:colon
id|rc
op_assign
id|listening_get_next
c_func
(paren
id|seq
comma
id|v
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|rc
)paren
(brace
id|tcp_listen_unlock
c_func
(paren
)paren
suffix:semicolon
id|local_bh_disable
c_func
(paren
)paren
suffix:semicolon
id|st-&gt;state
op_assign
id|TCP_SEQ_STATE_ESTABLISHED
suffix:semicolon
id|rc
op_assign
id|established_get_first
c_func
(paren
id|seq
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|TCP_SEQ_STATE_ESTABLISHED
suffix:colon
r_case
id|TCP_SEQ_STATE_TIME_WAIT
suffix:colon
id|rc
op_assign
id|established_get_next
c_func
(paren
id|seq
comma
id|v
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|out
suffix:colon
op_increment
op_star
id|pos
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
DECL|function|tcp_seq_stop
r_static
r_void
id|tcp_seq_stop
c_func
(paren
r_struct
id|seq_file
op_star
id|seq
comma
r_void
op_star
id|v
)paren
(brace
r_struct
id|tcp_iter_state
op_star
id|st
op_assign
id|seq
op_member_access_from_pointer
r_private
suffix:semicolon
r_switch
c_cond
(paren
id|st-&gt;state
)paren
(brace
r_case
id|TCP_SEQ_STATE_OPENREQ
suffix:colon
r_if
c_cond
(paren
id|v
)paren
(brace
r_struct
id|tcp_opt
op_star
id|tp
op_assign
id|tcp_sk
c_func
(paren
id|st-&gt;syn_wait_sk
)paren
suffix:semicolon
id|read_unlock_bh
c_func
(paren
op_amp
id|tp-&gt;syn_wait_lock
)paren
suffix:semicolon
)brace
r_case
id|TCP_SEQ_STATE_LISTENING
suffix:colon
r_if
c_cond
(paren
id|v
op_ne
id|SEQ_START_TOKEN
)paren
id|tcp_listen_unlock
c_func
(paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|TCP_SEQ_STATE_TIME_WAIT
suffix:colon
r_case
id|TCP_SEQ_STATE_ESTABLISHED
suffix:colon
r_if
c_cond
(paren
id|v
)paren
id|read_unlock
c_func
(paren
op_amp
id|tcp_ehash
(braket
id|st-&gt;bucket
)braket
dot
id|lock
)paren
suffix:semicolon
id|local_bh_enable
c_func
(paren
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
DECL|function|tcp_seq_open
r_static
r_int
id|tcp_seq_open
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
(brace
r_struct
id|tcp_seq_afinfo
op_star
id|afinfo
op_assign
id|PDE
c_func
(paren
id|inode
)paren
op_member_access_from_pointer
id|data
suffix:semicolon
r_struct
id|seq_file
op_star
id|seq
suffix:semicolon
r_struct
id|tcp_iter_state
op_star
id|s
suffix:semicolon
r_int
id|rc
suffix:semicolon
r_if
c_cond
(paren
id|unlikely
c_func
(paren
id|afinfo
op_eq
l_int|NULL
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|s
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|s
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|s
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|memset
c_func
(paren
id|s
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|s
)paren
)paren
suffix:semicolon
id|s-&gt;family
op_assign
id|afinfo-&gt;family
suffix:semicolon
id|s-&gt;seq_ops.start
op_assign
id|tcp_seq_start
suffix:semicolon
id|s-&gt;seq_ops.next
op_assign
id|tcp_seq_next
suffix:semicolon
id|s-&gt;seq_ops.show
op_assign
id|afinfo-&gt;seq_show
suffix:semicolon
id|s-&gt;seq_ops.stop
op_assign
id|tcp_seq_stop
suffix:semicolon
id|rc
op_assign
id|seq_open
c_func
(paren
id|file
comma
op_amp
id|s-&gt;seq_ops
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_goto
id|out_kfree
suffix:semicolon
id|seq
op_assign
id|file-&gt;private_data
suffix:semicolon
id|seq
op_member_access_from_pointer
r_private
op_assign
id|s
suffix:semicolon
id|out
suffix:colon
r_return
id|rc
suffix:semicolon
id|out_kfree
suffix:colon
id|kfree
c_func
(paren
id|s
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
DECL|function|tcp_proc_register
r_int
id|tcp_proc_register
c_func
(paren
r_struct
id|tcp_seq_afinfo
op_star
id|afinfo
)paren
(brace
r_int
id|rc
op_assign
l_int|0
suffix:semicolon
r_struct
id|proc_dir_entry
op_star
id|p
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|afinfo
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|afinfo-&gt;seq_fops-&gt;owner
op_assign
id|afinfo-&gt;owner
suffix:semicolon
id|afinfo-&gt;seq_fops-&gt;open
op_assign
id|tcp_seq_open
suffix:semicolon
id|afinfo-&gt;seq_fops-&gt;read
op_assign
id|seq_read
suffix:semicolon
id|afinfo-&gt;seq_fops-&gt;llseek
op_assign
id|seq_lseek
suffix:semicolon
id|afinfo-&gt;seq_fops-&gt;release
op_assign
id|seq_release_private
suffix:semicolon
id|p
op_assign
id|proc_net_fops_create
c_func
(paren
id|afinfo-&gt;name
comma
id|S_IRUGO
comma
id|afinfo-&gt;seq_fops
)paren
suffix:semicolon
r_if
c_cond
(paren
id|p
)paren
id|p-&gt;data
op_assign
id|afinfo
suffix:semicolon
r_else
id|rc
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
DECL|function|tcp_proc_unregister
r_void
id|tcp_proc_unregister
c_func
(paren
r_struct
id|tcp_seq_afinfo
op_star
id|afinfo
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|afinfo
)paren
r_return
suffix:semicolon
id|proc_net_remove
c_func
(paren
id|afinfo-&gt;name
)paren
suffix:semicolon
id|memset
c_func
(paren
id|afinfo-&gt;seq_fops
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|afinfo-&gt;seq_fops
)paren
)paren
suffix:semicolon
)brace
DECL|function|get_openreq4
r_static
r_void
id|get_openreq4
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_struct
id|open_request
op_star
id|req
comma
r_char
op_star
id|tmpbuf
comma
r_int
id|i
comma
r_int
id|uid
)paren
(brace
r_int
id|ttd
op_assign
id|req-&gt;expires
op_minus
id|jiffies
suffix:semicolon
id|sprintf
c_func
(paren
id|tmpbuf
comma
l_string|&quot;%4d: %08X:%04X %08X:%04X&quot;
l_string|&quot; %02X %08X:%08X %02X:%08lX %08X %5d %8d %u %d %p&quot;
comma
id|i
comma
id|req-&gt;af.v4_req.loc_addr
comma
id|ntohs
c_func
(paren
id|inet_sk
c_func
(paren
id|sk
)paren
op_member_access_from_pointer
id|sport
)paren
comma
id|req-&gt;af.v4_req.rmt_addr
comma
id|ntohs
c_func
(paren
id|req-&gt;rmt_port
)paren
comma
id|TCP_SYN_RECV
comma
l_int|0
comma
l_int|0
comma
multiline_comment|/* could print option size, but that is af dependent. */
l_int|1
comma
multiline_comment|/* timers active (only the expire timer) */
id|jiffies_to_clock_t
c_func
(paren
id|ttd
)paren
comma
id|req-&gt;retrans
comma
id|uid
comma
l_int|0
comma
multiline_comment|/* non standard timer */
l_int|0
comma
multiline_comment|/* open_requests have no inode */
id|atomic_read
c_func
(paren
op_amp
id|sk-&gt;sk_refcnt
)paren
comma
id|req
)paren
suffix:semicolon
)brace
DECL|function|get_tcp4_sock
r_static
r_void
id|get_tcp4_sock
c_func
(paren
r_struct
id|sock
op_star
id|sp
comma
r_char
op_star
id|tmpbuf
comma
r_int
id|i
)paren
(brace
r_int
id|timer_active
suffix:semicolon
r_int
r_int
id|timer_expires
suffix:semicolon
r_struct
id|tcp_opt
op_star
id|tp
op_assign
id|tcp_sk
c_func
(paren
id|sp
)paren
suffix:semicolon
r_struct
id|inet_sock
op_star
id|inet
op_assign
id|inet_sk
c_func
(paren
id|sp
)paren
suffix:semicolon
r_int
r_int
id|dest
op_assign
id|inet-&gt;daddr
suffix:semicolon
r_int
r_int
id|src
op_assign
id|inet-&gt;rcv_saddr
suffix:semicolon
id|__u16
id|destp
op_assign
id|ntohs
c_func
(paren
id|inet-&gt;dport
)paren
suffix:semicolon
id|__u16
id|srcp
op_assign
id|ntohs
c_func
(paren
id|inet-&gt;sport
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;pending
op_eq
id|TCP_TIME_RETRANS
)paren
(brace
id|timer_active
op_assign
l_int|1
suffix:semicolon
id|timer_expires
op_assign
id|tp-&gt;timeout
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|tp-&gt;pending
op_eq
id|TCP_TIME_PROBE0
)paren
(brace
id|timer_active
op_assign
l_int|4
suffix:semicolon
id|timer_expires
op_assign
id|tp-&gt;timeout
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|timer_pending
c_func
(paren
op_amp
id|sp-&gt;sk_timer
)paren
)paren
(brace
id|timer_active
op_assign
l_int|2
suffix:semicolon
id|timer_expires
op_assign
id|sp-&gt;sk_timer.expires
suffix:semicolon
)brace
r_else
(brace
id|timer_active
op_assign
l_int|0
suffix:semicolon
id|timer_expires
op_assign
id|jiffies
suffix:semicolon
)brace
id|sprintf
c_func
(paren
id|tmpbuf
comma
l_string|&quot;%4d: %08X:%04X %08X:%04X %02X %08X:%08X %02X:%08lX &quot;
l_string|&quot;%08X %5d %8d %lu %d %p %u %u %u %u %d&quot;
comma
id|i
comma
id|src
comma
id|srcp
comma
id|dest
comma
id|destp
comma
id|sp-&gt;sk_state
comma
id|tp-&gt;write_seq
op_minus
id|tp-&gt;snd_una
comma
id|tp-&gt;rcv_nxt
op_minus
id|tp-&gt;copied_seq
comma
id|timer_active
comma
id|jiffies_to_clock_t
c_func
(paren
id|timer_expires
op_minus
id|jiffies
)paren
comma
id|tp-&gt;retransmits
comma
id|sock_i_uid
c_func
(paren
id|sp
)paren
comma
id|tp-&gt;probes_out
comma
id|sock_i_ino
c_func
(paren
id|sp
)paren
comma
id|atomic_read
c_func
(paren
op_amp
id|sp-&gt;sk_refcnt
)paren
comma
id|sp
comma
id|tp-&gt;rto
comma
id|tp-&gt;ack.ato
comma
(paren
id|tp-&gt;ack.quick
op_lshift
l_int|1
)paren
op_or
id|tp-&gt;ack.pingpong
comma
id|tp-&gt;snd_cwnd
comma
id|tp-&gt;snd_ssthresh
op_ge
l_int|0xFFFF
ques
c_cond
op_minus
l_int|1
suffix:colon
id|tp-&gt;snd_ssthresh
)paren
suffix:semicolon
)brace
DECL|function|get_timewait4_sock
r_static
r_void
id|get_timewait4_sock
c_func
(paren
r_struct
id|tcp_tw_bucket
op_star
id|tw
comma
r_char
op_star
id|tmpbuf
comma
r_int
id|i
)paren
(brace
r_int
r_int
id|dest
comma
id|src
suffix:semicolon
id|__u16
id|destp
comma
id|srcp
suffix:semicolon
r_int
id|ttd
op_assign
id|tw-&gt;tw_ttd
op_minus
id|jiffies
suffix:semicolon
r_if
c_cond
(paren
id|ttd
OL
l_int|0
)paren
id|ttd
op_assign
l_int|0
suffix:semicolon
id|dest
op_assign
id|tw-&gt;tw_daddr
suffix:semicolon
id|src
op_assign
id|tw-&gt;tw_rcv_saddr
suffix:semicolon
id|destp
op_assign
id|ntohs
c_func
(paren
id|tw-&gt;tw_dport
)paren
suffix:semicolon
id|srcp
op_assign
id|ntohs
c_func
(paren
id|tw-&gt;tw_sport
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|tmpbuf
comma
l_string|&quot;%4d: %08X:%04X %08X:%04X&quot;
l_string|&quot; %02X %08X:%08X %02X:%08lX %08X %5d %8d %d %d %p&quot;
comma
id|i
comma
id|src
comma
id|srcp
comma
id|dest
comma
id|destp
comma
id|tw-&gt;tw_substate
comma
l_int|0
comma
l_int|0
comma
l_int|3
comma
id|jiffies_to_clock_t
c_func
(paren
id|ttd
)paren
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
id|atomic_read
c_func
(paren
op_amp
id|tw-&gt;tw_refcnt
)paren
comma
id|tw
)paren
suffix:semicolon
)brace
DECL|macro|TMPSZ
mdefine_line|#define TMPSZ 150
DECL|function|tcp4_seq_show
r_static
r_int
id|tcp4_seq_show
c_func
(paren
r_struct
id|seq_file
op_star
id|seq
comma
r_void
op_star
id|v
)paren
(brace
r_struct
id|tcp_iter_state
op_star
id|st
suffix:semicolon
r_char
id|tmpbuf
(braket
id|TMPSZ
op_plus
l_int|1
)braket
suffix:semicolon
r_if
c_cond
(paren
id|v
op_eq
id|SEQ_START_TOKEN
)paren
(brace
id|seq_printf
c_func
(paren
id|seq
comma
l_string|&quot;%-*s&bslash;n&quot;
comma
id|TMPSZ
op_minus
l_int|1
comma
l_string|&quot;  sl  local_address rem_address   st tx_queue &quot;
l_string|&quot;rx_queue tr tm-&gt;when retrnsmt   uid  timeout &quot;
l_string|&quot;inode&quot;
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|st
op_assign
id|seq
op_member_access_from_pointer
r_private
suffix:semicolon
r_switch
c_cond
(paren
id|st-&gt;state
)paren
(brace
r_case
id|TCP_SEQ_STATE_LISTENING
suffix:colon
r_case
id|TCP_SEQ_STATE_ESTABLISHED
suffix:colon
id|get_tcp4_sock
c_func
(paren
id|v
comma
id|tmpbuf
comma
id|st-&gt;num
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|TCP_SEQ_STATE_OPENREQ
suffix:colon
id|get_openreq4
c_func
(paren
id|st-&gt;syn_wait_sk
comma
id|v
comma
id|tmpbuf
comma
id|st-&gt;num
comma
id|st-&gt;uid
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|TCP_SEQ_STATE_TIME_WAIT
suffix:colon
id|get_timewait4_sock
c_func
(paren
id|v
comma
id|tmpbuf
comma
id|st-&gt;num
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|seq_printf
c_func
(paren
id|seq
comma
l_string|&quot;%-*s&bslash;n&quot;
comma
id|TMPSZ
op_minus
l_int|1
comma
id|tmpbuf
)paren
suffix:semicolon
id|out
suffix:colon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|tcp4_seq_fops
r_static
r_struct
id|file_operations
id|tcp4_seq_fops
suffix:semicolon
DECL|variable|tcp4_seq_afinfo
r_static
r_struct
id|tcp_seq_afinfo
id|tcp4_seq_afinfo
op_assign
(brace
dot
id|owner
op_assign
id|THIS_MODULE
comma
dot
id|name
op_assign
l_string|&quot;tcp&quot;
comma
dot
id|family
op_assign
id|AF_INET
comma
dot
id|seq_show
op_assign
id|tcp4_seq_show
comma
dot
id|seq_fops
op_assign
op_amp
id|tcp4_seq_fops
comma
)brace
suffix:semicolon
DECL|function|tcp4_proc_init
r_int
id|__init
id|tcp4_proc_init
c_func
(paren
r_void
)paren
(brace
r_return
id|tcp_proc_register
c_func
(paren
op_amp
id|tcp4_seq_afinfo
)paren
suffix:semicolon
)brace
DECL|function|tcp4_proc_exit
r_void
id|tcp4_proc_exit
c_func
(paren
r_void
)paren
(brace
id|tcp_proc_unregister
c_func
(paren
op_amp
id|tcp4_seq_afinfo
)paren
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_PROC_FS */
DECL|variable|tcp_prot
r_struct
id|proto
id|tcp_prot
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;TCP&quot;
comma
dot
id|owner
op_assign
id|THIS_MODULE
comma
dot
id|close
op_assign
id|tcp_close
comma
dot
id|connect
op_assign
id|tcp_v4_connect
comma
dot
id|disconnect
op_assign
id|tcp_disconnect
comma
dot
id|accept
op_assign
id|tcp_accept
comma
dot
id|ioctl
op_assign
id|tcp_ioctl
comma
dot
id|init
op_assign
id|tcp_v4_init_sock
comma
dot
id|destroy
op_assign
id|tcp_v4_destroy_sock
comma
dot
id|shutdown
op_assign
id|tcp_shutdown
comma
dot
id|setsockopt
op_assign
id|tcp_setsockopt
comma
dot
id|getsockopt
op_assign
id|tcp_getsockopt
comma
dot
id|sendmsg
op_assign
id|tcp_sendmsg
comma
dot
id|recvmsg
op_assign
id|tcp_recvmsg
comma
dot
id|backlog_rcv
op_assign
id|tcp_v4_do_rcv
comma
dot
id|hash
op_assign
id|tcp_v4_hash
comma
dot
id|unhash
op_assign
id|tcp_unhash
comma
dot
id|get_port
op_assign
id|tcp_v4_get_port
comma
dot
id|enter_memory_pressure
op_assign
id|tcp_enter_memory_pressure
comma
dot
id|sockets_allocated
op_assign
op_amp
id|tcp_sockets_allocated
comma
dot
id|memory_allocated
op_assign
op_amp
id|tcp_memory_allocated
comma
dot
id|memory_pressure
op_assign
op_amp
id|tcp_memory_pressure
comma
dot
id|sysctl_mem
op_assign
id|sysctl_tcp_mem
comma
dot
id|sysctl_wmem
op_assign
id|sysctl_tcp_wmem
comma
dot
id|sysctl_rmem
op_assign
id|sysctl_tcp_rmem
comma
dot
id|max_header
op_assign
id|MAX_TCP_HEADER
comma
dot
id|slab_obj_size
op_assign
r_sizeof
(paren
r_struct
id|tcp_sock
)paren
comma
)brace
suffix:semicolon
DECL|function|tcp_v4_init
r_void
id|__init
id|tcp_v4_init
c_func
(paren
r_struct
id|net_proto_family
op_star
id|ops
)paren
(brace
r_int
id|err
op_assign
id|sock_create_kern
c_func
(paren
id|PF_INET
comma
id|SOCK_RAW
comma
id|IPPROTO_TCP
comma
op_amp
id|tcp_socket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
id|panic
c_func
(paren
l_string|&quot;Failed to create the TCP control socket.&bslash;n&quot;
)paren
suffix:semicolon
id|tcp_socket-&gt;sk-&gt;sk_allocation
op_assign
id|GFP_ATOMIC
suffix:semicolon
id|inet_sk
c_func
(paren
id|tcp_socket-&gt;sk
)paren
op_member_access_from_pointer
id|uc_ttl
op_assign
op_minus
l_int|1
suffix:semicolon
multiline_comment|/* Unhash it so that IP input processing does not even&n;&t; * see it, we do not wish this socket to see incoming&n;&t; * packets.&n;&t; */
id|tcp_socket-&gt;sk-&gt;sk_prot
op_member_access_from_pointer
id|unhash
c_func
(paren
id|tcp_socket-&gt;sk
)paren
suffix:semicolon
)brace
DECL|variable|ipv4_specific
id|EXPORT_SYMBOL
c_func
(paren
id|ipv4_specific
)paren
suffix:semicolon
DECL|variable|tcp_bind_hash
id|EXPORT_SYMBOL
c_func
(paren
id|tcp_bind_hash
)paren
suffix:semicolon
DECL|variable|tcp_bucket_create
id|EXPORT_SYMBOL
c_func
(paren
id|tcp_bucket_create
)paren
suffix:semicolon
DECL|variable|tcp_hashinfo
id|EXPORT_SYMBOL
c_func
(paren
id|tcp_hashinfo
)paren
suffix:semicolon
DECL|variable|tcp_inherit_port
id|EXPORT_SYMBOL
c_func
(paren
id|tcp_inherit_port
)paren
suffix:semicolon
DECL|variable|tcp_listen_wlock
id|EXPORT_SYMBOL
c_func
(paren
id|tcp_listen_wlock
)paren
suffix:semicolon
DECL|variable|tcp_port_rover
id|EXPORT_SYMBOL
c_func
(paren
id|tcp_port_rover
)paren
suffix:semicolon
DECL|variable|tcp_prot
id|EXPORT_SYMBOL
c_func
(paren
id|tcp_prot
)paren
suffix:semicolon
DECL|variable|tcp_put_port
id|EXPORT_SYMBOL
c_func
(paren
id|tcp_put_port
)paren
suffix:semicolon
DECL|variable|tcp_unhash
id|EXPORT_SYMBOL
c_func
(paren
id|tcp_unhash
)paren
suffix:semicolon
DECL|variable|tcp_v4_conn_request
id|EXPORT_SYMBOL
c_func
(paren
id|tcp_v4_conn_request
)paren
suffix:semicolon
DECL|variable|tcp_v4_connect
id|EXPORT_SYMBOL
c_func
(paren
id|tcp_v4_connect
)paren
suffix:semicolon
DECL|variable|tcp_v4_do_rcv
id|EXPORT_SYMBOL
c_func
(paren
id|tcp_v4_do_rcv
)paren
suffix:semicolon
DECL|variable|tcp_v4_rebuild_header
id|EXPORT_SYMBOL
c_func
(paren
id|tcp_v4_rebuild_header
)paren
suffix:semicolon
DECL|variable|tcp_v4_remember_stamp
id|EXPORT_SYMBOL
c_func
(paren
id|tcp_v4_remember_stamp
)paren
suffix:semicolon
DECL|variable|tcp_v4_send_check
id|EXPORT_SYMBOL
c_func
(paren
id|tcp_v4_send_check
)paren
suffix:semicolon
DECL|variable|tcp_v4_syn_recv_sock
id|EXPORT_SYMBOL
c_func
(paren
id|tcp_v4_syn_recv_sock
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_PROC_FS
DECL|variable|tcp_proc_register
id|EXPORT_SYMBOL
c_func
(paren
id|tcp_proc_register
)paren
suffix:semicolon
DECL|variable|tcp_proc_unregister
id|EXPORT_SYMBOL
c_func
(paren
id|tcp_proc_unregister
)paren
suffix:semicolon
macro_line|#endif
DECL|variable|sysctl_local_port_range
id|EXPORT_SYMBOL
c_func
(paren
id|sysctl_local_port_range
)paren
suffix:semicolon
DECL|variable|sysctl_max_syn_backlog
id|EXPORT_SYMBOL
c_func
(paren
id|sysctl_max_syn_backlog
)paren
suffix:semicolon
DECL|variable|sysctl_tcp_low_latency
id|EXPORT_SYMBOL
c_func
(paren
id|sysctl_tcp_low_latency
)paren
suffix:semicolon
eof
