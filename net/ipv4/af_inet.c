multiline_comment|/*&n; * INET&t;&t;An implementation of the TCP/IP protocol suite for the LINUX&n; *&t;&t;operating system.  INET is implemented using the  BSD Socket&n; *&t;&t;interface as the means of communication with the user level.&n; *&n; *&t;&t;PF_INET protocol family socket handler.&n; *&n; * Version:&t;$Id: af_inet.c,v 1.137 2002/02/01 22:01:03 davem Exp $&n; *&n; * Authors:&t;Ross Biro, &lt;bir7@leland.Stanford.Edu&gt;&n; *&t;&t;Fred N. van Kempen, &lt;waltje@uWalt.NL.Mugnet.ORG&gt;&n; *&t;&t;Florian La Roche, &lt;flla@stud.uni-sb.de&gt;&n; *&t;&t;Alan Cox, &lt;A.Cox@swansea.ac.uk&gt;&n; *&n; * Changes (see also sock.c)&n; *&n; *&t;&t;piggy,&n; *&t;&t;Karl Knutson&t;:&t;Socket protocol table&n; *&t;&t;A.N.Kuznetsov&t;:&t;Socket death error in accept().&n; *&t;&t;John Richardson :&t;Fix non blocking error in connect()&n; *&t;&t;&t;&t;&t;so sockets that fail to connect&n; *&t;&t;&t;&t;&t;don&squot;t return -EINPROGRESS.&n; *&t;&t;Alan Cox&t;:&t;Asynchronous I/O support&n; *&t;&t;Alan Cox&t;:&t;Keep correct socket pointer on sock&n; *&t;&t;&t;&t;&t;structures&n; *&t;&t;&t;&t;&t;when accept() ed&n; *&t;&t;Alan Cox&t;:&t;Semantics of SO_LINGER aren&squot;t state&n; *&t;&t;&t;&t;&t;moved to close when you look carefully.&n; *&t;&t;&t;&t;&t;With this fixed and the accept bug fixed&n; *&t;&t;&t;&t;&t;some RPC stuff seems happier.&n; *&t;&t;Niibe Yutaka&t;:&t;4.4BSD style write async I/O&n; *&t;&t;Alan Cox,&n; *&t;&t;Tony Gale &t;:&t;Fixed reuse semantics.&n; *&t;&t;Alan Cox&t;:&t;bind() shouldn&squot;t abort existing but dead&n; *&t;&t;&t;&t;&t;sockets. Stops FTP netin:.. I hope.&n; *&t;&t;Alan Cox&t;:&t;bind() works correctly for RAW sockets.&n; *&t;&t;&t;&t;&t;Note that FreeBSD at least was broken&n; *&t;&t;&t;&t;&t;in this respect so be careful with&n; *&t;&t;&t;&t;&t;compatibility tests...&n; *&t;&t;Alan Cox&t;:&t;routing cache support&n; *&t;&t;Alan Cox&t;:&t;memzero the socket structure for&n; *&t;&t;&t;&t;&t;compactness.&n; *&t;&t;Matt Day&t;:&t;nonblock connect error handler&n; *&t;&t;Alan Cox&t;:&t;Allow large numbers of pending sockets&n; *&t;&t;&t;&t;&t;(eg for big web sites), but only if&n; *&t;&t;&t;&t;&t;specifically application requested.&n; *&t;&t;Alan Cox&t;:&t;New buffering throughout IP. Used&n; *&t;&t;&t;&t;&t;dumbly.&n; *&t;&t;Alan Cox&t;:&t;New buffering now used smartly.&n; *&t;&t;Alan Cox&t;:&t;BSD rather than common sense&n; *&t;&t;&t;&t;&t;interpretation of listen.&n; *&t;&t;Germano Caronni&t;:&t;Assorted small races.&n; *&t;&t;Alan Cox&t;:&t;sendmsg/recvmsg basic support.&n; *&t;&t;Alan Cox&t;:&t;Only sendmsg/recvmsg now supported.&n; *&t;&t;Alan Cox&t;:&t;Locked down bind (see security list).&n; *&t;&t;Alan Cox&t;:&t;Loosened bind a little.&n; *&t;&t;Mike McLagan&t;:&t;ADD/DEL DLCI Ioctls&n; *&t;Willy Konynenberg&t;:&t;Transparent proxying support.&n; *&t;&t;David S. Miller&t;:&t;New socket lookup architecture.&n; *&t;&t;&t;&t;&t;Some other random speedups.&n; *&t;&t;Cyrus Durgin&t;:&t;Cleaned up file for kmod hacks.&n; *&t;&t;Andi Kleen&t;:&t;Fix inet_stream_connect TCP race.&n; *&n; *&t;&t;This program is free software; you can redistribute it and/or&n; *&t;&t;modify it under the terms of the GNU General Public License&n; *&t;&t;as published by the Free Software Foundation; either version&n; *&t;&t;2 of the License, or (at your option) any later version.&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/socket.h&gt;
macro_line|#include &lt;linux/in.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/major.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/timer.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/sockios.h&gt;
macro_line|#include &lt;linux/net.h&gt;
macro_line|#include &lt;linux/fcntl.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/stat.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/poll.h&gt;
macro_line|#include &lt;linux/netfilter_ipv4.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;asm/system.h&gt;
macro_line|#include &lt;linux/smp_lock.h&gt;
macro_line|#include &lt;linux/inet.h&gt;
macro_line|#include &lt;linux/igmp.h&gt;
macro_line|#include &lt;linux/netdevice.h&gt;
macro_line|#include &lt;net/ip.h&gt;
macro_line|#include &lt;net/protocol.h&gt;
macro_line|#include &lt;net/arp.h&gt;
macro_line|#include &lt;net/route.h&gt;
macro_line|#include &lt;net/ip_fib.h&gt;
macro_line|#include &lt;net/tcp.h&gt;
macro_line|#include &lt;net/udp.h&gt;
macro_line|#include &lt;linux/skbuff.h&gt;
macro_line|#include &lt;net/sock.h&gt;
macro_line|#include &lt;net/raw.h&gt;
macro_line|#include &lt;net/icmp.h&gt;
macro_line|#include &lt;net/ipip.h&gt;
macro_line|#include &lt;net/inet_common.h&gt;
macro_line|#include &lt;net/xfrm.h&gt;
macro_line|#ifdef CONFIG_IP_MROUTE
macro_line|#include &lt;linux/mroute.h&gt;
macro_line|#endif
id|DEFINE_SNMP_STAT
c_func
(paren
r_struct
id|linux_mib
comma
id|net_statistics
)paren
suffix:semicolon
macro_line|#ifdef INET_REFCNT_DEBUG
DECL|variable|inet_sock_nr
id|atomic_t
id|inet_sock_nr
suffix:semicolon
macro_line|#endif
r_extern
r_void
id|ip_mc_drop_socket
c_func
(paren
r_struct
id|sock
op_star
id|sk
)paren
suffix:semicolon
multiline_comment|/* The inetsw table contains everything that inet_create needs to&n; * build a new socket.&n; */
DECL|variable|inetsw
r_static
r_struct
id|list_head
id|inetsw
(braket
id|SOCK_MAX
)braket
suffix:semicolon
DECL|variable|inetsw_lock
r_static
id|spinlock_t
id|inetsw_lock
op_assign
id|SPIN_LOCK_UNLOCKED
suffix:semicolon
multiline_comment|/* New destruction routine */
DECL|function|inet_sock_destruct
r_void
id|inet_sock_destruct
c_func
(paren
r_struct
id|sock
op_star
id|sk
)paren
(brace
r_struct
id|inet_sock
op_star
id|inet
op_assign
id|inet_sk
c_func
(paren
id|sk
)paren
suffix:semicolon
id|__skb_queue_purge
c_func
(paren
op_amp
id|sk-&gt;sk_receive_queue
)paren
suffix:semicolon
id|__skb_queue_purge
c_func
(paren
op_amp
id|sk-&gt;sk_error_queue
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;sk_type
op_eq
id|SOCK_STREAM
op_logical_and
id|sk-&gt;sk_state
op_ne
id|TCP_CLOSE
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;Attempt to release TCP socket in state %d %p&bslash;n&quot;
comma
id|sk-&gt;sk_state
comma
id|sk
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|sock_flag
c_func
(paren
id|sk
comma
id|SOCK_DEAD
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;Attempt to release alive inet socket %p&bslash;n&quot;
comma
id|sk
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|BUG_TRAP
c_func
(paren
op_logical_neg
id|atomic_read
c_func
(paren
op_amp
id|sk-&gt;sk_rmem_alloc
)paren
)paren
suffix:semicolon
id|BUG_TRAP
c_func
(paren
op_logical_neg
id|atomic_read
c_func
(paren
op_amp
id|sk-&gt;sk_wmem_alloc
)paren
)paren
suffix:semicolon
id|BUG_TRAP
c_func
(paren
op_logical_neg
id|sk-&gt;sk_wmem_queued
)paren
suffix:semicolon
id|BUG_TRAP
c_func
(paren
op_logical_neg
id|sk-&gt;sk_forward_alloc
)paren
suffix:semicolon
r_if
c_cond
(paren
id|inet-&gt;opt
)paren
id|kfree
c_func
(paren
id|inet-&gt;opt
)paren
suffix:semicolon
id|dst_release
c_func
(paren
id|sk-&gt;sk_dst_cache
)paren
suffix:semicolon
macro_line|#ifdef INET_REFCNT_DEBUG
id|atomic_dec
c_func
(paren
op_amp
id|inet_sock_nr
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;INET socket %p released, %d are still alive&bslash;n&quot;
comma
id|sk
comma
id|atomic_read
c_func
(paren
op_amp
id|inet_sock_nr
)paren
)paren
suffix:semicolon
macro_line|#endif
)brace
multiline_comment|/*&n; *&t;The routines beyond this point handle the behaviour of an AF_INET&n; *&t;socket object. Mostly it punts to the subprotocols of IP to do&n; *&t;the work.&n; */
multiline_comment|/*&n; *&t;Automatically bind an unbound socket.&n; */
DECL|function|inet_autobind
r_static
r_int
id|inet_autobind
c_func
(paren
r_struct
id|sock
op_star
id|sk
)paren
(brace
r_struct
id|inet_sock
op_star
id|inet
suffix:semicolon
multiline_comment|/* We may need to bind the socket. */
id|lock_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
id|inet
op_assign
id|inet_sk
c_func
(paren
id|sk
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|inet-&gt;num
)paren
(brace
r_if
c_cond
(paren
id|sk-&gt;sk_prot
op_member_access_from_pointer
id|get_port
c_func
(paren
id|sk
comma
l_int|0
)paren
)paren
(brace
id|release_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
r_return
op_minus
id|EAGAIN
suffix:semicolon
)brace
id|inet-&gt;sport
op_assign
id|htons
c_func
(paren
id|inet-&gt;num
)paren
suffix:semicolon
)brace
id|release_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;Move a socket into listening state.&n; */
DECL|function|inet_listen
r_int
id|inet_listen
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_int
id|backlog
)paren
(brace
r_struct
id|sock
op_star
id|sk
op_assign
id|sock-&gt;sk
suffix:semicolon
r_int
r_char
id|old_state
suffix:semicolon
r_int
id|err
suffix:semicolon
id|lock_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
id|err
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|sock-&gt;state
op_ne
id|SS_UNCONNECTED
op_logical_or
id|sock-&gt;type
op_ne
id|SOCK_STREAM
)paren
r_goto
id|out
suffix:semicolon
id|old_state
op_assign
id|sk-&gt;sk_state
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
(paren
l_int|1
op_lshift
id|old_state
)paren
op_amp
(paren
id|TCPF_CLOSE
op_or
id|TCPF_LISTEN
)paren
)paren
)paren
r_goto
id|out
suffix:semicolon
multiline_comment|/* Really, if the socket is already in listen state&n;&t; * we can only allow the backlog to be adjusted.&n;&t; */
r_if
c_cond
(paren
id|old_state
op_ne
id|TCP_LISTEN
)paren
(brace
id|err
op_assign
id|tcp_listen_start
c_func
(paren
id|sk
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_goto
id|out
suffix:semicolon
)brace
id|sk-&gt;sk_max_ack_backlog
op_assign
id|backlog
suffix:semicolon
id|err
op_assign
l_int|0
suffix:semicolon
id|out
suffix:colon
id|release_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;Create an inet socket.&n; */
DECL|function|inet_create
r_static
r_int
id|inet_create
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_int
id|protocol
)paren
(brace
r_struct
id|sock
op_star
id|sk
suffix:semicolon
r_struct
id|list_head
op_star
id|p
suffix:semicolon
r_struct
id|inet_protosw
op_star
id|answer
suffix:semicolon
r_struct
id|inet_sock
op_star
id|inet
suffix:semicolon
r_struct
id|proto
op_star
id|answer_prot
suffix:semicolon
r_int
r_char
id|answer_flags
suffix:semicolon
r_char
id|answer_no_check
suffix:semicolon
r_int
id|err
suffix:semicolon
id|sock-&gt;state
op_assign
id|SS_UNCONNECTED
suffix:semicolon
multiline_comment|/* Look for the requested type/protocol pair. */
id|answer
op_assign
l_int|NULL
suffix:semicolon
id|rcu_read_lock
c_func
(paren
)paren
suffix:semicolon
id|list_for_each_rcu
c_func
(paren
id|p
comma
op_amp
id|inetsw
(braket
id|sock-&gt;type
)braket
)paren
(brace
id|answer
op_assign
id|list_entry
c_func
(paren
id|p
comma
r_struct
id|inet_protosw
comma
id|list
)paren
suffix:semicolon
multiline_comment|/* Check the non-wild match. */
r_if
c_cond
(paren
id|protocol
op_eq
id|answer-&gt;protocol
)paren
(brace
r_if
c_cond
(paren
id|protocol
op_ne
id|IPPROTO_IP
)paren
r_break
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* Check for the two wild cases. */
r_if
c_cond
(paren
id|IPPROTO_IP
op_eq
id|protocol
)paren
(brace
id|protocol
op_assign
id|answer-&gt;protocol
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|IPPROTO_IP
op_eq
id|answer-&gt;protocol
)paren
r_break
suffix:semicolon
)brace
id|answer
op_assign
l_int|NULL
suffix:semicolon
)brace
id|err
op_assign
op_minus
id|ESOCKTNOSUPPORT
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|answer
)paren
r_goto
id|out_rcu_unlock
suffix:semicolon
id|err
op_assign
op_minus
id|EPERM
suffix:semicolon
r_if
c_cond
(paren
id|answer-&gt;capability
OG
l_int|0
op_logical_and
op_logical_neg
id|capable
c_func
(paren
id|answer-&gt;capability
)paren
)paren
r_goto
id|out_rcu_unlock
suffix:semicolon
id|err
op_assign
op_minus
id|EPROTONOSUPPORT
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|protocol
)paren
r_goto
id|out_rcu_unlock
suffix:semicolon
id|sock-&gt;ops
op_assign
id|answer-&gt;ops
suffix:semicolon
id|answer_prot
op_assign
id|answer-&gt;prot
suffix:semicolon
id|answer_no_check
op_assign
id|answer-&gt;no_check
suffix:semicolon
id|answer_flags
op_assign
id|answer-&gt;flags
suffix:semicolon
id|rcu_read_unlock
c_func
(paren
)paren
suffix:semicolon
id|BUG_TRAP
c_func
(paren
id|answer_prot-&gt;slab
op_ne
l_int|NULL
)paren
suffix:semicolon
id|err
op_assign
op_minus
id|ENOBUFS
suffix:semicolon
id|sk
op_assign
id|sk_alloc
c_func
(paren
id|PF_INET
comma
id|GFP_KERNEL
comma
id|answer_prot-&gt;slab_obj_size
comma
id|answer_prot-&gt;slab
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sk
op_eq
l_int|NULL
)paren
r_goto
id|out
suffix:semicolon
id|err
op_assign
l_int|0
suffix:semicolon
id|sk-&gt;sk_prot
op_assign
id|answer_prot
suffix:semicolon
id|sk-&gt;sk_no_check
op_assign
id|answer_no_check
suffix:semicolon
r_if
c_cond
(paren
id|INET_PROTOSW_REUSE
op_amp
id|answer_flags
)paren
id|sk-&gt;sk_reuse
op_assign
l_int|1
suffix:semicolon
id|inet
op_assign
id|inet_sk
c_func
(paren
id|sk
)paren
suffix:semicolon
r_if
c_cond
(paren
id|SOCK_RAW
op_eq
id|sock-&gt;type
)paren
(brace
id|inet-&gt;num
op_assign
id|protocol
suffix:semicolon
r_if
c_cond
(paren
id|IPPROTO_RAW
op_eq
id|protocol
)paren
id|inet-&gt;hdrincl
op_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ipv4_config.no_pmtu_disc
)paren
id|inet-&gt;pmtudisc
op_assign
id|IP_PMTUDISC_DONT
suffix:semicolon
r_else
id|inet-&gt;pmtudisc
op_assign
id|IP_PMTUDISC_WANT
suffix:semicolon
id|inet-&gt;id
op_assign
l_int|0
suffix:semicolon
id|sock_init_data
c_func
(paren
id|sock
comma
id|sk
)paren
suffix:semicolon
id|sk_set_owner
c_func
(paren
id|sk
comma
id|sk-&gt;sk_prot-&gt;owner
)paren
suffix:semicolon
id|sk-&gt;sk_destruct
op_assign
id|inet_sock_destruct
suffix:semicolon
id|sk-&gt;sk_family
op_assign
id|PF_INET
suffix:semicolon
id|sk-&gt;sk_protocol
op_assign
id|protocol
suffix:semicolon
id|sk-&gt;sk_backlog_rcv
op_assign
id|sk-&gt;sk_prot-&gt;backlog_rcv
suffix:semicolon
id|inet-&gt;uc_ttl
op_assign
op_minus
l_int|1
suffix:semicolon
id|inet-&gt;mc_loop
op_assign
l_int|1
suffix:semicolon
id|inet-&gt;mc_ttl
op_assign
l_int|1
suffix:semicolon
id|inet-&gt;mc_index
op_assign
l_int|0
suffix:semicolon
id|inet-&gt;mc_list
op_assign
l_int|NULL
suffix:semicolon
macro_line|#ifdef INET_REFCNT_DEBUG
id|atomic_inc
c_func
(paren
op_amp
id|inet_sock_nr
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|inet-&gt;num
)paren
(brace
multiline_comment|/* It assumes that any protocol which allows&n;&t;&t; * the user to assign a number at socket&n;&t;&t; * creation time automatically&n;&t;&t; * shares.&n;&t;&t; */
id|inet-&gt;sport
op_assign
id|htons
c_func
(paren
id|inet-&gt;num
)paren
suffix:semicolon
multiline_comment|/* Add to protocol hash chains. */
id|sk-&gt;sk_prot
op_member_access_from_pointer
id|hash
c_func
(paren
id|sk
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sk-&gt;sk_prot-&gt;init
)paren
(brace
id|err
op_assign
id|sk-&gt;sk_prot
op_member_access_from_pointer
id|init
c_func
(paren
id|sk
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
id|sk_common_release
c_func
(paren
id|sk
)paren
suffix:semicolon
)brace
id|out
suffix:colon
r_return
id|err
suffix:semicolon
id|out_rcu_unlock
suffix:colon
id|rcu_read_unlock
c_func
(paren
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;The peer socket should always be NULL (or else). When we call this&n; *&t;function we are destroying the object and from then on nobody&n; *&t;should refer to it.&n; */
DECL|function|inet_release
r_int
id|inet_release
c_func
(paren
r_struct
id|socket
op_star
id|sock
)paren
(brace
r_struct
id|sock
op_star
id|sk
op_assign
id|sock-&gt;sk
suffix:semicolon
r_if
c_cond
(paren
id|sk
)paren
(brace
r_int
id|timeout
suffix:semicolon
multiline_comment|/* Applications forget to leave groups before exiting */
id|ip_mc_drop_socket
c_func
(paren
id|sk
)paren
suffix:semicolon
multiline_comment|/* If linger is set, we don&squot;t return until the close&n;&t;&t; * is complete.  Otherwise we return immediately. The&n;&t;&t; * actually closing is done the same either way.&n;&t;&t; *&n;&t;&t; * If the close is due to the process exiting, we never&n;&t;&t; * linger..&n;&t;&t; */
id|timeout
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|sock_flag
c_func
(paren
id|sk
comma
id|SOCK_LINGER
)paren
op_logical_and
op_logical_neg
(paren
id|current-&gt;flags
op_amp
id|PF_EXITING
)paren
)paren
id|timeout
op_assign
id|sk-&gt;sk_lingertime
suffix:semicolon
id|sock-&gt;sk
op_assign
l_int|NULL
suffix:semicolon
id|sk-&gt;sk_prot
op_member_access_from_pointer
id|close
c_func
(paren
id|sk
comma
id|timeout
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* It is off by default, see below. */
DECL|variable|sysctl_ip_nonlocal_bind
r_int
id|sysctl_ip_nonlocal_bind
suffix:semicolon
DECL|function|inet_bind
r_int
id|inet_bind
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_struct
id|sockaddr
op_star
id|uaddr
comma
r_int
id|addr_len
)paren
(brace
r_struct
id|sockaddr_in
op_star
id|addr
op_assign
(paren
r_struct
id|sockaddr_in
op_star
)paren
id|uaddr
suffix:semicolon
r_struct
id|sock
op_star
id|sk
op_assign
id|sock-&gt;sk
suffix:semicolon
r_struct
id|inet_sock
op_star
id|inet
op_assign
id|inet_sk
c_func
(paren
id|sk
)paren
suffix:semicolon
r_int
r_int
id|snum
suffix:semicolon
r_int
id|chk_addr_ret
suffix:semicolon
r_int
id|err
suffix:semicolon
multiline_comment|/* If the socket has its own bind function then use it. (RAW) */
r_if
c_cond
(paren
id|sk-&gt;sk_prot-&gt;bind
)paren
(brace
id|err
op_assign
id|sk-&gt;sk_prot
op_member_access_from_pointer
id|bind
c_func
(paren
id|sk
comma
id|uaddr
comma
id|addr_len
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|err
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|addr_len
OL
r_sizeof
(paren
r_struct
id|sockaddr_in
)paren
)paren
r_goto
id|out
suffix:semicolon
id|chk_addr_ret
op_assign
id|inet_addr_type
c_func
(paren
id|addr-&gt;sin_addr.s_addr
)paren
suffix:semicolon
multiline_comment|/* Not specified by any standard per-se, however it breaks too&n;&t; * many applications when removed.  It is unfortunate since&n;&t; * allowing applications to make a non-local bind solves&n;&t; * several problems with systems using dynamic addressing.&n;&t; * (ie. your servers still start up even if your ISDN link&n;&t; *  is temporarily down)&n;&t; */
id|err
op_assign
op_minus
id|EADDRNOTAVAIL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sysctl_ip_nonlocal_bind
op_logical_and
op_logical_neg
id|inet-&gt;freebind
op_logical_and
id|addr-&gt;sin_addr.s_addr
op_ne
id|INADDR_ANY
op_logical_and
id|chk_addr_ret
op_ne
id|RTN_LOCAL
op_logical_and
id|chk_addr_ret
op_ne
id|RTN_MULTICAST
op_logical_and
id|chk_addr_ret
op_ne
id|RTN_BROADCAST
)paren
r_goto
id|out
suffix:semicolon
id|snum
op_assign
id|ntohs
c_func
(paren
id|addr-&gt;sin_port
)paren
suffix:semicolon
id|err
op_assign
op_minus
id|EACCES
suffix:semicolon
r_if
c_cond
(paren
id|snum
op_logical_and
id|snum
OL
id|PROT_SOCK
op_logical_and
op_logical_neg
id|capable
c_func
(paren
id|CAP_NET_BIND_SERVICE
)paren
)paren
r_goto
id|out
suffix:semicolon
multiline_comment|/*      We keep a pair of addresses. rcv_saddr is the one&n;&t; *      used by hash lookups, and saddr is used for transmit.&n;&t; *&n;&t; *      In the BSD API these are the same except where it&n;&t; *      would be illegal to use them (multicast/broadcast) in&n;&t; *      which case the sending device address is used.&n;&t; */
id|lock_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
multiline_comment|/* Check these errors (active socket, double bind). */
id|err
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;sk_state
op_ne
id|TCP_CLOSE
op_logical_or
id|inet-&gt;num
)paren
r_goto
id|out_release_sock
suffix:semicolon
id|inet-&gt;rcv_saddr
op_assign
id|inet-&gt;saddr
op_assign
id|addr-&gt;sin_addr.s_addr
suffix:semicolon
r_if
c_cond
(paren
id|chk_addr_ret
op_eq
id|RTN_MULTICAST
op_logical_or
id|chk_addr_ret
op_eq
id|RTN_BROADCAST
)paren
id|inet-&gt;saddr
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Use device */
multiline_comment|/* Make sure we are allowed to bind here. */
r_if
c_cond
(paren
id|sk-&gt;sk_prot
op_member_access_from_pointer
id|get_port
c_func
(paren
id|sk
comma
id|snum
)paren
)paren
(brace
id|inet-&gt;saddr
op_assign
id|inet-&gt;rcv_saddr
op_assign
l_int|0
suffix:semicolon
id|err
op_assign
op_minus
id|EADDRINUSE
suffix:semicolon
r_goto
id|out_release_sock
suffix:semicolon
)brace
r_if
c_cond
(paren
id|inet-&gt;rcv_saddr
)paren
id|sk-&gt;sk_userlocks
op_or_assign
id|SOCK_BINDADDR_LOCK
suffix:semicolon
r_if
c_cond
(paren
id|snum
)paren
id|sk-&gt;sk_userlocks
op_or_assign
id|SOCK_BINDPORT_LOCK
suffix:semicolon
id|inet-&gt;sport
op_assign
id|htons
c_func
(paren
id|inet-&gt;num
)paren
suffix:semicolon
id|inet-&gt;daddr
op_assign
l_int|0
suffix:semicolon
id|inet-&gt;dport
op_assign
l_int|0
suffix:semicolon
id|sk_dst_reset
c_func
(paren
id|sk
)paren
suffix:semicolon
id|err
op_assign
l_int|0
suffix:semicolon
id|out_release_sock
suffix:colon
id|release_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
id|out
suffix:colon
r_return
id|err
suffix:semicolon
)brace
DECL|function|inet_dgram_connect
r_int
id|inet_dgram_connect
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_struct
id|sockaddr
op_star
id|uaddr
comma
r_int
id|addr_len
comma
r_int
id|flags
)paren
(brace
r_struct
id|sock
op_star
id|sk
op_assign
id|sock-&gt;sk
suffix:semicolon
r_if
c_cond
(paren
id|uaddr-&gt;sa_family
op_eq
id|AF_UNSPEC
)paren
r_return
id|sk-&gt;sk_prot
op_member_access_from_pointer
id|disconnect
c_func
(paren
id|sk
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|inet_sk
c_func
(paren
id|sk
)paren
op_member_access_from_pointer
id|num
op_logical_and
id|inet_autobind
c_func
(paren
id|sk
)paren
)paren
r_return
op_minus
id|EAGAIN
suffix:semicolon
r_return
id|sk-&gt;sk_prot
op_member_access_from_pointer
id|connect
c_func
(paren
id|sk
comma
(paren
r_struct
id|sockaddr
op_star
)paren
id|uaddr
comma
id|addr_len
)paren
suffix:semicolon
)brace
DECL|function|inet_wait_for_connect
r_static
r_int
id|inet_wait_for_connect
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_int
id|timeo
)paren
(brace
id|DEFINE_WAIT
c_func
(paren
id|wait
)paren
suffix:semicolon
id|prepare_to_wait
c_func
(paren
id|sk-&gt;sk_sleep
comma
op_amp
id|wait
comma
id|TASK_INTERRUPTIBLE
)paren
suffix:semicolon
multiline_comment|/* Basic assumption: if someone sets sk-&gt;sk_err, he _must_&n;&t; * change state of the socket from TCP_SYN_*.&n;&t; * Connect() does not allow to get error notifications&n;&t; * without closing the socket.&n;&t; */
r_while
c_loop
(paren
(paren
l_int|1
op_lshift
id|sk-&gt;sk_state
)paren
op_amp
(paren
id|TCPF_SYN_SENT
op_or
id|TCPF_SYN_RECV
)paren
)paren
(brace
id|release_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
id|timeo
op_assign
id|schedule_timeout
c_func
(paren
id|timeo
)paren
suffix:semicolon
id|lock_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
r_if
c_cond
(paren
id|signal_pending
c_func
(paren
id|current
)paren
op_logical_or
op_logical_neg
id|timeo
)paren
r_break
suffix:semicolon
id|prepare_to_wait
c_func
(paren
id|sk-&gt;sk_sleep
comma
op_amp
id|wait
comma
id|TASK_INTERRUPTIBLE
)paren
suffix:semicolon
)brace
id|finish_wait
c_func
(paren
id|sk-&gt;sk_sleep
comma
op_amp
id|wait
)paren
suffix:semicolon
r_return
id|timeo
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;Connect to a remote host. There is regrettably still a little&n; *&t;TCP &squot;magic&squot; in here.&n; */
DECL|function|inet_stream_connect
r_int
id|inet_stream_connect
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_struct
id|sockaddr
op_star
id|uaddr
comma
r_int
id|addr_len
comma
r_int
id|flags
)paren
(brace
r_struct
id|sock
op_star
id|sk
op_assign
id|sock-&gt;sk
suffix:semicolon
r_int
id|err
suffix:semicolon
r_int
id|timeo
suffix:semicolon
id|lock_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
r_if
c_cond
(paren
id|uaddr-&gt;sa_family
op_eq
id|AF_UNSPEC
)paren
(brace
id|err
op_assign
id|sk-&gt;sk_prot
op_member_access_from_pointer
id|disconnect
c_func
(paren
id|sk
comma
id|flags
)paren
suffix:semicolon
id|sock-&gt;state
op_assign
id|err
ques
c_cond
id|SS_DISCONNECTING
suffix:colon
id|SS_UNCONNECTED
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|sock-&gt;state
)paren
(brace
r_default
suffix:colon
id|err
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_goto
id|out
suffix:semicolon
r_case
id|SS_CONNECTED
suffix:colon
id|err
op_assign
op_minus
id|EISCONN
suffix:semicolon
r_goto
id|out
suffix:semicolon
r_case
id|SS_CONNECTING
suffix:colon
id|err
op_assign
op_minus
id|EALREADY
suffix:semicolon
multiline_comment|/* Fall out of switch with err, set for this state */
r_break
suffix:semicolon
r_case
id|SS_UNCONNECTED
suffix:colon
id|err
op_assign
op_minus
id|EISCONN
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;sk_state
op_ne
id|TCP_CLOSE
)paren
r_goto
id|out
suffix:semicolon
id|err
op_assign
id|sk-&gt;sk_prot
op_member_access_from_pointer
id|connect
c_func
(paren
id|sk
comma
id|uaddr
comma
id|addr_len
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
r_goto
id|out
suffix:semicolon
id|sock-&gt;state
op_assign
id|SS_CONNECTING
suffix:semicolon
multiline_comment|/* Just entered SS_CONNECTING state; the only&n;&t;&t; * difference is that return value in non-blocking&n;&t;&t; * case is EINPROGRESS, rather than EALREADY.&n;&t;&t; */
id|err
op_assign
op_minus
id|EINPROGRESS
suffix:semicolon
r_break
suffix:semicolon
)brace
id|timeo
op_assign
id|sock_sndtimeo
c_func
(paren
id|sk
comma
id|flags
op_amp
id|O_NONBLOCK
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
l_int|1
op_lshift
id|sk-&gt;sk_state
)paren
op_amp
(paren
id|TCPF_SYN_SENT
op_or
id|TCPF_SYN_RECV
)paren
)paren
(brace
multiline_comment|/* Error code is set above */
r_if
c_cond
(paren
op_logical_neg
id|timeo
op_logical_or
op_logical_neg
id|inet_wait_for_connect
c_func
(paren
id|sk
comma
id|timeo
)paren
)paren
r_goto
id|out
suffix:semicolon
id|err
op_assign
id|sock_intr_errno
c_func
(paren
id|timeo
)paren
suffix:semicolon
r_if
c_cond
(paren
id|signal_pending
c_func
(paren
id|current
)paren
)paren
r_goto
id|out
suffix:semicolon
)brace
multiline_comment|/* Connection was closed by RST, timeout, ICMP error&n;&t; * or another process disconnected us.&n;&t; */
r_if
c_cond
(paren
id|sk-&gt;sk_state
op_eq
id|TCP_CLOSE
)paren
r_goto
id|sock_error
suffix:semicolon
multiline_comment|/* sk-&gt;sk_err may be not zero now, if RECVERR was ordered by user&n;&t; * and error was received after socket entered established state.&n;&t; * Hence, it is handled normally after connect() return successfully.&n;&t; */
id|sock-&gt;state
op_assign
id|SS_CONNECTED
suffix:semicolon
id|err
op_assign
l_int|0
suffix:semicolon
id|out
suffix:colon
id|release_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
id|sock_error
suffix:colon
id|err
op_assign
id|sock_error
c_func
(paren
id|sk
)paren
ques
c_cond
suffix:colon
op_minus
id|ECONNABORTED
suffix:semicolon
id|sock-&gt;state
op_assign
id|SS_UNCONNECTED
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;sk_prot
op_member_access_from_pointer
id|disconnect
c_func
(paren
id|sk
comma
id|flags
)paren
)paren
id|sock-&gt;state
op_assign
id|SS_DISCONNECTING
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;Accept a pending connection. The TCP layer now gives BSD semantics.&n; */
DECL|function|inet_accept
r_int
id|inet_accept
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_struct
id|socket
op_star
id|newsock
comma
r_int
id|flags
)paren
(brace
r_struct
id|sock
op_star
id|sk1
op_assign
id|sock-&gt;sk
suffix:semicolon
r_int
id|err
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_struct
id|sock
op_star
id|sk2
op_assign
id|sk1-&gt;sk_prot
op_member_access_from_pointer
id|accept
c_func
(paren
id|sk1
comma
id|flags
comma
op_amp
id|err
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sk2
)paren
r_goto
id|do_err
suffix:semicolon
id|lock_sock
c_func
(paren
id|sk2
)paren
suffix:semicolon
id|BUG_TRAP
c_func
(paren
(paren
l_int|1
op_lshift
id|sk2-&gt;sk_state
)paren
op_amp
(paren
id|TCPF_ESTABLISHED
op_or
id|TCPF_CLOSE_WAIT
op_or
id|TCPF_CLOSE
)paren
)paren
suffix:semicolon
id|sock_graft
c_func
(paren
id|sk2
comma
id|newsock
)paren
suffix:semicolon
id|newsock-&gt;state
op_assign
id|SS_CONNECTED
suffix:semicolon
id|err
op_assign
l_int|0
suffix:semicolon
id|release_sock
c_func
(paren
id|sk2
)paren
suffix:semicolon
id|do_err
suffix:colon
r_return
id|err
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;This does both peername and sockname.&n; */
DECL|function|inet_getname
r_int
id|inet_getname
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_struct
id|sockaddr
op_star
id|uaddr
comma
r_int
op_star
id|uaddr_len
comma
r_int
id|peer
)paren
(brace
r_struct
id|sock
op_star
id|sk
op_assign
id|sock-&gt;sk
suffix:semicolon
r_struct
id|inet_sock
op_star
id|inet
op_assign
id|inet_sk
c_func
(paren
id|sk
)paren
suffix:semicolon
r_struct
id|sockaddr_in
op_star
id|sin
op_assign
(paren
r_struct
id|sockaddr_in
op_star
)paren
id|uaddr
suffix:semicolon
id|sin-&gt;sin_family
op_assign
id|AF_INET
suffix:semicolon
r_if
c_cond
(paren
id|peer
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|inet-&gt;dport
op_logical_or
(paren
(paren
(paren
l_int|1
op_lshift
id|sk-&gt;sk_state
)paren
op_amp
(paren
id|TCPF_CLOSE
op_or
id|TCPF_SYN_SENT
)paren
)paren
op_logical_and
id|peer
op_eq
l_int|1
)paren
)paren
r_return
op_minus
id|ENOTCONN
suffix:semicolon
id|sin-&gt;sin_port
op_assign
id|inet-&gt;dport
suffix:semicolon
id|sin-&gt;sin_addr.s_addr
op_assign
id|inet-&gt;daddr
suffix:semicolon
)brace
r_else
(brace
id|__u32
id|addr
op_assign
id|inet-&gt;rcv_saddr
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|addr
)paren
id|addr
op_assign
id|inet-&gt;saddr
suffix:semicolon
id|sin-&gt;sin_port
op_assign
id|inet-&gt;sport
suffix:semicolon
id|sin-&gt;sin_addr.s_addr
op_assign
id|addr
suffix:semicolon
)brace
id|memset
c_func
(paren
id|sin-&gt;sin_zero
comma
l_int|0
comma
r_sizeof
(paren
id|sin-&gt;sin_zero
)paren
)paren
suffix:semicolon
op_star
id|uaddr_len
op_assign
r_sizeof
(paren
op_star
id|sin
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|inet_sendmsg
r_int
id|inet_sendmsg
c_func
(paren
r_struct
id|kiocb
op_star
id|iocb
comma
r_struct
id|socket
op_star
id|sock
comma
r_struct
id|msghdr
op_star
id|msg
comma
r_int
id|size
)paren
(brace
r_struct
id|sock
op_star
id|sk
op_assign
id|sock-&gt;sk
suffix:semicolon
multiline_comment|/* We may need to bind the socket. */
r_if
c_cond
(paren
op_logical_neg
id|inet_sk
c_func
(paren
id|sk
)paren
op_member_access_from_pointer
id|num
op_logical_and
id|inet_autobind
c_func
(paren
id|sk
)paren
)paren
r_return
op_minus
id|EAGAIN
suffix:semicolon
r_return
id|sk-&gt;sk_prot
op_member_access_from_pointer
id|sendmsg
c_func
(paren
id|iocb
comma
id|sk
comma
id|msg
comma
id|size
)paren
suffix:semicolon
)brace
DECL|function|inet_sendpage
r_static
id|ssize_t
id|inet_sendpage
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_struct
id|page
op_star
id|page
comma
r_int
id|offset
comma
r_int
id|size
comma
r_int
id|flags
)paren
(brace
r_struct
id|sock
op_star
id|sk
op_assign
id|sock-&gt;sk
suffix:semicolon
multiline_comment|/* We may need to bind the socket. */
r_if
c_cond
(paren
op_logical_neg
id|inet_sk
c_func
(paren
id|sk
)paren
op_member_access_from_pointer
id|num
op_logical_and
id|inet_autobind
c_func
(paren
id|sk
)paren
)paren
r_return
op_minus
id|EAGAIN
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;sk_prot-&gt;sendpage
)paren
r_return
id|sk-&gt;sk_prot
op_member_access_from_pointer
id|sendpage
c_func
(paren
id|sk
comma
id|page
comma
id|offset
comma
id|size
comma
id|flags
)paren
suffix:semicolon
r_return
id|sock_no_sendpage
c_func
(paren
id|sock
comma
id|page
comma
id|offset
comma
id|size
comma
id|flags
)paren
suffix:semicolon
)brace
DECL|function|inet_shutdown
r_int
id|inet_shutdown
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_int
id|how
)paren
(brace
r_struct
id|sock
op_star
id|sk
op_assign
id|sock-&gt;sk
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* This should really check to make sure&n;&t; * the socket is a TCP socket. (WHY AC...)&n;&t; */
id|how
op_increment
suffix:semicolon
multiline_comment|/* maps 0-&gt;1 has the advantage of making bit 1 rcvs and&n;&t;&t;       1-&gt;2 bit 2 snds.&n;&t;&t;       2-&gt;3 */
r_if
c_cond
(paren
(paren
id|how
op_amp
op_complement
id|SHUTDOWN_MASK
)paren
op_logical_or
op_logical_neg
id|how
)paren
multiline_comment|/* MAXINT-&gt;0 */
r_return
op_minus
id|EINVAL
suffix:semicolon
id|lock_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sock-&gt;state
op_eq
id|SS_CONNECTING
)paren
(brace
r_if
c_cond
(paren
(paren
l_int|1
op_lshift
id|sk-&gt;sk_state
)paren
op_amp
(paren
id|TCPF_SYN_SENT
op_or
id|TCPF_SYN_RECV
op_or
id|TCPF_CLOSE
)paren
)paren
id|sock-&gt;state
op_assign
id|SS_DISCONNECTING
suffix:semicolon
r_else
id|sock-&gt;state
op_assign
id|SS_CONNECTED
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|sk-&gt;sk_state
)paren
(brace
r_case
id|TCP_CLOSE
suffix:colon
id|err
op_assign
op_minus
id|ENOTCONN
suffix:semicolon
multiline_comment|/* Hack to wake up other listeners, who can poll for&n;&t;&t;   POLLHUP, even on eg. unconnected UDP sockets -- RR */
r_default
suffix:colon
id|sk-&gt;sk_shutdown
op_or_assign
id|how
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;sk_prot-&gt;shutdown
)paren
id|sk-&gt;sk_prot
op_member_access_from_pointer
id|shutdown
c_func
(paren
id|sk
comma
id|how
)paren
suffix:semicolon
r_break
suffix:semicolon
multiline_comment|/* Remaining two branches are temporary solution for missing&n;&t; * close() in multithreaded environment. It is _not_ a good idea,&n;&t; * but we have no choice until close() is repaired at VFS level.&n;&t; */
r_case
id|TCP_LISTEN
suffix:colon
r_if
c_cond
(paren
op_logical_neg
(paren
id|how
op_amp
id|RCV_SHUTDOWN
)paren
)paren
r_break
suffix:semicolon
multiline_comment|/* Fall through */
r_case
id|TCP_SYN_SENT
suffix:colon
id|err
op_assign
id|sk-&gt;sk_prot
op_member_access_from_pointer
id|disconnect
c_func
(paren
id|sk
comma
id|O_NONBLOCK
)paren
suffix:semicolon
id|sock-&gt;state
op_assign
id|err
ques
c_cond
id|SS_DISCONNECTING
suffix:colon
id|SS_UNCONNECTED
suffix:semicolon
r_break
suffix:semicolon
)brace
multiline_comment|/* Wake up anyone sleeping in poll. */
id|sk
op_member_access_from_pointer
id|sk_state_change
c_func
(paren
id|sk
)paren
suffix:semicolon
id|release_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;ioctl() calls you can issue on an INET socket. Most of these are&n; *&t;device configuration and stuff and very rarely used. Some ioctls&n; *&t;pass on to the socket itself.&n; *&n; *&t;NOTE: I like the idea of a module for the config stuff. ie ifconfig&n; *&t;loads the devconfigure module does its configuring and unloads it.&n; *&t;There&squot;s a good 20K of config code hanging around the kernel.&n; */
DECL|function|inet_ioctl
r_int
id|inet_ioctl
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
r_struct
id|sock
op_star
id|sk
op_assign
id|sock-&gt;sk
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|SIOCGSTAMP
suffix:colon
id|err
op_assign
id|sock_get_timestamp
c_func
(paren
id|sk
comma
(paren
r_struct
id|timeval
id|__user
op_star
)paren
id|arg
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIOCADDRT
suffix:colon
r_case
id|SIOCDELRT
suffix:colon
r_case
id|SIOCRTMSG
suffix:colon
id|err
op_assign
id|ip_rt_ioctl
c_func
(paren
id|cmd
comma
(paren
r_void
id|__user
op_star
)paren
id|arg
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIOCDARP
suffix:colon
r_case
id|SIOCGARP
suffix:colon
r_case
id|SIOCSARP
suffix:colon
id|err
op_assign
id|arp_ioctl
c_func
(paren
id|cmd
comma
(paren
r_void
id|__user
op_star
)paren
id|arg
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIOCGIFADDR
suffix:colon
r_case
id|SIOCSIFADDR
suffix:colon
r_case
id|SIOCGIFBRDADDR
suffix:colon
r_case
id|SIOCSIFBRDADDR
suffix:colon
r_case
id|SIOCGIFNETMASK
suffix:colon
r_case
id|SIOCSIFNETMASK
suffix:colon
r_case
id|SIOCGIFDSTADDR
suffix:colon
r_case
id|SIOCSIFDSTADDR
suffix:colon
r_case
id|SIOCSIFPFLAGS
suffix:colon
r_case
id|SIOCGIFPFLAGS
suffix:colon
r_case
id|SIOCSIFFLAGS
suffix:colon
id|err
op_assign
id|devinet_ioctl
c_func
(paren
id|cmd
comma
(paren
r_void
id|__user
op_star
)paren
id|arg
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
(brace
)brace
r_if
c_cond
(paren
op_logical_neg
id|sk-&gt;sk_prot-&gt;ioctl
op_logical_or
(paren
id|err
op_assign
id|sk-&gt;sk_prot
op_member_access_from_pointer
id|ioctl
c_func
(paren
id|sk
comma
id|cmd
comma
id|arg
)paren
)paren
op_eq
op_minus
id|ENOIOCTLCMD
)paren
id|err
op_assign
id|dev_ioctl
c_func
(paren
id|cmd
comma
(paren
r_void
id|__user
op_star
)paren
id|arg
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_return
id|err
suffix:semicolon
)brace
DECL|variable|inet_stream_ops
r_struct
id|proto_ops
id|inet_stream_ops
op_assign
(brace
dot
id|family
op_assign
id|PF_INET
comma
dot
id|owner
op_assign
id|THIS_MODULE
comma
dot
id|release
op_assign
id|inet_release
comma
dot
id|bind
op_assign
id|inet_bind
comma
dot
id|connect
op_assign
id|inet_stream_connect
comma
dot
id|socketpair
op_assign
id|sock_no_socketpair
comma
dot
id|accept
op_assign
id|inet_accept
comma
dot
id|getname
op_assign
id|inet_getname
comma
dot
id|poll
op_assign
id|tcp_poll
comma
dot
id|ioctl
op_assign
id|inet_ioctl
comma
dot
id|listen
op_assign
id|inet_listen
comma
dot
id|shutdown
op_assign
id|inet_shutdown
comma
dot
id|setsockopt
op_assign
id|sock_common_setsockopt
comma
dot
id|getsockopt
op_assign
id|sock_common_getsockopt
comma
dot
id|sendmsg
op_assign
id|inet_sendmsg
comma
dot
id|recvmsg
op_assign
id|sock_common_recvmsg
comma
dot
id|mmap
op_assign
id|sock_no_mmap
comma
dot
id|sendpage
op_assign
id|tcp_sendpage
)brace
suffix:semicolon
DECL|variable|inet_dgram_ops
r_struct
id|proto_ops
id|inet_dgram_ops
op_assign
(brace
dot
id|family
op_assign
id|PF_INET
comma
dot
id|owner
op_assign
id|THIS_MODULE
comma
dot
id|release
op_assign
id|inet_release
comma
dot
id|bind
op_assign
id|inet_bind
comma
dot
id|connect
op_assign
id|inet_dgram_connect
comma
dot
id|socketpair
op_assign
id|sock_no_socketpair
comma
dot
id|accept
op_assign
id|sock_no_accept
comma
dot
id|getname
op_assign
id|inet_getname
comma
dot
id|poll
op_assign
id|udp_poll
comma
dot
id|ioctl
op_assign
id|inet_ioctl
comma
dot
id|listen
op_assign
id|sock_no_listen
comma
dot
id|shutdown
op_assign
id|inet_shutdown
comma
dot
id|setsockopt
op_assign
id|sock_common_setsockopt
comma
dot
id|getsockopt
op_assign
id|sock_common_getsockopt
comma
dot
id|sendmsg
op_assign
id|inet_sendmsg
comma
dot
id|recvmsg
op_assign
id|sock_common_recvmsg
comma
dot
id|mmap
op_assign
id|sock_no_mmap
comma
dot
id|sendpage
op_assign
id|inet_sendpage
comma
)brace
suffix:semicolon
multiline_comment|/*&n; * For SOCK_RAW sockets; should be the same as inet_dgram_ops but without&n; * udp_poll&n; */
DECL|variable|inet_sockraw_ops
r_static
r_struct
id|proto_ops
id|inet_sockraw_ops
op_assign
(brace
dot
id|family
op_assign
id|PF_INET
comma
dot
id|owner
op_assign
id|THIS_MODULE
comma
dot
id|release
op_assign
id|inet_release
comma
dot
id|bind
op_assign
id|inet_bind
comma
dot
id|connect
op_assign
id|inet_dgram_connect
comma
dot
id|socketpair
op_assign
id|sock_no_socketpair
comma
dot
id|accept
op_assign
id|sock_no_accept
comma
dot
id|getname
op_assign
id|inet_getname
comma
dot
id|poll
op_assign
id|datagram_poll
comma
dot
id|ioctl
op_assign
id|inet_ioctl
comma
dot
id|listen
op_assign
id|sock_no_listen
comma
dot
id|shutdown
op_assign
id|inet_shutdown
comma
dot
id|setsockopt
op_assign
id|sock_common_setsockopt
comma
dot
id|getsockopt
op_assign
id|sock_common_getsockopt
comma
dot
id|sendmsg
op_assign
id|inet_sendmsg
comma
dot
id|recvmsg
op_assign
id|sock_common_recvmsg
comma
dot
id|mmap
op_assign
id|sock_no_mmap
comma
dot
id|sendpage
op_assign
id|inet_sendpage
comma
)brace
suffix:semicolon
DECL|variable|inet_family_ops
r_static
r_struct
id|net_proto_family
id|inet_family_ops
op_assign
(brace
dot
id|family
op_assign
id|PF_INET
comma
dot
id|create
op_assign
id|inet_create
comma
dot
id|owner
op_assign
id|THIS_MODULE
comma
)brace
suffix:semicolon
r_extern
r_void
id|tcp_init
c_func
(paren
r_void
)paren
suffix:semicolon
r_extern
r_void
id|tcp_v4_init
c_func
(paren
r_struct
id|net_proto_family
op_star
)paren
suffix:semicolon
multiline_comment|/* Upon startup we insert all the elements in inetsw_array[] into&n; * the linked list inetsw.&n; */
DECL|variable|inetsw_array
r_static
r_struct
id|inet_protosw
id|inetsw_array
(braket
)braket
op_assign
(brace
(brace
dot
id|type
op_assign
id|SOCK_STREAM
comma
dot
id|protocol
op_assign
id|IPPROTO_TCP
comma
dot
id|prot
op_assign
op_amp
id|tcp_prot
comma
dot
id|ops
op_assign
op_amp
id|inet_stream_ops
comma
dot
id|capability
op_assign
op_minus
l_int|1
comma
dot
id|no_check
op_assign
l_int|0
comma
dot
id|flags
op_assign
id|INET_PROTOSW_PERMANENT
comma
)brace
comma
(brace
dot
id|type
op_assign
id|SOCK_DGRAM
comma
dot
id|protocol
op_assign
id|IPPROTO_UDP
comma
dot
id|prot
op_assign
op_amp
id|udp_prot
comma
dot
id|ops
op_assign
op_amp
id|inet_dgram_ops
comma
dot
id|capability
op_assign
op_minus
l_int|1
comma
dot
id|no_check
op_assign
id|UDP_CSUM_DEFAULT
comma
dot
id|flags
op_assign
id|INET_PROTOSW_PERMANENT
comma
)brace
comma
(brace
dot
id|type
op_assign
id|SOCK_RAW
comma
dot
id|protocol
op_assign
id|IPPROTO_IP
comma
multiline_comment|/* wild card */
dot
id|prot
op_assign
op_amp
id|raw_prot
comma
dot
id|ops
op_assign
op_amp
id|inet_sockraw_ops
comma
dot
id|capability
op_assign
id|CAP_NET_RAW
comma
dot
id|no_check
op_assign
id|UDP_CSUM_DEFAULT
comma
dot
id|flags
op_assign
id|INET_PROTOSW_REUSE
comma
)brace
)brace
suffix:semicolon
DECL|macro|INETSW_ARRAY_LEN
mdefine_line|#define INETSW_ARRAY_LEN (sizeof(inetsw_array) / sizeof(struct inet_protosw))
DECL|function|inet_register_protosw
r_void
id|inet_register_protosw
c_func
(paren
r_struct
id|inet_protosw
op_star
id|p
)paren
(brace
r_struct
id|list_head
op_star
id|lh
suffix:semicolon
r_struct
id|inet_protosw
op_star
id|answer
suffix:semicolon
r_int
id|protocol
op_assign
id|p-&gt;protocol
suffix:semicolon
r_struct
id|list_head
op_star
id|last_perm
suffix:semicolon
id|spin_lock_bh
c_func
(paren
op_amp
id|inetsw_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;type
op_ge
id|SOCK_MAX
)paren
r_goto
id|out_illegal
suffix:semicolon
multiline_comment|/* If we are trying to override a permanent protocol, bail. */
id|answer
op_assign
l_int|NULL
suffix:semicolon
id|last_perm
op_assign
op_amp
id|inetsw
(braket
id|p-&gt;type
)braket
suffix:semicolon
id|list_for_each
c_func
(paren
id|lh
comma
op_amp
id|inetsw
(braket
id|p-&gt;type
)braket
)paren
(brace
id|answer
op_assign
id|list_entry
c_func
(paren
id|lh
comma
r_struct
id|inet_protosw
comma
id|list
)paren
suffix:semicolon
multiline_comment|/* Check only the non-wild match. */
r_if
c_cond
(paren
id|INET_PROTOSW_PERMANENT
op_amp
id|answer-&gt;flags
)paren
(brace
r_if
c_cond
(paren
id|protocol
op_eq
id|answer-&gt;protocol
)paren
r_break
suffix:semicolon
id|last_perm
op_assign
id|lh
suffix:semicolon
)brace
id|answer
op_assign
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|answer
)paren
r_goto
id|out_permanent
suffix:semicolon
multiline_comment|/* Add the new entry after the last permanent entry if any, so that&n;&t; * the new entry does not override a permanent entry when matched with&n;&t; * a wild-card protocol. But it is allowed to override any existing&n;&t; * non-permanent entry.  This means that when we remove this entry, the &n;&t; * system automatically returns to the old behavior.&n;&t; */
id|list_add_rcu
c_func
(paren
op_amp
id|p-&gt;list
comma
id|last_perm
)paren
suffix:semicolon
id|out
suffix:colon
id|spin_unlock_bh
c_func
(paren
op_amp
id|inetsw_lock
)paren
suffix:semicolon
id|synchronize_net
c_func
(paren
)paren
suffix:semicolon
r_return
suffix:semicolon
id|out_permanent
suffix:colon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;Attempt to override permanent protocol %d.&bslash;n&quot;
comma
id|protocol
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
id|out_illegal
suffix:colon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;Ignoring attempt to register invalid socket type %d.&bslash;n&quot;
comma
id|p-&gt;type
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
DECL|function|inet_unregister_protosw
r_void
id|inet_unregister_protosw
c_func
(paren
r_struct
id|inet_protosw
op_star
id|p
)paren
(brace
r_if
c_cond
(paren
id|INET_PROTOSW_PERMANENT
op_amp
id|p-&gt;flags
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;Attempt to unregister permanent protocol %d.&bslash;n&quot;
comma
id|p-&gt;protocol
)paren
suffix:semicolon
)brace
r_else
(brace
id|spin_lock_bh
c_func
(paren
op_amp
id|inetsw_lock
)paren
suffix:semicolon
id|list_del_rcu
c_func
(paren
op_amp
id|p-&gt;list
)paren
suffix:semicolon
id|spin_unlock_bh
c_func
(paren
op_amp
id|inetsw_lock
)paren
suffix:semicolon
id|synchronize_net
c_func
(paren
)paren
suffix:semicolon
)brace
)brace
macro_line|#ifdef CONFIG_IP_MULTICAST
DECL|variable|igmp_protocol
r_static
r_struct
id|net_protocol
id|igmp_protocol
op_assign
(brace
dot
id|handler
op_assign
id|igmp_rcv
comma
)brace
suffix:semicolon
macro_line|#endif
DECL|variable|tcp_protocol
r_static
r_struct
id|net_protocol
id|tcp_protocol
op_assign
(brace
dot
id|handler
op_assign
id|tcp_v4_rcv
comma
dot
id|err_handler
op_assign
id|tcp_v4_err
comma
dot
id|no_policy
op_assign
l_int|1
comma
)brace
suffix:semicolon
DECL|variable|udp_protocol
r_static
r_struct
id|net_protocol
id|udp_protocol
op_assign
(brace
dot
id|handler
op_assign
id|udp_rcv
comma
dot
id|err_handler
op_assign
id|udp_err
comma
dot
id|no_policy
op_assign
l_int|1
comma
)brace
suffix:semicolon
DECL|variable|icmp_protocol
r_static
r_struct
id|net_protocol
id|icmp_protocol
op_assign
(brace
dot
id|handler
op_assign
id|icmp_rcv
comma
)brace
suffix:semicolon
DECL|function|init_ipv4_mibs
r_static
r_int
id|__init
id|init_ipv4_mibs
c_func
(paren
r_void
)paren
(brace
id|net_statistics
(braket
l_int|0
)braket
op_assign
id|alloc_percpu
c_func
(paren
r_struct
id|linux_mib
)paren
suffix:semicolon
id|net_statistics
(braket
l_int|1
)braket
op_assign
id|alloc_percpu
c_func
(paren
r_struct
id|linux_mib
)paren
suffix:semicolon
id|ip_statistics
(braket
l_int|0
)braket
op_assign
id|alloc_percpu
c_func
(paren
r_struct
id|ipstats_mib
)paren
suffix:semicolon
id|ip_statistics
(braket
l_int|1
)braket
op_assign
id|alloc_percpu
c_func
(paren
r_struct
id|ipstats_mib
)paren
suffix:semicolon
id|icmp_statistics
(braket
l_int|0
)braket
op_assign
id|alloc_percpu
c_func
(paren
r_struct
id|icmp_mib
)paren
suffix:semicolon
id|icmp_statistics
(braket
l_int|1
)braket
op_assign
id|alloc_percpu
c_func
(paren
r_struct
id|icmp_mib
)paren
suffix:semicolon
id|tcp_statistics
(braket
l_int|0
)braket
op_assign
id|alloc_percpu
c_func
(paren
r_struct
id|tcp_mib
)paren
suffix:semicolon
id|tcp_statistics
(braket
l_int|1
)braket
op_assign
id|alloc_percpu
c_func
(paren
r_struct
id|tcp_mib
)paren
suffix:semicolon
id|udp_statistics
(braket
l_int|0
)braket
op_assign
id|alloc_percpu
c_func
(paren
r_struct
id|udp_mib
)paren
suffix:semicolon
id|udp_statistics
(braket
l_int|1
)braket
op_assign
id|alloc_percpu
c_func
(paren
r_struct
id|udp_mib
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|net_statistics
(braket
l_int|0
)braket
op_logical_and
id|net_statistics
(braket
l_int|1
)braket
op_logical_and
id|ip_statistics
(braket
l_int|0
)braket
op_logical_and
id|ip_statistics
(braket
l_int|1
)braket
op_logical_and
id|tcp_statistics
(braket
l_int|0
)braket
op_logical_and
id|tcp_statistics
(braket
l_int|1
)braket
op_logical_and
id|udp_statistics
(braket
l_int|0
)braket
op_logical_and
id|udp_statistics
(braket
l_int|1
)braket
)paren
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
(paren
r_void
)paren
id|tcp_mib_init
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
id|ipv4_proc_init
c_func
(paren
r_void
)paren
suffix:semicolon
r_extern
r_void
id|ipfrag_init
c_func
(paren
r_void
)paren
suffix:semicolon
DECL|function|inet_init
r_static
r_int
id|__init
id|inet_init
c_func
(paren
r_void
)paren
(brace
r_struct
id|sk_buff
op_star
id|dummy_skb
suffix:semicolon
r_struct
id|inet_protosw
op_star
id|q
suffix:semicolon
r_struct
id|list_head
op_star
id|r
suffix:semicolon
r_int
id|rc
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
r_sizeof
(paren
r_struct
id|inet_skb_parm
)paren
OG
r_sizeof
(paren
id|dummy_skb-&gt;cb
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_CRIT
l_string|&quot;%s: panic&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|rc
op_assign
id|sk_alloc_slab
c_func
(paren
op_amp
id|tcp_prot
comma
l_string|&quot;tcp_sock&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
(brace
id|sk_alloc_slab_error
c_func
(paren
op_amp
id|tcp_prot
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|rc
op_assign
id|sk_alloc_slab
c_func
(paren
op_amp
id|udp_prot
comma
l_string|&quot;udp_sock&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
(brace
id|sk_alloc_slab_error
c_func
(paren
op_amp
id|udp_prot
)paren
suffix:semicolon
r_goto
id|out_tcp_free_slab
suffix:semicolon
)brace
id|rc
op_assign
id|sk_alloc_slab
c_func
(paren
op_amp
id|raw_prot
comma
l_string|&quot;raw_sock&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
(brace
id|sk_alloc_slab_error
c_func
(paren
op_amp
id|raw_prot
)paren
suffix:semicolon
r_goto
id|out_udp_free_slab
suffix:semicolon
)brace
multiline_comment|/*&n;&t; *&t;Tell SOCKET that we are alive... &n;&t; */
(paren
r_void
)paren
id|sock_register
c_func
(paren
op_amp
id|inet_family_ops
)paren
suffix:semicolon
multiline_comment|/*&n;&t; *&t;Add all the base protocols.&n;&t; */
r_if
c_cond
(paren
id|inet_add_protocol
c_func
(paren
op_amp
id|icmp_protocol
comma
id|IPPROTO_ICMP
)paren
OL
l_int|0
)paren
id|printk
c_func
(paren
id|KERN_CRIT
l_string|&quot;inet_init: Cannot add ICMP protocol&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|inet_add_protocol
c_func
(paren
op_amp
id|udp_protocol
comma
id|IPPROTO_UDP
)paren
OL
l_int|0
)paren
id|printk
c_func
(paren
id|KERN_CRIT
l_string|&quot;inet_init: Cannot add UDP protocol&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|inet_add_protocol
c_func
(paren
op_amp
id|tcp_protocol
comma
id|IPPROTO_TCP
)paren
OL
l_int|0
)paren
id|printk
c_func
(paren
id|KERN_CRIT
l_string|&quot;inet_init: Cannot add TCP protocol&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_IP_MULTICAST
r_if
c_cond
(paren
id|inet_add_protocol
c_func
(paren
op_amp
id|igmp_protocol
comma
id|IPPROTO_IGMP
)paren
OL
l_int|0
)paren
id|printk
c_func
(paren
id|KERN_CRIT
l_string|&quot;inet_init: Cannot add IGMP protocol&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/* Register the socket-side information for inet_create. */
r_for
c_loop
(paren
id|r
op_assign
op_amp
id|inetsw
(braket
l_int|0
)braket
suffix:semicolon
id|r
OL
op_amp
id|inetsw
(braket
id|SOCK_MAX
)braket
suffix:semicolon
op_increment
id|r
)paren
id|INIT_LIST_HEAD
c_func
(paren
id|r
)paren
suffix:semicolon
r_for
c_loop
(paren
id|q
op_assign
id|inetsw_array
suffix:semicolon
id|q
OL
op_amp
id|inetsw_array
(braket
id|INETSW_ARRAY_LEN
)braket
suffix:semicolon
op_increment
id|q
)paren
id|inet_register_protosw
c_func
(paren
id|q
)paren
suffix:semicolon
multiline_comment|/*&n;&t; *&t;Set the ARP module up&n;&t; */
id|arp_init
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/*&n;  &t; *&t;Set the IP module up&n;  &t; */
id|ip_init
c_func
(paren
)paren
suffix:semicolon
id|tcp_v4_init
c_func
(paren
op_amp
id|inet_family_ops
)paren
suffix:semicolon
multiline_comment|/* Setup TCP slab cache for open requests. */
id|tcp_init
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/*&n;&t; *&t;Set the ICMP layer up&n;&t; */
id|icmp_init
c_func
(paren
op_amp
id|inet_family_ops
)paren
suffix:semicolon
multiline_comment|/*&n;&t; *&t;Initialise the multicast router&n;&t; */
macro_line|#if defined(CONFIG_IP_MROUTE)
id|ip_mr_init
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/*&n;&t; *&t;Initialise per-cpu ipv4 mibs&n;&t; */
r_if
c_cond
(paren
id|init_ipv4_mibs
c_func
(paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_CRIT
l_string|&quot;inet_init: Cannot init ipv4 mibs&bslash;n&quot;
)paren
suffix:semicolon
)brace
suffix:semicolon
id|ipv4_proc_init
c_func
(paren
)paren
suffix:semicolon
id|ipfrag_init
c_func
(paren
)paren
suffix:semicolon
id|rc
op_assign
l_int|0
suffix:semicolon
id|out
suffix:colon
r_return
id|rc
suffix:semicolon
id|out_tcp_free_slab
suffix:colon
id|sk_free_slab
c_func
(paren
op_amp
id|tcp_prot
)paren
suffix:semicolon
id|out_udp_free_slab
suffix:colon
id|sk_free_slab
c_func
(paren
op_amp
id|udp_prot
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
DECL|variable|inet_init
id|module_init
c_func
(paren
id|inet_init
)paren
suffix:semicolon
multiline_comment|/* ------------------------------------------------------------------------ */
macro_line|#ifdef CONFIG_PROC_FS
r_extern
r_int
id|fib_proc_init
c_func
(paren
r_void
)paren
suffix:semicolon
r_extern
r_void
id|fib_proc_exit
c_func
(paren
r_void
)paren
suffix:semicolon
r_extern
r_int
id|ip_misc_proc_init
c_func
(paren
r_void
)paren
suffix:semicolon
r_extern
r_int
id|raw_proc_init
c_func
(paren
r_void
)paren
suffix:semicolon
r_extern
r_void
id|raw_proc_exit
c_func
(paren
r_void
)paren
suffix:semicolon
r_extern
r_int
id|tcp4_proc_init
c_func
(paren
r_void
)paren
suffix:semicolon
r_extern
r_void
id|tcp4_proc_exit
c_func
(paren
r_void
)paren
suffix:semicolon
r_extern
r_int
id|udp4_proc_init
c_func
(paren
r_void
)paren
suffix:semicolon
r_extern
r_void
id|udp4_proc_exit
c_func
(paren
r_void
)paren
suffix:semicolon
DECL|function|ipv4_proc_init
r_static
r_int
id|__init
id|ipv4_proc_init
c_func
(paren
r_void
)paren
(brace
r_int
id|rc
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|raw_proc_init
c_func
(paren
)paren
)paren
r_goto
id|out_raw
suffix:semicolon
r_if
c_cond
(paren
id|tcp4_proc_init
c_func
(paren
)paren
)paren
r_goto
id|out_tcp
suffix:semicolon
r_if
c_cond
(paren
id|udp4_proc_init
c_func
(paren
)paren
)paren
r_goto
id|out_udp
suffix:semicolon
r_if
c_cond
(paren
id|fib_proc_init
c_func
(paren
)paren
)paren
r_goto
id|out_fib
suffix:semicolon
r_if
c_cond
(paren
id|ip_misc_proc_init
c_func
(paren
)paren
)paren
r_goto
id|out_misc
suffix:semicolon
id|out
suffix:colon
r_return
id|rc
suffix:semicolon
id|out_misc
suffix:colon
id|fib_proc_exit
c_func
(paren
)paren
suffix:semicolon
id|out_fib
suffix:colon
id|udp4_proc_exit
c_func
(paren
)paren
suffix:semicolon
id|out_udp
suffix:colon
id|tcp4_proc_exit
c_func
(paren
)paren
suffix:semicolon
id|out_tcp
suffix:colon
id|raw_proc_exit
c_func
(paren
)paren
suffix:semicolon
id|out_raw
suffix:colon
id|rc
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
macro_line|#else /* CONFIG_PROC_FS */
DECL|function|ipv4_proc_init
r_static
r_int
id|__init
id|ipv4_proc_init
c_func
(paren
r_void
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_PROC_FS */
DECL|variable|PF_INET
id|MODULE_ALIAS_NETPROTO
c_func
(paren
id|PF_INET
)paren
suffix:semicolon
DECL|variable|inet_accept
id|EXPORT_SYMBOL
c_func
(paren
id|inet_accept
)paren
suffix:semicolon
DECL|variable|inet_bind
id|EXPORT_SYMBOL
c_func
(paren
id|inet_bind
)paren
suffix:semicolon
DECL|variable|inet_dgram_connect
id|EXPORT_SYMBOL
c_func
(paren
id|inet_dgram_connect
)paren
suffix:semicolon
DECL|variable|inet_dgram_ops
id|EXPORT_SYMBOL
c_func
(paren
id|inet_dgram_ops
)paren
suffix:semicolon
DECL|variable|inet_getname
id|EXPORT_SYMBOL
c_func
(paren
id|inet_getname
)paren
suffix:semicolon
DECL|variable|inet_ioctl
id|EXPORT_SYMBOL
c_func
(paren
id|inet_ioctl
)paren
suffix:semicolon
DECL|variable|inet_listen
id|EXPORT_SYMBOL
c_func
(paren
id|inet_listen
)paren
suffix:semicolon
DECL|variable|inet_register_protosw
id|EXPORT_SYMBOL
c_func
(paren
id|inet_register_protosw
)paren
suffix:semicolon
DECL|variable|inet_release
id|EXPORT_SYMBOL
c_func
(paren
id|inet_release
)paren
suffix:semicolon
DECL|variable|inet_sendmsg
id|EXPORT_SYMBOL
c_func
(paren
id|inet_sendmsg
)paren
suffix:semicolon
DECL|variable|inet_shutdown
id|EXPORT_SYMBOL
c_func
(paren
id|inet_shutdown
)paren
suffix:semicolon
DECL|variable|inet_sock_destruct
id|EXPORT_SYMBOL
c_func
(paren
id|inet_sock_destruct
)paren
suffix:semicolon
DECL|variable|inet_stream_connect
id|EXPORT_SYMBOL
c_func
(paren
id|inet_stream_connect
)paren
suffix:semicolon
DECL|variable|inet_stream_ops
id|EXPORT_SYMBOL
c_func
(paren
id|inet_stream_ops
)paren
suffix:semicolon
DECL|variable|inet_unregister_protosw
id|EXPORT_SYMBOL
c_func
(paren
id|inet_unregister_protosw
)paren
suffix:semicolon
DECL|variable|net_statistics
id|EXPORT_SYMBOL
c_func
(paren
id|net_statistics
)paren
suffix:semicolon
macro_line|#ifdef INET_REFCNT_DEBUG
DECL|variable|inet_sock_nr
id|EXPORT_SYMBOL
c_func
(paren
id|inet_sock_nr
)paren
suffix:semicolon
macro_line|#endif
eof
