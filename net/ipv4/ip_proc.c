multiline_comment|/*&n; * INET&t;&t;An implementation of the TCP/IP protocol suite for the LINUX&n; *&t;&t;operating system.  INET is implemented using the  BSD Socket&n; *&t;&t;interface as the means of communication with the user level.&n; *&n; *&t;&t;ipv4 proc support&n; *&n; *&t;&t;Arnaldo Carvalho de Melo &lt;acme@conectiva.com.br&gt;, 2002/10/10&n; *&n; *&t;&t;This program is free software; you can redistribute it and/or&n; *&t;&t;modify it under the terms of the GNU General Public License as&n; *&t;&t;published by the Free Software Foundation; version 2 of the&n; *&t;&t;License&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/netdevice.h&gt;
macro_line|#include &lt;net/neighbour.h&gt;
macro_line|#include &lt;net/arp.h&gt;
macro_line|#include &lt;linux/seq_file.h&gt;
macro_line|#include &lt;linux/proc_fs.h&gt;
r_extern
r_int
id|raw_get_info
c_func
(paren
r_char
op_star
comma
r_char
op_star
op_star
comma
id|off_t
comma
r_int
)paren
suffix:semicolon
r_extern
r_int
id|snmp_get_info
c_func
(paren
r_char
op_star
comma
r_char
op_star
op_star
comma
id|off_t
comma
r_int
)paren
suffix:semicolon
r_extern
r_int
id|netstat_get_info
c_func
(paren
r_char
op_star
comma
r_char
op_star
op_star
comma
id|off_t
comma
r_int
)paren
suffix:semicolon
r_extern
r_int
id|afinet_get_info
c_func
(paren
r_char
op_star
comma
r_char
op_star
op_star
comma
id|off_t
comma
r_int
)paren
suffix:semicolon
r_extern
r_int
id|tcp_get_info
c_func
(paren
r_char
op_star
comma
r_char
op_star
op_star
comma
id|off_t
comma
r_int
)paren
suffix:semicolon
r_extern
r_int
id|udp_get_info
c_func
(paren
r_char
op_star
comma
r_char
op_star
op_star
comma
id|off_t
comma
r_int
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_PROC_FS
macro_line|#ifdef CONFIG_AX25
multiline_comment|/*&n; *&t;ax25 -&gt; ASCII conversion&n; */
DECL|function|ax2asc2
r_char
op_star
id|ax2asc2
c_func
(paren
id|ax25_address
op_star
id|a
comma
r_char
op_star
id|buf
)paren
(brace
r_char
id|c
comma
op_star
id|s
suffix:semicolon
r_int
id|n
suffix:semicolon
r_for
c_loop
(paren
id|n
op_assign
l_int|0
comma
id|s
op_assign
id|buf
suffix:semicolon
id|n
OL
l_int|6
suffix:semicolon
id|n
op_increment
)paren
(brace
id|c
op_assign
(paren
id|a-&gt;ax25_call
(braket
id|n
)braket
op_rshift
l_int|1
)paren
op_amp
l_int|0x7F
suffix:semicolon
r_if
c_cond
(paren
id|c
op_ne
l_char|&squot; &squot;
)paren
op_star
id|s
op_increment
op_assign
id|c
suffix:semicolon
)brace
op_star
id|s
op_increment
op_assign
l_char|&squot;-&squot;
suffix:semicolon
r_if
c_cond
(paren
(paren
id|n
op_assign
(paren
(paren
id|a-&gt;ax25_call
(braket
l_int|6
)braket
op_rshift
l_int|1
)paren
op_amp
l_int|0x0F
)paren
)paren
OG
l_int|9
)paren
(brace
op_star
id|s
op_increment
op_assign
l_char|&squot;1&squot;
suffix:semicolon
id|n
op_sub_assign
l_int|10
suffix:semicolon
)brace
op_star
id|s
op_increment
op_assign
id|n
op_plus
l_char|&squot;0&squot;
suffix:semicolon
op_star
id|s
op_increment
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
r_if
c_cond
(paren
op_star
id|buf
op_eq
l_char|&squot;&bslash;0&squot;
op_logical_or
op_star
id|buf
op_eq
l_char|&squot;-&squot;
)paren
r_return
l_string|&quot;*&quot;
suffix:semicolon
r_return
id|buf
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_AX25 */
DECL|function|arp_seq_start
r_static
r_void
op_star
id|arp_seq_start
c_func
(paren
r_struct
id|seq_file
op_star
id|seq
comma
id|loff_t
op_star
id|pos
)paren
(brace
r_return
(paren
r_void
op_star
)paren
(paren
r_int
r_int
)paren
op_increment
op_star
id|pos
suffix:semicolon
)brace
DECL|function|arp_seq_next
r_static
r_void
op_star
id|arp_seq_next
c_func
(paren
r_struct
id|seq_file
op_star
id|seq
comma
r_void
op_star
id|v
comma
id|loff_t
op_star
id|pos
)paren
(brace
r_return
(paren
r_void
op_star
)paren
(paren
r_int
r_int
)paren
(paren
(paren
op_increment
op_star
id|pos
)paren
op_ge
(paren
id|NEIGH_HASHMASK
op_plus
id|PNEIGH_HASHMASK
op_minus
l_int|1
)paren
ques
c_cond
l_int|0
suffix:colon
op_star
id|pos
)paren
suffix:semicolon
)brace
DECL|function|arp_seq_stop
r_static
r_void
id|arp_seq_stop
c_func
(paren
r_struct
id|seq_file
op_star
id|seq
comma
r_void
op_star
id|v
)paren
(brace
)brace
DECL|macro|HBUFFERLEN
mdefine_line|#define HBUFFERLEN 30
DECL|function|arp_format_neigh_table
r_static
id|__inline__
r_void
id|arp_format_neigh_table
c_func
(paren
r_struct
id|seq_file
op_star
id|seq
comma
r_int
id|entry
)paren
(brace
r_char
id|hbuffer
(braket
id|HBUFFERLEN
)braket
suffix:semicolon
r_const
r_char
id|hexbuf
(braket
)braket
op_assign
l_string|&quot;0123456789ABCDEF&quot;
suffix:semicolon
r_struct
id|neighbour
op_star
id|n
suffix:semicolon
r_int
id|k
comma
id|j
suffix:semicolon
id|read_lock_bh
c_func
(paren
op_amp
id|arp_tbl.lock
)paren
suffix:semicolon
r_for
c_loop
(paren
id|n
op_assign
id|arp_tbl.hash_buckets
(braket
id|entry
)braket
suffix:semicolon
id|n
suffix:semicolon
id|n
op_assign
id|n-&gt;next
)paren
(brace
r_char
id|tbuf
(braket
l_int|16
)braket
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
op_assign
id|n-&gt;dev
suffix:semicolon
r_int
id|hatype
op_assign
id|dev-&gt;type
suffix:semicolon
multiline_comment|/* Do not confuse users &quot;arp -a&quot; with magic entries */
r_if
c_cond
(paren
op_logical_neg
(paren
id|n-&gt;nud_state
op_amp
op_complement
id|NUD_NOARP
)paren
)paren
r_continue
suffix:semicolon
id|read_lock
c_func
(paren
op_amp
id|n-&gt;lock
)paren
suffix:semicolon
multiline_comment|/* Convert hardware address to XX:XX:XX:XX ... form. */
macro_line|#ifdef CONFIG_AX25
r_if
c_cond
(paren
id|hatype
op_eq
id|ARPHRD_AX25
op_logical_or
id|hatype
op_eq
id|ARPHRD_NETROM
)paren
id|ax2asc2
c_func
(paren
(paren
id|ax25_address
op_star
)paren
id|n-&gt;ha
comma
id|hbuffer
)paren
suffix:semicolon
r_else
(brace
macro_line|#endif
r_for
c_loop
(paren
id|k
op_assign
l_int|0
comma
id|j
op_assign
l_int|0
suffix:semicolon
id|k
OL
id|HBUFFERLEN
op_minus
l_int|3
op_logical_and
id|j
OL
id|dev-&gt;addr_len
suffix:semicolon
id|j
op_increment
)paren
(brace
id|hbuffer
(braket
id|k
op_increment
)braket
op_assign
id|hexbuf
(braket
(paren
id|n-&gt;ha
(braket
id|j
)braket
op_rshift
l_int|4
)paren
op_amp
l_int|15
)braket
suffix:semicolon
id|hbuffer
(braket
id|k
op_increment
)braket
op_assign
id|hexbuf
(braket
id|n-&gt;ha
(braket
id|j
)braket
op_amp
l_int|15
)braket
suffix:semicolon
id|hbuffer
(braket
id|k
op_increment
)braket
op_assign
l_char|&squot;:&squot;
suffix:semicolon
)brace
id|hbuffer
(braket
op_decrement
id|k
)braket
op_assign
l_int|0
suffix:semicolon
macro_line|#ifdef CONFIG_AX25
)brace
macro_line|#endif
id|sprintf
c_func
(paren
id|tbuf
comma
l_string|&quot;%u.%u.%u.%u&quot;
comma
id|NIPQUAD
c_func
(paren
op_star
(paren
id|u32
op_star
)paren
id|n-&gt;primary_key
)paren
)paren
suffix:semicolon
id|seq_printf
c_func
(paren
id|seq
comma
l_string|&quot;%-16s 0x%-10x0x%-10x%s&quot;
l_string|&quot;     *        %s&bslash;n&quot;
comma
id|tbuf
comma
id|hatype
comma
id|arp_state_to_flags
c_func
(paren
id|n
)paren
comma
id|hbuffer
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|read_unlock
c_func
(paren
op_amp
id|n-&gt;lock
)paren
suffix:semicolon
)brace
id|read_unlock_bh
c_func
(paren
op_amp
id|arp_tbl.lock
)paren
suffix:semicolon
)brace
DECL|function|arp_format_pneigh_table
r_static
id|__inline__
r_void
id|arp_format_pneigh_table
c_func
(paren
r_struct
id|seq_file
op_star
id|seq
comma
r_int
id|entry
)paren
(brace
r_struct
id|pneigh_entry
op_star
id|n
suffix:semicolon
r_for
c_loop
(paren
id|n
op_assign
id|arp_tbl.phash_buckets
(braket
id|entry
)braket
suffix:semicolon
id|n
suffix:semicolon
id|n
op_assign
id|n-&gt;next
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
id|n-&gt;dev
suffix:semicolon
r_int
id|hatype
op_assign
id|dev
ques
c_cond
id|dev-&gt;type
suffix:colon
l_int|0
suffix:semicolon
r_char
id|tbuf
(braket
l_int|16
)braket
suffix:semicolon
id|sprintf
c_func
(paren
id|tbuf
comma
l_string|&quot;%u.%u.%u.%u&quot;
comma
id|NIPQUAD
c_func
(paren
op_star
(paren
id|u32
op_star
)paren
id|n-&gt;key
)paren
)paren
suffix:semicolon
id|seq_printf
c_func
(paren
id|seq
comma
l_string|&quot;%-16s 0x%-10x0x%-10x%s&quot;
l_string|&quot;     *        %s&bslash;n&quot;
comma
id|tbuf
comma
id|hatype
comma
id|ATF_PUBL
op_or
id|ATF_PERM
comma
l_string|&quot;00:00:00:00:00:00&quot;
comma
id|dev
ques
c_cond
id|dev-&gt;name
suffix:colon
l_string|&quot;*&quot;
)paren
suffix:semicolon
)brace
)brace
DECL|function|arp_seq_show
r_static
r_int
id|arp_seq_show
c_func
(paren
r_struct
id|seq_file
op_star
id|seq
comma
r_void
op_star
id|v
)paren
(brace
r_int
r_int
id|l
op_assign
(paren
r_int
r_int
)paren
id|v
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|l
)paren
id|seq_puts
c_func
(paren
id|seq
comma
l_string|&quot;IP address       HW type     Flags       &quot;
l_string|&quot;HW address            Mask     Device&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|l
op_le
id|NEIGH_HASHMASK
)paren
id|arp_format_neigh_table
c_func
(paren
id|seq
comma
id|l
)paren
suffix:semicolon
r_else
id|arp_format_pneigh_table
c_func
(paren
id|seq
comma
id|l
op_minus
id|NEIGH_HASHMASK
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|arp_seq_ops
r_struct
id|seq_operations
id|arp_seq_ops
op_assign
(brace
dot
id|start
op_assign
id|arp_seq_start
comma
dot
id|next
op_assign
id|arp_seq_next
comma
dot
id|stop
op_assign
id|arp_seq_stop
comma
dot
id|show
op_assign
id|arp_seq_show
comma
)brace
suffix:semicolon
DECL|function|arp_seq_open
r_static
r_int
id|arp_seq_open
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
(brace
r_return
id|seq_open
c_func
(paren
id|file
comma
op_amp
id|arp_seq_ops
)paren
suffix:semicolon
)brace
DECL|variable|arp_seq_fops
r_static
r_struct
id|file_operations
id|arp_seq_fops
op_assign
(brace
dot
id|open
op_assign
id|arp_seq_open
comma
dot
id|read
op_assign
id|seq_read
comma
dot
id|llseek
op_assign
id|seq_lseek
comma
dot
id|release
op_assign
id|seq_release
comma
)brace
suffix:semicolon
DECL|function|ipv4_proc_init
r_int
id|__init
id|ipv4_proc_init
c_func
(paren
r_void
)paren
(brace
r_struct
id|proc_dir_entry
op_star
id|p
suffix:semicolon
r_int
id|rc
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|proc_net_create
c_func
(paren
l_string|&quot;raw&quot;
comma
l_int|0
comma
id|raw_get_info
)paren
)paren
r_goto
id|out_raw
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|proc_net_create
c_func
(paren
l_string|&quot;netstat&quot;
comma
l_int|0
comma
id|netstat_get_info
)paren
)paren
r_goto
id|out_netstat
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|proc_net_create
c_func
(paren
l_string|&quot;snmp&quot;
comma
l_int|0
comma
id|snmp_get_info
)paren
)paren
r_goto
id|out_snmp
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|proc_net_create
c_func
(paren
l_string|&quot;sockstat&quot;
comma
l_int|0
comma
id|afinet_get_info
)paren
)paren
r_goto
id|out_sockstat
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|proc_net_create
c_func
(paren
l_string|&quot;tcp&quot;
comma
l_int|0
comma
id|tcp_get_info
)paren
)paren
r_goto
id|out_tcp
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|proc_net_create
c_func
(paren
l_string|&quot;udp&quot;
comma
l_int|0
comma
id|udp_get_info
)paren
)paren
r_goto
id|out_udp
suffix:semicolon
id|p
op_assign
id|create_proc_entry
c_func
(paren
l_string|&quot;arp&quot;
comma
id|S_IRUGO
comma
id|proc_net
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|p
)paren
r_goto
id|out_arp
suffix:semicolon
id|p-&gt;proc_fops
op_assign
op_amp
id|arp_seq_fops
suffix:semicolon
id|out
suffix:colon
r_return
id|rc
suffix:semicolon
id|out_arp
suffix:colon
id|proc_net_remove
c_func
(paren
l_string|&quot;udp&quot;
)paren
suffix:semicolon
id|out_udp
suffix:colon
id|proc_net_remove
c_func
(paren
l_string|&quot;tcp&quot;
)paren
suffix:semicolon
id|out_tcp
suffix:colon
id|proc_net_remove
c_func
(paren
l_string|&quot;sockstat&quot;
)paren
suffix:semicolon
id|out_sockstat
suffix:colon
id|proc_net_remove
c_func
(paren
l_string|&quot;snmp&quot;
)paren
suffix:semicolon
id|out_snmp
suffix:colon
id|proc_net_remove
c_func
(paren
l_string|&quot;netstat&quot;
)paren
suffix:semicolon
id|out_netstat
suffix:colon
id|proc_net_remove
c_func
(paren
l_string|&quot;raw&quot;
)paren
suffix:semicolon
id|out_raw
suffix:colon
id|rc
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
macro_line|#else /* CONFIG_PROC_FS */
DECL|function|ipv4_proc_init
r_int
id|__init
id|ipv4_proc_init
c_func
(paren
r_void
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_PROC_FS */
eof
