multiline_comment|/*&n; *&t;Linux NET3:&t;Internet Group Management Protocol  [IGMP]&n; *&n; *&t;This code implements the IGMP protocol as defined in RFC1112. There has&n; *&t;been a further revision of this protocol since which is now supported.&n; *&n; *&t;If you have trouble with this module be careful what gcc you have used,&n; *&t;the older version didn&squot;t come out right using gcc 2.5.8, the newer one&n; *&t;seems to fall out with gcc 2.6.2.&n; *&n; *&t;Version: $Id: igmp.c,v 1.47 2002/02/01 22:01:03 davem Exp $&n; *&n; *&t;Authors:&n; *&t;&t;Alan Cox &lt;Alan.Cox@linux.org&gt;&n; *&n; *&t;This program is free software; you can redistribute it and/or&n; *&t;modify it under the terms of the GNU General Public License&n; *&t;as published by the Free Software Foundation; either version&n; *&t;2 of the License, or (at your option) any later version.&n; *&n; *&t;Fixes:&n; *&n; *&t;&t;Alan Cox&t;:&t;Added lots of __inline__ to optimise&n; *&t;&t;&t;&t;&t;the memory usage of all the tiny little&n; *&t;&t;&t;&t;&t;functions.&n; *&t;&t;Alan Cox&t;:&t;Dumped the header building experiment.&n; *&t;&t;Alan Cox&t;:&t;Minor tweaks ready for multicast routing&n; *&t;&t;&t;&t;&t;and extended IGMP protocol.&n; *&t;&t;Alan Cox&t;:&t;Removed a load of inline directives. Gcc 2.5.8&n; *&t;&t;&t;&t;&t;writes utterly bogus code otherwise (sigh)&n; *&t;&t;&t;&t;&t;fixed IGMP loopback to behave in the manner&n; *&t;&t;&t;&t;&t;desired by mrouted, fixed the fact it has been&n; *&t;&t;&t;&t;&t;broken since 1.3.6 and cleaned up a few minor&n; *&t;&t;&t;&t;&t;points.&n; *&n; *&t;&t;Chih-Jen Chang&t;:&t;Tried to revise IGMP to Version 2&n; *&t;&t;Tsu-Sheng Tsao&t;&t;E-mail: chihjenc@scf.usc.edu and tsusheng@scf.usc.edu&n; *&t;&t;&t;&t;&t;The enhancements are mainly based on Steve Deering&squot;s &n; * &t;&t;&t;&t;&t;ipmulti-3.5 source code.&n; *&t;&t;Chih-Jen Chang&t;:&t;Added the igmp_get_mrouter_info and&n; *&t;&t;Tsu-Sheng Tsao&t;&t;igmp_set_mrouter_info to keep track of&n; *&t;&t;&t;&t;&t;the mrouted version on that device.&n; *&t;&t;Chih-Jen Chang&t;:&t;Added the max_resp_time parameter to&n; *&t;&t;Tsu-Sheng Tsao&t;&t;igmp_heard_query(). Using this parameter&n; *&t;&t;&t;&t;&t;to identify the multicast router version&n; *&t;&t;&t;&t;&t;and do what the IGMP version 2 specified.&n; *&t;&t;Chih-Jen Chang&t;:&t;Added a timer to revert to IGMP V2 router&n; *&t;&t;Tsu-Sheng Tsao&t;&t;if the specified time expired.&n; *&t;&t;Alan Cox&t;:&t;Stop IGMP from 0.0.0.0 being accepted.&n; *&t;&t;Alan Cox&t;:&t;Use GFP_ATOMIC in the right places.&n; *&t;&t;Christian Daudt :&t;igmp timer wasn&squot;t set for local group&n; *&t;&t;&t;&t;&t;memberships but was being deleted, &n; *&t;&t;&t;&t;&t;which caused a &quot;del_timer() called &n; *&t;&t;&t;&t;&t;from %p with timer not initialized&bslash;n&quot;&n; *&t;&t;&t;&t;&t;message (960131).&n; *&t;&t;Christian Daudt :&t;removed del_timer from &n; *&t;&t;&t;&t;&t;igmp_timer_expire function (960205).&n; *             Christian Daudt :       igmp_heard_report now only calls&n; *                                     igmp_timer_expire if tm-&gt;running is&n; *                                     true (960216).&n; *&t;&t;Malcolm Beattie :&t;ttl comparison wrong in igmp_rcv made&n; *&t;&t;&t;&t;&t;igmp_heard_query never trigger. Expiry&n; *&t;&t;&t;&t;&t;miscalculation fixed in igmp_heard_query&n; *&t;&t;&t;&t;&t;and random() made to return unsigned to&n; *&t;&t;&t;&t;&t;prevent negative expiry times.&n; *&t;&t;Alexey Kuznetsov:&t;Wrong group leaving behaviour, backport&n; *&t;&t;&t;&t;&t;fix from pending 2.1.x patches.&n; *&t;&t;Alan Cox:&t;&t;Forget to enable FDDI support earlier.&n; *&t;&t;Alexey Kuznetsov:&t;Fixed leaving groups on device down.&n; *&t;&t;Alexey Kuznetsov:&t;Accordance to igmp-v2-06 draft.&n; *&t;&t;David L Stevens:&t;IGMPv3 support, with help from&n; *&t;&t;&t;&t;&t;Vinay Kulkarni&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;asm/system.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/jiffies.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/socket.h&gt;
macro_line|#include &lt;linux/sockios.h&gt;
macro_line|#include &lt;linux/in.h&gt;
macro_line|#include &lt;linux/inet.h&gt;
macro_line|#include &lt;linux/netdevice.h&gt;
macro_line|#include &lt;linux/skbuff.h&gt;
macro_line|#include &lt;linux/inetdevice.h&gt;
macro_line|#include &lt;linux/igmp.h&gt;
macro_line|#include &lt;linux/if_arp.h&gt;
macro_line|#include &lt;linux/rtnetlink.h&gt;
macro_line|#include &lt;linux/times.h&gt;
macro_line|#include &lt;net/ip.h&gt;
macro_line|#include &lt;net/protocol.h&gt;
macro_line|#include &lt;net/route.h&gt;
macro_line|#include &lt;net/sock.h&gt;
macro_line|#include &lt;net/checksum.h&gt;
macro_line|#include &lt;linux/netfilter_ipv4.h&gt;
macro_line|#ifdef CONFIG_IP_MROUTE
macro_line|#include &lt;linux/mroute.h&gt;
macro_line|#endif
macro_line|#ifdef CONFIG_PROC_FS
macro_line|#include &lt;linux/proc_fs.h&gt;
macro_line|#include &lt;linux/seq_file.h&gt;
macro_line|#endif
DECL|macro|IP_MAX_MEMBERSHIPS
mdefine_line|#define IP_MAX_MEMBERSHIPS&t;20
DECL|macro|IP_MAX_MSF
mdefine_line|#define IP_MAX_MSF&t;&t;10
macro_line|#ifdef CONFIG_IP_MULTICAST
multiline_comment|/* Parameter names and values are taken from igmp-v2-06 draft */
DECL|macro|IGMP_V1_Router_Present_Timeout
mdefine_line|#define IGMP_V1_Router_Present_Timeout&t;&t;(400*HZ)
DECL|macro|IGMP_V2_Router_Present_Timeout
mdefine_line|#define IGMP_V2_Router_Present_Timeout&t;&t;(400*HZ)
DECL|macro|IGMP_Unsolicited_Report_Interval
mdefine_line|#define IGMP_Unsolicited_Report_Interval&t;(10*HZ)
DECL|macro|IGMP_Query_Response_Interval
mdefine_line|#define IGMP_Query_Response_Interval&t;&t;(10*HZ)
DECL|macro|IGMP_Unsolicited_Report_Count
mdefine_line|#define IGMP_Unsolicited_Report_Count&t;&t;2
DECL|macro|IGMP_Initial_Report_Delay
mdefine_line|#define IGMP_Initial_Report_Delay&t;&t;(1)
multiline_comment|/* IGMP_Initial_Report_Delay is not from IGMP specs!&n; * IGMP specs require to report membership immediately after&n; * joining a group, but we delay the first report by a&n; * small interval. It seems more natural and still does not&n; * contradict to specs provided this delay is small enough.&n; */
DECL|macro|IGMP_V1_SEEN
mdefine_line|#define IGMP_V1_SEEN(in_dev) (ipv4_devconf.force_igmp_version == 1 || &bslash;&n;&t;&t;(in_dev)-&gt;cnf.force_igmp_version == 1 || &bslash;&n;&t;&t;((in_dev)-&gt;mr_v1_seen &amp;&amp; &bslash;&n;&t;&t;time_before(jiffies, (in_dev)-&gt;mr_v1_seen)))
DECL|macro|IGMP_V2_SEEN
mdefine_line|#define IGMP_V2_SEEN(in_dev) (ipv4_devconf.force_igmp_version == 2 || &bslash;&n;&t;&t;(in_dev)-&gt;cnf.force_igmp_version == 2 || &bslash;&n;&t;&t;((in_dev)-&gt;mr_v2_seen &amp;&amp; &bslash;&n;&t;&t;time_before(jiffies, (in_dev)-&gt;mr_v2_seen)))
r_static
r_void
id|igmpv3_add_delrec
c_func
(paren
r_struct
id|in_device
op_star
id|in_dev
comma
r_struct
id|ip_mc_list
op_star
id|im
)paren
suffix:semicolon
r_static
r_void
id|igmpv3_del_delrec
c_func
(paren
r_struct
id|in_device
op_star
id|in_dev
comma
id|__u32
id|multiaddr
)paren
suffix:semicolon
r_static
r_void
id|igmpv3_clear_delrec
c_func
(paren
r_struct
id|in_device
op_star
id|in_dev
)paren
suffix:semicolon
r_static
r_int
id|sf_setstate
c_func
(paren
r_struct
id|ip_mc_list
op_star
id|pmc
)paren
suffix:semicolon
r_static
r_void
id|sf_markstate
c_func
(paren
r_struct
id|ip_mc_list
op_star
id|pmc
)paren
suffix:semicolon
macro_line|#endif
r_static
r_void
id|ip_mc_clear_src
c_func
(paren
r_struct
id|ip_mc_list
op_star
id|pmc
)paren
suffix:semicolon
r_static
r_int
id|ip_mc_add_src
c_func
(paren
r_struct
id|in_device
op_star
id|in_dev
comma
id|__u32
op_star
id|pmca
comma
r_int
id|sfmode
comma
r_int
id|sfcount
comma
id|__u32
op_star
id|psfsrc
comma
r_int
id|delta
)paren
suffix:semicolon
DECL|function|ip_ma_put
r_static
r_void
id|ip_ma_put
c_func
(paren
r_struct
id|ip_mc_list
op_star
id|im
)paren
(brace
r_if
c_cond
(paren
id|atomic_dec_and_test
c_func
(paren
op_amp
id|im-&gt;refcnt
)paren
)paren
(brace
id|in_dev_put
c_func
(paren
id|im-&gt;interface
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|im
)paren
suffix:semicolon
)brace
)brace
macro_line|#ifdef CONFIG_IP_MULTICAST
multiline_comment|/*&n; *&t;Timer management&n; */
DECL|function|igmp_stop_timer
r_static
id|__inline__
r_void
id|igmp_stop_timer
c_func
(paren
r_struct
id|ip_mc_list
op_star
id|im
)paren
(brace
id|spin_lock_bh
c_func
(paren
op_amp
id|im-&gt;lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|del_timer
c_func
(paren
op_amp
id|im-&gt;timer
)paren
)paren
id|atomic_dec
c_func
(paren
op_amp
id|im-&gt;refcnt
)paren
suffix:semicolon
id|im-&gt;tm_running
op_assign
l_int|0
suffix:semicolon
id|im-&gt;reporter
op_assign
l_int|0
suffix:semicolon
id|im-&gt;unsolicit_count
op_assign
l_int|0
suffix:semicolon
id|spin_unlock_bh
c_func
(paren
op_amp
id|im-&gt;lock
)paren
suffix:semicolon
)brace
multiline_comment|/* It must be called with locked im-&gt;lock */
DECL|function|igmp_start_timer
r_static
r_void
id|igmp_start_timer
c_func
(paren
r_struct
id|ip_mc_list
op_star
id|im
comma
r_int
id|max_delay
)paren
(brace
r_int
id|tv
op_assign
id|net_random
c_func
(paren
)paren
op_mod
id|max_delay
suffix:semicolon
id|im-&gt;tm_running
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|mod_timer
c_func
(paren
op_amp
id|im-&gt;timer
comma
id|jiffies
op_plus
id|tv
op_plus
l_int|2
)paren
)paren
id|atomic_inc
c_func
(paren
op_amp
id|im-&gt;refcnt
)paren
suffix:semicolon
)brace
DECL|function|igmp_gq_start_timer
r_static
r_void
id|igmp_gq_start_timer
c_func
(paren
r_struct
id|in_device
op_star
id|in_dev
)paren
(brace
r_int
id|tv
op_assign
id|net_random
c_func
(paren
)paren
op_mod
id|in_dev-&gt;mr_maxdelay
suffix:semicolon
id|in_dev-&gt;mr_gq_running
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|mod_timer
c_func
(paren
op_amp
id|in_dev-&gt;mr_gq_timer
comma
id|jiffies
op_plus
id|tv
op_plus
l_int|2
)paren
)paren
id|in_dev_hold
c_func
(paren
id|in_dev
)paren
suffix:semicolon
)brace
DECL|function|igmp_ifc_start_timer
r_static
r_void
id|igmp_ifc_start_timer
c_func
(paren
r_struct
id|in_device
op_star
id|in_dev
comma
r_int
id|delay
)paren
(brace
r_int
id|tv
op_assign
id|net_random
c_func
(paren
)paren
op_mod
id|delay
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|mod_timer
c_func
(paren
op_amp
id|in_dev-&gt;mr_ifc_timer
comma
id|jiffies
op_plus
id|tv
op_plus
l_int|2
)paren
)paren
id|in_dev_hold
c_func
(paren
id|in_dev
)paren
suffix:semicolon
)brace
DECL|function|igmp_mod_timer
r_static
r_void
id|igmp_mod_timer
c_func
(paren
r_struct
id|ip_mc_list
op_star
id|im
comma
r_int
id|max_delay
)paren
(brace
id|spin_lock_bh
c_func
(paren
op_amp
id|im-&gt;lock
)paren
suffix:semicolon
id|im-&gt;unsolicit_count
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|del_timer
c_func
(paren
op_amp
id|im-&gt;timer
)paren
)paren
(brace
r_if
c_cond
(paren
(paren
r_int
)paren
(paren
id|im-&gt;timer.expires
op_minus
id|jiffies
)paren
OL
id|max_delay
)paren
(brace
id|add_timer
c_func
(paren
op_amp
id|im-&gt;timer
)paren
suffix:semicolon
id|im-&gt;tm_running
op_assign
l_int|1
suffix:semicolon
id|spin_unlock_bh
c_func
(paren
op_amp
id|im-&gt;lock
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|atomic_dec
c_func
(paren
op_amp
id|im-&gt;refcnt
)paren
suffix:semicolon
)brace
id|igmp_start_timer
c_func
(paren
id|im
comma
id|max_delay
)paren
suffix:semicolon
id|spin_unlock_bh
c_func
(paren
op_amp
id|im-&gt;lock
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;Send an IGMP report.&n; */
DECL|macro|IGMP_SIZE
mdefine_line|#define IGMP_SIZE (sizeof(struct igmphdr)+sizeof(struct iphdr)+4)
DECL|function|is_in
r_static
r_int
id|is_in
c_func
(paren
r_struct
id|ip_mc_list
op_star
id|pmc
comma
r_struct
id|ip_sf_list
op_star
id|psf
comma
r_int
id|type
comma
r_int
id|gdeleted
comma
r_int
id|sdeleted
)paren
(brace
r_switch
c_cond
(paren
id|type
)paren
(brace
r_case
id|IGMPV3_MODE_IS_INCLUDE
suffix:colon
r_case
id|IGMPV3_MODE_IS_EXCLUDE
suffix:colon
r_if
c_cond
(paren
id|gdeleted
op_logical_or
id|sdeleted
)paren
r_return
l_int|0
suffix:semicolon
r_return
op_logical_neg
(paren
id|pmc-&gt;gsquery
op_logical_and
op_logical_neg
id|psf-&gt;sf_gsresp
)paren
suffix:semicolon
r_case
id|IGMPV3_CHANGE_TO_INCLUDE
suffix:colon
r_if
c_cond
(paren
id|gdeleted
op_logical_or
id|sdeleted
)paren
r_return
l_int|0
suffix:semicolon
r_return
id|psf-&gt;sf_count
(braket
id|MCAST_INCLUDE
)braket
op_ne
l_int|0
suffix:semicolon
r_case
id|IGMPV3_CHANGE_TO_EXCLUDE
suffix:colon
r_if
c_cond
(paren
id|gdeleted
op_logical_or
id|sdeleted
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|pmc-&gt;sfcount
(braket
id|MCAST_EXCLUDE
)braket
op_eq
l_int|0
op_logical_or
id|psf-&gt;sf_count
(braket
id|MCAST_INCLUDE
)braket
)paren
r_return
l_int|0
suffix:semicolon
r_return
id|pmc-&gt;sfcount
(braket
id|MCAST_EXCLUDE
)braket
op_eq
id|psf-&gt;sf_count
(braket
id|MCAST_EXCLUDE
)braket
suffix:semicolon
r_case
id|IGMPV3_ALLOW_NEW_SOURCES
suffix:colon
r_if
c_cond
(paren
id|gdeleted
op_logical_or
op_logical_neg
id|psf-&gt;sf_crcount
)paren
r_return
l_int|0
suffix:semicolon
r_return
(paren
id|pmc-&gt;sfmode
op_eq
id|MCAST_INCLUDE
)paren
op_xor
id|sdeleted
suffix:semicolon
r_case
id|IGMPV3_BLOCK_OLD_SOURCES
suffix:colon
r_if
c_cond
(paren
id|pmc-&gt;sfmode
op_eq
id|MCAST_INCLUDE
)paren
r_return
id|gdeleted
op_logical_or
(paren
id|psf-&gt;sf_crcount
op_logical_and
id|sdeleted
)paren
suffix:semicolon
r_return
id|psf-&gt;sf_crcount
op_logical_and
op_logical_neg
id|gdeleted
op_logical_and
op_logical_neg
id|sdeleted
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|igmp_scount
id|igmp_scount
c_func
(paren
r_struct
id|ip_mc_list
op_star
id|pmc
comma
r_int
id|type
comma
r_int
id|gdeleted
comma
r_int
id|sdeleted
)paren
(brace
r_struct
id|ip_sf_list
op_star
id|psf
suffix:semicolon
r_int
id|scount
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|psf
op_assign
id|pmc-&gt;sources
suffix:semicolon
id|psf
suffix:semicolon
id|psf
op_assign
id|psf-&gt;sf_next
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|is_in
c_func
(paren
id|pmc
comma
id|psf
comma
id|type
comma
id|gdeleted
comma
id|sdeleted
)paren
)paren
r_continue
suffix:semicolon
id|scount
op_increment
suffix:semicolon
)brace
r_return
id|scount
suffix:semicolon
)brace
DECL|function|igmpv3_newpack
r_static
r_struct
id|sk_buff
op_star
id|igmpv3_newpack
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|size
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_struct
id|rtable
op_star
id|rt
suffix:semicolon
r_struct
id|iphdr
op_star
id|pip
suffix:semicolon
r_struct
id|igmpv3_report
op_star
id|pig
suffix:semicolon
id|skb
op_assign
id|alloc_skb
c_func
(paren
id|size
op_plus
id|LL_RESERVED_SPACE
c_func
(paren
id|dev
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_eq
l_int|NULL
)paren
r_return
l_int|NULL
suffix:semicolon
(brace
r_struct
id|flowi
id|fl
op_assign
(brace
dot
id|oif
op_assign
id|dev-&gt;ifindex
comma
dot
id|nl_u
op_assign
(brace
dot
id|ip4_u
op_assign
(brace
dot
id|daddr
op_assign
id|IGMPV3_ALL_MCR
)brace
)brace
comma
dot
id|proto
op_assign
id|IPPROTO_IGMP
)brace
suffix:semicolon
r_if
c_cond
(paren
id|ip_route_output_key
c_func
(paren
op_amp
id|rt
comma
op_amp
id|fl
)paren
)paren
(brace
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|rt-&gt;rt_src
op_eq
l_int|0
)paren
(brace
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
id|ip_rt_put
c_func
(paren
id|rt
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|skb-&gt;dst
op_assign
op_amp
id|rt-&gt;u.dst
suffix:semicolon
id|skb-&gt;dev
op_assign
id|dev
suffix:semicolon
id|skb_reserve
c_func
(paren
id|skb
comma
id|LL_RESERVED_SPACE
c_func
(paren
id|dev
)paren
)paren
suffix:semicolon
id|skb-&gt;nh.iph
op_assign
id|pip
op_assign
(paren
r_struct
id|iphdr
op_star
)paren
id|skb_put
c_func
(paren
id|skb
comma
r_sizeof
(paren
r_struct
id|iphdr
)paren
op_plus
l_int|4
)paren
suffix:semicolon
id|pip-&gt;version
op_assign
l_int|4
suffix:semicolon
id|pip-&gt;ihl
op_assign
(paren
r_sizeof
(paren
r_struct
id|iphdr
)paren
op_plus
l_int|4
)paren
op_rshift
l_int|2
suffix:semicolon
id|pip-&gt;tos
op_assign
l_int|0xc0
suffix:semicolon
id|pip-&gt;frag_off
op_assign
id|htons
c_func
(paren
id|IP_DF
)paren
suffix:semicolon
id|pip-&gt;ttl
op_assign
l_int|1
suffix:semicolon
id|pip-&gt;daddr
op_assign
id|rt-&gt;rt_dst
suffix:semicolon
id|pip-&gt;saddr
op_assign
id|rt-&gt;rt_src
suffix:semicolon
id|pip-&gt;protocol
op_assign
id|IPPROTO_IGMP
suffix:semicolon
id|pip-&gt;tot_len
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* filled in later */
id|ip_select_ident
c_func
(paren
id|pip
comma
op_amp
id|rt-&gt;u.dst
comma
l_int|NULL
)paren
suffix:semicolon
(paren
(paren
id|u8
op_star
)paren
op_amp
id|pip
(braket
l_int|1
)braket
)paren
(braket
l_int|0
)braket
op_assign
id|IPOPT_RA
suffix:semicolon
(paren
(paren
id|u8
op_star
)paren
op_amp
id|pip
(braket
l_int|1
)braket
)paren
(braket
l_int|1
)braket
op_assign
l_int|4
suffix:semicolon
(paren
(paren
id|u8
op_star
)paren
op_amp
id|pip
(braket
l_int|1
)braket
)paren
(braket
l_int|2
)braket
op_assign
l_int|0
suffix:semicolon
(paren
(paren
id|u8
op_star
)paren
op_amp
id|pip
(braket
l_int|1
)braket
)paren
(braket
l_int|3
)braket
op_assign
l_int|0
suffix:semicolon
id|pig
op_assign
(paren
r_struct
id|igmpv3_report
op_star
)paren
id|skb_put
c_func
(paren
id|skb
comma
r_sizeof
(paren
op_star
id|pig
)paren
)paren
suffix:semicolon
id|skb-&gt;h.igmph
op_assign
(paren
r_struct
id|igmphdr
op_star
)paren
id|pig
suffix:semicolon
id|pig-&gt;type
op_assign
id|IGMPV3_HOST_MEMBERSHIP_REPORT
suffix:semicolon
id|pig-&gt;resv1
op_assign
l_int|0
suffix:semicolon
id|pig-&gt;csum
op_assign
l_int|0
suffix:semicolon
id|pig-&gt;resv2
op_assign
l_int|0
suffix:semicolon
id|pig-&gt;ngrec
op_assign
l_int|0
suffix:semicolon
r_return
id|skb
suffix:semicolon
)brace
DECL|function|igmpv3_sendpack
r_static
r_int
id|igmpv3_sendpack
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|iphdr
op_star
id|pip
op_assign
id|skb-&gt;nh.iph
suffix:semicolon
r_struct
id|igmphdr
op_star
id|pig
op_assign
id|skb-&gt;h.igmph
suffix:semicolon
r_int
id|iplen
comma
id|igmplen
suffix:semicolon
id|iplen
op_assign
id|skb-&gt;tail
op_minus
(paren
r_int
r_char
op_star
)paren
id|skb-&gt;nh.iph
suffix:semicolon
id|pip-&gt;tot_len
op_assign
id|htons
c_func
(paren
id|iplen
)paren
suffix:semicolon
id|ip_send_check
c_func
(paren
id|pip
)paren
suffix:semicolon
id|igmplen
op_assign
id|skb-&gt;tail
op_minus
(paren
r_int
r_char
op_star
)paren
id|skb-&gt;h.igmph
suffix:semicolon
id|pig-&gt;csum
op_assign
id|ip_compute_csum
c_func
(paren
(paren
r_void
op_star
)paren
id|skb-&gt;h.igmph
comma
id|igmplen
)paren
suffix:semicolon
r_return
id|NF_HOOK
c_func
(paren
id|PF_INET
comma
id|NF_IP_LOCAL_OUT
comma
id|skb
comma
l_int|NULL
comma
id|skb-&gt;dev
comma
id|dst_output
)paren
suffix:semicolon
)brace
DECL|function|grec_size
r_static
r_int
id|grec_size
c_func
(paren
r_struct
id|ip_mc_list
op_star
id|pmc
comma
r_int
id|type
comma
r_int
id|gdel
comma
r_int
id|sdel
)paren
(brace
r_return
r_sizeof
(paren
r_struct
id|igmpv3_grec
)paren
op_plus
l_int|4
op_star
id|igmp_scount
c_func
(paren
id|pmc
comma
id|type
comma
id|gdel
comma
id|sdel
)paren
suffix:semicolon
)brace
DECL|function|add_grhead
r_static
r_struct
id|sk_buff
op_star
id|add_grhead
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|ip_mc_list
op_star
id|pmc
comma
r_int
id|type
comma
r_struct
id|igmpv3_grec
op_star
op_star
id|ppgr
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
id|pmc-&gt;interface-&gt;dev
suffix:semicolon
r_struct
id|igmpv3_report
op_star
id|pih
suffix:semicolon
r_struct
id|igmpv3_grec
op_star
id|pgr
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
id|skb
op_assign
id|igmpv3_newpack
c_func
(paren
id|dev
comma
id|dev-&gt;mtu
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
r_return
l_int|NULL
suffix:semicolon
id|pgr
op_assign
(paren
r_struct
id|igmpv3_grec
op_star
)paren
id|skb_put
c_func
(paren
id|skb
comma
r_sizeof
(paren
r_struct
id|igmpv3_grec
)paren
)paren
suffix:semicolon
id|pgr-&gt;grec_type
op_assign
id|type
suffix:semicolon
id|pgr-&gt;grec_auxwords
op_assign
l_int|0
suffix:semicolon
id|pgr-&gt;grec_nsrcs
op_assign
l_int|0
suffix:semicolon
id|pgr-&gt;grec_mca
op_assign
id|pmc-&gt;multiaddr
suffix:semicolon
id|pih
op_assign
(paren
r_struct
id|igmpv3_report
op_star
)paren
id|skb-&gt;h.igmph
suffix:semicolon
id|pih-&gt;ngrec
op_assign
id|htons
c_func
(paren
id|ntohs
c_func
(paren
id|pih-&gt;ngrec
)paren
op_plus
l_int|1
)paren
suffix:semicolon
op_star
id|ppgr
op_assign
id|pgr
suffix:semicolon
r_return
id|skb
suffix:semicolon
)brace
DECL|macro|AVAILABLE
mdefine_line|#define AVAILABLE(skb) ((skb) ? ((skb)-&gt;dev ? (skb)-&gt;dev-&gt;mtu - (skb)-&gt;len : &bslash;&n;&t;skb_tailroom(skb)) : 0)
DECL|function|add_grec
r_static
r_struct
id|sk_buff
op_star
id|add_grec
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|ip_mc_list
op_star
id|pmc
comma
r_int
id|type
comma
r_int
id|gdeleted
comma
r_int
id|sdeleted
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
id|pmc-&gt;interface-&gt;dev
suffix:semicolon
r_struct
id|igmpv3_report
op_star
id|pih
suffix:semicolon
r_struct
id|igmpv3_grec
op_star
id|pgr
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|ip_sf_list
op_star
id|psf
comma
op_star
id|psf_next
comma
op_star
id|psf_prev
comma
op_star
op_star
id|psf_list
suffix:semicolon
r_int
id|scount
comma
id|first
comma
id|isquery
comma
id|truncate
suffix:semicolon
r_if
c_cond
(paren
id|pmc-&gt;multiaddr
op_eq
id|IGMP_ALL_HOSTS
)paren
r_return
id|skb
suffix:semicolon
id|isquery
op_assign
id|type
op_eq
id|IGMPV3_MODE_IS_INCLUDE
op_logical_or
id|type
op_eq
id|IGMPV3_MODE_IS_EXCLUDE
suffix:semicolon
id|truncate
op_assign
id|type
op_eq
id|IGMPV3_MODE_IS_EXCLUDE
op_logical_or
id|type
op_eq
id|IGMPV3_CHANGE_TO_EXCLUDE
suffix:semicolon
id|psf_list
op_assign
id|sdeleted
ques
c_cond
op_amp
id|pmc-&gt;tomb
suffix:colon
op_amp
id|pmc-&gt;sources
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
op_star
id|psf_list
)paren
(brace
r_if
c_cond
(paren
id|type
op_eq
id|IGMPV3_ALLOW_NEW_SOURCES
op_logical_or
id|type
op_eq
id|IGMPV3_BLOCK_OLD_SOURCES
)paren
r_return
id|skb
suffix:semicolon
r_if
c_cond
(paren
id|pmc-&gt;crcount
op_logical_or
id|isquery
)paren
(brace
multiline_comment|/* make sure we have room for group header and at&n;&t;&t;&t; * least one source.&n;&t;&t;&t; */
r_if
c_cond
(paren
id|skb
op_logical_and
id|AVAILABLE
c_func
(paren
id|skb
)paren
OL
r_sizeof
(paren
r_struct
id|igmpv3_grec
)paren
op_plus
r_sizeof
(paren
id|__u32
)paren
)paren
(brace
id|igmpv3_sendpack
c_func
(paren
id|skb
)paren
suffix:semicolon
id|skb
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/* add_grhead will get a new one */
)brace
id|skb
op_assign
id|add_grhead
c_func
(paren
id|skb
comma
id|pmc
comma
id|type
comma
op_amp
id|pgr
)paren
suffix:semicolon
)brace
r_return
id|skb
suffix:semicolon
)brace
id|pih
op_assign
id|skb
ques
c_cond
(paren
r_struct
id|igmpv3_report
op_star
)paren
id|skb-&gt;h.igmph
suffix:colon
l_int|NULL
suffix:semicolon
multiline_comment|/* EX and TO_EX get a fresh packet, if needed */
r_if
c_cond
(paren
id|truncate
)paren
(brace
r_if
c_cond
(paren
id|pih
op_logical_and
id|pih-&gt;ngrec
op_logical_and
id|AVAILABLE
c_func
(paren
id|skb
)paren
OL
id|grec_size
c_func
(paren
id|pmc
comma
id|type
comma
id|gdeleted
comma
id|sdeleted
)paren
)paren
(brace
r_if
c_cond
(paren
id|skb
)paren
id|igmpv3_sendpack
c_func
(paren
id|skb
)paren
suffix:semicolon
id|skb
op_assign
id|igmpv3_newpack
c_func
(paren
id|dev
comma
id|dev-&gt;mtu
)paren
suffix:semicolon
)brace
)brace
id|first
op_assign
l_int|1
suffix:semicolon
id|scount
op_assign
l_int|0
suffix:semicolon
id|psf_prev
op_assign
l_int|NULL
suffix:semicolon
r_for
c_loop
(paren
id|psf
op_assign
op_star
id|psf_list
suffix:semicolon
id|psf
suffix:semicolon
id|psf
op_assign
id|psf_next
)paren
(brace
id|u32
op_star
id|psrc
suffix:semicolon
id|psf_next
op_assign
id|psf-&gt;sf_next
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|is_in
c_func
(paren
id|pmc
comma
id|psf
comma
id|type
comma
id|gdeleted
comma
id|sdeleted
)paren
)paren
(brace
id|psf_prev
op_assign
id|psf
suffix:semicolon
r_continue
suffix:semicolon
)brace
multiline_comment|/* clear marks on query responses */
r_if
c_cond
(paren
id|isquery
)paren
id|psf-&gt;sf_gsresp
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|AVAILABLE
c_func
(paren
id|skb
)paren
OL
r_sizeof
(paren
id|u32
)paren
op_plus
id|first
op_star
r_sizeof
(paren
r_struct
id|igmpv3_grec
)paren
)paren
(brace
r_if
c_cond
(paren
id|truncate
op_logical_and
op_logical_neg
id|first
)paren
r_break
suffix:semicolon
multiline_comment|/* truncate these */
r_if
c_cond
(paren
id|pgr
)paren
id|pgr-&gt;grec_nsrcs
op_assign
id|htons
c_func
(paren
id|scount
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
)paren
id|igmpv3_sendpack
c_func
(paren
id|skb
)paren
suffix:semicolon
id|skb
op_assign
id|igmpv3_newpack
c_func
(paren
id|dev
comma
id|dev-&gt;mtu
)paren
suffix:semicolon
id|first
op_assign
l_int|1
suffix:semicolon
id|scount
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|first
)paren
(brace
id|skb
op_assign
id|add_grhead
c_func
(paren
id|skb
comma
id|pmc
comma
id|type
comma
op_amp
id|pgr
)paren
suffix:semicolon
id|first
op_assign
l_int|0
suffix:semicolon
)brace
id|psrc
op_assign
(paren
id|u32
op_star
)paren
id|skb_put
c_func
(paren
id|skb
comma
r_sizeof
(paren
id|u32
)paren
)paren
suffix:semicolon
op_star
id|psrc
op_assign
id|psf-&gt;sf_inaddr
suffix:semicolon
id|scount
op_increment
suffix:semicolon
r_if
c_cond
(paren
(paren
id|type
op_eq
id|IGMPV3_ALLOW_NEW_SOURCES
op_logical_or
id|type
op_eq
id|IGMPV3_BLOCK_OLD_SOURCES
)paren
op_logical_and
id|psf-&gt;sf_crcount
)paren
(brace
id|psf-&gt;sf_crcount
op_decrement
suffix:semicolon
r_if
c_cond
(paren
(paren
id|sdeleted
op_logical_or
id|gdeleted
)paren
op_logical_and
id|psf-&gt;sf_crcount
op_eq
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|psf_prev
)paren
id|psf_prev-&gt;sf_next
op_assign
id|psf-&gt;sf_next
suffix:semicolon
r_else
op_star
id|psf_list
op_assign
id|psf-&gt;sf_next
suffix:semicolon
id|kfree
c_func
(paren
id|psf
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
)brace
id|psf_prev
op_assign
id|psf
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pgr
)paren
id|pgr-&gt;grec_nsrcs
op_assign
id|htons
c_func
(paren
id|scount
)paren
suffix:semicolon
r_if
c_cond
(paren
id|isquery
)paren
id|pmc-&gt;gsquery
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* clear query state on report */
r_return
id|skb
suffix:semicolon
)brace
DECL|function|igmpv3_send_report
r_static
r_int
id|igmpv3_send_report
c_func
(paren
r_struct
id|in_device
op_star
id|in_dev
comma
r_struct
id|ip_mc_list
op_star
id|pmc
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
op_assign
l_int|NULL
suffix:semicolon
r_int
id|type
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pmc
)paren
(brace
id|read_lock
c_func
(paren
op_amp
id|in_dev-&gt;mc_list_lock
)paren
suffix:semicolon
r_for
c_loop
(paren
id|pmc
op_assign
id|in_dev-&gt;mc_list
suffix:semicolon
id|pmc
suffix:semicolon
id|pmc
op_assign
id|pmc-&gt;next
)paren
(brace
r_if
c_cond
(paren
id|pmc-&gt;multiaddr
op_eq
id|IGMP_ALL_HOSTS
)paren
r_continue
suffix:semicolon
id|spin_lock_bh
c_func
(paren
op_amp
id|pmc-&gt;lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pmc-&gt;sfcount
(braket
id|MCAST_EXCLUDE
)braket
)paren
id|type
op_assign
id|IGMPV3_MODE_IS_EXCLUDE
suffix:semicolon
r_else
id|type
op_assign
id|IGMPV3_MODE_IS_INCLUDE
suffix:semicolon
id|skb
op_assign
id|add_grec
c_func
(paren
id|skb
comma
id|pmc
comma
id|type
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|spin_unlock_bh
c_func
(paren
op_amp
id|pmc-&gt;lock
)paren
suffix:semicolon
)brace
id|read_unlock
c_func
(paren
op_amp
id|in_dev-&gt;mc_list_lock
)paren
suffix:semicolon
)brace
r_else
(brace
id|spin_lock_bh
c_func
(paren
op_amp
id|pmc-&gt;lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pmc-&gt;sfcount
(braket
id|MCAST_EXCLUDE
)braket
)paren
id|type
op_assign
id|IGMPV3_MODE_IS_EXCLUDE
suffix:semicolon
r_else
id|type
op_assign
id|IGMPV3_MODE_IS_INCLUDE
suffix:semicolon
id|skb
op_assign
id|add_grec
c_func
(paren
id|skb
comma
id|pmc
comma
id|type
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|spin_unlock_bh
c_func
(paren
op_amp
id|pmc-&gt;lock
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
r_return
l_int|0
suffix:semicolon
r_return
id|igmpv3_sendpack
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * remove zero-count source records from a source filter list&n; */
DECL|function|igmpv3_clear_zeros
r_static
r_void
id|igmpv3_clear_zeros
c_func
(paren
r_struct
id|ip_sf_list
op_star
op_star
id|ppsf
)paren
(brace
r_struct
id|ip_sf_list
op_star
id|psf_prev
comma
op_star
id|psf_next
comma
op_star
id|psf
suffix:semicolon
id|psf_prev
op_assign
l_int|NULL
suffix:semicolon
r_for
c_loop
(paren
id|psf
op_assign
op_star
id|ppsf
suffix:semicolon
id|psf
suffix:semicolon
id|psf
op_assign
id|psf_next
)paren
(brace
id|psf_next
op_assign
id|psf-&gt;sf_next
suffix:semicolon
r_if
c_cond
(paren
id|psf-&gt;sf_crcount
op_eq
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|psf_prev
)paren
id|psf_prev-&gt;sf_next
op_assign
id|psf-&gt;sf_next
suffix:semicolon
r_else
op_star
id|ppsf
op_assign
id|psf-&gt;sf_next
suffix:semicolon
id|kfree
c_func
(paren
id|psf
)paren
suffix:semicolon
)brace
r_else
id|psf_prev
op_assign
id|psf
suffix:semicolon
)brace
)brace
DECL|function|igmpv3_send_cr
r_static
r_void
id|igmpv3_send_cr
c_func
(paren
r_struct
id|in_device
op_star
id|in_dev
)paren
(brace
r_struct
id|ip_mc_list
op_star
id|pmc
comma
op_star
id|pmc_prev
comma
op_star
id|pmc_next
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
op_assign
l_int|NULL
suffix:semicolon
r_int
id|type
comma
id|dtype
suffix:semicolon
id|read_lock
c_func
(paren
op_amp
id|in_dev-&gt;mc_list_lock
)paren
suffix:semicolon
id|spin_lock_bh
c_func
(paren
op_amp
id|in_dev-&gt;mc_tomb_lock
)paren
suffix:semicolon
multiline_comment|/* deleted MCA&squot;s */
id|pmc_prev
op_assign
l_int|NULL
suffix:semicolon
r_for
c_loop
(paren
id|pmc
op_assign
id|in_dev-&gt;mc_tomb
suffix:semicolon
id|pmc
suffix:semicolon
id|pmc
op_assign
id|pmc_next
)paren
(brace
id|pmc_next
op_assign
id|pmc-&gt;next
suffix:semicolon
r_if
c_cond
(paren
id|pmc-&gt;sfmode
op_eq
id|MCAST_INCLUDE
)paren
(brace
id|type
op_assign
id|IGMPV3_BLOCK_OLD_SOURCES
suffix:semicolon
id|dtype
op_assign
id|IGMPV3_BLOCK_OLD_SOURCES
suffix:semicolon
id|skb
op_assign
id|add_grec
c_func
(paren
id|skb
comma
id|pmc
comma
id|type
comma
l_int|1
comma
l_int|0
)paren
suffix:semicolon
id|skb
op_assign
id|add_grec
c_func
(paren
id|skb
comma
id|pmc
comma
id|dtype
comma
l_int|1
comma
l_int|1
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pmc-&gt;crcount
)paren
(brace
id|pmc-&gt;crcount
op_decrement
suffix:semicolon
r_if
c_cond
(paren
id|pmc-&gt;sfmode
op_eq
id|MCAST_EXCLUDE
)paren
(brace
id|type
op_assign
id|IGMPV3_CHANGE_TO_INCLUDE
suffix:semicolon
id|skb
op_assign
id|add_grec
c_func
(paren
id|skb
comma
id|pmc
comma
id|type
comma
l_int|1
comma
l_int|0
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pmc-&gt;crcount
op_eq
l_int|0
)paren
(brace
id|igmpv3_clear_zeros
c_func
(paren
op_amp
id|pmc-&gt;tomb
)paren
suffix:semicolon
id|igmpv3_clear_zeros
c_func
(paren
op_amp
id|pmc-&gt;sources
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|pmc-&gt;crcount
op_eq
l_int|0
op_logical_and
op_logical_neg
id|pmc-&gt;tomb
op_logical_and
op_logical_neg
id|pmc-&gt;sources
)paren
(brace
r_if
c_cond
(paren
id|pmc_prev
)paren
id|pmc_prev-&gt;next
op_assign
id|pmc_next
suffix:semicolon
r_else
id|in_dev-&gt;mc_tomb
op_assign
id|pmc_next
suffix:semicolon
id|in_dev_put
c_func
(paren
id|pmc-&gt;interface
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|pmc
)paren
suffix:semicolon
)brace
r_else
id|pmc_prev
op_assign
id|pmc
suffix:semicolon
)brace
id|spin_unlock_bh
c_func
(paren
op_amp
id|in_dev-&gt;mc_tomb_lock
)paren
suffix:semicolon
multiline_comment|/* change recs */
r_for
c_loop
(paren
id|pmc
op_assign
id|in_dev-&gt;mc_list
suffix:semicolon
id|pmc
suffix:semicolon
id|pmc
op_assign
id|pmc-&gt;next
)paren
(brace
id|spin_lock_bh
c_func
(paren
op_amp
id|pmc-&gt;lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pmc-&gt;sfcount
(braket
id|MCAST_EXCLUDE
)braket
)paren
(brace
id|type
op_assign
id|IGMPV3_BLOCK_OLD_SOURCES
suffix:semicolon
id|dtype
op_assign
id|IGMPV3_ALLOW_NEW_SOURCES
suffix:semicolon
)brace
r_else
(brace
id|type
op_assign
id|IGMPV3_ALLOW_NEW_SOURCES
suffix:semicolon
id|dtype
op_assign
id|IGMPV3_BLOCK_OLD_SOURCES
suffix:semicolon
)brace
id|skb
op_assign
id|add_grec
c_func
(paren
id|skb
comma
id|pmc
comma
id|type
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|skb
op_assign
id|add_grec
c_func
(paren
id|skb
comma
id|pmc
comma
id|dtype
comma
l_int|0
comma
l_int|1
)paren
suffix:semicolon
multiline_comment|/* deleted sources */
multiline_comment|/* filter mode changes */
r_if
c_cond
(paren
id|pmc-&gt;crcount
)paren
(brace
id|pmc-&gt;crcount
op_decrement
suffix:semicolon
r_if
c_cond
(paren
id|pmc-&gt;sfmode
op_eq
id|MCAST_EXCLUDE
)paren
id|type
op_assign
id|IGMPV3_CHANGE_TO_EXCLUDE
suffix:semicolon
r_else
id|type
op_assign
id|IGMPV3_CHANGE_TO_INCLUDE
suffix:semicolon
id|skb
op_assign
id|add_grec
c_func
(paren
id|skb
comma
id|pmc
comma
id|type
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
)brace
id|spin_unlock_bh
c_func
(paren
op_amp
id|pmc-&gt;lock
)paren
suffix:semicolon
)brace
id|read_unlock
c_func
(paren
op_amp
id|in_dev-&gt;mc_list_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
r_return
suffix:semicolon
(paren
r_void
)paren
id|igmpv3_sendpack
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
DECL|function|igmp_send_report
r_static
r_int
id|igmp_send_report
c_func
(paren
r_struct
id|in_device
op_star
id|in_dev
comma
r_struct
id|ip_mc_list
op_star
id|pmc
comma
r_int
id|type
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_struct
id|iphdr
op_star
id|iph
suffix:semicolon
r_struct
id|igmphdr
op_star
id|ih
suffix:semicolon
r_struct
id|rtable
op_star
id|rt
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
op_assign
id|in_dev-&gt;dev
suffix:semicolon
id|u32
id|group
op_assign
id|pmc
ques
c_cond
id|pmc-&gt;multiaddr
suffix:colon
l_int|0
suffix:semicolon
id|u32
id|dst
suffix:semicolon
r_if
c_cond
(paren
id|type
op_eq
id|IGMPV3_HOST_MEMBERSHIP_REPORT
)paren
r_return
id|igmpv3_send_report
c_func
(paren
id|in_dev
comma
id|pmc
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|type
op_eq
id|IGMP_HOST_LEAVE_MESSAGE
)paren
id|dst
op_assign
id|IGMP_ALL_ROUTER
suffix:semicolon
r_else
id|dst
op_assign
id|group
suffix:semicolon
(brace
r_struct
id|flowi
id|fl
op_assign
(brace
dot
id|oif
op_assign
id|dev-&gt;ifindex
comma
dot
id|nl_u
op_assign
(brace
dot
id|ip4_u
op_assign
(brace
dot
id|daddr
op_assign
id|dst
)brace
)brace
comma
dot
id|proto
op_assign
id|IPPROTO_IGMP
)brace
suffix:semicolon
r_if
c_cond
(paren
id|ip_route_output_key
c_func
(paren
op_amp
id|rt
comma
op_amp
id|fl
)paren
)paren
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|rt-&gt;rt_src
op_eq
l_int|0
)paren
(brace
id|ip_rt_put
c_func
(paren
id|rt
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|skb
op_assign
id|alloc_skb
c_func
(paren
id|IGMP_SIZE
op_plus
id|LL_RESERVED_SPACE
c_func
(paren
id|dev
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_eq
l_int|NULL
)paren
(brace
id|ip_rt_put
c_func
(paren
id|rt
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|skb-&gt;dst
op_assign
op_amp
id|rt-&gt;u.dst
suffix:semicolon
id|skb_reserve
c_func
(paren
id|skb
comma
id|LL_RESERVED_SPACE
c_func
(paren
id|dev
)paren
)paren
suffix:semicolon
id|skb-&gt;nh.iph
op_assign
id|iph
op_assign
(paren
r_struct
id|iphdr
op_star
)paren
id|skb_put
c_func
(paren
id|skb
comma
r_sizeof
(paren
r_struct
id|iphdr
)paren
op_plus
l_int|4
)paren
suffix:semicolon
id|iph-&gt;version
op_assign
l_int|4
suffix:semicolon
id|iph-&gt;ihl
op_assign
(paren
r_sizeof
(paren
r_struct
id|iphdr
)paren
op_plus
l_int|4
)paren
op_rshift
l_int|2
suffix:semicolon
id|iph-&gt;tos
op_assign
l_int|0xc0
suffix:semicolon
id|iph-&gt;frag_off
op_assign
id|htons
c_func
(paren
id|IP_DF
)paren
suffix:semicolon
id|iph-&gt;ttl
op_assign
l_int|1
suffix:semicolon
id|iph-&gt;daddr
op_assign
id|dst
suffix:semicolon
id|iph-&gt;saddr
op_assign
id|rt-&gt;rt_src
suffix:semicolon
id|iph-&gt;protocol
op_assign
id|IPPROTO_IGMP
suffix:semicolon
id|iph-&gt;tot_len
op_assign
id|htons
c_func
(paren
id|IGMP_SIZE
)paren
suffix:semicolon
id|ip_select_ident
c_func
(paren
id|iph
comma
op_amp
id|rt-&gt;u.dst
comma
l_int|NULL
)paren
suffix:semicolon
(paren
(paren
id|u8
op_star
)paren
op_amp
id|iph
(braket
l_int|1
)braket
)paren
(braket
l_int|0
)braket
op_assign
id|IPOPT_RA
suffix:semicolon
(paren
(paren
id|u8
op_star
)paren
op_amp
id|iph
(braket
l_int|1
)braket
)paren
(braket
l_int|1
)braket
op_assign
l_int|4
suffix:semicolon
(paren
(paren
id|u8
op_star
)paren
op_amp
id|iph
(braket
l_int|1
)braket
)paren
(braket
l_int|2
)braket
op_assign
l_int|0
suffix:semicolon
(paren
(paren
id|u8
op_star
)paren
op_amp
id|iph
(braket
l_int|1
)braket
)paren
(braket
l_int|3
)braket
op_assign
l_int|0
suffix:semicolon
id|ip_send_check
c_func
(paren
id|iph
)paren
suffix:semicolon
id|ih
op_assign
(paren
r_struct
id|igmphdr
op_star
)paren
id|skb_put
c_func
(paren
id|skb
comma
r_sizeof
(paren
r_struct
id|igmphdr
)paren
)paren
suffix:semicolon
id|ih-&gt;type
op_assign
id|type
suffix:semicolon
id|ih-&gt;code
op_assign
l_int|0
suffix:semicolon
id|ih-&gt;csum
op_assign
l_int|0
suffix:semicolon
id|ih-&gt;group
op_assign
id|group
suffix:semicolon
id|ih-&gt;csum
op_assign
id|ip_compute_csum
c_func
(paren
(paren
r_void
op_star
)paren
id|ih
comma
r_sizeof
(paren
r_struct
id|igmphdr
)paren
)paren
suffix:semicolon
r_return
id|NF_HOOK
c_func
(paren
id|PF_INET
comma
id|NF_IP_LOCAL_OUT
comma
id|skb
comma
l_int|NULL
comma
id|rt-&gt;u.dst.dev
comma
id|dst_output
)paren
suffix:semicolon
)brace
DECL|function|igmp_gq_timer_expire
r_static
r_void
id|igmp_gq_timer_expire
c_func
(paren
r_int
r_int
id|data
)paren
(brace
r_struct
id|in_device
op_star
id|in_dev
op_assign
(paren
r_struct
id|in_device
op_star
)paren
id|data
suffix:semicolon
id|in_dev-&gt;mr_gq_running
op_assign
l_int|0
suffix:semicolon
id|igmpv3_send_report
c_func
(paren
id|in_dev
comma
l_int|NULL
)paren
suffix:semicolon
id|__in_dev_put
c_func
(paren
id|in_dev
)paren
suffix:semicolon
)brace
DECL|function|igmp_ifc_timer_expire
r_static
r_void
id|igmp_ifc_timer_expire
c_func
(paren
r_int
r_int
id|data
)paren
(brace
r_struct
id|in_device
op_star
id|in_dev
op_assign
(paren
r_struct
id|in_device
op_star
)paren
id|data
suffix:semicolon
id|igmpv3_send_cr
c_func
(paren
id|in_dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|in_dev-&gt;mr_ifc_count
)paren
(brace
id|in_dev-&gt;mr_ifc_count
op_decrement
suffix:semicolon
id|igmp_ifc_start_timer
c_func
(paren
id|in_dev
comma
id|IGMP_Unsolicited_Report_Interval
)paren
suffix:semicolon
)brace
id|__in_dev_put
c_func
(paren
id|in_dev
)paren
suffix:semicolon
)brace
DECL|function|igmp_ifc_event
r_static
r_void
id|igmp_ifc_event
c_func
(paren
r_struct
id|in_device
op_star
id|in_dev
)paren
(brace
r_if
c_cond
(paren
id|IGMP_V1_SEEN
c_func
(paren
id|in_dev
)paren
op_logical_or
id|IGMP_V2_SEEN
c_func
(paren
id|in_dev
)paren
)paren
r_return
suffix:semicolon
id|in_dev-&gt;mr_ifc_count
op_assign
id|in_dev-&gt;mr_qrv
ques
c_cond
id|in_dev-&gt;mr_qrv
suffix:colon
id|IGMP_Unsolicited_Report_Count
suffix:semicolon
id|igmp_ifc_start_timer
c_func
(paren
id|in_dev
comma
l_int|1
)paren
suffix:semicolon
)brace
DECL|function|igmp_timer_expire
r_static
r_void
id|igmp_timer_expire
c_func
(paren
r_int
r_int
id|data
)paren
(brace
r_struct
id|ip_mc_list
op_star
id|im
op_assign
(paren
r_struct
id|ip_mc_list
op_star
)paren
id|data
suffix:semicolon
r_struct
id|in_device
op_star
id|in_dev
op_assign
id|im-&gt;interface
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|im-&gt;lock
)paren
suffix:semicolon
id|im-&gt;tm_running
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|im-&gt;unsolicit_count
)paren
(brace
id|im-&gt;unsolicit_count
op_decrement
suffix:semicolon
id|igmp_start_timer
c_func
(paren
id|im
comma
id|IGMP_Unsolicited_Report_Interval
)paren
suffix:semicolon
)brace
id|im-&gt;reporter
op_assign
l_int|1
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|im-&gt;lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|IGMP_V1_SEEN
c_func
(paren
id|in_dev
)paren
)paren
id|igmp_send_report
c_func
(paren
id|in_dev
comma
id|im
comma
id|IGMP_HOST_MEMBERSHIP_REPORT
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|IGMP_V2_SEEN
c_func
(paren
id|in_dev
)paren
)paren
id|igmp_send_report
c_func
(paren
id|in_dev
comma
id|im
comma
id|IGMPV2_HOST_MEMBERSHIP_REPORT
)paren
suffix:semicolon
r_else
id|igmp_send_report
c_func
(paren
id|in_dev
comma
id|im
comma
id|IGMPV3_HOST_MEMBERSHIP_REPORT
)paren
suffix:semicolon
id|ip_ma_put
c_func
(paren
id|im
)paren
suffix:semicolon
)brace
DECL|function|igmp_marksources
r_static
r_void
id|igmp_marksources
c_func
(paren
r_struct
id|ip_mc_list
op_star
id|pmc
comma
r_int
id|nsrcs
comma
id|__u32
op_star
id|srcs
)paren
(brace
r_struct
id|ip_sf_list
op_star
id|psf
suffix:semicolon
r_int
id|i
comma
id|scount
suffix:semicolon
id|scount
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|psf
op_assign
id|pmc-&gt;sources
suffix:semicolon
id|psf
suffix:semicolon
id|psf
op_assign
id|psf-&gt;sf_next
)paren
(brace
r_if
c_cond
(paren
id|scount
op_eq
id|nsrcs
)paren
r_break
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|nsrcs
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|srcs
(braket
id|i
)braket
op_eq
id|psf-&gt;sf_inaddr
)paren
(brace
id|psf-&gt;sf_gsresp
op_assign
l_int|1
suffix:semicolon
id|scount
op_increment
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
)brace
DECL|function|igmp_heard_report
r_static
r_void
id|igmp_heard_report
c_func
(paren
r_struct
id|in_device
op_star
id|in_dev
comma
id|u32
id|group
)paren
(brace
r_struct
id|ip_mc_list
op_star
id|im
suffix:semicolon
multiline_comment|/* Timers are only set for non-local groups */
r_if
c_cond
(paren
id|group
op_eq
id|IGMP_ALL_HOSTS
)paren
r_return
suffix:semicolon
id|read_lock
c_func
(paren
op_amp
id|in_dev-&gt;mc_list_lock
)paren
suffix:semicolon
r_for
c_loop
(paren
id|im
op_assign
id|in_dev-&gt;mc_list
suffix:semicolon
id|im
op_ne
l_int|NULL
suffix:semicolon
id|im
op_assign
id|im-&gt;next
)paren
(brace
r_if
c_cond
(paren
id|im-&gt;multiaddr
op_eq
id|group
)paren
(brace
id|igmp_stop_timer
c_func
(paren
id|im
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|read_unlock
c_func
(paren
op_amp
id|in_dev-&gt;mc_list_lock
)paren
suffix:semicolon
)brace
DECL|function|igmp_heard_query
r_static
r_void
id|igmp_heard_query
c_func
(paren
r_struct
id|in_device
op_star
id|in_dev
comma
r_struct
id|sk_buff
op_star
id|skb
comma
r_int
id|len
)paren
(brace
r_struct
id|igmphdr
op_star
id|ih
op_assign
id|skb-&gt;h.igmph
suffix:semicolon
r_struct
id|igmpv3_query
op_star
id|ih3
op_assign
(paren
r_struct
id|igmpv3_query
op_star
)paren
id|ih
suffix:semicolon
r_struct
id|ip_mc_list
op_star
id|im
suffix:semicolon
id|u32
id|group
op_assign
id|ih-&gt;group
suffix:semicolon
r_int
id|max_delay
suffix:semicolon
r_int
id|mark
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|len
op_eq
l_int|8
)paren
(brace
r_if
c_cond
(paren
id|ih-&gt;code
op_eq
l_int|0
)paren
(brace
multiline_comment|/* Alas, old v1 router presents here. */
id|max_delay
op_assign
id|IGMP_Query_Response_Interval
suffix:semicolon
id|in_dev-&gt;mr_v1_seen
op_assign
id|jiffies
op_plus
id|IGMP_V1_Router_Present_Timeout
suffix:semicolon
id|group
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* v2 router present */
id|max_delay
op_assign
id|ih-&gt;code
op_star
(paren
id|HZ
op_div
id|IGMP_TIMER_SCALE
)paren
suffix:semicolon
id|in_dev-&gt;mr_v2_seen
op_assign
id|jiffies
op_plus
id|IGMP_V2_Router_Present_Timeout
suffix:semicolon
)brace
multiline_comment|/* cancel the interface change timer */
id|in_dev-&gt;mr_ifc_count
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|del_timer
c_func
(paren
op_amp
id|in_dev-&gt;mr_ifc_timer
)paren
)paren
id|__in_dev_put
c_func
(paren
id|in_dev
)paren
suffix:semicolon
multiline_comment|/* clear deleted report items */
id|igmpv3_clear_delrec
c_func
(paren
id|in_dev
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|len
OL
l_int|12
)paren
(brace
r_return
suffix:semicolon
multiline_comment|/* ignore bogus packet; freed by caller */
)brace
r_else
(brace
multiline_comment|/* v3 */
r_if
c_cond
(paren
op_logical_neg
id|pskb_may_pull
c_func
(paren
id|skb
comma
r_sizeof
(paren
r_struct
id|igmpv3_query
)paren
)paren
)paren
r_return
suffix:semicolon
id|ih3
op_assign
(paren
r_struct
id|igmpv3_query
op_star
)paren
id|skb-&gt;h.raw
suffix:semicolon
r_if
c_cond
(paren
id|ih3-&gt;nsrcs
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|pskb_may_pull
c_func
(paren
id|skb
comma
r_sizeof
(paren
r_struct
id|igmpv3_query
)paren
op_plus
id|ntohs
c_func
(paren
id|ih3-&gt;nsrcs
)paren
op_star
r_sizeof
(paren
id|__u32
)paren
)paren
)paren
r_return
suffix:semicolon
id|ih3
op_assign
(paren
r_struct
id|igmpv3_query
op_star
)paren
id|skb-&gt;h.raw
suffix:semicolon
)brace
id|max_delay
op_assign
id|IGMPV3_MRC
c_func
(paren
id|ih3-&gt;code
)paren
op_star
(paren
id|HZ
op_div
id|IGMP_TIMER_SCALE
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|max_delay
)paren
id|max_delay
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* can&squot;t mod w/ 0 */
id|in_dev-&gt;mr_maxdelay
op_assign
id|max_delay
suffix:semicolon
r_if
c_cond
(paren
id|ih3-&gt;qrv
)paren
id|in_dev-&gt;mr_qrv
op_assign
id|ih3-&gt;qrv
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|group
)paren
(brace
multiline_comment|/* general query */
r_if
c_cond
(paren
id|ih3-&gt;nsrcs
)paren
r_return
suffix:semicolon
multiline_comment|/* no sources allowed */
id|igmp_gq_start_timer
c_func
(paren
id|in_dev
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/* mark sources to include, if group &amp; source-specific */
id|mark
op_assign
id|ih3-&gt;nsrcs
op_ne
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * - Start the timers in all of our membership records&n;&t; *   that the query applies to for the interface on&n;&t; *   which the query arrived excl. those that belong&n;&t; *   to a &quot;local&quot; group (224.0.0.X)&n;&t; * - For timers already running check if they need to&n;&t; *   be reset.&n;&t; * - Use the igmp-&gt;igmp_code field as the maximum&n;&t; *   delay possible&n;&t; */
id|read_lock
c_func
(paren
op_amp
id|in_dev-&gt;mc_list_lock
)paren
suffix:semicolon
r_for
c_loop
(paren
id|im
op_assign
id|in_dev-&gt;mc_list
suffix:semicolon
id|im
op_ne
l_int|NULL
suffix:semicolon
id|im
op_assign
id|im-&gt;next
)paren
(brace
r_if
c_cond
(paren
id|group
op_logical_and
id|group
op_ne
id|im-&gt;multiaddr
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|im-&gt;multiaddr
op_eq
id|IGMP_ALL_HOSTS
)paren
r_continue
suffix:semicolon
id|spin_lock_bh
c_func
(paren
op_amp
id|im-&gt;lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|im-&gt;tm_running
)paren
id|im-&gt;gsquery
op_assign
id|im-&gt;gsquery
op_logical_and
id|mark
suffix:semicolon
r_else
id|im-&gt;gsquery
op_assign
id|mark
suffix:semicolon
r_if
c_cond
(paren
id|im-&gt;gsquery
)paren
id|igmp_marksources
c_func
(paren
id|im
comma
id|ntohs
c_func
(paren
id|ih3-&gt;nsrcs
)paren
comma
id|ih3-&gt;srcs
)paren
suffix:semicolon
id|spin_unlock_bh
c_func
(paren
op_amp
id|im-&gt;lock
)paren
suffix:semicolon
id|igmp_mod_timer
c_func
(paren
id|im
comma
id|max_delay
)paren
suffix:semicolon
)brace
id|read_unlock
c_func
(paren
op_amp
id|in_dev-&gt;mc_list_lock
)paren
suffix:semicolon
)brace
DECL|function|igmp_rcv
r_int
id|igmp_rcv
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
multiline_comment|/* This basically follows the spec line by line -- see RFC1112 */
r_struct
id|igmphdr
op_star
id|ih
suffix:semicolon
r_struct
id|in_device
op_star
id|in_dev
op_assign
id|in_dev_get
c_func
(paren
id|skb-&gt;dev
)paren
suffix:semicolon
r_int
id|len
op_assign
id|skb-&gt;len
suffix:semicolon
r_if
c_cond
(paren
id|in_dev
op_eq
l_int|NULL
)paren
(brace
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|pskb_may_pull
c_func
(paren
id|skb
comma
r_sizeof
(paren
r_struct
id|igmphdr
)paren
)paren
op_logical_or
(paren
id|u16
)paren
id|csum_fold
c_func
(paren
id|skb_checksum
c_func
(paren
id|skb
comma
l_int|0
comma
id|len
comma
l_int|0
)paren
)paren
)paren
(brace
id|in_dev_put
c_func
(paren
id|in_dev
)paren
suffix:semicolon
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|ih
op_assign
id|skb-&gt;h.igmph
suffix:semicolon
r_switch
c_cond
(paren
id|ih-&gt;type
)paren
(brace
r_case
id|IGMP_HOST_MEMBERSHIP_QUERY
suffix:colon
id|igmp_heard_query
c_func
(paren
id|in_dev
comma
id|skb
comma
id|len
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|IGMP_HOST_MEMBERSHIP_REPORT
suffix:colon
r_case
id|IGMPV2_HOST_MEMBERSHIP_REPORT
suffix:colon
r_case
id|IGMPV3_HOST_MEMBERSHIP_REPORT
suffix:colon
multiline_comment|/* Is it our report looped back? */
r_if
c_cond
(paren
(paren
(paren
r_struct
id|rtable
op_star
)paren
id|skb-&gt;dst
)paren
op_member_access_from_pointer
id|fl.iif
op_eq
l_int|0
)paren
r_break
suffix:semicolon
id|igmp_heard_report
c_func
(paren
id|in_dev
comma
id|ih-&gt;group
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|IGMP_PIM
suffix:colon
macro_line|#ifdef CONFIG_IP_PIMSM_V1
id|in_dev_put
c_func
(paren
id|in_dev
)paren
suffix:semicolon
r_return
id|pim_rcv_v1
c_func
(paren
id|skb
)paren
suffix:semicolon
macro_line|#endif
r_case
id|IGMP_DVMRP
suffix:colon
r_case
id|IGMP_TRACE
suffix:colon
r_case
id|IGMP_HOST_LEAVE_MESSAGE
suffix:colon
r_case
id|IGMP_MTRACE
suffix:colon
r_case
id|IGMP_MTRACE_RESP
suffix:colon
r_break
suffix:semicolon
r_default
suffix:colon
id|NETDEBUG
c_func
(paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;New IGMP type=%d, why we do not know about it?&bslash;n&quot;
comma
id|ih-&gt;type
)paren
)paren
suffix:semicolon
)brace
id|in_dev_put
c_func
(paren
id|in_dev
)paren
suffix:semicolon
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/*&n; *&t;Add a filter to a device&n; */
DECL|function|ip_mc_filter_add
r_static
r_void
id|ip_mc_filter_add
c_func
(paren
r_struct
id|in_device
op_star
id|in_dev
comma
id|u32
id|addr
)paren
(brace
r_char
id|buf
(braket
id|MAX_ADDR_LEN
)braket
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
op_assign
id|in_dev-&gt;dev
suffix:semicolon
multiline_comment|/* Checking for IFF_MULTICAST here is WRONG-WRONG-WRONG.&n;&t;   We will get multicast token leakage, when IFF_MULTICAST&n;&t;   is changed. This check should be done in dev-&gt;set_multicast_list&n;&t;   routine. Something sort of:&n;&t;   if (dev-&gt;mc_list &amp;&amp; dev-&gt;flags&amp;IFF_MULTICAST) { do it; }&n;&t;   --ANK&n;&t;   */
r_if
c_cond
(paren
id|arp_mc_map
c_func
(paren
id|addr
comma
id|buf
comma
id|dev
comma
l_int|0
)paren
op_eq
l_int|0
)paren
id|dev_mc_add
c_func
(paren
id|dev
comma
id|buf
comma
id|dev-&gt;addr_len
comma
l_int|0
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;Remove a filter from a device&n; */
DECL|function|ip_mc_filter_del
r_static
r_void
id|ip_mc_filter_del
c_func
(paren
r_struct
id|in_device
op_star
id|in_dev
comma
id|u32
id|addr
)paren
(brace
r_char
id|buf
(braket
id|MAX_ADDR_LEN
)braket
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
op_assign
id|in_dev-&gt;dev
suffix:semicolon
r_if
c_cond
(paren
id|arp_mc_map
c_func
(paren
id|addr
comma
id|buf
comma
id|dev
comma
l_int|0
)paren
op_eq
l_int|0
)paren
id|dev_mc_delete
c_func
(paren
id|dev
comma
id|buf
comma
id|dev-&gt;addr_len
comma
l_int|0
)paren
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_IP_MULTICAST
multiline_comment|/*&n; * deleted ip_mc_list manipulation&n; */
DECL|function|igmpv3_add_delrec
r_static
r_void
id|igmpv3_add_delrec
c_func
(paren
r_struct
id|in_device
op_star
id|in_dev
comma
r_struct
id|ip_mc_list
op_star
id|im
)paren
(brace
r_struct
id|ip_mc_list
op_star
id|pmc
suffix:semicolon
multiline_comment|/* this is an &quot;ip_mc_list&quot; for convenience; only the fields below&n;&t; * are actually used. In particular, the refcnt and users are not&n;&t; * used for management of the delete list. Using the same structure&n;&t; * for deleted items allows change reports to use common code with&n;&t; * non-deleted or query-response MCA&squot;s.&n;&t; */
id|pmc
op_assign
(paren
r_struct
id|ip_mc_list
op_star
)paren
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|pmc
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pmc
)paren
r_return
suffix:semicolon
id|memset
c_func
(paren
id|pmc
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|pmc
)paren
)paren
suffix:semicolon
id|spin_lock_bh
c_func
(paren
op_amp
id|im-&gt;lock
)paren
suffix:semicolon
id|pmc-&gt;interface
op_assign
id|im-&gt;interface
suffix:semicolon
id|in_dev_hold
c_func
(paren
id|in_dev
)paren
suffix:semicolon
id|pmc-&gt;multiaddr
op_assign
id|im-&gt;multiaddr
suffix:semicolon
id|pmc-&gt;crcount
op_assign
id|in_dev-&gt;mr_qrv
ques
c_cond
id|in_dev-&gt;mr_qrv
suffix:colon
id|IGMP_Unsolicited_Report_Count
suffix:semicolon
id|pmc-&gt;sfmode
op_assign
id|im-&gt;sfmode
suffix:semicolon
r_if
c_cond
(paren
id|pmc-&gt;sfmode
op_eq
id|MCAST_INCLUDE
)paren
(brace
r_struct
id|ip_sf_list
op_star
id|psf
suffix:semicolon
id|pmc-&gt;tomb
op_assign
id|im-&gt;tomb
suffix:semicolon
id|pmc-&gt;sources
op_assign
id|im-&gt;sources
suffix:semicolon
id|im-&gt;tomb
op_assign
id|im-&gt;sources
op_assign
l_int|NULL
suffix:semicolon
r_for
c_loop
(paren
id|psf
op_assign
id|pmc-&gt;sources
suffix:semicolon
id|psf
suffix:semicolon
id|psf
op_assign
id|psf-&gt;sf_next
)paren
id|psf-&gt;sf_crcount
op_assign
id|pmc-&gt;crcount
suffix:semicolon
)brace
id|spin_unlock_bh
c_func
(paren
op_amp
id|im-&gt;lock
)paren
suffix:semicolon
id|spin_lock_bh
c_func
(paren
op_amp
id|in_dev-&gt;mc_tomb_lock
)paren
suffix:semicolon
id|pmc-&gt;next
op_assign
id|in_dev-&gt;mc_tomb
suffix:semicolon
id|in_dev-&gt;mc_tomb
op_assign
id|pmc
suffix:semicolon
id|spin_unlock_bh
c_func
(paren
op_amp
id|in_dev-&gt;mc_tomb_lock
)paren
suffix:semicolon
)brace
DECL|function|igmpv3_del_delrec
r_static
r_void
id|igmpv3_del_delrec
c_func
(paren
r_struct
id|in_device
op_star
id|in_dev
comma
id|__u32
id|multiaddr
)paren
(brace
r_struct
id|ip_mc_list
op_star
id|pmc
comma
op_star
id|pmc_prev
suffix:semicolon
r_struct
id|ip_sf_list
op_star
id|psf
comma
op_star
id|psf_next
suffix:semicolon
id|spin_lock_bh
c_func
(paren
op_amp
id|in_dev-&gt;mc_tomb_lock
)paren
suffix:semicolon
id|pmc_prev
op_assign
l_int|NULL
suffix:semicolon
r_for
c_loop
(paren
id|pmc
op_assign
id|in_dev-&gt;mc_tomb
suffix:semicolon
id|pmc
suffix:semicolon
id|pmc
op_assign
id|pmc-&gt;next
)paren
(brace
r_if
c_cond
(paren
id|pmc-&gt;multiaddr
op_eq
id|multiaddr
)paren
r_break
suffix:semicolon
id|pmc_prev
op_assign
id|pmc
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pmc
)paren
(brace
r_if
c_cond
(paren
id|pmc_prev
)paren
id|pmc_prev-&gt;next
op_assign
id|pmc-&gt;next
suffix:semicolon
r_else
id|in_dev-&gt;mc_tomb
op_assign
id|pmc-&gt;next
suffix:semicolon
)brace
id|spin_unlock_bh
c_func
(paren
op_amp
id|in_dev-&gt;mc_tomb_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pmc
)paren
(brace
r_for
c_loop
(paren
id|psf
op_assign
id|pmc-&gt;tomb
suffix:semicolon
id|psf
suffix:semicolon
id|psf
op_assign
id|psf_next
)paren
(brace
id|psf_next
op_assign
id|psf-&gt;sf_next
suffix:semicolon
id|kfree
c_func
(paren
id|psf
)paren
suffix:semicolon
)brace
id|in_dev_put
c_func
(paren
id|pmc-&gt;interface
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|pmc
)paren
suffix:semicolon
)brace
)brace
DECL|function|igmpv3_clear_delrec
r_static
r_void
id|igmpv3_clear_delrec
c_func
(paren
r_struct
id|in_device
op_star
id|in_dev
)paren
(brace
r_struct
id|ip_mc_list
op_star
id|pmc
comma
op_star
id|nextpmc
suffix:semicolon
id|spin_lock_bh
c_func
(paren
op_amp
id|in_dev-&gt;mc_tomb_lock
)paren
suffix:semicolon
id|pmc
op_assign
id|in_dev-&gt;mc_tomb
suffix:semicolon
id|in_dev-&gt;mc_tomb
op_assign
l_int|NULL
suffix:semicolon
id|spin_unlock_bh
c_func
(paren
op_amp
id|in_dev-&gt;mc_tomb_lock
)paren
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
id|pmc
suffix:semicolon
id|pmc
op_assign
id|nextpmc
)paren
(brace
id|nextpmc
op_assign
id|pmc-&gt;next
suffix:semicolon
id|ip_mc_clear_src
c_func
(paren
id|pmc
)paren
suffix:semicolon
id|in_dev_put
c_func
(paren
id|pmc-&gt;interface
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|pmc
)paren
suffix:semicolon
)brace
multiline_comment|/* clear dead sources, too */
id|read_lock
c_func
(paren
op_amp
id|in_dev-&gt;mc_list_lock
)paren
suffix:semicolon
r_for
c_loop
(paren
id|pmc
op_assign
id|in_dev-&gt;mc_list
suffix:semicolon
id|pmc
suffix:semicolon
id|pmc
op_assign
id|pmc-&gt;next
)paren
(brace
r_struct
id|ip_sf_list
op_star
id|psf
comma
op_star
id|psf_next
suffix:semicolon
id|spin_lock_bh
c_func
(paren
op_amp
id|pmc-&gt;lock
)paren
suffix:semicolon
id|psf
op_assign
id|pmc-&gt;tomb
suffix:semicolon
id|pmc-&gt;tomb
op_assign
l_int|NULL
suffix:semicolon
id|spin_unlock_bh
c_func
(paren
op_amp
id|pmc-&gt;lock
)paren
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
id|psf
suffix:semicolon
id|psf
op_assign
id|psf_next
)paren
(brace
id|psf_next
op_assign
id|psf-&gt;sf_next
suffix:semicolon
id|kfree
c_func
(paren
id|psf
)paren
suffix:semicolon
)brace
)brace
id|read_unlock
c_func
(paren
op_amp
id|in_dev-&gt;mc_list_lock
)paren
suffix:semicolon
)brace
macro_line|#endif
DECL|function|igmp_group_dropped
r_static
r_void
id|igmp_group_dropped
c_func
(paren
r_struct
id|ip_mc_list
op_star
id|im
)paren
(brace
r_struct
id|in_device
op_star
id|in_dev
op_assign
id|im-&gt;interface
suffix:semicolon
macro_line|#ifdef CONFIG_IP_MULTICAST
r_int
id|reporter
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|im-&gt;loaded
)paren
(brace
id|im-&gt;loaded
op_assign
l_int|0
suffix:semicolon
id|ip_mc_filter_del
c_func
(paren
id|in_dev
comma
id|im-&gt;multiaddr
)paren
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_IP_MULTICAST
r_if
c_cond
(paren
id|im-&gt;multiaddr
op_eq
id|IGMP_ALL_HOSTS
)paren
r_return
suffix:semicolon
id|reporter
op_assign
id|im-&gt;reporter
suffix:semicolon
id|igmp_stop_timer
c_func
(paren
id|im
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|in_dev-&gt;dead
)paren
(brace
r_if
c_cond
(paren
id|IGMP_V1_SEEN
c_func
(paren
id|in_dev
)paren
)paren
r_goto
id|done
suffix:semicolon
r_if
c_cond
(paren
id|IGMP_V2_SEEN
c_func
(paren
id|in_dev
)paren
)paren
(brace
r_if
c_cond
(paren
id|reporter
)paren
id|igmp_send_report
c_func
(paren
id|in_dev
comma
id|im
comma
id|IGMP_HOST_LEAVE_MESSAGE
)paren
suffix:semicolon
r_goto
id|done
suffix:semicolon
)brace
multiline_comment|/* IGMPv3 */
id|igmpv3_add_delrec
c_func
(paren
id|in_dev
comma
id|im
)paren
suffix:semicolon
id|igmp_ifc_event
c_func
(paren
id|in_dev
)paren
suffix:semicolon
)brace
id|done
suffix:colon
macro_line|#endif
id|ip_mc_clear_src
c_func
(paren
id|im
)paren
suffix:semicolon
)brace
DECL|function|igmp_group_added
r_static
r_void
id|igmp_group_added
c_func
(paren
r_struct
id|ip_mc_list
op_star
id|im
)paren
(brace
r_struct
id|in_device
op_star
id|in_dev
op_assign
id|im-&gt;interface
suffix:semicolon
r_if
c_cond
(paren
id|im-&gt;loaded
op_eq
l_int|0
)paren
(brace
id|im-&gt;loaded
op_assign
l_int|1
suffix:semicolon
id|ip_mc_filter_add
c_func
(paren
id|in_dev
comma
id|im-&gt;multiaddr
)paren
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_IP_MULTICAST
r_if
c_cond
(paren
id|im-&gt;multiaddr
op_eq
id|IGMP_ALL_HOSTS
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|in_dev-&gt;dead
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|IGMP_V1_SEEN
c_func
(paren
id|in_dev
)paren
op_logical_or
id|IGMP_V2_SEEN
c_func
(paren
id|in_dev
)paren
)paren
(brace
id|spin_lock_bh
c_func
(paren
op_amp
id|im-&gt;lock
)paren
suffix:semicolon
id|igmp_start_timer
c_func
(paren
id|im
comma
id|IGMP_Initial_Report_Delay
)paren
suffix:semicolon
id|spin_unlock_bh
c_func
(paren
op_amp
id|im-&gt;lock
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/* else, v3 */
id|im-&gt;crcount
op_assign
id|in_dev-&gt;mr_qrv
ques
c_cond
id|in_dev-&gt;mr_qrv
suffix:colon
id|IGMP_Unsolicited_Report_Count
suffix:semicolon
id|igmp_ifc_event
c_func
(paren
id|in_dev
)paren
suffix:semicolon
macro_line|#endif
)brace
multiline_comment|/*&n; *&t;Multicast list managers&n; */
multiline_comment|/*&n; *&t;A socket has joined a multicast group on device dev.&n; */
DECL|function|ip_mc_inc_group
r_void
id|ip_mc_inc_group
c_func
(paren
r_struct
id|in_device
op_star
id|in_dev
comma
id|u32
id|addr
)paren
(brace
r_struct
id|ip_mc_list
op_star
id|im
suffix:semicolon
id|ASSERT_RTNL
c_func
(paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|im
op_assign
id|in_dev-&gt;mc_list
suffix:semicolon
id|im
suffix:semicolon
id|im
op_assign
id|im-&gt;next
)paren
(brace
r_if
c_cond
(paren
id|im-&gt;multiaddr
op_eq
id|addr
)paren
(brace
id|im-&gt;users
op_increment
suffix:semicolon
id|ip_mc_add_src
c_func
(paren
id|in_dev
comma
op_amp
id|addr
comma
id|MCAST_EXCLUDE
comma
l_int|0
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
)brace
id|im
op_assign
(paren
r_struct
id|ip_mc_list
op_star
)paren
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|im
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|im
)paren
r_goto
id|out
suffix:semicolon
id|im-&gt;users
op_assign
l_int|1
suffix:semicolon
id|im-&gt;interface
op_assign
id|in_dev
suffix:semicolon
id|in_dev_hold
c_func
(paren
id|in_dev
)paren
suffix:semicolon
id|im-&gt;multiaddr
op_assign
id|addr
suffix:semicolon
multiline_comment|/* initial mode is (EX, empty) */
id|im-&gt;sfmode
op_assign
id|MCAST_EXCLUDE
suffix:semicolon
id|im-&gt;sfcount
(braket
id|MCAST_INCLUDE
)braket
op_assign
l_int|0
suffix:semicolon
id|im-&gt;sfcount
(braket
id|MCAST_EXCLUDE
)braket
op_assign
l_int|1
suffix:semicolon
id|im-&gt;sources
op_assign
l_int|NULL
suffix:semicolon
id|im-&gt;tomb
op_assign
l_int|NULL
suffix:semicolon
id|im-&gt;crcount
op_assign
l_int|0
suffix:semicolon
id|atomic_set
c_func
(paren
op_amp
id|im-&gt;refcnt
comma
l_int|1
)paren
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|im-&gt;lock
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_IP_MULTICAST
id|im-&gt;tm_running
op_assign
l_int|0
suffix:semicolon
id|init_timer
c_func
(paren
op_amp
id|im-&gt;timer
)paren
suffix:semicolon
id|im-&gt;timer.data
op_assign
(paren
r_int
r_int
)paren
id|im
suffix:semicolon
id|im-&gt;timer.function
op_assign
op_amp
id|igmp_timer_expire
suffix:semicolon
id|im-&gt;unsolicit_count
op_assign
id|IGMP_Unsolicited_Report_Count
suffix:semicolon
id|im-&gt;reporter
op_assign
l_int|0
suffix:semicolon
id|im-&gt;gsquery
op_assign
l_int|0
suffix:semicolon
macro_line|#endif
id|im-&gt;loaded
op_assign
l_int|0
suffix:semicolon
id|write_lock_bh
c_func
(paren
op_amp
id|in_dev-&gt;mc_list_lock
)paren
suffix:semicolon
id|im-&gt;next
op_assign
id|in_dev-&gt;mc_list
suffix:semicolon
id|in_dev-&gt;mc_list
op_assign
id|im
suffix:semicolon
id|write_unlock_bh
c_func
(paren
op_amp
id|in_dev-&gt;mc_list_lock
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_IP_MULTICAST
id|igmpv3_del_delrec
c_func
(paren
id|in_dev
comma
id|im-&gt;multiaddr
)paren
suffix:semicolon
macro_line|#endif
id|igmp_group_added
c_func
(paren
id|im
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|in_dev-&gt;dead
)paren
id|ip_rt_multicast_event
c_func
(paren
id|in_dev
)paren
suffix:semicolon
id|out
suffix:colon
r_return
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;A socket has left a multicast group on device dev&n; */
DECL|function|ip_mc_dec_group
r_void
id|ip_mc_dec_group
c_func
(paren
r_struct
id|in_device
op_star
id|in_dev
comma
id|u32
id|addr
)paren
(brace
r_struct
id|ip_mc_list
op_star
id|i
comma
op_star
op_star
id|ip
suffix:semicolon
id|ASSERT_RTNL
c_func
(paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|ip
op_assign
op_amp
id|in_dev-&gt;mc_list
suffix:semicolon
(paren
id|i
op_assign
op_star
id|ip
)paren
op_ne
l_int|NULL
suffix:semicolon
id|ip
op_assign
op_amp
id|i-&gt;next
)paren
(brace
r_if
c_cond
(paren
id|i-&gt;multiaddr
op_eq
id|addr
)paren
(brace
r_if
c_cond
(paren
op_decrement
id|i-&gt;users
op_eq
l_int|0
)paren
(brace
id|write_lock_bh
c_func
(paren
op_amp
id|in_dev-&gt;mc_list_lock
)paren
suffix:semicolon
op_star
id|ip
op_assign
id|i-&gt;next
suffix:semicolon
id|write_unlock_bh
c_func
(paren
op_amp
id|in_dev-&gt;mc_list_lock
)paren
suffix:semicolon
id|igmp_group_dropped
c_func
(paren
id|i
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|in_dev-&gt;dead
)paren
id|ip_rt_multicast_event
c_func
(paren
id|in_dev
)paren
suffix:semicolon
id|ip_ma_put
c_func
(paren
id|i
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
)brace
)brace
multiline_comment|/* Device going down */
DECL|function|ip_mc_down
r_void
id|ip_mc_down
c_func
(paren
r_struct
id|in_device
op_star
id|in_dev
)paren
(brace
r_struct
id|ip_mc_list
op_star
id|i
suffix:semicolon
id|ASSERT_RTNL
c_func
(paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|in_dev-&gt;mc_list
suffix:semicolon
id|i
suffix:semicolon
id|i
op_assign
id|i-&gt;next
)paren
id|igmp_group_dropped
c_func
(paren
id|i
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_IP_MULTICAST
id|in_dev-&gt;mr_ifc_count
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|del_timer
c_func
(paren
op_amp
id|in_dev-&gt;mr_ifc_timer
)paren
)paren
id|__in_dev_put
c_func
(paren
id|in_dev
)paren
suffix:semicolon
id|in_dev-&gt;mr_gq_running
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|del_timer
c_func
(paren
op_amp
id|in_dev-&gt;mr_gq_timer
)paren
)paren
id|__in_dev_put
c_func
(paren
id|in_dev
)paren
suffix:semicolon
id|igmpv3_clear_delrec
c_func
(paren
id|in_dev
)paren
suffix:semicolon
macro_line|#endif
id|ip_mc_dec_group
c_func
(paren
id|in_dev
comma
id|IGMP_ALL_HOSTS
)paren
suffix:semicolon
)brace
DECL|function|ip_mc_init_dev
r_void
id|ip_mc_init_dev
c_func
(paren
r_struct
id|in_device
op_star
id|in_dev
)paren
(brace
id|ASSERT_RTNL
c_func
(paren
)paren
suffix:semicolon
id|in_dev-&gt;mc_tomb
op_assign
l_int|NULL
suffix:semicolon
macro_line|#ifdef CONFIG_IP_MULTICAST
id|in_dev-&gt;mr_gq_running
op_assign
l_int|0
suffix:semicolon
id|init_timer
c_func
(paren
op_amp
id|in_dev-&gt;mr_gq_timer
)paren
suffix:semicolon
id|in_dev-&gt;mr_gq_timer.data
op_assign
(paren
r_int
r_int
)paren
id|in_dev
suffix:semicolon
id|in_dev-&gt;mr_gq_timer.function
op_assign
op_amp
id|igmp_gq_timer_expire
suffix:semicolon
id|in_dev-&gt;mr_ifc_count
op_assign
l_int|0
suffix:semicolon
id|init_timer
c_func
(paren
op_amp
id|in_dev-&gt;mr_ifc_timer
)paren
suffix:semicolon
id|in_dev-&gt;mr_ifc_timer.data
op_assign
(paren
r_int
r_int
)paren
id|in_dev
suffix:semicolon
id|in_dev-&gt;mr_ifc_timer.function
op_assign
op_amp
id|igmp_ifc_timer_expire
suffix:semicolon
id|in_dev-&gt;mr_qrv
op_assign
id|IGMP_Unsolicited_Report_Count
suffix:semicolon
macro_line|#endif
id|rwlock_init
c_func
(paren
op_amp
id|in_dev-&gt;mc_list_lock
)paren
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|in_dev-&gt;mc_tomb_lock
)paren
suffix:semicolon
)brace
multiline_comment|/* Device going up */
DECL|function|ip_mc_up
r_void
id|ip_mc_up
c_func
(paren
r_struct
id|in_device
op_star
id|in_dev
)paren
(brace
r_struct
id|ip_mc_list
op_star
id|i
suffix:semicolon
id|ASSERT_RTNL
c_func
(paren
)paren
suffix:semicolon
id|ip_mc_inc_group
c_func
(paren
id|in_dev
comma
id|IGMP_ALL_HOSTS
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|in_dev-&gt;mc_list
suffix:semicolon
id|i
suffix:semicolon
id|i
op_assign
id|i-&gt;next
)paren
id|igmp_group_added
c_func
(paren
id|i
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;Device is about to be destroyed: clean up.&n; */
DECL|function|ip_mc_destroy_dev
r_void
id|ip_mc_destroy_dev
c_func
(paren
r_struct
id|in_device
op_star
id|in_dev
)paren
(brace
r_struct
id|ip_mc_list
op_star
id|i
suffix:semicolon
id|ASSERT_RTNL
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* Deactivate timers */
id|ip_mc_down
c_func
(paren
id|in_dev
)paren
suffix:semicolon
id|write_lock_bh
c_func
(paren
op_amp
id|in_dev-&gt;mc_list_lock
)paren
suffix:semicolon
r_while
c_loop
(paren
(paren
id|i
op_assign
id|in_dev-&gt;mc_list
)paren
op_ne
l_int|NULL
)paren
(brace
id|in_dev-&gt;mc_list
op_assign
id|i-&gt;next
suffix:semicolon
id|write_unlock_bh
c_func
(paren
op_amp
id|in_dev-&gt;mc_list_lock
)paren
suffix:semicolon
id|igmp_group_dropped
c_func
(paren
id|i
)paren
suffix:semicolon
id|ip_ma_put
c_func
(paren
id|i
)paren
suffix:semicolon
id|write_lock_bh
c_func
(paren
op_amp
id|in_dev-&gt;mc_list_lock
)paren
suffix:semicolon
)brace
id|write_unlock_bh
c_func
(paren
op_amp
id|in_dev-&gt;mc_list_lock
)paren
suffix:semicolon
)brace
DECL|function|ip_mc_find_dev
r_static
r_struct
id|in_device
op_star
id|ip_mc_find_dev
c_func
(paren
r_struct
id|ip_mreqn
op_star
id|imr
)paren
(brace
r_struct
id|flowi
id|fl
op_assign
(brace
dot
id|nl_u
op_assign
(brace
dot
id|ip4_u
op_assign
(brace
dot
id|daddr
op_assign
id|imr-&gt;imr_multiaddr.s_addr
)brace
)brace
)brace
suffix:semicolon
r_struct
id|rtable
op_star
id|rt
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|in_device
op_star
id|idev
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|imr-&gt;imr_ifindex
)paren
(brace
id|idev
op_assign
id|inetdev_by_index
c_func
(paren
id|imr-&gt;imr_ifindex
)paren
suffix:semicolon
r_if
c_cond
(paren
id|idev
)paren
id|__in_dev_put
c_func
(paren
id|idev
)paren
suffix:semicolon
r_return
id|idev
suffix:semicolon
)brace
r_if
c_cond
(paren
id|imr-&gt;imr_address.s_addr
)paren
(brace
id|dev
op_assign
id|ip_dev_find
c_func
(paren
id|imr-&gt;imr_address.s_addr
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev
)paren
r_return
l_int|NULL
suffix:semicolon
id|__dev_put
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|dev
op_logical_and
op_logical_neg
id|ip_route_output_key
c_func
(paren
op_amp
id|rt
comma
op_amp
id|fl
)paren
)paren
(brace
id|dev
op_assign
id|rt-&gt;u.dst.dev
suffix:semicolon
id|ip_rt_put
c_func
(paren
id|rt
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dev
)paren
(brace
id|imr-&gt;imr_ifindex
op_assign
id|dev-&gt;ifindex
suffix:semicolon
id|idev
op_assign
id|__in_dev_get
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
r_return
id|idev
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;Join a socket to a group&n; */
DECL|variable|sysctl_igmp_max_memberships
r_int
id|sysctl_igmp_max_memberships
op_assign
id|IP_MAX_MEMBERSHIPS
suffix:semicolon
DECL|variable|sysctl_igmp_max_msf
r_int
id|sysctl_igmp_max_msf
op_assign
id|IP_MAX_MSF
suffix:semicolon
DECL|function|ip_mc_del1_src
r_static
r_int
id|ip_mc_del1_src
c_func
(paren
r_struct
id|ip_mc_list
op_star
id|pmc
comma
r_int
id|sfmode
comma
id|__u32
op_star
id|psfsrc
)paren
(brace
r_struct
id|ip_sf_list
op_star
id|psf
comma
op_star
id|psf_prev
suffix:semicolon
r_int
id|rv
op_assign
l_int|0
suffix:semicolon
id|psf_prev
op_assign
l_int|NULL
suffix:semicolon
r_for
c_loop
(paren
id|psf
op_assign
id|pmc-&gt;sources
suffix:semicolon
id|psf
suffix:semicolon
id|psf
op_assign
id|psf-&gt;sf_next
)paren
(brace
r_if
c_cond
(paren
id|psf-&gt;sf_inaddr
op_eq
op_star
id|psfsrc
)paren
r_break
suffix:semicolon
id|psf_prev
op_assign
id|psf
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|psf
op_logical_or
id|psf-&gt;sf_count
(braket
id|sfmode
)braket
op_eq
l_int|0
)paren
(brace
multiline_comment|/* source filter not found, or count wrong =&gt;  bug */
r_return
op_minus
id|ESRCH
suffix:semicolon
)brace
id|psf-&gt;sf_count
(braket
id|sfmode
)braket
op_decrement
suffix:semicolon
r_if
c_cond
(paren
id|psf-&gt;sf_count
(braket
id|sfmode
)braket
op_eq
l_int|0
)paren
(brace
id|ip_rt_multicast_event
c_func
(paren
id|pmc-&gt;interface
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|psf-&gt;sf_count
(braket
id|MCAST_INCLUDE
)braket
op_logical_and
op_logical_neg
id|psf-&gt;sf_count
(braket
id|MCAST_EXCLUDE
)braket
)paren
(brace
macro_line|#ifdef CONFIG_IP_MULTICAST
r_struct
id|in_device
op_star
id|in_dev
op_assign
id|pmc-&gt;interface
suffix:semicolon
macro_line|#endif
multiline_comment|/* no more filters for this source */
r_if
c_cond
(paren
id|psf_prev
)paren
id|psf_prev-&gt;sf_next
op_assign
id|psf-&gt;sf_next
suffix:semicolon
r_else
id|pmc-&gt;sources
op_assign
id|psf-&gt;sf_next
suffix:semicolon
macro_line|#ifdef CONFIG_IP_MULTICAST
r_if
c_cond
(paren
id|psf-&gt;sf_oldin
op_logical_and
op_logical_neg
id|IGMP_V1_SEEN
c_func
(paren
id|in_dev
)paren
op_logical_and
op_logical_neg
id|IGMP_V2_SEEN
c_func
(paren
id|in_dev
)paren
)paren
(brace
id|psf-&gt;sf_crcount
op_assign
id|in_dev-&gt;mr_qrv
ques
c_cond
id|in_dev-&gt;mr_qrv
suffix:colon
id|IGMP_Unsolicited_Report_Count
suffix:semicolon
id|psf-&gt;sf_next
op_assign
id|pmc-&gt;tomb
suffix:semicolon
id|pmc-&gt;tomb
op_assign
id|psf
suffix:semicolon
id|rv
op_assign
l_int|1
suffix:semicolon
)brace
r_else
macro_line|#endif
id|kfree
c_func
(paren
id|psf
)paren
suffix:semicolon
)brace
r_return
id|rv
suffix:semicolon
)brace
macro_line|#ifndef CONFIG_IP_MULTICAST
DECL|macro|igmp_ifc_event
mdefine_line|#define igmp_ifc_event(x)&t;do { } while (0)
macro_line|#endif
DECL|function|ip_mc_del_src
r_static
r_int
id|ip_mc_del_src
c_func
(paren
r_struct
id|in_device
op_star
id|in_dev
comma
id|__u32
op_star
id|pmca
comma
r_int
id|sfmode
comma
r_int
id|sfcount
comma
id|__u32
op_star
id|psfsrc
comma
r_int
id|delta
)paren
(brace
r_struct
id|ip_mc_list
op_star
id|pmc
suffix:semicolon
r_int
id|changerec
op_assign
l_int|0
suffix:semicolon
r_int
id|i
comma
id|err
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|in_dev
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|read_lock
c_func
(paren
op_amp
id|in_dev-&gt;mc_list_lock
)paren
suffix:semicolon
r_for
c_loop
(paren
id|pmc
op_assign
id|in_dev-&gt;mc_list
suffix:semicolon
id|pmc
suffix:semicolon
id|pmc
op_assign
id|pmc-&gt;next
)paren
(brace
r_if
c_cond
(paren
op_star
id|pmca
op_eq
id|pmc-&gt;multiaddr
)paren
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|pmc
)paren
(brace
multiline_comment|/* MCA not found?? bug */
id|read_unlock
c_func
(paren
op_amp
id|in_dev-&gt;mc_list_lock
)paren
suffix:semicolon
r_return
op_minus
id|ESRCH
suffix:semicolon
)brace
id|spin_lock_bh
c_func
(paren
op_amp
id|pmc-&gt;lock
)paren
suffix:semicolon
id|read_unlock
c_func
(paren
op_amp
id|in_dev-&gt;mc_list_lock
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_IP_MULTICAST
id|sf_markstate
c_func
(paren
id|pmc
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
op_logical_neg
id|delta
)paren
(brace
id|err
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pmc-&gt;sfcount
(braket
id|sfmode
)braket
)paren
r_goto
id|out_unlock
suffix:semicolon
id|pmc-&gt;sfcount
(braket
id|sfmode
)braket
op_decrement
suffix:semicolon
)brace
id|err
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|sfcount
suffix:semicolon
id|i
op_increment
)paren
(brace
r_int
id|rv
op_assign
id|ip_mc_del1_src
c_func
(paren
id|pmc
comma
id|sfmode
comma
op_amp
id|psfsrc
(braket
id|i
)braket
)paren
suffix:semicolon
id|changerec
op_or_assign
id|rv
OG
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|err
op_logical_and
id|rv
OL
l_int|0
)paren
id|err
op_assign
id|rv
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pmc-&gt;sfmode
op_eq
id|MCAST_EXCLUDE
op_logical_and
id|pmc-&gt;sfcount
(braket
id|MCAST_EXCLUDE
)braket
op_eq
l_int|0
op_logical_and
id|pmc-&gt;sfcount
(braket
id|MCAST_INCLUDE
)braket
)paren
(brace
macro_line|#ifdef CONFIG_IP_MULTICAST
r_struct
id|ip_sf_list
op_star
id|psf
suffix:semicolon
macro_line|#endif
multiline_comment|/* filter mode change */
id|pmc-&gt;sfmode
op_assign
id|MCAST_INCLUDE
suffix:semicolon
macro_line|#ifdef CONFIG_IP_MULTICAST
id|pmc-&gt;crcount
op_assign
id|in_dev-&gt;mr_qrv
ques
c_cond
id|in_dev-&gt;mr_qrv
suffix:colon
id|IGMP_Unsolicited_Report_Count
suffix:semicolon
id|in_dev-&gt;mr_ifc_count
op_assign
id|pmc-&gt;crcount
suffix:semicolon
r_for
c_loop
(paren
id|psf
op_assign
id|pmc-&gt;sources
suffix:semicolon
id|psf
suffix:semicolon
id|psf
op_assign
id|psf-&gt;sf_next
)paren
id|psf-&gt;sf_crcount
op_assign
l_int|0
suffix:semicolon
id|igmp_ifc_event
c_func
(paren
id|pmc-&gt;interface
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|sf_setstate
c_func
(paren
id|pmc
)paren
op_logical_or
id|changerec
)paren
(brace
id|igmp_ifc_event
c_func
(paren
id|pmc-&gt;interface
)paren
suffix:semicolon
macro_line|#endif
)brace
id|out_unlock
suffix:colon
id|spin_unlock_bh
c_func
(paren
op_amp
id|pmc-&gt;lock
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
multiline_comment|/*&n; * Add multicast single-source filter to the interface list&n; */
DECL|function|ip_mc_add1_src
r_static
r_int
id|ip_mc_add1_src
c_func
(paren
r_struct
id|ip_mc_list
op_star
id|pmc
comma
r_int
id|sfmode
comma
id|__u32
op_star
id|psfsrc
comma
r_int
id|delta
)paren
(brace
r_struct
id|ip_sf_list
op_star
id|psf
comma
op_star
id|psf_prev
suffix:semicolon
id|psf_prev
op_assign
l_int|NULL
suffix:semicolon
r_for
c_loop
(paren
id|psf
op_assign
id|pmc-&gt;sources
suffix:semicolon
id|psf
suffix:semicolon
id|psf
op_assign
id|psf-&gt;sf_next
)paren
(brace
r_if
c_cond
(paren
id|psf-&gt;sf_inaddr
op_eq
op_star
id|psfsrc
)paren
r_break
suffix:semicolon
id|psf_prev
op_assign
id|psf
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|psf
)paren
(brace
id|psf
op_assign
(paren
r_struct
id|ip_sf_list
op_star
)paren
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|psf
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|psf
)paren
r_return
op_minus
id|ENOBUFS
suffix:semicolon
id|memset
c_func
(paren
id|psf
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|psf
)paren
)paren
suffix:semicolon
id|psf-&gt;sf_inaddr
op_assign
op_star
id|psfsrc
suffix:semicolon
r_if
c_cond
(paren
id|psf_prev
)paren
(brace
id|psf_prev-&gt;sf_next
op_assign
id|psf
suffix:semicolon
)brace
r_else
id|pmc-&gt;sources
op_assign
id|psf
suffix:semicolon
)brace
id|psf-&gt;sf_count
(braket
id|sfmode
)braket
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|psf-&gt;sf_count
(braket
id|sfmode
)braket
op_eq
l_int|1
)paren
(brace
id|ip_rt_multicast_event
c_func
(paren
id|pmc-&gt;interface
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_IP_MULTICAST
DECL|function|sf_markstate
r_static
r_void
id|sf_markstate
c_func
(paren
r_struct
id|ip_mc_list
op_star
id|pmc
)paren
(brace
r_struct
id|ip_sf_list
op_star
id|psf
suffix:semicolon
r_int
id|mca_xcount
op_assign
id|pmc-&gt;sfcount
(braket
id|MCAST_EXCLUDE
)braket
suffix:semicolon
r_for
c_loop
(paren
id|psf
op_assign
id|pmc-&gt;sources
suffix:semicolon
id|psf
suffix:semicolon
id|psf
op_assign
id|psf-&gt;sf_next
)paren
r_if
c_cond
(paren
id|pmc-&gt;sfcount
(braket
id|MCAST_EXCLUDE
)braket
)paren
(brace
id|psf-&gt;sf_oldin
op_assign
id|mca_xcount
op_eq
id|psf-&gt;sf_count
(braket
id|MCAST_EXCLUDE
)braket
op_logical_and
op_logical_neg
id|psf-&gt;sf_count
(braket
id|MCAST_INCLUDE
)braket
suffix:semicolon
)brace
r_else
id|psf-&gt;sf_oldin
op_assign
id|psf-&gt;sf_count
(braket
id|MCAST_INCLUDE
)braket
op_ne
l_int|0
suffix:semicolon
)brace
DECL|function|sf_setstate
r_static
r_int
id|sf_setstate
c_func
(paren
r_struct
id|ip_mc_list
op_star
id|pmc
)paren
(brace
r_struct
id|ip_sf_list
op_star
id|psf
suffix:semicolon
r_int
id|mca_xcount
op_assign
id|pmc-&gt;sfcount
(braket
id|MCAST_EXCLUDE
)braket
suffix:semicolon
r_int
id|qrv
op_assign
id|pmc-&gt;interface-&gt;mr_qrv
suffix:semicolon
r_int
id|new_in
comma
id|rv
suffix:semicolon
id|rv
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|psf
op_assign
id|pmc-&gt;sources
suffix:semicolon
id|psf
suffix:semicolon
id|psf
op_assign
id|psf-&gt;sf_next
)paren
(brace
r_if
c_cond
(paren
id|pmc-&gt;sfcount
(braket
id|MCAST_EXCLUDE
)braket
)paren
(brace
id|new_in
op_assign
id|mca_xcount
op_eq
id|psf-&gt;sf_count
(braket
id|MCAST_EXCLUDE
)braket
op_logical_and
op_logical_neg
id|psf-&gt;sf_count
(braket
id|MCAST_INCLUDE
)braket
suffix:semicolon
)brace
r_else
id|new_in
op_assign
id|psf-&gt;sf_count
(braket
id|MCAST_INCLUDE
)braket
op_ne
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|new_in
op_ne
id|psf-&gt;sf_oldin
)paren
(brace
id|psf-&gt;sf_crcount
op_assign
id|qrv
suffix:semicolon
id|rv
op_increment
suffix:semicolon
)brace
)brace
r_return
id|rv
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/*&n; * Add multicast source filter list to the interface list&n; */
DECL|function|ip_mc_add_src
r_static
r_int
id|ip_mc_add_src
c_func
(paren
r_struct
id|in_device
op_star
id|in_dev
comma
id|__u32
op_star
id|pmca
comma
r_int
id|sfmode
comma
r_int
id|sfcount
comma
id|__u32
op_star
id|psfsrc
comma
r_int
id|delta
)paren
(brace
r_struct
id|ip_mc_list
op_star
id|pmc
suffix:semicolon
r_int
id|isexclude
suffix:semicolon
r_int
id|i
comma
id|err
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|in_dev
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|read_lock
c_func
(paren
op_amp
id|in_dev-&gt;mc_list_lock
)paren
suffix:semicolon
r_for
c_loop
(paren
id|pmc
op_assign
id|in_dev-&gt;mc_list
suffix:semicolon
id|pmc
suffix:semicolon
id|pmc
op_assign
id|pmc-&gt;next
)paren
(brace
r_if
c_cond
(paren
op_star
id|pmca
op_eq
id|pmc-&gt;multiaddr
)paren
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|pmc
)paren
(brace
multiline_comment|/* MCA not found?? bug */
id|read_unlock
c_func
(paren
op_amp
id|in_dev-&gt;mc_list_lock
)paren
suffix:semicolon
r_return
op_minus
id|ESRCH
suffix:semicolon
)brace
id|spin_lock_bh
c_func
(paren
op_amp
id|pmc-&gt;lock
)paren
suffix:semicolon
id|read_unlock
c_func
(paren
op_amp
id|in_dev-&gt;mc_list_lock
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_IP_MULTICAST
id|sf_markstate
c_func
(paren
id|pmc
)paren
suffix:semicolon
macro_line|#endif
id|isexclude
op_assign
id|pmc-&gt;sfmode
op_eq
id|MCAST_EXCLUDE
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|delta
)paren
id|pmc-&gt;sfcount
(braket
id|sfmode
)braket
op_increment
suffix:semicolon
id|err
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|sfcount
suffix:semicolon
id|i
op_increment
)paren
(brace
id|err
op_assign
id|ip_mc_add1_src
c_func
(paren
id|pmc
comma
id|sfmode
comma
op_amp
id|psfsrc
(braket
id|i
)braket
comma
id|delta
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|err
)paren
(brace
r_int
id|j
suffix:semicolon
id|pmc-&gt;sfcount
(braket
id|sfmode
)braket
op_decrement
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|i
suffix:semicolon
id|j
op_increment
)paren
(paren
r_void
)paren
id|ip_mc_del1_src
c_func
(paren
id|pmc
comma
id|sfmode
comma
op_amp
id|psfsrc
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|isexclude
op_ne
(paren
id|pmc-&gt;sfcount
(braket
id|MCAST_EXCLUDE
)braket
op_ne
l_int|0
)paren
)paren
(brace
macro_line|#ifdef CONFIG_IP_MULTICAST
r_struct
id|in_device
op_star
id|in_dev
op_assign
id|pmc-&gt;interface
suffix:semicolon
r_struct
id|ip_sf_list
op_star
id|psf
suffix:semicolon
macro_line|#endif
multiline_comment|/* filter mode change */
r_if
c_cond
(paren
id|pmc-&gt;sfcount
(braket
id|MCAST_EXCLUDE
)braket
)paren
id|pmc-&gt;sfmode
op_assign
id|MCAST_EXCLUDE
suffix:semicolon
r_else
r_if
c_cond
(paren
id|pmc-&gt;sfcount
(braket
id|MCAST_INCLUDE
)braket
)paren
id|pmc-&gt;sfmode
op_assign
id|MCAST_INCLUDE
suffix:semicolon
macro_line|#ifdef CONFIG_IP_MULTICAST
multiline_comment|/* else no filters; keep old mode for reports */
id|pmc-&gt;crcount
op_assign
id|in_dev-&gt;mr_qrv
ques
c_cond
id|in_dev-&gt;mr_qrv
suffix:colon
id|IGMP_Unsolicited_Report_Count
suffix:semicolon
id|in_dev-&gt;mr_ifc_count
op_assign
id|pmc-&gt;crcount
suffix:semicolon
r_for
c_loop
(paren
id|psf
op_assign
id|pmc-&gt;sources
suffix:semicolon
id|psf
suffix:semicolon
id|psf
op_assign
id|psf-&gt;sf_next
)paren
id|psf-&gt;sf_crcount
op_assign
l_int|0
suffix:semicolon
id|igmp_ifc_event
c_func
(paren
id|in_dev
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|sf_setstate
c_func
(paren
id|pmc
)paren
)paren
(brace
id|igmp_ifc_event
c_func
(paren
id|in_dev
)paren
suffix:semicolon
macro_line|#endif
)brace
id|spin_unlock_bh
c_func
(paren
op_amp
id|pmc-&gt;lock
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|ip_mc_clear_src
r_static
r_void
id|ip_mc_clear_src
c_func
(paren
r_struct
id|ip_mc_list
op_star
id|pmc
)paren
(brace
r_struct
id|ip_sf_list
op_star
id|psf
comma
op_star
id|nextpsf
suffix:semicolon
r_for
c_loop
(paren
id|psf
op_assign
id|pmc-&gt;tomb
suffix:semicolon
id|psf
suffix:semicolon
id|psf
op_assign
id|nextpsf
)paren
(brace
id|nextpsf
op_assign
id|psf-&gt;sf_next
suffix:semicolon
id|kfree
c_func
(paren
id|psf
)paren
suffix:semicolon
)brace
id|pmc-&gt;tomb
op_assign
l_int|NULL
suffix:semicolon
r_for
c_loop
(paren
id|psf
op_assign
id|pmc-&gt;sources
suffix:semicolon
id|psf
suffix:semicolon
id|psf
op_assign
id|nextpsf
)paren
(brace
id|nextpsf
op_assign
id|psf-&gt;sf_next
suffix:semicolon
id|kfree
c_func
(paren
id|psf
)paren
suffix:semicolon
)brace
id|pmc-&gt;sources
op_assign
l_int|NULL
suffix:semicolon
id|pmc-&gt;sfmode
op_assign
id|MCAST_EXCLUDE
suffix:semicolon
id|pmc-&gt;sfcount
(braket
id|MCAST_EXCLUDE
)braket
op_assign
l_int|0
suffix:semicolon
id|pmc-&gt;sfcount
(braket
id|MCAST_EXCLUDE
)braket
op_assign
l_int|1
suffix:semicolon
)brace
multiline_comment|/*&n; * Join a multicast group&n; */
DECL|function|ip_mc_join_group
r_int
id|ip_mc_join_group
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_struct
id|ip_mreqn
op_star
id|imr
)paren
(brace
r_int
id|err
suffix:semicolon
id|u32
id|addr
op_assign
id|imr-&gt;imr_multiaddr.s_addr
suffix:semicolon
r_struct
id|ip_mc_socklist
op_star
id|iml
comma
op_star
id|i
suffix:semicolon
r_struct
id|in_device
op_star
id|in_dev
suffix:semicolon
r_struct
id|inet_sock
op_star
id|inet
op_assign
id|inet_sk
c_func
(paren
id|sk
)paren
suffix:semicolon
r_int
id|count
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|MULTICAST
c_func
(paren
id|addr
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|rtnl_shlock
c_func
(paren
)paren
suffix:semicolon
id|in_dev
op_assign
id|ip_mc_find_dev
c_func
(paren
id|imr
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|in_dev
)paren
(brace
id|iml
op_assign
l_int|NULL
suffix:semicolon
id|err
op_assign
op_minus
id|ENODEV
suffix:semicolon
r_goto
id|done
suffix:semicolon
)brace
id|iml
op_assign
(paren
r_struct
id|ip_mc_socklist
op_star
)paren
id|sock_kmalloc
c_func
(paren
id|sk
comma
r_sizeof
(paren
op_star
id|iml
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
id|err
op_assign
op_minus
id|EADDRINUSE
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|inet-&gt;mc_list
suffix:semicolon
id|i
suffix:semicolon
id|i
op_assign
id|i-&gt;next
)paren
(brace
r_if
c_cond
(paren
id|memcmp
c_func
(paren
op_amp
id|i-&gt;multi
comma
id|imr
comma
r_sizeof
(paren
op_star
id|imr
)paren
)paren
op_eq
l_int|0
)paren
(brace
multiline_comment|/* New style additions are reference counted */
r_if
c_cond
(paren
id|imr-&gt;imr_address.s_addr
op_eq
l_int|0
)paren
(brace
id|i-&gt;count
op_increment
suffix:semicolon
id|err
op_assign
l_int|0
suffix:semicolon
)brace
r_goto
id|done
suffix:semicolon
)brace
id|count
op_increment
suffix:semicolon
)brace
id|err
op_assign
op_minus
id|ENOBUFS
suffix:semicolon
r_if
c_cond
(paren
id|iml
op_eq
l_int|NULL
op_logical_or
id|count
op_ge
id|sysctl_igmp_max_memberships
)paren
r_goto
id|done
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|iml-&gt;multi
comma
id|imr
comma
r_sizeof
(paren
op_star
id|imr
)paren
)paren
suffix:semicolon
id|iml-&gt;next
op_assign
id|inet-&gt;mc_list
suffix:semicolon
id|iml-&gt;count
op_assign
l_int|1
suffix:semicolon
id|iml-&gt;sflist
op_assign
l_int|NULL
suffix:semicolon
id|iml-&gt;sfmode
op_assign
id|MCAST_EXCLUDE
suffix:semicolon
id|inet-&gt;mc_list
op_assign
id|iml
suffix:semicolon
id|ip_mc_inc_group
c_func
(paren
id|in_dev
comma
id|addr
)paren
suffix:semicolon
id|iml
op_assign
l_int|NULL
suffix:semicolon
id|err
op_assign
l_int|0
suffix:semicolon
id|done
suffix:colon
id|rtnl_shunlock
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|iml
)paren
id|sock_kfree_s
c_func
(paren
id|sk
comma
id|iml
comma
r_sizeof
(paren
op_star
id|iml
)paren
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|ip_mc_leave_src
r_static
r_int
id|ip_mc_leave_src
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_struct
id|ip_mc_socklist
op_star
id|iml
comma
r_struct
id|in_device
op_star
id|in_dev
)paren
(brace
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
id|iml-&gt;sflist
op_eq
l_int|0
)paren
(brace
multiline_comment|/* any-source empty exclude case */
r_return
id|ip_mc_del_src
c_func
(paren
id|in_dev
comma
op_amp
id|iml-&gt;multi.imr_multiaddr.s_addr
comma
id|iml-&gt;sfmode
comma
l_int|0
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
)brace
id|err
op_assign
id|ip_mc_del_src
c_func
(paren
id|in_dev
comma
op_amp
id|iml-&gt;multi.imr_multiaddr.s_addr
comma
id|iml-&gt;sfmode
comma
id|iml-&gt;sflist-&gt;sl_count
comma
id|iml-&gt;sflist-&gt;sl_addr
comma
l_int|0
)paren
suffix:semicolon
id|sock_kfree_s
c_func
(paren
id|sk
comma
id|iml-&gt;sflist
comma
id|IP_SFLSIZE
c_func
(paren
id|iml-&gt;sflist-&gt;sl_max
)paren
)paren
suffix:semicolon
id|iml-&gt;sflist
op_assign
l_int|NULL
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;Ask a socket to leave a group.&n; */
DECL|function|ip_mc_leave_group
r_int
id|ip_mc_leave_group
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_struct
id|ip_mreqn
op_star
id|imr
)paren
(brace
r_struct
id|inet_sock
op_star
id|inet
op_assign
id|inet_sk
c_func
(paren
id|sk
)paren
suffix:semicolon
r_struct
id|ip_mc_socklist
op_star
id|iml
comma
op_star
op_star
id|imlp
suffix:semicolon
id|rtnl_lock
c_func
(paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|imlp
op_assign
op_amp
id|inet-&gt;mc_list
suffix:semicolon
(paren
id|iml
op_assign
op_star
id|imlp
)paren
op_ne
l_int|NULL
suffix:semicolon
id|imlp
op_assign
op_amp
id|iml-&gt;next
)paren
(brace
r_if
c_cond
(paren
id|iml-&gt;multi.imr_multiaddr.s_addr
op_eq
id|imr-&gt;imr_multiaddr.s_addr
op_logical_and
id|iml-&gt;multi.imr_address.s_addr
op_eq
id|imr-&gt;imr_address.s_addr
op_logical_and
(paren
op_logical_neg
id|imr-&gt;imr_ifindex
op_logical_or
id|iml-&gt;multi.imr_ifindex
op_eq
id|imr-&gt;imr_ifindex
)paren
)paren
(brace
r_struct
id|in_device
op_star
id|in_dev
suffix:semicolon
id|in_dev
op_assign
id|inetdev_by_index
c_func
(paren
id|iml-&gt;multi.imr_ifindex
)paren
suffix:semicolon
r_if
c_cond
(paren
id|in_dev
)paren
(paren
r_void
)paren
id|ip_mc_leave_src
c_func
(paren
id|sk
comma
id|iml
comma
id|in_dev
)paren
suffix:semicolon
r_if
c_cond
(paren
op_decrement
id|iml-&gt;count
)paren
(brace
id|rtnl_unlock
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|in_dev
)paren
id|in_dev_put
c_func
(paren
id|in_dev
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
op_star
id|imlp
op_assign
id|iml-&gt;next
suffix:semicolon
r_if
c_cond
(paren
id|in_dev
)paren
(brace
id|ip_mc_dec_group
c_func
(paren
id|in_dev
comma
id|imr-&gt;imr_multiaddr.s_addr
)paren
suffix:semicolon
id|in_dev_put
c_func
(paren
id|in_dev
)paren
suffix:semicolon
)brace
id|rtnl_unlock
c_func
(paren
)paren
suffix:semicolon
id|sock_kfree_s
c_func
(paren
id|sk
comma
id|iml
comma
r_sizeof
(paren
op_star
id|iml
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
id|rtnl_unlock
c_func
(paren
)paren
suffix:semicolon
r_return
op_minus
id|EADDRNOTAVAIL
suffix:semicolon
)brace
DECL|function|ip_mc_source
r_int
id|ip_mc_source
c_func
(paren
r_int
id|add
comma
r_int
id|omode
comma
r_struct
id|sock
op_star
id|sk
comma
r_struct
id|ip_mreq_source
op_star
id|mreqs
comma
r_int
id|ifindex
)paren
(brace
r_int
id|err
suffix:semicolon
r_struct
id|ip_mreqn
id|imr
suffix:semicolon
id|u32
id|addr
op_assign
id|mreqs-&gt;imr_multiaddr
suffix:semicolon
r_struct
id|ip_mc_socklist
op_star
id|pmc
suffix:semicolon
r_struct
id|in_device
op_star
id|in_dev
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|inet_sock
op_star
id|inet
op_assign
id|inet_sk
c_func
(paren
id|sk
)paren
suffix:semicolon
r_struct
id|ip_sf_socklist
op_star
id|psl
suffix:semicolon
r_int
id|i
comma
id|j
comma
id|rv
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|MULTICAST
c_func
(paren
id|addr
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|rtnl_shlock
c_func
(paren
)paren
suffix:semicolon
id|imr.imr_multiaddr.s_addr
op_assign
id|mreqs-&gt;imr_multiaddr
suffix:semicolon
id|imr.imr_address.s_addr
op_assign
id|mreqs-&gt;imr_interface
suffix:semicolon
id|imr.imr_ifindex
op_assign
id|ifindex
suffix:semicolon
id|in_dev
op_assign
id|ip_mc_find_dev
c_func
(paren
op_amp
id|imr
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|in_dev
)paren
(brace
id|err
op_assign
op_minus
id|ENODEV
suffix:semicolon
r_goto
id|done
suffix:semicolon
)brace
id|err
op_assign
op_minus
id|EADDRNOTAVAIL
suffix:semicolon
r_for
c_loop
(paren
id|pmc
op_assign
id|inet-&gt;mc_list
suffix:semicolon
id|pmc
suffix:semicolon
id|pmc
op_assign
id|pmc-&gt;next
)paren
(brace
r_if
c_cond
(paren
id|memcmp
c_func
(paren
op_amp
id|pmc-&gt;multi
comma
id|mreqs
comma
l_int|2
op_star
r_sizeof
(paren
id|__u32
)paren
)paren
op_eq
l_int|0
)paren
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|pmc
)paren
multiline_comment|/* must have a prior join */
r_goto
id|done
suffix:semicolon
multiline_comment|/* if a source filter was set, must be the same mode as before */
r_if
c_cond
(paren
id|pmc-&gt;sflist
)paren
(brace
r_if
c_cond
(paren
id|pmc-&gt;sfmode
op_ne
id|omode
)paren
r_goto
id|done
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|pmc-&gt;sfmode
op_ne
id|omode
)paren
(brace
multiline_comment|/* allow mode switches for empty-set filters */
id|ip_mc_add_src
c_func
(paren
id|in_dev
comma
op_amp
id|mreqs-&gt;imr_multiaddr
comma
id|omode
comma
l_int|0
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
id|ip_mc_del_src
c_func
(paren
id|in_dev
comma
op_amp
id|mreqs-&gt;imr_multiaddr
comma
id|pmc-&gt;sfmode
comma
l_int|0
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
id|pmc-&gt;sfmode
op_assign
id|omode
suffix:semicolon
)brace
id|psl
op_assign
id|pmc-&gt;sflist
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|add
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|psl
)paren
r_goto
id|done
suffix:semicolon
id|rv
op_assign
op_logical_neg
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|psl-&gt;sl_count
suffix:semicolon
id|i
op_increment
)paren
(brace
id|rv
op_assign
id|memcmp
c_func
(paren
op_amp
id|psl-&gt;sl_addr
(braket
id|i
)braket
comma
op_amp
id|mreqs-&gt;imr_sourceaddr
comma
r_sizeof
(paren
id|__u32
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rv
op_eq
l_int|0
)paren
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|rv
)paren
multiline_comment|/* source not found */
r_goto
id|done
suffix:semicolon
multiline_comment|/* update the interface filter */
id|ip_mc_del_src
c_func
(paren
id|in_dev
comma
op_amp
id|mreqs-&gt;imr_multiaddr
comma
id|omode
comma
l_int|1
comma
op_amp
id|mreqs-&gt;imr_sourceaddr
comma
l_int|1
)paren
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
id|i
op_plus
l_int|1
suffix:semicolon
id|j
OL
id|psl-&gt;sl_count
suffix:semicolon
id|j
op_increment
)paren
id|psl-&gt;sl_addr
(braket
id|j
op_minus
l_int|1
)braket
op_assign
id|psl-&gt;sl_addr
(braket
id|j
)braket
suffix:semicolon
id|psl-&gt;sl_count
op_decrement
suffix:semicolon
id|err
op_assign
l_int|0
suffix:semicolon
r_goto
id|done
suffix:semicolon
)brace
multiline_comment|/* else, add a new source to the filter */
r_if
c_cond
(paren
id|psl
op_logical_and
id|psl-&gt;sl_count
op_ge
id|sysctl_igmp_max_msf
)paren
(brace
id|err
op_assign
op_minus
id|ENOBUFS
suffix:semicolon
r_goto
id|done
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|psl
op_logical_or
id|psl-&gt;sl_count
op_eq
id|psl-&gt;sl_max
)paren
(brace
r_struct
id|ip_sf_socklist
op_star
id|newpsl
suffix:semicolon
r_int
id|count
op_assign
id|IP_SFBLOCK
suffix:semicolon
r_if
c_cond
(paren
id|psl
)paren
id|count
op_add_assign
id|psl-&gt;sl_max
suffix:semicolon
id|newpsl
op_assign
(paren
r_struct
id|ip_sf_socklist
op_star
)paren
id|sock_kmalloc
c_func
(paren
id|sk
comma
id|IP_SFLSIZE
c_func
(paren
id|count
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|newpsl
)paren
(brace
id|err
op_assign
op_minus
id|ENOBUFS
suffix:semicolon
r_goto
id|done
suffix:semicolon
)brace
id|newpsl-&gt;sl_max
op_assign
id|count
suffix:semicolon
id|newpsl-&gt;sl_count
op_assign
id|count
op_minus
id|IP_SFBLOCK
suffix:semicolon
r_if
c_cond
(paren
id|psl
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|psl-&gt;sl_count
suffix:semicolon
id|i
op_increment
)paren
id|newpsl-&gt;sl_addr
(braket
id|i
)braket
op_assign
id|psl-&gt;sl_addr
(braket
id|i
)braket
suffix:semicolon
id|sock_kfree_s
c_func
(paren
id|sk
comma
id|psl
comma
id|IP_SFLSIZE
c_func
(paren
id|psl-&gt;sl_max
)paren
)paren
suffix:semicolon
)brace
id|pmc-&gt;sflist
op_assign
id|psl
op_assign
id|newpsl
suffix:semicolon
)brace
id|rv
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* &gt; 0 for insert logic below if sl_count is 0 */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|psl-&gt;sl_count
suffix:semicolon
id|i
op_increment
)paren
(brace
id|rv
op_assign
id|memcmp
c_func
(paren
op_amp
id|psl-&gt;sl_addr
(braket
id|i
)braket
comma
op_amp
id|mreqs-&gt;imr_sourceaddr
comma
r_sizeof
(paren
id|__u32
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rv
op_eq
l_int|0
)paren
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|rv
op_eq
l_int|0
)paren
multiline_comment|/* address already there is an error */
r_goto
id|done
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
id|psl-&gt;sl_count
op_minus
l_int|1
suffix:semicolon
id|j
op_ge
id|i
suffix:semicolon
id|j
op_decrement
)paren
id|psl-&gt;sl_addr
(braket
id|j
op_plus
l_int|1
)braket
op_assign
id|psl-&gt;sl_addr
(braket
id|j
)braket
suffix:semicolon
id|psl-&gt;sl_addr
(braket
id|i
)braket
op_assign
id|mreqs-&gt;imr_sourceaddr
suffix:semicolon
id|psl-&gt;sl_count
op_increment
suffix:semicolon
id|err
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* update the interface list */
id|ip_mc_add_src
c_func
(paren
id|in_dev
comma
op_amp
id|mreqs-&gt;imr_multiaddr
comma
id|omode
comma
l_int|1
comma
op_amp
id|mreqs-&gt;imr_sourceaddr
comma
l_int|1
)paren
suffix:semicolon
id|done
suffix:colon
id|rtnl_shunlock
c_func
(paren
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|ip_mc_msfilter
r_int
id|ip_mc_msfilter
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_struct
id|ip_msfilter
op_star
id|msf
comma
r_int
id|ifindex
)paren
(brace
r_int
id|err
suffix:semicolon
r_struct
id|ip_mreqn
id|imr
suffix:semicolon
id|u32
id|addr
op_assign
id|msf-&gt;imsf_multiaddr
suffix:semicolon
r_struct
id|ip_mc_socklist
op_star
id|pmc
suffix:semicolon
r_struct
id|in_device
op_star
id|in_dev
suffix:semicolon
r_struct
id|inet_sock
op_star
id|inet
op_assign
id|inet_sk
c_func
(paren
id|sk
)paren
suffix:semicolon
r_struct
id|ip_sf_socklist
op_star
id|newpsl
comma
op_star
id|psl
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|MULTICAST
c_func
(paren
id|addr
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|msf-&gt;imsf_fmode
op_ne
id|MCAST_INCLUDE
op_logical_and
id|msf-&gt;imsf_fmode
op_ne
id|MCAST_EXCLUDE
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|rtnl_shlock
c_func
(paren
)paren
suffix:semicolon
id|imr.imr_multiaddr.s_addr
op_assign
id|msf-&gt;imsf_multiaddr
suffix:semicolon
id|imr.imr_address.s_addr
op_assign
id|msf-&gt;imsf_interface
suffix:semicolon
id|imr.imr_ifindex
op_assign
id|ifindex
suffix:semicolon
id|in_dev
op_assign
id|ip_mc_find_dev
c_func
(paren
op_amp
id|imr
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|in_dev
)paren
(brace
id|err
op_assign
op_minus
id|ENODEV
suffix:semicolon
r_goto
id|done
suffix:semicolon
)brace
id|err
op_assign
op_minus
id|EADDRNOTAVAIL
suffix:semicolon
r_for
c_loop
(paren
id|pmc
op_assign
id|inet-&gt;mc_list
suffix:semicolon
id|pmc
suffix:semicolon
id|pmc
op_assign
id|pmc-&gt;next
)paren
(brace
r_if
c_cond
(paren
id|pmc-&gt;multi.imr_multiaddr.s_addr
op_eq
id|msf-&gt;imsf_multiaddr
op_logical_and
id|pmc-&gt;multi.imr_ifindex
op_eq
id|imr.imr_ifindex
)paren
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|pmc
)paren
multiline_comment|/* must have a prior join */
r_goto
id|done
suffix:semicolon
r_if
c_cond
(paren
id|msf-&gt;imsf_numsrc
)paren
(brace
id|newpsl
op_assign
(paren
r_struct
id|ip_sf_socklist
op_star
)paren
id|sock_kmalloc
c_func
(paren
id|sk
comma
id|IP_SFLSIZE
c_func
(paren
id|msf-&gt;imsf_numsrc
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|newpsl
)paren
(brace
id|err
op_assign
op_minus
id|ENOBUFS
suffix:semicolon
r_goto
id|done
suffix:semicolon
)brace
id|newpsl-&gt;sl_max
op_assign
id|newpsl-&gt;sl_count
op_assign
id|msf-&gt;imsf_numsrc
suffix:semicolon
id|memcpy
c_func
(paren
id|newpsl-&gt;sl_addr
comma
id|msf-&gt;imsf_slist
comma
id|msf-&gt;imsf_numsrc
op_star
r_sizeof
(paren
id|msf-&gt;imsf_slist
(braket
l_int|0
)braket
)paren
)paren
suffix:semicolon
id|err
op_assign
id|ip_mc_add_src
c_func
(paren
id|in_dev
comma
op_amp
id|msf-&gt;imsf_multiaddr
comma
id|msf-&gt;imsf_fmode
comma
id|newpsl-&gt;sl_count
comma
id|newpsl-&gt;sl_addr
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|sock_kfree_s
c_func
(paren
id|sk
comma
id|newpsl
comma
id|IP_SFLSIZE
c_func
(paren
id|newpsl-&gt;sl_max
)paren
)paren
suffix:semicolon
r_goto
id|done
suffix:semicolon
)brace
)brace
r_else
id|newpsl
op_assign
l_int|NULL
suffix:semicolon
id|psl
op_assign
id|pmc-&gt;sflist
suffix:semicolon
r_if
c_cond
(paren
id|psl
)paren
(brace
(paren
r_void
)paren
id|ip_mc_del_src
c_func
(paren
id|in_dev
comma
op_amp
id|msf-&gt;imsf_multiaddr
comma
id|pmc-&gt;sfmode
comma
id|psl-&gt;sl_count
comma
id|psl-&gt;sl_addr
comma
l_int|0
)paren
suffix:semicolon
id|sock_kfree_s
c_func
(paren
id|sk
comma
id|psl
comma
id|IP_SFLSIZE
c_func
(paren
id|psl-&gt;sl_max
)paren
)paren
suffix:semicolon
)brace
r_else
(paren
r_void
)paren
id|ip_mc_del_src
c_func
(paren
id|in_dev
comma
op_amp
id|msf-&gt;imsf_multiaddr
comma
id|pmc-&gt;sfmode
comma
l_int|0
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
id|pmc-&gt;sflist
op_assign
id|newpsl
suffix:semicolon
id|pmc-&gt;sfmode
op_assign
id|msf-&gt;imsf_fmode
suffix:semicolon
id|done
suffix:colon
id|rtnl_shunlock
c_func
(paren
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|ip_mc_msfget
r_int
id|ip_mc_msfget
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_struct
id|ip_msfilter
op_star
id|msf
comma
r_struct
id|ip_msfilter
id|__user
op_star
id|optval
comma
r_int
id|__user
op_star
id|optlen
)paren
(brace
r_int
id|err
comma
id|len
comma
id|count
comma
id|copycount
suffix:semicolon
r_struct
id|ip_mreqn
id|imr
suffix:semicolon
id|u32
id|addr
op_assign
id|msf-&gt;imsf_multiaddr
suffix:semicolon
r_struct
id|ip_mc_socklist
op_star
id|pmc
suffix:semicolon
r_struct
id|in_device
op_star
id|in_dev
suffix:semicolon
r_struct
id|inet_sock
op_star
id|inet
op_assign
id|inet_sk
c_func
(paren
id|sk
)paren
suffix:semicolon
r_struct
id|ip_sf_socklist
op_star
id|psl
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|MULTICAST
c_func
(paren
id|addr
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|rtnl_shlock
c_func
(paren
)paren
suffix:semicolon
id|imr.imr_multiaddr.s_addr
op_assign
id|msf-&gt;imsf_multiaddr
suffix:semicolon
id|imr.imr_address.s_addr
op_assign
id|msf-&gt;imsf_interface
suffix:semicolon
id|imr.imr_ifindex
op_assign
l_int|0
suffix:semicolon
id|in_dev
op_assign
id|ip_mc_find_dev
c_func
(paren
op_amp
id|imr
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|in_dev
)paren
(brace
id|err
op_assign
op_minus
id|ENODEV
suffix:semicolon
r_goto
id|done
suffix:semicolon
)brace
id|err
op_assign
op_minus
id|EADDRNOTAVAIL
suffix:semicolon
r_for
c_loop
(paren
id|pmc
op_assign
id|inet-&gt;mc_list
suffix:semicolon
id|pmc
suffix:semicolon
id|pmc
op_assign
id|pmc-&gt;next
)paren
(brace
r_if
c_cond
(paren
id|pmc-&gt;multi.imr_multiaddr.s_addr
op_eq
id|msf-&gt;imsf_multiaddr
op_logical_and
id|pmc-&gt;multi.imr_ifindex
op_eq
id|imr.imr_ifindex
)paren
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|pmc
)paren
multiline_comment|/* must have a prior join */
r_goto
id|done
suffix:semicolon
id|msf-&gt;imsf_fmode
op_assign
id|pmc-&gt;sfmode
suffix:semicolon
id|psl
op_assign
id|pmc-&gt;sflist
suffix:semicolon
id|rtnl_shunlock
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|psl
)paren
(brace
id|len
op_assign
l_int|0
suffix:semicolon
id|count
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|count
op_assign
id|psl-&gt;sl_count
suffix:semicolon
)brace
id|copycount
op_assign
id|count
OL
id|msf-&gt;imsf_numsrc
ques
c_cond
id|count
suffix:colon
id|msf-&gt;imsf_numsrc
suffix:semicolon
id|len
op_assign
id|copycount
op_star
r_sizeof
(paren
id|psl-&gt;sl_addr
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|msf-&gt;imsf_numsrc
op_assign
id|count
suffix:semicolon
r_if
c_cond
(paren
id|put_user
c_func
(paren
id|IP_MSFILTER_SIZE
c_func
(paren
id|copycount
)paren
comma
id|optlen
)paren
op_logical_or
id|copy_to_user
c_func
(paren
id|optval
comma
id|msf
comma
id|IP_MSFILTER_SIZE
c_func
(paren
l_int|0
)paren
)paren
)paren
(brace
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
r_if
c_cond
(paren
id|len
op_logical_and
id|copy_to_user
c_func
(paren
op_amp
id|optval-&gt;imsf_slist
(braket
l_int|0
)braket
comma
id|psl-&gt;sl_addr
comma
id|len
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|done
suffix:colon
id|rtnl_shunlock
c_func
(paren
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|ip_mc_gsfget
r_int
id|ip_mc_gsfget
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_struct
id|group_filter
op_star
id|gsf
comma
r_struct
id|group_filter
id|__user
op_star
id|optval
comma
r_int
id|__user
op_star
id|optlen
)paren
(brace
r_int
id|err
comma
id|i
comma
id|count
comma
id|copycount
suffix:semicolon
r_struct
id|sockaddr_in
op_star
id|psin
suffix:semicolon
id|u32
id|addr
suffix:semicolon
r_struct
id|ip_mc_socklist
op_star
id|pmc
suffix:semicolon
r_struct
id|inet_sock
op_star
id|inet
op_assign
id|inet_sk
c_func
(paren
id|sk
)paren
suffix:semicolon
r_struct
id|ip_sf_socklist
op_star
id|psl
suffix:semicolon
id|psin
op_assign
(paren
r_struct
id|sockaddr_in
op_star
)paren
op_amp
id|gsf-&gt;gf_group
suffix:semicolon
r_if
c_cond
(paren
id|psin-&gt;sin_family
op_ne
id|AF_INET
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|addr
op_assign
id|psin-&gt;sin_addr.s_addr
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|MULTICAST
c_func
(paren
id|addr
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|rtnl_shlock
c_func
(paren
)paren
suffix:semicolon
id|err
op_assign
op_minus
id|EADDRNOTAVAIL
suffix:semicolon
r_for
c_loop
(paren
id|pmc
op_assign
id|inet-&gt;mc_list
suffix:semicolon
id|pmc
suffix:semicolon
id|pmc
op_assign
id|pmc-&gt;next
)paren
(brace
r_if
c_cond
(paren
id|pmc-&gt;multi.imr_multiaddr.s_addr
op_eq
id|addr
op_logical_and
id|pmc-&gt;multi.imr_ifindex
op_eq
id|gsf-&gt;gf_interface
)paren
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|pmc
)paren
multiline_comment|/* must have a prior join */
r_goto
id|done
suffix:semicolon
id|gsf-&gt;gf_fmode
op_assign
id|pmc-&gt;sfmode
suffix:semicolon
id|psl
op_assign
id|pmc-&gt;sflist
suffix:semicolon
id|rtnl_shunlock
c_func
(paren
)paren
suffix:semicolon
id|count
op_assign
id|psl
ques
c_cond
id|psl-&gt;sl_count
suffix:colon
l_int|0
suffix:semicolon
id|copycount
op_assign
id|count
OL
id|gsf-&gt;gf_numsrc
ques
c_cond
id|count
suffix:colon
id|gsf-&gt;gf_numsrc
suffix:semicolon
id|gsf-&gt;gf_numsrc
op_assign
id|count
suffix:semicolon
r_if
c_cond
(paren
id|put_user
c_func
(paren
id|GROUP_FILTER_SIZE
c_func
(paren
id|copycount
)paren
comma
id|optlen
)paren
op_logical_or
id|copy_to_user
c_func
(paren
id|optval
comma
id|gsf
comma
id|GROUP_FILTER_SIZE
c_func
(paren
l_int|0
)paren
)paren
)paren
(brace
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|copycount
suffix:semicolon
id|i
op_increment
)paren
(brace
r_struct
id|sockaddr_in
op_star
id|psin
suffix:semicolon
r_struct
id|sockaddr_storage
id|ss
suffix:semicolon
id|psin
op_assign
(paren
r_struct
id|sockaddr_in
op_star
)paren
op_amp
id|ss
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|ss
comma
l_int|0
comma
r_sizeof
(paren
id|ss
)paren
)paren
suffix:semicolon
id|psin-&gt;sin_family
op_assign
id|AF_INET
suffix:semicolon
id|psin-&gt;sin_addr.s_addr
op_assign
id|psl-&gt;sl_addr
(braket
id|i
)braket
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
op_amp
id|optval-&gt;gf_slist
(braket
id|i
)braket
comma
op_amp
id|ss
comma
r_sizeof
(paren
id|ss
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
id|done
suffix:colon
id|rtnl_shunlock
c_func
(paren
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
multiline_comment|/*&n; * check if a multicast source filter allows delivery for a given &lt;src,dst,intf&gt;&n; */
DECL|function|ip_mc_sf_allow
r_int
id|ip_mc_sf_allow
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
id|u32
id|loc_addr
comma
id|u32
id|rmt_addr
comma
r_int
id|dif
)paren
(brace
r_struct
id|inet_sock
op_star
id|inet
op_assign
id|inet_sk
c_func
(paren
id|sk
)paren
suffix:semicolon
r_struct
id|ip_mc_socklist
op_star
id|pmc
suffix:semicolon
r_struct
id|ip_sf_socklist
op_star
id|psl
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|MULTICAST
c_func
(paren
id|loc_addr
)paren
)paren
r_return
l_int|1
suffix:semicolon
r_for
c_loop
(paren
id|pmc
op_assign
id|inet-&gt;mc_list
suffix:semicolon
id|pmc
suffix:semicolon
id|pmc
op_assign
id|pmc-&gt;next
)paren
(brace
r_if
c_cond
(paren
id|pmc-&gt;multi.imr_multiaddr.s_addr
op_eq
id|loc_addr
op_logical_and
id|pmc-&gt;multi.imr_ifindex
op_eq
id|dif
)paren
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|pmc
)paren
r_return
l_int|1
suffix:semicolon
id|psl
op_assign
id|pmc-&gt;sflist
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|psl
)paren
r_return
id|pmc-&gt;sfmode
op_eq
id|MCAST_EXCLUDE
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|psl-&gt;sl_count
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|psl-&gt;sl_addr
(braket
id|i
)braket
op_eq
id|rmt_addr
)paren
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pmc-&gt;sfmode
op_eq
id|MCAST_INCLUDE
op_logical_and
id|i
op_ge
id|psl-&gt;sl_count
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|pmc-&gt;sfmode
op_eq
id|MCAST_EXCLUDE
op_logical_and
id|i
OL
id|psl-&gt;sl_count
)paren
r_return
l_int|0
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;A socket is closing.&n; */
DECL|function|ip_mc_drop_socket
r_void
id|ip_mc_drop_socket
c_func
(paren
r_struct
id|sock
op_star
id|sk
)paren
(brace
r_struct
id|inet_sock
op_star
id|inet
op_assign
id|inet_sk
c_func
(paren
id|sk
)paren
suffix:semicolon
r_struct
id|ip_mc_socklist
op_star
id|iml
suffix:semicolon
r_if
c_cond
(paren
id|inet-&gt;mc_list
op_eq
l_int|NULL
)paren
r_return
suffix:semicolon
id|rtnl_lock
c_func
(paren
)paren
suffix:semicolon
r_while
c_loop
(paren
(paren
id|iml
op_assign
id|inet-&gt;mc_list
)paren
op_ne
l_int|NULL
)paren
(brace
r_struct
id|in_device
op_star
id|in_dev
suffix:semicolon
id|inet-&gt;mc_list
op_assign
id|iml-&gt;next
suffix:semicolon
r_if
c_cond
(paren
(paren
id|in_dev
op_assign
id|inetdev_by_index
c_func
(paren
id|iml-&gt;multi.imr_ifindex
)paren
)paren
op_ne
l_int|NULL
)paren
(brace
(paren
r_void
)paren
id|ip_mc_leave_src
c_func
(paren
id|sk
comma
id|iml
comma
id|in_dev
)paren
suffix:semicolon
id|ip_mc_dec_group
c_func
(paren
id|in_dev
comma
id|iml-&gt;multi.imr_multiaddr.s_addr
)paren
suffix:semicolon
id|in_dev_put
c_func
(paren
id|in_dev
)paren
suffix:semicolon
)brace
id|sock_kfree_s
c_func
(paren
id|sk
comma
id|iml
comma
r_sizeof
(paren
op_star
id|iml
)paren
)paren
suffix:semicolon
)brace
id|rtnl_unlock
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|ip_check_mc
r_int
id|ip_check_mc
c_func
(paren
r_struct
id|in_device
op_star
id|in_dev
comma
id|u32
id|mc_addr
comma
id|u32
id|src_addr
comma
id|u16
id|proto
)paren
(brace
r_struct
id|ip_mc_list
op_star
id|im
suffix:semicolon
r_struct
id|ip_sf_list
op_star
id|psf
suffix:semicolon
r_int
id|rv
op_assign
l_int|0
suffix:semicolon
id|read_lock
c_func
(paren
op_amp
id|in_dev-&gt;mc_list_lock
)paren
suffix:semicolon
r_for
c_loop
(paren
id|im
op_assign
id|in_dev-&gt;mc_list
suffix:semicolon
id|im
suffix:semicolon
id|im
op_assign
id|im-&gt;next
)paren
(brace
r_if
c_cond
(paren
id|im-&gt;multiaddr
op_eq
id|mc_addr
)paren
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|im
op_logical_and
id|proto
op_eq
id|IPPROTO_IGMP
)paren
(brace
id|rv
op_assign
l_int|1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|im
)paren
(brace
r_if
c_cond
(paren
id|src_addr
)paren
(brace
r_for
c_loop
(paren
id|psf
op_assign
id|im-&gt;sources
suffix:semicolon
id|psf
suffix:semicolon
id|psf
op_assign
id|psf-&gt;sf_next
)paren
(brace
r_if
c_cond
(paren
id|psf-&gt;sf_inaddr
op_eq
id|src_addr
)paren
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|psf
)paren
id|rv
op_assign
id|psf-&gt;sf_count
(braket
id|MCAST_INCLUDE
)braket
op_logical_or
id|psf-&gt;sf_count
(braket
id|MCAST_EXCLUDE
)braket
op_ne
id|im-&gt;sfcount
(braket
id|MCAST_EXCLUDE
)braket
suffix:semicolon
r_else
id|rv
op_assign
id|im-&gt;sfcount
(braket
id|MCAST_EXCLUDE
)braket
op_ne
l_int|0
suffix:semicolon
)brace
r_else
id|rv
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* unspecified source; tentatively allow */
)brace
id|read_unlock
c_func
(paren
op_amp
id|in_dev-&gt;mc_list_lock
)paren
suffix:semicolon
r_return
id|rv
suffix:semicolon
)brace
macro_line|#if defined(CONFIG_PROC_FS)
DECL|struct|igmp_mc_iter_state
r_struct
id|igmp_mc_iter_state
(brace
DECL|member|dev
r_struct
id|net_device
op_star
id|dev
suffix:semicolon
DECL|member|in_dev
r_struct
id|in_device
op_star
id|in_dev
suffix:semicolon
)brace
suffix:semicolon
DECL|macro|igmp_mc_seq_private
mdefine_line|#define&t;igmp_mc_seq_private(seq)&t;((struct igmp_mc_iter_state *)(seq)-&gt;private)
DECL|function|igmp_mc_get_first
r_static
r_inline
r_struct
id|ip_mc_list
op_star
id|igmp_mc_get_first
c_func
(paren
r_struct
id|seq_file
op_star
id|seq
)paren
(brace
r_struct
id|ip_mc_list
op_star
id|im
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|igmp_mc_iter_state
op_star
id|state
op_assign
id|igmp_mc_seq_private
c_func
(paren
id|seq
)paren
suffix:semicolon
r_for
c_loop
(paren
id|state-&gt;dev
op_assign
id|dev_base
comma
id|state-&gt;in_dev
op_assign
l_int|NULL
suffix:semicolon
id|state-&gt;dev
suffix:semicolon
id|state-&gt;dev
op_assign
id|state-&gt;dev-&gt;next
)paren
(brace
r_struct
id|in_device
op_star
id|in_dev
suffix:semicolon
id|in_dev
op_assign
id|in_dev_get
c_func
(paren
id|state-&gt;dev
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|in_dev
)paren
r_continue
suffix:semicolon
id|read_lock
c_func
(paren
op_amp
id|in_dev-&gt;mc_list_lock
)paren
suffix:semicolon
id|im
op_assign
id|in_dev-&gt;mc_list
suffix:semicolon
r_if
c_cond
(paren
id|im
)paren
(brace
id|state-&gt;in_dev
op_assign
id|in_dev
suffix:semicolon
r_break
suffix:semicolon
)brace
id|read_unlock
c_func
(paren
op_amp
id|in_dev-&gt;mc_list_lock
)paren
suffix:semicolon
id|in_dev_put
c_func
(paren
id|in_dev
)paren
suffix:semicolon
)brace
r_return
id|im
suffix:semicolon
)brace
DECL|function|igmp_mc_get_next
r_static
r_struct
id|ip_mc_list
op_star
id|igmp_mc_get_next
c_func
(paren
r_struct
id|seq_file
op_star
id|seq
comma
r_struct
id|ip_mc_list
op_star
id|im
)paren
(brace
r_struct
id|igmp_mc_iter_state
op_star
id|state
op_assign
id|igmp_mc_seq_private
c_func
(paren
id|seq
)paren
suffix:semicolon
id|im
op_assign
id|im-&gt;next
suffix:semicolon
r_while
c_loop
(paren
op_logical_neg
id|im
)paren
(brace
r_if
c_cond
(paren
id|likely
c_func
(paren
id|state-&gt;in_dev
op_ne
l_int|NULL
)paren
)paren
(brace
id|read_unlock
c_func
(paren
op_amp
id|state-&gt;in_dev-&gt;mc_list_lock
)paren
suffix:semicolon
id|in_dev_put
c_func
(paren
id|state-&gt;in_dev
)paren
suffix:semicolon
)brace
id|state-&gt;dev
op_assign
id|state-&gt;dev-&gt;next
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|state-&gt;dev
)paren
(brace
id|state-&gt;in_dev
op_assign
l_int|NULL
suffix:semicolon
r_break
suffix:semicolon
)brace
id|state-&gt;in_dev
op_assign
id|in_dev_get
c_func
(paren
id|state-&gt;dev
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|state-&gt;in_dev
)paren
r_continue
suffix:semicolon
id|read_lock
c_func
(paren
op_amp
id|state-&gt;in_dev-&gt;mc_list_lock
)paren
suffix:semicolon
id|im
op_assign
id|state-&gt;in_dev-&gt;mc_list
suffix:semicolon
)brace
r_return
id|im
suffix:semicolon
)brace
DECL|function|igmp_mc_get_idx
r_static
r_struct
id|ip_mc_list
op_star
id|igmp_mc_get_idx
c_func
(paren
r_struct
id|seq_file
op_star
id|seq
comma
id|loff_t
id|pos
)paren
(brace
r_struct
id|ip_mc_list
op_star
id|im
op_assign
id|igmp_mc_get_first
c_func
(paren
id|seq
)paren
suffix:semicolon
r_if
c_cond
(paren
id|im
)paren
r_while
c_loop
(paren
id|pos
op_logical_and
(paren
id|im
op_assign
id|igmp_mc_get_next
c_func
(paren
id|seq
comma
id|im
)paren
)paren
op_ne
l_int|NULL
)paren
op_decrement
id|pos
suffix:semicolon
r_return
id|pos
ques
c_cond
l_int|NULL
suffix:colon
id|im
suffix:semicolon
)brace
DECL|function|igmp_mc_seq_start
r_static
r_void
op_star
id|igmp_mc_seq_start
c_func
(paren
r_struct
id|seq_file
op_star
id|seq
comma
id|loff_t
op_star
id|pos
)paren
(brace
id|read_lock
c_func
(paren
op_amp
id|dev_base_lock
)paren
suffix:semicolon
r_return
op_star
id|pos
ques
c_cond
id|igmp_mc_get_idx
c_func
(paren
id|seq
comma
op_star
id|pos
op_minus
l_int|1
)paren
suffix:colon
id|SEQ_START_TOKEN
suffix:semicolon
)brace
DECL|function|igmp_mc_seq_next
r_static
r_void
op_star
id|igmp_mc_seq_next
c_func
(paren
r_struct
id|seq_file
op_star
id|seq
comma
r_void
op_star
id|v
comma
id|loff_t
op_star
id|pos
)paren
(brace
r_struct
id|ip_mc_list
op_star
id|im
suffix:semicolon
r_if
c_cond
(paren
id|v
op_eq
id|SEQ_START_TOKEN
)paren
id|im
op_assign
id|igmp_mc_get_first
c_func
(paren
id|seq
)paren
suffix:semicolon
r_else
id|im
op_assign
id|igmp_mc_get_next
c_func
(paren
id|seq
comma
id|v
)paren
suffix:semicolon
op_increment
op_star
id|pos
suffix:semicolon
r_return
id|im
suffix:semicolon
)brace
DECL|function|igmp_mc_seq_stop
r_static
r_void
id|igmp_mc_seq_stop
c_func
(paren
r_struct
id|seq_file
op_star
id|seq
comma
r_void
op_star
id|v
)paren
(brace
r_struct
id|igmp_mc_iter_state
op_star
id|state
op_assign
id|igmp_mc_seq_private
c_func
(paren
id|seq
)paren
suffix:semicolon
r_if
c_cond
(paren
id|likely
c_func
(paren
id|state-&gt;in_dev
op_ne
l_int|NULL
)paren
)paren
(brace
id|read_unlock
c_func
(paren
op_amp
id|state-&gt;in_dev-&gt;mc_list_lock
)paren
suffix:semicolon
id|in_dev_put
c_func
(paren
id|state-&gt;in_dev
)paren
suffix:semicolon
id|state-&gt;in_dev
op_assign
l_int|NULL
suffix:semicolon
)brace
id|state-&gt;dev
op_assign
l_int|NULL
suffix:semicolon
id|read_unlock
c_func
(paren
op_amp
id|dev_base_lock
)paren
suffix:semicolon
)brace
DECL|function|igmp_mc_seq_show
r_static
r_int
id|igmp_mc_seq_show
c_func
(paren
r_struct
id|seq_file
op_star
id|seq
comma
r_void
op_star
id|v
)paren
(brace
r_if
c_cond
(paren
id|v
op_eq
id|SEQ_START_TOKEN
)paren
id|seq_puts
c_func
(paren
id|seq
comma
l_string|&quot;Idx&bslash;tDevice    : Count Querier&bslash;tGroup    Users Timer&bslash;tReporter&bslash;n&quot;
)paren
suffix:semicolon
r_else
(brace
r_struct
id|ip_mc_list
op_star
id|im
op_assign
(paren
r_struct
id|ip_mc_list
op_star
)paren
id|v
suffix:semicolon
r_struct
id|igmp_mc_iter_state
op_star
id|state
op_assign
id|igmp_mc_seq_private
c_func
(paren
id|seq
)paren
suffix:semicolon
r_char
op_star
id|querier
suffix:semicolon
macro_line|#ifdef CONFIG_IP_MULTICAST
id|querier
op_assign
id|IGMP_V1_SEEN
c_func
(paren
id|state-&gt;in_dev
)paren
ques
c_cond
l_string|&quot;V1&quot;
suffix:colon
id|IGMP_V2_SEEN
c_func
(paren
id|state-&gt;in_dev
)paren
ques
c_cond
l_string|&quot;V2&quot;
suffix:colon
l_string|&quot;V3&quot;
suffix:semicolon
macro_line|#else
id|querier
op_assign
l_string|&quot;NONE&quot;
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|state-&gt;in_dev-&gt;mc_list
op_eq
id|im
)paren
(brace
id|seq_printf
c_func
(paren
id|seq
comma
l_string|&quot;%d&bslash;t%-10s: %5d %7s&bslash;n&quot;
comma
id|state-&gt;dev-&gt;ifindex
comma
id|state-&gt;dev-&gt;name
comma
id|state-&gt;dev-&gt;mc_count
comma
id|querier
)paren
suffix:semicolon
)brace
id|seq_printf
c_func
(paren
id|seq
comma
l_string|&quot;&bslash;t&bslash;t&bslash;t&bslash;t%08lX %5d %d:%08lX&bslash;t&bslash;t%d&bslash;n&quot;
comma
id|im-&gt;multiaddr
comma
id|im-&gt;users
comma
id|im-&gt;tm_running
comma
id|im-&gt;tm_running
ques
c_cond
id|jiffies_to_clock_t
c_func
(paren
id|im-&gt;timer.expires
op_minus
id|jiffies
)paren
suffix:colon
l_int|0
comma
id|im-&gt;reporter
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|igmp_mc_seq_ops
r_static
r_struct
id|seq_operations
id|igmp_mc_seq_ops
op_assign
(brace
dot
id|start
op_assign
id|igmp_mc_seq_start
comma
dot
id|next
op_assign
id|igmp_mc_seq_next
comma
dot
id|stop
op_assign
id|igmp_mc_seq_stop
comma
dot
id|show
op_assign
id|igmp_mc_seq_show
comma
)brace
suffix:semicolon
DECL|function|igmp_mc_seq_open
r_static
r_int
id|igmp_mc_seq_open
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
(brace
r_struct
id|seq_file
op_star
id|seq
suffix:semicolon
r_int
id|rc
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_struct
id|igmp_mc_iter_state
op_star
id|s
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|s
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|s
)paren
r_goto
id|out
suffix:semicolon
id|rc
op_assign
id|seq_open
c_func
(paren
id|file
comma
op_amp
id|igmp_mc_seq_ops
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_goto
id|out_kfree
suffix:semicolon
id|seq
op_assign
id|file-&gt;private_data
suffix:semicolon
id|seq
op_member_access_from_pointer
r_private
op_assign
id|s
suffix:semicolon
id|memset
c_func
(paren
id|s
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|s
)paren
)paren
suffix:semicolon
id|out
suffix:colon
r_return
id|rc
suffix:semicolon
id|out_kfree
suffix:colon
id|kfree
c_func
(paren
id|s
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
DECL|variable|igmp_mc_seq_fops
r_static
r_struct
id|file_operations
id|igmp_mc_seq_fops
op_assign
(brace
dot
id|owner
op_assign
id|THIS_MODULE
comma
dot
id|open
op_assign
id|igmp_mc_seq_open
comma
dot
id|read
op_assign
id|seq_read
comma
dot
id|llseek
op_assign
id|seq_lseek
comma
dot
id|release
op_assign
id|seq_release_private
comma
)brace
suffix:semicolon
DECL|struct|igmp_mcf_iter_state
r_struct
id|igmp_mcf_iter_state
(brace
DECL|member|dev
r_struct
id|net_device
op_star
id|dev
suffix:semicolon
DECL|member|idev
r_struct
id|in_device
op_star
id|idev
suffix:semicolon
DECL|member|im
r_struct
id|ip_mc_list
op_star
id|im
suffix:semicolon
)brace
suffix:semicolon
DECL|macro|igmp_mcf_seq_private
mdefine_line|#define igmp_mcf_seq_private(seq)&t;((struct igmp_mcf_iter_state *)(seq)-&gt;private)
DECL|function|igmp_mcf_get_first
r_static
r_inline
r_struct
id|ip_sf_list
op_star
id|igmp_mcf_get_first
c_func
(paren
r_struct
id|seq_file
op_star
id|seq
)paren
(brace
r_struct
id|ip_sf_list
op_star
id|psf
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|ip_mc_list
op_star
id|im
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|igmp_mcf_iter_state
op_star
id|state
op_assign
id|igmp_mcf_seq_private
c_func
(paren
id|seq
)paren
suffix:semicolon
r_for
c_loop
(paren
id|state-&gt;dev
op_assign
id|dev_base
comma
id|state-&gt;idev
op_assign
l_int|NULL
comma
id|state-&gt;im
op_assign
l_int|NULL
suffix:semicolon
id|state-&gt;dev
suffix:semicolon
id|state-&gt;dev
op_assign
id|state-&gt;dev-&gt;next
)paren
(brace
r_struct
id|in_device
op_star
id|idev
suffix:semicolon
id|idev
op_assign
id|in_dev_get
c_func
(paren
id|state-&gt;dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|unlikely
c_func
(paren
id|idev
op_eq
l_int|NULL
)paren
)paren
r_continue
suffix:semicolon
id|read_lock
c_func
(paren
op_amp
id|idev-&gt;mc_list_lock
)paren
suffix:semicolon
id|im
op_assign
id|idev-&gt;mc_list
suffix:semicolon
r_if
c_cond
(paren
id|likely
c_func
(paren
id|im
op_ne
l_int|NULL
)paren
)paren
(brace
id|spin_lock_bh
c_func
(paren
op_amp
id|im-&gt;lock
)paren
suffix:semicolon
id|psf
op_assign
id|im-&gt;sources
suffix:semicolon
r_if
c_cond
(paren
id|likely
c_func
(paren
id|psf
op_ne
l_int|NULL
)paren
)paren
(brace
id|state-&gt;im
op_assign
id|im
suffix:semicolon
id|state-&gt;idev
op_assign
id|idev
suffix:semicolon
r_break
suffix:semicolon
)brace
id|spin_unlock_bh
c_func
(paren
op_amp
id|im-&gt;lock
)paren
suffix:semicolon
)brace
id|read_unlock
c_func
(paren
op_amp
id|idev-&gt;mc_list_lock
)paren
suffix:semicolon
id|in_dev_put
c_func
(paren
id|idev
)paren
suffix:semicolon
)brace
r_return
id|psf
suffix:semicolon
)brace
DECL|function|igmp_mcf_get_next
r_static
r_struct
id|ip_sf_list
op_star
id|igmp_mcf_get_next
c_func
(paren
r_struct
id|seq_file
op_star
id|seq
comma
r_struct
id|ip_sf_list
op_star
id|psf
)paren
(brace
r_struct
id|igmp_mcf_iter_state
op_star
id|state
op_assign
id|igmp_mcf_seq_private
c_func
(paren
id|seq
)paren
suffix:semicolon
id|psf
op_assign
id|psf-&gt;sf_next
suffix:semicolon
r_while
c_loop
(paren
op_logical_neg
id|psf
)paren
(brace
id|spin_unlock_bh
c_func
(paren
op_amp
id|state-&gt;im-&gt;lock
)paren
suffix:semicolon
id|state-&gt;im
op_assign
id|state-&gt;im-&gt;next
suffix:semicolon
r_while
c_loop
(paren
op_logical_neg
id|state-&gt;im
)paren
(brace
r_if
c_cond
(paren
id|likely
c_func
(paren
id|state-&gt;idev
op_ne
l_int|NULL
)paren
)paren
(brace
id|read_unlock
c_func
(paren
op_amp
id|state-&gt;idev-&gt;mc_list_lock
)paren
suffix:semicolon
id|in_dev_put
c_func
(paren
id|state-&gt;idev
)paren
suffix:semicolon
)brace
id|state-&gt;dev
op_assign
id|state-&gt;dev-&gt;next
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|state-&gt;dev
)paren
(brace
id|state-&gt;idev
op_assign
l_int|NULL
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|state-&gt;idev
op_assign
id|in_dev_get
c_func
(paren
id|state-&gt;dev
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|state-&gt;idev
)paren
r_continue
suffix:semicolon
id|read_lock
c_func
(paren
op_amp
id|state-&gt;idev-&gt;mc_list_lock
)paren
suffix:semicolon
id|state-&gt;im
op_assign
id|state-&gt;idev-&gt;mc_list
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|state-&gt;im
)paren
r_break
suffix:semicolon
id|spin_lock_bh
c_func
(paren
op_amp
id|state-&gt;im-&gt;lock
)paren
suffix:semicolon
id|psf
op_assign
id|state-&gt;im-&gt;sources
suffix:semicolon
)brace
id|out
suffix:colon
r_return
id|psf
suffix:semicolon
)brace
DECL|function|igmp_mcf_get_idx
r_static
r_struct
id|ip_sf_list
op_star
id|igmp_mcf_get_idx
c_func
(paren
r_struct
id|seq_file
op_star
id|seq
comma
id|loff_t
id|pos
)paren
(brace
r_struct
id|ip_sf_list
op_star
id|psf
op_assign
id|igmp_mcf_get_first
c_func
(paren
id|seq
)paren
suffix:semicolon
r_if
c_cond
(paren
id|psf
)paren
r_while
c_loop
(paren
id|pos
op_logical_and
(paren
id|psf
op_assign
id|igmp_mcf_get_next
c_func
(paren
id|seq
comma
id|psf
)paren
)paren
op_ne
l_int|NULL
)paren
op_decrement
id|pos
suffix:semicolon
r_return
id|pos
ques
c_cond
l_int|NULL
suffix:colon
id|psf
suffix:semicolon
)brace
DECL|function|igmp_mcf_seq_start
r_static
r_void
op_star
id|igmp_mcf_seq_start
c_func
(paren
r_struct
id|seq_file
op_star
id|seq
comma
id|loff_t
op_star
id|pos
)paren
(brace
id|read_lock
c_func
(paren
op_amp
id|dev_base_lock
)paren
suffix:semicolon
r_return
op_star
id|pos
ques
c_cond
id|igmp_mcf_get_idx
c_func
(paren
id|seq
comma
op_star
id|pos
op_minus
l_int|1
)paren
suffix:colon
id|SEQ_START_TOKEN
suffix:semicolon
)brace
DECL|function|igmp_mcf_seq_next
r_static
r_void
op_star
id|igmp_mcf_seq_next
c_func
(paren
r_struct
id|seq_file
op_star
id|seq
comma
r_void
op_star
id|v
comma
id|loff_t
op_star
id|pos
)paren
(brace
r_struct
id|ip_sf_list
op_star
id|psf
suffix:semicolon
r_if
c_cond
(paren
id|v
op_eq
id|SEQ_START_TOKEN
)paren
id|psf
op_assign
id|igmp_mcf_get_first
c_func
(paren
id|seq
)paren
suffix:semicolon
r_else
id|psf
op_assign
id|igmp_mcf_get_next
c_func
(paren
id|seq
comma
id|v
)paren
suffix:semicolon
op_increment
op_star
id|pos
suffix:semicolon
r_return
id|psf
suffix:semicolon
)brace
DECL|function|igmp_mcf_seq_stop
r_static
r_void
id|igmp_mcf_seq_stop
c_func
(paren
r_struct
id|seq_file
op_star
id|seq
comma
r_void
op_star
id|v
)paren
(brace
r_struct
id|igmp_mcf_iter_state
op_star
id|state
op_assign
id|igmp_mcf_seq_private
c_func
(paren
id|seq
)paren
suffix:semicolon
r_if
c_cond
(paren
id|likely
c_func
(paren
id|state-&gt;im
op_ne
l_int|NULL
)paren
)paren
(brace
id|spin_unlock_bh
c_func
(paren
op_amp
id|state-&gt;im-&gt;lock
)paren
suffix:semicolon
id|state-&gt;im
op_assign
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|likely
c_func
(paren
id|state-&gt;idev
op_ne
l_int|NULL
)paren
)paren
(brace
id|read_unlock
c_func
(paren
op_amp
id|state-&gt;idev-&gt;mc_list_lock
)paren
suffix:semicolon
id|in_dev_put
c_func
(paren
id|state-&gt;idev
)paren
suffix:semicolon
id|state-&gt;idev
op_assign
l_int|NULL
suffix:semicolon
)brace
id|state-&gt;dev
op_assign
l_int|NULL
suffix:semicolon
id|read_unlock
c_func
(paren
op_amp
id|dev_base_lock
)paren
suffix:semicolon
)brace
DECL|function|igmp_mcf_seq_show
r_static
r_int
id|igmp_mcf_seq_show
c_func
(paren
r_struct
id|seq_file
op_star
id|seq
comma
r_void
op_star
id|v
)paren
(brace
r_struct
id|ip_sf_list
op_star
id|psf
op_assign
(paren
r_struct
id|ip_sf_list
op_star
)paren
id|v
suffix:semicolon
r_struct
id|igmp_mcf_iter_state
op_star
id|state
op_assign
id|igmp_mcf_seq_private
c_func
(paren
id|seq
)paren
suffix:semicolon
r_if
c_cond
(paren
id|v
op_eq
id|SEQ_START_TOKEN
)paren
(brace
id|seq_printf
c_func
(paren
id|seq
comma
l_string|&quot;%3s %6s &quot;
l_string|&quot;%10s %10s %6s %6s&bslash;n&quot;
comma
l_string|&quot;Idx&quot;
comma
l_string|&quot;Device&quot;
comma
l_string|&quot;MCA&quot;
comma
l_string|&quot;SRC&quot;
comma
l_string|&quot;INC&quot;
comma
l_string|&quot;EXC&quot;
)paren
suffix:semicolon
)brace
r_else
(brace
id|seq_printf
c_func
(paren
id|seq
comma
l_string|&quot;%3d %6.6s 0x%08x &quot;
l_string|&quot;0x%08x %6lu %6lu&bslash;n&quot;
comma
id|state-&gt;dev-&gt;ifindex
comma
id|state-&gt;dev-&gt;name
comma
id|ntohl
c_func
(paren
id|state-&gt;im-&gt;multiaddr
)paren
comma
id|ntohl
c_func
(paren
id|psf-&gt;sf_inaddr
)paren
comma
id|psf-&gt;sf_count
(braket
id|MCAST_INCLUDE
)braket
comma
id|psf-&gt;sf_count
(braket
id|MCAST_EXCLUDE
)braket
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|igmp_mcf_seq_ops
r_static
r_struct
id|seq_operations
id|igmp_mcf_seq_ops
op_assign
(brace
dot
id|start
op_assign
id|igmp_mcf_seq_start
comma
dot
id|next
op_assign
id|igmp_mcf_seq_next
comma
dot
id|stop
op_assign
id|igmp_mcf_seq_stop
comma
dot
id|show
op_assign
id|igmp_mcf_seq_show
comma
)brace
suffix:semicolon
DECL|function|igmp_mcf_seq_open
r_static
r_int
id|igmp_mcf_seq_open
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
(brace
r_struct
id|seq_file
op_star
id|seq
suffix:semicolon
r_int
id|rc
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_struct
id|igmp_mcf_iter_state
op_star
id|s
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|s
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|s
)paren
r_goto
id|out
suffix:semicolon
id|rc
op_assign
id|seq_open
c_func
(paren
id|file
comma
op_amp
id|igmp_mcf_seq_ops
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_goto
id|out_kfree
suffix:semicolon
id|seq
op_assign
id|file-&gt;private_data
suffix:semicolon
id|seq
op_member_access_from_pointer
r_private
op_assign
id|s
suffix:semicolon
id|memset
c_func
(paren
id|s
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|s
)paren
)paren
suffix:semicolon
id|out
suffix:colon
r_return
id|rc
suffix:semicolon
id|out_kfree
suffix:colon
id|kfree
c_func
(paren
id|s
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
DECL|variable|igmp_mcf_seq_fops
r_static
r_struct
id|file_operations
id|igmp_mcf_seq_fops
op_assign
(brace
dot
id|owner
op_assign
id|THIS_MODULE
comma
dot
id|open
op_assign
id|igmp_mcf_seq_open
comma
dot
id|read
op_assign
id|seq_read
comma
dot
id|llseek
op_assign
id|seq_lseek
comma
dot
id|release
op_assign
id|seq_release_private
comma
)brace
suffix:semicolon
DECL|function|igmp_mc_proc_init
r_int
id|__init
id|igmp_mc_proc_init
c_func
(paren
r_void
)paren
(brace
id|proc_net_fops_create
c_func
(paren
l_string|&quot;igmp&quot;
comma
id|S_IRUGO
comma
op_amp
id|igmp_mc_seq_fops
)paren
suffix:semicolon
id|proc_net_fops_create
c_func
(paren
l_string|&quot;mcfilter&quot;
comma
id|S_IRUGO
comma
op_amp
id|igmp_mcf_seq_fops
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#endif
DECL|variable|ip_mc_dec_group
id|EXPORT_SYMBOL
c_func
(paren
id|ip_mc_dec_group
)paren
suffix:semicolon
DECL|variable|ip_mc_inc_group
id|EXPORT_SYMBOL
c_func
(paren
id|ip_mc_inc_group
)paren
suffix:semicolon
DECL|variable|ip_mc_join_group
id|EXPORT_SYMBOL
c_func
(paren
id|ip_mc_join_group
)paren
suffix:semicolon
eof
