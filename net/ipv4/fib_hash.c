multiline_comment|/*&n; * INET&t;&t;An implementation of the TCP/IP protocol suite for the LINUX&n; *&t;&t;operating system.  INET is implemented using the  BSD Socket&n; *&t;&t;interface as the means of communication with the user level.&n; *&n; *&t;&t;IPv4 FIB: lookup engine and maintenance routines.&n; *&n; * Version:&t;$Id: fib_hash.c,v 1.13 2001/10/31 21:55:54 davem Exp $&n; *&n; * Authors:&t;Alexey Kuznetsov, &lt;kuznet@ms2.inr.ac.ru&gt;&n; *&n; *&t;&t;This program is free software; you can redistribute it and/or&n; *&t;&t;modify it under the terms of the GNU General Public License&n; *&t;&t;as published by the Free Software Foundation; either version&n; *&t;&t;2 of the License, or (at your option) any later version.&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;asm/system.h&gt;
macro_line|#include &lt;linux/bitops.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/socket.h&gt;
macro_line|#include &lt;linux/sockios.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/in.h&gt;
macro_line|#include &lt;linux/inet.h&gt;
macro_line|#include &lt;linux/netdevice.h&gt;
macro_line|#include &lt;linux/if_arp.h&gt;
macro_line|#include &lt;linux/proc_fs.h&gt;
macro_line|#include &lt;linux/skbuff.h&gt;
macro_line|#include &lt;linux/netlink.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;net/ip.h&gt;
macro_line|#include &lt;net/protocol.h&gt;
macro_line|#include &lt;net/route.h&gt;
macro_line|#include &lt;net/tcp.h&gt;
macro_line|#include &lt;net/sock.h&gt;
macro_line|#include &lt;net/ip_fib.h&gt;
macro_line|#include &quot;fib_lookup.h&quot;
DECL|variable|fn_hash_kmem
r_static
id|kmem_cache_t
op_star
id|fn_hash_kmem
suffix:semicolon
DECL|variable|fn_alias_kmem
r_static
id|kmem_cache_t
op_star
id|fn_alias_kmem
suffix:semicolon
DECL|struct|fib_node
r_struct
id|fib_node
(brace
DECL|member|fn_hash
r_struct
id|hlist_node
id|fn_hash
suffix:semicolon
DECL|member|fn_alias
r_struct
id|list_head
id|fn_alias
suffix:semicolon
DECL|member|fn_key
id|u32
id|fn_key
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|fn_zone
r_struct
id|fn_zone
(brace
DECL|member|fz_next
r_struct
id|fn_zone
op_star
id|fz_next
suffix:semicolon
multiline_comment|/* Next not empty zone&t;*/
DECL|member|fz_hash
r_struct
id|hlist_head
op_star
id|fz_hash
suffix:semicolon
multiline_comment|/* Hash table pointer&t;*/
DECL|member|fz_nent
r_int
id|fz_nent
suffix:semicolon
multiline_comment|/* Number of entries&t;*/
DECL|member|fz_divisor
r_int
id|fz_divisor
suffix:semicolon
multiline_comment|/* Hash divisor&t;&t;*/
DECL|member|fz_hashmask
id|u32
id|fz_hashmask
suffix:semicolon
multiline_comment|/* (fz_divisor - 1)&t;*/
DECL|macro|FZ_HASHMASK
mdefine_line|#define FZ_HASHMASK(fz)&t;&t;((fz)-&gt;fz_hashmask)
DECL|member|fz_order
r_int
id|fz_order
suffix:semicolon
multiline_comment|/* Zone order&t;&t;*/
DECL|member|fz_mask
id|u32
id|fz_mask
suffix:semicolon
DECL|macro|FZ_MASK
mdefine_line|#define FZ_MASK(fz)&t;&t;((fz)-&gt;fz_mask)
)brace
suffix:semicolon
multiline_comment|/* NOTE. On fast computers evaluation of fz_hashmask and fz_mask&n; * can be cheaper than memory lookup, so that FZ_* macros are used.&n; */
DECL|struct|fn_hash
r_struct
id|fn_hash
(brace
DECL|member|fn_zones
r_struct
id|fn_zone
op_star
id|fn_zones
(braket
l_int|33
)braket
suffix:semicolon
DECL|member|fn_zone_list
r_struct
id|fn_zone
op_star
id|fn_zone_list
suffix:semicolon
)brace
suffix:semicolon
DECL|function|fn_hash
r_static
r_inline
id|u32
id|fn_hash
c_func
(paren
id|u32
id|key
comma
r_struct
id|fn_zone
op_star
id|fz
)paren
(brace
id|u32
id|h
op_assign
id|ntohl
c_func
(paren
id|key
)paren
op_rshift
(paren
l_int|32
op_minus
id|fz-&gt;fz_order
)paren
suffix:semicolon
id|h
op_xor_assign
(paren
id|h
op_rshift
l_int|20
)paren
suffix:semicolon
id|h
op_xor_assign
(paren
id|h
op_rshift
l_int|10
)paren
suffix:semicolon
id|h
op_xor_assign
(paren
id|h
op_rshift
l_int|5
)paren
suffix:semicolon
id|h
op_and_assign
id|FZ_HASHMASK
c_func
(paren
id|fz
)paren
suffix:semicolon
r_return
id|h
suffix:semicolon
)brace
DECL|function|fz_key
r_static
r_inline
id|u32
id|fz_key
c_func
(paren
id|u32
id|dst
comma
r_struct
id|fn_zone
op_star
id|fz
)paren
(brace
r_return
id|dst
op_amp
id|FZ_MASK
c_func
(paren
id|fz
)paren
suffix:semicolon
)brace
r_static
id|DEFINE_RWLOCK
c_func
(paren
id|fib_hash_lock
)paren
suffix:semicolon
DECL|macro|FZ_MAX_DIVISOR
mdefine_line|#define FZ_MAX_DIVISOR ((PAGE_SIZE&lt;&lt;MAX_ORDER) / sizeof(struct hlist_head))
DECL|function|fz_hash_alloc
r_static
r_struct
id|hlist_head
op_star
id|fz_hash_alloc
c_func
(paren
r_int
id|divisor
)paren
(brace
r_int
r_int
id|size
op_assign
id|divisor
op_star
r_sizeof
(paren
r_struct
id|hlist_head
)paren
suffix:semicolon
r_if
c_cond
(paren
id|size
op_le
id|PAGE_SIZE
)paren
(brace
r_return
id|kmalloc
c_func
(paren
id|size
comma
id|GFP_KERNEL
)paren
suffix:semicolon
)brace
r_else
(brace
r_return
(paren
r_struct
id|hlist_head
op_star
)paren
id|__get_free_pages
c_func
(paren
id|GFP_KERNEL
comma
id|get_order
c_func
(paren
id|size
)paren
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* The fib hash lock must be held when this is called. */
DECL|function|fn_rebuild_zone
r_static
r_inline
r_void
id|fn_rebuild_zone
c_func
(paren
r_struct
id|fn_zone
op_star
id|fz
comma
r_struct
id|hlist_head
op_star
id|old_ht
comma
r_int
id|old_divisor
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|old_divisor
suffix:semicolon
id|i
op_increment
)paren
(brace
r_struct
id|hlist_node
op_star
id|node
comma
op_star
id|n
suffix:semicolon
r_struct
id|fib_node
op_star
id|f
suffix:semicolon
id|hlist_for_each_entry_safe
c_func
(paren
id|f
comma
id|node
comma
id|n
comma
op_amp
id|old_ht
(braket
id|i
)braket
comma
id|fn_hash
)paren
(brace
r_struct
id|hlist_head
op_star
id|new_head
suffix:semicolon
id|hlist_del
c_func
(paren
op_amp
id|f-&gt;fn_hash
)paren
suffix:semicolon
id|new_head
op_assign
op_amp
id|fz-&gt;fz_hash
(braket
id|fn_hash
c_func
(paren
id|f-&gt;fn_key
comma
id|fz
)paren
)braket
suffix:semicolon
id|hlist_add_head
c_func
(paren
op_amp
id|f-&gt;fn_hash
comma
id|new_head
)paren
suffix:semicolon
)brace
)brace
)brace
DECL|function|fz_hash_free
r_static
r_void
id|fz_hash_free
c_func
(paren
r_struct
id|hlist_head
op_star
id|hash
comma
r_int
id|divisor
)paren
(brace
r_int
r_int
id|size
op_assign
id|divisor
op_star
r_sizeof
(paren
r_struct
id|hlist_head
)paren
suffix:semicolon
r_if
c_cond
(paren
id|size
op_le
id|PAGE_SIZE
)paren
id|kfree
c_func
(paren
id|hash
)paren
suffix:semicolon
r_else
id|free_pages
c_func
(paren
(paren
r_int
r_int
)paren
id|hash
comma
id|get_order
c_func
(paren
id|size
)paren
)paren
suffix:semicolon
)brace
DECL|function|fn_rehash_zone
r_static
r_void
id|fn_rehash_zone
c_func
(paren
r_struct
id|fn_zone
op_star
id|fz
)paren
(brace
r_struct
id|hlist_head
op_star
id|ht
comma
op_star
id|old_ht
suffix:semicolon
r_int
id|old_divisor
comma
id|new_divisor
suffix:semicolon
id|u32
id|new_hashmask
suffix:semicolon
id|old_divisor
op_assign
id|fz-&gt;fz_divisor
suffix:semicolon
r_switch
c_cond
(paren
id|old_divisor
)paren
(brace
r_case
l_int|16
suffix:colon
id|new_divisor
op_assign
l_int|256
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|256
suffix:colon
id|new_divisor
op_assign
l_int|1024
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
(brace
)brace
r_if
c_cond
(paren
(paren
id|old_divisor
op_lshift
l_int|1
)paren
OG
id|FZ_MAX_DIVISOR
)paren
(brace
id|printk
c_func
(paren
id|KERN_CRIT
l_string|&quot;route.c: bad divisor %d!&bslash;n&quot;
comma
id|old_divisor
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|new_divisor
op_assign
(paren
id|old_divisor
op_lshift
l_int|1
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|new_hashmask
op_assign
(paren
id|new_divisor
op_minus
l_int|1
)paren
suffix:semicolon
macro_line|#if RT_CACHE_DEBUG &gt;= 2
id|printk
c_func
(paren
l_string|&quot;fn_rehash_zone: hash for zone %d grows from %d&bslash;n&quot;
comma
id|fz-&gt;fz_order
comma
id|old_divisor
)paren
suffix:semicolon
macro_line|#endif
id|ht
op_assign
id|fz_hash_alloc
c_func
(paren
id|new_divisor
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ht
)paren
(brace
id|memset
c_func
(paren
id|ht
comma
l_int|0
comma
id|new_divisor
op_star
r_sizeof
(paren
r_struct
id|hlist_head
)paren
)paren
suffix:semicolon
id|write_lock_bh
c_func
(paren
op_amp
id|fib_hash_lock
)paren
suffix:semicolon
id|old_ht
op_assign
id|fz-&gt;fz_hash
suffix:semicolon
id|fz-&gt;fz_hash
op_assign
id|ht
suffix:semicolon
id|fz-&gt;fz_hashmask
op_assign
id|new_hashmask
suffix:semicolon
id|fz-&gt;fz_divisor
op_assign
id|new_divisor
suffix:semicolon
id|fn_rebuild_zone
c_func
(paren
id|fz
comma
id|old_ht
comma
id|old_divisor
)paren
suffix:semicolon
id|write_unlock_bh
c_func
(paren
op_amp
id|fib_hash_lock
)paren
suffix:semicolon
id|fz_hash_free
c_func
(paren
id|old_ht
comma
id|old_divisor
)paren
suffix:semicolon
)brace
)brace
DECL|function|fn_free_node
r_static
r_inline
r_void
id|fn_free_node
c_func
(paren
r_struct
id|fib_node
op_star
id|f
)paren
(brace
id|kmem_cache_free
c_func
(paren
id|fn_hash_kmem
comma
id|f
)paren
suffix:semicolon
)brace
DECL|function|fn_free_alias
r_static
r_inline
r_void
id|fn_free_alias
c_func
(paren
r_struct
id|fib_alias
op_star
id|fa
)paren
(brace
id|fib_release_info
c_func
(paren
id|fa-&gt;fa_info
)paren
suffix:semicolon
id|kmem_cache_free
c_func
(paren
id|fn_alias_kmem
comma
id|fa
)paren
suffix:semicolon
)brace
r_static
r_struct
id|fn_zone
op_star
DECL|function|fn_new_zone
id|fn_new_zone
c_func
(paren
r_struct
id|fn_hash
op_star
id|table
comma
r_int
id|z
)paren
(brace
r_int
id|i
suffix:semicolon
r_struct
id|fn_zone
op_star
id|fz
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|fn_zone
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|fz
)paren
r_return
l_int|NULL
suffix:semicolon
id|memset
c_func
(paren
id|fz
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|fn_zone
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|z
)paren
(brace
id|fz-&gt;fz_divisor
op_assign
l_int|16
suffix:semicolon
)brace
r_else
(brace
id|fz-&gt;fz_divisor
op_assign
l_int|1
suffix:semicolon
)brace
id|fz-&gt;fz_hashmask
op_assign
(paren
id|fz-&gt;fz_divisor
op_minus
l_int|1
)paren
suffix:semicolon
id|fz-&gt;fz_hash
op_assign
id|fz_hash_alloc
c_func
(paren
id|fz-&gt;fz_divisor
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|fz-&gt;fz_hash
)paren
(brace
id|kfree
c_func
(paren
id|fz
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|memset
c_func
(paren
id|fz-&gt;fz_hash
comma
l_int|0
comma
id|fz-&gt;fz_divisor
op_star
r_sizeof
(paren
r_struct
id|hlist_head
op_star
)paren
)paren
suffix:semicolon
id|fz-&gt;fz_order
op_assign
id|z
suffix:semicolon
id|fz-&gt;fz_mask
op_assign
id|inet_make_mask
c_func
(paren
id|z
)paren
suffix:semicolon
multiline_comment|/* Find the first not empty zone with more specific mask */
r_for
c_loop
(paren
id|i
op_assign
id|z
op_plus
l_int|1
suffix:semicolon
id|i
op_le
l_int|32
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|table-&gt;fn_zones
(braket
id|i
)braket
)paren
r_break
suffix:semicolon
id|write_lock_bh
c_func
(paren
op_amp
id|fib_hash_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
OG
l_int|32
)paren
(brace
multiline_comment|/* No more specific masks, we are the first. */
id|fz-&gt;fz_next
op_assign
id|table-&gt;fn_zone_list
suffix:semicolon
id|table-&gt;fn_zone_list
op_assign
id|fz
suffix:semicolon
)brace
r_else
(brace
id|fz-&gt;fz_next
op_assign
id|table-&gt;fn_zones
(braket
id|i
)braket
op_member_access_from_pointer
id|fz_next
suffix:semicolon
id|table-&gt;fn_zones
(braket
id|i
)braket
op_member_access_from_pointer
id|fz_next
op_assign
id|fz
suffix:semicolon
)brace
id|table-&gt;fn_zones
(braket
id|z
)braket
op_assign
id|fz
suffix:semicolon
id|write_unlock_bh
c_func
(paren
op_amp
id|fib_hash_lock
)paren
suffix:semicolon
r_return
id|fz
suffix:semicolon
)brace
r_static
r_int
DECL|function|fn_hash_lookup
id|fn_hash_lookup
c_func
(paren
r_struct
id|fib_table
op_star
id|tb
comma
r_const
r_struct
id|flowi
op_star
id|flp
comma
r_struct
id|fib_result
op_star
id|res
)paren
(brace
r_int
id|err
suffix:semicolon
r_struct
id|fn_zone
op_star
id|fz
suffix:semicolon
r_struct
id|fn_hash
op_star
id|t
op_assign
(paren
r_struct
id|fn_hash
op_star
)paren
id|tb-&gt;tb_data
suffix:semicolon
id|read_lock
c_func
(paren
op_amp
id|fib_hash_lock
)paren
suffix:semicolon
r_for
c_loop
(paren
id|fz
op_assign
id|t-&gt;fn_zone_list
suffix:semicolon
id|fz
suffix:semicolon
id|fz
op_assign
id|fz-&gt;fz_next
)paren
(brace
r_struct
id|hlist_head
op_star
id|head
suffix:semicolon
r_struct
id|hlist_node
op_star
id|node
suffix:semicolon
r_struct
id|fib_node
op_star
id|f
suffix:semicolon
id|u32
id|k
op_assign
id|fz_key
c_func
(paren
id|flp-&gt;fl4_dst
comma
id|fz
)paren
suffix:semicolon
id|head
op_assign
op_amp
id|fz-&gt;fz_hash
(braket
id|fn_hash
c_func
(paren
id|k
comma
id|fz
)paren
)braket
suffix:semicolon
id|hlist_for_each_entry
c_func
(paren
id|f
comma
id|node
comma
id|head
comma
id|fn_hash
)paren
(brace
r_if
c_cond
(paren
id|f-&gt;fn_key
op_ne
id|k
)paren
r_continue
suffix:semicolon
id|err
op_assign
id|fib_semantic_match
c_func
(paren
op_amp
id|f-&gt;fn_alias
comma
id|flp
comma
id|res
comma
id|fz-&gt;fz_order
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
op_le
l_int|0
)paren
r_goto
id|out
suffix:semicolon
)brace
)brace
id|err
op_assign
l_int|1
suffix:semicolon
id|out
suffix:colon
id|read_unlock
c_func
(paren
op_amp
id|fib_hash_lock
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|variable|fn_hash_last_dflt
r_static
r_int
id|fn_hash_last_dflt
op_assign
op_minus
l_int|1
suffix:semicolon
r_static
r_void
DECL|function|fn_hash_select_default
id|fn_hash_select_default
c_func
(paren
r_struct
id|fib_table
op_star
id|tb
comma
r_const
r_struct
id|flowi
op_star
id|flp
comma
r_struct
id|fib_result
op_star
id|res
)paren
(brace
r_int
id|order
comma
id|last_idx
suffix:semicolon
r_struct
id|hlist_node
op_star
id|node
suffix:semicolon
r_struct
id|fib_node
op_star
id|f
suffix:semicolon
r_struct
id|fib_info
op_star
id|fi
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|fib_info
op_star
id|last_resort
suffix:semicolon
r_struct
id|fn_hash
op_star
id|t
op_assign
(paren
r_struct
id|fn_hash
op_star
)paren
id|tb-&gt;tb_data
suffix:semicolon
r_struct
id|fn_zone
op_star
id|fz
op_assign
id|t-&gt;fn_zones
(braket
l_int|0
)braket
suffix:semicolon
r_if
c_cond
(paren
id|fz
op_eq
l_int|NULL
)paren
r_return
suffix:semicolon
id|last_idx
op_assign
op_minus
l_int|1
suffix:semicolon
id|last_resort
op_assign
l_int|NULL
suffix:semicolon
id|order
op_assign
op_minus
l_int|1
suffix:semicolon
id|read_lock
c_func
(paren
op_amp
id|fib_hash_lock
)paren
suffix:semicolon
id|hlist_for_each_entry
c_func
(paren
id|f
comma
id|node
comma
op_amp
id|fz-&gt;fz_hash
(braket
l_int|0
)braket
comma
id|fn_hash
)paren
(brace
r_struct
id|fib_alias
op_star
id|fa
suffix:semicolon
id|list_for_each_entry
c_func
(paren
id|fa
comma
op_amp
id|f-&gt;fn_alias
comma
id|fa_list
)paren
(brace
r_struct
id|fib_info
op_star
id|next_fi
op_assign
id|fa-&gt;fa_info
suffix:semicolon
r_if
c_cond
(paren
id|fa-&gt;fa_scope
op_ne
id|res-&gt;scope
op_logical_or
id|fa-&gt;fa_type
op_ne
id|RTN_UNICAST
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|next_fi-&gt;fib_priority
OG
id|res-&gt;fi-&gt;fib_priority
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|next_fi-&gt;fib_nh
(braket
l_int|0
)braket
dot
id|nh_gw
op_logical_or
id|next_fi-&gt;fib_nh
(braket
l_int|0
)braket
dot
id|nh_scope
op_ne
id|RT_SCOPE_LINK
)paren
r_continue
suffix:semicolon
id|fa-&gt;fa_state
op_or_assign
id|FA_S_ACCESSED
suffix:semicolon
r_if
c_cond
(paren
id|fi
op_eq
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
id|next_fi
op_ne
id|res-&gt;fi
)paren
r_break
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|fib_detect_death
c_func
(paren
id|fi
comma
id|order
comma
op_amp
id|last_resort
comma
op_amp
id|last_idx
comma
op_amp
id|fn_hash_last_dflt
)paren
)paren
(brace
r_if
c_cond
(paren
id|res-&gt;fi
)paren
id|fib_info_put
c_func
(paren
id|res-&gt;fi
)paren
suffix:semicolon
id|res-&gt;fi
op_assign
id|fi
suffix:semicolon
id|atomic_inc
c_func
(paren
op_amp
id|fi-&gt;fib_clntref
)paren
suffix:semicolon
id|fn_hash_last_dflt
op_assign
id|order
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|fi
op_assign
id|next_fi
suffix:semicolon
id|order
op_increment
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|order
op_le
l_int|0
op_logical_or
id|fi
op_eq
l_int|NULL
)paren
(brace
id|fn_hash_last_dflt
op_assign
op_minus
l_int|1
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|fib_detect_death
c_func
(paren
id|fi
comma
id|order
comma
op_amp
id|last_resort
comma
op_amp
id|last_idx
comma
op_amp
id|fn_hash_last_dflt
)paren
)paren
(brace
r_if
c_cond
(paren
id|res-&gt;fi
)paren
id|fib_info_put
c_func
(paren
id|res-&gt;fi
)paren
suffix:semicolon
id|res-&gt;fi
op_assign
id|fi
suffix:semicolon
id|atomic_inc
c_func
(paren
op_amp
id|fi-&gt;fib_clntref
)paren
suffix:semicolon
id|fn_hash_last_dflt
op_assign
id|order
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_if
c_cond
(paren
id|last_idx
op_ge
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|res-&gt;fi
)paren
id|fib_info_put
c_func
(paren
id|res-&gt;fi
)paren
suffix:semicolon
id|res-&gt;fi
op_assign
id|last_resort
suffix:semicolon
r_if
c_cond
(paren
id|last_resort
)paren
id|atomic_inc
c_func
(paren
op_amp
id|last_resort-&gt;fib_clntref
)paren
suffix:semicolon
)brace
id|fn_hash_last_dflt
op_assign
id|last_idx
suffix:semicolon
id|out
suffix:colon
id|read_unlock
c_func
(paren
op_amp
id|fib_hash_lock
)paren
suffix:semicolon
)brace
multiline_comment|/* Insert node F to FZ. */
DECL|function|fib_insert_node
r_static
r_inline
r_void
id|fib_insert_node
c_func
(paren
r_struct
id|fn_zone
op_star
id|fz
comma
r_struct
id|fib_node
op_star
id|f
)paren
(brace
r_struct
id|hlist_head
op_star
id|head
op_assign
op_amp
id|fz-&gt;fz_hash
(braket
id|fn_hash
c_func
(paren
id|f-&gt;fn_key
comma
id|fz
)paren
)braket
suffix:semicolon
id|hlist_add_head
c_func
(paren
op_amp
id|f-&gt;fn_hash
comma
id|head
)paren
suffix:semicolon
)brace
multiline_comment|/* Return the node in FZ matching KEY. */
DECL|function|fib_find_node
r_static
r_struct
id|fib_node
op_star
id|fib_find_node
c_func
(paren
r_struct
id|fn_zone
op_star
id|fz
comma
id|u32
id|key
)paren
(brace
r_struct
id|hlist_head
op_star
id|head
op_assign
op_amp
id|fz-&gt;fz_hash
(braket
id|fn_hash
c_func
(paren
id|key
comma
id|fz
)paren
)braket
suffix:semicolon
r_struct
id|hlist_node
op_star
id|node
suffix:semicolon
r_struct
id|fib_node
op_star
id|f
suffix:semicolon
id|hlist_for_each_entry
c_func
(paren
id|f
comma
id|node
comma
id|head
comma
id|fn_hash
)paren
(brace
r_if
c_cond
(paren
id|f-&gt;fn_key
op_eq
id|key
)paren
r_return
id|f
suffix:semicolon
)brace
r_return
l_int|NULL
suffix:semicolon
)brace
r_static
r_int
DECL|function|fn_hash_insert
id|fn_hash_insert
c_func
(paren
r_struct
id|fib_table
op_star
id|tb
comma
r_struct
id|rtmsg
op_star
id|r
comma
r_struct
id|kern_rta
op_star
id|rta
comma
r_struct
id|nlmsghdr
op_star
id|n
comma
r_struct
id|netlink_skb_parms
op_star
id|req
)paren
(brace
r_struct
id|fn_hash
op_star
id|table
op_assign
(paren
r_struct
id|fn_hash
op_star
)paren
id|tb-&gt;tb_data
suffix:semicolon
r_struct
id|fib_node
op_star
id|new_f
comma
op_star
id|f
suffix:semicolon
r_struct
id|fib_alias
op_star
id|fa
comma
op_star
id|new_fa
suffix:semicolon
r_struct
id|fn_zone
op_star
id|fz
suffix:semicolon
r_struct
id|fib_info
op_star
id|fi
suffix:semicolon
r_int
id|z
op_assign
id|r-&gt;rtm_dst_len
suffix:semicolon
r_int
id|type
op_assign
id|r-&gt;rtm_type
suffix:semicolon
id|u8
id|tos
op_assign
id|r-&gt;rtm_tos
suffix:semicolon
id|u32
id|key
suffix:semicolon
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
id|z
OG
l_int|32
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|fz
op_assign
id|table-&gt;fn_zones
(braket
id|z
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|fz
op_logical_and
op_logical_neg
(paren
id|fz
op_assign
id|fn_new_zone
c_func
(paren
id|table
comma
id|z
)paren
)paren
)paren
r_return
op_minus
id|ENOBUFS
suffix:semicolon
id|key
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|rta-&gt;rta_dst
)paren
(brace
id|u32
id|dst
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|dst
comma
id|rta-&gt;rta_dst
comma
l_int|4
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dst
op_amp
op_complement
id|FZ_MASK
c_func
(paren
id|fz
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|key
op_assign
id|fz_key
c_func
(paren
id|dst
comma
id|fz
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|fi
op_assign
id|fib_create_info
c_func
(paren
id|r
comma
id|rta
comma
id|n
comma
op_amp
id|err
)paren
)paren
op_eq
l_int|NULL
)paren
r_return
id|err
suffix:semicolon
r_if
c_cond
(paren
id|fz-&gt;fz_nent
OG
(paren
id|fz-&gt;fz_divisor
op_lshift
l_int|1
)paren
op_logical_and
id|fz-&gt;fz_divisor
OL
id|FZ_MAX_DIVISOR
op_logical_and
(paren
id|z
op_eq
l_int|32
op_logical_or
(paren
l_int|1
op_lshift
id|z
)paren
OG
id|fz-&gt;fz_divisor
)paren
)paren
id|fn_rehash_zone
c_func
(paren
id|fz
)paren
suffix:semicolon
id|f
op_assign
id|fib_find_node
c_func
(paren
id|fz
comma
id|key
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|f
)paren
id|fa
op_assign
l_int|NULL
suffix:semicolon
r_else
id|fa
op_assign
id|fib_find_alias
c_func
(paren
op_amp
id|f-&gt;fn_alias
comma
id|tos
comma
id|fi-&gt;fib_priority
)paren
suffix:semicolon
multiline_comment|/* Now fa, if non-NULL, points to the first fib alias&n;&t; * with the same keys [prefix,tos,priority], if such key already&n;&t; * exists or to the node before which we will insert new one.&n;&t; *&n;&t; * If fa is NULL, we will need to allocate a new one and&n;&t; * insert to the head of f.&n;&t; *&n;&t; * If f is NULL, no fib node matched the destination key&n;&t; * and we need to allocate a new one of those as well.&n;&t; */
r_if
c_cond
(paren
id|fa
op_logical_and
id|fa-&gt;fa_tos
op_eq
id|tos
op_logical_and
id|fa-&gt;fa_info-&gt;fib_priority
op_eq
id|fi-&gt;fib_priority
)paren
(brace
r_struct
id|fib_alias
op_star
id|fa_orig
suffix:semicolon
id|err
op_assign
op_minus
id|EEXIST
suffix:semicolon
r_if
c_cond
(paren
id|n-&gt;nlmsg_flags
op_amp
id|NLM_F_EXCL
)paren
r_goto
id|out
suffix:semicolon
r_if
c_cond
(paren
id|n-&gt;nlmsg_flags
op_amp
id|NLM_F_REPLACE
)paren
(brace
r_struct
id|fib_info
op_star
id|fi_drop
suffix:semicolon
id|u8
id|state
suffix:semicolon
id|write_lock_bh
c_func
(paren
op_amp
id|fib_hash_lock
)paren
suffix:semicolon
id|fi_drop
op_assign
id|fa-&gt;fa_info
suffix:semicolon
id|fa-&gt;fa_info
op_assign
id|fi
suffix:semicolon
id|fa-&gt;fa_type
op_assign
id|type
suffix:semicolon
id|fa-&gt;fa_scope
op_assign
id|r-&gt;rtm_scope
suffix:semicolon
id|state
op_assign
id|fa-&gt;fa_state
suffix:semicolon
id|fa-&gt;fa_state
op_and_assign
op_complement
id|FA_S_ACCESSED
suffix:semicolon
id|write_unlock_bh
c_func
(paren
op_amp
id|fib_hash_lock
)paren
suffix:semicolon
id|fib_release_info
c_func
(paren
id|fi_drop
)paren
suffix:semicolon
r_if
c_cond
(paren
id|state
op_amp
id|FA_S_ACCESSED
)paren
id|rt_cache_flush
c_func
(paren
op_minus
l_int|1
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* Error if we find a perfect match which&n;&t;&t; * uses the same scope, type, and nexthop&n;&t;&t; * information.&n;&t;&t; */
id|fa_orig
op_assign
id|fa
suffix:semicolon
id|fa
op_assign
id|list_entry
c_func
(paren
id|fa-&gt;fa_list.prev
comma
r_struct
id|fib_alias
comma
id|fa_list
)paren
suffix:semicolon
id|list_for_each_entry_continue
c_func
(paren
id|fa
comma
op_amp
id|f-&gt;fn_alias
comma
id|fa_list
)paren
(brace
r_if
c_cond
(paren
id|fa-&gt;fa_tos
op_ne
id|tos
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|fa-&gt;fa_info-&gt;fib_priority
op_ne
id|fi-&gt;fib_priority
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|fa-&gt;fa_type
op_eq
id|type
op_logical_and
id|fa-&gt;fa_scope
op_eq
id|r-&gt;rtm_scope
op_logical_and
id|fa-&gt;fa_info
op_eq
id|fi
)paren
r_goto
id|out
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|n-&gt;nlmsg_flags
op_amp
id|NLM_F_APPEND
)paren
)paren
id|fa
op_assign
id|fa_orig
suffix:semicolon
)brace
id|err
op_assign
op_minus
id|ENOENT
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|n-&gt;nlmsg_flags
op_amp
id|NLM_F_CREATE
)paren
)paren
r_goto
id|out
suffix:semicolon
id|err
op_assign
op_minus
id|ENOBUFS
suffix:semicolon
id|new_fa
op_assign
id|kmem_cache_alloc
c_func
(paren
id|fn_alias_kmem
comma
id|SLAB_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|new_fa
op_eq
l_int|NULL
)paren
r_goto
id|out
suffix:semicolon
id|new_f
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|f
)paren
(brace
id|new_f
op_assign
id|kmem_cache_alloc
c_func
(paren
id|fn_hash_kmem
comma
id|SLAB_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|new_f
op_eq
l_int|NULL
)paren
r_goto
id|out_free_new_fa
suffix:semicolon
id|INIT_HLIST_NODE
c_func
(paren
op_amp
id|new_f-&gt;fn_hash
)paren
suffix:semicolon
id|INIT_LIST_HEAD
c_func
(paren
op_amp
id|new_f-&gt;fn_alias
)paren
suffix:semicolon
id|new_f-&gt;fn_key
op_assign
id|key
suffix:semicolon
id|f
op_assign
id|new_f
suffix:semicolon
)brace
id|new_fa-&gt;fa_info
op_assign
id|fi
suffix:semicolon
id|new_fa-&gt;fa_tos
op_assign
id|tos
suffix:semicolon
id|new_fa-&gt;fa_type
op_assign
id|type
suffix:semicolon
id|new_fa-&gt;fa_scope
op_assign
id|r-&gt;rtm_scope
suffix:semicolon
id|new_fa-&gt;fa_state
op_assign
l_int|0
suffix:semicolon
multiline_comment|/*&n;&t; * Insert new entry to the list.&n;&t; */
id|write_lock_bh
c_func
(paren
op_amp
id|fib_hash_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|new_f
)paren
id|fib_insert_node
c_func
(paren
id|fz
comma
id|new_f
)paren
suffix:semicolon
id|list_add_tail
c_func
(paren
op_amp
id|new_fa-&gt;fa_list
comma
(paren
id|fa
ques
c_cond
op_amp
id|fa-&gt;fa_list
suffix:colon
op_amp
id|f-&gt;fn_alias
)paren
)paren
suffix:semicolon
id|write_unlock_bh
c_func
(paren
op_amp
id|fib_hash_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|new_f
)paren
id|fz-&gt;fz_nent
op_increment
suffix:semicolon
id|rt_cache_flush
c_func
(paren
op_minus
l_int|1
)paren
suffix:semicolon
id|rtmsg_fib
c_func
(paren
id|RTM_NEWROUTE
comma
id|key
comma
id|new_fa
comma
id|z
comma
id|tb-&gt;tb_id
comma
id|n
comma
id|req
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|out_free_new_fa
suffix:colon
id|kmem_cache_free
c_func
(paren
id|fn_alias_kmem
comma
id|new_fa
)paren
suffix:semicolon
id|out
suffix:colon
id|fib_release_info
c_func
(paren
id|fi
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
r_static
r_int
DECL|function|fn_hash_delete
id|fn_hash_delete
c_func
(paren
r_struct
id|fib_table
op_star
id|tb
comma
r_struct
id|rtmsg
op_star
id|r
comma
r_struct
id|kern_rta
op_star
id|rta
comma
r_struct
id|nlmsghdr
op_star
id|n
comma
r_struct
id|netlink_skb_parms
op_star
id|req
)paren
(brace
r_struct
id|fn_hash
op_star
id|table
op_assign
(paren
r_struct
id|fn_hash
op_star
)paren
id|tb-&gt;tb_data
suffix:semicolon
r_struct
id|fib_node
op_star
id|f
suffix:semicolon
r_struct
id|fib_alias
op_star
id|fa
comma
op_star
id|fa_to_delete
suffix:semicolon
r_int
id|z
op_assign
id|r-&gt;rtm_dst_len
suffix:semicolon
r_struct
id|fn_zone
op_star
id|fz
suffix:semicolon
id|u32
id|key
suffix:semicolon
id|u8
id|tos
op_assign
id|r-&gt;rtm_tos
suffix:semicolon
r_if
c_cond
(paren
id|z
OG
l_int|32
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
(paren
id|fz
op_assign
id|table-&gt;fn_zones
(braket
id|z
)braket
)paren
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ESRCH
suffix:semicolon
id|key
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|rta-&gt;rta_dst
)paren
(brace
id|u32
id|dst
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|dst
comma
id|rta-&gt;rta_dst
comma
l_int|4
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dst
op_amp
op_complement
id|FZ_MASK
c_func
(paren
id|fz
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|key
op_assign
id|fz_key
c_func
(paren
id|dst
comma
id|fz
)paren
suffix:semicolon
)brace
id|f
op_assign
id|fib_find_node
c_func
(paren
id|fz
comma
id|key
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|f
)paren
id|fa
op_assign
l_int|NULL
suffix:semicolon
r_else
id|fa
op_assign
id|fib_find_alias
c_func
(paren
op_amp
id|f-&gt;fn_alias
comma
id|tos
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|fa
)paren
r_return
op_minus
id|ESRCH
suffix:semicolon
id|fa_to_delete
op_assign
l_int|NULL
suffix:semicolon
id|fa
op_assign
id|list_entry
c_func
(paren
id|fa-&gt;fa_list.prev
comma
r_struct
id|fib_alias
comma
id|fa_list
)paren
suffix:semicolon
id|list_for_each_entry_continue
c_func
(paren
id|fa
comma
op_amp
id|f-&gt;fn_alias
comma
id|fa_list
)paren
(brace
r_struct
id|fib_info
op_star
id|fi
op_assign
id|fa-&gt;fa_info
suffix:semicolon
r_if
c_cond
(paren
id|fa-&gt;fa_tos
op_ne
id|tos
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
(paren
op_logical_neg
id|r-&gt;rtm_type
op_logical_or
id|fa-&gt;fa_type
op_eq
id|r-&gt;rtm_type
)paren
op_logical_and
(paren
id|r-&gt;rtm_scope
op_eq
id|RT_SCOPE_NOWHERE
op_logical_or
id|fa-&gt;fa_scope
op_eq
id|r-&gt;rtm_scope
)paren
op_logical_and
(paren
op_logical_neg
id|r-&gt;rtm_protocol
op_logical_or
id|fi-&gt;fib_protocol
op_eq
id|r-&gt;rtm_protocol
)paren
op_logical_and
id|fib_nh_match
c_func
(paren
id|r
comma
id|n
comma
id|rta
comma
id|fi
)paren
op_eq
l_int|0
)paren
(brace
id|fa_to_delete
op_assign
id|fa
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|fa_to_delete
)paren
(brace
r_int
id|kill_fn
suffix:semicolon
id|fa
op_assign
id|fa_to_delete
suffix:semicolon
id|rtmsg_fib
c_func
(paren
id|RTM_DELROUTE
comma
id|key
comma
id|fa
comma
id|z
comma
id|tb-&gt;tb_id
comma
id|n
comma
id|req
)paren
suffix:semicolon
id|kill_fn
op_assign
l_int|0
suffix:semicolon
id|write_lock_bh
c_func
(paren
op_amp
id|fib_hash_lock
)paren
suffix:semicolon
id|list_del
c_func
(paren
op_amp
id|fa-&gt;fa_list
)paren
suffix:semicolon
r_if
c_cond
(paren
id|list_empty
c_func
(paren
op_amp
id|f-&gt;fn_alias
)paren
)paren
(brace
id|hlist_del
c_func
(paren
op_amp
id|f-&gt;fn_hash
)paren
suffix:semicolon
id|kill_fn
op_assign
l_int|1
suffix:semicolon
)brace
id|write_unlock_bh
c_func
(paren
op_amp
id|fib_hash_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fa-&gt;fa_state
op_amp
id|FA_S_ACCESSED
)paren
id|rt_cache_flush
c_func
(paren
op_minus
l_int|1
)paren
suffix:semicolon
id|fn_free_alias
c_func
(paren
id|fa
)paren
suffix:semicolon
r_if
c_cond
(paren
id|kill_fn
)paren
(brace
id|fn_free_node
c_func
(paren
id|f
)paren
suffix:semicolon
id|fz-&gt;fz_nent
op_decrement
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_return
op_minus
id|ESRCH
suffix:semicolon
)brace
DECL|function|fn_flush_list
r_static
r_int
id|fn_flush_list
c_func
(paren
r_struct
id|fn_zone
op_star
id|fz
comma
r_int
id|idx
)paren
(brace
r_struct
id|hlist_head
op_star
id|head
op_assign
op_amp
id|fz-&gt;fz_hash
(braket
id|idx
)braket
suffix:semicolon
r_struct
id|hlist_node
op_star
id|node
comma
op_star
id|n
suffix:semicolon
r_struct
id|fib_node
op_star
id|f
suffix:semicolon
r_int
id|found
op_assign
l_int|0
suffix:semicolon
id|hlist_for_each_entry_safe
c_func
(paren
id|f
comma
id|node
comma
id|n
comma
id|head
comma
id|fn_hash
)paren
(brace
r_struct
id|fib_alias
op_star
id|fa
comma
op_star
id|fa_node
suffix:semicolon
r_int
id|kill_f
suffix:semicolon
id|kill_f
op_assign
l_int|0
suffix:semicolon
id|list_for_each_entry_safe
c_func
(paren
id|fa
comma
id|fa_node
comma
op_amp
id|f-&gt;fn_alias
comma
id|fa_list
)paren
(brace
r_struct
id|fib_info
op_star
id|fi
op_assign
id|fa-&gt;fa_info
suffix:semicolon
r_if
c_cond
(paren
id|fi
op_logical_and
(paren
id|fi-&gt;fib_flags
op_amp
id|RTNH_F_DEAD
)paren
)paren
(brace
id|write_lock_bh
c_func
(paren
op_amp
id|fib_hash_lock
)paren
suffix:semicolon
id|list_del
c_func
(paren
op_amp
id|fa-&gt;fa_list
)paren
suffix:semicolon
r_if
c_cond
(paren
id|list_empty
c_func
(paren
op_amp
id|f-&gt;fn_alias
)paren
)paren
(brace
id|hlist_del
c_func
(paren
op_amp
id|f-&gt;fn_hash
)paren
suffix:semicolon
id|kill_f
op_assign
l_int|1
suffix:semicolon
)brace
id|write_unlock_bh
c_func
(paren
op_amp
id|fib_hash_lock
)paren
suffix:semicolon
id|fn_free_alias
c_func
(paren
id|fa
)paren
suffix:semicolon
id|found
op_increment
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|kill_f
)paren
(brace
id|fn_free_node
c_func
(paren
id|f
)paren
suffix:semicolon
id|fz-&gt;fz_nent
op_decrement
suffix:semicolon
)brace
)brace
r_return
id|found
suffix:semicolon
)brace
DECL|function|fn_hash_flush
r_static
r_int
id|fn_hash_flush
c_func
(paren
r_struct
id|fib_table
op_star
id|tb
)paren
(brace
r_struct
id|fn_hash
op_star
id|table
op_assign
(paren
r_struct
id|fn_hash
op_star
)paren
id|tb-&gt;tb_data
suffix:semicolon
r_struct
id|fn_zone
op_star
id|fz
suffix:semicolon
r_int
id|found
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|fz
op_assign
id|table-&gt;fn_zone_list
suffix:semicolon
id|fz
suffix:semicolon
id|fz
op_assign
id|fz-&gt;fz_next
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|fz-&gt;fz_divisor
op_minus
l_int|1
suffix:semicolon
id|i
op_ge
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
id|found
op_add_assign
id|fn_flush_list
c_func
(paren
id|fz
comma
id|i
)paren
suffix:semicolon
)brace
r_return
id|found
suffix:semicolon
)brace
r_static
r_inline
r_int
DECL|function|fn_hash_dump_bucket
id|fn_hash_dump_bucket
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|netlink_callback
op_star
id|cb
comma
r_struct
id|fib_table
op_star
id|tb
comma
r_struct
id|fn_zone
op_star
id|fz
comma
r_struct
id|hlist_head
op_star
id|head
)paren
(brace
r_struct
id|hlist_node
op_star
id|node
suffix:semicolon
r_struct
id|fib_node
op_star
id|f
suffix:semicolon
r_int
id|i
comma
id|s_i
suffix:semicolon
id|s_i
op_assign
id|cb-&gt;args
(braket
l_int|3
)braket
suffix:semicolon
id|i
op_assign
l_int|0
suffix:semicolon
id|hlist_for_each_entry
c_func
(paren
id|f
comma
id|node
comma
id|head
comma
id|fn_hash
)paren
(brace
r_struct
id|fib_alias
op_star
id|fa
suffix:semicolon
id|list_for_each_entry
c_func
(paren
id|fa
comma
op_amp
id|f-&gt;fn_alias
comma
id|fa_list
)paren
(brace
r_if
c_cond
(paren
id|i
OL
id|s_i
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|fib_dump_info
c_func
(paren
id|skb
comma
id|NETLINK_CB
c_func
(paren
id|cb-&gt;skb
)paren
dot
id|pid
comma
id|cb-&gt;nlh-&gt;nlmsg_seq
comma
id|RTM_NEWROUTE
comma
id|tb-&gt;tb_id
comma
id|fa-&gt;fa_type
comma
id|fa-&gt;fa_scope
comma
op_amp
id|f-&gt;fn_key
comma
id|fz-&gt;fz_order
comma
id|fa-&gt;fa_tos
comma
id|fa-&gt;fa_info
)paren
OL
l_int|0
)paren
(brace
id|cb-&gt;args
(braket
l_int|3
)braket
op_assign
id|i
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|i
op_increment
suffix:semicolon
)brace
)brace
id|cb-&gt;args
(braket
l_int|3
)braket
op_assign
id|i
suffix:semicolon
r_return
id|skb-&gt;len
suffix:semicolon
)brace
r_static
r_inline
r_int
DECL|function|fn_hash_dump_zone
id|fn_hash_dump_zone
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|netlink_callback
op_star
id|cb
comma
r_struct
id|fib_table
op_star
id|tb
comma
r_struct
id|fn_zone
op_star
id|fz
)paren
(brace
r_int
id|h
comma
id|s_h
suffix:semicolon
id|s_h
op_assign
id|cb-&gt;args
(braket
l_int|2
)braket
suffix:semicolon
r_for
c_loop
(paren
id|h
op_assign
l_int|0
suffix:semicolon
id|h
OL
id|fz-&gt;fz_divisor
suffix:semicolon
id|h
op_increment
)paren
(brace
r_if
c_cond
(paren
id|h
OL
id|s_h
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|h
OG
id|s_h
)paren
id|memset
c_func
(paren
op_amp
id|cb-&gt;args
(braket
l_int|3
)braket
comma
l_int|0
comma
r_sizeof
(paren
id|cb-&gt;args
)paren
op_minus
l_int|3
op_star
r_sizeof
(paren
id|cb-&gt;args
(braket
l_int|0
)braket
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fz-&gt;fz_hash
op_eq
l_int|NULL
op_logical_or
id|hlist_empty
c_func
(paren
op_amp
id|fz-&gt;fz_hash
(braket
id|h
)braket
)paren
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|fn_hash_dump_bucket
c_func
(paren
id|skb
comma
id|cb
comma
id|tb
comma
id|fz
comma
op_amp
id|fz-&gt;fz_hash
(braket
id|h
)braket
)paren
OL
l_int|0
)paren
(brace
id|cb-&gt;args
(braket
l_int|2
)braket
op_assign
id|h
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
)brace
id|cb-&gt;args
(braket
l_int|2
)braket
op_assign
id|h
suffix:semicolon
r_return
id|skb-&gt;len
suffix:semicolon
)brace
DECL|function|fn_hash_dump
r_static
r_int
id|fn_hash_dump
c_func
(paren
r_struct
id|fib_table
op_star
id|tb
comma
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|netlink_callback
op_star
id|cb
)paren
(brace
r_int
id|m
comma
id|s_m
suffix:semicolon
r_struct
id|fn_zone
op_star
id|fz
suffix:semicolon
r_struct
id|fn_hash
op_star
id|table
op_assign
(paren
r_struct
id|fn_hash
op_star
)paren
id|tb-&gt;tb_data
suffix:semicolon
id|s_m
op_assign
id|cb-&gt;args
(braket
l_int|1
)braket
suffix:semicolon
id|read_lock
c_func
(paren
op_amp
id|fib_hash_lock
)paren
suffix:semicolon
r_for
c_loop
(paren
id|fz
op_assign
id|table-&gt;fn_zone_list
comma
id|m
op_assign
l_int|0
suffix:semicolon
id|fz
suffix:semicolon
id|fz
op_assign
id|fz-&gt;fz_next
comma
id|m
op_increment
)paren
(brace
r_if
c_cond
(paren
id|m
OL
id|s_m
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|m
OG
id|s_m
)paren
id|memset
c_func
(paren
op_amp
id|cb-&gt;args
(braket
l_int|2
)braket
comma
l_int|0
comma
r_sizeof
(paren
id|cb-&gt;args
)paren
op_minus
l_int|2
op_star
r_sizeof
(paren
id|cb-&gt;args
(braket
l_int|0
)braket
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fn_hash_dump_zone
c_func
(paren
id|skb
comma
id|cb
comma
id|tb
comma
id|fz
)paren
OL
l_int|0
)paren
(brace
id|cb-&gt;args
(braket
l_int|1
)braket
op_assign
id|m
suffix:semicolon
id|read_unlock
c_func
(paren
op_amp
id|fib_hash_lock
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
)brace
id|read_unlock
c_func
(paren
op_amp
id|fib_hash_lock
)paren
suffix:semicolon
id|cb-&gt;args
(braket
l_int|1
)braket
op_assign
id|m
suffix:semicolon
r_return
id|skb-&gt;len
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_IP_MULTIPLE_TABLES
DECL|function|fib_hash_init
r_struct
id|fib_table
op_star
id|fib_hash_init
c_func
(paren
r_int
id|id
)paren
macro_line|#else
r_struct
id|fib_table
op_star
id|__init
id|fib_hash_init
c_func
(paren
r_int
id|id
)paren
macro_line|#endif
(brace
r_struct
id|fib_table
op_star
id|tb
suffix:semicolon
r_if
c_cond
(paren
id|fn_hash_kmem
op_eq
l_int|NULL
)paren
id|fn_hash_kmem
op_assign
id|kmem_cache_create
c_func
(paren
l_string|&quot;ip_fib_hash&quot;
comma
r_sizeof
(paren
r_struct
id|fib_node
)paren
comma
l_int|0
comma
id|SLAB_HWCACHE_ALIGN
comma
l_int|NULL
comma
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fn_alias_kmem
op_eq
l_int|NULL
)paren
id|fn_alias_kmem
op_assign
id|kmem_cache_create
c_func
(paren
l_string|&quot;ip_fib_alias&quot;
comma
r_sizeof
(paren
r_struct
id|fib_alias
)paren
comma
l_int|0
comma
id|SLAB_HWCACHE_ALIGN
comma
l_int|NULL
comma
l_int|NULL
)paren
suffix:semicolon
id|tb
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|fib_table
)paren
op_plus
r_sizeof
(paren
r_struct
id|fn_hash
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tb
op_eq
l_int|NULL
)paren
r_return
l_int|NULL
suffix:semicolon
id|tb-&gt;tb_id
op_assign
id|id
suffix:semicolon
id|tb-&gt;tb_lookup
op_assign
id|fn_hash_lookup
suffix:semicolon
id|tb-&gt;tb_insert
op_assign
id|fn_hash_insert
suffix:semicolon
id|tb-&gt;tb_delete
op_assign
id|fn_hash_delete
suffix:semicolon
id|tb-&gt;tb_flush
op_assign
id|fn_hash_flush
suffix:semicolon
id|tb-&gt;tb_select_default
op_assign
id|fn_hash_select_default
suffix:semicolon
id|tb-&gt;tb_dump
op_assign
id|fn_hash_dump
suffix:semicolon
id|memset
c_func
(paren
id|tb-&gt;tb_data
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|fn_hash
)paren
)paren
suffix:semicolon
r_return
id|tb
suffix:semicolon
)brace
multiline_comment|/* ------------------------------------------------------------------------ */
macro_line|#ifdef CONFIG_PROC_FS
DECL|struct|fib_iter_state
r_struct
id|fib_iter_state
(brace
DECL|member|zone
r_struct
id|fn_zone
op_star
id|zone
suffix:semicolon
DECL|member|bucket
r_int
id|bucket
suffix:semicolon
DECL|member|hash_head
r_struct
id|hlist_head
op_star
id|hash_head
suffix:semicolon
DECL|member|fn
r_struct
id|fib_node
op_star
id|fn
suffix:semicolon
DECL|member|fa
r_struct
id|fib_alias
op_star
id|fa
suffix:semicolon
)brace
suffix:semicolon
DECL|function|fib_get_first
r_static
r_struct
id|fib_alias
op_star
id|fib_get_first
c_func
(paren
r_struct
id|seq_file
op_star
id|seq
)paren
(brace
r_struct
id|fib_iter_state
op_star
id|iter
op_assign
id|seq
op_member_access_from_pointer
r_private
suffix:semicolon
r_struct
id|fn_hash
op_star
id|table
op_assign
(paren
r_struct
id|fn_hash
op_star
)paren
id|ip_fib_main_table-&gt;tb_data
suffix:semicolon
id|iter-&gt;bucket
op_assign
l_int|0
suffix:semicolon
id|iter-&gt;hash_head
op_assign
l_int|NULL
suffix:semicolon
id|iter-&gt;fn
op_assign
l_int|NULL
suffix:semicolon
id|iter-&gt;fa
op_assign
l_int|NULL
suffix:semicolon
r_for
c_loop
(paren
id|iter-&gt;zone
op_assign
id|table-&gt;fn_zone_list
suffix:semicolon
id|iter-&gt;zone
suffix:semicolon
id|iter-&gt;zone
op_assign
id|iter-&gt;zone-&gt;fz_next
)paren
(brace
r_int
id|maxslot
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|iter-&gt;zone-&gt;fz_nent
)paren
r_continue
suffix:semicolon
id|iter-&gt;hash_head
op_assign
id|iter-&gt;zone-&gt;fz_hash
suffix:semicolon
id|maxslot
op_assign
id|iter-&gt;zone-&gt;fz_divisor
suffix:semicolon
r_for
c_loop
(paren
id|iter-&gt;bucket
op_assign
l_int|0
suffix:semicolon
id|iter-&gt;bucket
OL
id|maxslot
suffix:semicolon
op_increment
id|iter-&gt;bucket
comma
op_increment
id|iter-&gt;hash_head
)paren
(brace
r_struct
id|hlist_node
op_star
id|node
suffix:semicolon
r_struct
id|fib_node
op_star
id|fn
suffix:semicolon
id|hlist_for_each_entry
c_func
(paren
id|fn
comma
id|node
comma
id|iter-&gt;hash_head
comma
id|fn_hash
)paren
(brace
r_struct
id|fib_alias
op_star
id|fa
suffix:semicolon
id|list_for_each_entry
c_func
(paren
id|fa
comma
op_amp
id|fn-&gt;fn_alias
comma
id|fa_list
)paren
(brace
id|iter-&gt;fn
op_assign
id|fn
suffix:semicolon
id|iter-&gt;fa
op_assign
id|fa
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
)brace
)brace
)brace
id|out
suffix:colon
r_return
id|iter-&gt;fa
suffix:semicolon
)brace
DECL|function|fib_get_next
r_static
r_struct
id|fib_alias
op_star
id|fib_get_next
c_func
(paren
r_struct
id|seq_file
op_star
id|seq
)paren
(brace
r_struct
id|fib_iter_state
op_star
id|iter
op_assign
id|seq
op_member_access_from_pointer
r_private
suffix:semicolon
r_struct
id|fib_node
op_star
id|fn
suffix:semicolon
r_struct
id|fib_alias
op_star
id|fa
suffix:semicolon
multiline_comment|/* Advance FA, if any. */
id|fn
op_assign
id|iter-&gt;fn
suffix:semicolon
id|fa
op_assign
id|iter-&gt;fa
suffix:semicolon
r_if
c_cond
(paren
id|fa
)paren
(brace
id|BUG_ON
c_func
(paren
op_logical_neg
id|fn
)paren
suffix:semicolon
id|list_for_each_entry_continue
c_func
(paren
id|fa
comma
op_amp
id|fn-&gt;fn_alias
comma
id|fa_list
)paren
(brace
id|iter-&gt;fa
op_assign
id|fa
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
)brace
id|fa
op_assign
id|iter-&gt;fa
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/* Advance FN. */
r_if
c_cond
(paren
id|fn
)paren
(brace
r_struct
id|hlist_node
op_star
id|node
op_assign
op_amp
id|fn-&gt;fn_hash
suffix:semicolon
id|hlist_for_each_entry_continue
c_func
(paren
id|fn
comma
id|node
comma
id|fn_hash
)paren
(brace
id|iter-&gt;fn
op_assign
id|fn
suffix:semicolon
id|list_for_each_entry
c_func
(paren
id|fa
comma
op_amp
id|fn-&gt;fn_alias
comma
id|fa_list
)paren
(brace
id|iter-&gt;fa
op_assign
id|fa
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
)brace
)brace
id|fn
op_assign
id|iter-&gt;fn
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/* Advance hash chain. */
r_if
c_cond
(paren
op_logical_neg
id|iter-&gt;zone
)paren
r_goto
id|out
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
(brace
r_struct
id|hlist_node
op_star
id|node
suffix:semicolon
r_int
id|maxslot
suffix:semicolon
id|maxslot
op_assign
id|iter-&gt;zone-&gt;fz_divisor
suffix:semicolon
r_while
c_loop
(paren
op_increment
id|iter-&gt;bucket
OL
id|maxslot
)paren
(brace
id|iter-&gt;hash_head
op_increment
suffix:semicolon
id|hlist_for_each_entry
c_func
(paren
id|fn
comma
id|node
comma
id|iter-&gt;hash_head
comma
id|fn_hash
)paren
(brace
id|list_for_each_entry
c_func
(paren
id|fa
comma
op_amp
id|fn-&gt;fn_alias
comma
id|fa_list
)paren
(brace
id|iter-&gt;fn
op_assign
id|fn
suffix:semicolon
id|iter-&gt;fa
op_assign
id|fa
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
)brace
)brace
id|iter-&gt;zone
op_assign
id|iter-&gt;zone-&gt;fz_next
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|iter-&gt;zone
)paren
r_goto
id|out
suffix:semicolon
id|iter-&gt;bucket
op_assign
l_int|0
suffix:semicolon
id|iter-&gt;hash_head
op_assign
id|iter-&gt;zone-&gt;fz_hash
suffix:semicolon
id|hlist_for_each_entry
c_func
(paren
id|fn
comma
id|node
comma
id|iter-&gt;hash_head
comma
id|fn_hash
)paren
(brace
id|list_for_each_entry
c_func
(paren
id|fa
comma
op_amp
id|fn-&gt;fn_alias
comma
id|fa_list
)paren
(brace
id|iter-&gt;fn
op_assign
id|fn
suffix:semicolon
id|iter-&gt;fa
op_assign
id|fa
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
)brace
)brace
id|out
suffix:colon
r_return
id|fa
suffix:semicolon
)brace
DECL|function|fib_seq_start
r_static
r_void
op_star
id|fib_seq_start
c_func
(paren
r_struct
id|seq_file
op_star
id|seq
comma
id|loff_t
op_star
id|pos
)paren
(brace
r_void
op_star
id|v
op_assign
l_int|NULL
suffix:semicolon
id|read_lock
c_func
(paren
op_amp
id|fib_hash_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ip_fib_main_table
)paren
id|v
op_assign
op_star
id|pos
ques
c_cond
id|fib_get_next
c_func
(paren
id|seq
)paren
suffix:colon
id|SEQ_START_TOKEN
suffix:semicolon
r_return
id|v
suffix:semicolon
)brace
DECL|function|fib_seq_next
r_static
r_void
op_star
id|fib_seq_next
c_func
(paren
r_struct
id|seq_file
op_star
id|seq
comma
r_void
op_star
id|v
comma
id|loff_t
op_star
id|pos
)paren
(brace
op_increment
op_star
id|pos
suffix:semicolon
r_return
id|v
op_eq
id|SEQ_START_TOKEN
ques
c_cond
id|fib_get_first
c_func
(paren
id|seq
)paren
suffix:colon
id|fib_get_next
c_func
(paren
id|seq
)paren
suffix:semicolon
)brace
DECL|function|fib_seq_stop
r_static
r_void
id|fib_seq_stop
c_func
(paren
r_struct
id|seq_file
op_star
id|seq
comma
r_void
op_star
id|v
)paren
(brace
id|read_unlock
c_func
(paren
op_amp
id|fib_hash_lock
)paren
suffix:semicolon
)brace
DECL|function|fib_flag_trans
r_static
r_int
id|fib_flag_trans
c_func
(paren
r_int
id|type
comma
id|u32
id|mask
comma
r_struct
id|fib_info
op_star
id|fi
)paren
(brace
r_static
r_int
id|type2flags
(braket
id|RTN_MAX
op_plus
l_int|1
)braket
op_assign
(brace
(braket
l_int|7
)braket
op_assign
id|RTF_REJECT
comma
(braket
l_int|8
)braket
op_assign
id|RTF_REJECT
comma
)brace
suffix:semicolon
r_int
id|flags
op_assign
id|type2flags
(braket
id|type
)braket
suffix:semicolon
r_if
c_cond
(paren
id|fi
op_logical_and
id|fi-&gt;fib_nh-&gt;nh_gw
)paren
id|flags
op_or_assign
id|RTF_GATEWAY
suffix:semicolon
r_if
c_cond
(paren
id|mask
op_eq
l_int|0xFFFFFFFF
)paren
id|flags
op_or_assign
id|RTF_HOST
suffix:semicolon
id|flags
op_or_assign
id|RTF_UP
suffix:semicolon
r_return
id|flags
suffix:semicolon
)brace
multiline_comment|/* &n; *&t;This outputs /proc/net/route.&n; *&n; *&t;It always works in backward compatibility mode.&n; *&t;The format of the file is not supposed to be changed.&n; */
DECL|function|fib_seq_show
r_static
r_int
id|fib_seq_show
c_func
(paren
r_struct
id|seq_file
op_star
id|seq
comma
r_void
op_star
id|v
)paren
(brace
r_struct
id|fib_iter_state
op_star
id|iter
suffix:semicolon
r_char
id|bf
(braket
l_int|128
)braket
suffix:semicolon
id|u32
id|prefix
comma
id|mask
suffix:semicolon
r_int
id|flags
suffix:semicolon
r_struct
id|fib_node
op_star
id|f
suffix:semicolon
r_struct
id|fib_alias
op_star
id|fa
suffix:semicolon
r_struct
id|fib_info
op_star
id|fi
suffix:semicolon
r_if
c_cond
(paren
id|v
op_eq
id|SEQ_START_TOKEN
)paren
(brace
id|seq_printf
c_func
(paren
id|seq
comma
l_string|&quot;%-127s&bslash;n&quot;
comma
l_string|&quot;Iface&bslash;tDestination&bslash;tGateway &quot;
l_string|&quot;&bslash;tFlags&bslash;tRefCnt&bslash;tUse&bslash;tMetric&bslash;tMask&bslash;t&bslash;tMTU&quot;
l_string|&quot;&bslash;tWindow&bslash;tIRTT&quot;
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|iter
op_assign
id|seq
op_member_access_from_pointer
r_private
suffix:semicolon
id|f
op_assign
id|iter-&gt;fn
suffix:semicolon
id|fa
op_assign
id|iter-&gt;fa
suffix:semicolon
id|fi
op_assign
id|fa-&gt;fa_info
suffix:semicolon
id|prefix
op_assign
id|f-&gt;fn_key
suffix:semicolon
id|mask
op_assign
id|FZ_MASK
c_func
(paren
id|iter-&gt;zone
)paren
suffix:semicolon
id|flags
op_assign
id|fib_flag_trans
c_func
(paren
id|fa-&gt;fa_type
comma
id|mask
comma
id|fi
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fi
)paren
id|snprintf
c_func
(paren
id|bf
comma
r_sizeof
(paren
id|bf
)paren
comma
l_string|&quot;%s&bslash;t%08X&bslash;t%08X&bslash;t%04X&bslash;t%d&bslash;t%u&bslash;t%d&bslash;t%08X&bslash;t%d&bslash;t%u&bslash;t%u&quot;
comma
id|fi-&gt;fib_dev
ques
c_cond
id|fi-&gt;fib_dev-&gt;name
suffix:colon
l_string|&quot;*&quot;
comma
id|prefix
comma
id|fi-&gt;fib_nh-&gt;nh_gw
comma
id|flags
comma
l_int|0
comma
l_int|0
comma
id|fi-&gt;fib_priority
comma
id|mask
comma
(paren
id|fi-&gt;fib_advmss
ques
c_cond
id|fi-&gt;fib_advmss
op_plus
l_int|40
suffix:colon
l_int|0
)paren
comma
id|fi-&gt;fib_window
comma
id|fi-&gt;fib_rtt
op_rshift
l_int|3
)paren
suffix:semicolon
r_else
id|snprintf
c_func
(paren
id|bf
comma
r_sizeof
(paren
id|bf
)paren
comma
l_string|&quot;*&bslash;t%08X&bslash;t%08X&bslash;t%04X&bslash;t%d&bslash;t%u&bslash;t%d&bslash;t%08X&bslash;t%d&bslash;t%u&bslash;t%u&quot;
comma
id|prefix
comma
l_int|0
comma
id|flags
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
id|mask
comma
l_int|0
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|seq_printf
c_func
(paren
id|seq
comma
l_string|&quot;%-127s&bslash;n&quot;
comma
id|bf
)paren
suffix:semicolon
id|out
suffix:colon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|fib_seq_ops
r_static
r_struct
id|seq_operations
id|fib_seq_ops
op_assign
(brace
dot
id|start
op_assign
id|fib_seq_start
comma
dot
id|next
op_assign
id|fib_seq_next
comma
dot
id|stop
op_assign
id|fib_seq_stop
comma
dot
id|show
op_assign
id|fib_seq_show
comma
)brace
suffix:semicolon
DECL|function|fib_seq_open
r_static
r_int
id|fib_seq_open
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
(brace
r_struct
id|seq_file
op_star
id|seq
suffix:semicolon
r_int
id|rc
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_struct
id|fib_iter_state
op_star
id|s
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|s
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|s
)paren
r_goto
id|out
suffix:semicolon
id|rc
op_assign
id|seq_open
c_func
(paren
id|file
comma
op_amp
id|fib_seq_ops
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_goto
id|out_kfree
suffix:semicolon
id|seq
op_assign
id|file-&gt;private_data
suffix:semicolon
id|seq
op_member_access_from_pointer
r_private
op_assign
id|s
suffix:semicolon
id|memset
c_func
(paren
id|s
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|s
)paren
)paren
suffix:semicolon
id|out
suffix:colon
r_return
id|rc
suffix:semicolon
id|out_kfree
suffix:colon
id|kfree
c_func
(paren
id|s
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
DECL|variable|fib_seq_fops
r_static
r_struct
id|file_operations
id|fib_seq_fops
op_assign
(brace
dot
id|owner
op_assign
id|THIS_MODULE
comma
dot
id|open
op_assign
id|fib_seq_open
comma
dot
id|read
op_assign
id|seq_read
comma
dot
id|llseek
op_assign
id|seq_lseek
comma
dot
id|release
op_assign
id|seq_release_private
comma
)brace
suffix:semicolon
DECL|function|fib_proc_init
r_int
id|__init
id|fib_proc_init
c_func
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|proc_net_fops_create
c_func
(paren
l_string|&quot;route&quot;
comma
id|S_IRUGO
comma
op_amp
id|fib_seq_fops
)paren
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|fib_proc_exit
r_void
id|__init
id|fib_proc_exit
c_func
(paren
r_void
)paren
(brace
id|proc_net_remove
c_func
(paren
l_string|&quot;route&quot;
)paren
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_PROC_FS */
eof
