multiline_comment|/*&n; *&t;common UDP/RAW code&n; *&t;Linux INET implementation&n; *&n; * Authors:&n; * &t;Hideaki YOSHIFUJI &lt;yoshfuji@linux-ipv6.org&gt;&n; *&n; * &t;This program is free software; you can redistribute it and/or&n; * &t;modify it under the terms of the GNU General Public License&n; * &t;as published by the Free Software Foundation; either version&n; * &t;2 of the License, or (at your option) any later version.&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/ip.h&gt;
macro_line|#include &lt;linux/in.h&gt;
macro_line|#include &lt;net/sock.h&gt;
macro_line|#include &lt;net/tcp.h&gt;
macro_line|#include &lt;net/route.h&gt;
DECL|function|ip4_datagram_connect
r_int
id|ip4_datagram_connect
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_struct
id|sockaddr
op_star
id|uaddr
comma
r_int
id|addr_len
)paren
(brace
r_struct
id|inet_opt
op_star
id|inet
op_assign
id|inet_sk
c_func
(paren
id|sk
)paren
suffix:semicolon
r_struct
id|sockaddr_in
op_star
id|usin
op_assign
(paren
r_struct
id|sockaddr_in
op_star
)paren
id|uaddr
suffix:semicolon
r_struct
id|rtable
op_star
id|rt
suffix:semicolon
id|u32
id|saddr
suffix:semicolon
r_int
id|oif
suffix:semicolon
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
id|addr_len
OL
r_sizeof
(paren
op_star
id|usin
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|usin-&gt;sin_family
op_ne
id|AF_INET
)paren
r_return
op_minus
id|EAFNOSUPPORT
suffix:semicolon
id|sk_dst_reset
c_func
(paren
id|sk
)paren
suffix:semicolon
id|oif
op_assign
id|sk-&gt;sk_bound_dev_if
suffix:semicolon
id|saddr
op_assign
id|inet-&gt;saddr
suffix:semicolon
r_if
c_cond
(paren
id|MULTICAST
c_func
(paren
id|usin-&gt;sin_addr.s_addr
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|oif
)paren
id|oif
op_assign
id|inet-&gt;mc_index
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|saddr
)paren
id|saddr
op_assign
id|inet-&gt;mc_addr
suffix:semicolon
)brace
id|err
op_assign
id|ip_route_connect
c_func
(paren
op_amp
id|rt
comma
id|usin-&gt;sin_addr.s_addr
comma
id|saddr
comma
id|RT_CONN_FLAGS
c_func
(paren
id|sk
)paren
comma
id|oif
comma
id|sk-&gt;sk_protocol
comma
id|inet-&gt;sport
comma
id|usin-&gt;sin_port
comma
id|sk
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_return
id|err
suffix:semicolon
r_if
c_cond
(paren
(paren
id|rt-&gt;rt_flags
op_amp
id|RTCF_BROADCAST
)paren
op_logical_and
op_logical_neg
id|sock_flag
c_func
(paren
id|sk
comma
id|SOCK_BROADCAST
)paren
)paren
(brace
id|ip_rt_put
c_func
(paren
id|rt
)paren
suffix:semicolon
r_return
op_minus
id|EACCES
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|inet-&gt;saddr
)paren
id|inet-&gt;saddr
op_assign
id|rt-&gt;rt_src
suffix:semicolon
multiline_comment|/* Update source address */
r_if
c_cond
(paren
op_logical_neg
id|inet-&gt;rcv_saddr
)paren
id|inet-&gt;rcv_saddr
op_assign
id|rt-&gt;rt_src
suffix:semicolon
id|inet-&gt;daddr
op_assign
id|rt-&gt;rt_dst
suffix:semicolon
id|inet-&gt;dport
op_assign
id|usin-&gt;sin_port
suffix:semicolon
id|sk-&gt;sk_state
op_assign
id|TCP_ESTABLISHED
suffix:semicolon
id|inet-&gt;id
op_assign
id|jiffies
suffix:semicolon
id|sk_dst_set
c_func
(paren
id|sk
comma
op_amp
id|rt-&gt;u.dst
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|ip4_datagram_connect
id|EXPORT_SYMBOL
c_func
(paren
id|ip4_datagram_connect
)paren
suffix:semicolon
eof
