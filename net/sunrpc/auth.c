multiline_comment|/*&n; * linux/net/sunrpc/auth.c&n; *&n; * Generic RPC client authentication API.&n; *&n; * Copyright (C) 1996, Olaf Kirch &lt;okir@monad.swb.de&gt;&n; */
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/socket.h&gt;
macro_line|#include &lt;linux/sunrpc/clnt.h&gt;
macro_line|#include &lt;linux/spinlock.h&gt;
macro_line|#ifdef RPC_DEBUG
DECL|macro|RPCDBG_FACILITY
macro_line|# define RPCDBG_FACILITY&t;RPCDBG_AUTH
macro_line|#endif
DECL|variable|auth_flavors
r_static
r_struct
id|rpc_authops
op_star
id|auth_flavors
(braket
id|RPC_AUTH_MAXFLAVOR
)braket
op_assign
(brace
op_amp
id|authnull_ops
comma
multiline_comment|/* AUTH_NULL */
op_amp
id|authunix_ops
comma
multiline_comment|/* AUTH_UNIX */
l_int|NULL
comma
multiline_comment|/* others can be loadable modules */
)brace
suffix:semicolon
r_static
id|u32
DECL|function|pseudoflavor_to_flavor
id|pseudoflavor_to_flavor
c_func
(paren
id|u32
id|flavor
)paren
(brace
r_if
c_cond
(paren
id|flavor
op_ge
id|RPC_AUTH_MAXFLAVOR
)paren
r_return
id|RPC_AUTH_GSS
suffix:semicolon
r_return
id|flavor
suffix:semicolon
)brace
r_int
DECL|function|rpcauth_register
id|rpcauth_register
c_func
(paren
r_struct
id|rpc_authops
op_star
id|ops
)paren
(brace
id|rpc_authflavor_t
id|flavor
suffix:semicolon
r_if
c_cond
(paren
(paren
id|flavor
op_assign
id|ops-&gt;au_flavor
)paren
op_ge
id|RPC_AUTH_MAXFLAVOR
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|auth_flavors
(braket
id|flavor
)braket
op_ne
l_int|NULL
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
multiline_comment|/* what else? */
id|auth_flavors
(braket
id|flavor
)braket
op_assign
id|ops
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_int
DECL|function|rpcauth_unregister
id|rpcauth_unregister
c_func
(paren
r_struct
id|rpc_authops
op_star
id|ops
)paren
(brace
id|rpc_authflavor_t
id|flavor
suffix:semicolon
r_if
c_cond
(paren
(paren
id|flavor
op_assign
id|ops-&gt;au_flavor
)paren
op_ge
id|RPC_AUTH_MAXFLAVOR
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|auth_flavors
(braket
id|flavor
)braket
op_ne
id|ops
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
multiline_comment|/* what else? */
id|auth_flavors
(braket
id|flavor
)braket
op_assign
l_int|NULL
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_struct
id|rpc_auth
op_star
DECL|function|rpcauth_create
id|rpcauth_create
c_func
(paren
id|rpc_authflavor_t
id|pseudoflavor
comma
r_struct
id|rpc_clnt
op_star
id|clnt
)paren
(brace
r_struct
id|rpc_auth
op_star
id|auth
suffix:semicolon
r_struct
id|rpc_authops
op_star
id|ops
suffix:semicolon
id|u32
id|flavor
op_assign
id|pseudoflavor_to_flavor
c_func
(paren
id|pseudoflavor
)paren
suffix:semicolon
r_if
c_cond
(paren
id|flavor
op_ge
id|RPC_AUTH_MAXFLAVOR
op_logical_or
op_logical_neg
(paren
id|ops
op_assign
id|auth_flavors
(braket
id|flavor
)braket
)paren
)paren
r_return
l_int|NULL
suffix:semicolon
id|auth
op_assign
id|ops
op_member_access_from_pointer
id|create
c_func
(paren
id|clnt
comma
id|pseudoflavor
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|auth
)paren
r_return
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|clnt-&gt;cl_auth
)paren
id|rpcauth_destroy
c_func
(paren
id|clnt-&gt;cl_auth
)paren
suffix:semicolon
id|clnt-&gt;cl_auth
op_assign
id|auth
suffix:semicolon
r_return
id|auth
suffix:semicolon
)brace
r_void
DECL|function|rpcauth_destroy
id|rpcauth_destroy
c_func
(paren
r_struct
id|rpc_auth
op_star
id|auth
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|atomic_dec_and_test
c_func
(paren
op_amp
id|auth-&gt;au_count
)paren
)paren
r_return
suffix:semicolon
id|auth-&gt;au_ops
op_member_access_from_pointer
id|destroy
c_func
(paren
id|auth
)paren
suffix:semicolon
)brace
r_static
id|DEFINE_SPINLOCK
c_func
(paren
id|rpc_credcache_lock
)paren
suffix:semicolon
multiline_comment|/*&n; * Initialize RPC credential cache&n; */
r_int
DECL|function|rpcauth_init_credcache
id|rpcauth_init_credcache
c_func
(paren
r_struct
id|rpc_auth
op_star
id|auth
comma
r_int
r_int
id|expire
)paren
(brace
r_struct
id|rpc_cred_cache
op_star
r_new
suffix:semicolon
r_int
id|i
suffix:semicolon
r_new
op_assign
(paren
r_struct
id|rpc_cred_cache
op_star
)paren
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
r_new
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
r_new
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|RPC_CREDCACHE_NR
suffix:semicolon
id|i
op_increment
)paren
id|INIT_HLIST_HEAD
c_func
(paren
op_amp
r_new
op_member_access_from_pointer
id|hashtable
(braket
id|i
)braket
)paren
suffix:semicolon
r_new
op_member_access_from_pointer
id|expire
op_assign
id|expire
suffix:semicolon
r_new
op_member_access_from_pointer
id|nextgc
op_assign
id|jiffies
op_plus
(paren
id|expire
op_rshift
l_int|1
)paren
suffix:semicolon
id|auth-&gt;au_credcache
op_assign
r_new
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Destroy a list of credentials&n; */
r_static
r_inline
DECL|function|rpcauth_destroy_credlist
r_void
id|rpcauth_destroy_credlist
c_func
(paren
r_struct
id|hlist_head
op_star
id|head
)paren
(brace
r_struct
id|rpc_cred
op_star
id|cred
suffix:semicolon
r_while
c_loop
(paren
op_logical_neg
id|hlist_empty
c_func
(paren
id|head
)paren
)paren
(brace
id|cred
op_assign
id|hlist_entry
c_func
(paren
id|head-&gt;first
comma
r_struct
id|rpc_cred
comma
id|cr_hash
)paren
suffix:semicolon
id|hlist_del_init
c_func
(paren
op_amp
id|cred-&gt;cr_hash
)paren
suffix:semicolon
id|put_rpccred
c_func
(paren
id|cred
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; * Clear the RPC credential cache, and delete those credentials&n; * that are not referenced.&n; */
r_void
DECL|function|rpcauth_free_credcache
id|rpcauth_free_credcache
c_func
(paren
r_struct
id|rpc_auth
op_star
id|auth
)paren
(brace
r_struct
id|rpc_cred_cache
op_star
id|cache
op_assign
id|auth-&gt;au_credcache
suffix:semicolon
id|HLIST_HEAD
c_func
(paren
id|free
)paren
suffix:semicolon
r_struct
id|hlist_node
op_star
id|pos
comma
op_star
id|next
suffix:semicolon
r_struct
id|rpc_cred
op_star
id|cred
suffix:semicolon
r_int
id|i
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|rpc_credcache_lock
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|RPC_CREDCACHE_NR
suffix:semicolon
id|i
op_increment
)paren
(brace
id|hlist_for_each_safe
c_func
(paren
id|pos
comma
id|next
comma
op_amp
id|cache-&gt;hashtable
(braket
id|i
)braket
)paren
(brace
id|cred
op_assign
id|hlist_entry
c_func
(paren
id|pos
comma
r_struct
id|rpc_cred
comma
id|cr_hash
)paren
suffix:semicolon
id|__hlist_del
c_func
(paren
op_amp
id|cred-&gt;cr_hash
)paren
suffix:semicolon
id|hlist_add_head
c_func
(paren
op_amp
id|cred-&gt;cr_hash
comma
op_amp
id|free
)paren
suffix:semicolon
)brace
)brace
id|spin_unlock
c_func
(paren
op_amp
id|rpc_credcache_lock
)paren
suffix:semicolon
id|rpcauth_destroy_credlist
c_func
(paren
op_amp
id|free
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|rpcauth_prune_expired
id|rpcauth_prune_expired
c_func
(paren
r_struct
id|rpc_auth
op_star
id|auth
comma
r_struct
id|rpc_cred
op_star
id|cred
comma
r_struct
id|hlist_head
op_star
id|free
)paren
(brace
r_if
c_cond
(paren
id|atomic_read
c_func
(paren
op_amp
id|cred-&gt;cr_count
)paren
op_ne
l_int|1
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|time_after
c_func
(paren
id|jiffies
comma
id|cred-&gt;cr_expire
op_plus
id|auth-&gt;au_credcache-&gt;expire
)paren
)paren
id|cred-&gt;cr_flags
op_and_assign
op_complement
id|RPCAUTH_CRED_UPTODATE
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|cred-&gt;cr_flags
op_amp
id|RPCAUTH_CRED_UPTODATE
)paren
)paren
(brace
id|__hlist_del
c_func
(paren
op_amp
id|cred-&gt;cr_hash
)paren
suffix:semicolon
id|hlist_add_head
c_func
(paren
op_amp
id|cred-&gt;cr_hash
comma
id|free
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; * Remove stale credentials. Avoid sleeping inside the loop.&n; */
r_static
r_void
DECL|function|rpcauth_gc_credcache
id|rpcauth_gc_credcache
c_func
(paren
r_struct
id|rpc_auth
op_star
id|auth
comma
r_struct
id|hlist_head
op_star
id|free
)paren
(brace
r_struct
id|rpc_cred_cache
op_star
id|cache
op_assign
id|auth-&gt;au_credcache
suffix:semicolon
r_struct
id|hlist_node
op_star
id|pos
comma
op_star
id|next
suffix:semicolon
r_struct
id|rpc_cred
op_star
id|cred
suffix:semicolon
r_int
id|i
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;RPC: gc&squot;ing RPC credentials for auth %p&bslash;n&quot;
comma
id|auth
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|RPC_CREDCACHE_NR
suffix:semicolon
id|i
op_increment
)paren
(brace
id|hlist_for_each_safe
c_func
(paren
id|pos
comma
id|next
comma
op_amp
id|cache-&gt;hashtable
(braket
id|i
)braket
)paren
(brace
id|cred
op_assign
id|hlist_entry
c_func
(paren
id|pos
comma
r_struct
id|rpc_cred
comma
id|cr_hash
)paren
suffix:semicolon
id|rpcauth_prune_expired
c_func
(paren
id|auth
comma
id|cred
comma
id|free
)paren
suffix:semicolon
)brace
)brace
id|cache-&gt;nextgc
op_assign
id|jiffies
op_plus
id|cache-&gt;expire
suffix:semicolon
)brace
multiline_comment|/*&n; * Look up a process&squot; credentials in the authentication cache&n; */
r_struct
id|rpc_cred
op_star
DECL|function|rpcauth_lookup_credcache
id|rpcauth_lookup_credcache
c_func
(paren
r_struct
id|rpc_auth
op_star
id|auth
comma
r_struct
id|auth_cred
op_star
id|acred
comma
r_int
id|taskflags
)paren
(brace
r_struct
id|rpc_cred_cache
op_star
id|cache
op_assign
id|auth-&gt;au_credcache
suffix:semicolon
id|HLIST_HEAD
c_func
(paren
id|free
)paren
suffix:semicolon
r_struct
id|hlist_node
op_star
id|pos
comma
op_star
id|next
suffix:semicolon
r_struct
id|rpc_cred
op_star
r_new
op_assign
l_int|NULL
comma
op_star
id|cred
op_assign
l_int|NULL
suffix:semicolon
r_int
id|nr
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|taskflags
op_amp
id|RPC_TASK_ROOTCREDS
)paren
)paren
id|nr
op_assign
id|acred-&gt;uid
op_amp
id|RPC_CREDCACHE_MASK
suffix:semicolon
id|retry
suffix:colon
id|spin_lock
c_func
(paren
op_amp
id|rpc_credcache_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|time_before
c_func
(paren
id|cache-&gt;nextgc
comma
id|jiffies
)paren
)paren
id|rpcauth_gc_credcache
c_func
(paren
id|auth
comma
op_amp
id|free
)paren
suffix:semicolon
id|hlist_for_each_safe
c_func
(paren
id|pos
comma
id|next
comma
op_amp
id|cache-&gt;hashtable
(braket
id|nr
)braket
)paren
(brace
r_struct
id|rpc_cred
op_star
id|entry
suffix:semicolon
id|entry
op_assign
id|hlist_entry
c_func
(paren
id|pos
comma
r_struct
id|rpc_cred
comma
id|cr_hash
)paren
suffix:semicolon
r_if
c_cond
(paren
id|entry-&gt;cr_ops
op_member_access_from_pointer
id|crmatch
c_func
(paren
id|acred
comma
id|entry
comma
id|taskflags
)paren
)paren
(brace
id|hlist_del
c_func
(paren
op_amp
id|entry-&gt;cr_hash
)paren
suffix:semicolon
id|cred
op_assign
id|entry
suffix:semicolon
r_break
suffix:semicolon
)brace
id|rpcauth_prune_expired
c_func
(paren
id|auth
comma
id|entry
comma
op_amp
id|free
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
r_new
)paren
(brace
r_if
c_cond
(paren
id|cred
)paren
id|hlist_add_head
c_func
(paren
op_amp
r_new
op_member_access_from_pointer
id|cr_hash
comma
op_amp
id|free
)paren
suffix:semicolon
r_else
id|cred
op_assign
r_new
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cred
)paren
(brace
id|hlist_add_head
c_func
(paren
op_amp
id|cred-&gt;cr_hash
comma
op_amp
id|cache-&gt;hashtable
(braket
id|nr
)braket
)paren
suffix:semicolon
id|get_rpccred
c_func
(paren
id|cred
)paren
suffix:semicolon
)brace
id|spin_unlock
c_func
(paren
op_amp
id|rpc_credcache_lock
)paren
suffix:semicolon
id|rpcauth_destroy_credlist
c_func
(paren
op_amp
id|free
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cred
)paren
(brace
r_new
op_assign
id|auth-&gt;au_ops
op_member_access_from_pointer
id|crcreate
c_func
(paren
id|auth
comma
id|acred
comma
id|taskflags
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|IS_ERR
c_func
(paren
r_new
)paren
)paren
(brace
macro_line|#ifdef RPC_DEBUG
r_new
op_member_access_from_pointer
id|cr_magic
op_assign
id|RPCAUTH_CRED_MAGIC
suffix:semicolon
macro_line|#endif
r_goto
id|retry
suffix:semicolon
)brace
r_else
id|cred
op_assign
r_new
suffix:semicolon
)brace
r_return
(paren
r_struct
id|rpc_cred
op_star
)paren
id|cred
suffix:semicolon
)brace
r_struct
id|rpc_cred
op_star
DECL|function|rpcauth_lookupcred
id|rpcauth_lookupcred
c_func
(paren
r_struct
id|rpc_auth
op_star
id|auth
comma
r_int
id|taskflags
)paren
(brace
r_struct
id|auth_cred
id|acred
op_assign
(brace
dot
id|uid
op_assign
id|current-&gt;fsuid
comma
dot
id|gid
op_assign
id|current-&gt;fsgid
comma
dot
id|group_info
op_assign
id|current-&gt;group_info
comma
)brace
suffix:semicolon
r_struct
id|rpc_cred
op_star
id|ret
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;RPC:     looking up %s cred&bslash;n&quot;
comma
id|auth-&gt;au_ops-&gt;au_name
)paren
suffix:semicolon
id|get_group_info
c_func
(paren
id|acred.group_info
)paren
suffix:semicolon
id|ret
op_assign
id|auth-&gt;au_ops
op_member_access_from_pointer
id|lookup_cred
c_func
(paren
id|auth
comma
op_amp
id|acred
comma
id|taskflags
)paren
suffix:semicolon
id|put_group_info
c_func
(paren
id|acred.group_info
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
r_struct
id|rpc_cred
op_star
DECL|function|rpcauth_bindcred
id|rpcauth_bindcred
c_func
(paren
r_struct
id|rpc_task
op_star
id|task
)paren
(brace
r_struct
id|rpc_auth
op_star
id|auth
op_assign
id|task-&gt;tk_auth
suffix:semicolon
r_struct
id|auth_cred
id|acred
op_assign
(brace
dot
id|uid
op_assign
id|current-&gt;fsuid
comma
dot
id|gid
op_assign
id|current-&gt;fsgid
comma
dot
id|group_info
op_assign
id|current-&gt;group_info
comma
)brace
suffix:semicolon
r_struct
id|rpc_cred
op_star
id|ret
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;RPC: %4d looking up %s cred&bslash;n&quot;
comma
id|task-&gt;tk_pid
comma
id|task-&gt;tk_auth-&gt;au_ops-&gt;au_name
)paren
suffix:semicolon
id|get_group_info
c_func
(paren
id|acred.group_info
)paren
suffix:semicolon
id|ret
op_assign
id|auth-&gt;au_ops
op_member_access_from_pointer
id|lookup_cred
c_func
(paren
id|auth
comma
op_amp
id|acred
comma
id|task-&gt;tk_flags
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|IS_ERR
c_func
(paren
id|ret
)paren
)paren
id|task-&gt;tk_msg.rpc_cred
op_assign
id|ret
suffix:semicolon
r_else
id|task-&gt;tk_status
op_assign
id|PTR_ERR
c_func
(paren
id|ret
)paren
suffix:semicolon
id|put_group_info
c_func
(paren
id|acred.group_info
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
r_void
DECL|function|rpcauth_holdcred
id|rpcauth_holdcred
c_func
(paren
r_struct
id|rpc_task
op_star
id|task
)paren
(brace
id|dprintk
c_func
(paren
l_string|&quot;RPC: %4d holding %s cred %p&bslash;n&quot;
comma
id|task-&gt;tk_pid
comma
id|task-&gt;tk_auth-&gt;au_ops-&gt;au_name
comma
id|task-&gt;tk_msg.rpc_cred
)paren
suffix:semicolon
r_if
c_cond
(paren
id|task-&gt;tk_msg.rpc_cred
)paren
id|get_rpccred
c_func
(paren
id|task-&gt;tk_msg.rpc_cred
)paren
suffix:semicolon
)brace
r_void
DECL|function|put_rpccred
id|put_rpccred
c_func
(paren
r_struct
id|rpc_cred
op_star
id|cred
)paren
(brace
id|cred-&gt;cr_expire
op_assign
id|jiffies
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|atomic_dec_and_test
c_func
(paren
op_amp
id|cred-&gt;cr_count
)paren
)paren
r_return
suffix:semicolon
id|cred-&gt;cr_ops
op_member_access_from_pointer
id|crdestroy
c_func
(paren
id|cred
)paren
suffix:semicolon
)brace
r_void
DECL|function|rpcauth_unbindcred
id|rpcauth_unbindcred
c_func
(paren
r_struct
id|rpc_task
op_star
id|task
)paren
(brace
r_struct
id|rpc_auth
op_star
id|auth
op_assign
id|task-&gt;tk_auth
suffix:semicolon
r_struct
id|rpc_cred
op_star
id|cred
op_assign
id|task-&gt;tk_msg.rpc_cred
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;RPC: %4d releasing %s cred %p&bslash;n&quot;
comma
id|task-&gt;tk_pid
comma
id|auth-&gt;au_ops-&gt;au_name
comma
id|cred
)paren
suffix:semicolon
id|put_rpccred
c_func
(paren
id|cred
)paren
suffix:semicolon
id|task-&gt;tk_msg.rpc_cred
op_assign
l_int|NULL
suffix:semicolon
)brace
id|u32
op_star
DECL|function|rpcauth_marshcred
id|rpcauth_marshcred
c_func
(paren
r_struct
id|rpc_task
op_star
id|task
comma
id|u32
op_star
id|p
)paren
(brace
r_struct
id|rpc_auth
op_star
id|auth
op_assign
id|task-&gt;tk_auth
suffix:semicolon
r_struct
id|rpc_cred
op_star
id|cred
op_assign
id|task-&gt;tk_msg.rpc_cred
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;RPC: %4d marshaling %s cred %p&bslash;n&quot;
comma
id|task-&gt;tk_pid
comma
id|auth-&gt;au_ops-&gt;au_name
comma
id|cred
)paren
suffix:semicolon
r_return
id|cred-&gt;cr_ops
op_member_access_from_pointer
id|crmarshal
c_func
(paren
id|task
comma
id|p
comma
id|task-&gt;tk_flags
op_amp
id|RPC_CALL_REALUID
)paren
suffix:semicolon
)brace
id|u32
op_star
DECL|function|rpcauth_checkverf
id|rpcauth_checkverf
c_func
(paren
r_struct
id|rpc_task
op_star
id|task
comma
id|u32
op_star
id|p
)paren
(brace
r_struct
id|rpc_auth
op_star
id|auth
op_assign
id|task-&gt;tk_auth
suffix:semicolon
r_struct
id|rpc_cred
op_star
id|cred
op_assign
id|task-&gt;tk_msg.rpc_cred
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;RPC: %4d validating %s cred %p&bslash;n&quot;
comma
id|task-&gt;tk_pid
comma
id|auth-&gt;au_ops-&gt;au_name
comma
id|cred
)paren
suffix:semicolon
r_return
id|cred-&gt;cr_ops
op_member_access_from_pointer
id|crvalidate
c_func
(paren
id|task
comma
id|p
)paren
suffix:semicolon
)brace
r_int
DECL|function|rpcauth_wrap_req
id|rpcauth_wrap_req
c_func
(paren
r_struct
id|rpc_task
op_star
id|task
comma
id|kxdrproc_t
id|encode
comma
r_void
op_star
id|rqstp
comma
id|u32
op_star
id|data
comma
r_void
op_star
id|obj
)paren
(brace
r_struct
id|rpc_cred
op_star
id|cred
op_assign
id|task-&gt;tk_msg.rpc_cred
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;RPC: %4d using %s cred %p to wrap rpc data&bslash;n&quot;
comma
id|task-&gt;tk_pid
comma
id|cred-&gt;cr_ops-&gt;cr_name
comma
id|cred
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cred-&gt;cr_ops-&gt;crwrap_req
)paren
r_return
id|cred-&gt;cr_ops
op_member_access_from_pointer
id|crwrap_req
c_func
(paren
id|task
comma
id|encode
comma
id|rqstp
comma
id|data
comma
id|obj
)paren
suffix:semicolon
multiline_comment|/* By default, we encode the arguments normally. */
r_return
id|encode
c_func
(paren
id|rqstp
comma
id|data
comma
id|obj
)paren
suffix:semicolon
)brace
r_int
DECL|function|rpcauth_unwrap_resp
id|rpcauth_unwrap_resp
c_func
(paren
r_struct
id|rpc_task
op_star
id|task
comma
id|kxdrproc_t
id|decode
comma
r_void
op_star
id|rqstp
comma
id|u32
op_star
id|data
comma
r_void
op_star
id|obj
)paren
(brace
r_struct
id|rpc_cred
op_star
id|cred
op_assign
id|task-&gt;tk_msg.rpc_cred
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;RPC: %4d using %s cred %p to unwrap rpc data&bslash;n&quot;
comma
id|task-&gt;tk_pid
comma
id|cred-&gt;cr_ops-&gt;cr_name
comma
id|cred
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cred-&gt;cr_ops-&gt;crunwrap_resp
)paren
r_return
id|cred-&gt;cr_ops
op_member_access_from_pointer
id|crunwrap_resp
c_func
(paren
id|task
comma
id|decode
comma
id|rqstp
comma
id|data
comma
id|obj
)paren
suffix:semicolon
multiline_comment|/* By default, we decode the arguments normally. */
r_return
id|decode
c_func
(paren
id|rqstp
comma
id|data
comma
id|obj
)paren
suffix:semicolon
)brace
r_int
DECL|function|rpcauth_refreshcred
id|rpcauth_refreshcred
c_func
(paren
r_struct
id|rpc_task
op_star
id|task
)paren
(brace
r_struct
id|rpc_auth
op_star
id|auth
op_assign
id|task-&gt;tk_auth
suffix:semicolon
r_struct
id|rpc_cred
op_star
id|cred
op_assign
id|task-&gt;tk_msg.rpc_cred
suffix:semicolon
r_int
id|err
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;RPC: %4d refreshing %s cred %p&bslash;n&quot;
comma
id|task-&gt;tk_pid
comma
id|auth-&gt;au_ops-&gt;au_name
comma
id|cred
)paren
suffix:semicolon
id|err
op_assign
id|cred-&gt;cr_ops
op_member_access_from_pointer
id|crrefresh
c_func
(paren
id|task
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
id|task-&gt;tk_status
op_assign
id|err
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
r_void
DECL|function|rpcauth_invalcred
id|rpcauth_invalcred
c_func
(paren
r_struct
id|rpc_task
op_star
id|task
)paren
(brace
id|dprintk
c_func
(paren
l_string|&quot;RPC: %4d invalidating %s cred %p&bslash;n&quot;
comma
id|task-&gt;tk_pid
comma
id|task-&gt;tk_auth-&gt;au_ops-&gt;au_name
comma
id|task-&gt;tk_msg.rpc_cred
)paren
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|rpc_credcache_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|task-&gt;tk_msg.rpc_cred
)paren
id|task-&gt;tk_msg.rpc_cred-&gt;cr_flags
op_and_assign
op_complement
id|RPCAUTH_CRED_UPTODATE
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|rpc_credcache_lock
)paren
suffix:semicolon
)brace
r_int
DECL|function|rpcauth_uptodatecred
id|rpcauth_uptodatecred
c_func
(paren
r_struct
id|rpc_task
op_star
id|task
)paren
(brace
r_return
op_logical_neg
(paren
id|task-&gt;tk_msg.rpc_cred
)paren
op_logical_or
(paren
id|task-&gt;tk_msg.rpc_cred-&gt;cr_flags
op_amp
id|RPCAUTH_CRED_UPTODATE
)paren
suffix:semicolon
)brace
eof
