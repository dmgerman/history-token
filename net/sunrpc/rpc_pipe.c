multiline_comment|/*&n; * net/sunrpc/rpc_pipe.c&n; *&n; * Userland/kernel interface for rpcauth_gss.&n; * Code shamelessly plagiarized from fs/nfsd/nfsctl.c&n; * and fs/driverfs/inode.c&n; *&n; * Copyright (c) 2002, Trond Myklebust &lt;trond.myklebust@fys.uio.no&gt;&n; *&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/pagemap.h&gt;
macro_line|#include &lt;linux/mount.h&gt;
macro_line|#include &lt;linux/namei.h&gt;
macro_line|#include &lt;linux/dnotify.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;asm/ioctls.h&gt;
macro_line|#include &lt;linux/fs.h&gt;
macro_line|#include &lt;linux/poll.h&gt;
macro_line|#include &lt;linux/wait.h&gt;
macro_line|#include &lt;linux/seq_file.h&gt;
macro_line|#include &lt;linux/sunrpc/clnt.h&gt;
macro_line|#include &lt;linux/workqueue.h&gt;
macro_line|#include &lt;linux/sunrpc/rpc_pipe_fs.h&gt;
DECL|variable|rpc_mount
r_static
r_struct
id|vfsmount
op_star
id|rpc_mount
suffix:semicolon
DECL|variable|rpc_mount_count
r_static
r_int
id|rpc_mount_count
suffix:semicolon
DECL|variable|rpc_pipe_fs_type
r_static
r_struct
id|file_system_type
id|rpc_pipe_fs_type
suffix:semicolon
DECL|variable|rpc_inode_cachep
r_static
id|kmem_cache_t
op_star
id|rpc_inode_cachep
suffix:semicolon
DECL|macro|RPC_UPCALL_TIMEOUT
mdefine_line|#define RPC_UPCALL_TIMEOUT (30*HZ)
r_static
r_void
DECL|function|__rpc_purge_upcall
id|__rpc_purge_upcall
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_int
id|err
)paren
(brace
r_struct
id|rpc_inode
op_star
id|rpci
op_assign
id|RPC_I
c_func
(paren
id|inode
)paren
suffix:semicolon
r_struct
id|rpc_pipe_msg
op_star
id|msg
suffix:semicolon
r_while
c_loop
(paren
op_logical_neg
id|list_empty
c_func
(paren
op_amp
id|rpci-&gt;pipe
)paren
)paren
(brace
id|msg
op_assign
id|list_entry
c_func
(paren
id|rpci-&gt;pipe.next
comma
r_struct
id|rpc_pipe_msg
comma
id|list
)paren
suffix:semicolon
id|list_del_init
c_func
(paren
op_amp
id|msg-&gt;list
)paren
suffix:semicolon
id|msg-&gt;errno
op_assign
id|err
suffix:semicolon
id|rpci-&gt;ops
op_member_access_from_pointer
id|destroy_msg
c_func
(paren
id|msg
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
op_logical_neg
id|list_empty
c_func
(paren
op_amp
id|rpci-&gt;in_upcall
)paren
)paren
(brace
id|msg
op_assign
id|list_entry
c_func
(paren
id|rpci-&gt;pipe.next
comma
r_struct
id|rpc_pipe_msg
comma
id|list
)paren
suffix:semicolon
id|list_del_init
c_func
(paren
op_amp
id|msg-&gt;list
)paren
suffix:semicolon
id|msg-&gt;errno
op_assign
id|err
suffix:semicolon
id|rpci-&gt;ops
op_member_access_from_pointer
id|destroy_msg
c_func
(paren
id|msg
)paren
suffix:semicolon
)brace
id|rpci-&gt;pipelen
op_assign
l_int|0
suffix:semicolon
id|wake_up
c_func
(paren
op_amp
id|rpci-&gt;waitq
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|rpc_timeout_upcall_queue
id|rpc_timeout_upcall_queue
c_func
(paren
r_void
op_star
id|data
)paren
(brace
r_struct
id|rpc_inode
op_star
id|rpci
op_assign
(paren
r_struct
id|rpc_inode
op_star
)paren
id|data
suffix:semicolon
r_struct
id|inode
op_star
id|inode
op_assign
op_amp
id|rpci-&gt;vfs_inode
suffix:semicolon
id|down
c_func
(paren
op_amp
id|inode-&gt;i_sem
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rpci-&gt;nreaders
op_eq
l_int|0
op_logical_and
op_logical_neg
id|list_empty
c_func
(paren
op_amp
id|rpci-&gt;pipe
)paren
)paren
id|__rpc_purge_upcall
c_func
(paren
id|inode
comma
op_minus
id|ETIMEDOUT
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|inode-&gt;i_sem
)paren
suffix:semicolon
)brace
r_int
DECL|function|rpc_queue_upcall
id|rpc_queue_upcall
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|rpc_pipe_msg
op_star
id|msg
)paren
(brace
r_struct
id|rpc_inode
op_star
id|rpci
op_assign
id|RPC_I
c_func
(paren
id|inode
)paren
suffix:semicolon
r_int
id|res
op_assign
l_int|0
suffix:semicolon
id|down
c_func
(paren
op_amp
id|inode-&gt;i_sem
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rpci-&gt;nreaders
)paren
(brace
id|list_add_tail
c_func
(paren
op_amp
id|msg-&gt;list
comma
op_amp
id|rpci-&gt;pipe
)paren
suffix:semicolon
id|rpci-&gt;pipelen
op_add_assign
id|msg-&gt;len
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|rpci-&gt;flags
op_amp
id|RPC_PIPE_WAIT_FOR_OPEN
)paren
(brace
r_if
c_cond
(paren
id|list_empty
c_func
(paren
op_amp
id|rpci-&gt;pipe
)paren
)paren
id|schedule_delayed_work
c_func
(paren
op_amp
id|rpci-&gt;queue_timeout
comma
id|RPC_UPCALL_TIMEOUT
)paren
suffix:semicolon
id|list_add_tail
c_func
(paren
op_amp
id|msg-&gt;list
comma
op_amp
id|rpci-&gt;pipe
)paren
suffix:semicolon
id|rpci-&gt;pipelen
op_add_assign
id|msg-&gt;len
suffix:semicolon
)brace
r_else
id|res
op_assign
op_minus
id|EPIPE
suffix:semicolon
id|up
c_func
(paren
op_amp
id|inode-&gt;i_sem
)paren
suffix:semicolon
id|wake_up
c_func
(paren
op_amp
id|rpci-&gt;waitq
)paren
suffix:semicolon
r_return
id|res
suffix:semicolon
)brace
r_static
r_void
DECL|function|rpc_close_pipes
id|rpc_close_pipes
c_func
(paren
r_struct
id|inode
op_star
id|inode
)paren
(brace
r_struct
id|rpc_inode
op_star
id|rpci
op_assign
id|RPC_I
c_func
(paren
id|inode
)paren
suffix:semicolon
id|cancel_delayed_work
c_func
(paren
op_amp
id|rpci-&gt;queue_timeout
)paren
suffix:semicolon
id|flush_scheduled_work
c_func
(paren
)paren
suffix:semicolon
id|down
c_func
(paren
op_amp
id|inode-&gt;i_sem
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rpci-&gt;ops
op_ne
l_int|NULL
)paren
(brace
id|rpci-&gt;nreaders
op_assign
l_int|0
suffix:semicolon
id|__rpc_purge_upcall
c_func
(paren
id|inode
comma
op_minus
id|EPIPE
)paren
suffix:semicolon
id|rpci-&gt;nwriters
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|rpci-&gt;ops-&gt;release_pipe
)paren
id|rpci-&gt;ops
op_member_access_from_pointer
id|release_pipe
c_func
(paren
id|inode
)paren
suffix:semicolon
id|rpci-&gt;ops
op_assign
l_int|NULL
suffix:semicolon
)brace
id|up
c_func
(paren
op_amp
id|inode-&gt;i_sem
)paren
suffix:semicolon
)brace
r_static
r_inline
r_void
DECL|function|rpc_inode_setowner
id|rpc_inode_setowner
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_void
op_star
r_private
)paren
(brace
id|RPC_I
c_func
(paren
id|inode
)paren
op_member_access_from_pointer
r_private
op_assign
r_private
suffix:semicolon
)brace
r_static
r_struct
id|inode
op_star
DECL|function|rpc_alloc_inode
id|rpc_alloc_inode
c_func
(paren
r_struct
id|super_block
op_star
id|sb
)paren
(brace
r_struct
id|rpc_inode
op_star
id|rpci
suffix:semicolon
id|rpci
op_assign
(paren
r_struct
id|rpc_inode
op_star
)paren
id|kmem_cache_alloc
c_func
(paren
id|rpc_inode_cachep
comma
id|SLAB_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|rpci
)paren
r_return
l_int|NULL
suffix:semicolon
r_return
op_amp
id|rpci-&gt;vfs_inode
suffix:semicolon
)brace
r_static
r_void
DECL|function|rpc_destroy_inode
id|rpc_destroy_inode
c_func
(paren
r_struct
id|inode
op_star
id|inode
)paren
(brace
id|kmem_cache_free
c_func
(paren
id|rpc_inode_cachep
comma
id|RPC_I
c_func
(paren
id|inode
)paren
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|rpc_pipe_open
id|rpc_pipe_open
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|filp
)paren
(brace
r_struct
id|rpc_inode
op_star
id|rpci
op_assign
id|RPC_I
c_func
(paren
id|inode
)paren
suffix:semicolon
r_int
id|res
op_assign
op_minus
id|ENXIO
suffix:semicolon
id|down
c_func
(paren
op_amp
id|inode-&gt;i_sem
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rpci-&gt;ops
op_ne
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
id|filp-&gt;f_mode
op_amp
id|FMODE_READ
)paren
id|rpci-&gt;nreaders
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|filp-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
id|rpci-&gt;nwriters
op_increment
suffix:semicolon
id|res
op_assign
l_int|0
suffix:semicolon
)brace
id|up
c_func
(paren
op_amp
id|inode-&gt;i_sem
)paren
suffix:semicolon
r_return
id|res
suffix:semicolon
)brace
r_static
r_int
DECL|function|rpc_pipe_release
id|rpc_pipe_release
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|filp
)paren
(brace
r_struct
id|rpc_inode
op_star
id|rpci
op_assign
id|RPC_I
c_func
(paren
id|filp-&gt;f_dentry-&gt;d_inode
)paren
suffix:semicolon
r_struct
id|rpc_pipe_msg
op_star
id|msg
suffix:semicolon
id|down
c_func
(paren
op_amp
id|inode-&gt;i_sem
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rpci-&gt;ops
op_eq
l_int|NULL
)paren
r_goto
id|out
suffix:semicolon
id|msg
op_assign
(paren
r_struct
id|rpc_pipe_msg
op_star
)paren
id|filp-&gt;private_data
suffix:semicolon
r_if
c_cond
(paren
id|msg
op_ne
l_int|NULL
)paren
(brace
id|msg-&gt;errno
op_assign
op_minus
id|EPIPE
suffix:semicolon
id|list_del_init
c_func
(paren
op_amp
id|msg-&gt;list
)paren
suffix:semicolon
id|rpci-&gt;ops
op_member_access_from_pointer
id|destroy_msg
c_func
(paren
id|msg
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|filp-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
id|rpci-&gt;nwriters
op_decrement
suffix:semicolon
r_if
c_cond
(paren
id|filp-&gt;f_mode
op_amp
id|FMODE_READ
)paren
id|rpci-&gt;nreaders
op_decrement
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|rpci-&gt;nreaders
)paren
id|__rpc_purge_upcall
c_func
(paren
id|inode
comma
op_minus
id|EPIPE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rpci-&gt;ops-&gt;release_pipe
)paren
id|rpci-&gt;ops
op_member_access_from_pointer
id|release_pipe
c_func
(paren
id|inode
)paren
suffix:semicolon
id|out
suffix:colon
id|up
c_func
(paren
op_amp
id|inode-&gt;i_sem
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
id|ssize_t
DECL|function|rpc_pipe_read
id|rpc_pipe_read
c_func
(paren
r_struct
id|file
op_star
id|filp
comma
r_char
id|__user
op_star
id|buf
comma
r_int
id|len
comma
id|loff_t
op_star
id|offset
)paren
(brace
r_struct
id|inode
op_star
id|inode
op_assign
id|filp-&gt;f_dentry-&gt;d_inode
suffix:semicolon
r_struct
id|rpc_inode
op_star
id|rpci
op_assign
id|RPC_I
c_func
(paren
id|inode
)paren
suffix:semicolon
r_struct
id|rpc_pipe_msg
op_star
id|msg
suffix:semicolon
r_int
id|res
op_assign
l_int|0
suffix:semicolon
id|down
c_func
(paren
op_amp
id|inode-&gt;i_sem
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rpci-&gt;ops
op_eq
l_int|NULL
)paren
(brace
id|res
op_assign
op_minus
id|EPIPE
suffix:semicolon
r_goto
id|out_unlock
suffix:semicolon
)brace
id|msg
op_assign
id|filp-&gt;private_data
suffix:semicolon
r_if
c_cond
(paren
id|msg
op_eq
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|list_empty
c_func
(paren
op_amp
id|rpci-&gt;pipe
)paren
)paren
(brace
id|msg
op_assign
id|list_entry
c_func
(paren
id|rpci-&gt;pipe.next
comma
r_struct
id|rpc_pipe_msg
comma
id|list
)paren
suffix:semicolon
id|list_move
c_func
(paren
op_amp
id|msg-&gt;list
comma
op_amp
id|rpci-&gt;in_upcall
)paren
suffix:semicolon
id|rpci-&gt;pipelen
op_sub_assign
id|msg-&gt;len
suffix:semicolon
id|filp-&gt;private_data
op_assign
id|msg
suffix:semicolon
id|msg-&gt;copied
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|msg
op_eq
l_int|NULL
)paren
r_goto
id|out_unlock
suffix:semicolon
)brace
multiline_comment|/* NOTE: it is up to the callback to update msg-&gt;copied */
id|res
op_assign
id|rpci-&gt;ops
op_member_access_from_pointer
id|upcall
c_func
(paren
id|filp
comma
id|msg
comma
id|buf
comma
id|len
)paren
suffix:semicolon
r_if
c_cond
(paren
id|res
OL
l_int|0
op_logical_or
id|msg-&gt;len
op_eq
id|msg-&gt;copied
)paren
(brace
id|filp-&gt;private_data
op_assign
l_int|NULL
suffix:semicolon
id|list_del_init
c_func
(paren
op_amp
id|msg-&gt;list
)paren
suffix:semicolon
id|rpci-&gt;ops
op_member_access_from_pointer
id|destroy_msg
c_func
(paren
id|msg
)paren
suffix:semicolon
)brace
id|out_unlock
suffix:colon
id|up
c_func
(paren
op_amp
id|inode-&gt;i_sem
)paren
suffix:semicolon
r_return
id|res
suffix:semicolon
)brace
r_static
id|ssize_t
DECL|function|rpc_pipe_write
id|rpc_pipe_write
c_func
(paren
r_struct
id|file
op_star
id|filp
comma
r_const
r_char
id|__user
op_star
id|buf
comma
r_int
id|len
comma
id|loff_t
op_star
id|offset
)paren
(brace
r_struct
id|inode
op_star
id|inode
op_assign
id|filp-&gt;f_dentry-&gt;d_inode
suffix:semicolon
r_struct
id|rpc_inode
op_star
id|rpci
op_assign
id|RPC_I
c_func
(paren
id|inode
)paren
suffix:semicolon
r_int
id|res
suffix:semicolon
id|down
c_func
(paren
op_amp
id|inode-&gt;i_sem
)paren
suffix:semicolon
id|res
op_assign
op_minus
id|EPIPE
suffix:semicolon
r_if
c_cond
(paren
id|rpci-&gt;ops
op_ne
l_int|NULL
)paren
id|res
op_assign
id|rpci-&gt;ops
op_member_access_from_pointer
id|downcall
c_func
(paren
id|filp
comma
id|buf
comma
id|len
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|inode-&gt;i_sem
)paren
suffix:semicolon
r_return
id|res
suffix:semicolon
)brace
r_static
r_int
r_int
DECL|function|rpc_pipe_poll
id|rpc_pipe_poll
c_func
(paren
r_struct
id|file
op_star
id|filp
comma
r_struct
id|poll_table_struct
op_star
id|wait
)paren
(brace
r_struct
id|rpc_inode
op_star
id|rpci
suffix:semicolon
r_int
r_int
id|mask
op_assign
l_int|0
suffix:semicolon
id|rpci
op_assign
id|RPC_I
c_func
(paren
id|filp-&gt;f_dentry-&gt;d_inode
)paren
suffix:semicolon
id|poll_wait
c_func
(paren
id|filp
comma
op_amp
id|rpci-&gt;waitq
comma
id|wait
)paren
suffix:semicolon
id|mask
op_assign
id|POLLOUT
op_or
id|POLLWRNORM
suffix:semicolon
r_if
c_cond
(paren
id|rpci-&gt;ops
op_eq
l_int|NULL
)paren
id|mask
op_or_assign
id|POLLERR
op_or
id|POLLHUP
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|list_empty
c_func
(paren
op_amp
id|rpci-&gt;pipe
)paren
)paren
id|mask
op_or_assign
id|POLLIN
op_or
id|POLLRDNORM
suffix:semicolon
r_return
id|mask
suffix:semicolon
)brace
r_static
r_int
DECL|function|rpc_pipe_ioctl
id|rpc_pipe_ioctl
c_func
(paren
r_struct
id|inode
op_star
id|ino
comma
r_struct
id|file
op_star
id|filp
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
r_struct
id|rpc_inode
op_star
id|rpci
op_assign
id|RPC_I
c_func
(paren
id|filp-&gt;f_dentry-&gt;d_inode
)paren
suffix:semicolon
r_int
id|len
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|FIONREAD
suffix:colon
r_if
c_cond
(paren
id|rpci-&gt;ops
op_eq
l_int|NULL
)paren
r_return
op_minus
id|EPIPE
suffix:semicolon
id|len
op_assign
id|rpci-&gt;pipelen
suffix:semicolon
r_if
c_cond
(paren
id|filp-&gt;private_data
)paren
(brace
r_struct
id|rpc_pipe_msg
op_star
id|msg
suffix:semicolon
id|msg
op_assign
(paren
r_struct
id|rpc_pipe_msg
op_star
)paren
id|filp-&gt;private_data
suffix:semicolon
id|len
op_add_assign
id|msg-&gt;len
op_minus
id|msg-&gt;copied
suffix:semicolon
)brace
r_return
id|put_user
c_func
(paren
id|len
comma
(paren
r_int
id|__user
op_star
)paren
id|arg
)paren
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
)brace
DECL|variable|rpc_pipe_fops
r_static
r_struct
id|file_operations
id|rpc_pipe_fops
op_assign
(brace
dot
id|owner
op_assign
id|THIS_MODULE
comma
dot
id|llseek
op_assign
id|no_llseek
comma
dot
id|read
op_assign
id|rpc_pipe_read
comma
dot
id|write
op_assign
id|rpc_pipe_write
comma
dot
id|poll
op_assign
id|rpc_pipe_poll
comma
dot
id|ioctl
op_assign
id|rpc_pipe_ioctl
comma
dot
id|open
op_assign
id|rpc_pipe_open
comma
dot
id|release
op_assign
id|rpc_pipe_release
comma
)brace
suffix:semicolon
r_static
r_int
DECL|function|rpc_show_info
id|rpc_show_info
c_func
(paren
r_struct
id|seq_file
op_star
id|m
comma
r_void
op_star
id|v
)paren
(brace
r_struct
id|rpc_clnt
op_star
id|clnt
op_assign
id|m
op_member_access_from_pointer
r_private
suffix:semicolon
id|seq_printf
c_func
(paren
id|m
comma
l_string|&quot;RPC server: %s&bslash;n&quot;
comma
id|clnt-&gt;cl_server
)paren
suffix:semicolon
id|seq_printf
c_func
(paren
id|m
comma
l_string|&quot;service: %s (%d) version %d&bslash;n&quot;
comma
id|clnt-&gt;cl_protname
comma
id|clnt-&gt;cl_prog
comma
id|clnt-&gt;cl_vers
)paren
suffix:semicolon
id|seq_printf
c_func
(paren
id|m
comma
l_string|&quot;address: %u.%u.%u.%u&bslash;n&quot;
comma
id|NIPQUAD
c_func
(paren
id|clnt-&gt;cl_xprt-&gt;addr.sin_addr.s_addr
)paren
)paren
suffix:semicolon
id|seq_printf
c_func
(paren
id|m
comma
l_string|&quot;protocol: %s&bslash;n&quot;
comma
id|clnt-&gt;cl_xprt-&gt;prot
op_eq
id|IPPROTO_UDP
ques
c_cond
l_string|&quot;udp&quot;
suffix:colon
l_string|&quot;tcp&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|rpc_info_open
id|rpc_info_open
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
(brace
r_struct
id|rpc_clnt
op_star
id|clnt
suffix:semicolon
r_int
id|ret
op_assign
id|single_open
c_func
(paren
id|file
comma
id|rpc_show_info
comma
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ret
)paren
(brace
r_struct
id|seq_file
op_star
id|m
op_assign
id|file-&gt;private_data
suffix:semicolon
id|down
c_func
(paren
op_amp
id|inode-&gt;i_sem
)paren
suffix:semicolon
id|clnt
op_assign
id|RPC_I
c_func
(paren
id|inode
)paren
op_member_access_from_pointer
r_private
suffix:semicolon
r_if
c_cond
(paren
id|clnt
)paren
(brace
id|atomic_inc
c_func
(paren
op_amp
id|clnt-&gt;cl_users
)paren
suffix:semicolon
id|m
op_member_access_from_pointer
r_private
op_assign
id|clnt
suffix:semicolon
)brace
r_else
(brace
id|single_release
c_func
(paren
id|inode
comma
id|file
)paren
suffix:semicolon
id|ret
op_assign
op_minus
id|EINVAL
suffix:semicolon
)brace
id|up
c_func
(paren
op_amp
id|inode-&gt;i_sem
)paren
suffix:semicolon
)brace
r_return
id|ret
suffix:semicolon
)brace
r_static
r_int
DECL|function|rpc_info_release
id|rpc_info_release
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
(brace
r_struct
id|seq_file
op_star
id|m
op_assign
id|file-&gt;private_data
suffix:semicolon
r_struct
id|rpc_clnt
op_star
id|clnt
op_assign
(paren
r_struct
id|rpc_clnt
op_star
)paren
id|m
op_member_access_from_pointer
r_private
suffix:semicolon
r_if
c_cond
(paren
id|clnt
)paren
id|rpc_release_client
c_func
(paren
id|clnt
)paren
suffix:semicolon
r_return
id|single_release
c_func
(paren
id|inode
comma
id|file
)paren
suffix:semicolon
)brace
DECL|variable|rpc_info_operations
r_static
r_struct
id|file_operations
id|rpc_info_operations
op_assign
(brace
dot
id|owner
op_assign
id|THIS_MODULE
comma
dot
id|open
op_assign
id|rpc_info_open
comma
dot
id|read
op_assign
id|seq_read
comma
dot
id|llseek
op_assign
id|seq_lseek
comma
dot
id|release
op_assign
id|rpc_info_release
comma
)brace
suffix:semicolon
multiline_comment|/*&n; * We have a single directory with 1 node in it.&n; */
r_enum
(brace
DECL|enumerator|RPCAUTH_Root
id|RPCAUTH_Root
op_assign
l_int|1
comma
DECL|enumerator|RPCAUTH_lockd
id|RPCAUTH_lockd
comma
DECL|enumerator|RPCAUTH_mount
id|RPCAUTH_mount
comma
DECL|enumerator|RPCAUTH_nfs
id|RPCAUTH_nfs
comma
DECL|enumerator|RPCAUTH_portmap
id|RPCAUTH_portmap
comma
DECL|enumerator|RPCAUTH_statd
id|RPCAUTH_statd
comma
DECL|enumerator|RPCAUTH_RootEOF
id|RPCAUTH_RootEOF
)brace
suffix:semicolon
multiline_comment|/*&n; * Description of fs contents.&n; */
DECL|struct|rpc_filelist
r_struct
id|rpc_filelist
(brace
DECL|member|name
r_char
op_star
id|name
suffix:semicolon
DECL|member|i_fop
r_struct
id|file_operations
op_star
id|i_fop
suffix:semicolon
DECL|member|mode
r_int
id|mode
suffix:semicolon
)brace
suffix:semicolon
DECL|variable|files
r_static
r_struct
id|rpc_filelist
id|files
(braket
)braket
op_assign
(brace
(braket
id|RPCAUTH_lockd
)braket
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;lockd&quot;
comma
dot
id|mode
op_assign
id|S_IFDIR
op_or
id|S_IRUGO
op_or
id|S_IXUGO
comma
)brace
comma
(braket
id|RPCAUTH_mount
)braket
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;mount&quot;
comma
dot
id|mode
op_assign
id|S_IFDIR
op_or
id|S_IRUGO
op_or
id|S_IXUGO
comma
)brace
comma
(braket
id|RPCAUTH_nfs
)braket
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;nfs&quot;
comma
dot
id|mode
op_assign
id|S_IFDIR
op_or
id|S_IRUGO
op_or
id|S_IXUGO
comma
)brace
comma
(braket
id|RPCAUTH_portmap
)braket
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;portmap&quot;
comma
dot
id|mode
op_assign
id|S_IFDIR
op_or
id|S_IRUGO
op_or
id|S_IXUGO
comma
)brace
comma
(braket
id|RPCAUTH_statd
)braket
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;statd&quot;
comma
dot
id|mode
op_assign
id|S_IFDIR
op_or
id|S_IRUGO
op_or
id|S_IXUGO
comma
)brace
comma
)brace
suffix:semicolon
r_enum
(brace
DECL|enumerator|RPCAUTH_info
id|RPCAUTH_info
op_assign
l_int|2
comma
DECL|enumerator|RPCAUTH_EOF
id|RPCAUTH_EOF
)brace
suffix:semicolon
DECL|variable|authfiles
r_static
r_struct
id|rpc_filelist
id|authfiles
(braket
)braket
op_assign
(brace
(braket
id|RPCAUTH_info
)braket
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;info&quot;
comma
dot
id|i_fop
op_assign
op_amp
id|rpc_info_operations
comma
dot
id|mode
op_assign
id|S_IFREG
op_or
id|S_IRUSR
comma
)brace
comma
)brace
suffix:semicolon
r_static
r_int
DECL|function|rpc_get_mount
id|rpc_get_mount
c_func
(paren
r_void
)paren
(brace
r_return
id|simple_pin_fs
c_func
(paren
l_string|&quot;rpc_pipefs&quot;
comma
op_amp
id|rpc_mount
comma
op_amp
id|rpc_mount_count
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|rpc_put_mount
id|rpc_put_mount
c_func
(paren
r_void
)paren
(brace
id|simple_release_fs
c_func
(paren
op_amp
id|rpc_mount
comma
op_amp
id|rpc_mount_count
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|rpc_lookup_parent
id|rpc_lookup_parent
c_func
(paren
r_char
op_star
id|path
comma
r_struct
id|nameidata
op_star
id|nd
)paren
(brace
r_if
c_cond
(paren
id|path
(braket
l_int|0
)braket
op_eq
l_char|&squot;&bslash;0&squot;
)paren
r_return
op_minus
id|ENOENT
suffix:semicolon
r_if
c_cond
(paren
id|rpc_get_mount
c_func
(paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: %s failed to mount &quot;
l_string|&quot;pseudofilesystem &bslash;n&quot;
comma
id|__FILE__
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|nd-&gt;mnt
op_assign
id|mntget
c_func
(paren
id|rpc_mount
)paren
suffix:semicolon
id|nd-&gt;dentry
op_assign
id|dget
c_func
(paren
id|rpc_mount-&gt;mnt_root
)paren
suffix:semicolon
id|nd-&gt;last_type
op_assign
id|LAST_ROOT
suffix:semicolon
id|nd-&gt;flags
op_assign
id|LOOKUP_PARENT
suffix:semicolon
id|nd-&gt;depth
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|path_walk
c_func
(paren
id|path
comma
id|nd
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: %s failed to find path %s&bslash;n&quot;
comma
id|__FILE__
comma
id|__FUNCTION__
comma
id|path
)paren
suffix:semicolon
id|rpc_put_mount
c_func
(paren
)paren
suffix:semicolon
r_return
op_minus
id|ENOENT
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_void
DECL|function|rpc_release_path
id|rpc_release_path
c_func
(paren
r_struct
id|nameidata
op_star
id|nd
)paren
(brace
id|path_release
c_func
(paren
id|nd
)paren
suffix:semicolon
id|rpc_put_mount
c_func
(paren
)paren
suffix:semicolon
)brace
r_static
r_struct
id|inode
op_star
DECL|function|rpc_get_inode
id|rpc_get_inode
c_func
(paren
r_struct
id|super_block
op_star
id|sb
comma
r_int
id|mode
)paren
(brace
r_struct
id|inode
op_star
id|inode
op_assign
id|new_inode
c_func
(paren
id|sb
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|inode
)paren
r_return
l_int|NULL
suffix:semicolon
id|inode-&gt;i_mode
op_assign
id|mode
suffix:semicolon
id|inode-&gt;i_uid
op_assign
id|inode-&gt;i_gid
op_assign
l_int|0
suffix:semicolon
id|inode-&gt;i_blksize
op_assign
id|PAGE_CACHE_SIZE
suffix:semicolon
id|inode-&gt;i_blocks
op_assign
l_int|0
suffix:semicolon
id|inode-&gt;i_atime
op_assign
id|inode-&gt;i_mtime
op_assign
id|inode-&gt;i_ctime
op_assign
id|CURRENT_TIME
suffix:semicolon
r_switch
c_cond
(paren
id|mode
op_amp
id|S_IFMT
)paren
(brace
r_case
id|S_IFDIR
suffix:colon
id|inode-&gt;i_fop
op_assign
op_amp
id|simple_dir_operations
suffix:semicolon
id|inode-&gt;i_op
op_assign
op_amp
id|simple_dir_inode_operations
suffix:semicolon
id|inode-&gt;i_nlink
op_increment
suffix:semicolon
r_default
suffix:colon
r_break
suffix:semicolon
)brace
r_return
id|inode
suffix:semicolon
)brace
multiline_comment|/*&n; * FIXME: This probably has races.&n; */
r_static
r_void
DECL|function|rpc_depopulate
id|rpc_depopulate
c_func
(paren
r_struct
id|dentry
op_star
id|parent
)paren
(brace
r_struct
id|inode
op_star
id|dir
op_assign
id|parent-&gt;d_inode
suffix:semicolon
r_struct
id|list_head
op_star
id|pos
comma
op_star
id|next
suffix:semicolon
r_struct
id|dentry
op_star
id|dentry
comma
op_star
id|dvec
(braket
l_int|10
)braket
suffix:semicolon
r_int
id|n
op_assign
l_int|0
suffix:semicolon
id|down
c_func
(paren
op_amp
id|dir-&gt;i_sem
)paren
suffix:semicolon
id|repeat
suffix:colon
id|spin_lock
c_func
(paren
op_amp
id|dcache_lock
)paren
suffix:semicolon
id|list_for_each_safe
c_func
(paren
id|pos
comma
id|next
comma
op_amp
id|parent-&gt;d_subdirs
)paren
(brace
id|dentry
op_assign
id|list_entry
c_func
(paren
id|pos
comma
r_struct
id|dentry
comma
id|d_child
)paren
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|dentry-&gt;d_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|d_unhashed
c_func
(paren
id|dentry
)paren
)paren
(brace
id|dget_locked
c_func
(paren
id|dentry
)paren
suffix:semicolon
id|__d_drop
c_func
(paren
id|dentry
)paren
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|dentry-&gt;d_lock
)paren
suffix:semicolon
id|dvec
(braket
id|n
op_increment
)braket
op_assign
id|dentry
suffix:semicolon
r_if
c_cond
(paren
id|n
op_eq
id|ARRAY_SIZE
c_func
(paren
id|dvec
)paren
)paren
r_break
suffix:semicolon
)brace
r_else
id|spin_unlock
c_func
(paren
op_amp
id|dentry-&gt;d_lock
)paren
suffix:semicolon
)brace
id|spin_unlock
c_func
(paren
op_amp
id|dcache_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|n
)paren
(brace
r_do
(brace
id|dentry
op_assign
id|dvec
(braket
op_decrement
id|n
)braket
suffix:semicolon
r_if
c_cond
(paren
id|dentry-&gt;d_inode
)paren
(brace
id|rpc_close_pipes
c_func
(paren
id|dentry-&gt;d_inode
)paren
suffix:semicolon
id|rpc_inode_setowner
c_func
(paren
id|dentry-&gt;d_inode
comma
l_int|NULL
)paren
suffix:semicolon
id|simple_unlink
c_func
(paren
id|dir
comma
id|dentry
)paren
suffix:semicolon
)brace
id|dput
c_func
(paren
id|dentry
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
id|n
)paren
suffix:semicolon
r_goto
id|repeat
suffix:semicolon
)brace
id|up
c_func
(paren
op_amp
id|dir-&gt;i_sem
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|rpc_populate
id|rpc_populate
c_func
(paren
r_struct
id|dentry
op_star
id|parent
comma
r_struct
id|rpc_filelist
op_star
id|files
comma
r_int
id|start
comma
r_int
id|eof
)paren
(brace
r_struct
id|inode
op_star
id|inode
comma
op_star
id|dir
op_assign
id|parent-&gt;d_inode
suffix:semicolon
r_void
op_star
r_private
op_assign
id|RPC_I
c_func
(paren
id|dir
)paren
op_member_access_from_pointer
r_private
suffix:semicolon
r_struct
id|dentry
op_star
id|dentry
suffix:semicolon
r_int
id|mode
comma
id|i
suffix:semicolon
id|down
c_func
(paren
op_amp
id|dir-&gt;i_sem
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|start
suffix:semicolon
id|i
OL
id|eof
suffix:semicolon
id|i
op_increment
)paren
(brace
id|dentry
op_assign
id|d_alloc_name
c_func
(paren
id|parent
comma
id|files
(braket
id|i
)braket
dot
id|name
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dentry
)paren
r_goto
id|out_bad
suffix:semicolon
id|mode
op_assign
id|files
(braket
id|i
)braket
dot
id|mode
suffix:semicolon
id|inode
op_assign
id|rpc_get_inode
c_func
(paren
id|dir-&gt;i_sb
comma
id|mode
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|inode
)paren
(brace
id|dput
c_func
(paren
id|dentry
)paren
suffix:semicolon
r_goto
id|out_bad
suffix:semicolon
)brace
id|inode-&gt;i_ino
op_assign
id|i
suffix:semicolon
r_if
c_cond
(paren
id|files
(braket
id|i
)braket
dot
id|i_fop
)paren
id|inode-&gt;i_fop
op_assign
id|files
(braket
id|i
)braket
dot
id|i_fop
suffix:semicolon
r_if
c_cond
(paren
r_private
)paren
id|rpc_inode_setowner
c_func
(paren
id|inode
comma
r_private
)paren
suffix:semicolon
r_if
c_cond
(paren
id|S_ISDIR
c_func
(paren
id|mode
)paren
)paren
id|dir-&gt;i_nlink
op_increment
suffix:semicolon
id|d_add
c_func
(paren
id|dentry
comma
id|inode
)paren
suffix:semicolon
)brace
id|up
c_func
(paren
op_amp
id|dir-&gt;i_sem
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|out_bad
suffix:colon
id|up
c_func
(paren
op_amp
id|dir-&gt;i_sem
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: %s failed to populate directory %s&bslash;n&quot;
comma
id|__FILE__
comma
id|__FUNCTION__
comma
id|parent-&gt;d_name.name
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
r_static
r_int
DECL|function|__rpc_mkdir
id|__rpc_mkdir
c_func
(paren
r_struct
id|inode
op_star
id|dir
comma
r_struct
id|dentry
op_star
id|dentry
)paren
(brace
r_struct
id|inode
op_star
id|inode
suffix:semicolon
id|inode
op_assign
id|rpc_get_inode
c_func
(paren
id|dir-&gt;i_sb
comma
id|S_IFDIR
op_or
id|S_IRUSR
op_or
id|S_IXUSR
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|inode
)paren
r_goto
id|out_err
suffix:semicolon
id|inode-&gt;i_ino
op_assign
id|iunique
c_func
(paren
id|dir-&gt;i_sb
comma
l_int|100
)paren
suffix:semicolon
id|d_instantiate
c_func
(paren
id|dentry
comma
id|inode
)paren
suffix:semicolon
id|dir-&gt;i_nlink
op_increment
suffix:semicolon
id|inode_dir_notify
c_func
(paren
id|dir
comma
id|DN_CREATE
)paren
suffix:semicolon
id|rpc_get_mount
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|out_err
suffix:colon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: %s failed to allocate inode for dentry %s&bslash;n&quot;
comma
id|__FILE__
comma
id|__FUNCTION__
comma
id|dentry-&gt;d_name.name
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
r_static
r_int
DECL|function|__rpc_rmdir
id|__rpc_rmdir
c_func
(paren
r_struct
id|inode
op_star
id|dir
comma
r_struct
id|dentry
op_star
id|dentry
)paren
(brace
r_int
id|error
suffix:semicolon
id|shrink_dcache_parent
c_func
(paren
id|dentry
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dentry-&gt;d_inode
)paren
(brace
id|rpc_close_pipes
c_func
(paren
id|dentry-&gt;d_inode
)paren
suffix:semicolon
id|rpc_inode_setowner
c_func
(paren
id|dentry-&gt;d_inode
comma
l_int|NULL
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|error
op_assign
id|simple_rmdir
c_func
(paren
id|dir
comma
id|dentry
)paren
)paren
op_ne
l_int|0
)paren
r_return
id|error
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|error
)paren
(brace
id|inode_dir_notify
c_func
(paren
id|dir
comma
id|DN_DELETE
)paren
suffix:semicolon
id|d_drop
c_func
(paren
id|dentry
)paren
suffix:semicolon
id|rpc_put_mount
c_func
(paren
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_struct
id|dentry
op_star
DECL|function|rpc_lookup_negative
id|rpc_lookup_negative
c_func
(paren
r_char
op_star
id|path
comma
r_struct
id|nameidata
op_star
id|nd
)paren
(brace
r_struct
id|dentry
op_star
id|dentry
suffix:semicolon
r_struct
id|inode
op_star
id|dir
suffix:semicolon
r_int
id|error
suffix:semicolon
r_if
c_cond
(paren
(paren
id|error
op_assign
id|rpc_lookup_parent
c_func
(paren
id|path
comma
id|nd
)paren
)paren
op_ne
l_int|0
)paren
r_return
id|ERR_PTR
c_func
(paren
id|error
)paren
suffix:semicolon
id|dir
op_assign
id|nd-&gt;dentry-&gt;d_inode
suffix:semicolon
id|down
c_func
(paren
op_amp
id|dir-&gt;i_sem
)paren
suffix:semicolon
id|dentry
op_assign
id|lookup_hash
c_func
(paren
op_amp
id|nd-&gt;last
comma
id|nd-&gt;dentry
)paren
suffix:semicolon
r_if
c_cond
(paren
id|IS_ERR
c_func
(paren
id|dentry
)paren
)paren
r_goto
id|out_err
suffix:semicolon
r_if
c_cond
(paren
id|dentry-&gt;d_inode
)paren
(brace
id|dput
c_func
(paren
id|dentry
)paren
suffix:semicolon
id|dentry
op_assign
id|ERR_PTR
c_func
(paren
op_minus
id|EEXIST
)paren
suffix:semicolon
r_goto
id|out_err
suffix:semicolon
)brace
r_return
id|dentry
suffix:semicolon
id|out_err
suffix:colon
id|up
c_func
(paren
op_amp
id|dir-&gt;i_sem
)paren
suffix:semicolon
id|rpc_release_path
c_func
(paren
id|nd
)paren
suffix:semicolon
r_return
id|dentry
suffix:semicolon
)brace
r_struct
id|dentry
op_star
DECL|function|rpc_mkdir
id|rpc_mkdir
c_func
(paren
r_char
op_star
id|path
comma
r_struct
id|rpc_clnt
op_star
id|rpc_client
)paren
(brace
r_struct
id|nameidata
id|nd
suffix:semicolon
r_struct
id|dentry
op_star
id|dentry
suffix:semicolon
r_struct
id|inode
op_star
id|dir
suffix:semicolon
r_int
id|error
suffix:semicolon
id|dentry
op_assign
id|rpc_lookup_negative
c_func
(paren
id|path
comma
op_amp
id|nd
)paren
suffix:semicolon
r_if
c_cond
(paren
id|IS_ERR
c_func
(paren
id|dentry
)paren
)paren
r_return
id|dentry
suffix:semicolon
id|dir
op_assign
id|nd.dentry-&gt;d_inode
suffix:semicolon
r_if
c_cond
(paren
(paren
id|error
op_assign
id|__rpc_mkdir
c_func
(paren
id|dir
comma
id|dentry
)paren
)paren
op_ne
l_int|0
)paren
r_goto
id|err_dput
suffix:semicolon
id|RPC_I
c_func
(paren
id|dentry-&gt;d_inode
)paren
op_member_access_from_pointer
r_private
op_assign
id|rpc_client
suffix:semicolon
id|error
op_assign
id|rpc_populate
c_func
(paren
id|dentry
comma
id|authfiles
comma
id|RPCAUTH_info
comma
id|RPCAUTH_EOF
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
r_goto
id|err_depopulate
suffix:semicolon
id|out
suffix:colon
id|up
c_func
(paren
op_amp
id|dir-&gt;i_sem
)paren
suffix:semicolon
id|rpc_release_path
c_func
(paren
op_amp
id|nd
)paren
suffix:semicolon
r_return
id|dentry
suffix:semicolon
id|err_depopulate
suffix:colon
id|rpc_depopulate
c_func
(paren
id|dentry
)paren
suffix:semicolon
id|__rpc_rmdir
c_func
(paren
id|dir
comma
id|dentry
)paren
suffix:semicolon
id|err_dput
suffix:colon
id|dput
c_func
(paren
id|dentry
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: %s() failed to create directory %s (errno = %d)&bslash;n&quot;
comma
id|__FILE__
comma
id|__FUNCTION__
comma
id|path
comma
id|error
)paren
suffix:semicolon
id|dentry
op_assign
id|ERR_PTR
c_func
(paren
id|error
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_int
DECL|function|rpc_rmdir
id|rpc_rmdir
c_func
(paren
r_char
op_star
id|path
)paren
(brace
r_struct
id|nameidata
id|nd
suffix:semicolon
r_struct
id|dentry
op_star
id|dentry
suffix:semicolon
r_struct
id|inode
op_star
id|dir
suffix:semicolon
r_int
id|error
suffix:semicolon
r_if
c_cond
(paren
(paren
id|error
op_assign
id|rpc_lookup_parent
c_func
(paren
id|path
comma
op_amp
id|nd
)paren
)paren
op_ne
l_int|0
)paren
r_return
id|error
suffix:semicolon
id|dir
op_assign
id|nd.dentry-&gt;d_inode
suffix:semicolon
id|down
c_func
(paren
op_amp
id|dir-&gt;i_sem
)paren
suffix:semicolon
id|dentry
op_assign
id|lookup_hash
c_func
(paren
op_amp
id|nd.last
comma
id|nd.dentry
)paren
suffix:semicolon
r_if
c_cond
(paren
id|IS_ERR
c_func
(paren
id|dentry
)paren
)paren
(brace
id|error
op_assign
id|PTR_ERR
c_func
(paren
id|dentry
)paren
suffix:semicolon
r_goto
id|out_release
suffix:semicolon
)brace
id|rpc_depopulate
c_func
(paren
id|dentry
)paren
suffix:semicolon
id|error
op_assign
id|__rpc_rmdir
c_func
(paren
id|dir
comma
id|dentry
)paren
suffix:semicolon
id|dput
c_func
(paren
id|dentry
)paren
suffix:semicolon
id|out_release
suffix:colon
id|up
c_func
(paren
op_amp
id|dir-&gt;i_sem
)paren
suffix:semicolon
id|rpc_release_path
c_func
(paren
op_amp
id|nd
)paren
suffix:semicolon
r_return
id|error
suffix:semicolon
)brace
r_struct
id|dentry
op_star
DECL|function|rpc_mkpipe
id|rpc_mkpipe
c_func
(paren
r_char
op_star
id|path
comma
r_void
op_star
r_private
comma
r_struct
id|rpc_pipe_ops
op_star
id|ops
comma
r_int
id|flags
)paren
(brace
r_struct
id|nameidata
id|nd
suffix:semicolon
r_struct
id|dentry
op_star
id|dentry
suffix:semicolon
r_struct
id|inode
op_star
id|dir
comma
op_star
id|inode
suffix:semicolon
r_struct
id|rpc_inode
op_star
id|rpci
suffix:semicolon
id|dentry
op_assign
id|rpc_lookup_negative
c_func
(paren
id|path
comma
op_amp
id|nd
)paren
suffix:semicolon
r_if
c_cond
(paren
id|IS_ERR
c_func
(paren
id|dentry
)paren
)paren
r_return
id|dentry
suffix:semicolon
id|dir
op_assign
id|nd.dentry-&gt;d_inode
suffix:semicolon
id|inode
op_assign
id|rpc_get_inode
c_func
(paren
id|dir-&gt;i_sb
comma
id|S_IFSOCK
op_or
id|S_IRUSR
op_or
id|S_IWUSR
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|inode
)paren
r_goto
id|err_dput
suffix:semicolon
id|inode-&gt;i_ino
op_assign
id|iunique
c_func
(paren
id|dir-&gt;i_sb
comma
l_int|100
)paren
suffix:semicolon
id|inode-&gt;i_fop
op_assign
op_amp
id|rpc_pipe_fops
suffix:semicolon
id|d_instantiate
c_func
(paren
id|dentry
comma
id|inode
)paren
suffix:semicolon
id|rpci
op_assign
id|RPC_I
c_func
(paren
id|inode
)paren
suffix:semicolon
id|rpci
op_member_access_from_pointer
r_private
op_assign
r_private
suffix:semicolon
id|rpci-&gt;flags
op_assign
id|flags
suffix:semicolon
id|rpci-&gt;ops
op_assign
id|ops
suffix:semicolon
id|inode_dir_notify
c_func
(paren
id|dir
comma
id|DN_CREATE
)paren
suffix:semicolon
id|out
suffix:colon
id|up
c_func
(paren
op_amp
id|dir-&gt;i_sem
)paren
suffix:semicolon
id|rpc_release_path
c_func
(paren
op_amp
id|nd
)paren
suffix:semicolon
r_return
id|dentry
suffix:semicolon
id|err_dput
suffix:colon
id|dput
c_func
(paren
id|dentry
)paren
suffix:semicolon
id|dentry
op_assign
id|ERR_PTR
c_func
(paren
op_minus
id|ENOMEM
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: %s() failed to create pipe %s (errno = %d)&bslash;n&quot;
comma
id|__FILE__
comma
id|__FUNCTION__
comma
id|path
comma
op_minus
id|ENOMEM
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_int
DECL|function|rpc_unlink
id|rpc_unlink
c_func
(paren
r_char
op_star
id|path
)paren
(brace
r_struct
id|nameidata
id|nd
suffix:semicolon
r_struct
id|dentry
op_star
id|dentry
suffix:semicolon
r_struct
id|inode
op_star
id|dir
suffix:semicolon
r_int
id|error
suffix:semicolon
r_if
c_cond
(paren
(paren
id|error
op_assign
id|rpc_lookup_parent
c_func
(paren
id|path
comma
op_amp
id|nd
)paren
)paren
op_ne
l_int|0
)paren
r_return
id|error
suffix:semicolon
id|dir
op_assign
id|nd.dentry-&gt;d_inode
suffix:semicolon
id|down
c_func
(paren
op_amp
id|dir-&gt;i_sem
)paren
suffix:semicolon
id|dentry
op_assign
id|lookup_hash
c_func
(paren
op_amp
id|nd.last
comma
id|nd.dentry
)paren
suffix:semicolon
r_if
c_cond
(paren
id|IS_ERR
c_func
(paren
id|dentry
)paren
)paren
(brace
id|error
op_assign
id|PTR_ERR
c_func
(paren
id|dentry
)paren
suffix:semicolon
r_goto
id|out_release
suffix:semicolon
)brace
id|d_drop
c_func
(paren
id|dentry
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dentry-&gt;d_inode
)paren
(brace
id|rpc_close_pipes
c_func
(paren
id|dentry-&gt;d_inode
)paren
suffix:semicolon
id|rpc_inode_setowner
c_func
(paren
id|dentry-&gt;d_inode
comma
l_int|NULL
)paren
suffix:semicolon
id|error
op_assign
id|simple_unlink
c_func
(paren
id|dir
comma
id|dentry
)paren
suffix:semicolon
)brace
id|dput
c_func
(paren
id|dentry
)paren
suffix:semicolon
id|inode_dir_notify
c_func
(paren
id|dir
comma
id|DN_DELETE
)paren
suffix:semicolon
id|out_release
suffix:colon
id|up
c_func
(paren
op_amp
id|dir-&gt;i_sem
)paren
suffix:semicolon
id|rpc_release_path
c_func
(paren
op_amp
id|nd
)paren
suffix:semicolon
r_return
id|error
suffix:semicolon
)brace
multiline_comment|/*&n; * populate the filesystem&n; */
DECL|variable|s_ops
r_static
r_struct
id|super_operations
id|s_ops
op_assign
(brace
dot
id|alloc_inode
op_assign
id|rpc_alloc_inode
comma
dot
id|destroy_inode
op_assign
id|rpc_destroy_inode
comma
dot
id|statfs
op_assign
id|simple_statfs
comma
)brace
suffix:semicolon
DECL|macro|RPCAUTH_GSSMAGIC
mdefine_line|#define RPCAUTH_GSSMAGIC 0x67596969
r_static
r_int
DECL|function|rpc_fill_super
id|rpc_fill_super
c_func
(paren
r_struct
id|super_block
op_star
id|sb
comma
r_void
op_star
id|data
comma
r_int
id|silent
)paren
(brace
r_struct
id|inode
op_star
id|inode
suffix:semicolon
r_struct
id|dentry
op_star
id|root
suffix:semicolon
id|sb-&gt;s_blocksize
op_assign
id|PAGE_CACHE_SIZE
suffix:semicolon
id|sb-&gt;s_blocksize_bits
op_assign
id|PAGE_CACHE_SHIFT
suffix:semicolon
id|sb-&gt;s_magic
op_assign
id|RPCAUTH_GSSMAGIC
suffix:semicolon
id|sb-&gt;s_op
op_assign
op_amp
id|s_ops
suffix:semicolon
id|sb-&gt;s_time_gran
op_assign
l_int|1
suffix:semicolon
id|inode
op_assign
id|rpc_get_inode
c_func
(paren
id|sb
comma
id|S_IFDIR
op_or
l_int|0755
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|inode
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|root
op_assign
id|d_alloc_root
c_func
(paren
id|inode
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|root
)paren
(brace
id|iput
c_func
(paren
id|inode
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
r_if
c_cond
(paren
id|rpc_populate
c_func
(paren
id|root
comma
id|files
comma
id|RPCAUTH_Root
op_plus
l_int|1
comma
id|RPCAUTH_RootEOF
)paren
)paren
r_goto
id|out
suffix:semicolon
id|sb-&gt;s_root
op_assign
id|root
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|out
suffix:colon
id|d_genocide
c_func
(paren
id|root
)paren
suffix:semicolon
id|dput
c_func
(paren
id|root
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
r_static
r_struct
id|super_block
op_star
DECL|function|rpc_get_sb
id|rpc_get_sb
c_func
(paren
r_struct
id|file_system_type
op_star
id|fs_type
comma
r_int
id|flags
comma
r_const
r_char
op_star
id|dev_name
comma
r_void
op_star
id|data
)paren
(brace
r_return
id|get_sb_single
c_func
(paren
id|fs_type
comma
id|flags
comma
id|data
comma
id|rpc_fill_super
)paren
suffix:semicolon
)brace
DECL|variable|rpc_pipe_fs_type
r_static
r_struct
id|file_system_type
id|rpc_pipe_fs_type
op_assign
(brace
dot
id|owner
op_assign
id|THIS_MODULE
comma
dot
id|name
op_assign
l_string|&quot;rpc_pipefs&quot;
comma
dot
id|get_sb
op_assign
id|rpc_get_sb
comma
dot
id|kill_sb
op_assign
id|kill_litter_super
comma
)brace
suffix:semicolon
r_static
r_void
DECL|function|init_once
id|init_once
c_func
(paren
r_void
op_star
id|foo
comma
id|kmem_cache_t
op_star
id|cachep
comma
r_int
r_int
id|flags
)paren
(brace
r_struct
id|rpc_inode
op_star
id|rpci
op_assign
(paren
r_struct
id|rpc_inode
op_star
)paren
id|foo
suffix:semicolon
r_if
c_cond
(paren
(paren
id|flags
op_amp
(paren
id|SLAB_CTOR_VERIFY
op_or
id|SLAB_CTOR_CONSTRUCTOR
)paren
)paren
op_eq
id|SLAB_CTOR_CONSTRUCTOR
)paren
(brace
id|inode_init_once
c_func
(paren
op_amp
id|rpci-&gt;vfs_inode
)paren
suffix:semicolon
id|rpci
op_member_access_from_pointer
r_private
op_assign
l_int|NULL
suffix:semicolon
id|rpci-&gt;nreaders
op_assign
l_int|0
suffix:semicolon
id|rpci-&gt;nwriters
op_assign
l_int|0
suffix:semicolon
id|INIT_LIST_HEAD
c_func
(paren
op_amp
id|rpci-&gt;in_upcall
)paren
suffix:semicolon
id|INIT_LIST_HEAD
c_func
(paren
op_amp
id|rpci-&gt;pipe
)paren
suffix:semicolon
id|rpci-&gt;pipelen
op_assign
l_int|0
suffix:semicolon
id|init_waitqueue_head
c_func
(paren
op_amp
id|rpci-&gt;waitq
)paren
suffix:semicolon
id|INIT_WORK
c_func
(paren
op_amp
id|rpci-&gt;queue_timeout
comma
id|rpc_timeout_upcall_queue
comma
id|rpci
)paren
suffix:semicolon
id|rpci-&gt;ops
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
DECL|function|register_rpc_pipefs
r_int
id|register_rpc_pipefs
c_func
(paren
r_void
)paren
(brace
id|rpc_inode_cachep
op_assign
id|kmem_cache_create
c_func
(paren
l_string|&quot;rpc_inode_cache&quot;
comma
r_sizeof
(paren
r_struct
id|rpc_inode
)paren
comma
l_int|0
comma
id|SLAB_HWCACHE_ALIGN
op_or
id|SLAB_RECLAIM_ACCOUNT
comma
id|init_once
comma
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|rpc_inode_cachep
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|register_filesystem
c_func
(paren
op_amp
id|rpc_pipe_fs_type
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|unregister_rpc_pipefs
r_void
id|unregister_rpc_pipefs
c_func
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
id|kmem_cache_destroy
c_func
(paren
id|rpc_inode_cachep
)paren
)paren
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;RPC: unable to free inode cache&bslash;n&quot;
)paren
suffix:semicolon
id|unregister_filesystem
c_func
(paren
op_amp
id|rpc_pipe_fs_type
)paren
suffix:semicolon
)brace
eof
