multiline_comment|/* &n;   BlueZ - Bluetooth protocol stack for Linux&n;   Copyright (C) 2000-2001 Qualcomm Incorporated&n;&n;   Written 2000,2001 by Maxim Krasnyansky &lt;maxk@qualcomm.com&gt;&n;&n;   This program is free software; you can redistribute it and/or modify&n;   it under the terms of the GNU General Public License version 2 as&n;   published by the Free Software Foundation;&n;&n;   THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS&n;   OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,&n;   FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT OF THIRD PARTY RIGHTS.&n;   IN NO EVENT SHALL THE COPYRIGHT HOLDER(S) AND AUTHOR(S) BE LIABLE FOR ANY&n;   CLAIM, OR ANY SPECIAL INDIRECT OR CONSEQUENTIAL DAMAGES, OR ANY DAMAGES &n;   WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN &n;   ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF &n;   OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.&n;&n;   ALL LIABILITY, INCLUDING LIABILITY FOR INFRINGEMENT OF ANY PATENTS, &n;   COPYRIGHTS, TRADEMARKS OR OTHER RIGHTS, RELATING TO USE OF THIS &n;   SOFTWARE IS DISCLAIMED.&n;*/
multiline_comment|/* Bluetooth HCI event handling. */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/major.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/poll.h&gt;
macro_line|#include &lt;linux/fcntl.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/skbuff.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/notifier.h&gt;
macro_line|#include &lt;net/sock.h&gt;
macro_line|#include &lt;asm/system.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;asm/unaligned.h&gt;
macro_line|#include &lt;net/bluetooth/bluetooth.h&gt;
macro_line|#include &lt;net/bluetooth/hci_core.h&gt;
macro_line|#ifndef CONFIG_BT_HCI_CORE_DEBUG
DECL|macro|BT_DBG
macro_line|#undef  BT_DBG
DECL|macro|BT_DBG
mdefine_line|#define BT_DBG(D...)
macro_line|#endif
multiline_comment|/* Handle HCI Event packets */
multiline_comment|/* Command Complete OGF LINK_CTL  */
DECL|function|hci_cc_link_ctl
r_static
r_void
id|hci_cc_link_ctl
c_func
(paren
r_struct
id|hci_dev
op_star
id|hdev
comma
id|__u16
id|ocf
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
id|__u8
id|status
suffix:semicolon
id|BT_DBG
c_func
(paren
l_string|&quot;%s ocf 0x%x&quot;
comma
id|hdev-&gt;name
comma
id|ocf
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|ocf
)paren
(brace
r_case
id|OCF_INQUIRY_CANCEL
suffix:colon
id|status
op_assign
op_star
(paren
(paren
id|__u8
op_star
)paren
id|skb-&gt;data
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
)paren
(brace
id|BT_DBG
c_func
(paren
l_string|&quot;%s Inquiry cancel error: status 0x%x&quot;
comma
id|hdev-&gt;name
comma
id|status
)paren
suffix:semicolon
)brace
r_else
(brace
id|clear_bit
c_func
(paren
id|HCI_INQUIRY
comma
op_amp
id|hdev-&gt;flags
)paren
suffix:semicolon
id|hci_req_complete
c_func
(paren
id|hdev
comma
id|status
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_default
suffix:colon
id|BT_DBG
c_func
(paren
l_string|&quot;%s Command complete: ogf LINK_CTL ocf %x&quot;
comma
id|hdev-&gt;name
comma
id|ocf
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
multiline_comment|/* Command Complete OGF LINK_POLICY  */
DECL|function|hci_cc_link_policy
r_static
r_void
id|hci_cc_link_policy
c_func
(paren
r_struct
id|hci_dev
op_star
id|hdev
comma
id|__u16
id|ocf
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|hci_conn
op_star
id|conn
suffix:semicolon
r_struct
id|hci_rp_role_discovery
op_star
id|rd
suffix:semicolon
id|BT_DBG
c_func
(paren
l_string|&quot;%s ocf 0x%x&quot;
comma
id|hdev-&gt;name
comma
id|ocf
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|ocf
)paren
(brace
r_case
id|OCF_ROLE_DISCOVERY
suffix:colon
id|rd
op_assign
(paren
r_void
op_star
)paren
id|skb-&gt;data
suffix:semicolon
r_if
c_cond
(paren
id|rd-&gt;status
)paren
r_break
suffix:semicolon
id|hci_dev_lock
c_func
(paren
id|hdev
)paren
suffix:semicolon
id|conn
op_assign
id|hci_conn_hash_lookup_handle
c_func
(paren
id|hdev
comma
id|__le16_to_cpu
c_func
(paren
id|rd-&gt;handle
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|conn
)paren
(brace
r_if
c_cond
(paren
id|rd-&gt;role
)paren
id|conn-&gt;link_mode
op_and_assign
op_complement
id|HCI_LM_MASTER
suffix:semicolon
r_else
id|conn-&gt;link_mode
op_or_assign
id|HCI_LM_MASTER
suffix:semicolon
)brace
id|hci_dev_unlock
c_func
(paren
id|hdev
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|BT_DBG
c_func
(paren
l_string|&quot;%s: Command complete: ogf LINK_POLICY ocf %x&quot;
comma
id|hdev-&gt;name
comma
id|ocf
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
multiline_comment|/* Command Complete OGF HOST_CTL  */
DECL|function|hci_cc_host_ctl
r_static
r_void
id|hci_cc_host_ctl
c_func
(paren
r_struct
id|hci_dev
op_star
id|hdev
comma
id|__u16
id|ocf
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
id|__u8
id|status
comma
id|param
suffix:semicolon
id|__u16
id|setting
suffix:semicolon
r_struct
id|hci_rp_read_voice_setting
op_star
id|vs
suffix:semicolon
r_void
op_star
id|sent
suffix:semicolon
id|BT_DBG
c_func
(paren
l_string|&quot;%s ocf 0x%x&quot;
comma
id|hdev-&gt;name
comma
id|ocf
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|ocf
)paren
(brace
r_case
id|OCF_RESET
suffix:colon
id|status
op_assign
op_star
(paren
(paren
id|__u8
op_star
)paren
id|skb-&gt;data
)paren
suffix:semicolon
id|hci_req_complete
c_func
(paren
id|hdev
comma
id|status
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OCF_SET_EVENT_FLT
suffix:colon
id|status
op_assign
op_star
(paren
(paren
id|__u8
op_star
)paren
id|skb-&gt;data
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
)paren
(brace
id|BT_DBG
c_func
(paren
l_string|&quot;%s SET_EVENT_FLT failed %d&quot;
comma
id|hdev-&gt;name
comma
id|status
)paren
suffix:semicolon
)brace
r_else
(brace
id|BT_DBG
c_func
(paren
l_string|&quot;%s SET_EVENT_FLT succeseful&quot;
comma
id|hdev-&gt;name
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|OCF_WRITE_AUTH_ENABLE
suffix:colon
id|sent
op_assign
id|hci_sent_cmd_data
c_func
(paren
id|hdev
comma
id|OGF_HOST_CTL
comma
id|OCF_WRITE_AUTH_ENABLE
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sent
)paren
r_break
suffix:semicolon
id|status
op_assign
op_star
(paren
(paren
id|__u8
op_star
)paren
id|skb-&gt;data
)paren
suffix:semicolon
id|param
op_assign
op_star
(paren
(paren
id|__u8
op_star
)paren
id|sent
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|status
)paren
(brace
r_if
c_cond
(paren
id|param
op_eq
id|AUTH_ENABLED
)paren
id|set_bit
c_func
(paren
id|HCI_AUTH
comma
op_amp
id|hdev-&gt;flags
)paren
suffix:semicolon
r_else
id|clear_bit
c_func
(paren
id|HCI_AUTH
comma
op_amp
id|hdev-&gt;flags
)paren
suffix:semicolon
)brace
id|hci_req_complete
c_func
(paren
id|hdev
comma
id|status
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OCF_WRITE_ENCRYPT_MODE
suffix:colon
id|sent
op_assign
id|hci_sent_cmd_data
c_func
(paren
id|hdev
comma
id|OGF_HOST_CTL
comma
id|OCF_WRITE_ENCRYPT_MODE
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sent
)paren
r_break
suffix:semicolon
id|status
op_assign
op_star
(paren
(paren
id|__u8
op_star
)paren
id|skb-&gt;data
)paren
suffix:semicolon
id|param
op_assign
op_star
(paren
(paren
id|__u8
op_star
)paren
id|sent
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|status
)paren
(brace
r_if
c_cond
(paren
id|param
)paren
id|set_bit
c_func
(paren
id|HCI_ENCRYPT
comma
op_amp
id|hdev-&gt;flags
)paren
suffix:semicolon
r_else
id|clear_bit
c_func
(paren
id|HCI_ENCRYPT
comma
op_amp
id|hdev-&gt;flags
)paren
suffix:semicolon
)brace
id|hci_req_complete
c_func
(paren
id|hdev
comma
id|status
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OCF_WRITE_CA_TIMEOUT
suffix:colon
id|status
op_assign
op_star
(paren
(paren
id|__u8
op_star
)paren
id|skb-&gt;data
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
)paren
(brace
id|BT_DBG
c_func
(paren
l_string|&quot;%s OCF_WRITE_CA_TIMEOUT failed %d&quot;
comma
id|hdev-&gt;name
comma
id|status
)paren
suffix:semicolon
)brace
r_else
(brace
id|BT_DBG
c_func
(paren
l_string|&quot;%s OCF_WRITE_CA_TIMEOUT succeseful&quot;
comma
id|hdev-&gt;name
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|OCF_WRITE_PG_TIMEOUT
suffix:colon
id|status
op_assign
op_star
(paren
(paren
id|__u8
op_star
)paren
id|skb-&gt;data
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
)paren
(brace
id|BT_DBG
c_func
(paren
l_string|&quot;%s OCF_WRITE_PG_TIMEOUT failed %d&quot;
comma
id|hdev-&gt;name
comma
id|status
)paren
suffix:semicolon
)brace
r_else
(brace
id|BT_DBG
c_func
(paren
l_string|&quot;%s: OCF_WRITE_PG_TIMEOUT succeseful&quot;
comma
id|hdev-&gt;name
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|OCF_WRITE_SCAN_ENABLE
suffix:colon
id|sent
op_assign
id|hci_sent_cmd_data
c_func
(paren
id|hdev
comma
id|OGF_HOST_CTL
comma
id|OCF_WRITE_SCAN_ENABLE
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sent
)paren
r_break
suffix:semicolon
id|status
op_assign
op_star
(paren
(paren
id|__u8
op_star
)paren
id|skb-&gt;data
)paren
suffix:semicolon
id|param
op_assign
op_star
(paren
(paren
id|__u8
op_star
)paren
id|sent
)paren
suffix:semicolon
id|BT_DBG
c_func
(paren
l_string|&quot;param 0x%x&quot;
comma
id|param
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|status
)paren
(brace
id|clear_bit
c_func
(paren
id|HCI_PSCAN
comma
op_amp
id|hdev-&gt;flags
)paren
suffix:semicolon
id|clear_bit
c_func
(paren
id|HCI_ISCAN
comma
op_amp
id|hdev-&gt;flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|param
op_amp
id|SCAN_INQUIRY
)paren
id|set_bit
c_func
(paren
id|HCI_ISCAN
comma
op_amp
id|hdev-&gt;flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|param
op_amp
id|SCAN_PAGE
)paren
id|set_bit
c_func
(paren
id|HCI_PSCAN
comma
op_amp
id|hdev-&gt;flags
)paren
suffix:semicolon
)brace
id|hci_req_complete
c_func
(paren
id|hdev
comma
id|status
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OCF_READ_VOICE_SETTING
suffix:colon
id|vs
op_assign
(paren
r_struct
id|hci_rp_read_voice_setting
op_star
)paren
id|skb-&gt;data
suffix:semicolon
r_if
c_cond
(paren
id|vs-&gt;status
)paren
(brace
id|BT_DBG
c_func
(paren
l_string|&quot;%s READ_VOICE_SETTING failed %d&quot;
comma
id|hdev-&gt;name
comma
id|vs-&gt;status
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|setting
op_assign
id|__le16_to_cpu
c_func
(paren
id|vs-&gt;voice_setting
)paren
suffix:semicolon
r_if
c_cond
(paren
id|hdev-&gt;voice_setting
op_ne
id|setting
)paren
(brace
id|hdev-&gt;voice_setting
op_assign
id|setting
suffix:semicolon
id|BT_DBG
c_func
(paren
l_string|&quot;%s: voice setting 0x%04x&quot;
comma
id|hdev-&gt;name
comma
id|setting
)paren
suffix:semicolon
r_if
c_cond
(paren
id|hdev-&gt;notify
)paren
id|hdev
op_member_access_from_pointer
id|notify
c_func
(paren
id|hdev
comma
id|HCI_NOTIFY_VOICE_SETTING
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|OCF_WRITE_VOICE_SETTING
suffix:colon
id|sent
op_assign
id|hci_sent_cmd_data
c_func
(paren
id|hdev
comma
id|OGF_HOST_CTL
comma
id|OCF_WRITE_VOICE_SETTING
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sent
)paren
r_break
suffix:semicolon
id|status
op_assign
op_star
(paren
(paren
id|__u8
op_star
)paren
id|skb-&gt;data
)paren
suffix:semicolon
id|setting
op_assign
id|__le16_to_cpu
c_func
(paren
id|get_unaligned
c_func
(paren
(paren
id|__u16
op_star
)paren
id|sent
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|status
op_logical_and
id|hdev-&gt;voice_setting
op_ne
id|setting
)paren
(brace
id|hdev-&gt;voice_setting
op_assign
id|setting
suffix:semicolon
id|BT_DBG
c_func
(paren
l_string|&quot;%s: voice setting 0x%04x&quot;
comma
id|hdev-&gt;name
comma
id|setting
)paren
suffix:semicolon
r_if
c_cond
(paren
id|hdev-&gt;notify
)paren
id|hdev
op_member_access_from_pointer
id|notify
c_func
(paren
id|hdev
comma
id|HCI_NOTIFY_VOICE_SETTING
)paren
suffix:semicolon
)brace
id|hci_req_complete
c_func
(paren
id|hdev
comma
id|status
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OCF_HOST_BUFFER_SIZE
suffix:colon
id|status
op_assign
op_star
(paren
(paren
id|__u8
op_star
)paren
id|skb-&gt;data
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
)paren
(brace
id|BT_DBG
c_func
(paren
l_string|&quot;%s OCF_BUFFER_SIZE failed %d&quot;
comma
id|hdev-&gt;name
comma
id|status
)paren
suffix:semicolon
id|hci_req_complete
c_func
(paren
id|hdev
comma
id|status
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_default
suffix:colon
id|BT_DBG
c_func
(paren
l_string|&quot;%s Command complete: ogf HOST_CTL ocf %x&quot;
comma
id|hdev-&gt;name
comma
id|ocf
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
multiline_comment|/* Command Complete OGF INFO_PARAM  */
DECL|function|hci_cc_info_param
r_static
r_void
id|hci_cc_info_param
c_func
(paren
r_struct
id|hci_dev
op_star
id|hdev
comma
id|__u16
id|ocf
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|hci_rp_read_loc_features
op_star
id|lf
suffix:semicolon
r_struct
id|hci_rp_read_buffer_size
op_star
id|bs
suffix:semicolon
r_struct
id|hci_rp_read_bd_addr
op_star
id|ba
suffix:semicolon
id|BT_DBG
c_func
(paren
l_string|&quot;%s ocf 0x%x&quot;
comma
id|hdev-&gt;name
comma
id|ocf
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|ocf
)paren
(brace
r_case
id|OCF_READ_LOCAL_FEATURES
suffix:colon
id|lf
op_assign
(paren
r_struct
id|hci_rp_read_loc_features
op_star
)paren
id|skb-&gt;data
suffix:semicolon
r_if
c_cond
(paren
id|lf-&gt;status
)paren
(brace
id|BT_DBG
c_func
(paren
l_string|&quot;%s READ_LOCAL_FEATURES failed %d&quot;
comma
id|hdev-&gt;name
comma
id|lf-&gt;status
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|memcpy
c_func
(paren
id|hdev-&gt;features
comma
id|lf-&gt;features
comma
r_sizeof
(paren
id|hdev-&gt;features
)paren
)paren
suffix:semicolon
multiline_comment|/* Adjust default settings according to features &n;&t;&t; * supported by device. */
r_if
c_cond
(paren
id|hdev-&gt;features
(braket
l_int|0
)braket
op_amp
id|LMP_3SLOT
)paren
id|hdev-&gt;pkt_type
op_or_assign
(paren
id|HCI_DM3
op_or
id|HCI_DH3
)paren
suffix:semicolon
r_if
c_cond
(paren
id|hdev-&gt;features
(braket
l_int|0
)braket
op_amp
id|LMP_5SLOT
)paren
id|hdev-&gt;pkt_type
op_or_assign
(paren
id|HCI_DM5
op_or
id|HCI_DH5
)paren
suffix:semicolon
r_if
c_cond
(paren
id|hdev-&gt;features
(braket
l_int|1
)braket
op_amp
id|LMP_HV2
)paren
id|hdev-&gt;pkt_type
op_or_assign
(paren
id|HCI_HV2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|hdev-&gt;features
(braket
l_int|1
)braket
op_amp
id|LMP_HV3
)paren
id|hdev-&gt;pkt_type
op_or_assign
(paren
id|HCI_HV3
)paren
suffix:semicolon
id|BT_DBG
c_func
(paren
l_string|&quot;%s: features 0x%x 0x%x 0x%x&quot;
comma
id|hdev-&gt;name
comma
id|lf-&gt;features
(braket
l_int|0
)braket
comma
id|lf-&gt;features
(braket
l_int|1
)braket
comma
id|lf-&gt;features
(braket
l_int|2
)braket
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OCF_READ_BUFFER_SIZE
suffix:colon
id|bs
op_assign
(paren
r_struct
id|hci_rp_read_buffer_size
op_star
)paren
id|skb-&gt;data
suffix:semicolon
r_if
c_cond
(paren
id|bs-&gt;status
)paren
(brace
id|BT_DBG
c_func
(paren
l_string|&quot;%s READ_BUFFER_SIZE failed %d&quot;
comma
id|hdev-&gt;name
comma
id|bs-&gt;status
)paren
suffix:semicolon
id|hci_req_complete
c_func
(paren
id|hdev
comma
id|bs-&gt;status
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|hdev-&gt;acl_mtu
op_assign
id|__le16_to_cpu
c_func
(paren
id|bs-&gt;acl_mtu
)paren
suffix:semicolon
id|hdev-&gt;sco_mtu
op_assign
id|bs-&gt;sco_mtu
ques
c_cond
id|bs-&gt;sco_mtu
suffix:colon
l_int|64
suffix:semicolon
id|hdev-&gt;acl_pkts
op_assign
id|hdev-&gt;acl_cnt
op_assign
id|__le16_to_cpu
c_func
(paren
id|bs-&gt;acl_max_pkt
)paren
suffix:semicolon
id|hdev-&gt;sco_pkts
op_assign
id|hdev-&gt;sco_cnt
op_assign
id|__le16_to_cpu
c_func
(paren
id|bs-&gt;sco_max_pkt
)paren
suffix:semicolon
id|BT_DBG
c_func
(paren
l_string|&quot;%s mtu: acl %d, sco %d max_pkt: acl %d, sco %d&quot;
comma
id|hdev-&gt;name
comma
id|hdev-&gt;acl_mtu
comma
id|hdev-&gt;sco_mtu
comma
id|hdev-&gt;acl_pkts
comma
id|hdev-&gt;sco_pkts
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OCF_READ_BD_ADDR
suffix:colon
id|ba
op_assign
(paren
r_struct
id|hci_rp_read_bd_addr
op_star
)paren
id|skb-&gt;data
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ba-&gt;status
)paren
(brace
id|bacpy
c_func
(paren
op_amp
id|hdev-&gt;bdaddr
comma
op_amp
id|ba-&gt;bdaddr
)paren
suffix:semicolon
)brace
r_else
(brace
id|BT_DBG
c_func
(paren
l_string|&quot;%s: READ_BD_ADDR failed %d&quot;
comma
id|hdev-&gt;name
comma
id|ba-&gt;status
)paren
suffix:semicolon
)brace
id|hci_req_complete
c_func
(paren
id|hdev
comma
id|ba-&gt;status
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|BT_DBG
c_func
(paren
l_string|&quot;%s Command complete: ogf INFO_PARAM ocf %x&quot;
comma
id|hdev-&gt;name
comma
id|ocf
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
multiline_comment|/* Command Status OGF LINK_CTL  */
DECL|function|hci_cs_create_conn
r_static
r_inline
r_void
id|hci_cs_create_conn
c_func
(paren
r_struct
id|hci_dev
op_star
id|hdev
comma
id|__u8
id|status
)paren
(brace
r_struct
id|hci_conn
op_star
id|conn
suffix:semicolon
r_struct
id|hci_cp_create_conn
op_star
id|cp
op_assign
id|hci_sent_cmd_data
c_func
(paren
id|hdev
comma
id|OGF_LINK_CTL
comma
id|OCF_CREATE_CONN
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cp
)paren
r_return
suffix:semicolon
id|hci_dev_lock
c_func
(paren
id|hdev
)paren
suffix:semicolon
id|conn
op_assign
id|hci_conn_hash_lookup_ba
c_func
(paren
id|hdev
comma
id|ACL_LINK
comma
op_amp
id|cp-&gt;bdaddr
)paren
suffix:semicolon
id|BT_DBG
c_func
(paren
l_string|&quot;%s status 0x%x bdaddr %s conn %p&quot;
comma
id|hdev-&gt;name
comma
id|status
comma
id|batostr
c_func
(paren
op_amp
id|cp-&gt;bdaddr
)paren
comma
id|conn
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
)paren
(brace
r_if
c_cond
(paren
id|conn
op_logical_and
id|conn-&gt;state
op_eq
id|BT_CONNECT
)paren
(brace
id|conn-&gt;state
op_assign
id|BT_CLOSED
suffix:semicolon
id|hci_proto_connect_cfm
c_func
(paren
id|conn
comma
id|status
)paren
suffix:semicolon
id|hci_conn_del
c_func
(paren
id|conn
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
op_logical_neg
id|conn
)paren
(brace
id|conn
op_assign
id|hci_conn_add
c_func
(paren
id|hdev
comma
id|ACL_LINK
comma
op_amp
id|cp-&gt;bdaddr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|conn
)paren
(brace
id|conn-&gt;out
op_assign
l_int|1
suffix:semicolon
id|conn-&gt;link_mode
op_or_assign
id|HCI_LM_MASTER
suffix:semicolon
)brace
r_else
id|BT_ERR
c_func
(paren
l_string|&quot;No memmory for new connection&quot;
)paren
suffix:semicolon
)brace
)brace
id|hci_dev_unlock
c_func
(paren
id|hdev
)paren
suffix:semicolon
)brace
DECL|function|hci_cs_link_ctl
r_static
r_void
id|hci_cs_link_ctl
c_func
(paren
r_struct
id|hci_dev
op_star
id|hdev
comma
id|__u16
id|ocf
comma
id|__u8
id|status
)paren
(brace
id|BT_DBG
c_func
(paren
l_string|&quot;%s ocf 0x%x&quot;
comma
id|hdev-&gt;name
comma
id|ocf
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|ocf
)paren
(brace
r_case
id|OCF_CREATE_CONN
suffix:colon
id|hci_cs_create_conn
c_func
(paren
id|hdev
comma
id|status
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OCF_ADD_SCO
suffix:colon
r_if
c_cond
(paren
id|status
)paren
(brace
r_struct
id|hci_conn
op_star
id|acl
comma
op_star
id|sco
suffix:semicolon
r_struct
id|hci_cp_add_sco
op_star
id|cp
op_assign
id|hci_sent_cmd_data
c_func
(paren
id|hdev
comma
id|OGF_LINK_CTL
comma
id|OCF_ADD_SCO
)paren
suffix:semicolon
id|__u16
id|handle
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cp
)paren
r_break
suffix:semicolon
id|handle
op_assign
id|__le16_to_cpu
c_func
(paren
id|cp-&gt;handle
)paren
suffix:semicolon
id|BT_DBG
c_func
(paren
l_string|&quot;%s Add SCO error: handle %d status 0x%x&quot;
comma
id|hdev-&gt;name
comma
id|handle
comma
id|status
)paren
suffix:semicolon
id|hci_dev_lock
c_func
(paren
id|hdev
)paren
suffix:semicolon
id|acl
op_assign
id|hci_conn_hash_lookup_handle
c_func
(paren
id|hdev
comma
id|handle
)paren
suffix:semicolon
r_if
c_cond
(paren
id|acl
op_logical_and
(paren
id|sco
op_assign
id|acl-&gt;link
)paren
)paren
(brace
id|sco-&gt;state
op_assign
id|BT_CLOSED
suffix:semicolon
id|hci_proto_connect_cfm
c_func
(paren
id|sco
comma
id|status
)paren
suffix:semicolon
id|hci_conn_del
c_func
(paren
id|sco
)paren
suffix:semicolon
)brace
id|hci_dev_unlock
c_func
(paren
id|hdev
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|OCF_INQUIRY
suffix:colon
r_if
c_cond
(paren
id|status
)paren
(brace
id|BT_DBG
c_func
(paren
l_string|&quot;%s Inquiry error: status 0x%x&quot;
comma
id|hdev-&gt;name
comma
id|status
)paren
suffix:semicolon
id|hci_req_complete
c_func
(paren
id|hdev
comma
id|status
)paren
suffix:semicolon
)brace
r_else
(brace
id|set_bit
c_func
(paren
id|HCI_INQUIRY
comma
op_amp
id|hdev-&gt;flags
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_default
suffix:colon
id|BT_DBG
c_func
(paren
l_string|&quot;%s Command status: ogf LINK_CTL ocf %x status %d&quot;
comma
id|hdev-&gt;name
comma
id|ocf
comma
id|status
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
multiline_comment|/* Command Status OGF LINK_POLICY */
DECL|function|hci_cs_link_policy
r_static
r_void
id|hci_cs_link_policy
c_func
(paren
r_struct
id|hci_dev
op_star
id|hdev
comma
id|__u16
id|ocf
comma
id|__u8
id|status
)paren
(brace
id|BT_DBG
c_func
(paren
l_string|&quot;%s ocf 0x%x&quot;
comma
id|hdev-&gt;name
comma
id|ocf
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|ocf
)paren
(brace
r_default
suffix:colon
id|BT_DBG
c_func
(paren
l_string|&quot;%s Command status: ogf HOST_POLICY ocf %x&quot;
comma
id|hdev-&gt;name
comma
id|ocf
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
multiline_comment|/* Command Status OGF HOST_CTL */
DECL|function|hci_cs_host_ctl
r_static
r_void
id|hci_cs_host_ctl
c_func
(paren
r_struct
id|hci_dev
op_star
id|hdev
comma
id|__u16
id|ocf
comma
id|__u8
id|status
)paren
(brace
id|BT_DBG
c_func
(paren
l_string|&quot;%s ocf 0x%x&quot;
comma
id|hdev-&gt;name
comma
id|ocf
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|ocf
)paren
(brace
r_default
suffix:colon
id|BT_DBG
c_func
(paren
l_string|&quot;%s Command status: ogf HOST_CTL ocf %x&quot;
comma
id|hdev-&gt;name
comma
id|ocf
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
multiline_comment|/* Command Status OGF INFO_PARAM  */
DECL|function|hci_cs_info_param
r_static
r_void
id|hci_cs_info_param
c_func
(paren
r_struct
id|hci_dev
op_star
id|hdev
comma
id|__u16
id|ocf
comma
id|__u8
id|status
)paren
(brace
id|BT_DBG
c_func
(paren
l_string|&quot;%s: hci_cs_info_param: ocf 0x%x&quot;
comma
id|hdev-&gt;name
comma
id|ocf
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|ocf
)paren
(brace
r_default
suffix:colon
id|BT_DBG
c_func
(paren
l_string|&quot;%s Command status: ogf INFO_PARAM ocf %x&quot;
comma
id|hdev-&gt;name
comma
id|ocf
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
multiline_comment|/* Inquiry Complete */
DECL|function|hci_inquiry_complete_evt
r_static
r_inline
r_void
id|hci_inquiry_complete_evt
c_func
(paren
r_struct
id|hci_dev
op_star
id|hdev
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
id|__u8
id|status
op_assign
op_star
(paren
(paren
id|__u8
op_star
)paren
id|skb-&gt;data
)paren
suffix:semicolon
id|BT_DBG
c_func
(paren
l_string|&quot;%s status %d&quot;
comma
id|hdev-&gt;name
comma
id|status
)paren
suffix:semicolon
id|clear_bit
c_func
(paren
id|HCI_INQUIRY
comma
op_amp
id|hdev-&gt;flags
)paren
suffix:semicolon
id|hci_req_complete
c_func
(paren
id|hdev
comma
id|status
)paren
suffix:semicolon
)brace
multiline_comment|/* Inquiry Result */
DECL|function|hci_inquiry_result_evt
r_static
r_inline
r_void
id|hci_inquiry_result_evt
c_func
(paren
r_struct
id|hci_dev
op_star
id|hdev
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|inquiry_info
op_star
id|info
op_assign
(paren
r_struct
id|inquiry_info
op_star
)paren
(paren
id|skb-&gt;data
op_plus
l_int|1
)paren
suffix:semicolon
r_int
id|num_rsp
op_assign
op_star
(paren
(paren
id|__u8
op_star
)paren
id|skb-&gt;data
)paren
suffix:semicolon
id|BT_DBG
c_func
(paren
l_string|&quot;%s num_rsp %d&quot;
comma
id|hdev-&gt;name
comma
id|num_rsp
)paren
suffix:semicolon
id|hci_dev_lock
c_func
(paren
id|hdev
)paren
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
id|num_rsp
suffix:semicolon
id|num_rsp
op_decrement
)paren
id|hci_inquiry_cache_update
c_func
(paren
id|hdev
comma
id|info
op_increment
)paren
suffix:semicolon
id|hci_dev_unlock
c_func
(paren
id|hdev
)paren
suffix:semicolon
)brace
multiline_comment|/* Inquiry Result With RSSI */
DECL|function|hci_inquiry_result_with_rssi_evt
r_static
r_inline
r_void
id|hci_inquiry_result_with_rssi_evt
c_func
(paren
r_struct
id|hci_dev
op_star
id|hdev
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|inquiry_info_with_rssi
op_star
id|info
op_assign
(paren
r_struct
id|inquiry_info_with_rssi
op_star
)paren
(paren
id|skb-&gt;data
op_plus
l_int|1
)paren
suffix:semicolon
r_int
id|num_rsp
op_assign
op_star
(paren
(paren
id|__u8
op_star
)paren
id|skb-&gt;data
)paren
suffix:semicolon
id|BT_DBG
c_func
(paren
l_string|&quot;%s num_rsp %d&quot;
comma
id|hdev-&gt;name
comma
id|num_rsp
)paren
suffix:semicolon
id|hci_dev_lock
c_func
(paren
id|hdev
)paren
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
id|num_rsp
suffix:semicolon
id|num_rsp
op_decrement
)paren
(brace
r_struct
id|inquiry_info
id|tmp
suffix:semicolon
id|bacpy
c_func
(paren
op_amp
id|tmp.bdaddr
comma
op_amp
id|info-&gt;bdaddr
)paren
suffix:semicolon
id|tmp.pscan_rep_mode
op_assign
id|info-&gt;pscan_rep_mode
suffix:semicolon
id|tmp.pscan_period_mode
op_assign
id|info-&gt;pscan_period_mode
suffix:semicolon
id|tmp.pscan_mode
op_assign
l_int|0x00
suffix:semicolon
id|memcpy
c_func
(paren
id|tmp.dev_class
comma
op_amp
id|info-&gt;dev_class
comma
l_int|3
)paren
suffix:semicolon
id|tmp.clock_offset
op_assign
id|info-&gt;clock_offset
suffix:semicolon
id|info
op_increment
suffix:semicolon
id|hci_inquiry_cache_update
c_func
(paren
id|hdev
comma
op_amp
id|tmp
)paren
suffix:semicolon
)brace
id|hci_dev_unlock
c_func
(paren
id|hdev
)paren
suffix:semicolon
)brace
multiline_comment|/* Connect Request */
DECL|function|hci_conn_request_evt
r_static
r_inline
r_void
id|hci_conn_request_evt
c_func
(paren
r_struct
id|hci_dev
op_star
id|hdev
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|hci_ev_conn_request
op_star
id|ev
op_assign
(paren
r_struct
id|hci_ev_conn_request
op_star
)paren
id|skb-&gt;data
suffix:semicolon
r_int
id|mask
op_assign
id|hdev-&gt;link_mode
suffix:semicolon
id|BT_DBG
c_func
(paren
l_string|&quot;%s Connection request: %s type 0x%x&quot;
comma
id|hdev-&gt;name
comma
id|batostr
c_func
(paren
op_amp
id|ev-&gt;bdaddr
)paren
comma
id|ev-&gt;link_type
)paren
suffix:semicolon
id|mask
op_or_assign
id|hci_proto_connect_ind
c_func
(paren
id|hdev
comma
op_amp
id|ev-&gt;bdaddr
comma
id|ev-&gt;link_type
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mask
op_amp
id|HCI_LM_ACCEPT
)paren
(brace
multiline_comment|/* Connection accepted */
r_struct
id|hci_conn
op_star
id|conn
suffix:semicolon
r_struct
id|hci_cp_accept_conn_req
id|cp
suffix:semicolon
id|hci_dev_lock
c_func
(paren
id|hdev
)paren
suffix:semicolon
id|conn
op_assign
id|hci_conn_hash_lookup_ba
c_func
(paren
id|hdev
comma
id|ev-&gt;link_type
comma
op_amp
id|ev-&gt;bdaddr
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|conn
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|conn
op_assign
id|hci_conn_add
c_func
(paren
id|hdev
comma
id|ev-&gt;link_type
comma
op_amp
id|ev-&gt;bdaddr
)paren
)paren
)paren
(brace
id|BT_ERR
c_func
(paren
l_string|&quot;No memmory for new connection&quot;
)paren
suffix:semicolon
id|hci_dev_unlock
c_func
(paren
id|hdev
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
)brace
id|conn-&gt;state
op_assign
id|BT_CONNECT
suffix:semicolon
id|hci_dev_unlock
c_func
(paren
id|hdev
)paren
suffix:semicolon
id|bacpy
c_func
(paren
op_amp
id|cp.bdaddr
comma
op_amp
id|ev-&gt;bdaddr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|lmp_rswitch_capable
c_func
(paren
id|hdev
)paren
op_logical_and
(paren
id|mask
op_amp
id|HCI_LM_MASTER
)paren
)paren
id|cp.role
op_assign
l_int|0x00
suffix:semicolon
multiline_comment|/* Become master */
r_else
id|cp.role
op_assign
l_int|0x01
suffix:semicolon
multiline_comment|/* Remain slave */
id|hci_send_cmd
c_func
(paren
id|hdev
comma
id|OGF_LINK_CTL
comma
id|OCF_ACCEPT_CONN_REQ
comma
r_sizeof
(paren
id|cp
)paren
comma
op_amp
id|cp
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* Connection rejected */
r_struct
id|hci_cp_reject_conn_req
id|cp
suffix:semicolon
id|bacpy
c_func
(paren
op_amp
id|cp.bdaddr
comma
op_amp
id|ev-&gt;bdaddr
)paren
suffix:semicolon
id|cp.reason
op_assign
l_int|0x0f
suffix:semicolon
id|hci_send_cmd
c_func
(paren
id|hdev
comma
id|OGF_LINK_CTL
comma
id|OCF_REJECT_CONN_REQ
comma
r_sizeof
(paren
id|cp
)paren
comma
op_amp
id|cp
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* Connect Complete */
DECL|function|hci_conn_complete_evt
r_static
r_inline
r_void
id|hci_conn_complete_evt
c_func
(paren
r_struct
id|hci_dev
op_star
id|hdev
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|hci_ev_conn_complete
op_star
id|ev
op_assign
(paren
r_struct
id|hci_ev_conn_complete
op_star
)paren
id|skb-&gt;data
suffix:semicolon
r_struct
id|hci_conn
op_star
id|conn
op_assign
l_int|NULL
suffix:semicolon
id|BT_DBG
c_func
(paren
l_string|&quot;%s&quot;
comma
id|hdev-&gt;name
)paren
suffix:semicolon
id|hci_dev_lock
c_func
(paren
id|hdev
)paren
suffix:semicolon
id|conn
op_assign
id|hci_conn_hash_lookup_ba
c_func
(paren
id|hdev
comma
id|ev-&gt;link_type
comma
op_amp
id|ev-&gt;bdaddr
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|conn
)paren
(brace
id|hci_dev_unlock
c_func
(paren
id|hdev
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|ev-&gt;status
)paren
(brace
id|conn-&gt;handle
op_assign
id|__le16_to_cpu
c_func
(paren
id|ev-&gt;handle
)paren
suffix:semicolon
id|conn-&gt;state
op_assign
id|BT_CONNECTED
suffix:semicolon
r_if
c_cond
(paren
id|test_bit
c_func
(paren
id|HCI_AUTH
comma
op_amp
id|hdev-&gt;flags
)paren
)paren
id|conn-&gt;link_mode
op_or_assign
id|HCI_LM_AUTH
suffix:semicolon
r_if
c_cond
(paren
id|test_bit
c_func
(paren
id|HCI_ENCRYPT
comma
op_amp
id|hdev-&gt;flags
)paren
)paren
id|conn-&gt;link_mode
op_or_assign
id|HCI_LM_ENCRYPT
suffix:semicolon
multiline_comment|/* Set link policy */
r_if
c_cond
(paren
id|conn-&gt;type
op_eq
id|ACL_LINK
op_logical_and
id|hdev-&gt;link_policy
)paren
(brace
r_struct
id|hci_cp_write_link_policy
id|cp
suffix:semicolon
id|cp.handle
op_assign
id|ev-&gt;handle
suffix:semicolon
id|cp.policy
op_assign
id|__cpu_to_le16
c_func
(paren
id|hdev-&gt;link_policy
)paren
suffix:semicolon
id|hci_send_cmd
c_func
(paren
id|hdev
comma
id|OGF_LINK_POLICY
comma
id|OCF_WRITE_LINK_POLICY
comma
r_sizeof
(paren
id|cp
)paren
comma
op_amp
id|cp
)paren
suffix:semicolon
)brace
multiline_comment|/* Set packet type for incoming connection */
r_if
c_cond
(paren
op_logical_neg
id|conn-&gt;out
)paren
(brace
r_struct
id|hci_cp_change_conn_ptype
id|cp
suffix:semicolon
id|cp.handle
op_assign
id|ev-&gt;handle
suffix:semicolon
id|cp.pkt_type
op_assign
(paren
id|conn-&gt;type
op_eq
id|ACL_LINK
)paren
ques
c_cond
id|__cpu_to_le16
c_func
(paren
id|hdev-&gt;pkt_type
op_amp
id|ACL_PTYPE_MASK
)paren
suffix:colon
id|__cpu_to_le16
c_func
(paren
id|hdev-&gt;pkt_type
op_amp
id|SCO_PTYPE_MASK
)paren
suffix:semicolon
id|hci_send_cmd
c_func
(paren
id|hdev
comma
id|OGF_LINK_CTL
comma
id|OCF_CHANGE_CONN_PTYPE
comma
r_sizeof
(paren
id|cp
)paren
comma
op_amp
id|cp
)paren
suffix:semicolon
)brace
)brace
r_else
id|conn-&gt;state
op_assign
id|BT_CLOSED
suffix:semicolon
r_if
c_cond
(paren
id|conn-&gt;type
op_eq
id|ACL_LINK
)paren
(brace
r_struct
id|hci_conn
op_star
id|sco
op_assign
id|conn-&gt;link
suffix:semicolon
r_if
c_cond
(paren
id|sco
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|ev-&gt;status
)paren
id|hci_add_sco
c_func
(paren
id|sco
comma
id|conn-&gt;handle
)paren
suffix:semicolon
r_else
(brace
id|hci_proto_connect_cfm
c_func
(paren
id|sco
comma
id|ev-&gt;status
)paren
suffix:semicolon
id|hci_conn_del
c_func
(paren
id|sco
)paren
suffix:semicolon
)brace
)brace
)brace
id|hci_proto_connect_cfm
c_func
(paren
id|conn
comma
id|ev-&gt;status
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ev-&gt;status
)paren
id|hci_conn_del
c_func
(paren
id|conn
)paren
suffix:semicolon
id|hci_dev_unlock
c_func
(paren
id|hdev
)paren
suffix:semicolon
)brace
multiline_comment|/* Disconnect Complete */
DECL|function|hci_disconn_complete_evt
r_static
r_inline
r_void
id|hci_disconn_complete_evt
c_func
(paren
r_struct
id|hci_dev
op_star
id|hdev
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|hci_ev_disconn_complete
op_star
id|ev
op_assign
(paren
r_struct
id|hci_ev_disconn_complete
op_star
)paren
id|skb-&gt;data
suffix:semicolon
r_struct
id|hci_conn
op_star
id|conn
op_assign
l_int|NULL
suffix:semicolon
id|__u16
id|handle
op_assign
id|__le16_to_cpu
c_func
(paren
id|ev-&gt;handle
)paren
suffix:semicolon
id|BT_DBG
c_func
(paren
l_string|&quot;%s status %d&quot;
comma
id|hdev-&gt;name
comma
id|ev-&gt;status
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ev-&gt;status
)paren
r_return
suffix:semicolon
id|hci_dev_lock
c_func
(paren
id|hdev
)paren
suffix:semicolon
id|conn
op_assign
id|hci_conn_hash_lookup_handle
c_func
(paren
id|hdev
comma
id|handle
)paren
suffix:semicolon
r_if
c_cond
(paren
id|conn
)paren
(brace
id|conn-&gt;state
op_assign
id|BT_CLOSED
suffix:semicolon
id|hci_proto_disconn_ind
c_func
(paren
id|conn
comma
id|ev-&gt;reason
)paren
suffix:semicolon
id|hci_conn_del
c_func
(paren
id|conn
)paren
suffix:semicolon
)brace
id|hci_dev_unlock
c_func
(paren
id|hdev
)paren
suffix:semicolon
)brace
multiline_comment|/* Number of completed packets */
DECL|function|hci_num_comp_pkts_evt
r_static
r_inline
r_void
id|hci_num_comp_pkts_evt
c_func
(paren
r_struct
id|hci_dev
op_star
id|hdev
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|hci_ev_num_comp_pkts
op_star
id|ev
op_assign
(paren
r_struct
id|hci_ev_num_comp_pkts
op_star
)paren
id|skb-&gt;data
suffix:semicolon
id|__u16
op_star
id|ptr
suffix:semicolon
r_int
id|i
suffix:semicolon
id|skb_pull
c_func
(paren
id|skb
comma
r_sizeof
(paren
op_star
id|ev
)paren
)paren
suffix:semicolon
id|BT_DBG
c_func
(paren
l_string|&quot;%s num_hndl %d&quot;
comma
id|hdev-&gt;name
comma
id|ev-&gt;num_hndl
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb-&gt;len
OL
id|ev-&gt;num_hndl
op_star
l_int|4
)paren
(brace
id|BT_DBG
c_func
(paren
l_string|&quot;%s bad parameters&quot;
comma
id|hdev-&gt;name
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|tasklet_disable
c_func
(paren
op_amp
id|hdev-&gt;tx_task
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
comma
id|ptr
op_assign
(paren
id|__u16
op_star
)paren
id|skb-&gt;data
suffix:semicolon
id|i
OL
id|ev-&gt;num_hndl
suffix:semicolon
id|i
op_increment
)paren
(brace
r_struct
id|hci_conn
op_star
id|conn
suffix:semicolon
id|__u16
id|handle
comma
id|count
suffix:semicolon
id|handle
op_assign
id|__le16_to_cpu
c_func
(paren
id|get_unaligned
c_func
(paren
id|ptr
op_increment
)paren
)paren
suffix:semicolon
id|count
op_assign
id|__le16_to_cpu
c_func
(paren
id|get_unaligned
c_func
(paren
id|ptr
op_increment
)paren
)paren
suffix:semicolon
id|conn
op_assign
id|hci_conn_hash_lookup_handle
c_func
(paren
id|hdev
comma
id|handle
)paren
suffix:semicolon
r_if
c_cond
(paren
id|conn
)paren
(brace
id|conn-&gt;sent
op_sub_assign
id|count
suffix:semicolon
r_if
c_cond
(paren
id|conn-&gt;type
op_eq
id|SCO_LINK
)paren
(brace
r_if
c_cond
(paren
(paren
id|hdev-&gt;sco_cnt
op_add_assign
id|count
)paren
OG
id|hdev-&gt;sco_pkts
)paren
id|hdev-&gt;sco_cnt
op_assign
id|hdev-&gt;sco_pkts
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
(paren
id|hdev-&gt;acl_cnt
op_add_assign
id|count
)paren
OG
id|hdev-&gt;acl_pkts
)paren
id|hdev-&gt;acl_cnt
op_assign
id|hdev-&gt;acl_pkts
suffix:semicolon
)brace
)brace
)brace
id|hci_sched_tx
c_func
(paren
id|hdev
)paren
suffix:semicolon
id|tasklet_enable
c_func
(paren
op_amp
id|hdev-&gt;tx_task
)paren
suffix:semicolon
)brace
multiline_comment|/* Role Change */
DECL|function|hci_role_change_evt
r_static
r_inline
r_void
id|hci_role_change_evt
c_func
(paren
r_struct
id|hci_dev
op_star
id|hdev
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|hci_ev_role_change
op_star
id|ev
op_assign
(paren
r_struct
id|hci_ev_role_change
op_star
)paren
id|skb-&gt;data
suffix:semicolon
r_struct
id|hci_conn
op_star
id|conn
op_assign
l_int|NULL
suffix:semicolon
id|BT_DBG
c_func
(paren
l_string|&quot;%s status %d&quot;
comma
id|hdev-&gt;name
comma
id|ev-&gt;status
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ev-&gt;status
)paren
r_return
suffix:semicolon
id|hci_dev_lock
c_func
(paren
id|hdev
)paren
suffix:semicolon
id|conn
op_assign
id|hci_conn_hash_lookup_ba
c_func
(paren
id|hdev
comma
id|ACL_LINK
comma
op_amp
id|ev-&gt;bdaddr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|conn
)paren
(brace
r_if
c_cond
(paren
id|ev-&gt;role
)paren
id|conn-&gt;link_mode
op_and_assign
op_complement
id|HCI_LM_MASTER
suffix:semicolon
r_else
id|conn-&gt;link_mode
op_or_assign
id|HCI_LM_MASTER
suffix:semicolon
)brace
id|hci_dev_unlock
c_func
(paren
id|hdev
)paren
suffix:semicolon
)brace
multiline_comment|/* Authentication Complete */
DECL|function|hci_auth_complete_evt
r_static
r_inline
r_void
id|hci_auth_complete_evt
c_func
(paren
r_struct
id|hci_dev
op_star
id|hdev
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|hci_ev_auth_complete
op_star
id|ev
op_assign
(paren
r_struct
id|hci_ev_auth_complete
op_star
)paren
id|skb-&gt;data
suffix:semicolon
r_struct
id|hci_conn
op_star
id|conn
op_assign
l_int|NULL
suffix:semicolon
id|__u16
id|handle
op_assign
id|__le16_to_cpu
c_func
(paren
id|ev-&gt;handle
)paren
suffix:semicolon
id|BT_DBG
c_func
(paren
l_string|&quot;%s status %d&quot;
comma
id|hdev-&gt;name
comma
id|ev-&gt;status
)paren
suffix:semicolon
id|hci_dev_lock
c_func
(paren
id|hdev
)paren
suffix:semicolon
id|conn
op_assign
id|hci_conn_hash_lookup_handle
c_func
(paren
id|hdev
comma
id|handle
)paren
suffix:semicolon
r_if
c_cond
(paren
id|conn
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|ev-&gt;status
)paren
id|conn-&gt;link_mode
op_or_assign
id|HCI_LM_AUTH
suffix:semicolon
id|clear_bit
c_func
(paren
id|HCI_CONN_AUTH_PEND
comma
op_amp
id|conn-&gt;pend
)paren
suffix:semicolon
id|hci_proto_auth_cfm
c_func
(paren
id|conn
comma
id|ev-&gt;status
)paren
suffix:semicolon
r_if
c_cond
(paren
id|test_bit
c_func
(paren
id|HCI_CONN_ENCRYPT_PEND
comma
op_amp
id|conn-&gt;pend
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|ev-&gt;status
)paren
(brace
r_struct
id|hci_cp_set_conn_encrypt
id|cp
suffix:semicolon
id|cp.handle
op_assign
id|__cpu_to_le16
c_func
(paren
id|conn-&gt;handle
)paren
suffix:semicolon
id|cp.encrypt
op_assign
l_int|1
suffix:semicolon
id|hci_send_cmd
c_func
(paren
id|conn-&gt;hdev
comma
id|OGF_LINK_CTL
comma
id|OCF_SET_CONN_ENCRYPT
comma
r_sizeof
(paren
id|cp
)paren
comma
op_amp
id|cp
)paren
suffix:semicolon
)brace
r_else
(brace
id|clear_bit
c_func
(paren
id|HCI_CONN_ENCRYPT_PEND
comma
op_amp
id|conn-&gt;pend
)paren
suffix:semicolon
id|hci_proto_encrypt_cfm
c_func
(paren
id|conn
comma
id|ev-&gt;status
)paren
suffix:semicolon
)brace
)brace
)brace
id|hci_dev_unlock
c_func
(paren
id|hdev
)paren
suffix:semicolon
)brace
multiline_comment|/* Encryption Change */
DECL|function|hci_encrypt_change_evt
r_static
r_inline
r_void
id|hci_encrypt_change_evt
c_func
(paren
r_struct
id|hci_dev
op_star
id|hdev
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|hci_ev_encrypt_change
op_star
id|ev
op_assign
(paren
r_struct
id|hci_ev_encrypt_change
op_star
)paren
id|skb-&gt;data
suffix:semicolon
r_struct
id|hci_conn
op_star
id|conn
op_assign
l_int|NULL
suffix:semicolon
id|__u16
id|handle
op_assign
id|__le16_to_cpu
c_func
(paren
id|ev-&gt;handle
)paren
suffix:semicolon
id|BT_DBG
c_func
(paren
l_string|&quot;%s status %d&quot;
comma
id|hdev-&gt;name
comma
id|ev-&gt;status
)paren
suffix:semicolon
id|hci_dev_lock
c_func
(paren
id|hdev
)paren
suffix:semicolon
id|conn
op_assign
id|hci_conn_hash_lookup_handle
c_func
(paren
id|hdev
comma
id|handle
)paren
suffix:semicolon
r_if
c_cond
(paren
id|conn
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|ev-&gt;status
)paren
(brace
r_if
c_cond
(paren
id|ev-&gt;encrypt
)paren
id|conn-&gt;link_mode
op_or_assign
id|HCI_LM_ENCRYPT
suffix:semicolon
r_else
id|conn-&gt;link_mode
op_and_assign
op_complement
id|HCI_LM_ENCRYPT
suffix:semicolon
)brace
id|clear_bit
c_func
(paren
id|HCI_CONN_ENCRYPT_PEND
comma
op_amp
id|conn-&gt;pend
)paren
suffix:semicolon
id|hci_proto_encrypt_cfm
c_func
(paren
id|conn
comma
id|ev-&gt;status
)paren
suffix:semicolon
)brace
id|hci_dev_unlock
c_func
(paren
id|hdev
)paren
suffix:semicolon
)brace
multiline_comment|/* Pin Code Request*/
DECL|function|hci_pin_code_request_evt
r_static
r_inline
r_void
id|hci_pin_code_request_evt
c_func
(paren
r_struct
id|hci_dev
op_star
id|hdev
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
)brace
multiline_comment|/* Link Key Request */
DECL|function|hci_link_key_request_evt
r_static
r_inline
r_void
id|hci_link_key_request_evt
c_func
(paren
r_struct
id|hci_dev
op_star
id|hdev
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
)brace
multiline_comment|/* Link Key Notification */
DECL|function|hci_link_key_notify_evt
r_static
r_inline
r_void
id|hci_link_key_notify_evt
c_func
(paren
r_struct
id|hci_dev
op_star
id|hdev
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
)brace
DECL|function|hci_event_packet
r_void
id|hci_event_packet
c_func
(paren
r_struct
id|hci_dev
op_star
id|hdev
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|hci_event_hdr
op_star
id|hdr
op_assign
(paren
r_struct
id|hci_event_hdr
op_star
)paren
id|skb-&gt;data
suffix:semicolon
r_struct
id|hci_ev_cmd_complete
op_star
id|ec
suffix:semicolon
r_struct
id|hci_ev_cmd_status
op_star
id|cs
suffix:semicolon
id|u16
id|opcode
comma
id|ocf
comma
id|ogf
suffix:semicolon
id|skb_pull
c_func
(paren
id|skb
comma
id|HCI_EVENT_HDR_SIZE
)paren
suffix:semicolon
id|BT_DBG
c_func
(paren
l_string|&quot;%s evt 0x%x&quot;
comma
id|hdev-&gt;name
comma
id|hdr-&gt;evt
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|hdr-&gt;evt
)paren
(brace
r_case
id|HCI_EV_NUM_COMP_PKTS
suffix:colon
id|hci_num_comp_pkts_evt
c_func
(paren
id|hdev
comma
id|skb
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|HCI_EV_INQUIRY_COMPLETE
suffix:colon
id|hci_inquiry_complete_evt
c_func
(paren
id|hdev
comma
id|skb
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|HCI_EV_INQUIRY_RESULT
suffix:colon
id|hci_inquiry_result_evt
c_func
(paren
id|hdev
comma
id|skb
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|HCI_EV_INQUIRY_RESULT_WITH_RSSI
suffix:colon
id|hci_inquiry_result_with_rssi_evt
c_func
(paren
id|hdev
comma
id|skb
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|HCI_EV_CONN_REQUEST
suffix:colon
id|hci_conn_request_evt
c_func
(paren
id|hdev
comma
id|skb
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|HCI_EV_CONN_COMPLETE
suffix:colon
id|hci_conn_complete_evt
c_func
(paren
id|hdev
comma
id|skb
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|HCI_EV_DISCONN_COMPLETE
suffix:colon
id|hci_disconn_complete_evt
c_func
(paren
id|hdev
comma
id|skb
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|HCI_EV_ROLE_CHANGE
suffix:colon
id|hci_role_change_evt
c_func
(paren
id|hdev
comma
id|skb
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|HCI_EV_AUTH_COMPLETE
suffix:colon
id|hci_auth_complete_evt
c_func
(paren
id|hdev
comma
id|skb
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|HCI_EV_ENCRYPT_CHANGE
suffix:colon
id|hci_encrypt_change_evt
c_func
(paren
id|hdev
comma
id|skb
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|HCI_EV_PIN_CODE_REQ
suffix:colon
id|hci_pin_code_request_evt
c_func
(paren
id|hdev
comma
id|skb
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|HCI_EV_LINK_KEY_REQ
suffix:colon
id|hci_link_key_request_evt
c_func
(paren
id|hdev
comma
id|skb
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|HCI_EV_LINK_KEY_NOTIFY
suffix:colon
id|hci_link_key_notify_evt
c_func
(paren
id|hdev
comma
id|skb
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|HCI_EV_CMD_STATUS
suffix:colon
id|cs
op_assign
(paren
r_struct
id|hci_ev_cmd_status
op_star
)paren
id|skb-&gt;data
suffix:semicolon
id|skb_pull
c_func
(paren
id|skb
comma
r_sizeof
(paren
id|cs
)paren
)paren
suffix:semicolon
id|opcode
op_assign
id|__le16_to_cpu
c_func
(paren
id|cs-&gt;opcode
)paren
suffix:semicolon
id|ogf
op_assign
id|hci_opcode_ogf
c_func
(paren
id|opcode
)paren
suffix:semicolon
id|ocf
op_assign
id|hci_opcode_ocf
c_func
(paren
id|opcode
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|ogf
)paren
(brace
r_case
id|OGF_INFO_PARAM
suffix:colon
id|hci_cs_info_param
c_func
(paren
id|hdev
comma
id|ocf
comma
id|cs-&gt;status
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OGF_HOST_CTL
suffix:colon
id|hci_cs_host_ctl
c_func
(paren
id|hdev
comma
id|ocf
comma
id|cs-&gt;status
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OGF_LINK_CTL
suffix:colon
id|hci_cs_link_ctl
c_func
(paren
id|hdev
comma
id|ocf
comma
id|cs-&gt;status
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OGF_LINK_POLICY
suffix:colon
id|hci_cs_link_policy
c_func
(paren
id|hdev
comma
id|ocf
comma
id|cs-&gt;status
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|BT_DBG
c_func
(paren
l_string|&quot;%s Command Status OGF %x&quot;
comma
id|hdev-&gt;name
comma
id|ogf
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cs-&gt;ncmd
)paren
(brace
id|atomic_set
c_func
(paren
op_amp
id|hdev-&gt;cmd_cnt
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb_queue_empty
c_func
(paren
op_amp
id|hdev-&gt;cmd_q
)paren
)paren
id|hci_sched_cmd
c_func
(paren
id|hdev
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|HCI_EV_CMD_COMPLETE
suffix:colon
id|ec
op_assign
(paren
r_struct
id|hci_ev_cmd_complete
op_star
)paren
id|skb-&gt;data
suffix:semicolon
id|skb_pull
c_func
(paren
id|skb
comma
r_sizeof
(paren
op_star
id|ec
)paren
)paren
suffix:semicolon
id|opcode
op_assign
id|__le16_to_cpu
c_func
(paren
id|ec-&gt;opcode
)paren
suffix:semicolon
id|ogf
op_assign
id|hci_opcode_ogf
c_func
(paren
id|opcode
)paren
suffix:semicolon
id|ocf
op_assign
id|hci_opcode_ocf
c_func
(paren
id|opcode
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|ogf
)paren
(brace
r_case
id|OGF_INFO_PARAM
suffix:colon
id|hci_cc_info_param
c_func
(paren
id|hdev
comma
id|ocf
comma
id|skb
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OGF_HOST_CTL
suffix:colon
id|hci_cc_host_ctl
c_func
(paren
id|hdev
comma
id|ocf
comma
id|skb
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OGF_LINK_CTL
suffix:colon
id|hci_cc_link_ctl
c_func
(paren
id|hdev
comma
id|ocf
comma
id|skb
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OGF_LINK_POLICY
suffix:colon
id|hci_cc_link_policy
c_func
(paren
id|hdev
comma
id|ocf
comma
id|skb
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|BT_DBG
c_func
(paren
l_string|&quot;%s Command Completed OGF %x&quot;
comma
id|hdev-&gt;name
comma
id|ogf
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ec-&gt;ncmd
)paren
(brace
id|atomic_set
c_func
(paren
op_amp
id|hdev-&gt;cmd_cnt
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb_queue_empty
c_func
(paren
op_amp
id|hdev-&gt;cmd_q
)paren
)paren
id|hci_sched_cmd
c_func
(paren
id|hdev
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
id|hdev-&gt;stat.evt_rx
op_increment
suffix:semicolon
)brace
multiline_comment|/* Generate internal stack event */
DECL|function|hci_si_event
r_void
id|hci_si_event
c_func
(paren
r_struct
id|hci_dev
op_star
id|hdev
comma
r_int
id|type
comma
r_int
id|dlen
comma
r_void
op_star
id|data
)paren
(brace
r_struct
id|hci_event_hdr
op_star
id|hdr
suffix:semicolon
r_struct
id|hci_ev_stack_internal
op_star
id|ev
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
id|skb
op_assign
id|bt_skb_alloc
c_func
(paren
id|HCI_EVENT_HDR_SIZE
op_plus
r_sizeof
(paren
op_star
id|ev
)paren
op_plus
id|dlen
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
r_return
suffix:semicolon
id|hdr
op_assign
(paren
r_void
op_star
)paren
id|skb_put
c_func
(paren
id|skb
comma
id|HCI_EVENT_HDR_SIZE
)paren
suffix:semicolon
id|hdr-&gt;evt
op_assign
id|HCI_EV_STACK_INTERNAL
suffix:semicolon
id|hdr-&gt;plen
op_assign
r_sizeof
(paren
op_star
id|ev
)paren
op_plus
id|dlen
suffix:semicolon
id|ev
op_assign
(paren
r_void
op_star
)paren
id|skb_put
c_func
(paren
id|skb
comma
r_sizeof
(paren
op_star
id|ev
)paren
op_plus
id|dlen
)paren
suffix:semicolon
id|ev-&gt;type
op_assign
id|type
suffix:semicolon
id|memcpy
c_func
(paren
id|ev-&gt;data
comma
id|data
comma
id|dlen
)paren
suffix:semicolon
id|skb-&gt;pkt_type
op_assign
id|HCI_EVENT_PKT
suffix:semicolon
id|skb-&gt;dev
op_assign
(paren
r_void
op_star
)paren
id|hdev
suffix:semicolon
id|hci_send_to_sock
c_func
(paren
id|hdev
comma
id|skb
)paren
suffix:semicolon
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
DECL|variable|hci_si_event
id|EXPORT_SYMBOL
c_func
(paren
id|hci_si_event
)paren
suffix:semicolon
eof
