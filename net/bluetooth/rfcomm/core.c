multiline_comment|/* &n;   RFCOMM implementation for Linux Bluetooth stack (BlueZ).&n;   Copyright (C) 2002 Maxim Krasnyansky &lt;maxk@qualcomm.com&gt;&n;   Copyright (C) 2002 Marcel Holtmann &lt;marcel@holtmann.org&gt;&n;&n;   This program is free software; you can redistribute it and/or modify&n;   it under the terms of the GNU General Public License version 2 as&n;   published by the Free Software Foundation;&n;&n;   THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS&n;   OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,&n;   FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT OF THIRD PARTY RIGHTS.&n;   IN NO EVENT SHALL THE COPYRIGHT HOLDER(S) AND AUTHOR(S) BE LIABLE FOR ANY&n;   CLAIM, OR ANY SPECIAL INDIRECT OR CONSEQUENTIAL DAMAGES, OR ANY DAMAGES &n;   WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN &n;   ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF &n;   OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.&n;&n;   ALL LIABILITY, INCLUDING LIABILITY FOR INFRINGEMENT OF ANY PATENTS, &n;   COPYRIGHTS, TRADEMARKS OR OTHER RIGHTS, RELATING TO USE OF THIS &n;   SOFTWARE IS DISCLAIMED.&n;*/
multiline_comment|/* &n;   RPN support    -    Dirk Husemann &lt;hud@zurich.ibm.com&gt;&n;*/
multiline_comment|/*&n; * Bluetooth RFCOMM core.&n; *&n; * $Id: core.c,v 1.42 2002/10/01 23:26:25 maxk Exp $&n; */
DECL|macro|__KERNEL_SYSCALLS__
mdefine_line|#define __KERNEL_SYSCALLS__
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/signal.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/wait.h&gt;
macro_line|#include &lt;linux/net.h&gt;
macro_line|#include &lt;linux/proc_fs.h&gt;
macro_line|#include &lt;linux/seq_file.h&gt;
macro_line|#include &lt;net/sock.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;asm/unaligned.h&gt;
macro_line|#include &lt;net/bluetooth/bluetooth.h&gt;
macro_line|#include &lt;net/bluetooth/l2cap.h&gt;
macro_line|#include &lt;net/bluetooth/rfcomm.h&gt;
DECL|macro|VERSION
mdefine_line|#define VERSION &quot;1.1&quot;
macro_line|#ifndef CONFIG_BT_RFCOMM_DEBUG
DECL|macro|BT_DBG
macro_line|#undef  BT_DBG
DECL|macro|BT_DBG
mdefine_line|#define BT_DBG(D...)
macro_line|#endif
macro_line|#ifdef CONFIG_PROC_FS
DECL|variable|proc_bt_rfcomm
r_struct
id|proc_dir_entry
op_star
id|proc_bt_rfcomm
suffix:semicolon
macro_line|#endif
DECL|variable|rfcomm_thread
r_struct
id|task_struct
op_star
id|rfcomm_thread
suffix:semicolon
DECL|variable|rfcomm_sem
id|DECLARE_MUTEX
c_func
(paren
id|rfcomm_sem
)paren
suffix:semicolon
DECL|variable|rfcomm_event
r_int
r_int
id|rfcomm_event
suffix:semicolon
r_static
id|LIST_HEAD
c_func
(paren
id|session_list
)paren
suffix:semicolon
DECL|variable|terminate
DECL|variable|running
r_static
id|atomic_t
id|terminate
comma
id|running
suffix:semicolon
r_static
r_int
id|rfcomm_send_frame
c_func
(paren
r_struct
id|rfcomm_session
op_star
id|s
comma
id|u8
op_star
id|data
comma
r_int
id|len
)paren
suffix:semicolon
r_static
r_int
id|rfcomm_send_sabm
c_func
(paren
r_struct
id|rfcomm_session
op_star
id|s
comma
id|u8
id|dlci
)paren
suffix:semicolon
r_static
r_int
id|rfcomm_send_disc
c_func
(paren
r_struct
id|rfcomm_session
op_star
id|s
comma
id|u8
id|dlci
)paren
suffix:semicolon
r_static
r_int
id|rfcomm_queue_disc
c_func
(paren
r_struct
id|rfcomm_dlc
op_star
id|d
)paren
suffix:semicolon
r_static
r_int
id|rfcomm_send_nsc
c_func
(paren
r_struct
id|rfcomm_session
op_star
id|s
comma
r_int
id|cr
comma
id|u8
id|type
)paren
suffix:semicolon
r_static
r_int
id|rfcomm_send_pn
c_func
(paren
r_struct
id|rfcomm_session
op_star
id|s
comma
r_int
id|cr
comma
r_struct
id|rfcomm_dlc
op_star
id|d
)paren
suffix:semicolon
r_static
r_int
id|rfcomm_send_msc
c_func
(paren
r_struct
id|rfcomm_session
op_star
id|s
comma
r_int
id|cr
comma
id|u8
id|dlci
comma
id|u8
id|v24_sig
)paren
suffix:semicolon
r_static
r_int
id|rfcomm_send_test
c_func
(paren
r_struct
id|rfcomm_session
op_star
id|s
comma
r_int
id|cr
comma
id|u8
op_star
id|pattern
comma
r_int
id|len
)paren
suffix:semicolon
r_static
r_int
id|rfcomm_send_credits
c_func
(paren
r_struct
id|rfcomm_session
op_star
id|s
comma
id|u8
id|addr
comma
id|u8
id|credits
)paren
suffix:semicolon
r_static
r_void
id|rfcomm_make_uih
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
id|u8
id|addr
)paren
suffix:semicolon
r_static
r_void
id|rfcomm_process_connect
c_func
(paren
r_struct
id|rfcomm_session
op_star
id|s
)paren
suffix:semicolon
multiline_comment|/* ---- RFCOMM frame parsing macros ---- */
DECL|macro|__get_dlci
mdefine_line|#define __get_dlci(b)     ((b &amp; 0xfc) &gt;&gt; 2)
DECL|macro|__get_channel
mdefine_line|#define __get_channel(b)  ((b &amp; 0xf8) &gt;&gt; 3)
DECL|macro|__get_dir
mdefine_line|#define __get_dir(b)      ((b &amp; 0x04) &gt;&gt; 2)
DECL|macro|__get_type
mdefine_line|#define __get_type(b)     ((b &amp; 0xef))
DECL|macro|__test_ea
mdefine_line|#define __test_ea(b)      ((b &amp; 0x01))
DECL|macro|__test_cr
mdefine_line|#define __test_cr(b)      ((b &amp; 0x02))
DECL|macro|__test_pf
mdefine_line|#define __test_pf(b)      ((b &amp; 0x10))
DECL|macro|__addr
mdefine_line|#define __addr(cr, dlci)       (((dlci &amp; 0x3f) &lt;&lt; 2) | (cr &lt;&lt; 1) | 0x01)
DECL|macro|__ctrl
mdefine_line|#define __ctrl(type, pf)       (((type &amp; 0xef) | (pf &lt;&lt; 4)))
DECL|macro|__dlci
mdefine_line|#define __dlci(dir, chn)       (((chn &amp; 0x1f) &lt;&lt; 1) | dir)
DECL|macro|__srv_channel
mdefine_line|#define __srv_channel(dlci)    (dlci &gt;&gt; 1)
DECL|macro|__dir
mdefine_line|#define __dir(dlci)            (dlci &amp; 0x01)
DECL|macro|__len8
mdefine_line|#define __len8(len)       (((len) &lt;&lt; 1) | 1)
DECL|macro|__len16
mdefine_line|#define __len16(len)      ((len) &lt;&lt; 1)
multiline_comment|/* MCC macros */
DECL|macro|__mcc_type
mdefine_line|#define __mcc_type(cr, type)   (((type &lt;&lt; 2) | (cr &lt;&lt; 1) | 0x01))
DECL|macro|__get_mcc_type
mdefine_line|#define __get_mcc_type(b) ((b &amp; 0xfc) &gt;&gt; 2)
DECL|macro|__get_mcc_len
mdefine_line|#define __get_mcc_len(b)  ((b &amp; 0xfe) &gt;&gt; 1)
multiline_comment|/* RPN macros */
DECL|macro|__rpn_line_settings
mdefine_line|#define __rpn_line_settings(data, stop, parity)  ((data &amp; 0x3) | ((stop &amp; 0x1) &lt;&lt; 2) | ((parity &amp; 0x3) &lt;&lt; 3))
DECL|macro|__get_rpn_data_bits
mdefine_line|#define __get_rpn_data_bits(line) ((line) &amp; 0x3)
DECL|macro|__get_rpn_stop_bits
mdefine_line|#define __get_rpn_stop_bits(line) (((line) &gt;&gt; 2) &amp; 0x1)
DECL|macro|__get_rpn_parity
mdefine_line|#define __get_rpn_parity(line)    (((line) &gt;&gt; 3) &amp; 0x3)
multiline_comment|/* ---- RFCOMM FCS computation ---- */
multiline_comment|/* CRC on 2 bytes */
DECL|macro|__crc
mdefine_line|#define __crc(data) (rfcomm_crc_table[rfcomm_crc_table[0xff ^ data[0]] ^ data[1]])
multiline_comment|/* FCS on 2 bytes */
DECL|function|__fcs
r_static
r_inline
id|u8
id|__fcs
c_func
(paren
id|u8
op_star
id|data
)paren
(brace
r_return
(paren
l_int|0xff
op_minus
id|__crc
c_func
(paren
id|data
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/* FCS on 3 bytes */
DECL|function|__fcs2
r_static
r_inline
id|u8
id|__fcs2
c_func
(paren
id|u8
op_star
id|data
)paren
(brace
r_return
(paren
l_int|0xff
op_minus
id|rfcomm_crc_table
(braket
id|__crc
c_func
(paren
id|data
)paren
op_xor
id|data
(braket
l_int|2
)braket
)braket
)paren
suffix:semicolon
)brace
multiline_comment|/* Check FCS */
DECL|function|__check_fcs
r_static
r_inline
r_int
id|__check_fcs
c_func
(paren
id|u8
op_star
id|data
comma
r_int
id|type
comma
id|u8
id|fcs
)paren
(brace
id|u8
id|f
op_assign
id|__crc
c_func
(paren
id|data
)paren
suffix:semicolon
r_if
c_cond
(paren
id|type
op_ne
id|RFCOMM_UIH
)paren
id|f
op_assign
id|rfcomm_crc_table
(braket
id|f
op_xor
id|data
(braket
l_int|2
)braket
)braket
suffix:semicolon
r_return
id|rfcomm_crc_table
(braket
id|f
op_xor
id|fcs
)braket
op_ne
l_int|0xcf
suffix:semicolon
)brace
multiline_comment|/* ---- L2CAP callbacks ---- */
DECL|function|rfcomm_l2state_change
r_static
r_void
id|rfcomm_l2state_change
c_func
(paren
r_struct
id|sock
op_star
id|sk
)paren
(brace
id|BT_DBG
c_func
(paren
l_string|&quot;%p state %d&quot;
comma
id|sk
comma
id|sk-&gt;sk_state
)paren
suffix:semicolon
id|rfcomm_schedule
c_func
(paren
id|RFCOMM_SCHED_STATE
)paren
suffix:semicolon
)brace
DECL|function|rfcomm_l2data_ready
r_static
r_void
id|rfcomm_l2data_ready
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_int
id|bytes
)paren
(brace
id|BT_DBG
c_func
(paren
l_string|&quot;%p bytes %d&quot;
comma
id|sk
comma
id|bytes
)paren
suffix:semicolon
id|rfcomm_schedule
c_func
(paren
id|RFCOMM_SCHED_RX
)paren
suffix:semicolon
)brace
DECL|function|rfcomm_l2sock_create
r_static
r_int
id|rfcomm_l2sock_create
c_func
(paren
r_struct
id|socket
op_star
op_star
id|sock
)paren
(brace
r_int
id|err
suffix:semicolon
id|BT_DBG
c_func
(paren
l_string|&quot;&quot;
)paren
suffix:semicolon
id|err
op_assign
id|sock_create
c_func
(paren
id|PF_BLUETOOTH
comma
id|SOCK_SEQPACKET
comma
id|BTPROTO_L2CAP
comma
id|sock
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|err
)paren
(brace
r_struct
id|sock
op_star
id|sk
op_assign
(paren
op_star
id|sock
)paren
op_member_access_from_pointer
id|sk
suffix:semicolon
id|sk-&gt;sk_data_ready
op_assign
id|rfcomm_l2data_ready
suffix:semicolon
id|sk-&gt;sk_state_change
op_assign
id|rfcomm_l2state_change
suffix:semicolon
)brace
r_return
id|err
suffix:semicolon
)brace
multiline_comment|/* ---- RFCOMM DLCs ---- */
DECL|function|rfcomm_dlc_timeout
r_static
r_void
id|rfcomm_dlc_timeout
c_func
(paren
r_int
r_int
id|arg
)paren
(brace
r_struct
id|rfcomm_dlc
op_star
id|d
op_assign
(paren
r_void
op_star
)paren
id|arg
suffix:semicolon
id|BT_DBG
c_func
(paren
l_string|&quot;dlc %p state %ld&quot;
comma
id|d
comma
id|d-&gt;state
)paren
suffix:semicolon
id|set_bit
c_func
(paren
id|RFCOMM_TIMED_OUT
comma
op_amp
id|d-&gt;flags
)paren
suffix:semicolon
id|rfcomm_dlc_put
c_func
(paren
id|d
)paren
suffix:semicolon
id|rfcomm_schedule
c_func
(paren
id|RFCOMM_SCHED_TIMEO
)paren
suffix:semicolon
)brace
DECL|function|rfcomm_dlc_set_timer
r_static
r_void
id|rfcomm_dlc_set_timer
c_func
(paren
r_struct
id|rfcomm_dlc
op_star
id|d
comma
r_int
id|timeout
)paren
(brace
id|BT_DBG
c_func
(paren
l_string|&quot;dlc %p state %ld timeout %ld&quot;
comma
id|d
comma
id|d-&gt;state
comma
id|timeout
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|mod_timer
c_func
(paren
op_amp
id|d-&gt;timer
comma
id|jiffies
op_plus
id|timeout
)paren
)paren
id|rfcomm_dlc_hold
c_func
(paren
id|d
)paren
suffix:semicolon
)brace
DECL|function|rfcomm_dlc_clear_timer
r_static
r_void
id|rfcomm_dlc_clear_timer
c_func
(paren
r_struct
id|rfcomm_dlc
op_star
id|d
)paren
(brace
id|BT_DBG
c_func
(paren
l_string|&quot;dlc %p state %ld&quot;
comma
id|d
comma
id|d-&gt;state
)paren
suffix:semicolon
r_if
c_cond
(paren
id|timer_pending
c_func
(paren
op_amp
id|d-&gt;timer
)paren
op_logical_and
id|del_timer
c_func
(paren
op_amp
id|d-&gt;timer
)paren
)paren
id|rfcomm_dlc_put
c_func
(paren
id|d
)paren
suffix:semicolon
)brace
DECL|function|rfcomm_dlc_clear_state
r_static
r_void
id|rfcomm_dlc_clear_state
c_func
(paren
r_struct
id|rfcomm_dlc
op_star
id|d
)paren
(brace
id|BT_DBG
c_func
(paren
l_string|&quot;%p&quot;
comma
id|d
)paren
suffix:semicolon
id|d-&gt;state
op_assign
id|BT_OPEN
suffix:semicolon
id|d-&gt;flags
op_assign
l_int|0
suffix:semicolon
id|d-&gt;mscex
op_assign
l_int|0
suffix:semicolon
id|d-&gt;mtu
op_assign
id|RFCOMM_DEFAULT_MTU
suffix:semicolon
id|d-&gt;v24_sig
op_assign
id|RFCOMM_V24_RTC
op_or
id|RFCOMM_V24_RTR
op_or
id|RFCOMM_V24_DV
suffix:semicolon
id|d-&gt;cfc
op_assign
id|RFCOMM_CFC_DISABLED
suffix:semicolon
id|d-&gt;rx_credits
op_assign
id|RFCOMM_DEFAULT_CREDITS
suffix:semicolon
)brace
DECL|function|rfcomm_dlc_alloc
r_struct
id|rfcomm_dlc
op_star
id|rfcomm_dlc_alloc
c_func
(paren
r_int
id|prio
)paren
(brace
r_struct
id|rfcomm_dlc
op_star
id|d
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|d
)paren
comma
id|prio
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|d
)paren
r_return
l_int|NULL
suffix:semicolon
id|memset
c_func
(paren
id|d
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|d
)paren
)paren
suffix:semicolon
id|init_timer
c_func
(paren
op_amp
id|d-&gt;timer
)paren
suffix:semicolon
id|d-&gt;timer.function
op_assign
id|rfcomm_dlc_timeout
suffix:semicolon
id|d-&gt;timer.data
op_assign
(paren
r_int
r_int
)paren
id|d
suffix:semicolon
id|skb_queue_head_init
c_func
(paren
op_amp
id|d-&gt;tx_queue
)paren
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|d-&gt;lock
)paren
suffix:semicolon
id|atomic_set
c_func
(paren
op_amp
id|d-&gt;refcnt
comma
l_int|1
)paren
suffix:semicolon
id|rfcomm_dlc_clear_state
c_func
(paren
id|d
)paren
suffix:semicolon
id|BT_DBG
c_func
(paren
l_string|&quot;%p&quot;
comma
id|d
)paren
suffix:semicolon
r_return
id|d
suffix:semicolon
)brace
DECL|function|rfcomm_dlc_free
r_void
id|rfcomm_dlc_free
c_func
(paren
r_struct
id|rfcomm_dlc
op_star
id|d
)paren
(brace
id|BT_DBG
c_func
(paren
l_string|&quot;%p&quot;
comma
id|d
)paren
suffix:semicolon
id|skb_queue_purge
c_func
(paren
op_amp
id|d-&gt;tx_queue
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|d
)paren
suffix:semicolon
)brace
DECL|function|rfcomm_dlc_link
r_static
r_void
id|rfcomm_dlc_link
c_func
(paren
r_struct
id|rfcomm_session
op_star
id|s
comma
r_struct
id|rfcomm_dlc
op_star
id|d
)paren
(brace
id|BT_DBG
c_func
(paren
l_string|&quot;dlc %p session %p&quot;
comma
id|d
comma
id|s
)paren
suffix:semicolon
id|rfcomm_session_hold
c_func
(paren
id|s
)paren
suffix:semicolon
id|rfcomm_dlc_hold
c_func
(paren
id|d
)paren
suffix:semicolon
id|list_add
c_func
(paren
op_amp
id|d-&gt;list
comma
op_amp
id|s-&gt;dlcs
)paren
suffix:semicolon
id|d-&gt;session
op_assign
id|s
suffix:semicolon
)brace
DECL|function|rfcomm_dlc_unlink
r_static
r_void
id|rfcomm_dlc_unlink
c_func
(paren
r_struct
id|rfcomm_dlc
op_star
id|d
)paren
(brace
r_struct
id|rfcomm_session
op_star
id|s
op_assign
id|d-&gt;session
suffix:semicolon
id|BT_DBG
c_func
(paren
l_string|&quot;dlc %p refcnt %d session %p&quot;
comma
id|d
comma
id|atomic_read
c_func
(paren
op_amp
id|d-&gt;refcnt
)paren
comma
id|s
)paren
suffix:semicolon
id|list_del
c_func
(paren
op_amp
id|d-&gt;list
)paren
suffix:semicolon
id|d-&gt;session
op_assign
l_int|NULL
suffix:semicolon
id|rfcomm_dlc_put
c_func
(paren
id|d
)paren
suffix:semicolon
id|rfcomm_session_put
c_func
(paren
id|s
)paren
suffix:semicolon
)brace
DECL|function|rfcomm_dlc_get
r_static
r_struct
id|rfcomm_dlc
op_star
id|rfcomm_dlc_get
c_func
(paren
r_struct
id|rfcomm_session
op_star
id|s
comma
id|u8
id|dlci
)paren
(brace
r_struct
id|rfcomm_dlc
op_star
id|d
suffix:semicolon
r_struct
id|list_head
op_star
id|p
suffix:semicolon
id|list_for_each
c_func
(paren
id|p
comma
op_amp
id|s-&gt;dlcs
)paren
(brace
id|d
op_assign
id|list_entry
c_func
(paren
id|p
comma
r_struct
id|rfcomm_dlc
comma
id|list
)paren
suffix:semicolon
r_if
c_cond
(paren
id|d-&gt;dlci
op_eq
id|dlci
)paren
r_return
id|d
suffix:semicolon
)brace
r_return
l_int|NULL
suffix:semicolon
)brace
DECL|function|__rfcomm_dlc_open
r_static
r_int
id|__rfcomm_dlc_open
c_func
(paren
r_struct
id|rfcomm_dlc
op_star
id|d
comma
id|bdaddr_t
op_star
id|src
comma
id|bdaddr_t
op_star
id|dst
comma
id|u8
id|channel
)paren
(brace
r_struct
id|rfcomm_session
op_star
id|s
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
id|u8
id|dlci
suffix:semicolon
id|BT_DBG
c_func
(paren
l_string|&quot;dlc %p state %ld %s %s channel %d&quot;
comma
id|d
comma
id|d-&gt;state
comma
id|batostr
c_func
(paren
id|src
)paren
comma
id|batostr
c_func
(paren
id|dst
)paren
comma
id|channel
)paren
suffix:semicolon
r_if
c_cond
(paren
id|channel
template_param
l_int|30
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|d-&gt;state
op_ne
id|BT_OPEN
op_logical_and
id|d-&gt;state
op_ne
id|BT_CLOSED
)paren
r_return
l_int|0
suffix:semicolon
id|s
op_assign
id|rfcomm_session_get
c_func
(paren
id|src
comma
id|dst
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|s
)paren
(brace
id|s
op_assign
id|rfcomm_session_create
c_func
(paren
id|src
comma
id|dst
comma
op_amp
id|err
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|s
)paren
r_return
id|err
suffix:semicolon
)brace
id|dlci
op_assign
id|__dlci
c_func
(paren
op_logical_neg
id|s-&gt;initiator
comma
id|channel
)paren
suffix:semicolon
multiline_comment|/* Check if DLCI already exists */
r_if
c_cond
(paren
id|rfcomm_dlc_get
c_func
(paren
id|s
comma
id|dlci
)paren
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
id|rfcomm_dlc_clear_state
c_func
(paren
id|d
)paren
suffix:semicolon
id|d-&gt;dlci
op_assign
id|dlci
suffix:semicolon
id|d-&gt;addr
op_assign
id|__addr
c_func
(paren
id|s-&gt;initiator
comma
id|dlci
)paren
suffix:semicolon
id|d-&gt;priority
op_assign
l_int|7
suffix:semicolon
id|d-&gt;state
op_assign
id|BT_CONFIG
suffix:semicolon
id|rfcomm_dlc_link
c_func
(paren
id|s
comma
id|d
)paren
suffix:semicolon
id|d-&gt;mtu
op_assign
id|s-&gt;mtu
suffix:semicolon
id|d-&gt;cfc
op_assign
(paren
id|s-&gt;cfc
op_eq
id|RFCOMM_CFC_UNKNOWN
)paren
ques
c_cond
l_int|0
suffix:colon
id|s-&gt;cfc
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;state
op_eq
id|BT_CONNECTED
)paren
id|rfcomm_send_pn
c_func
(paren
id|s
comma
l_int|1
comma
id|d
)paren
suffix:semicolon
id|rfcomm_dlc_set_timer
c_func
(paren
id|d
comma
id|RFCOMM_CONN_TIMEOUT
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|rfcomm_dlc_open
r_int
id|rfcomm_dlc_open
c_func
(paren
r_struct
id|rfcomm_dlc
op_star
id|d
comma
id|bdaddr_t
op_star
id|src
comma
id|bdaddr_t
op_star
id|dst
comma
id|u8
id|channel
)paren
(brace
id|mm_segment_t
id|fs
suffix:semicolon
r_int
id|r
suffix:semicolon
id|rfcomm_lock
c_func
(paren
)paren
suffix:semicolon
id|fs
op_assign
id|get_fs
c_func
(paren
)paren
suffix:semicolon
id|set_fs
c_func
(paren
id|KERNEL_DS
)paren
suffix:semicolon
id|r
op_assign
id|__rfcomm_dlc_open
c_func
(paren
id|d
comma
id|src
comma
id|dst
comma
id|channel
)paren
suffix:semicolon
id|set_fs
c_func
(paren
id|fs
)paren
suffix:semicolon
id|rfcomm_unlock
c_func
(paren
)paren
suffix:semicolon
r_return
id|r
suffix:semicolon
)brace
DECL|function|__rfcomm_dlc_close
r_static
r_int
id|__rfcomm_dlc_close
c_func
(paren
r_struct
id|rfcomm_dlc
op_star
id|d
comma
r_int
id|err
)paren
(brace
r_struct
id|rfcomm_session
op_star
id|s
op_assign
id|d-&gt;session
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|s
)paren
r_return
l_int|0
suffix:semicolon
id|BT_DBG
c_func
(paren
l_string|&quot;dlc %p state %ld dlci %d err %d session %p&quot;
comma
id|d
comma
id|d-&gt;state
comma
id|d-&gt;dlci
comma
id|err
comma
id|s
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|d-&gt;state
)paren
(brace
r_case
id|BT_CONNECTED
suffix:colon
r_case
id|BT_CONFIG
suffix:colon
r_case
id|BT_CONNECT
suffix:colon
id|d-&gt;state
op_assign
id|BT_DISCONN
suffix:semicolon
r_if
c_cond
(paren
id|skb_queue_empty
c_func
(paren
op_amp
id|d-&gt;tx_queue
)paren
)paren
(brace
id|rfcomm_send_disc
c_func
(paren
id|s
comma
id|d-&gt;dlci
)paren
suffix:semicolon
id|rfcomm_dlc_set_timer
c_func
(paren
id|d
comma
id|RFCOMM_DISC_TIMEOUT
)paren
suffix:semicolon
)brace
r_else
(brace
id|rfcomm_queue_disc
c_func
(paren
id|d
)paren
suffix:semicolon
id|rfcomm_dlc_set_timer
c_func
(paren
id|d
comma
id|RFCOMM_DISC_TIMEOUT
op_star
l_int|2
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_default
suffix:colon
id|rfcomm_dlc_clear_timer
c_func
(paren
id|d
)paren
suffix:semicolon
id|rfcomm_dlc_lock
c_func
(paren
id|d
)paren
suffix:semicolon
id|d-&gt;state
op_assign
id|BT_CLOSED
suffix:semicolon
id|d
op_member_access_from_pointer
id|state_change
c_func
(paren
id|d
comma
id|err
)paren
suffix:semicolon
id|rfcomm_dlc_unlock
c_func
(paren
id|d
)paren
suffix:semicolon
id|skb_queue_purge
c_func
(paren
op_amp
id|d-&gt;tx_queue
)paren
suffix:semicolon
id|rfcomm_dlc_unlink
c_func
(paren
id|d
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|rfcomm_dlc_close
r_int
id|rfcomm_dlc_close
c_func
(paren
r_struct
id|rfcomm_dlc
op_star
id|d
comma
r_int
id|err
)paren
(brace
id|mm_segment_t
id|fs
suffix:semicolon
r_int
id|r
suffix:semicolon
id|rfcomm_lock
c_func
(paren
)paren
suffix:semicolon
id|fs
op_assign
id|get_fs
c_func
(paren
)paren
suffix:semicolon
id|set_fs
c_func
(paren
id|KERNEL_DS
)paren
suffix:semicolon
id|r
op_assign
id|__rfcomm_dlc_close
c_func
(paren
id|d
comma
id|err
)paren
suffix:semicolon
id|set_fs
c_func
(paren
id|fs
)paren
suffix:semicolon
id|rfcomm_unlock
c_func
(paren
)paren
suffix:semicolon
r_return
id|r
suffix:semicolon
)brace
DECL|function|rfcomm_dlc_send
r_int
id|rfcomm_dlc_send
c_func
(paren
r_struct
id|rfcomm_dlc
op_star
id|d
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_int
id|len
op_assign
id|skb-&gt;len
suffix:semicolon
r_if
c_cond
(paren
id|d-&gt;state
op_ne
id|BT_CONNECTED
)paren
r_return
op_minus
id|ENOTCONN
suffix:semicolon
id|BT_DBG
c_func
(paren
l_string|&quot;dlc %p mtu %d len %d&quot;
comma
id|d
comma
id|d-&gt;mtu
comma
id|len
)paren
suffix:semicolon
r_if
c_cond
(paren
id|len
OG
id|d-&gt;mtu
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|rfcomm_make_uih
c_func
(paren
id|skb
comma
id|d-&gt;addr
)paren
suffix:semicolon
id|skb_queue_tail
c_func
(paren
op_amp
id|d-&gt;tx_queue
comma
id|skb
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|test_bit
c_func
(paren
id|RFCOMM_TX_THROTTLED
comma
op_amp
id|d-&gt;flags
)paren
)paren
id|rfcomm_schedule
c_func
(paren
id|RFCOMM_SCHED_TX
)paren
suffix:semicolon
r_return
id|len
suffix:semicolon
)brace
DECL|function|__rfcomm_dlc_throttle
r_void
id|__rfcomm_dlc_throttle
c_func
(paren
r_struct
id|rfcomm_dlc
op_star
id|d
)paren
(brace
id|BT_DBG
c_func
(paren
l_string|&quot;dlc %p state %ld&quot;
comma
id|d
comma
id|d-&gt;state
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|d-&gt;cfc
)paren
(brace
id|d-&gt;v24_sig
op_or_assign
id|RFCOMM_V24_FC
suffix:semicolon
id|set_bit
c_func
(paren
id|RFCOMM_MSC_PENDING
comma
op_amp
id|d-&gt;flags
)paren
suffix:semicolon
)brace
id|rfcomm_schedule
c_func
(paren
id|RFCOMM_SCHED_TX
)paren
suffix:semicolon
)brace
DECL|function|__rfcomm_dlc_unthrottle
r_void
id|__rfcomm_dlc_unthrottle
c_func
(paren
r_struct
id|rfcomm_dlc
op_star
id|d
)paren
(brace
id|BT_DBG
c_func
(paren
l_string|&quot;dlc %p state %ld&quot;
comma
id|d
comma
id|d-&gt;state
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|d-&gt;cfc
)paren
(brace
id|d-&gt;v24_sig
op_and_assign
op_complement
id|RFCOMM_V24_FC
suffix:semicolon
id|set_bit
c_func
(paren
id|RFCOMM_MSC_PENDING
comma
op_amp
id|d-&gt;flags
)paren
suffix:semicolon
)brace
id|rfcomm_schedule
c_func
(paren
id|RFCOMM_SCHED_TX
)paren
suffix:semicolon
)brace
multiline_comment|/* &n;   Set/get modem status functions use _local_ status i.e. what we report&n;   to the other side.&n;   Remote status is provided by dlc-&gt;modem_status() callback.&n; */
DECL|function|rfcomm_dlc_set_modem_status
r_int
id|rfcomm_dlc_set_modem_status
c_func
(paren
r_struct
id|rfcomm_dlc
op_star
id|d
comma
id|u8
id|v24_sig
)paren
(brace
id|BT_DBG
c_func
(paren
l_string|&quot;dlc %p state %ld v24_sig 0x%x&quot;
comma
id|d
comma
id|d-&gt;state
comma
id|v24_sig
)paren
suffix:semicolon
r_if
c_cond
(paren
id|test_bit
c_func
(paren
id|RFCOMM_RX_THROTTLED
comma
op_amp
id|d-&gt;flags
)paren
)paren
id|v24_sig
op_or_assign
id|RFCOMM_V24_FC
suffix:semicolon
r_else
id|v24_sig
op_and_assign
op_complement
id|RFCOMM_V24_FC
suffix:semicolon
id|d-&gt;v24_sig
op_assign
id|v24_sig
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|test_and_set_bit
c_func
(paren
id|RFCOMM_MSC_PENDING
comma
op_amp
id|d-&gt;flags
)paren
)paren
id|rfcomm_schedule
c_func
(paren
id|RFCOMM_SCHED_TX
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|rfcomm_dlc_get_modem_status
r_int
id|rfcomm_dlc_get_modem_status
c_func
(paren
r_struct
id|rfcomm_dlc
op_star
id|d
comma
id|u8
op_star
id|v24_sig
)paren
(brace
id|BT_DBG
c_func
(paren
l_string|&quot;dlc %p state %ld v24_sig 0x%x&quot;
comma
id|d
comma
id|d-&gt;state
comma
id|d-&gt;v24_sig
)paren
suffix:semicolon
op_star
id|v24_sig
op_assign
id|d-&gt;v24_sig
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* ---- RFCOMM sessions ---- */
DECL|function|rfcomm_session_add
r_struct
id|rfcomm_session
op_star
id|rfcomm_session_add
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_int
id|state
)paren
(brace
r_struct
id|rfcomm_session
op_star
id|s
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|s
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|s
)paren
r_return
l_int|NULL
suffix:semicolon
id|memset
c_func
(paren
id|s
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|s
)paren
)paren
suffix:semicolon
id|BT_DBG
c_func
(paren
l_string|&quot;session %p sock %p&quot;
comma
id|s
comma
id|sock
)paren
suffix:semicolon
id|INIT_LIST_HEAD
c_func
(paren
op_amp
id|s-&gt;dlcs
)paren
suffix:semicolon
id|s-&gt;state
op_assign
id|state
suffix:semicolon
id|s-&gt;sock
op_assign
id|sock
suffix:semicolon
id|s-&gt;mtu
op_assign
id|RFCOMM_DEFAULT_MTU
suffix:semicolon
id|s-&gt;cfc
op_assign
id|RFCOMM_CFC_UNKNOWN
suffix:semicolon
id|list_add
c_func
(paren
op_amp
id|s-&gt;list
comma
op_amp
id|session_list
)paren
suffix:semicolon
multiline_comment|/* Do not increment module usage count for listeting sessions.&n;&t; * Otherwise we won&squot;t be able to unload the module.&n;&t; * Non listening session are added either by a socket or a TTYs&n;&t; * which means that we already hold refcount to this module.&n;&t; */
r_if
c_cond
(paren
id|state
op_ne
id|BT_LISTEN
)paren
id|__module_get
c_func
(paren
id|THIS_MODULE
)paren
suffix:semicolon
r_return
id|s
suffix:semicolon
)brace
DECL|function|rfcomm_session_del
r_void
id|rfcomm_session_del
c_func
(paren
r_struct
id|rfcomm_session
op_star
id|s
)paren
(brace
r_int
id|state
op_assign
id|s-&gt;state
suffix:semicolon
id|BT_DBG
c_func
(paren
l_string|&quot;session %p state %ld&quot;
comma
id|s
comma
id|s-&gt;state
)paren
suffix:semicolon
id|list_del
c_func
(paren
op_amp
id|s-&gt;list
)paren
suffix:semicolon
r_if
c_cond
(paren
id|state
op_eq
id|BT_CONNECTED
)paren
id|rfcomm_send_disc
c_func
(paren
id|s
comma
l_int|0
)paren
suffix:semicolon
id|sock_release
c_func
(paren
id|s-&gt;sock
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|s
)paren
suffix:semicolon
r_if
c_cond
(paren
id|state
op_ne
id|BT_LISTEN
)paren
id|module_put
c_func
(paren
id|THIS_MODULE
)paren
suffix:semicolon
)brace
DECL|function|rfcomm_session_get
r_struct
id|rfcomm_session
op_star
id|rfcomm_session_get
c_func
(paren
id|bdaddr_t
op_star
id|src
comma
id|bdaddr_t
op_star
id|dst
)paren
(brace
r_struct
id|rfcomm_session
op_star
id|s
suffix:semicolon
r_struct
id|list_head
op_star
id|p
comma
op_star
id|n
suffix:semicolon
r_struct
id|bt_sock
op_star
id|sk
suffix:semicolon
id|list_for_each_safe
c_func
(paren
id|p
comma
id|n
comma
op_amp
id|session_list
)paren
(brace
id|s
op_assign
id|list_entry
c_func
(paren
id|p
comma
r_struct
id|rfcomm_session
comma
id|list
)paren
suffix:semicolon
id|sk
op_assign
id|bt_sk
c_func
(paren
id|s-&gt;sock-&gt;sk
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
op_logical_neg
id|bacmp
c_func
(paren
id|src
comma
id|BDADDR_ANY
)paren
op_logical_or
op_logical_neg
id|bacmp
c_func
(paren
op_amp
id|sk-&gt;src
comma
id|src
)paren
)paren
op_logical_and
op_logical_neg
id|bacmp
c_func
(paren
op_amp
id|sk-&gt;dst
comma
id|dst
)paren
)paren
r_return
id|s
suffix:semicolon
)brace
r_return
l_int|NULL
suffix:semicolon
)brace
DECL|function|rfcomm_session_close
r_void
id|rfcomm_session_close
c_func
(paren
r_struct
id|rfcomm_session
op_star
id|s
comma
r_int
id|err
)paren
(brace
r_struct
id|rfcomm_dlc
op_star
id|d
suffix:semicolon
r_struct
id|list_head
op_star
id|p
comma
op_star
id|n
suffix:semicolon
id|BT_DBG
c_func
(paren
l_string|&quot;session %p state %ld err %d&quot;
comma
id|s
comma
id|s-&gt;state
comma
id|err
)paren
suffix:semicolon
id|rfcomm_session_hold
c_func
(paren
id|s
)paren
suffix:semicolon
id|s-&gt;state
op_assign
id|BT_CLOSED
suffix:semicolon
multiline_comment|/* Close all dlcs */
id|list_for_each_safe
c_func
(paren
id|p
comma
id|n
comma
op_amp
id|s-&gt;dlcs
)paren
(brace
id|d
op_assign
id|list_entry
c_func
(paren
id|p
comma
r_struct
id|rfcomm_dlc
comma
id|list
)paren
suffix:semicolon
id|d-&gt;state
op_assign
id|BT_CLOSED
suffix:semicolon
id|__rfcomm_dlc_close
c_func
(paren
id|d
comma
id|err
)paren
suffix:semicolon
)brace
id|rfcomm_session_put
c_func
(paren
id|s
)paren
suffix:semicolon
)brace
DECL|function|rfcomm_session_create
r_struct
id|rfcomm_session
op_star
id|rfcomm_session_create
c_func
(paren
id|bdaddr_t
op_star
id|src
comma
id|bdaddr_t
op_star
id|dst
comma
r_int
op_star
id|err
)paren
(brace
r_struct
id|rfcomm_session
op_star
id|s
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|sockaddr_l2
id|addr
suffix:semicolon
r_struct
id|l2cap_options
id|opts
suffix:semicolon
r_struct
id|socket
op_star
id|sock
suffix:semicolon
r_int
id|size
suffix:semicolon
id|BT_DBG
c_func
(paren
l_string|&quot;%s %s&quot;
comma
id|batostr
c_func
(paren
id|src
)paren
comma
id|batostr
c_func
(paren
id|dst
)paren
)paren
suffix:semicolon
op_star
id|err
op_assign
id|rfcomm_l2sock_create
c_func
(paren
op_amp
id|sock
)paren
suffix:semicolon
r_if
c_cond
(paren
op_star
id|err
OL
l_int|0
)paren
r_return
l_int|NULL
suffix:semicolon
id|bacpy
c_func
(paren
op_amp
id|addr.l2_bdaddr
comma
id|src
)paren
suffix:semicolon
id|addr.l2_family
op_assign
id|AF_BLUETOOTH
suffix:semicolon
id|addr.l2_psm
op_assign
l_int|0
suffix:semicolon
op_star
id|err
op_assign
id|sock-&gt;ops
op_member_access_from_pointer
id|bind
c_func
(paren
id|sock
comma
(paren
r_struct
id|sockaddr
op_star
)paren
op_amp
id|addr
comma
r_sizeof
(paren
id|addr
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_star
id|err
OL
l_int|0
)paren
r_goto
id|failed
suffix:semicolon
multiline_comment|/* Set L2CAP options */
id|size
op_assign
r_sizeof
(paren
id|opts
)paren
suffix:semicolon
id|sock-&gt;ops
op_member_access_from_pointer
id|getsockopt
c_func
(paren
id|sock
comma
id|SOL_L2CAP
comma
id|L2CAP_OPTIONS
comma
(paren
r_void
op_star
)paren
op_amp
id|opts
comma
op_amp
id|size
)paren
suffix:semicolon
id|opts.imtu
op_assign
id|RFCOMM_MAX_L2CAP_MTU
suffix:semicolon
id|sock-&gt;ops
op_member_access_from_pointer
id|setsockopt
c_func
(paren
id|sock
comma
id|SOL_L2CAP
comma
id|L2CAP_OPTIONS
comma
(paren
r_void
op_star
)paren
op_amp
id|opts
comma
id|size
)paren
suffix:semicolon
id|s
op_assign
id|rfcomm_session_add
c_func
(paren
id|sock
comma
id|BT_BOUND
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|s
)paren
(brace
op_star
id|err
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|failed
suffix:semicolon
)brace
id|s-&gt;initiator
op_assign
l_int|1
suffix:semicolon
id|bacpy
c_func
(paren
op_amp
id|addr.l2_bdaddr
comma
id|dst
)paren
suffix:semicolon
id|addr.l2_family
op_assign
id|AF_BLUETOOTH
suffix:semicolon
id|addr.l2_psm
op_assign
id|htobs
c_func
(paren
id|RFCOMM_PSM
)paren
suffix:semicolon
op_star
id|err
op_assign
id|sock-&gt;ops
op_member_access_from_pointer
id|connect
c_func
(paren
id|sock
comma
(paren
r_struct
id|sockaddr
op_star
)paren
op_amp
id|addr
comma
r_sizeof
(paren
id|addr
)paren
comma
id|O_NONBLOCK
)paren
suffix:semicolon
r_if
c_cond
(paren
op_star
id|err
op_eq
l_int|0
op_logical_or
op_star
id|err
op_eq
op_minus
id|EAGAIN
)paren
r_return
id|s
suffix:semicolon
id|rfcomm_session_del
c_func
(paren
id|s
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
id|failed
suffix:colon
id|sock_release
c_func
(paren
id|sock
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
DECL|function|rfcomm_session_getaddr
r_void
id|rfcomm_session_getaddr
c_func
(paren
r_struct
id|rfcomm_session
op_star
id|s
comma
id|bdaddr_t
op_star
id|src
comma
id|bdaddr_t
op_star
id|dst
)paren
(brace
r_struct
id|sock
op_star
id|sk
op_assign
id|s-&gt;sock-&gt;sk
suffix:semicolon
r_if
c_cond
(paren
id|src
)paren
id|bacpy
c_func
(paren
id|src
comma
op_amp
id|bt_sk
c_func
(paren
id|sk
)paren
op_member_access_from_pointer
id|src
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dst
)paren
id|bacpy
c_func
(paren
id|dst
comma
op_amp
id|bt_sk
c_func
(paren
id|sk
)paren
op_member_access_from_pointer
id|dst
)paren
suffix:semicolon
)brace
multiline_comment|/* ---- RFCOMM frame sending ---- */
DECL|function|rfcomm_send_frame
r_static
r_int
id|rfcomm_send_frame
c_func
(paren
r_struct
id|rfcomm_session
op_star
id|s
comma
id|u8
op_star
id|data
comma
r_int
id|len
)paren
(brace
r_struct
id|socket
op_star
id|sock
op_assign
id|s-&gt;sock
suffix:semicolon
r_struct
id|iovec
id|iv
op_assign
(brace
id|data
comma
id|len
)brace
suffix:semicolon
r_struct
id|msghdr
id|msg
suffix:semicolon
id|BT_DBG
c_func
(paren
l_string|&quot;session %p len %d&quot;
comma
id|s
comma
id|len
)paren
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|msg
comma
l_int|0
comma
r_sizeof
(paren
id|msg
)paren
)paren
suffix:semicolon
id|msg.msg_iovlen
op_assign
l_int|1
suffix:semicolon
id|msg.msg_iov
op_assign
op_amp
id|iv
suffix:semicolon
r_return
id|sock_sendmsg
c_func
(paren
id|sock
comma
op_amp
id|msg
comma
id|len
)paren
suffix:semicolon
)brace
DECL|function|rfcomm_send_sabm
r_static
r_int
id|rfcomm_send_sabm
c_func
(paren
r_struct
id|rfcomm_session
op_star
id|s
comma
id|u8
id|dlci
)paren
(brace
r_struct
id|rfcomm_cmd
id|cmd
suffix:semicolon
id|BT_DBG
c_func
(paren
l_string|&quot;%p dlci %d&quot;
comma
id|s
comma
id|dlci
)paren
suffix:semicolon
id|cmd.addr
op_assign
id|__addr
c_func
(paren
id|s-&gt;initiator
comma
id|dlci
)paren
suffix:semicolon
id|cmd.ctrl
op_assign
id|__ctrl
c_func
(paren
id|RFCOMM_SABM
comma
l_int|1
)paren
suffix:semicolon
id|cmd.len
op_assign
id|__len8
c_func
(paren
l_int|0
)paren
suffix:semicolon
id|cmd.fcs
op_assign
id|__fcs2
c_func
(paren
(paren
id|u8
op_star
)paren
op_amp
id|cmd
)paren
suffix:semicolon
r_return
id|rfcomm_send_frame
c_func
(paren
id|s
comma
(paren
r_void
op_star
)paren
op_amp
id|cmd
comma
r_sizeof
(paren
id|cmd
)paren
)paren
suffix:semicolon
)brace
DECL|function|rfcomm_send_ua
r_static
r_int
id|rfcomm_send_ua
c_func
(paren
r_struct
id|rfcomm_session
op_star
id|s
comma
id|u8
id|dlci
)paren
(brace
r_struct
id|rfcomm_cmd
id|cmd
suffix:semicolon
id|BT_DBG
c_func
(paren
l_string|&quot;%p dlci %d&quot;
comma
id|s
comma
id|dlci
)paren
suffix:semicolon
id|cmd.addr
op_assign
id|__addr
c_func
(paren
op_logical_neg
id|s-&gt;initiator
comma
id|dlci
)paren
suffix:semicolon
id|cmd.ctrl
op_assign
id|__ctrl
c_func
(paren
id|RFCOMM_UA
comma
l_int|1
)paren
suffix:semicolon
id|cmd.len
op_assign
id|__len8
c_func
(paren
l_int|0
)paren
suffix:semicolon
id|cmd.fcs
op_assign
id|__fcs2
c_func
(paren
(paren
id|u8
op_star
)paren
op_amp
id|cmd
)paren
suffix:semicolon
r_return
id|rfcomm_send_frame
c_func
(paren
id|s
comma
(paren
r_void
op_star
)paren
op_amp
id|cmd
comma
r_sizeof
(paren
id|cmd
)paren
)paren
suffix:semicolon
)brace
DECL|function|rfcomm_send_disc
r_static
r_int
id|rfcomm_send_disc
c_func
(paren
r_struct
id|rfcomm_session
op_star
id|s
comma
id|u8
id|dlci
)paren
(brace
r_struct
id|rfcomm_cmd
id|cmd
suffix:semicolon
id|BT_DBG
c_func
(paren
l_string|&quot;%p dlci %d&quot;
comma
id|s
comma
id|dlci
)paren
suffix:semicolon
id|cmd.addr
op_assign
id|__addr
c_func
(paren
id|s-&gt;initiator
comma
id|dlci
)paren
suffix:semicolon
id|cmd.ctrl
op_assign
id|__ctrl
c_func
(paren
id|RFCOMM_DISC
comma
l_int|1
)paren
suffix:semicolon
id|cmd.len
op_assign
id|__len8
c_func
(paren
l_int|0
)paren
suffix:semicolon
id|cmd.fcs
op_assign
id|__fcs2
c_func
(paren
(paren
id|u8
op_star
)paren
op_amp
id|cmd
)paren
suffix:semicolon
r_return
id|rfcomm_send_frame
c_func
(paren
id|s
comma
(paren
r_void
op_star
)paren
op_amp
id|cmd
comma
r_sizeof
(paren
id|cmd
)paren
)paren
suffix:semicolon
)brace
DECL|function|rfcomm_queue_disc
r_static
r_int
id|rfcomm_queue_disc
c_func
(paren
r_struct
id|rfcomm_dlc
op_star
id|d
)paren
(brace
r_struct
id|rfcomm_cmd
op_star
id|cmd
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
id|BT_DBG
c_func
(paren
l_string|&quot;dlc %p dlci %d&quot;
comma
id|d
comma
id|d-&gt;dlci
)paren
suffix:semicolon
id|skb
op_assign
id|alloc_skb
c_func
(paren
r_sizeof
(paren
op_star
id|cmd
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|cmd
op_assign
(paren
r_void
op_star
)paren
id|__skb_put
c_func
(paren
id|skb
comma
r_sizeof
(paren
op_star
id|cmd
)paren
)paren
suffix:semicolon
id|cmd-&gt;addr
op_assign
id|d-&gt;addr
suffix:semicolon
id|cmd-&gt;ctrl
op_assign
id|__ctrl
c_func
(paren
id|RFCOMM_DISC
comma
l_int|1
)paren
suffix:semicolon
id|cmd-&gt;len
op_assign
id|__len8
c_func
(paren
l_int|0
)paren
suffix:semicolon
id|cmd-&gt;fcs
op_assign
id|__fcs2
c_func
(paren
(paren
id|u8
op_star
)paren
id|cmd
)paren
suffix:semicolon
id|skb_queue_tail
c_func
(paren
op_amp
id|d-&gt;tx_queue
comma
id|skb
)paren
suffix:semicolon
id|rfcomm_schedule
c_func
(paren
id|RFCOMM_SCHED_TX
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|rfcomm_send_dm
r_static
r_int
id|rfcomm_send_dm
c_func
(paren
r_struct
id|rfcomm_session
op_star
id|s
comma
id|u8
id|dlci
)paren
(brace
r_struct
id|rfcomm_cmd
id|cmd
suffix:semicolon
id|BT_DBG
c_func
(paren
l_string|&quot;%p dlci %d&quot;
comma
id|s
comma
id|dlci
)paren
suffix:semicolon
id|cmd.addr
op_assign
id|__addr
c_func
(paren
op_logical_neg
id|s-&gt;initiator
comma
id|dlci
)paren
suffix:semicolon
id|cmd.ctrl
op_assign
id|__ctrl
c_func
(paren
id|RFCOMM_DM
comma
l_int|1
)paren
suffix:semicolon
id|cmd.len
op_assign
id|__len8
c_func
(paren
l_int|0
)paren
suffix:semicolon
id|cmd.fcs
op_assign
id|__fcs2
c_func
(paren
(paren
id|u8
op_star
)paren
op_amp
id|cmd
)paren
suffix:semicolon
r_return
id|rfcomm_send_frame
c_func
(paren
id|s
comma
(paren
r_void
op_star
)paren
op_amp
id|cmd
comma
r_sizeof
(paren
id|cmd
)paren
)paren
suffix:semicolon
)brace
DECL|function|rfcomm_send_nsc
r_static
r_int
id|rfcomm_send_nsc
c_func
(paren
r_struct
id|rfcomm_session
op_star
id|s
comma
r_int
id|cr
comma
id|u8
id|type
)paren
(brace
r_struct
id|rfcomm_hdr
op_star
id|hdr
suffix:semicolon
r_struct
id|rfcomm_mcc
op_star
id|mcc
suffix:semicolon
id|u8
id|buf
(braket
l_int|16
)braket
comma
op_star
id|ptr
op_assign
id|buf
suffix:semicolon
id|BT_DBG
c_func
(paren
l_string|&quot;%p cr %d type %d&quot;
comma
id|s
comma
id|cr
comma
id|type
)paren
suffix:semicolon
id|hdr
op_assign
(paren
r_void
op_star
)paren
id|ptr
suffix:semicolon
id|ptr
op_add_assign
r_sizeof
(paren
op_star
id|hdr
)paren
suffix:semicolon
id|hdr-&gt;addr
op_assign
id|__addr
c_func
(paren
id|s-&gt;initiator
comma
l_int|0
)paren
suffix:semicolon
id|hdr-&gt;ctrl
op_assign
id|__ctrl
c_func
(paren
id|RFCOMM_UIH
comma
l_int|0
)paren
suffix:semicolon
id|hdr-&gt;len
op_assign
id|__len8
c_func
(paren
r_sizeof
(paren
op_star
id|mcc
)paren
op_plus
l_int|1
)paren
suffix:semicolon
id|mcc
op_assign
(paren
r_void
op_star
)paren
id|ptr
suffix:semicolon
id|ptr
op_add_assign
r_sizeof
(paren
op_star
id|mcc
)paren
suffix:semicolon
id|mcc-&gt;type
op_assign
id|__mcc_type
c_func
(paren
id|cr
comma
id|RFCOMM_NSC
)paren
suffix:semicolon
id|mcc-&gt;len
op_assign
id|__len8
c_func
(paren
l_int|1
)paren
suffix:semicolon
multiline_comment|/* Type that we didn&squot;t like */
op_star
id|ptr
op_assign
id|__mcc_type
c_func
(paren
id|cr
comma
id|type
)paren
suffix:semicolon
id|ptr
op_increment
suffix:semicolon
op_star
id|ptr
op_assign
id|__fcs
c_func
(paren
id|buf
)paren
suffix:semicolon
id|ptr
op_increment
suffix:semicolon
r_return
id|rfcomm_send_frame
c_func
(paren
id|s
comma
id|buf
comma
id|ptr
op_minus
id|buf
)paren
suffix:semicolon
)brace
DECL|function|rfcomm_send_pn
r_static
r_int
id|rfcomm_send_pn
c_func
(paren
r_struct
id|rfcomm_session
op_star
id|s
comma
r_int
id|cr
comma
r_struct
id|rfcomm_dlc
op_star
id|d
)paren
(brace
r_struct
id|rfcomm_hdr
op_star
id|hdr
suffix:semicolon
r_struct
id|rfcomm_mcc
op_star
id|mcc
suffix:semicolon
r_struct
id|rfcomm_pn
op_star
id|pn
suffix:semicolon
id|u8
id|buf
(braket
l_int|16
)braket
comma
op_star
id|ptr
op_assign
id|buf
suffix:semicolon
id|BT_DBG
c_func
(paren
l_string|&quot;%p cr %d dlci %d mtu %d&quot;
comma
id|s
comma
id|cr
comma
id|d-&gt;dlci
comma
id|d-&gt;mtu
)paren
suffix:semicolon
id|hdr
op_assign
(paren
r_void
op_star
)paren
id|ptr
suffix:semicolon
id|ptr
op_add_assign
r_sizeof
(paren
op_star
id|hdr
)paren
suffix:semicolon
id|hdr-&gt;addr
op_assign
id|__addr
c_func
(paren
id|s-&gt;initiator
comma
l_int|0
)paren
suffix:semicolon
id|hdr-&gt;ctrl
op_assign
id|__ctrl
c_func
(paren
id|RFCOMM_UIH
comma
l_int|0
)paren
suffix:semicolon
id|hdr-&gt;len
op_assign
id|__len8
c_func
(paren
r_sizeof
(paren
op_star
id|mcc
)paren
op_plus
r_sizeof
(paren
op_star
id|pn
)paren
)paren
suffix:semicolon
id|mcc
op_assign
(paren
r_void
op_star
)paren
id|ptr
suffix:semicolon
id|ptr
op_add_assign
r_sizeof
(paren
op_star
id|mcc
)paren
suffix:semicolon
id|mcc-&gt;type
op_assign
id|__mcc_type
c_func
(paren
id|cr
comma
id|RFCOMM_PN
)paren
suffix:semicolon
id|mcc-&gt;len
op_assign
id|__len8
c_func
(paren
r_sizeof
(paren
op_star
id|pn
)paren
)paren
suffix:semicolon
id|pn
op_assign
(paren
r_void
op_star
)paren
id|ptr
suffix:semicolon
id|ptr
op_add_assign
r_sizeof
(paren
op_star
id|pn
)paren
suffix:semicolon
id|pn-&gt;dlci
op_assign
id|d-&gt;dlci
suffix:semicolon
id|pn-&gt;priority
op_assign
id|d-&gt;priority
suffix:semicolon
id|pn-&gt;ack_timer
op_assign
l_int|0
suffix:semicolon
id|pn-&gt;max_retrans
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;cfc
)paren
(brace
id|pn-&gt;flow_ctrl
op_assign
id|cr
ques
c_cond
l_int|0xf0
suffix:colon
l_int|0xe0
suffix:semicolon
id|pn-&gt;credits
op_assign
id|RFCOMM_DEFAULT_CREDITS
suffix:semicolon
)brace
r_else
(brace
id|pn-&gt;flow_ctrl
op_assign
l_int|0
suffix:semicolon
id|pn-&gt;credits
op_assign
l_int|0
suffix:semicolon
)brace
id|pn-&gt;mtu
op_assign
id|htobs
c_func
(paren
id|d-&gt;mtu
)paren
suffix:semicolon
op_star
id|ptr
op_assign
id|__fcs
c_func
(paren
id|buf
)paren
suffix:semicolon
id|ptr
op_increment
suffix:semicolon
r_return
id|rfcomm_send_frame
c_func
(paren
id|s
comma
id|buf
comma
id|ptr
op_minus
id|buf
)paren
suffix:semicolon
)brace
DECL|function|rfcomm_send_rpn
r_static
r_int
id|rfcomm_send_rpn
c_func
(paren
r_struct
id|rfcomm_session
op_star
id|s
comma
r_int
id|cr
comma
id|u8
id|dlci
comma
id|u8
id|bit_rate
comma
id|u8
id|data_bits
comma
id|u8
id|stop_bits
comma
id|u8
id|parity
comma
id|u8
id|flow_ctrl_settings
comma
id|u8
id|xon_char
comma
id|u8
id|xoff_char
comma
id|u16
id|param_mask
)paren
(brace
r_struct
id|rfcomm_hdr
op_star
id|hdr
suffix:semicolon
r_struct
id|rfcomm_mcc
op_star
id|mcc
suffix:semicolon
r_struct
id|rfcomm_rpn
op_star
id|rpn
suffix:semicolon
id|u8
id|buf
(braket
l_int|16
)braket
comma
op_star
id|ptr
op_assign
id|buf
suffix:semicolon
id|BT_DBG
c_func
(paren
l_string|&quot;%p cr %d dlci %d bit_r 0x%x data_b 0x%x stop_b 0x%x parity 0x%x&quot;
l_string|&quot;flwc_s 0x%x xon_c 0x%x xoff_c 0x%x p_mask 0x%x&quot;
comma
id|s
comma
id|cr
comma
id|dlci
comma
id|bit_rate
comma
id|data_bits
comma
id|stop_bits
comma
id|parity
comma
id|flow_ctrl_settings
comma
id|xon_char
comma
id|xoff_char
comma
id|param_mask
)paren
suffix:semicolon
id|hdr
op_assign
(paren
r_void
op_star
)paren
id|ptr
suffix:semicolon
id|ptr
op_add_assign
r_sizeof
(paren
op_star
id|hdr
)paren
suffix:semicolon
id|hdr-&gt;addr
op_assign
id|__addr
c_func
(paren
id|s-&gt;initiator
comma
l_int|0
)paren
suffix:semicolon
id|hdr-&gt;ctrl
op_assign
id|__ctrl
c_func
(paren
id|RFCOMM_UIH
comma
l_int|0
)paren
suffix:semicolon
id|hdr-&gt;len
op_assign
id|__len8
c_func
(paren
r_sizeof
(paren
op_star
id|mcc
)paren
op_plus
r_sizeof
(paren
op_star
id|rpn
)paren
)paren
suffix:semicolon
id|mcc
op_assign
(paren
r_void
op_star
)paren
id|ptr
suffix:semicolon
id|ptr
op_add_assign
r_sizeof
(paren
op_star
id|mcc
)paren
suffix:semicolon
id|mcc-&gt;type
op_assign
id|__mcc_type
c_func
(paren
id|cr
comma
id|RFCOMM_RPN
)paren
suffix:semicolon
id|mcc-&gt;len
op_assign
id|__len8
c_func
(paren
r_sizeof
(paren
op_star
id|rpn
)paren
)paren
suffix:semicolon
id|rpn
op_assign
(paren
r_void
op_star
)paren
id|ptr
suffix:semicolon
id|ptr
op_add_assign
r_sizeof
(paren
op_star
id|rpn
)paren
suffix:semicolon
id|rpn-&gt;dlci
op_assign
id|__addr
c_func
(paren
l_int|1
comma
id|dlci
)paren
suffix:semicolon
id|rpn-&gt;bit_rate
op_assign
id|bit_rate
suffix:semicolon
id|rpn-&gt;line_settings
op_assign
id|__rpn_line_settings
c_func
(paren
id|data_bits
comma
id|stop_bits
comma
id|parity
)paren
suffix:semicolon
id|rpn-&gt;flow_ctrl
op_assign
id|flow_ctrl_settings
suffix:semicolon
id|rpn-&gt;xon_char
op_assign
id|xon_char
suffix:semicolon
id|rpn-&gt;xoff_char
op_assign
id|xoff_char
suffix:semicolon
id|rpn-&gt;param_mask
op_assign
id|param_mask
suffix:semicolon
op_star
id|ptr
op_assign
id|__fcs
c_func
(paren
id|buf
)paren
suffix:semicolon
id|ptr
op_increment
suffix:semicolon
r_return
id|rfcomm_send_frame
c_func
(paren
id|s
comma
id|buf
comma
id|ptr
op_minus
id|buf
)paren
suffix:semicolon
)brace
DECL|function|rfcomm_send_rls
r_static
r_int
id|rfcomm_send_rls
c_func
(paren
r_struct
id|rfcomm_session
op_star
id|s
comma
r_int
id|cr
comma
id|u8
id|dlci
comma
id|u8
id|status
)paren
(brace
r_struct
id|rfcomm_hdr
op_star
id|hdr
suffix:semicolon
r_struct
id|rfcomm_mcc
op_star
id|mcc
suffix:semicolon
r_struct
id|rfcomm_rls
op_star
id|rls
suffix:semicolon
id|u8
id|buf
(braket
l_int|16
)braket
comma
op_star
id|ptr
op_assign
id|buf
suffix:semicolon
id|BT_DBG
c_func
(paren
l_string|&quot;%p cr %d status 0x%x&quot;
comma
id|s
comma
id|cr
comma
id|status
)paren
suffix:semicolon
id|hdr
op_assign
(paren
r_void
op_star
)paren
id|ptr
suffix:semicolon
id|ptr
op_add_assign
r_sizeof
(paren
op_star
id|hdr
)paren
suffix:semicolon
id|hdr-&gt;addr
op_assign
id|__addr
c_func
(paren
id|s-&gt;initiator
comma
l_int|0
)paren
suffix:semicolon
id|hdr-&gt;ctrl
op_assign
id|__ctrl
c_func
(paren
id|RFCOMM_UIH
comma
l_int|0
)paren
suffix:semicolon
id|hdr-&gt;len
op_assign
id|__len8
c_func
(paren
r_sizeof
(paren
op_star
id|mcc
)paren
op_plus
r_sizeof
(paren
op_star
id|rls
)paren
)paren
suffix:semicolon
id|mcc
op_assign
(paren
r_void
op_star
)paren
id|ptr
suffix:semicolon
id|ptr
op_add_assign
r_sizeof
(paren
op_star
id|mcc
)paren
suffix:semicolon
id|mcc-&gt;type
op_assign
id|__mcc_type
c_func
(paren
id|cr
comma
id|RFCOMM_RLS
)paren
suffix:semicolon
id|mcc-&gt;len
op_assign
id|__len8
c_func
(paren
r_sizeof
(paren
op_star
id|rls
)paren
)paren
suffix:semicolon
id|rls
op_assign
(paren
r_void
op_star
)paren
id|ptr
suffix:semicolon
id|ptr
op_add_assign
r_sizeof
(paren
op_star
id|rls
)paren
suffix:semicolon
id|rls-&gt;dlci
op_assign
id|__addr
c_func
(paren
l_int|1
comma
id|dlci
)paren
suffix:semicolon
id|rls-&gt;status
op_assign
id|status
suffix:semicolon
op_star
id|ptr
op_assign
id|__fcs
c_func
(paren
id|buf
)paren
suffix:semicolon
id|ptr
op_increment
suffix:semicolon
r_return
id|rfcomm_send_frame
c_func
(paren
id|s
comma
id|buf
comma
id|ptr
op_minus
id|buf
)paren
suffix:semicolon
)brace
DECL|function|rfcomm_send_msc
r_static
r_int
id|rfcomm_send_msc
c_func
(paren
r_struct
id|rfcomm_session
op_star
id|s
comma
r_int
id|cr
comma
id|u8
id|dlci
comma
id|u8
id|v24_sig
)paren
(brace
r_struct
id|rfcomm_hdr
op_star
id|hdr
suffix:semicolon
r_struct
id|rfcomm_mcc
op_star
id|mcc
suffix:semicolon
r_struct
id|rfcomm_msc
op_star
id|msc
suffix:semicolon
id|u8
id|buf
(braket
l_int|16
)braket
comma
op_star
id|ptr
op_assign
id|buf
suffix:semicolon
id|BT_DBG
c_func
(paren
l_string|&quot;%p cr %d v24 0x%x&quot;
comma
id|s
comma
id|cr
comma
id|v24_sig
)paren
suffix:semicolon
id|hdr
op_assign
(paren
r_void
op_star
)paren
id|ptr
suffix:semicolon
id|ptr
op_add_assign
r_sizeof
(paren
op_star
id|hdr
)paren
suffix:semicolon
id|hdr-&gt;addr
op_assign
id|__addr
c_func
(paren
id|s-&gt;initiator
comma
l_int|0
)paren
suffix:semicolon
id|hdr-&gt;ctrl
op_assign
id|__ctrl
c_func
(paren
id|RFCOMM_UIH
comma
l_int|0
)paren
suffix:semicolon
id|hdr-&gt;len
op_assign
id|__len8
c_func
(paren
r_sizeof
(paren
op_star
id|mcc
)paren
op_plus
r_sizeof
(paren
op_star
id|msc
)paren
)paren
suffix:semicolon
id|mcc
op_assign
(paren
r_void
op_star
)paren
id|ptr
suffix:semicolon
id|ptr
op_add_assign
r_sizeof
(paren
op_star
id|mcc
)paren
suffix:semicolon
id|mcc-&gt;type
op_assign
id|__mcc_type
c_func
(paren
id|cr
comma
id|RFCOMM_MSC
)paren
suffix:semicolon
id|mcc-&gt;len
op_assign
id|__len8
c_func
(paren
r_sizeof
(paren
op_star
id|msc
)paren
)paren
suffix:semicolon
id|msc
op_assign
(paren
r_void
op_star
)paren
id|ptr
suffix:semicolon
id|ptr
op_add_assign
r_sizeof
(paren
op_star
id|msc
)paren
suffix:semicolon
id|msc-&gt;dlci
op_assign
id|__addr
c_func
(paren
l_int|1
comma
id|dlci
)paren
suffix:semicolon
id|msc-&gt;v24_sig
op_assign
id|v24_sig
op_or
l_int|0x01
suffix:semicolon
op_star
id|ptr
op_assign
id|__fcs
c_func
(paren
id|buf
)paren
suffix:semicolon
id|ptr
op_increment
suffix:semicolon
r_return
id|rfcomm_send_frame
c_func
(paren
id|s
comma
id|buf
comma
id|ptr
op_minus
id|buf
)paren
suffix:semicolon
)brace
DECL|function|rfcomm_send_fcoff
r_static
r_int
id|rfcomm_send_fcoff
c_func
(paren
r_struct
id|rfcomm_session
op_star
id|s
comma
r_int
id|cr
)paren
(brace
r_struct
id|rfcomm_hdr
op_star
id|hdr
suffix:semicolon
r_struct
id|rfcomm_mcc
op_star
id|mcc
suffix:semicolon
id|u8
id|buf
(braket
l_int|16
)braket
comma
op_star
id|ptr
op_assign
id|buf
suffix:semicolon
id|BT_DBG
c_func
(paren
l_string|&quot;%p cr %d&quot;
comma
id|s
comma
id|cr
)paren
suffix:semicolon
id|hdr
op_assign
(paren
r_void
op_star
)paren
id|ptr
suffix:semicolon
id|ptr
op_add_assign
r_sizeof
(paren
op_star
id|hdr
)paren
suffix:semicolon
id|hdr-&gt;addr
op_assign
id|__addr
c_func
(paren
id|s-&gt;initiator
comma
l_int|0
)paren
suffix:semicolon
id|hdr-&gt;ctrl
op_assign
id|__ctrl
c_func
(paren
id|RFCOMM_UIH
comma
l_int|0
)paren
suffix:semicolon
id|hdr-&gt;len
op_assign
id|__len8
c_func
(paren
r_sizeof
(paren
op_star
id|mcc
)paren
)paren
suffix:semicolon
id|mcc
op_assign
(paren
r_void
op_star
)paren
id|ptr
suffix:semicolon
id|ptr
op_add_assign
r_sizeof
(paren
op_star
id|mcc
)paren
suffix:semicolon
id|mcc-&gt;type
op_assign
id|__mcc_type
c_func
(paren
id|cr
comma
id|RFCOMM_FCOFF
)paren
suffix:semicolon
id|mcc-&gt;len
op_assign
id|__len8
c_func
(paren
l_int|0
)paren
suffix:semicolon
op_star
id|ptr
op_assign
id|__fcs
c_func
(paren
id|buf
)paren
suffix:semicolon
id|ptr
op_increment
suffix:semicolon
r_return
id|rfcomm_send_frame
c_func
(paren
id|s
comma
id|buf
comma
id|ptr
op_minus
id|buf
)paren
suffix:semicolon
)brace
DECL|function|rfcomm_send_fcon
r_static
r_int
id|rfcomm_send_fcon
c_func
(paren
r_struct
id|rfcomm_session
op_star
id|s
comma
r_int
id|cr
)paren
(brace
r_struct
id|rfcomm_hdr
op_star
id|hdr
suffix:semicolon
r_struct
id|rfcomm_mcc
op_star
id|mcc
suffix:semicolon
id|u8
id|buf
(braket
l_int|16
)braket
comma
op_star
id|ptr
op_assign
id|buf
suffix:semicolon
id|BT_DBG
c_func
(paren
l_string|&quot;%p cr %d&quot;
comma
id|s
comma
id|cr
)paren
suffix:semicolon
id|hdr
op_assign
(paren
r_void
op_star
)paren
id|ptr
suffix:semicolon
id|ptr
op_add_assign
r_sizeof
(paren
op_star
id|hdr
)paren
suffix:semicolon
id|hdr-&gt;addr
op_assign
id|__addr
c_func
(paren
id|s-&gt;initiator
comma
l_int|0
)paren
suffix:semicolon
id|hdr-&gt;ctrl
op_assign
id|__ctrl
c_func
(paren
id|RFCOMM_UIH
comma
l_int|0
)paren
suffix:semicolon
id|hdr-&gt;len
op_assign
id|__len8
c_func
(paren
r_sizeof
(paren
op_star
id|mcc
)paren
)paren
suffix:semicolon
id|mcc
op_assign
(paren
r_void
op_star
)paren
id|ptr
suffix:semicolon
id|ptr
op_add_assign
r_sizeof
(paren
op_star
id|mcc
)paren
suffix:semicolon
id|mcc-&gt;type
op_assign
id|__mcc_type
c_func
(paren
id|cr
comma
id|RFCOMM_FCON
)paren
suffix:semicolon
id|mcc-&gt;len
op_assign
id|__len8
c_func
(paren
l_int|0
)paren
suffix:semicolon
op_star
id|ptr
op_assign
id|__fcs
c_func
(paren
id|buf
)paren
suffix:semicolon
id|ptr
op_increment
suffix:semicolon
r_return
id|rfcomm_send_frame
c_func
(paren
id|s
comma
id|buf
comma
id|ptr
op_minus
id|buf
)paren
suffix:semicolon
)brace
DECL|function|rfcomm_send_test
r_static
r_int
id|rfcomm_send_test
c_func
(paren
r_struct
id|rfcomm_session
op_star
id|s
comma
r_int
id|cr
comma
id|u8
op_star
id|pattern
comma
r_int
id|len
)paren
(brace
r_struct
id|socket
op_star
id|sock
op_assign
id|s-&gt;sock
suffix:semicolon
r_struct
id|iovec
id|iv
(braket
l_int|3
)braket
suffix:semicolon
r_struct
id|msghdr
id|msg
suffix:semicolon
r_int
r_char
id|hdr
(braket
l_int|5
)braket
comma
id|crc
(braket
l_int|1
)braket
suffix:semicolon
r_if
c_cond
(paren
id|len
OG
l_int|125
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|BT_DBG
c_func
(paren
l_string|&quot;%p cr %d&quot;
comma
id|s
comma
id|cr
)paren
suffix:semicolon
id|hdr
(braket
l_int|0
)braket
op_assign
id|__addr
c_func
(paren
id|s-&gt;initiator
comma
l_int|0
)paren
suffix:semicolon
id|hdr
(braket
l_int|1
)braket
op_assign
id|__ctrl
c_func
(paren
id|RFCOMM_UIH
comma
l_int|0
)paren
suffix:semicolon
id|hdr
(braket
l_int|2
)braket
op_assign
l_int|0x01
op_or
(paren
(paren
id|len
op_plus
l_int|2
)paren
op_lshift
l_int|1
)paren
suffix:semicolon
id|hdr
(braket
l_int|3
)braket
op_assign
l_int|0x01
op_or
(paren
(paren
id|cr
op_amp
l_int|0x01
)paren
op_lshift
l_int|1
)paren
op_or
(paren
id|RFCOMM_TEST
op_lshift
l_int|2
)paren
suffix:semicolon
id|hdr
(braket
l_int|4
)braket
op_assign
l_int|0x01
op_or
(paren
id|len
op_lshift
l_int|1
)paren
suffix:semicolon
id|crc
(braket
l_int|0
)braket
op_assign
id|__fcs
c_func
(paren
id|hdr
)paren
suffix:semicolon
id|iv
(braket
l_int|0
)braket
dot
id|iov_base
op_assign
id|hdr
suffix:semicolon
id|iv
(braket
l_int|0
)braket
dot
id|iov_len
op_assign
l_int|5
suffix:semicolon
id|iv
(braket
l_int|1
)braket
dot
id|iov_base
op_assign
id|pattern
suffix:semicolon
id|iv
(braket
l_int|1
)braket
dot
id|iov_len
op_assign
id|len
suffix:semicolon
id|iv
(braket
l_int|2
)braket
dot
id|iov_base
op_assign
id|crc
suffix:semicolon
id|iv
(braket
l_int|2
)braket
dot
id|iov_len
op_assign
l_int|1
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|msg
comma
l_int|0
comma
r_sizeof
(paren
id|msg
)paren
)paren
suffix:semicolon
id|msg.msg_iovlen
op_assign
l_int|3
suffix:semicolon
id|msg.msg_iov
op_assign
id|iv
suffix:semicolon
r_return
id|sock_sendmsg
c_func
(paren
id|sock
comma
op_amp
id|msg
comma
l_int|6
op_plus
id|len
)paren
suffix:semicolon
)brace
DECL|function|rfcomm_send_credits
r_static
r_int
id|rfcomm_send_credits
c_func
(paren
r_struct
id|rfcomm_session
op_star
id|s
comma
id|u8
id|addr
comma
id|u8
id|credits
)paren
(brace
r_struct
id|rfcomm_hdr
op_star
id|hdr
suffix:semicolon
id|u8
id|buf
(braket
l_int|16
)braket
comma
op_star
id|ptr
op_assign
id|buf
suffix:semicolon
id|BT_DBG
c_func
(paren
l_string|&quot;%p addr %d credits %d&quot;
comma
id|s
comma
id|addr
comma
id|credits
)paren
suffix:semicolon
id|hdr
op_assign
(paren
r_void
op_star
)paren
id|ptr
suffix:semicolon
id|ptr
op_add_assign
r_sizeof
(paren
op_star
id|hdr
)paren
suffix:semicolon
id|hdr-&gt;addr
op_assign
id|addr
suffix:semicolon
id|hdr-&gt;ctrl
op_assign
id|__ctrl
c_func
(paren
id|RFCOMM_UIH
comma
l_int|1
)paren
suffix:semicolon
id|hdr-&gt;len
op_assign
id|__len8
c_func
(paren
l_int|0
)paren
suffix:semicolon
op_star
id|ptr
op_assign
id|credits
suffix:semicolon
id|ptr
op_increment
suffix:semicolon
op_star
id|ptr
op_assign
id|__fcs
c_func
(paren
id|buf
)paren
suffix:semicolon
id|ptr
op_increment
suffix:semicolon
r_return
id|rfcomm_send_frame
c_func
(paren
id|s
comma
id|buf
comma
id|ptr
op_minus
id|buf
)paren
suffix:semicolon
)brace
DECL|function|rfcomm_make_uih
r_static
r_void
id|rfcomm_make_uih
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
id|u8
id|addr
)paren
(brace
r_struct
id|rfcomm_hdr
op_star
id|hdr
suffix:semicolon
r_int
id|len
op_assign
id|skb-&gt;len
suffix:semicolon
id|u8
op_star
id|crc
suffix:semicolon
r_if
c_cond
(paren
id|len
OG
l_int|127
)paren
(brace
id|hdr
op_assign
(paren
r_void
op_star
)paren
id|skb_push
c_func
(paren
id|skb
comma
l_int|4
)paren
suffix:semicolon
id|put_unaligned
c_func
(paren
id|htobs
c_func
(paren
id|__len16
c_func
(paren
id|len
)paren
)paren
comma
(paren
id|u16
op_star
)paren
op_amp
id|hdr-&gt;len
)paren
suffix:semicolon
)brace
r_else
(brace
id|hdr
op_assign
(paren
r_void
op_star
)paren
id|skb_push
c_func
(paren
id|skb
comma
l_int|3
)paren
suffix:semicolon
id|hdr-&gt;len
op_assign
id|__len8
c_func
(paren
id|len
)paren
suffix:semicolon
)brace
id|hdr-&gt;addr
op_assign
id|addr
suffix:semicolon
id|hdr-&gt;ctrl
op_assign
id|__ctrl
c_func
(paren
id|RFCOMM_UIH
comma
l_int|0
)paren
suffix:semicolon
id|crc
op_assign
id|skb_put
c_func
(paren
id|skb
comma
l_int|1
)paren
suffix:semicolon
op_star
id|crc
op_assign
id|__fcs
c_func
(paren
(paren
r_void
op_star
)paren
id|hdr
)paren
suffix:semicolon
)brace
multiline_comment|/* ---- RFCOMM frame reception ---- */
DECL|function|rfcomm_recv_ua
r_static
r_int
id|rfcomm_recv_ua
c_func
(paren
r_struct
id|rfcomm_session
op_star
id|s
comma
id|u8
id|dlci
)paren
(brace
id|BT_DBG
c_func
(paren
l_string|&quot;session %p state %ld dlci %d&quot;
comma
id|s
comma
id|s-&gt;state
comma
id|dlci
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dlci
)paren
(brace
multiline_comment|/* Data channel */
r_struct
id|rfcomm_dlc
op_star
id|d
op_assign
id|rfcomm_dlc_get
c_func
(paren
id|s
comma
id|dlci
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|d
)paren
(brace
id|rfcomm_send_dm
c_func
(paren
id|s
comma
id|dlci
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|d-&gt;state
)paren
(brace
r_case
id|BT_CONNECT
suffix:colon
id|rfcomm_dlc_clear_timer
c_func
(paren
id|d
)paren
suffix:semicolon
id|rfcomm_dlc_lock
c_func
(paren
id|d
)paren
suffix:semicolon
id|d-&gt;state
op_assign
id|BT_CONNECTED
suffix:semicolon
id|d
op_member_access_from_pointer
id|state_change
c_func
(paren
id|d
comma
l_int|0
)paren
suffix:semicolon
id|rfcomm_dlc_unlock
c_func
(paren
id|d
)paren
suffix:semicolon
id|rfcomm_send_msc
c_func
(paren
id|s
comma
l_int|1
comma
id|dlci
comma
id|d-&gt;v24_sig
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|BT_DISCONN
suffix:colon
id|d-&gt;state
op_assign
id|BT_CLOSED
suffix:semicolon
id|__rfcomm_dlc_close
c_func
(paren
id|d
comma
l_int|0
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_else
(brace
multiline_comment|/* Control channel */
r_switch
c_cond
(paren
id|s-&gt;state
)paren
(brace
r_case
id|BT_CONNECT
suffix:colon
id|s-&gt;state
op_assign
id|BT_CONNECTED
suffix:semicolon
id|rfcomm_process_connect
c_func
(paren
id|s
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|rfcomm_recv_dm
r_static
r_int
id|rfcomm_recv_dm
c_func
(paren
r_struct
id|rfcomm_session
op_star
id|s
comma
id|u8
id|dlci
)paren
(brace
r_int
id|err
op_assign
l_int|0
suffix:semicolon
id|BT_DBG
c_func
(paren
l_string|&quot;session %p state %ld dlci %d&quot;
comma
id|s
comma
id|s-&gt;state
comma
id|dlci
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dlci
)paren
(brace
multiline_comment|/* Data DLC */
r_struct
id|rfcomm_dlc
op_star
id|d
op_assign
id|rfcomm_dlc_get
c_func
(paren
id|s
comma
id|dlci
)paren
suffix:semicolon
r_if
c_cond
(paren
id|d
)paren
(brace
r_if
c_cond
(paren
id|d-&gt;state
op_eq
id|BT_CONNECT
op_logical_or
id|d-&gt;state
op_eq
id|BT_CONFIG
)paren
id|err
op_assign
id|ECONNREFUSED
suffix:semicolon
r_else
id|err
op_assign
id|ECONNRESET
suffix:semicolon
id|d-&gt;state
op_assign
id|BT_CLOSED
suffix:semicolon
id|__rfcomm_dlc_close
c_func
(paren
id|d
comma
id|err
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
id|s-&gt;state
op_eq
id|BT_CONNECT
)paren
id|err
op_assign
id|ECONNREFUSED
suffix:semicolon
r_else
id|err
op_assign
id|ECONNRESET
suffix:semicolon
id|s-&gt;state
op_assign
id|BT_CLOSED
suffix:semicolon
id|rfcomm_session_close
c_func
(paren
id|s
comma
id|err
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|rfcomm_recv_disc
r_static
r_int
id|rfcomm_recv_disc
c_func
(paren
r_struct
id|rfcomm_session
op_star
id|s
comma
id|u8
id|dlci
)paren
(brace
r_int
id|err
op_assign
l_int|0
suffix:semicolon
id|BT_DBG
c_func
(paren
l_string|&quot;session %p state %ld dlci %d&quot;
comma
id|s
comma
id|s-&gt;state
comma
id|dlci
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dlci
)paren
(brace
r_struct
id|rfcomm_dlc
op_star
id|d
op_assign
id|rfcomm_dlc_get
c_func
(paren
id|s
comma
id|dlci
)paren
suffix:semicolon
r_if
c_cond
(paren
id|d
)paren
(brace
id|rfcomm_send_ua
c_func
(paren
id|s
comma
id|dlci
)paren
suffix:semicolon
r_if
c_cond
(paren
id|d-&gt;state
op_eq
id|BT_CONNECT
op_logical_or
id|d-&gt;state
op_eq
id|BT_CONFIG
)paren
id|err
op_assign
id|ECONNREFUSED
suffix:semicolon
r_else
id|err
op_assign
id|ECONNRESET
suffix:semicolon
id|d-&gt;state
op_assign
id|BT_CLOSED
suffix:semicolon
id|__rfcomm_dlc_close
c_func
(paren
id|d
comma
id|err
)paren
suffix:semicolon
)brace
r_else
id|rfcomm_send_dm
c_func
(paren
id|s
comma
id|dlci
)paren
suffix:semicolon
)brace
r_else
(brace
id|rfcomm_send_ua
c_func
(paren
id|s
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;state
op_eq
id|BT_CONNECT
)paren
id|err
op_assign
id|ECONNREFUSED
suffix:semicolon
r_else
id|err
op_assign
id|ECONNRESET
suffix:semicolon
id|s-&gt;state
op_assign
id|BT_CLOSED
suffix:semicolon
id|rfcomm_session_close
c_func
(paren
id|s
comma
id|err
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|rfcomm_recv_sabm
r_static
r_int
id|rfcomm_recv_sabm
c_func
(paren
r_struct
id|rfcomm_session
op_star
id|s
comma
id|u8
id|dlci
)paren
(brace
r_struct
id|rfcomm_dlc
op_star
id|d
suffix:semicolon
id|u8
id|channel
suffix:semicolon
id|BT_DBG
c_func
(paren
l_string|&quot;session %p state %ld dlci %d&quot;
comma
id|s
comma
id|s-&gt;state
comma
id|dlci
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dlci
)paren
(brace
id|rfcomm_send_ua
c_func
(paren
id|s
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;state
op_eq
id|BT_OPEN
)paren
(brace
id|s-&gt;state
op_assign
id|BT_CONNECTED
suffix:semicolon
id|rfcomm_process_connect
c_func
(paren
id|s
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* Check if DLC exists */
id|d
op_assign
id|rfcomm_dlc_get
c_func
(paren
id|s
comma
id|dlci
)paren
suffix:semicolon
r_if
c_cond
(paren
id|d
)paren
(brace
r_if
c_cond
(paren
id|d-&gt;state
op_eq
id|BT_OPEN
)paren
(brace
multiline_comment|/* DLC was previously opened by PN request */
id|rfcomm_send_ua
c_func
(paren
id|s
comma
id|dlci
)paren
suffix:semicolon
id|rfcomm_dlc_lock
c_func
(paren
id|d
)paren
suffix:semicolon
id|d-&gt;state
op_assign
id|BT_CONNECTED
suffix:semicolon
id|d
op_member_access_from_pointer
id|state_change
c_func
(paren
id|d
comma
l_int|0
)paren
suffix:semicolon
id|rfcomm_dlc_unlock
c_func
(paren
id|d
)paren
suffix:semicolon
id|rfcomm_send_msc
c_func
(paren
id|s
comma
l_int|1
comma
id|dlci
comma
id|d-&gt;v24_sig
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* Notify socket layer about incoming connection */
id|channel
op_assign
id|__srv_channel
c_func
(paren
id|dlci
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rfcomm_connect_ind
c_func
(paren
id|s
comma
id|channel
comma
op_amp
id|d
)paren
)paren
(brace
id|d-&gt;dlci
op_assign
id|dlci
suffix:semicolon
id|d-&gt;addr
op_assign
id|__addr
c_func
(paren
id|s-&gt;initiator
comma
id|dlci
)paren
suffix:semicolon
id|rfcomm_dlc_link
c_func
(paren
id|s
comma
id|d
)paren
suffix:semicolon
id|rfcomm_send_ua
c_func
(paren
id|s
comma
id|dlci
)paren
suffix:semicolon
id|rfcomm_dlc_lock
c_func
(paren
id|d
)paren
suffix:semicolon
id|d-&gt;state
op_assign
id|BT_CONNECTED
suffix:semicolon
id|d
op_member_access_from_pointer
id|state_change
c_func
(paren
id|d
comma
l_int|0
)paren
suffix:semicolon
id|rfcomm_dlc_unlock
c_func
(paren
id|d
)paren
suffix:semicolon
id|rfcomm_send_msc
c_func
(paren
id|s
comma
l_int|1
comma
id|dlci
comma
id|d-&gt;v24_sig
)paren
suffix:semicolon
)brace
r_else
(brace
id|rfcomm_send_dm
c_func
(paren
id|s
comma
id|dlci
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|rfcomm_apply_pn
r_static
r_int
id|rfcomm_apply_pn
c_func
(paren
r_struct
id|rfcomm_dlc
op_star
id|d
comma
r_int
id|cr
comma
r_struct
id|rfcomm_pn
op_star
id|pn
)paren
(brace
r_struct
id|rfcomm_session
op_star
id|s
op_assign
id|d-&gt;session
suffix:semicolon
id|BT_DBG
c_func
(paren
l_string|&quot;dlc %p state %ld dlci %d mtu %d fc 0x%x credits %d&quot;
comma
id|d
comma
id|d-&gt;state
comma
id|d-&gt;dlci
comma
id|pn-&gt;mtu
comma
id|pn-&gt;flow_ctrl
comma
id|pn-&gt;credits
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pn-&gt;flow_ctrl
op_eq
l_int|0xf0
op_logical_or
id|pn-&gt;flow_ctrl
op_eq
l_int|0xe0
)paren
(brace
id|d-&gt;cfc
op_assign
id|s-&gt;cfc
op_assign
id|RFCOMM_CFC_ENABLED
suffix:semicolon
id|d-&gt;tx_credits
op_assign
id|pn-&gt;credits
suffix:semicolon
)brace
r_else
(brace
id|d-&gt;cfc
op_assign
id|s-&gt;cfc
op_assign
id|RFCOMM_CFC_DISABLED
suffix:semicolon
id|set_bit
c_func
(paren
id|RFCOMM_TX_THROTTLED
comma
op_amp
id|d-&gt;flags
)paren
suffix:semicolon
)brace
id|d-&gt;priority
op_assign
id|pn-&gt;priority
suffix:semicolon
id|d-&gt;mtu
op_assign
id|s-&gt;mtu
op_assign
id|btohs
c_func
(paren
id|pn-&gt;mtu
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|rfcomm_recv_pn
r_static
r_int
id|rfcomm_recv_pn
c_func
(paren
r_struct
id|rfcomm_session
op_star
id|s
comma
r_int
id|cr
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|rfcomm_pn
op_star
id|pn
op_assign
(paren
r_void
op_star
)paren
id|skb-&gt;data
suffix:semicolon
r_struct
id|rfcomm_dlc
op_star
id|d
suffix:semicolon
id|u8
id|dlci
op_assign
id|pn-&gt;dlci
suffix:semicolon
id|BT_DBG
c_func
(paren
l_string|&quot;session %p state %ld dlci %d&quot;
comma
id|s
comma
id|s-&gt;state
comma
id|dlci
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dlci
)paren
r_return
l_int|0
suffix:semicolon
id|d
op_assign
id|rfcomm_dlc_get
c_func
(paren
id|s
comma
id|dlci
)paren
suffix:semicolon
r_if
c_cond
(paren
id|d
)paren
(brace
r_if
c_cond
(paren
id|cr
)paren
(brace
multiline_comment|/* PN request */
id|rfcomm_apply_pn
c_func
(paren
id|d
comma
id|cr
comma
id|pn
)paren
suffix:semicolon
id|rfcomm_send_pn
c_func
(paren
id|s
comma
l_int|0
comma
id|d
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* PN response */
r_switch
c_cond
(paren
id|d-&gt;state
)paren
(brace
r_case
id|BT_CONFIG
suffix:colon
id|rfcomm_apply_pn
c_func
(paren
id|d
comma
id|cr
comma
id|pn
)paren
suffix:semicolon
id|d-&gt;state
op_assign
id|BT_CONNECT
suffix:semicolon
id|rfcomm_send_sabm
c_func
(paren
id|s
comma
id|d-&gt;dlci
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
)brace
r_else
(brace
id|u8
id|channel
op_assign
id|__srv_channel
c_func
(paren
id|dlci
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cr
)paren
r_return
l_int|0
suffix:semicolon
multiline_comment|/* PN request for non existing DLC.&n;&t;&t; * Assume incoming connection. */
r_if
c_cond
(paren
id|rfcomm_connect_ind
c_func
(paren
id|s
comma
id|channel
comma
op_amp
id|d
)paren
)paren
(brace
id|d-&gt;dlci
op_assign
id|dlci
suffix:semicolon
id|d-&gt;addr
op_assign
id|__addr
c_func
(paren
id|s-&gt;initiator
comma
id|dlci
)paren
suffix:semicolon
id|rfcomm_dlc_link
c_func
(paren
id|s
comma
id|d
)paren
suffix:semicolon
id|rfcomm_apply_pn
c_func
(paren
id|d
comma
id|cr
comma
id|pn
)paren
suffix:semicolon
id|d-&gt;state
op_assign
id|BT_OPEN
suffix:semicolon
id|rfcomm_send_pn
c_func
(paren
id|s
comma
l_int|0
comma
id|d
)paren
suffix:semicolon
)brace
r_else
(brace
id|rfcomm_send_dm
c_func
(paren
id|s
comma
id|dlci
)paren
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|rfcomm_recv_rpn
r_static
r_int
id|rfcomm_recv_rpn
c_func
(paren
r_struct
id|rfcomm_session
op_star
id|s
comma
r_int
id|cr
comma
r_int
id|len
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|rfcomm_rpn
op_star
id|rpn
op_assign
(paren
r_void
op_star
)paren
id|skb-&gt;data
suffix:semicolon
id|u8
id|dlci
op_assign
id|__get_dlci
c_func
(paren
id|rpn-&gt;dlci
)paren
suffix:semicolon
id|u8
id|bit_rate
op_assign
l_int|0
suffix:semicolon
id|u8
id|data_bits
op_assign
l_int|0
suffix:semicolon
id|u8
id|stop_bits
op_assign
l_int|0
suffix:semicolon
id|u8
id|parity
op_assign
l_int|0
suffix:semicolon
id|u8
id|flow_ctrl
op_assign
l_int|0
suffix:semicolon
id|u8
id|xon_char
op_assign
l_int|0
suffix:semicolon
id|u8
id|xoff_char
op_assign
l_int|0
suffix:semicolon
id|u16
id|rpn_mask
op_assign
id|RFCOMM_RPN_PM_ALL
suffix:semicolon
id|BT_DBG
c_func
(paren
l_string|&quot;dlci %d cr %d len 0x%x bitr 0x%x line 0x%x flow 0x%x xonc 0x%x xoffc 0x%x pm 0x%x&quot;
comma
id|dlci
comma
id|cr
comma
id|len
comma
id|rpn-&gt;bit_rate
comma
id|rpn-&gt;line_settings
comma
id|rpn-&gt;flow_ctrl
comma
id|rpn-&gt;xon_char
comma
id|rpn-&gt;xoff_char
comma
id|rpn-&gt;param_mask
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cr
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|len
op_eq
l_int|1
)paren
(brace
multiline_comment|/* request: return default setting */
id|bit_rate
op_assign
id|RFCOMM_RPN_BR_115200
suffix:semicolon
id|data_bits
op_assign
id|RFCOMM_RPN_DATA_8
suffix:semicolon
id|stop_bits
op_assign
id|RFCOMM_RPN_STOP_1
suffix:semicolon
id|parity
op_assign
id|RFCOMM_RPN_PARITY_NONE
suffix:semicolon
id|flow_ctrl
op_assign
id|RFCOMM_RPN_FLOW_NONE
suffix:semicolon
id|xon_char
op_assign
id|RFCOMM_RPN_XON_CHAR
suffix:semicolon
id|xoff_char
op_assign
id|RFCOMM_RPN_XOFF_CHAR
suffix:semicolon
r_goto
id|rpn_out
suffix:semicolon
)brace
multiline_comment|/* check for sane values: ignore/accept bit_rate, 8 bits, 1 stop bit, no parity,&n;&t;                          no flow control lines, normal XON/XOFF chars */
r_if
c_cond
(paren
id|rpn-&gt;param_mask
op_amp
id|RFCOMM_RPN_PM_BITRATE
)paren
(brace
id|bit_rate
op_assign
id|rpn-&gt;bit_rate
suffix:semicolon
r_if
c_cond
(paren
id|bit_rate
op_ne
id|RFCOMM_RPN_BR_115200
)paren
(brace
id|BT_DBG
c_func
(paren
l_string|&quot;RPN bit rate mismatch 0x%x&quot;
comma
id|bit_rate
)paren
suffix:semicolon
id|bit_rate
op_assign
id|RFCOMM_RPN_BR_115200
suffix:semicolon
id|rpn_mask
op_xor_assign
id|RFCOMM_RPN_PM_BITRATE
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|rpn-&gt;param_mask
op_amp
id|RFCOMM_RPN_PM_DATA
)paren
(brace
id|data_bits
op_assign
id|__get_rpn_data_bits
c_func
(paren
id|rpn-&gt;line_settings
)paren
suffix:semicolon
r_if
c_cond
(paren
id|data_bits
op_ne
id|RFCOMM_RPN_DATA_8
)paren
(brace
id|BT_DBG
c_func
(paren
l_string|&quot;RPN data bits mismatch 0x%x&quot;
comma
id|data_bits
)paren
suffix:semicolon
id|data_bits
op_assign
id|RFCOMM_RPN_DATA_8
suffix:semicolon
id|rpn_mask
op_xor_assign
id|RFCOMM_RPN_PM_DATA
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|rpn-&gt;param_mask
op_amp
id|RFCOMM_RPN_PM_STOP
)paren
(brace
id|stop_bits
op_assign
id|__get_rpn_stop_bits
c_func
(paren
id|rpn-&gt;line_settings
)paren
suffix:semicolon
r_if
c_cond
(paren
id|stop_bits
op_ne
id|RFCOMM_RPN_STOP_1
)paren
(brace
id|BT_DBG
c_func
(paren
l_string|&quot;RPN stop bits mismatch 0x%x&quot;
comma
id|stop_bits
)paren
suffix:semicolon
id|stop_bits
op_assign
id|RFCOMM_RPN_STOP_1
suffix:semicolon
id|rpn_mask
op_xor_assign
id|RFCOMM_RPN_PM_STOP
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|rpn-&gt;param_mask
op_amp
id|RFCOMM_RPN_PM_PARITY
)paren
(brace
id|parity
op_assign
id|__get_rpn_parity
c_func
(paren
id|rpn-&gt;line_settings
)paren
suffix:semicolon
r_if
c_cond
(paren
id|parity
op_ne
id|RFCOMM_RPN_PARITY_NONE
)paren
(brace
id|BT_DBG
c_func
(paren
l_string|&quot;RPN parity mismatch 0x%x&quot;
comma
id|parity
)paren
suffix:semicolon
id|parity
op_assign
id|RFCOMM_RPN_PARITY_NONE
suffix:semicolon
id|rpn_mask
op_xor_assign
id|RFCOMM_RPN_PM_PARITY
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|rpn-&gt;param_mask
op_amp
id|RFCOMM_RPN_PM_FLOW
)paren
(brace
id|flow_ctrl
op_assign
id|rpn-&gt;flow_ctrl
suffix:semicolon
r_if
c_cond
(paren
id|flow_ctrl
op_ne
id|RFCOMM_RPN_FLOW_NONE
)paren
(brace
id|BT_DBG
c_func
(paren
l_string|&quot;RPN flow ctrl mismatch 0x%x&quot;
comma
id|flow_ctrl
)paren
suffix:semicolon
id|flow_ctrl
op_assign
id|RFCOMM_RPN_FLOW_NONE
suffix:semicolon
id|rpn_mask
op_xor_assign
id|RFCOMM_RPN_PM_FLOW
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|rpn-&gt;param_mask
op_amp
id|RFCOMM_RPN_PM_XON
)paren
(brace
id|xon_char
op_assign
id|rpn-&gt;xon_char
suffix:semicolon
r_if
c_cond
(paren
id|xon_char
op_ne
id|RFCOMM_RPN_XON_CHAR
)paren
(brace
id|BT_DBG
c_func
(paren
l_string|&quot;RPN XON char mismatch 0x%x&quot;
comma
id|xon_char
)paren
suffix:semicolon
id|xon_char
op_assign
id|RFCOMM_RPN_XON_CHAR
suffix:semicolon
id|rpn_mask
op_xor_assign
id|RFCOMM_RPN_PM_XON
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|rpn-&gt;param_mask
op_amp
id|RFCOMM_RPN_PM_XOFF
)paren
(brace
id|xoff_char
op_assign
id|rpn-&gt;xoff_char
suffix:semicolon
r_if
c_cond
(paren
id|xoff_char
op_ne
id|RFCOMM_RPN_XOFF_CHAR
)paren
(brace
id|BT_DBG
c_func
(paren
l_string|&quot;RPN XOFF char mismatch 0x%x&quot;
comma
id|xoff_char
)paren
suffix:semicolon
id|xoff_char
op_assign
id|RFCOMM_RPN_XOFF_CHAR
suffix:semicolon
id|rpn_mask
op_xor_assign
id|RFCOMM_RPN_PM_XOFF
suffix:semicolon
)brace
)brace
id|rpn_out
suffix:colon
id|rfcomm_send_rpn
c_func
(paren
id|s
comma
l_int|0
comma
id|dlci
comma
id|bit_rate
comma
id|data_bits
comma
id|stop_bits
comma
id|parity
comma
id|flow_ctrl
comma
id|xon_char
comma
id|xoff_char
comma
id|rpn_mask
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|rfcomm_recv_rls
r_static
r_int
id|rfcomm_recv_rls
c_func
(paren
r_struct
id|rfcomm_session
op_star
id|s
comma
r_int
id|cr
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|rfcomm_rls
op_star
id|rls
op_assign
(paren
r_void
op_star
)paren
id|skb-&gt;data
suffix:semicolon
id|u8
id|dlci
op_assign
id|__get_dlci
c_func
(paren
id|rls-&gt;dlci
)paren
suffix:semicolon
id|BT_DBG
c_func
(paren
l_string|&quot;dlci %d cr %d status 0x%x&quot;
comma
id|dlci
comma
id|cr
comma
id|rls-&gt;status
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cr
)paren
r_return
l_int|0
suffix:semicolon
multiline_comment|/* FIXME: We should probably do something with this&n;&t;   information here. But for now it&squot;s sufficient just&n;&t;   to reply -- Bluetooth 1.1 says it&squot;s mandatory to &n;&t;   recognise and respond to RLS */
id|rfcomm_send_rls
c_func
(paren
id|s
comma
l_int|0
comma
id|dlci
comma
id|rls-&gt;status
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|rfcomm_recv_msc
r_static
r_int
id|rfcomm_recv_msc
c_func
(paren
r_struct
id|rfcomm_session
op_star
id|s
comma
r_int
id|cr
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|rfcomm_msc
op_star
id|msc
op_assign
(paren
r_void
op_star
)paren
id|skb-&gt;data
suffix:semicolon
r_struct
id|rfcomm_dlc
op_star
id|d
suffix:semicolon
id|u8
id|dlci
op_assign
id|__get_dlci
c_func
(paren
id|msc-&gt;dlci
)paren
suffix:semicolon
id|BT_DBG
c_func
(paren
l_string|&quot;dlci %d cr %d v24 0x%x&quot;
comma
id|dlci
comma
id|cr
comma
id|msc-&gt;v24_sig
)paren
suffix:semicolon
id|d
op_assign
id|rfcomm_dlc_get
c_func
(paren
id|s
comma
id|dlci
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|d
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|cr
)paren
(brace
r_if
c_cond
(paren
id|msc-&gt;v24_sig
op_amp
id|RFCOMM_V24_FC
op_logical_and
op_logical_neg
id|d-&gt;cfc
)paren
id|set_bit
c_func
(paren
id|RFCOMM_TX_THROTTLED
comma
op_amp
id|d-&gt;flags
)paren
suffix:semicolon
r_else
id|clear_bit
c_func
(paren
id|RFCOMM_TX_THROTTLED
comma
op_amp
id|d-&gt;flags
)paren
suffix:semicolon
id|rfcomm_dlc_lock
c_func
(paren
id|d
)paren
suffix:semicolon
r_if
c_cond
(paren
id|d-&gt;modem_status
)paren
id|d
op_member_access_from_pointer
id|modem_status
c_func
(paren
id|d
comma
id|msc-&gt;v24_sig
)paren
suffix:semicolon
id|rfcomm_dlc_unlock
c_func
(paren
id|d
)paren
suffix:semicolon
id|rfcomm_send_msc
c_func
(paren
id|s
comma
l_int|0
comma
id|dlci
comma
id|msc-&gt;v24_sig
)paren
suffix:semicolon
id|d-&gt;mscex
op_or_assign
id|RFCOMM_MSCEX_RX
suffix:semicolon
)brace
r_else
id|d-&gt;mscex
op_or_assign
id|RFCOMM_MSCEX_TX
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|rfcomm_recv_mcc
r_static
r_int
id|rfcomm_recv_mcc
c_func
(paren
r_struct
id|rfcomm_session
op_star
id|s
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|rfcomm_mcc
op_star
id|mcc
op_assign
(paren
r_void
op_star
)paren
id|skb-&gt;data
suffix:semicolon
id|u8
id|type
comma
id|cr
comma
id|len
suffix:semicolon
id|cr
op_assign
id|__test_cr
c_func
(paren
id|mcc-&gt;type
)paren
suffix:semicolon
id|type
op_assign
id|__get_mcc_type
c_func
(paren
id|mcc-&gt;type
)paren
suffix:semicolon
id|len
op_assign
id|__get_mcc_len
c_func
(paren
id|mcc-&gt;len
)paren
suffix:semicolon
id|BT_DBG
c_func
(paren
l_string|&quot;%p type 0x%x cr %d&quot;
comma
id|s
comma
id|type
comma
id|cr
)paren
suffix:semicolon
id|skb_pull
c_func
(paren
id|skb
comma
l_int|2
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|type
)paren
(brace
r_case
id|RFCOMM_PN
suffix:colon
id|rfcomm_recv_pn
c_func
(paren
id|s
comma
id|cr
comma
id|skb
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|RFCOMM_RPN
suffix:colon
id|rfcomm_recv_rpn
c_func
(paren
id|s
comma
id|cr
comma
id|len
comma
id|skb
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|RFCOMM_RLS
suffix:colon
id|rfcomm_recv_rls
c_func
(paren
id|s
comma
id|cr
comma
id|skb
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|RFCOMM_MSC
suffix:colon
id|rfcomm_recv_msc
c_func
(paren
id|s
comma
id|cr
comma
id|skb
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|RFCOMM_FCOFF
suffix:colon
r_if
c_cond
(paren
id|cr
)paren
(brace
id|set_bit
c_func
(paren
id|RFCOMM_TX_THROTTLED
comma
op_amp
id|s-&gt;flags
)paren
suffix:semicolon
id|rfcomm_send_fcoff
c_func
(paren
id|s
comma
l_int|0
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|RFCOMM_FCON
suffix:colon
r_if
c_cond
(paren
id|cr
)paren
(brace
id|clear_bit
c_func
(paren
id|RFCOMM_TX_THROTTLED
comma
op_amp
id|s-&gt;flags
)paren
suffix:semicolon
id|rfcomm_send_fcon
c_func
(paren
id|s
comma
l_int|0
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|RFCOMM_TEST
suffix:colon
r_if
c_cond
(paren
id|cr
)paren
id|rfcomm_send_test
c_func
(paren
id|s
comma
l_int|0
comma
id|skb-&gt;data
comma
id|skb-&gt;len
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|RFCOMM_NSC
suffix:colon
r_break
suffix:semicolon
r_default
suffix:colon
id|BT_ERR
c_func
(paren
l_string|&quot;Unknown control type 0x%02x&quot;
comma
id|type
)paren
suffix:semicolon
id|rfcomm_send_nsc
c_func
(paren
id|s
comma
id|cr
comma
id|type
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|rfcomm_recv_data
r_static
r_int
id|rfcomm_recv_data
c_func
(paren
r_struct
id|rfcomm_session
op_star
id|s
comma
id|u8
id|dlci
comma
r_int
id|pf
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|rfcomm_dlc
op_star
id|d
suffix:semicolon
id|BT_DBG
c_func
(paren
l_string|&quot;session %p state %ld dlci %d pf %d&quot;
comma
id|s
comma
id|s-&gt;state
comma
id|dlci
comma
id|pf
)paren
suffix:semicolon
id|d
op_assign
id|rfcomm_dlc_get
c_func
(paren
id|s
comma
id|dlci
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|d
)paren
(brace
id|rfcomm_send_dm
c_func
(paren
id|s
comma
id|dlci
)paren
suffix:semicolon
r_goto
id|drop
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pf
op_logical_and
id|d-&gt;cfc
)paren
(brace
id|u8
id|credits
op_assign
op_star
(paren
id|u8
op_star
)paren
id|skb-&gt;data
suffix:semicolon
id|skb_pull
c_func
(paren
id|skb
comma
l_int|1
)paren
suffix:semicolon
id|d-&gt;tx_credits
op_add_assign
id|credits
suffix:semicolon
r_if
c_cond
(paren
id|d-&gt;tx_credits
)paren
id|clear_bit
c_func
(paren
id|RFCOMM_TX_THROTTLED
comma
op_amp
id|d-&gt;flags
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|skb-&gt;len
op_logical_and
id|d-&gt;state
op_eq
id|BT_CONNECTED
)paren
(brace
id|rfcomm_dlc_lock
c_func
(paren
id|d
)paren
suffix:semicolon
id|d-&gt;rx_credits
op_decrement
suffix:semicolon
id|d
op_member_access_from_pointer
id|data_ready
c_func
(paren
id|d
comma
id|skb
)paren
suffix:semicolon
id|rfcomm_dlc_unlock
c_func
(paren
id|d
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|drop
suffix:colon
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|rfcomm_recv_frame
r_static
r_int
id|rfcomm_recv_frame
c_func
(paren
r_struct
id|rfcomm_session
op_star
id|s
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|rfcomm_hdr
op_star
id|hdr
op_assign
(paren
r_void
op_star
)paren
id|skb-&gt;data
suffix:semicolon
id|u8
id|type
comma
id|dlci
comma
id|fcs
suffix:semicolon
id|dlci
op_assign
id|__get_dlci
c_func
(paren
id|hdr-&gt;addr
)paren
suffix:semicolon
id|type
op_assign
id|__get_type
c_func
(paren
id|hdr-&gt;ctrl
)paren
suffix:semicolon
multiline_comment|/* Trim FCS */
id|skb-&gt;len
op_decrement
suffix:semicolon
id|skb-&gt;tail
op_decrement
suffix:semicolon
id|fcs
op_assign
op_star
(paren
id|u8
op_star
)paren
id|skb-&gt;tail
suffix:semicolon
r_if
c_cond
(paren
id|__check_fcs
c_func
(paren
id|skb-&gt;data
comma
id|type
comma
id|fcs
)paren
)paren
(brace
id|BT_ERR
c_func
(paren
l_string|&quot;bad checksum in packet&quot;
)paren
suffix:semicolon
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
op_minus
id|EILSEQ
suffix:semicolon
)brace
r_if
c_cond
(paren
id|__test_ea
c_func
(paren
id|hdr-&gt;len
)paren
)paren
id|skb_pull
c_func
(paren
id|skb
comma
l_int|3
)paren
suffix:semicolon
r_else
id|skb_pull
c_func
(paren
id|skb
comma
l_int|4
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|type
)paren
(brace
r_case
id|RFCOMM_SABM
suffix:colon
r_if
c_cond
(paren
id|__test_pf
c_func
(paren
id|hdr-&gt;ctrl
)paren
)paren
id|rfcomm_recv_sabm
c_func
(paren
id|s
comma
id|dlci
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|RFCOMM_DISC
suffix:colon
r_if
c_cond
(paren
id|__test_pf
c_func
(paren
id|hdr-&gt;ctrl
)paren
)paren
id|rfcomm_recv_disc
c_func
(paren
id|s
comma
id|dlci
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|RFCOMM_UA
suffix:colon
r_if
c_cond
(paren
id|__test_pf
c_func
(paren
id|hdr-&gt;ctrl
)paren
)paren
id|rfcomm_recv_ua
c_func
(paren
id|s
comma
id|dlci
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|RFCOMM_DM
suffix:colon
id|rfcomm_recv_dm
c_func
(paren
id|s
comma
id|dlci
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|RFCOMM_UIH
suffix:colon
r_if
c_cond
(paren
id|dlci
)paren
r_return
id|rfcomm_recv_data
c_func
(paren
id|s
comma
id|dlci
comma
id|__test_pf
c_func
(paren
id|hdr-&gt;ctrl
)paren
comma
id|skb
)paren
suffix:semicolon
id|rfcomm_recv_mcc
c_func
(paren
id|s
comma
id|skb
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|BT_ERR
c_func
(paren
l_string|&quot;Unknown packet type 0x%02x&bslash;n&quot;
comma
id|type
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* ---- Connection and data processing ---- */
DECL|function|rfcomm_process_connect
r_static
r_void
id|rfcomm_process_connect
c_func
(paren
r_struct
id|rfcomm_session
op_star
id|s
)paren
(brace
r_struct
id|rfcomm_dlc
op_star
id|d
suffix:semicolon
r_struct
id|list_head
op_star
id|p
comma
op_star
id|n
suffix:semicolon
id|BT_DBG
c_func
(paren
l_string|&quot;session %p state %ld&quot;
comma
id|s
comma
id|s-&gt;state
)paren
suffix:semicolon
id|list_for_each_safe
c_func
(paren
id|p
comma
id|n
comma
op_amp
id|s-&gt;dlcs
)paren
(brace
id|d
op_assign
id|list_entry
c_func
(paren
id|p
comma
r_struct
id|rfcomm_dlc
comma
id|list
)paren
suffix:semicolon
r_if
c_cond
(paren
id|d-&gt;state
op_eq
id|BT_CONFIG
)paren
(brace
id|d-&gt;mtu
op_assign
id|s-&gt;mtu
suffix:semicolon
id|rfcomm_send_pn
c_func
(paren
id|s
comma
l_int|1
comma
id|d
)paren
suffix:semicolon
)brace
)brace
)brace
multiline_comment|/* Send data queued for the DLC.&n; * Return number of frames left in the queue.&n; */
DECL|function|rfcomm_process_tx
r_static
r_inline
r_int
id|rfcomm_process_tx
c_func
(paren
r_struct
id|rfcomm_dlc
op_star
id|d
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_int
id|err
suffix:semicolon
id|BT_DBG
c_func
(paren
l_string|&quot;dlc %p state %ld cfc %d rx_credits %d tx_credits %d&quot;
comma
id|d
comma
id|d-&gt;state
comma
id|d-&gt;cfc
comma
id|d-&gt;rx_credits
comma
id|d-&gt;tx_credits
)paren
suffix:semicolon
multiline_comment|/* Send pending MSC */
r_if
c_cond
(paren
id|test_and_clear_bit
c_func
(paren
id|RFCOMM_MSC_PENDING
comma
op_amp
id|d-&gt;flags
)paren
)paren
id|rfcomm_send_msc
c_func
(paren
id|d-&gt;session
comma
l_int|1
comma
id|d-&gt;dlci
comma
id|d-&gt;v24_sig
)paren
suffix:semicolon
r_if
c_cond
(paren
id|d-&gt;cfc
)paren
(brace
multiline_comment|/* CFC enabled. &n;&t;&t; * Give them some credits */
r_if
c_cond
(paren
op_logical_neg
id|test_bit
c_func
(paren
id|RFCOMM_RX_THROTTLED
comma
op_amp
id|d-&gt;flags
)paren
op_logical_and
id|d-&gt;rx_credits
op_le
(paren
id|d-&gt;cfc
op_rshift
l_int|2
)paren
)paren
(brace
id|rfcomm_send_credits
c_func
(paren
id|d-&gt;session
comma
id|d-&gt;addr
comma
id|d-&gt;cfc
op_minus
id|d-&gt;rx_credits
)paren
suffix:semicolon
id|d-&gt;rx_credits
op_assign
id|d-&gt;cfc
suffix:semicolon
)brace
)brace
r_else
(brace
multiline_comment|/* CFC disabled.&n;&t;&t; * Give ourselves some credits */
id|d-&gt;tx_credits
op_assign
l_int|5
suffix:semicolon
)brace
r_if
c_cond
(paren
id|test_bit
c_func
(paren
id|RFCOMM_TX_THROTTLED
comma
op_amp
id|d-&gt;flags
)paren
)paren
r_return
id|skb_queue_len
c_func
(paren
op_amp
id|d-&gt;tx_queue
)paren
suffix:semicolon
r_while
c_loop
(paren
id|d-&gt;tx_credits
op_logical_and
(paren
id|skb
op_assign
id|skb_dequeue
c_func
(paren
op_amp
id|d-&gt;tx_queue
)paren
)paren
)paren
(brace
id|err
op_assign
id|rfcomm_send_frame
c_func
(paren
id|d-&gt;session
comma
id|skb-&gt;data
comma
id|skb-&gt;len
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
(brace
id|skb_queue_head
c_func
(paren
op_amp
id|d-&gt;tx_queue
comma
id|skb
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
id|d-&gt;tx_credits
op_decrement
suffix:semicolon
)brace
r_if
c_cond
(paren
id|d-&gt;cfc
op_logical_and
op_logical_neg
id|d-&gt;tx_credits
)paren
(brace
multiline_comment|/* We&squot;re out of TX credits.&n;&t;&t; * Set TX_THROTTLED flag to avoid unnesary wakeups by dlc_send. */
id|set_bit
c_func
(paren
id|RFCOMM_TX_THROTTLED
comma
op_amp
id|d-&gt;flags
)paren
suffix:semicolon
)brace
r_return
id|skb_queue_len
c_func
(paren
op_amp
id|d-&gt;tx_queue
)paren
suffix:semicolon
)brace
DECL|function|rfcomm_process_dlcs
r_static
r_inline
r_void
id|rfcomm_process_dlcs
c_func
(paren
r_struct
id|rfcomm_session
op_star
id|s
)paren
(brace
r_struct
id|rfcomm_dlc
op_star
id|d
suffix:semicolon
r_struct
id|list_head
op_star
id|p
comma
op_star
id|n
suffix:semicolon
id|BT_DBG
c_func
(paren
l_string|&quot;session %p state %ld&quot;
comma
id|s
comma
id|s-&gt;state
)paren
suffix:semicolon
id|list_for_each_safe
c_func
(paren
id|p
comma
id|n
comma
op_amp
id|s-&gt;dlcs
)paren
(brace
id|d
op_assign
id|list_entry
c_func
(paren
id|p
comma
r_struct
id|rfcomm_dlc
comma
id|list
)paren
suffix:semicolon
r_if
c_cond
(paren
id|test_bit
c_func
(paren
id|RFCOMM_TIMED_OUT
comma
op_amp
id|d-&gt;flags
)paren
)paren
(brace
id|__rfcomm_dlc_close
c_func
(paren
id|d
comma
id|ETIMEDOUT
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
id|test_bit
c_func
(paren
id|RFCOMM_TX_THROTTLED
comma
op_amp
id|s-&gt;flags
)paren
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
(paren
id|d-&gt;state
op_eq
id|BT_CONNECTED
op_logical_or
id|d-&gt;state
op_eq
id|BT_DISCONN
)paren
op_logical_and
id|d-&gt;mscex
op_eq
id|RFCOMM_MSCEX_OK
)paren
id|rfcomm_process_tx
c_func
(paren
id|d
)paren
suffix:semicolon
)brace
)brace
DECL|function|rfcomm_process_rx
r_static
r_inline
r_void
id|rfcomm_process_rx
c_func
(paren
r_struct
id|rfcomm_session
op_star
id|s
)paren
(brace
r_struct
id|socket
op_star
id|sock
op_assign
id|s-&gt;sock
suffix:semicolon
r_struct
id|sock
op_star
id|sk
op_assign
id|sock-&gt;sk
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
id|BT_DBG
c_func
(paren
l_string|&quot;session %p state %ld qlen %d&quot;
comma
id|s
comma
id|s-&gt;state
comma
id|skb_queue_len
c_func
(paren
op_amp
id|sk-&gt;sk_receive_queue
)paren
)paren
suffix:semicolon
multiline_comment|/* Get data directly from socket receive queue without copying it. */
r_while
c_loop
(paren
(paren
id|skb
op_assign
id|skb_dequeue
c_func
(paren
op_amp
id|sk-&gt;sk_receive_queue
)paren
)paren
)paren
(brace
id|skb_orphan
c_func
(paren
id|skb
)paren
suffix:semicolon
id|rfcomm_recv_frame
c_func
(paren
id|s
comma
id|skb
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sk-&gt;sk_state
op_eq
id|BT_CLOSED
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|s-&gt;initiator
)paren
id|rfcomm_session_put
c_func
(paren
id|s
)paren
suffix:semicolon
id|rfcomm_session_close
c_func
(paren
id|s
comma
id|sk-&gt;sk_err
)paren
suffix:semicolon
)brace
)brace
DECL|function|rfcomm_accept_connection
r_static
r_inline
r_void
id|rfcomm_accept_connection
c_func
(paren
r_struct
id|rfcomm_session
op_star
id|s
)paren
(brace
r_struct
id|socket
op_star
id|sock
op_assign
id|s-&gt;sock
comma
op_star
id|nsock
suffix:semicolon
r_int
id|err
suffix:semicolon
multiline_comment|/* Fast check for a new connection.&n;&t; * Avoids unnesesary socket allocations. */
r_if
c_cond
(paren
id|list_empty
c_func
(paren
op_amp
id|bt_sk
c_func
(paren
id|sock-&gt;sk
)paren
op_member_access_from_pointer
id|accept_q
)paren
)paren
r_return
suffix:semicolon
id|BT_DBG
c_func
(paren
l_string|&quot;session %p&quot;
comma
id|s
)paren
suffix:semicolon
id|nsock
op_assign
id|sock_alloc
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|nsock
)paren
r_return
suffix:semicolon
id|nsock-&gt;type
op_assign
id|sock-&gt;type
suffix:semicolon
id|nsock-&gt;ops
op_assign
id|sock-&gt;ops
suffix:semicolon
id|__module_get
c_func
(paren
id|nsock-&gt;ops-&gt;owner
)paren
suffix:semicolon
id|err
op_assign
id|sock-&gt;ops
op_member_access_from_pointer
id|accept
c_func
(paren
id|sock
comma
id|nsock
comma
id|O_NONBLOCK
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
(brace
id|sock_release
c_func
(paren
id|nsock
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/* Set our callbacks */
id|nsock-&gt;sk-&gt;sk_data_ready
op_assign
id|rfcomm_l2data_ready
suffix:semicolon
id|nsock-&gt;sk-&gt;sk_state_change
op_assign
id|rfcomm_l2state_change
suffix:semicolon
id|s
op_assign
id|rfcomm_session_add
c_func
(paren
id|nsock
comma
id|BT_OPEN
)paren
suffix:semicolon
r_if
c_cond
(paren
id|s
)paren
(brace
id|rfcomm_session_hold
c_func
(paren
id|s
)paren
suffix:semicolon
id|rfcomm_schedule
c_func
(paren
id|RFCOMM_SCHED_RX
)paren
suffix:semicolon
)brace
r_else
id|sock_release
c_func
(paren
id|nsock
)paren
suffix:semicolon
)brace
DECL|function|rfcomm_check_connection
r_static
r_inline
r_void
id|rfcomm_check_connection
c_func
(paren
r_struct
id|rfcomm_session
op_star
id|s
)paren
(brace
r_struct
id|sock
op_star
id|sk
op_assign
id|s-&gt;sock-&gt;sk
suffix:semicolon
id|BT_DBG
c_func
(paren
l_string|&quot;%p state %ld&quot;
comma
id|s
comma
id|s-&gt;state
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|sk-&gt;sk_state
)paren
(brace
r_case
id|BT_CONNECTED
suffix:colon
id|s-&gt;state
op_assign
id|BT_CONNECT
suffix:semicolon
multiline_comment|/* We can adjust MTU on outgoing sessions.&n;&t;&t; * L2CAP MTU minus UIH header and FCS. */
id|s-&gt;mtu
op_assign
id|min
c_func
(paren
id|l2cap_pi
c_func
(paren
id|sk
)paren
op_member_access_from_pointer
id|omtu
comma
id|l2cap_pi
c_func
(paren
id|sk
)paren
op_member_access_from_pointer
id|imtu
)paren
op_minus
l_int|5
suffix:semicolon
id|rfcomm_send_sabm
c_func
(paren
id|s
comma
l_int|0
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|BT_CLOSED
suffix:colon
id|s-&gt;state
op_assign
id|BT_CLOSED
suffix:semicolon
id|rfcomm_session_close
c_func
(paren
id|s
comma
id|sk-&gt;sk_err
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
DECL|function|rfcomm_process_sessions
r_static
r_inline
r_void
id|rfcomm_process_sessions
c_func
(paren
r_void
)paren
(brace
r_struct
id|list_head
op_star
id|p
comma
op_star
id|n
suffix:semicolon
id|rfcomm_lock
c_func
(paren
)paren
suffix:semicolon
id|list_for_each_safe
c_func
(paren
id|p
comma
id|n
comma
op_amp
id|session_list
)paren
(brace
r_struct
id|rfcomm_session
op_star
id|s
suffix:semicolon
id|s
op_assign
id|list_entry
c_func
(paren
id|p
comma
r_struct
id|rfcomm_session
comma
id|list
)paren
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;state
op_eq
id|BT_LISTEN
)paren
(brace
id|rfcomm_accept_connection
c_func
(paren
id|s
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|rfcomm_session_hold
c_func
(paren
id|s
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|s-&gt;state
)paren
(brace
r_case
id|BT_BOUND
suffix:colon
id|rfcomm_check_connection
c_func
(paren
id|s
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|rfcomm_process_rx
c_func
(paren
id|s
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|rfcomm_process_dlcs
c_func
(paren
id|s
)paren
suffix:semicolon
id|rfcomm_session_put
c_func
(paren
id|s
)paren
suffix:semicolon
)brace
id|rfcomm_unlock
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|rfcomm_worker
r_static
r_void
id|rfcomm_worker
c_func
(paren
r_void
)paren
(brace
id|BT_DBG
c_func
(paren
l_string|&quot;&quot;
)paren
suffix:semicolon
r_while
c_loop
(paren
op_logical_neg
id|atomic_read
c_func
(paren
op_amp
id|terminate
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|test_bit
c_func
(paren
id|RFCOMM_SCHED_WAKEUP
comma
op_amp
id|rfcomm_event
)paren
)paren
(brace
multiline_comment|/* No pending events. Let&squot;s sleep.&n;&t;&t;&t; * Incoming connections and data will wake us up. */
id|set_current_state
c_func
(paren
id|TASK_INTERRUPTIBLE
)paren
suffix:semicolon
id|schedule
c_func
(paren
)paren
suffix:semicolon
)brace
multiline_comment|/* Process stuff */
id|clear_bit
c_func
(paren
id|RFCOMM_SCHED_WAKEUP
comma
op_amp
id|rfcomm_event
)paren
suffix:semicolon
id|rfcomm_process_sessions
c_func
(paren
)paren
suffix:semicolon
)brace
id|set_current_state
c_func
(paren
id|TASK_RUNNING
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|function|rfcomm_add_listener
r_static
r_int
id|rfcomm_add_listener
c_func
(paren
id|bdaddr_t
op_star
id|ba
)paren
(brace
r_struct
id|sockaddr_l2
id|addr
suffix:semicolon
r_struct
id|l2cap_options
id|opts
suffix:semicolon
r_struct
id|socket
op_star
id|sock
suffix:semicolon
r_struct
id|rfcomm_session
op_star
id|s
suffix:semicolon
r_int
id|size
comma
id|err
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Create socket */
id|err
op_assign
id|rfcomm_l2sock_create
c_func
(paren
op_amp
id|sock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
(brace
id|BT_ERR
c_func
(paren
l_string|&quot;Create socket failed %d&quot;
comma
id|err
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
multiline_comment|/* Bind socket */
id|bacpy
c_func
(paren
op_amp
id|addr.l2_bdaddr
comma
id|ba
)paren
suffix:semicolon
id|addr.l2_family
op_assign
id|AF_BLUETOOTH
suffix:semicolon
id|addr.l2_psm
op_assign
id|htobs
c_func
(paren
id|RFCOMM_PSM
)paren
suffix:semicolon
id|err
op_assign
id|sock-&gt;ops
op_member_access_from_pointer
id|bind
c_func
(paren
id|sock
comma
(paren
r_struct
id|sockaddr
op_star
)paren
op_amp
id|addr
comma
r_sizeof
(paren
id|addr
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
(brace
id|BT_ERR
c_func
(paren
l_string|&quot;Bind failed %d&quot;
comma
id|err
)paren
suffix:semicolon
r_goto
id|failed
suffix:semicolon
)brace
multiline_comment|/* Set L2CAP options */
id|size
op_assign
r_sizeof
(paren
id|opts
)paren
suffix:semicolon
id|sock-&gt;ops
op_member_access_from_pointer
id|getsockopt
c_func
(paren
id|sock
comma
id|SOL_L2CAP
comma
id|L2CAP_OPTIONS
comma
(paren
r_void
op_star
)paren
op_amp
id|opts
comma
op_amp
id|size
)paren
suffix:semicolon
id|opts.imtu
op_assign
id|RFCOMM_MAX_L2CAP_MTU
suffix:semicolon
id|sock-&gt;ops
op_member_access_from_pointer
id|setsockopt
c_func
(paren
id|sock
comma
id|SOL_L2CAP
comma
id|L2CAP_OPTIONS
comma
(paren
r_void
op_star
)paren
op_amp
id|opts
comma
id|size
)paren
suffix:semicolon
multiline_comment|/* Start listening on the socket */
id|err
op_assign
id|sock-&gt;ops
op_member_access_from_pointer
id|listen
c_func
(paren
id|sock
comma
l_int|10
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|BT_ERR
c_func
(paren
l_string|&quot;Listen failed %d&quot;
comma
id|err
)paren
suffix:semicolon
r_goto
id|failed
suffix:semicolon
)brace
multiline_comment|/* Add listening session */
id|s
op_assign
id|rfcomm_session_add
c_func
(paren
id|sock
comma
id|BT_LISTEN
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|s
)paren
r_goto
id|failed
suffix:semicolon
id|rfcomm_session_hold
c_func
(paren
id|s
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|failed
suffix:colon
id|sock_release
c_func
(paren
id|sock
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|rfcomm_kill_listener
r_static
r_void
id|rfcomm_kill_listener
c_func
(paren
r_void
)paren
(brace
r_struct
id|rfcomm_session
op_star
id|s
suffix:semicolon
r_struct
id|list_head
op_star
id|p
comma
op_star
id|n
suffix:semicolon
id|BT_DBG
c_func
(paren
l_string|&quot;&quot;
)paren
suffix:semicolon
id|list_for_each_safe
c_func
(paren
id|p
comma
id|n
comma
op_amp
id|session_list
)paren
(brace
id|s
op_assign
id|list_entry
c_func
(paren
id|p
comma
r_struct
id|rfcomm_session
comma
id|list
)paren
suffix:semicolon
id|rfcomm_session_del
c_func
(paren
id|s
)paren
suffix:semicolon
)brace
)brace
DECL|function|rfcomm_run
r_static
r_int
id|rfcomm_run
c_func
(paren
r_void
op_star
id|unused
)paren
(brace
id|rfcomm_thread
op_assign
id|current
suffix:semicolon
id|atomic_inc
c_func
(paren
op_amp
id|running
)paren
suffix:semicolon
id|daemonize
c_func
(paren
l_string|&quot;krfcommd&quot;
)paren
suffix:semicolon
id|set_user_nice
c_func
(paren
id|current
comma
op_minus
l_int|10
)paren
suffix:semicolon
id|current-&gt;flags
op_or_assign
id|PF_IOTHREAD
suffix:semicolon
id|set_fs
c_func
(paren
id|KERNEL_DS
)paren
suffix:semicolon
id|BT_DBG
c_func
(paren
l_string|&quot;&quot;
)paren
suffix:semicolon
id|rfcomm_add_listener
c_func
(paren
id|BDADDR_ANY
)paren
suffix:semicolon
id|rfcomm_worker
c_func
(paren
)paren
suffix:semicolon
id|rfcomm_kill_listener
c_func
(paren
)paren
suffix:semicolon
id|atomic_dec
c_func
(paren
op_amp
id|running
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* ---- Proc fs support ---- */
macro_line|#ifdef CONFIG_PROC_FS
DECL|function|rfcomm_seq_start
r_static
r_void
op_star
id|rfcomm_seq_start
c_func
(paren
r_struct
id|seq_file
op_star
id|seq
comma
id|loff_t
op_star
id|pos
)paren
(brace
r_struct
id|rfcomm_session
op_star
id|s
suffix:semicolon
r_struct
id|list_head
op_star
id|pp
comma
op_star
id|p
suffix:semicolon
id|loff_t
id|l
op_assign
op_star
id|pos
suffix:semicolon
id|rfcomm_lock
c_func
(paren
)paren
suffix:semicolon
id|list_for_each
c_func
(paren
id|p
comma
op_amp
id|session_list
)paren
(brace
id|s
op_assign
id|list_entry
c_func
(paren
id|p
comma
r_struct
id|rfcomm_session
comma
id|list
)paren
suffix:semicolon
id|list_for_each
c_func
(paren
id|pp
comma
op_amp
id|s-&gt;dlcs
)paren
r_if
c_cond
(paren
op_logical_neg
id|l
op_decrement
)paren
(brace
id|seq
op_member_access_from_pointer
r_private
op_assign
id|s
suffix:semicolon
r_return
id|pp
suffix:semicolon
)brace
)brace
r_return
l_int|NULL
suffix:semicolon
)brace
DECL|function|rfcomm_seq_next
r_static
r_void
op_star
id|rfcomm_seq_next
c_func
(paren
r_struct
id|seq_file
op_star
id|seq
comma
r_void
op_star
id|e
comma
id|loff_t
op_star
id|pos
)paren
(brace
r_struct
id|rfcomm_session
op_star
id|s
op_assign
id|seq
op_member_access_from_pointer
r_private
suffix:semicolon
r_struct
id|list_head
op_star
id|pp
comma
op_star
id|p
op_assign
id|e
suffix:semicolon
(paren
op_star
id|pos
)paren
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;next
op_ne
op_amp
id|s-&gt;dlcs
)paren
r_return
id|p-&gt;next
suffix:semicolon
id|list_for_each
c_func
(paren
id|p
comma
op_amp
id|session_list
)paren
(brace
id|s
op_assign
id|list_entry
c_func
(paren
id|p
comma
r_struct
id|rfcomm_session
comma
id|list
)paren
suffix:semicolon
id|__list_for_each
c_func
(paren
id|pp
comma
op_amp
id|s-&gt;dlcs
)paren
(brace
id|seq
op_member_access_from_pointer
r_private
op_assign
id|s
suffix:semicolon
r_return
id|pp
suffix:semicolon
)brace
)brace
r_return
l_int|NULL
suffix:semicolon
)brace
DECL|function|rfcomm_seq_stop
r_static
r_void
id|rfcomm_seq_stop
c_func
(paren
r_struct
id|seq_file
op_star
id|seq
comma
r_void
op_star
id|e
)paren
(brace
id|rfcomm_unlock
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|rfcomm_seq_show
r_static
r_int
id|rfcomm_seq_show
c_func
(paren
r_struct
id|seq_file
op_star
id|seq
comma
r_void
op_star
id|e
)paren
(brace
r_struct
id|rfcomm_session
op_star
id|s
op_assign
id|seq
op_member_access_from_pointer
r_private
suffix:semicolon
r_struct
id|sock
op_star
id|sk
op_assign
id|s-&gt;sock-&gt;sk
suffix:semicolon
r_struct
id|rfcomm_dlc
op_star
id|d
op_assign
id|list_entry
c_func
(paren
id|e
comma
r_struct
id|rfcomm_dlc
comma
id|list
)paren
suffix:semicolon
id|seq_printf
c_func
(paren
id|seq
comma
l_string|&quot;%s %s %ld %d %d %d %d&bslash;n&quot;
comma
id|batostr
c_func
(paren
op_amp
id|bt_sk
c_func
(paren
id|sk
)paren
op_member_access_from_pointer
id|src
)paren
comma
id|batostr
c_func
(paren
op_amp
id|bt_sk
c_func
(paren
id|sk
)paren
op_member_access_from_pointer
id|dst
)paren
comma
id|d-&gt;state
comma
id|d-&gt;dlci
comma
id|d-&gt;mtu
comma
id|d-&gt;rx_credits
comma
id|d-&gt;tx_credits
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|rfcomm_seq_ops
r_static
r_struct
id|seq_operations
id|rfcomm_seq_ops
op_assign
(brace
dot
id|start
op_assign
id|rfcomm_seq_start
comma
dot
id|next
op_assign
id|rfcomm_seq_next
comma
dot
id|stop
op_assign
id|rfcomm_seq_stop
comma
dot
id|show
op_assign
id|rfcomm_seq_show
)brace
suffix:semicolon
DECL|function|rfcomm_seq_open
r_static
r_int
id|rfcomm_seq_open
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
(brace
r_return
id|seq_open
c_func
(paren
id|file
comma
op_amp
id|rfcomm_seq_ops
)paren
suffix:semicolon
)brace
DECL|variable|rfcomm_seq_fops
r_static
r_struct
id|file_operations
id|rfcomm_seq_fops
op_assign
(brace
dot
id|owner
op_assign
id|THIS_MODULE
comma
dot
id|open
op_assign
id|rfcomm_seq_open
comma
dot
id|read
op_assign
id|seq_read
comma
dot
id|llseek
op_assign
id|seq_lseek
comma
dot
id|release
op_assign
id|seq_release
comma
)brace
suffix:semicolon
DECL|function|rfcomm_proc_init
r_static
r_int
id|__init
id|rfcomm_proc_init
c_func
(paren
r_void
)paren
(brace
r_struct
id|proc_dir_entry
op_star
id|p
suffix:semicolon
id|proc_bt_rfcomm
op_assign
id|proc_mkdir
c_func
(paren
l_string|&quot;rfcomm&quot;
comma
id|proc_bt
)paren
suffix:semicolon
r_if
c_cond
(paren
id|proc_bt_rfcomm
)paren
(brace
id|proc_bt_rfcomm-&gt;owner
op_assign
id|THIS_MODULE
suffix:semicolon
id|p
op_assign
id|create_proc_entry
c_func
(paren
l_string|&quot;dlc&quot;
comma
id|S_IRUGO
comma
id|proc_bt_rfcomm
)paren
suffix:semicolon
r_if
c_cond
(paren
id|p
)paren
id|p-&gt;proc_fops
op_assign
op_amp
id|rfcomm_seq_fops
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|rfcomm_proc_cleanup
r_static
r_void
id|__exit
id|rfcomm_proc_cleanup
c_func
(paren
r_void
)paren
(brace
id|remove_proc_entry
c_func
(paren
l_string|&quot;dlc&quot;
comma
id|proc_bt_rfcomm
)paren
suffix:semicolon
id|remove_proc_entry
c_func
(paren
l_string|&quot;rfcomm&quot;
comma
id|proc_bt
)paren
suffix:semicolon
)brace
macro_line|#else /* CONFIG_PROC_FS */
DECL|function|rfcomm_proc_init
r_static
r_int
id|__init
id|rfcomm_proc_init
c_func
(paren
r_void
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|rfcomm_proc_cleanup
r_static
r_void
id|__exit
id|rfcomm_proc_cleanup
c_func
(paren
r_void
)paren
(brace
r_return
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_PROC_FS */
multiline_comment|/* ---- Initialization ---- */
DECL|function|rfcomm_init
r_int
id|__init
id|rfcomm_init
c_func
(paren
r_void
)paren
(brace
id|l2cap_load
c_func
(paren
)paren
suffix:semicolon
id|kernel_thread
c_func
(paren
id|rfcomm_run
comma
l_int|NULL
comma
id|CLONE_KERNEL
)paren
suffix:semicolon
id|BT_INFO
c_func
(paren
l_string|&quot;RFCOMM ver %s&quot;
comma
id|VERSION
)paren
suffix:semicolon
id|rfcomm_proc_init
c_func
(paren
)paren
suffix:semicolon
id|rfcomm_init_sockets
c_func
(paren
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_BT_RFCOMM_TTY
id|rfcomm_init_ttys
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|rfcomm_cleanup
r_void
id|__exit
id|rfcomm_cleanup
c_func
(paren
r_void
)paren
(brace
multiline_comment|/* Terminate working thread.&n;&t; * ie. Set terminate flag and wake it up */
id|atomic_inc
c_func
(paren
op_amp
id|terminate
)paren
suffix:semicolon
id|rfcomm_schedule
c_func
(paren
id|RFCOMM_SCHED_STATE
)paren
suffix:semicolon
multiline_comment|/* Wait until thread is running */
r_while
c_loop
(paren
id|atomic_read
c_func
(paren
op_amp
id|running
)paren
)paren
id|schedule
c_func
(paren
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_BT_RFCOMM_TTY
id|rfcomm_cleanup_ttys
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif
id|rfcomm_cleanup_sockets
c_func
(paren
)paren
suffix:semicolon
id|rfcomm_proc_cleanup
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|variable|rfcomm_init
id|module_init
c_func
(paren
id|rfcomm_init
)paren
suffix:semicolon
DECL|variable|rfcomm_cleanup
id|module_exit
c_func
(paren
id|rfcomm_cleanup
)paren
suffix:semicolon
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Maxim Krasnyansky &lt;maxk@qualcomm.com&gt;, Marcel Holtmann &lt;marcel@holtmann.org&gt;&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;Bluetooth RFCOMM ver &quot;
id|VERSION
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
id|MODULE_ALIAS
c_func
(paren
l_string|&quot;bt-proto-3&quot;
)paren
suffix:semicolon
eof
