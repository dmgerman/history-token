multiline_comment|/* &n;   HIDP implementation for Linux Bluetooth stack (BlueZ).&n;   Copyright (C) 2003-2004 Marcel Holtmann &lt;marcel@holtmann.org&gt;&n;&n;   This program is free software; you can redistribute it and/or modify&n;   it under the terms of the GNU General Public License version 2 as&n;   published by the Free Software Foundation;&n;&n;   THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS&n;   OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,&n;   FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT OF THIRD PARTY RIGHTS.&n;   IN NO EVENT SHALL THE COPYRIGHT HOLDER(S) AND AUTHOR(S) BE LIABLE FOR ANY&n;   CLAIM, OR ANY SPECIAL INDIRECT OR CONSEQUENTIAL DAMAGES, OR ANY DAMAGES &n;   WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN &n;   ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF &n;   OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.&n;&n;   ALL LIABILITY, INCLUDING LIABILITY FOR INFRINGEMENT OF ANY PATENTS, &n;   COPYRIGHTS, TRADEMARKS OR OTHER RIGHTS, RELATING TO USE OF THIS &n;   SOFTWARE IS DISCLAIMED.&n;*/
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/major.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/poll.h&gt;
macro_line|#include &lt;linux/fcntl.h&gt;
macro_line|#include &lt;linux/skbuff.h&gt;
macro_line|#include &lt;linux/socket.h&gt;
macro_line|#include &lt;linux/ioctl.h&gt;
macro_line|#include &lt;linux/file.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/wait.h&gt;
macro_line|#include &lt;net/sock.h&gt;
macro_line|#include &lt;linux/input.h&gt;
macro_line|#include &lt;net/bluetooth/bluetooth.h&gt;
macro_line|#include &lt;net/bluetooth/l2cap.h&gt;
macro_line|#include &quot;hidp.h&quot;
macro_line|#ifndef CONFIG_BT_HIDP_DEBUG
DECL|macro|BT_DBG
macro_line|#undef  BT_DBG
DECL|macro|BT_DBG
mdefine_line|#define BT_DBG(D...)
macro_line|#endif
DECL|macro|VERSION
mdefine_line|#define VERSION &quot;1.1&quot;
r_static
id|DECLARE_RWSEM
c_func
(paren
id|hidp_session_sem
)paren
suffix:semicolon
r_static
id|LIST_HEAD
c_func
(paren
id|hidp_session_list
)paren
suffix:semicolon
DECL|variable|hidp_keycode
r_static
r_int
r_char
id|hidp_keycode
(braket
l_int|256
)braket
op_assign
(brace
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|30
comma
l_int|48
comma
l_int|46
comma
l_int|32
comma
l_int|18
comma
l_int|33
comma
l_int|34
comma
l_int|35
comma
l_int|23
comma
l_int|36
comma
l_int|37
comma
l_int|38
comma
l_int|50
comma
l_int|49
comma
l_int|24
comma
l_int|25
comma
l_int|16
comma
l_int|19
comma
l_int|31
comma
l_int|20
comma
l_int|22
comma
l_int|47
comma
l_int|17
comma
l_int|45
comma
l_int|21
comma
l_int|44
comma
l_int|2
comma
l_int|3
comma
l_int|4
comma
l_int|5
comma
l_int|6
comma
l_int|7
comma
l_int|8
comma
l_int|9
comma
l_int|10
comma
l_int|11
comma
l_int|28
comma
l_int|1
comma
l_int|14
comma
l_int|15
comma
l_int|57
comma
l_int|12
comma
l_int|13
comma
l_int|26
comma
l_int|27
comma
l_int|43
comma
l_int|43
comma
l_int|39
comma
l_int|40
comma
l_int|41
comma
l_int|51
comma
l_int|52
comma
l_int|53
comma
l_int|58
comma
l_int|59
comma
l_int|60
comma
l_int|61
comma
l_int|62
comma
l_int|63
comma
l_int|64
comma
l_int|65
comma
l_int|66
comma
l_int|67
comma
l_int|68
comma
l_int|87
comma
l_int|88
comma
l_int|99
comma
l_int|70
comma
l_int|119
comma
l_int|110
comma
l_int|102
comma
l_int|104
comma
l_int|111
comma
l_int|107
comma
l_int|109
comma
l_int|106
comma
l_int|105
comma
l_int|108
comma
l_int|103
comma
l_int|69
comma
l_int|98
comma
l_int|55
comma
l_int|74
comma
l_int|78
comma
l_int|96
comma
l_int|79
comma
l_int|80
comma
l_int|81
comma
l_int|75
comma
l_int|76
comma
l_int|77
comma
l_int|71
comma
l_int|72
comma
l_int|73
comma
l_int|82
comma
l_int|83
comma
l_int|86
comma
l_int|127
comma
l_int|116
comma
l_int|117
comma
l_int|183
comma
l_int|184
comma
l_int|185
comma
l_int|186
comma
l_int|187
comma
l_int|188
comma
l_int|189
comma
l_int|190
comma
l_int|191
comma
l_int|192
comma
l_int|193
comma
l_int|194
comma
l_int|134
comma
l_int|138
comma
l_int|130
comma
l_int|132
comma
l_int|128
comma
l_int|129
comma
l_int|131
comma
l_int|137
comma
l_int|133
comma
l_int|135
comma
l_int|136
comma
l_int|113
comma
l_int|115
comma
l_int|114
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|121
comma
l_int|0
comma
l_int|89
comma
l_int|93
comma
l_int|124
comma
l_int|92
comma
l_int|94
comma
l_int|95
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|122
comma
l_int|123
comma
l_int|90
comma
l_int|91
comma
l_int|85
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|29
comma
l_int|42
comma
l_int|56
comma
l_int|125
comma
l_int|97
comma
l_int|54
comma
l_int|100
comma
l_int|126
comma
l_int|164
comma
l_int|166
comma
l_int|165
comma
l_int|163
comma
l_int|161
comma
l_int|115
comma
l_int|114
comma
l_int|113
comma
l_int|150
comma
l_int|158
comma
l_int|159
comma
l_int|128
comma
l_int|136
comma
l_int|177
comma
l_int|178
comma
l_int|176
comma
l_int|142
comma
l_int|152
comma
l_int|173
comma
l_int|140
)brace
suffix:semicolon
DECL|variable|hidp_mkeyspat
r_static
r_int
r_char
id|hidp_mkeyspat
(braket
)braket
op_assign
(brace
l_int|0x01
comma
l_int|0x01
comma
l_int|0x01
comma
l_int|0x01
comma
l_int|0x01
comma
l_int|0x01
)brace
suffix:semicolon
DECL|function|__hidp_get_session
r_static
r_struct
id|hidp_session
op_star
id|__hidp_get_session
c_func
(paren
id|bdaddr_t
op_star
id|bdaddr
)paren
(brace
r_struct
id|hidp_session
op_star
id|session
suffix:semicolon
r_struct
id|list_head
op_star
id|p
suffix:semicolon
id|BT_DBG
c_func
(paren
l_string|&quot;&quot;
)paren
suffix:semicolon
id|list_for_each
c_func
(paren
id|p
comma
op_amp
id|hidp_session_list
)paren
(brace
id|session
op_assign
id|list_entry
c_func
(paren
id|p
comma
r_struct
id|hidp_session
comma
id|list
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|bacmp
c_func
(paren
id|bdaddr
comma
op_amp
id|session-&gt;bdaddr
)paren
)paren
r_return
id|session
suffix:semicolon
)brace
r_return
l_int|NULL
suffix:semicolon
)brace
DECL|function|__hidp_link_session
r_static
r_void
id|__hidp_link_session
c_func
(paren
r_struct
id|hidp_session
op_star
id|session
)paren
(brace
id|__module_get
c_func
(paren
id|THIS_MODULE
)paren
suffix:semicolon
id|list_add
c_func
(paren
op_amp
id|session-&gt;list
comma
op_amp
id|hidp_session_list
)paren
suffix:semicolon
)brace
DECL|function|__hidp_unlink_session
r_static
r_void
id|__hidp_unlink_session
c_func
(paren
r_struct
id|hidp_session
op_star
id|session
)paren
(brace
id|list_del
c_func
(paren
op_amp
id|session-&gt;list
)paren
suffix:semicolon
id|module_put
c_func
(paren
id|THIS_MODULE
)paren
suffix:semicolon
)brace
DECL|function|__hidp_copy_session
r_static
r_void
id|__hidp_copy_session
c_func
(paren
r_struct
id|hidp_session
op_star
id|session
comma
r_struct
id|hidp_conninfo
op_star
id|ci
)paren
(brace
id|bacpy
c_func
(paren
op_amp
id|ci-&gt;bdaddr
comma
op_amp
id|session-&gt;bdaddr
)paren
suffix:semicolon
id|ci-&gt;flags
op_assign
id|session-&gt;flags
suffix:semicolon
id|ci-&gt;state
op_assign
id|session-&gt;state
suffix:semicolon
id|ci-&gt;vendor
op_assign
l_int|0x0000
suffix:semicolon
id|ci-&gt;product
op_assign
l_int|0x0000
suffix:semicolon
id|ci-&gt;version
op_assign
l_int|0x0000
suffix:semicolon
id|memset
c_func
(paren
id|ci-&gt;name
comma
l_int|0
comma
l_int|128
)paren
suffix:semicolon
r_if
c_cond
(paren
id|session-&gt;input
)paren
(brace
id|ci-&gt;vendor
op_assign
id|session-&gt;input-&gt;id.vendor
suffix:semicolon
id|ci-&gt;product
op_assign
id|session-&gt;input-&gt;id.product
suffix:semicolon
id|ci-&gt;version
op_assign
id|session-&gt;input-&gt;id.version
suffix:semicolon
r_if
c_cond
(paren
id|session-&gt;input-&gt;name
)paren
id|strncpy
c_func
(paren
id|ci-&gt;name
comma
id|session-&gt;input-&gt;name
comma
l_int|128
)paren
suffix:semicolon
r_else
id|strncpy
c_func
(paren
id|ci-&gt;name
comma
l_string|&quot;HID Boot Device&quot;
comma
l_int|128
)paren
suffix:semicolon
)brace
)brace
DECL|function|hidp_input_event
r_static
r_int
id|hidp_input_event
c_func
(paren
r_struct
id|input_dev
op_star
id|dev
comma
r_int
r_int
id|type
comma
r_int
r_int
id|code
comma
r_int
id|value
)paren
(brace
r_struct
id|hidp_session
op_star
id|session
op_assign
id|dev
op_member_access_from_pointer
r_private
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_int
r_char
id|newleds
suffix:semicolon
id|BT_DBG
c_func
(paren
l_string|&quot;input %p type %d code %d value %d&quot;
comma
id|dev
comma
id|type
comma
id|code
comma
id|value
)paren
suffix:semicolon
r_if
c_cond
(paren
id|type
op_ne
id|EV_LED
)paren
r_return
op_minus
l_int|1
suffix:semicolon
id|newleds
op_assign
(paren
op_logical_neg
op_logical_neg
id|test_bit
c_func
(paren
id|LED_KANA
comma
id|dev-&gt;led
)paren
op_lshift
l_int|3
)paren
op_or
(paren
op_logical_neg
op_logical_neg
id|test_bit
c_func
(paren
id|LED_COMPOSE
comma
id|dev-&gt;led
)paren
op_lshift
l_int|3
)paren
op_or
(paren
op_logical_neg
op_logical_neg
id|test_bit
c_func
(paren
id|LED_SCROLLL
comma
id|dev-&gt;led
)paren
op_lshift
l_int|2
)paren
op_or
(paren
op_logical_neg
op_logical_neg
id|test_bit
c_func
(paren
id|LED_CAPSL
comma
id|dev-&gt;led
)paren
op_lshift
l_int|1
)paren
op_or
(paren
op_logical_neg
op_logical_neg
id|test_bit
c_func
(paren
id|LED_NUML
comma
id|dev-&gt;led
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|session-&gt;leds
op_eq
id|newleds
)paren
r_return
l_int|0
suffix:semicolon
id|session-&gt;leds
op_assign
id|newleds
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|skb
op_assign
id|alloc_skb
c_func
(paren
l_int|3
comma
id|GFP_ATOMIC
)paren
)paren
)paren
(brace
id|BT_ERR
c_func
(paren
l_string|&quot;Can&squot;t allocate memory for new frame&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
op_star
id|skb_put
c_func
(paren
id|skb
comma
l_int|1
)paren
op_assign
id|HIDP_TRANS_DATA
op_or
id|HIDP_DATA_RTYPE_OUPUT
suffix:semicolon
op_star
id|skb_put
c_func
(paren
id|skb
comma
l_int|1
)paren
op_assign
l_int|0x01
suffix:semicolon
op_star
id|skb_put
c_func
(paren
id|skb
comma
l_int|1
)paren
op_assign
id|newleds
suffix:semicolon
id|skb_queue_tail
c_func
(paren
op_amp
id|session-&gt;intr_transmit
comma
id|skb
)paren
suffix:semicolon
id|hidp_schedule
c_func
(paren
id|session
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|hidp_input_report
r_static
r_void
id|hidp_input_report
c_func
(paren
r_struct
id|hidp_session
op_star
id|session
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|input_dev
op_star
id|dev
op_assign
id|session-&gt;input
suffix:semicolon
r_int
r_char
op_star
id|keys
op_assign
id|session-&gt;keys
suffix:semicolon
r_int
r_char
op_star
id|udata
op_assign
id|skb-&gt;data
op_plus
l_int|1
suffix:semicolon
r_int
r_char
op_star
id|sdata
op_assign
id|skb-&gt;data
op_plus
l_int|1
suffix:semicolon
r_int
id|i
comma
id|size
op_assign
id|skb-&gt;len
op_minus
l_int|1
suffix:semicolon
r_switch
c_cond
(paren
id|skb-&gt;data
(braket
l_int|0
)braket
)paren
(brace
r_case
l_int|0x01
suffix:colon
multiline_comment|/* Keyboard report */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
suffix:semicolon
id|i
op_increment
)paren
id|input_report_key
c_func
(paren
id|dev
comma
id|hidp_keycode
(braket
id|i
op_plus
l_int|224
)braket
comma
(paren
id|udata
(braket
l_int|0
)braket
op_rshift
id|i
)paren
op_amp
l_int|1
)paren
suffix:semicolon
multiline_comment|/* If all the key codes have been set to 0x01, it means&n;&t;&t; * too many keys were pressed at the same time. */
r_if
c_cond
(paren
op_logical_neg
id|memcmp
c_func
(paren
id|udata
op_plus
l_int|2
comma
id|hidp_mkeyspat
comma
l_int|6
)paren
)paren
r_break
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|2
suffix:semicolon
id|i
OL
l_int|8
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|keys
(braket
id|i
)braket
OG
l_int|3
op_logical_and
id|memscan
c_func
(paren
id|udata
op_plus
l_int|2
comma
id|keys
(braket
id|i
)braket
comma
l_int|6
)paren
op_eq
id|udata
op_plus
l_int|8
)paren
(brace
r_if
c_cond
(paren
id|hidp_keycode
(braket
id|keys
(braket
id|i
)braket
)braket
)paren
id|input_report_key
c_func
(paren
id|dev
comma
id|hidp_keycode
(braket
id|keys
(braket
id|i
)braket
)braket
comma
l_int|0
)paren
suffix:semicolon
r_else
id|BT_ERR
c_func
(paren
l_string|&quot;Unknown key (scancode %#x) released.&quot;
comma
id|keys
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|udata
(braket
id|i
)braket
OG
l_int|3
op_logical_and
id|memscan
c_func
(paren
id|keys
op_plus
l_int|2
comma
id|udata
(braket
id|i
)braket
comma
l_int|6
)paren
op_eq
id|keys
op_plus
l_int|8
)paren
(brace
r_if
c_cond
(paren
id|hidp_keycode
(braket
id|udata
(braket
id|i
)braket
)braket
)paren
id|input_report_key
c_func
(paren
id|dev
comma
id|hidp_keycode
(braket
id|udata
(braket
id|i
)braket
)braket
comma
l_int|1
)paren
suffix:semicolon
r_else
id|BT_ERR
c_func
(paren
l_string|&quot;Unknown key (scancode %#x) pressed.&quot;
comma
id|udata
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
)brace
id|memcpy
c_func
(paren
id|keys
comma
id|udata
comma
l_int|8
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x02
suffix:colon
multiline_comment|/* Mouse report */
id|input_report_key
c_func
(paren
id|dev
comma
id|BTN_LEFT
comma
id|sdata
(braket
l_int|0
)braket
op_amp
l_int|0x01
)paren
suffix:semicolon
id|input_report_key
c_func
(paren
id|dev
comma
id|BTN_RIGHT
comma
id|sdata
(braket
l_int|0
)braket
op_amp
l_int|0x02
)paren
suffix:semicolon
id|input_report_key
c_func
(paren
id|dev
comma
id|BTN_MIDDLE
comma
id|sdata
(braket
l_int|0
)braket
op_amp
l_int|0x04
)paren
suffix:semicolon
id|input_report_key
c_func
(paren
id|dev
comma
id|BTN_SIDE
comma
id|sdata
(braket
l_int|0
)braket
op_amp
l_int|0x08
)paren
suffix:semicolon
id|input_report_key
c_func
(paren
id|dev
comma
id|BTN_EXTRA
comma
id|sdata
(braket
l_int|0
)braket
op_amp
l_int|0x10
)paren
suffix:semicolon
id|input_report_rel
c_func
(paren
id|dev
comma
id|REL_X
comma
id|sdata
(braket
l_int|1
)braket
)paren
suffix:semicolon
id|input_report_rel
c_func
(paren
id|dev
comma
id|REL_Y
comma
id|sdata
(braket
l_int|2
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|size
OG
l_int|3
)paren
id|input_report_rel
c_func
(paren
id|dev
comma
id|REL_WHEEL
comma
id|sdata
(braket
l_int|3
)braket
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|input_sync
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
DECL|function|hidp_idle_timeout
r_static
r_void
id|hidp_idle_timeout
c_func
(paren
r_int
r_int
id|arg
)paren
(brace
r_struct
id|hidp_session
op_star
id|session
op_assign
(paren
r_struct
id|hidp_session
op_star
)paren
id|arg
suffix:semicolon
id|atomic_inc
c_func
(paren
op_amp
id|session-&gt;terminate
)paren
suffix:semicolon
id|hidp_schedule
c_func
(paren
id|session
)paren
suffix:semicolon
)brace
DECL|function|hidp_set_timer
r_static
r_inline
r_void
id|hidp_set_timer
c_func
(paren
r_struct
id|hidp_session
op_star
id|session
)paren
(brace
r_if
c_cond
(paren
id|session-&gt;idle_to
OG
l_int|0
)paren
id|mod_timer
c_func
(paren
op_amp
id|session-&gt;timer
comma
id|jiffies
op_plus
id|HZ
op_star
id|session-&gt;idle_to
)paren
suffix:semicolon
)brace
DECL|function|hidp_del_timer
r_static
r_inline
r_void
id|hidp_del_timer
c_func
(paren
r_struct
id|hidp_session
op_star
id|session
)paren
(brace
r_if
c_cond
(paren
id|session-&gt;idle_to
OG
l_int|0
)paren
id|del_timer
c_func
(paren
op_amp
id|session-&gt;timer
)paren
suffix:semicolon
)brace
DECL|function|__hidp_send_ctrl_message
r_static
r_int
id|__hidp_send_ctrl_message
c_func
(paren
r_struct
id|hidp_session
op_star
id|session
comma
r_int
r_char
id|hdr
comma
r_int
r_char
op_star
id|data
comma
r_int
id|size
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
id|BT_DBG
c_func
(paren
l_string|&quot;session %p data %p size %d&quot;
comma
id|session
comma
id|data
comma
id|size
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|skb
op_assign
id|alloc_skb
c_func
(paren
id|size
op_plus
l_int|1
comma
id|GFP_ATOMIC
)paren
)paren
)paren
(brace
id|BT_ERR
c_func
(paren
l_string|&quot;Can&squot;t allocate memory for new frame&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
op_star
id|skb_put
c_func
(paren
id|skb
comma
l_int|1
)paren
op_assign
id|hdr
suffix:semicolon
r_if
c_cond
(paren
id|data
op_logical_and
id|size
OG
l_int|0
)paren
id|memcpy
c_func
(paren
id|skb_put
c_func
(paren
id|skb
comma
id|size
)paren
comma
id|data
comma
id|size
)paren
suffix:semicolon
id|skb_queue_tail
c_func
(paren
op_amp
id|session-&gt;ctrl_transmit
comma
id|skb
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|hidp_send_ctrl_message
r_static
r_int
r_inline
id|hidp_send_ctrl_message
c_func
(paren
r_struct
id|hidp_session
op_star
id|session
comma
r_int
r_char
id|hdr
comma
r_int
r_char
op_star
id|data
comma
r_int
id|size
)paren
(brace
r_int
id|err
suffix:semicolon
id|err
op_assign
id|__hidp_send_ctrl_message
c_func
(paren
id|session
comma
id|hdr
comma
id|data
comma
id|size
)paren
suffix:semicolon
id|hidp_schedule
c_func
(paren
id|session
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|hidp_process_handshake
r_static
r_inline
r_void
id|hidp_process_handshake
c_func
(paren
r_struct
id|hidp_session
op_star
id|session
comma
r_int
r_char
id|param
)paren
(brace
id|BT_DBG
c_func
(paren
l_string|&quot;session %p param 0x%02x&quot;
comma
id|session
comma
id|param
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|param
)paren
(brace
r_case
id|HIDP_HSHK_SUCCESSFUL
suffix:colon
multiline_comment|/* FIXME: Call into SET_ GET_ handlers here */
r_break
suffix:semicolon
r_case
id|HIDP_HSHK_NOT_READY
suffix:colon
r_case
id|HIDP_HSHK_ERR_INVALID_REPORT_ID
suffix:colon
r_case
id|HIDP_HSHK_ERR_UNSUPPORTED_REQUEST
suffix:colon
r_case
id|HIDP_HSHK_ERR_INVALID_PARAMETER
suffix:colon
multiline_comment|/* FIXME: Call into SET_ GET_ handlers here */
r_break
suffix:semicolon
r_case
id|HIDP_HSHK_ERR_UNKNOWN
suffix:colon
r_break
suffix:semicolon
r_case
id|HIDP_HSHK_ERR_FATAL
suffix:colon
multiline_comment|/* Device requests a reboot, as this is the only way this error&n; &t;&t; * can be recovered. */
id|__hidp_send_ctrl_message
c_func
(paren
id|session
comma
id|HIDP_TRANS_HID_CONTROL
op_or
id|HIDP_CTRL_SOFT_RESET
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|__hidp_send_ctrl_message
c_func
(paren
id|session
comma
id|HIDP_TRANS_HANDSHAKE
op_or
id|HIDP_HSHK_ERR_INVALID_PARAMETER
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
DECL|function|hidp_process_hid_control
r_static
r_inline
r_void
id|hidp_process_hid_control
c_func
(paren
r_struct
id|hidp_session
op_star
id|session
comma
r_int
r_char
id|param
)paren
(brace
id|BT_DBG
c_func
(paren
l_string|&quot;session %p param 0x%02x&quot;
comma
id|session
comma
id|param
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|param
)paren
(brace
r_case
id|HIDP_CTRL_NOP
suffix:colon
r_break
suffix:semicolon
r_case
id|HIDP_CTRL_VIRTUAL_CABLE_UNPLUG
suffix:colon
multiline_comment|/* Flush the transmit queues */
id|skb_queue_purge
c_func
(paren
op_amp
id|session-&gt;ctrl_transmit
)paren
suffix:semicolon
id|skb_queue_purge
c_func
(paren
op_amp
id|session-&gt;intr_transmit
)paren
suffix:semicolon
multiline_comment|/* Kill session thread */
id|atomic_inc
c_func
(paren
op_amp
id|session-&gt;terminate
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|HIDP_CTRL_HARD_RESET
suffix:colon
r_case
id|HIDP_CTRL_SOFT_RESET
suffix:colon
r_case
id|HIDP_CTRL_SUSPEND
suffix:colon
r_case
id|HIDP_CTRL_EXIT_SUSPEND
suffix:colon
multiline_comment|/* FIXME: We have to parse these and return no error */
r_break
suffix:semicolon
r_default
suffix:colon
id|__hidp_send_ctrl_message
c_func
(paren
id|session
comma
id|HIDP_TRANS_HANDSHAKE
op_or
id|HIDP_HSHK_ERR_INVALID_PARAMETER
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
DECL|function|hidp_process_data
r_static
r_inline
r_void
id|hidp_process_data
c_func
(paren
r_struct
id|hidp_session
op_star
id|session
comma
r_struct
id|sk_buff
op_star
id|skb
comma
r_int
r_char
id|param
)paren
(brace
id|BT_DBG
c_func
(paren
l_string|&quot;session %p skb %p len %d param 0x%02x&quot;
comma
id|session
comma
id|skb
comma
id|skb-&gt;len
comma
id|param
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|param
)paren
(brace
r_case
id|HIDP_DATA_RTYPE_INPUT
suffix:colon
id|hidp_set_timer
c_func
(paren
id|session
)paren
suffix:semicolon
r_if
c_cond
(paren
id|session-&gt;input
)paren
id|hidp_input_report
c_func
(paren
id|session
comma
id|skb
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|HIDP_DATA_RTYPE_OTHER
suffix:colon
r_case
id|HIDP_DATA_RTYPE_OUPUT
suffix:colon
r_case
id|HIDP_DATA_RTYPE_FEATURE
suffix:colon
r_break
suffix:semicolon
r_default
suffix:colon
id|__hidp_send_ctrl_message
c_func
(paren
id|session
comma
id|HIDP_TRANS_HANDSHAKE
op_or
id|HIDP_HSHK_ERR_INVALID_PARAMETER
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
)brace
)brace
DECL|function|hidp_recv_ctrl_frame
r_static
r_inline
r_void
id|hidp_recv_ctrl_frame
c_func
(paren
r_struct
id|hidp_session
op_star
id|session
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_int
r_char
id|hdr
comma
id|type
comma
id|param
suffix:semicolon
id|BT_DBG
c_func
(paren
l_string|&quot;session %p skb %p len %d&quot;
comma
id|session
comma
id|skb
comma
id|skb-&gt;len
)paren
suffix:semicolon
id|hdr
op_assign
id|skb-&gt;data
(braket
l_int|0
)braket
suffix:semicolon
id|skb_pull
c_func
(paren
id|skb
comma
l_int|1
)paren
suffix:semicolon
id|type
op_assign
id|hdr
op_amp
id|HIDP_HEADER_TRANS_MASK
suffix:semicolon
id|param
op_assign
id|hdr
op_amp
id|HIDP_HEADER_PARAM_MASK
suffix:semicolon
r_switch
c_cond
(paren
id|type
)paren
(brace
r_case
id|HIDP_TRANS_HANDSHAKE
suffix:colon
id|hidp_process_handshake
c_func
(paren
id|session
comma
id|param
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|HIDP_TRANS_HID_CONTROL
suffix:colon
id|hidp_process_hid_control
c_func
(paren
id|session
comma
id|param
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|HIDP_TRANS_DATA
suffix:colon
id|hidp_process_data
c_func
(paren
id|session
comma
id|skb
comma
id|param
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|__hidp_send_ctrl_message
c_func
(paren
id|session
comma
id|HIDP_TRANS_HANDSHAKE
op_or
id|HIDP_HSHK_ERR_UNSUPPORTED_REQUEST
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
DECL|function|hidp_recv_intr_frame
r_static
r_inline
r_void
id|hidp_recv_intr_frame
c_func
(paren
r_struct
id|hidp_session
op_star
id|session
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_int
r_char
id|hdr
suffix:semicolon
id|BT_DBG
c_func
(paren
l_string|&quot;session %p skb %p len %d&quot;
comma
id|session
comma
id|skb
comma
id|skb-&gt;len
)paren
suffix:semicolon
id|hdr
op_assign
id|skb-&gt;data
(braket
l_int|0
)braket
suffix:semicolon
id|skb_pull
c_func
(paren
id|skb
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|hdr
op_eq
(paren
id|HIDP_TRANS_DATA
op_or
id|HIDP_DATA_RTYPE_INPUT
)paren
)paren
(brace
id|hidp_set_timer
c_func
(paren
id|session
)paren
suffix:semicolon
r_if
c_cond
(paren
id|session-&gt;input
)paren
id|hidp_input_report
c_func
(paren
id|session
comma
id|skb
)paren
suffix:semicolon
)brace
r_else
(brace
id|BT_DBG
c_func
(paren
l_string|&quot;Unsupported protocol header 0x%02x&quot;
comma
id|hdr
)paren
suffix:semicolon
)brace
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
DECL|function|hidp_send_frame
r_static
r_int
id|hidp_send_frame
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_int
r_char
op_star
id|data
comma
r_int
id|len
)paren
(brace
r_struct
id|kvec
id|iv
op_assign
(brace
id|data
comma
id|len
)brace
suffix:semicolon
r_struct
id|msghdr
id|msg
suffix:semicolon
id|BT_DBG
c_func
(paren
l_string|&quot;sock %p data %p len %d&quot;
comma
id|sock
comma
id|data
comma
id|len
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|len
)paren
r_return
l_int|0
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|msg
comma
l_int|0
comma
r_sizeof
(paren
id|msg
)paren
)paren
suffix:semicolon
r_return
id|kernel_sendmsg
c_func
(paren
id|sock
comma
op_amp
id|msg
comma
op_amp
id|iv
comma
l_int|1
comma
id|len
)paren
suffix:semicolon
)brace
DECL|function|hidp_process_transmit
r_static
r_int
id|hidp_process_transmit
c_func
(paren
r_struct
id|hidp_session
op_star
id|session
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
id|BT_DBG
c_func
(paren
l_string|&quot;session %p&quot;
comma
id|session
)paren
suffix:semicolon
r_while
c_loop
(paren
(paren
id|skb
op_assign
id|skb_dequeue
c_func
(paren
op_amp
id|session-&gt;ctrl_transmit
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
id|hidp_send_frame
c_func
(paren
id|session-&gt;ctrl_sock
comma
id|skb-&gt;data
comma
id|skb-&gt;len
)paren
OL
l_int|0
)paren
(brace
id|skb_queue_head
c_func
(paren
op_amp
id|session-&gt;ctrl_transmit
comma
id|skb
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|hidp_set_timer
c_func
(paren
id|session
)paren
suffix:semicolon
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
(paren
id|skb
op_assign
id|skb_dequeue
c_func
(paren
op_amp
id|session-&gt;intr_transmit
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
id|hidp_send_frame
c_func
(paren
id|session-&gt;intr_sock
comma
id|skb-&gt;data
comma
id|skb-&gt;len
)paren
OL
l_int|0
)paren
(brace
id|skb_queue_head
c_func
(paren
op_amp
id|session-&gt;intr_transmit
comma
id|skb
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|hidp_set_timer
c_func
(paren
id|session
)paren
suffix:semicolon
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
r_return
id|skb_queue_len
c_func
(paren
op_amp
id|session-&gt;ctrl_transmit
)paren
op_plus
id|skb_queue_len
c_func
(paren
op_amp
id|session-&gt;intr_transmit
)paren
suffix:semicolon
)brace
DECL|function|hidp_session
r_static
r_int
id|hidp_session
c_func
(paren
r_void
op_star
id|arg
)paren
(brace
r_struct
id|hidp_session
op_star
id|session
op_assign
id|arg
suffix:semicolon
r_struct
id|sock
op_star
id|ctrl_sk
op_assign
id|session-&gt;ctrl_sock-&gt;sk
suffix:semicolon
r_struct
id|sock
op_star
id|intr_sk
op_assign
id|session-&gt;intr_sock-&gt;sk
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_int
id|vendor
op_assign
l_int|0x0000
comma
id|product
op_assign
l_int|0x0000
suffix:semicolon
id|wait_queue_t
id|ctrl_wait
comma
id|intr_wait
suffix:semicolon
id|BT_DBG
c_func
(paren
l_string|&quot;session %p&quot;
comma
id|session
)paren
suffix:semicolon
r_if
c_cond
(paren
id|session-&gt;input
)paren
(brace
id|vendor
op_assign
id|session-&gt;input-&gt;id.vendor
suffix:semicolon
id|product
op_assign
id|session-&gt;input-&gt;id.product
suffix:semicolon
)brace
id|daemonize
c_func
(paren
l_string|&quot;khidpd_%04x%04x&quot;
comma
id|vendor
comma
id|product
)paren
suffix:semicolon
id|set_user_nice
c_func
(paren
id|current
comma
op_minus
l_int|15
)paren
suffix:semicolon
id|current-&gt;flags
op_or_assign
id|PF_NOFREEZE
suffix:semicolon
id|init_waitqueue_entry
c_func
(paren
op_amp
id|ctrl_wait
comma
id|current
)paren
suffix:semicolon
id|init_waitqueue_entry
c_func
(paren
op_amp
id|intr_wait
comma
id|current
)paren
suffix:semicolon
id|add_wait_queue
c_func
(paren
id|ctrl_sk-&gt;sk_sleep
comma
op_amp
id|ctrl_wait
)paren
suffix:semicolon
id|add_wait_queue
c_func
(paren
id|intr_sk-&gt;sk_sleep
comma
op_amp
id|intr_wait
)paren
suffix:semicolon
r_while
c_loop
(paren
op_logical_neg
id|atomic_read
c_func
(paren
op_amp
id|session-&gt;terminate
)paren
)paren
(brace
id|set_current_state
c_func
(paren
id|TASK_INTERRUPTIBLE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ctrl_sk-&gt;sk_state
op_ne
id|BT_CONNECTED
op_logical_or
id|intr_sk-&gt;sk_state
op_ne
id|BT_CONNECTED
)paren
r_break
suffix:semicolon
r_while
c_loop
(paren
(paren
id|skb
op_assign
id|skb_dequeue
c_func
(paren
op_amp
id|ctrl_sk-&gt;sk_receive_queue
)paren
)paren
)paren
(brace
id|skb_orphan
c_func
(paren
id|skb
)paren
suffix:semicolon
id|hidp_recv_ctrl_frame
c_func
(paren
id|session
comma
id|skb
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
(paren
id|skb
op_assign
id|skb_dequeue
c_func
(paren
op_amp
id|intr_sk-&gt;sk_receive_queue
)paren
)paren
)paren
(brace
id|skb_orphan
c_func
(paren
id|skb
)paren
suffix:semicolon
id|hidp_recv_intr_frame
c_func
(paren
id|session
comma
id|skb
)paren
suffix:semicolon
)brace
id|hidp_process_transmit
c_func
(paren
id|session
)paren
suffix:semicolon
id|schedule
c_func
(paren
)paren
suffix:semicolon
)brace
id|set_current_state
c_func
(paren
id|TASK_RUNNING
)paren
suffix:semicolon
id|remove_wait_queue
c_func
(paren
id|intr_sk-&gt;sk_sleep
comma
op_amp
id|intr_wait
)paren
suffix:semicolon
id|remove_wait_queue
c_func
(paren
id|ctrl_sk-&gt;sk_sleep
comma
op_amp
id|ctrl_wait
)paren
suffix:semicolon
id|down_write
c_func
(paren
op_amp
id|hidp_session_sem
)paren
suffix:semicolon
id|hidp_del_timer
c_func
(paren
id|session
)paren
suffix:semicolon
r_if
c_cond
(paren
id|intr_sk-&gt;sk_state
op_ne
id|BT_CONNECTED
)paren
id|wait_event_timeout
c_func
(paren
op_star
(paren
id|ctrl_sk-&gt;sk_sleep
)paren
comma
(paren
id|ctrl_sk-&gt;sk_state
op_eq
id|BT_CLOSED
)paren
comma
id|HZ
)paren
suffix:semicolon
id|fput
c_func
(paren
id|session-&gt;ctrl_sock-&gt;file
)paren
suffix:semicolon
id|wait_event_timeout
c_func
(paren
op_star
(paren
id|intr_sk-&gt;sk_sleep
)paren
comma
(paren
id|intr_sk-&gt;sk_state
op_eq
id|BT_CLOSED
)paren
comma
id|HZ
)paren
suffix:semicolon
id|fput
c_func
(paren
id|session-&gt;intr_sock-&gt;file
)paren
suffix:semicolon
id|__hidp_unlink_session
c_func
(paren
id|session
)paren
suffix:semicolon
r_if
c_cond
(paren
id|session-&gt;input
)paren
(brace
id|input_unregister_device
c_func
(paren
id|session-&gt;input
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|session-&gt;input
)paren
suffix:semicolon
)brace
id|up_write
c_func
(paren
op_amp
id|hidp_session_sem
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|session
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|hidp_setup_input
r_static
r_inline
r_void
id|hidp_setup_input
c_func
(paren
r_struct
id|hidp_session
op_star
id|session
comma
r_struct
id|hidp_connadd_req
op_star
id|req
)paren
(brace
r_struct
id|input_dev
op_star
id|input
op_assign
id|session-&gt;input
suffix:semicolon
r_int
id|i
suffix:semicolon
id|input
op_member_access_from_pointer
r_private
op_assign
id|session
suffix:semicolon
id|input-&gt;id.bustype
op_assign
id|BUS_BLUETOOTH
suffix:semicolon
id|input-&gt;id.vendor
op_assign
id|req-&gt;vendor
suffix:semicolon
id|input-&gt;id.product
op_assign
id|req-&gt;product
suffix:semicolon
id|input-&gt;id.version
op_assign
id|req-&gt;version
suffix:semicolon
r_if
c_cond
(paren
id|req-&gt;subclass
op_amp
l_int|0x40
)paren
(brace
id|set_bit
c_func
(paren
id|EV_KEY
comma
id|input-&gt;evbit
)paren
suffix:semicolon
id|set_bit
c_func
(paren
id|EV_LED
comma
id|input-&gt;evbit
)paren
suffix:semicolon
id|set_bit
c_func
(paren
id|EV_REP
comma
id|input-&gt;evbit
)paren
suffix:semicolon
id|set_bit
c_func
(paren
id|LED_NUML
comma
id|input-&gt;ledbit
)paren
suffix:semicolon
id|set_bit
c_func
(paren
id|LED_CAPSL
comma
id|input-&gt;ledbit
)paren
suffix:semicolon
id|set_bit
c_func
(paren
id|LED_SCROLLL
comma
id|input-&gt;ledbit
)paren
suffix:semicolon
id|set_bit
c_func
(paren
id|LED_COMPOSE
comma
id|input-&gt;ledbit
)paren
suffix:semicolon
id|set_bit
c_func
(paren
id|LED_KANA
comma
id|input-&gt;ledbit
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
r_sizeof
(paren
id|hidp_keycode
)paren
suffix:semicolon
id|i
op_increment
)paren
id|set_bit
c_func
(paren
id|hidp_keycode
(braket
id|i
)braket
comma
id|input-&gt;keybit
)paren
suffix:semicolon
id|clear_bit
c_func
(paren
l_int|0
comma
id|input-&gt;keybit
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|req-&gt;subclass
op_amp
l_int|0x80
)paren
(brace
id|input-&gt;evbit
(braket
l_int|0
)braket
op_assign
id|BIT
c_func
(paren
id|EV_KEY
)paren
op_or
id|BIT
c_func
(paren
id|EV_REL
)paren
suffix:semicolon
id|input-&gt;keybit
(braket
id|LONG
c_func
(paren
id|BTN_MOUSE
)paren
)braket
op_assign
id|BIT
c_func
(paren
id|BTN_LEFT
)paren
op_or
id|BIT
c_func
(paren
id|BTN_RIGHT
)paren
op_or
id|BIT
c_func
(paren
id|BTN_MIDDLE
)paren
suffix:semicolon
id|input-&gt;relbit
(braket
l_int|0
)braket
op_assign
id|BIT
c_func
(paren
id|REL_X
)paren
op_or
id|BIT
c_func
(paren
id|REL_Y
)paren
suffix:semicolon
id|input-&gt;keybit
(braket
id|LONG
c_func
(paren
id|BTN_MOUSE
)paren
)braket
op_or_assign
id|BIT
c_func
(paren
id|BTN_SIDE
)paren
op_or
id|BIT
c_func
(paren
id|BTN_EXTRA
)paren
suffix:semicolon
id|input-&gt;relbit
(braket
l_int|0
)braket
op_or_assign
id|BIT
c_func
(paren
id|REL_WHEEL
)paren
suffix:semicolon
)brace
id|input-&gt;event
op_assign
id|hidp_input_event
suffix:semicolon
id|input_register_device
c_func
(paren
id|input
)paren
suffix:semicolon
)brace
DECL|function|hidp_add_connection
r_int
id|hidp_add_connection
c_func
(paren
r_struct
id|hidp_connadd_req
op_star
id|req
comma
r_struct
id|socket
op_star
id|ctrl_sock
comma
r_struct
id|socket
op_star
id|intr_sock
)paren
(brace
r_struct
id|hidp_session
op_star
id|session
comma
op_star
id|s
suffix:semicolon
r_int
id|err
suffix:semicolon
id|BT_DBG
c_func
(paren
l_string|&quot;&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bacmp
c_func
(paren
op_amp
id|bt_sk
c_func
(paren
id|ctrl_sock-&gt;sk
)paren
op_member_access_from_pointer
id|src
comma
op_amp
id|bt_sk
c_func
(paren
id|intr_sock-&gt;sk
)paren
op_member_access_from_pointer
id|src
)paren
op_logical_or
id|bacmp
c_func
(paren
op_amp
id|bt_sk
c_func
(paren
id|ctrl_sock-&gt;sk
)paren
op_member_access_from_pointer
id|dst
comma
op_amp
id|bt_sk
c_func
(paren
id|intr_sock-&gt;sk
)paren
op_member_access_from_pointer
id|dst
)paren
)paren
r_return
op_minus
id|ENOTUNIQ
suffix:semicolon
id|session
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|hidp_session
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|session
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|memset
c_func
(paren
id|session
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|hidp_session
)paren
)paren
suffix:semicolon
id|session-&gt;input
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|input_dev
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|session-&gt;input
)paren
(brace
id|kfree
c_func
(paren
id|session
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|memset
c_func
(paren
id|session-&gt;input
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|input_dev
)paren
)paren
suffix:semicolon
id|down_write
c_func
(paren
op_amp
id|hidp_session_sem
)paren
suffix:semicolon
id|s
op_assign
id|__hidp_get_session
c_func
(paren
op_amp
id|bt_sk
c_func
(paren
id|ctrl_sock-&gt;sk
)paren
op_member_access_from_pointer
id|dst
)paren
suffix:semicolon
r_if
c_cond
(paren
id|s
op_logical_and
id|s-&gt;state
op_eq
id|BT_CONNECTED
)paren
(brace
id|err
op_assign
op_minus
id|EEXIST
suffix:semicolon
r_goto
id|failed
suffix:semicolon
)brace
id|bacpy
c_func
(paren
op_amp
id|session-&gt;bdaddr
comma
op_amp
id|bt_sk
c_func
(paren
id|ctrl_sock-&gt;sk
)paren
op_member_access_from_pointer
id|dst
)paren
suffix:semicolon
id|session-&gt;ctrl_mtu
op_assign
id|min_t
c_func
(paren
id|uint
comma
id|l2cap_pi
c_func
(paren
id|ctrl_sock-&gt;sk
)paren
op_member_access_from_pointer
id|omtu
comma
id|l2cap_pi
c_func
(paren
id|ctrl_sock-&gt;sk
)paren
op_member_access_from_pointer
id|imtu
)paren
suffix:semicolon
id|session-&gt;intr_mtu
op_assign
id|min_t
c_func
(paren
id|uint
comma
id|l2cap_pi
c_func
(paren
id|intr_sock-&gt;sk
)paren
op_member_access_from_pointer
id|omtu
comma
id|l2cap_pi
c_func
(paren
id|intr_sock-&gt;sk
)paren
op_member_access_from_pointer
id|imtu
)paren
suffix:semicolon
id|BT_DBG
c_func
(paren
l_string|&quot;ctrl mtu %d intr mtu %d&quot;
comma
id|session-&gt;ctrl_mtu
comma
id|session-&gt;intr_mtu
)paren
suffix:semicolon
id|session-&gt;ctrl_sock
op_assign
id|ctrl_sock
suffix:semicolon
id|session-&gt;intr_sock
op_assign
id|intr_sock
suffix:semicolon
id|session-&gt;state
op_assign
id|BT_CONNECTED
suffix:semicolon
id|init_timer
c_func
(paren
op_amp
id|session-&gt;timer
)paren
suffix:semicolon
id|session-&gt;timer.function
op_assign
id|hidp_idle_timeout
suffix:semicolon
id|session-&gt;timer.data
op_assign
(paren
r_int
r_int
)paren
id|session
suffix:semicolon
id|skb_queue_head_init
c_func
(paren
op_amp
id|session-&gt;ctrl_transmit
)paren
suffix:semicolon
id|skb_queue_head_init
c_func
(paren
op_amp
id|session-&gt;intr_transmit
)paren
suffix:semicolon
id|session-&gt;flags
op_assign
id|req-&gt;flags
op_amp
(paren
l_int|1
op_lshift
id|HIDP_BLUETOOTH_VENDOR_ID
)paren
suffix:semicolon
id|session-&gt;idle_to
op_assign
id|req-&gt;idle_to
suffix:semicolon
r_if
c_cond
(paren
id|session-&gt;input
)paren
id|hidp_setup_input
c_func
(paren
id|session
comma
id|req
)paren
suffix:semicolon
id|__hidp_link_session
c_func
(paren
id|session
)paren
suffix:semicolon
id|hidp_set_timer
c_func
(paren
id|session
)paren
suffix:semicolon
id|err
op_assign
id|kernel_thread
c_func
(paren
id|hidp_session
comma
id|session
comma
id|CLONE_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
r_goto
id|unlink
suffix:semicolon
r_if
c_cond
(paren
id|session-&gt;input
)paren
(brace
id|hidp_send_ctrl_message
c_func
(paren
id|session
comma
id|HIDP_TRANS_SET_PROTOCOL
op_or
id|HIDP_PROTO_BOOT
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
id|session-&gt;flags
op_or_assign
(paren
l_int|1
op_lshift
id|HIDP_BOOT_PROTOCOL_MODE
)paren
suffix:semicolon
id|session-&gt;leds
op_assign
l_int|0xff
suffix:semicolon
id|hidp_input_event
c_func
(paren
id|session-&gt;input
comma
id|EV_LED
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
)brace
id|up_write
c_func
(paren
op_amp
id|hidp_session_sem
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|unlink
suffix:colon
id|hidp_del_timer
c_func
(paren
id|session
)paren
suffix:semicolon
id|__hidp_unlink_session
c_func
(paren
id|session
)paren
suffix:semicolon
r_if
c_cond
(paren
id|session-&gt;input
)paren
id|input_unregister_device
c_func
(paren
id|session-&gt;input
)paren
suffix:semicolon
id|failed
suffix:colon
id|up_write
c_func
(paren
op_amp
id|hidp_session_sem
)paren
suffix:semicolon
r_if
c_cond
(paren
id|session-&gt;input
)paren
id|kfree
c_func
(paren
id|session-&gt;input
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|session
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|hidp_del_connection
r_int
id|hidp_del_connection
c_func
(paren
r_struct
id|hidp_conndel_req
op_star
id|req
)paren
(brace
r_struct
id|hidp_session
op_star
id|session
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
id|BT_DBG
c_func
(paren
l_string|&quot;&quot;
)paren
suffix:semicolon
id|down_read
c_func
(paren
op_amp
id|hidp_session_sem
)paren
suffix:semicolon
id|session
op_assign
id|__hidp_get_session
c_func
(paren
op_amp
id|req-&gt;bdaddr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|session
)paren
(brace
r_if
c_cond
(paren
id|req-&gt;flags
op_amp
(paren
l_int|1
op_lshift
id|HIDP_VIRTUAL_CABLE_UNPLUG
)paren
)paren
(brace
id|hidp_send_ctrl_message
c_func
(paren
id|session
comma
id|HIDP_TRANS_HID_CONTROL
op_or
id|HIDP_CTRL_VIRTUAL_CABLE_UNPLUG
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* Flush the transmit queues */
id|skb_queue_purge
c_func
(paren
op_amp
id|session-&gt;ctrl_transmit
)paren
suffix:semicolon
id|skb_queue_purge
c_func
(paren
op_amp
id|session-&gt;intr_transmit
)paren
suffix:semicolon
multiline_comment|/* Kill session thread */
id|atomic_inc
c_func
(paren
op_amp
id|session-&gt;terminate
)paren
suffix:semicolon
id|hidp_schedule
c_func
(paren
id|session
)paren
suffix:semicolon
)brace
)brace
r_else
id|err
op_assign
op_minus
id|ENOENT
suffix:semicolon
id|up_read
c_func
(paren
op_amp
id|hidp_session_sem
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|hidp_get_connlist
r_int
id|hidp_get_connlist
c_func
(paren
r_struct
id|hidp_connlist_req
op_star
id|req
)paren
(brace
r_struct
id|list_head
op_star
id|p
suffix:semicolon
r_int
id|err
op_assign
l_int|0
comma
id|n
op_assign
l_int|0
suffix:semicolon
id|BT_DBG
c_func
(paren
l_string|&quot;&quot;
)paren
suffix:semicolon
id|down_read
c_func
(paren
op_amp
id|hidp_session_sem
)paren
suffix:semicolon
id|list_for_each
c_func
(paren
id|p
comma
op_amp
id|hidp_session_list
)paren
(brace
r_struct
id|hidp_session
op_star
id|session
suffix:semicolon
r_struct
id|hidp_conninfo
id|ci
suffix:semicolon
id|session
op_assign
id|list_entry
c_func
(paren
id|p
comma
r_struct
id|hidp_session
comma
id|list
)paren
suffix:semicolon
id|__hidp_copy_session
c_func
(paren
id|session
comma
op_amp
id|ci
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|req-&gt;ci
comma
op_amp
id|ci
comma
r_sizeof
(paren
id|ci
)paren
)paren
)paren
(brace
id|err
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
op_increment
id|n
op_ge
id|req-&gt;cnum
)paren
r_break
suffix:semicolon
id|req-&gt;ci
op_increment
suffix:semicolon
)brace
id|req-&gt;cnum
op_assign
id|n
suffix:semicolon
id|up_read
c_func
(paren
op_amp
id|hidp_session_sem
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|hidp_get_conninfo
r_int
id|hidp_get_conninfo
c_func
(paren
r_struct
id|hidp_conninfo
op_star
id|ci
)paren
(brace
r_struct
id|hidp_session
op_star
id|session
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
id|down_read
c_func
(paren
op_amp
id|hidp_session_sem
)paren
suffix:semicolon
id|session
op_assign
id|__hidp_get_session
c_func
(paren
op_amp
id|ci-&gt;bdaddr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|session
)paren
id|__hidp_copy_session
c_func
(paren
id|session
comma
id|ci
)paren
suffix:semicolon
r_else
id|err
op_assign
op_minus
id|ENOENT
suffix:semicolon
id|up_read
c_func
(paren
op_amp
id|hidp_session_sem
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|hidp_init
r_static
r_int
id|__init
id|hidp_init
c_func
(paren
r_void
)paren
(brace
id|l2cap_load
c_func
(paren
)paren
suffix:semicolon
id|BT_INFO
c_func
(paren
l_string|&quot;HIDP (Human Interface Emulation) ver %s&quot;
comma
id|VERSION
)paren
suffix:semicolon
r_return
id|hidp_init_sockets
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|hidp_exit
r_static
r_void
id|__exit
id|hidp_exit
c_func
(paren
r_void
)paren
(brace
id|hidp_cleanup_sockets
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|variable|hidp_init
id|module_init
c_func
(paren
id|hidp_init
)paren
suffix:semicolon
DECL|variable|hidp_exit
id|module_exit
c_func
(paren
id|hidp_exit
)paren
suffix:semicolon
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Marcel Holtmann &lt;marcel@holtmann.org&gt;&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;Bluetooth HIDP ver &quot;
id|VERSION
)paren
suffix:semicolon
DECL|variable|VERSION
id|MODULE_VERSION
c_func
(paren
id|VERSION
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
id|MODULE_ALIAS
c_func
(paren
l_string|&quot;bt-proto-6&quot;
)paren
suffix:semicolon
eof
