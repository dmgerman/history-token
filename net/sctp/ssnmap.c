multiline_comment|/* SCTP kernel reference Implementation&n; * Copyright (c) 2003 International Business Machines, Corp.&n; *&n; * This file is part of the SCTP kernel reference Implementation&n; *&n; * These functions manipulate sctp SSN tracker.&n; *&n; * The SCTP reference implementation is free software;&n; * you can redistribute it and/or modify it under the terms of&n; * the GNU General Public License as published by&n; * the Free Software Foundation; either version 2, or (at your option)&n; * any later version.&n; *&n; * The SCTP reference implementation is distributed in the hope that it&n; * will be useful, but WITHOUT ANY WARRANTY; without even the implied&n; *                 ************************&n; * warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.&n; * See the GNU General Public License for more details.&n; *&n; * You should have received a copy of the GNU General Public License&n; * along with GNU CC; see the file COPYING.  If not, write to&n; * the Free Software Foundation, 59 Temple Place - Suite 330,&n; * Boston, MA 02111-1307, USA.&n; *&n; * Please send any bug reports or fixes you make to the&n; * email address(es):&n; *    lksctp developers &lt;lksctp-developers@lists.sourceforge.net&gt;&n; *&n; * Or submit a bug report through the following website:&n; *    http://www.sf.net/projects/lksctp&n; *&n; * Written or modified by:&n; *    Jon Grimm             &lt;jgrimm@us.ibm.com&gt;&n; *&n; * Any bugs reported given to us we will try to fix... any fixes shared will&n; * be incorporated into the next SCTP release.&n; */
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;net/sctp/sctp.h&gt;
macro_line|#include &lt;net/sctp/sm.h&gt;
DECL|macro|MAX_KMALLOC_SIZE
mdefine_line|#define MAX_KMALLOC_SIZE&t;131072
r_static
r_struct
id|sctp_ssnmap
op_star
id|sctp_ssnmap_init
c_func
(paren
r_struct
id|sctp_ssnmap
op_star
id|map
comma
id|__u16
id|in
comma
id|__u16
id|out
)paren
suffix:semicolon
multiline_comment|/* Storage size needed for map includes 2 headers and then the&n; * specific needs of in or out streams.&n; */
DECL|function|sctp_ssnmap_size
r_static
r_inline
r_int
id|sctp_ssnmap_size
c_func
(paren
id|__u16
id|in
comma
id|__u16
id|out
)paren
(brace
r_return
r_sizeof
(paren
r_struct
id|sctp_ssnmap
)paren
op_plus
(paren
id|in
op_plus
id|out
)paren
op_star
r_sizeof
(paren
id|__u16
)paren
suffix:semicolon
)brace
multiline_comment|/* Create a new sctp_ssnmap.&n; * Allocate room to store at least &squot;len&squot; contiguous TSNs.&n; */
DECL|function|sctp_ssnmap_new
r_struct
id|sctp_ssnmap
op_star
id|sctp_ssnmap_new
c_func
(paren
id|__u16
id|in
comma
id|__u16
id|out
comma
r_int
id|gfp
)paren
(brace
r_struct
id|sctp_ssnmap
op_star
id|retval
suffix:semicolon
r_int
id|size
suffix:semicolon
id|size
op_assign
id|sctp_ssnmap_size
c_func
(paren
id|in
comma
id|out
)paren
suffix:semicolon
r_if
c_cond
(paren
id|size
op_le
id|MAX_KMALLOC_SIZE
)paren
id|retval
op_assign
id|kmalloc
c_func
(paren
id|size
comma
id|gfp
)paren
suffix:semicolon
r_else
id|retval
op_assign
(paren
r_struct
id|sctp_ssnmap
op_star
)paren
id|__get_free_pages
c_func
(paren
id|gfp
comma
id|get_order
c_func
(paren
id|size
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|retval
)paren
r_goto
id|fail
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sctp_ssnmap_init
c_func
(paren
id|retval
comma
id|in
comma
id|out
)paren
)paren
r_goto
id|fail_map
suffix:semicolon
id|retval-&gt;malloced
op_assign
l_int|1
suffix:semicolon
id|SCTP_DBG_OBJCNT_INC
c_func
(paren
id|ssnmap
)paren
suffix:semicolon
r_return
id|retval
suffix:semicolon
id|fail_map
suffix:colon
r_if
c_cond
(paren
id|size
op_le
id|MAX_KMALLOC_SIZE
)paren
id|kfree
c_func
(paren
id|retval
)paren
suffix:semicolon
r_else
id|free_pages
c_func
(paren
(paren
r_int
r_int
)paren
id|retval
comma
id|get_order
c_func
(paren
id|size
)paren
)paren
suffix:semicolon
id|fail
suffix:colon
r_return
l_int|NULL
suffix:semicolon
)brace
multiline_comment|/* Initialize a block of memory as a ssnmap.  */
DECL|function|sctp_ssnmap_init
r_static
r_struct
id|sctp_ssnmap
op_star
id|sctp_ssnmap_init
c_func
(paren
r_struct
id|sctp_ssnmap
op_star
id|map
comma
id|__u16
id|in
comma
id|__u16
id|out
)paren
(brace
id|memset
c_func
(paren
id|map
comma
l_int|0x00
comma
id|sctp_ssnmap_size
c_func
(paren
id|in
comma
id|out
)paren
)paren
suffix:semicolon
multiline_comment|/* Start &squot;in&squot; stream just after the map header. */
id|map-&gt;in.ssn
op_assign
(paren
id|__u16
op_star
)paren
op_amp
id|map
(braket
l_int|1
)braket
suffix:semicolon
id|map-&gt;in.len
op_assign
id|in
suffix:semicolon
multiline_comment|/* Start &squot;out&squot; stream just after &squot;in&squot;. */
id|map-&gt;out.ssn
op_assign
op_amp
id|map-&gt;in.ssn
(braket
id|in
)braket
suffix:semicolon
id|map-&gt;out.len
op_assign
id|out
suffix:semicolon
r_return
id|map
suffix:semicolon
)brace
multiline_comment|/* Clear out the ssnmap streams.  */
DECL|function|sctp_ssnmap_clear
r_void
id|sctp_ssnmap_clear
c_func
(paren
r_struct
id|sctp_ssnmap
op_star
id|map
)paren
(brace
r_int
id|size
suffix:semicolon
id|size
op_assign
(paren
id|map-&gt;in.len
op_plus
id|map-&gt;out.len
)paren
op_star
r_sizeof
(paren
id|__u16
)paren
suffix:semicolon
id|memset
c_func
(paren
id|map-&gt;in.ssn
comma
l_int|0x00
comma
id|size
)paren
suffix:semicolon
)brace
multiline_comment|/* Dispose of a ssnmap.  */
DECL|function|sctp_ssnmap_free
r_void
id|sctp_ssnmap_free
c_func
(paren
r_struct
id|sctp_ssnmap
op_star
id|map
)paren
(brace
r_if
c_cond
(paren
id|map
op_logical_and
id|map-&gt;malloced
)paren
(brace
r_int
id|size
suffix:semicolon
id|size
op_assign
id|sctp_ssnmap_size
c_func
(paren
id|map-&gt;in.len
comma
id|map-&gt;out.len
)paren
suffix:semicolon
r_if
c_cond
(paren
id|size
op_le
id|MAX_KMALLOC_SIZE
)paren
id|kfree
c_func
(paren
id|map
)paren
suffix:semicolon
r_else
id|free_pages
c_func
(paren
(paren
r_int
r_int
)paren
id|map
comma
id|get_order
c_func
(paren
id|size
)paren
)paren
suffix:semicolon
id|SCTP_DBG_OBJCNT_DEC
c_func
(paren
id|ssnmap
)paren
suffix:semicolon
)brace
)brace
eof
