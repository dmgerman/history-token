multiline_comment|/* SCTP reference Implementation Copyright (C) 1999 Cisco And Motorola&n; * &n; * This file origiantes from Randy Stewart&squot;s SCTP reference Implementation.&n; * &n; * The SCTP reference implementation is free software; &n; * you can redistribute it and/or modify it under the terms of &n; * the GNU General Public License as published by&n; * the Free Software Foundation; either version 2, or (at your option)&n; * any later version.&n; * &n; * The SCTP reference implementation is distributed in the hope that it &n; * will be useful, but WITHOUT ANY WARRANTY; without even the implied&n; *                 ************************&n; * warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.&n; * See the GNU General Public License for more details.&n; * &n; * You should have received a copy of the GNU General Public License&n; * along with GNU CC; see the file COPYING.  If not, write to&n; * the Free Software Foundation, 59 Temple Place - Suite 330,&n; * Boston, MA 02111-1307, USA.  &n; * &n; * Please send any bug reports or fixes you make to the&n; * email address(es):&n; *    lksctp developers &lt;lksctp-developers@lists.sourceforge.net&gt;&n; * &n; * Or submit a bug report through the following website:&n; *    http://www.sf.net/projects/lksctp&n; *&n; * Written or modified by: &n; *    Randy Stewart  rstewar1@email.mot.com&n; *    Ken Morneau    kmorneau@cisco.com&n; *    Qiaobing Xie   qxie1@email.mot.com&n; * &n; * Any bugs reported given to us we will try to fix... any fixes shared will&n; * be incorperated into the next SCTP release.&n; * &n; * There are still LOTS of bugs in this code... I always run on the motto&n; * &quot;it is a wonder any code ever works :)&quot;&n; */
DECL|variable|cvs_id
r_static
r_char
op_star
id|cvs_id
id|__attribute__
(paren
(paren
id|unused
)paren
)paren
op_assign
l_string|&quot;$Id: sctp_hashdriver.c,v 1.2 2002/07/19 22:00:33 jgrimm Exp $&quot;
suffix:semicolon
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;asm/string.h&gt;
macro_line|#include &lt;net/sctp/sctp.h&gt;
macro_line|#include &lt;net/sctp/sctp_sla1.h&gt;
multiline_comment|/* SCTP Main driver.&n;   passing a two pointers and two lengths,&n;   returning a digest pointer filled. The md5 code&n;   was taken directly from the RFC (2104) so to understand it&n;   you may want to go look at the RFC referenced in the&n;   SCTP spec. We did modify this code to either user OUR&n;   implementation of SLA1 or the MD5 that comes from its&n;   RFC. SLA1 may have IPR issues so you need to check in&n;   to this if you wish to use it... Or at least that is&n;   what the FIP-180.1 web page says.&n; */
r_void
DECL|function|sctp_hash_digest
id|sctp_hash_digest
c_func
(paren
r_const
r_char
op_star
id|key
comma
r_const
r_int
id|in_key_len
comma
r_const
r_char
op_star
id|text
comma
r_const
r_int
id|text_len
comma
r_uint8
op_star
id|digest
)paren
(brace
r_int
id|key_len
op_assign
id|in_key_len
suffix:semicolon
r_int
r_int
op_star
id|p
suffix:semicolon
r_struct
id|SLA_1_Context
id|context
suffix:semicolon
r_uint8
id|k_ipad
(braket
l_int|65
)braket
suffix:semicolon
multiline_comment|/* inner padding -&n;&t;&t;&t;&t;* key XORd with ipad&n;&t;&t;&t;&t;*/
r_uint8
id|k_opad
(braket
l_int|65
)braket
suffix:semicolon
multiline_comment|/* outer padding -&n;&t;&t;&t;&t;* key XORd with opad&n;&t;&t;&t;&t;*/
r_uint8
id|tk
(braket
l_int|20
)braket
suffix:semicolon
r_int
id|i
suffix:semicolon
multiline_comment|/* if key is longer than 64 bytes reset it to key=MD5(key) */
r_if
c_cond
(paren
id|key_len
OG
l_int|64
)paren
(brace
r_struct
id|SLA_1_Context
id|tctx
suffix:semicolon
id|SLA1_Init
c_func
(paren
op_amp
id|tctx
)paren
suffix:semicolon
id|SLA1_Process
c_func
(paren
op_amp
id|tctx
comma
id|key
comma
id|key_len
)paren
suffix:semicolon
id|SLA1_Final
c_func
(paren
op_amp
id|tctx
comma
id|tk
)paren
suffix:semicolon
id|key
op_assign
id|tk
suffix:semicolon
id|key_len
op_assign
l_int|20
suffix:semicolon
)brace
multiline_comment|/*&n;         * the HMAC_MD5 transform looks like:&n;         *&n;         * MD5(K XOR opad, MD5(K XOR ipad, text))&n;         *&n;         * where K is an n byte key&n;         * ipad is the byte 0x36 repeated 64 times&n;         * opad is the byte 0x5c repeated 64 times&n;         * and text is the data being protected&n;         */
multiline_comment|/* start out by storing key in pads */
id|memset
c_func
(paren
id|k_ipad
comma
l_int|0
comma
r_sizeof
id|k_ipad
)paren
suffix:semicolon
id|memset
c_func
(paren
id|k_opad
comma
l_int|0
comma
r_sizeof
id|k_opad
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|k_ipad
comma
id|key
comma
id|key_len
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|k_opad
comma
id|key
comma
id|key_len
)paren
suffix:semicolon
multiline_comment|/* XOR key with ipad and opad values */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|64
suffix:semicolon
id|i
op_increment
)paren
(brace
id|k_ipad
(braket
id|i
)braket
op_xor_assign
l_int|0x36
suffix:semicolon
id|k_opad
(braket
id|i
)braket
op_xor_assign
l_int|0x5c
suffix:semicolon
)brace
multiline_comment|/*&n;         * perform inner hash&n;         */
id|SLA1_Init
c_func
(paren
op_amp
id|context
)paren
suffix:semicolon
multiline_comment|/* init context for 1st&n;                                                  * pass &n;                                                  */
id|SLA1_Process
c_func
(paren
op_amp
id|context
comma
id|k_ipad
comma
l_int|64
)paren
suffix:semicolon
multiline_comment|/* start with inner pad */
id|SLA1_Process
c_func
(paren
op_amp
id|context
comma
id|text
comma
id|text_len
)paren
suffix:semicolon
multiline_comment|/* then text of datagram */
id|SLA1_Final
c_func
(paren
op_amp
id|context
comma
id|digest
)paren
suffix:semicolon
multiline_comment|/* finish up 1st pass */
multiline_comment|/*&n;         * perform outer hash&n;         */
id|SLA1_Init
c_func
(paren
op_amp
id|context
)paren
suffix:semicolon
multiline_comment|/* init context for 2nd&n;                                                * pass &n;                                                */
id|SLA1_Process
c_func
(paren
op_amp
id|context
comma
id|k_opad
comma
l_int|64
)paren
suffix:semicolon
multiline_comment|/* start with outer pad */
id|SLA1_Process
c_func
(paren
op_amp
id|context
comma
id|digest
comma
l_int|20
)paren
suffix:semicolon
multiline_comment|/* then results of 1st&n;                                                 * hash &n;                                                 */
id|SLA1_Final
c_func
(paren
op_amp
id|context
comma
id|digest
)paren
suffix:semicolon
multiline_comment|/* finish up 2nd pass */
id|p
op_assign
(paren
r_int
r_int
op_star
)paren
id|digest
suffix:semicolon
)brace
eof
