multiline_comment|/* SCTP kernel reference Implementation&n; * (C) Copyright IBM Corp. 2001, 2004&n; * Copyright (c) 1999-2000 Cisco, Inc.&n; * Copyright (c) 1999-2001 Motorola, Inc.&n; * Copyright (c) 2001 Intel Corp.&n; * Copyright (c) 2001 Nokia, Inc.&n; * Copyright (c) 2001 La Monte H.P. Yarroll&n; *&n; * This file is part of the SCTP kernel reference Implementation&n; *&n; * Initialization/cleanup for SCTP protocol support.&n; *&n; * The SCTP reference implementation is free software;&n; * you can redistribute it and/or modify it under the terms of&n; * the GNU General Public License as published by&n; * the Free Software Foundation; either version 2, or (at your option)&n; * any later version.&n; *&n; * The SCTP reference implementation is distributed in the hope that it&n; * will be useful, but WITHOUT ANY WARRANTY; without even the implied&n; *                 ************************&n; * warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.&n; * See the GNU General Public License for more details.&n; *&n; * You should have received a copy of the GNU General Public License&n; * along with GNU CC; see the file COPYING.  If not, write to&n; * the Free Software Foundation, 59 Temple Place - Suite 330,&n; * Boston, MA 02111-1307, USA.&n; *&n; * Please send any bug reports or fixes you make to the&n; * email address(es):&n; *    lksctp developers &lt;lksctp-developers@lists.sourceforge.net&gt;&n; *&n; * Or submit a bug report through the following website:&n; *    http://www.sf.net/projects/lksctp&n; *&n; * Written or modified by:&n; *    La Monte H.P. Yarroll &lt;piggy@acm.org&gt;&n; *    Karl Knutson &lt;karl@athena.chicago.il.us&gt;&n; *    Jon Grimm &lt;jgrimm@us.ibm.com&gt;&n; *    Sridhar Samudrala &lt;sri@us.ibm.com&gt;&n; *    Daisy Chang &lt;daisyc@us.ibm.com&gt;&n; *    Ardelle Fan &lt;ardelle.fan@intel.com&gt;&n; *&n; * Any bugs reported given to us we will try to fix... any fixes shared will&n; * be incorporated into the next SCTP release.&n; */
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/netdevice.h&gt;
macro_line|#include &lt;linux/inetdevice.h&gt;
macro_line|#include &lt;linux/seq_file.h&gt;
macro_line|#include &lt;net/protocol.h&gt;
macro_line|#include &lt;net/ip.h&gt;
macro_line|#include &lt;net/ipv6.h&gt;
macro_line|#include &lt;net/sctp/sctp.h&gt;
macro_line|#include &lt;net/addrconf.h&gt;
macro_line|#include &lt;net/inet_common.h&gt;
macro_line|#include &lt;net/inet_ecn.h&gt;
multiline_comment|/* Global data structures. */
DECL|variable|sctp_globals
r_struct
id|sctp_globals
id|sctp_globals
suffix:semicolon
DECL|variable|proc_net_sctp
r_struct
id|proc_dir_entry
op_star
id|proc_net_sctp
suffix:semicolon
id|DEFINE_SNMP_STAT
c_func
(paren
r_struct
id|sctp_mib
comma
id|sctp_statistics
)paren
suffix:semicolon
DECL|variable|sctp_assocs_id
r_struct
id|idr
id|sctp_assocs_id
suffix:semicolon
DECL|variable|sctp_assocs_id_lock
id|spinlock_t
id|sctp_assocs_id_lock
op_assign
id|SPIN_LOCK_UNLOCKED
suffix:semicolon
multiline_comment|/* This is the global socket data structure used for responding to&n; * the Out-of-the-blue (OOTB) packets.  A control sock will be created&n; * for this socket at the initialization time.&n; */
DECL|variable|sctp_ctl_socket
r_static
r_struct
id|socket
op_star
id|sctp_ctl_socket
suffix:semicolon
DECL|variable|sctp_pf_inet6_specific
r_static
r_struct
id|sctp_pf
op_star
id|sctp_pf_inet6_specific
suffix:semicolon
DECL|variable|sctp_pf_inet_specific
r_static
r_struct
id|sctp_pf
op_star
id|sctp_pf_inet_specific
suffix:semicolon
DECL|variable|sctp_af_v4_specific
r_static
r_struct
id|sctp_af
op_star
id|sctp_af_v4_specific
suffix:semicolon
DECL|variable|sctp_af_v6_specific
r_static
r_struct
id|sctp_af
op_star
id|sctp_af_v6_specific
suffix:semicolon
DECL|variable|sctp_chunk_cachep
id|kmem_cache_t
op_star
id|sctp_chunk_cachep
suffix:semicolon
DECL|variable|sctp_bucket_cachep
id|kmem_cache_t
op_star
id|sctp_bucket_cachep
suffix:semicolon
r_extern
r_int
id|sctp_snmp_proc_init
c_func
(paren
r_void
)paren
suffix:semicolon
r_extern
r_int
id|sctp_snmp_proc_exit
c_func
(paren
r_void
)paren
suffix:semicolon
r_extern
r_int
id|sctp_eps_proc_init
c_func
(paren
r_void
)paren
suffix:semicolon
r_extern
r_int
id|sctp_eps_proc_exit
c_func
(paren
r_void
)paren
suffix:semicolon
r_extern
r_int
id|sctp_assocs_proc_init
c_func
(paren
r_void
)paren
suffix:semicolon
r_extern
r_int
id|sctp_assocs_proc_exit
c_func
(paren
r_void
)paren
suffix:semicolon
multiline_comment|/* Return the address of the control sock. */
DECL|function|sctp_get_ctl_sock
r_struct
id|sock
op_star
id|sctp_get_ctl_sock
c_func
(paren
r_void
)paren
(brace
r_return
id|sctp_ctl_socket-&gt;sk
suffix:semicolon
)brace
multiline_comment|/* Set up the proc fs entry for the SCTP protocol. */
DECL|function|sctp_proc_init
id|__init
r_int
id|sctp_proc_init
c_func
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|proc_net_sctp
)paren
(brace
r_struct
id|proc_dir_entry
op_star
id|ent
suffix:semicolon
id|ent
op_assign
id|proc_mkdir
c_func
(paren
l_string|&quot;net/sctp&quot;
comma
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ent
)paren
(brace
id|ent-&gt;owner
op_assign
id|THIS_MODULE
suffix:semicolon
id|proc_net_sctp
op_assign
id|ent
suffix:semicolon
)brace
r_else
r_goto
id|out_nomem
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sctp_snmp_proc_init
c_func
(paren
)paren
)paren
r_goto
id|out_nomem
suffix:semicolon
r_if
c_cond
(paren
id|sctp_eps_proc_init
c_func
(paren
)paren
)paren
r_goto
id|out_nomem
suffix:semicolon
r_if
c_cond
(paren
id|sctp_assocs_proc_init
c_func
(paren
)paren
)paren
r_goto
id|out_nomem
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|out_nomem
suffix:colon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
multiline_comment|/* Clean up the proc fs entry for the SCTP protocol. &n; * Note: Do not make this __exit as it is used in the init error&n; * path.&n; */
DECL|function|sctp_proc_exit
r_void
id|sctp_proc_exit
c_func
(paren
r_void
)paren
(brace
id|sctp_snmp_proc_exit
c_func
(paren
)paren
suffix:semicolon
id|sctp_eps_proc_exit
c_func
(paren
)paren
suffix:semicolon
id|sctp_assocs_proc_exit
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|proc_net_sctp
)paren
(brace
id|proc_net_sctp
op_assign
l_int|NULL
suffix:semicolon
id|remove_proc_entry
c_func
(paren
l_string|&quot;net/sctp&quot;
comma
l_int|NULL
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* Private helper to extract ipv4 address and stash them in&n; * the protocol structure.&n; */
DECL|function|sctp_v4_copy_addrlist
r_static
r_void
id|sctp_v4_copy_addrlist
c_func
(paren
r_struct
id|list_head
op_star
id|addrlist
comma
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|in_device
op_star
id|in_dev
suffix:semicolon
r_struct
id|in_ifaddr
op_star
id|ifa
suffix:semicolon
r_struct
id|sctp_sockaddr_entry
op_star
id|addr
suffix:semicolon
id|rcu_read_lock
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|in_dev
op_assign
id|__in_dev_get
c_func
(paren
id|dev
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
id|rcu_read_unlock
c_func
(paren
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_for
c_loop
(paren
id|ifa
op_assign
id|in_dev-&gt;ifa_list
suffix:semicolon
id|ifa
suffix:semicolon
id|ifa
op_assign
id|ifa-&gt;ifa_next
)paren
(brace
multiline_comment|/* Add the address to the local list.  */
id|addr
op_assign
id|t_new
c_func
(paren
r_struct
id|sctp_sockaddr_entry
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|addr
)paren
(brace
id|addr-&gt;a.v4.sin_family
op_assign
id|AF_INET
suffix:semicolon
id|addr-&gt;a.v4.sin_port
op_assign
l_int|0
suffix:semicolon
id|addr-&gt;a.v4.sin_addr.s_addr
op_assign
id|ifa-&gt;ifa_local
suffix:semicolon
id|list_add_tail
c_func
(paren
op_amp
id|addr-&gt;list
comma
id|addrlist
)paren
suffix:semicolon
)brace
)brace
id|rcu_read_unlock
c_func
(paren
)paren
suffix:semicolon
)brace
multiline_comment|/* Extract our IP addresses from the system and stash them in the&n; * protocol structure.&n; */
DECL|function|__sctp_get_local_addr_list
r_static
r_void
id|__sctp_get_local_addr_list
c_func
(paren
r_void
)paren
(brace
r_struct
id|net_device
op_star
id|dev
suffix:semicolon
r_struct
id|list_head
op_star
id|pos
suffix:semicolon
r_struct
id|sctp_af
op_star
id|af
suffix:semicolon
id|read_lock
c_func
(paren
op_amp
id|dev_base_lock
)paren
suffix:semicolon
r_for
c_loop
(paren
id|dev
op_assign
id|dev_base
suffix:semicolon
id|dev
suffix:semicolon
id|dev
op_assign
id|dev-&gt;next
)paren
(brace
id|__list_for_each
c_func
(paren
id|pos
comma
op_amp
id|sctp_address_families
)paren
(brace
id|af
op_assign
id|list_entry
c_func
(paren
id|pos
comma
r_struct
id|sctp_af
comma
id|list
)paren
suffix:semicolon
id|af
op_member_access_from_pointer
id|copy_addrlist
c_func
(paren
op_amp
id|sctp_local_addr_list
comma
id|dev
)paren
suffix:semicolon
)brace
)brace
id|read_unlock
c_func
(paren
op_amp
id|dev_base_lock
)paren
suffix:semicolon
)brace
DECL|function|sctp_get_local_addr_list
r_static
r_void
id|sctp_get_local_addr_list
c_func
(paren
r_void
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|sctp_spin_lock_irqsave
c_func
(paren
op_amp
id|sctp_local_addr_lock
comma
id|flags
)paren
suffix:semicolon
id|__sctp_get_local_addr_list
c_func
(paren
)paren
suffix:semicolon
id|sctp_spin_unlock_irqrestore
c_func
(paren
op_amp
id|sctp_local_addr_lock
comma
id|flags
)paren
suffix:semicolon
)brace
multiline_comment|/* Free the existing local addresses.  */
DECL|function|__sctp_free_local_addr_list
r_static
r_void
id|__sctp_free_local_addr_list
c_func
(paren
r_void
)paren
(brace
r_struct
id|sctp_sockaddr_entry
op_star
id|addr
suffix:semicolon
r_struct
id|list_head
op_star
id|pos
comma
op_star
id|temp
suffix:semicolon
id|list_for_each_safe
c_func
(paren
id|pos
comma
id|temp
comma
op_amp
id|sctp_local_addr_list
)paren
(brace
id|addr
op_assign
id|list_entry
c_func
(paren
id|pos
comma
r_struct
id|sctp_sockaddr_entry
comma
id|list
)paren
suffix:semicolon
id|list_del
c_func
(paren
id|pos
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|addr
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* Free the existing local addresses.  */
DECL|function|sctp_free_local_addr_list
r_static
r_void
id|sctp_free_local_addr_list
c_func
(paren
r_void
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|sctp_spin_lock_irqsave
c_func
(paren
op_amp
id|sctp_local_addr_lock
comma
id|flags
)paren
suffix:semicolon
id|__sctp_free_local_addr_list
c_func
(paren
)paren
suffix:semicolon
id|sctp_spin_unlock_irqrestore
c_func
(paren
op_amp
id|sctp_local_addr_lock
comma
id|flags
)paren
suffix:semicolon
)brace
multiline_comment|/* Copy the local addresses which are valid for &squot;scope&squot; into &squot;bp&squot;.  */
DECL|function|sctp_copy_local_addr_list
r_int
id|sctp_copy_local_addr_list
c_func
(paren
r_struct
id|sctp_bind_addr
op_star
id|bp
comma
id|sctp_scope_t
id|scope
comma
r_int
id|gfp
comma
r_int
id|copy_flags
)paren
(brace
r_struct
id|sctp_sockaddr_entry
op_star
id|addr
suffix:semicolon
r_int
id|error
op_assign
l_int|0
suffix:semicolon
r_struct
id|list_head
op_star
id|pos
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|sctp_spin_lock_irqsave
c_func
(paren
op_amp
id|sctp_local_addr_lock
comma
id|flags
)paren
suffix:semicolon
id|list_for_each
c_func
(paren
id|pos
comma
op_amp
id|sctp_local_addr_list
)paren
(brace
id|addr
op_assign
id|list_entry
c_func
(paren
id|pos
comma
r_struct
id|sctp_sockaddr_entry
comma
id|list
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sctp_in_scope
c_func
(paren
op_amp
id|addr-&gt;a
comma
id|scope
)paren
)paren
(brace
multiline_comment|/* Now that the address is in scope, check to see if&n;&t;&t;&t; * the address type is really supported by the local&n;&t;&t;&t; * sock as well as the remote peer.&n;&t;&t;&t; */
r_if
c_cond
(paren
(paren
(paren
(paren
id|AF_INET
op_eq
id|addr-&gt;a.sa.sa_family
)paren
op_logical_and
(paren
id|copy_flags
op_amp
id|SCTP_ADDR4_PEERSUPP
)paren
)paren
)paren
op_logical_or
(paren
(paren
(paren
id|AF_INET6
op_eq
id|addr-&gt;a.sa.sa_family
)paren
op_logical_and
(paren
id|copy_flags
op_amp
id|SCTP_ADDR6_ALLOWED
)paren
op_logical_and
(paren
id|copy_flags
op_amp
id|SCTP_ADDR6_PEERSUPP
)paren
)paren
)paren
)paren
(brace
id|error
op_assign
id|sctp_add_bind_addr
c_func
(paren
id|bp
comma
op_amp
id|addr-&gt;a
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
r_goto
id|end_copy
suffix:semicolon
)brace
)brace
)brace
id|end_copy
suffix:colon
id|sctp_spin_unlock_irqrestore
c_func
(paren
op_amp
id|sctp_local_addr_lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|error
suffix:semicolon
)brace
multiline_comment|/* Initialize a sctp_addr from in incoming skb.  */
DECL|function|sctp_v4_from_skb
r_static
r_void
id|sctp_v4_from_skb
c_func
(paren
r_union
id|sctp_addr
op_star
id|addr
comma
r_struct
id|sk_buff
op_star
id|skb
comma
r_int
id|is_saddr
)paren
(brace
r_void
op_star
id|from
suffix:semicolon
id|__u16
op_star
id|port
suffix:semicolon
r_struct
id|sctphdr
op_star
id|sh
suffix:semicolon
id|port
op_assign
op_amp
id|addr-&gt;v4.sin_port
suffix:semicolon
id|addr-&gt;v4.sin_family
op_assign
id|AF_INET
suffix:semicolon
id|sh
op_assign
(paren
r_struct
id|sctphdr
op_star
)paren
id|skb-&gt;h.raw
suffix:semicolon
r_if
c_cond
(paren
id|is_saddr
)paren
(brace
op_star
id|port
op_assign
id|ntohs
c_func
(paren
id|sh-&gt;source
)paren
suffix:semicolon
id|from
op_assign
op_amp
id|skb-&gt;nh.iph-&gt;saddr
suffix:semicolon
)brace
r_else
(brace
op_star
id|port
op_assign
id|ntohs
c_func
(paren
id|sh-&gt;dest
)paren
suffix:semicolon
id|from
op_assign
op_amp
id|skb-&gt;nh.iph-&gt;daddr
suffix:semicolon
)brace
id|memcpy
c_func
(paren
op_amp
id|addr-&gt;v4.sin_addr.s_addr
comma
id|from
comma
r_sizeof
(paren
r_struct
id|in_addr
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/* Initialize an sctp_addr from a socket. */
DECL|function|sctp_v4_from_sk
r_static
r_void
id|sctp_v4_from_sk
c_func
(paren
r_union
id|sctp_addr
op_star
id|addr
comma
r_struct
id|sock
op_star
id|sk
)paren
(brace
id|addr-&gt;v4.sin_family
op_assign
id|AF_INET
suffix:semicolon
id|addr-&gt;v4.sin_port
op_assign
id|inet_sk
c_func
(paren
id|sk
)paren
op_member_access_from_pointer
id|num
suffix:semicolon
id|addr-&gt;v4.sin_addr.s_addr
op_assign
id|inet_sk
c_func
(paren
id|sk
)paren
op_member_access_from_pointer
id|rcv_saddr
suffix:semicolon
)brace
multiline_comment|/* Initialize sk-&gt;sk_rcv_saddr from sctp_addr. */
DECL|function|sctp_v4_to_sk_saddr
r_static
r_void
id|sctp_v4_to_sk_saddr
c_func
(paren
r_union
id|sctp_addr
op_star
id|addr
comma
r_struct
id|sock
op_star
id|sk
)paren
(brace
id|inet_sk
c_func
(paren
id|sk
)paren
op_member_access_from_pointer
id|rcv_saddr
op_assign
id|addr-&gt;v4.sin_addr.s_addr
suffix:semicolon
)brace
multiline_comment|/* Initialize sk-&gt;sk_daddr from sctp_addr. */
DECL|function|sctp_v4_to_sk_daddr
r_static
r_void
id|sctp_v4_to_sk_daddr
c_func
(paren
r_union
id|sctp_addr
op_star
id|addr
comma
r_struct
id|sock
op_star
id|sk
)paren
(brace
id|inet_sk
c_func
(paren
id|sk
)paren
op_member_access_from_pointer
id|daddr
op_assign
id|addr-&gt;v4.sin_addr.s_addr
suffix:semicolon
)brace
multiline_comment|/* Initialize a sctp_addr from an address parameter. */
DECL|function|sctp_v4_from_addr_param
r_static
r_void
id|sctp_v4_from_addr_param
c_func
(paren
r_union
id|sctp_addr
op_star
id|addr
comma
r_union
id|sctp_addr_param
op_star
id|param
comma
id|__u16
id|port
comma
r_int
id|iif
)paren
(brace
id|addr-&gt;v4.sin_family
op_assign
id|AF_INET
suffix:semicolon
id|addr-&gt;v4.sin_port
op_assign
id|port
suffix:semicolon
id|addr-&gt;v4.sin_addr.s_addr
op_assign
id|param-&gt;v4.addr.s_addr
suffix:semicolon
)brace
multiline_comment|/* Initialize an address parameter from a sctp_addr and return the length&n; * of the address parameter.&n; */
DECL|function|sctp_v4_to_addr_param
r_static
r_int
id|sctp_v4_to_addr_param
c_func
(paren
r_const
r_union
id|sctp_addr
op_star
id|addr
comma
r_union
id|sctp_addr_param
op_star
id|param
)paren
(brace
r_int
id|length
op_assign
r_sizeof
(paren
id|sctp_ipv4addr_param_t
)paren
suffix:semicolon
id|param-&gt;v4.param_hdr.type
op_assign
id|SCTP_PARAM_IPV4_ADDRESS
suffix:semicolon
id|param-&gt;v4.param_hdr.length
op_assign
id|ntohs
c_func
(paren
id|length
)paren
suffix:semicolon
id|param-&gt;v4.addr.s_addr
op_assign
id|addr-&gt;v4.sin_addr.s_addr
suffix:semicolon
r_return
id|length
suffix:semicolon
)brace
multiline_comment|/* Initialize a sctp_addr from a dst_entry. */
DECL|function|sctp_v4_dst_saddr
r_static
r_void
id|sctp_v4_dst_saddr
c_func
(paren
r_union
id|sctp_addr
op_star
id|saddr
comma
r_struct
id|dst_entry
op_star
id|dst
comma
r_int
r_int
id|port
)paren
(brace
r_struct
id|rtable
op_star
id|rt
op_assign
(paren
r_struct
id|rtable
op_star
)paren
id|dst
suffix:semicolon
id|saddr-&gt;v4.sin_family
op_assign
id|AF_INET
suffix:semicolon
id|saddr-&gt;v4.sin_port
op_assign
id|port
suffix:semicolon
id|saddr-&gt;v4.sin_addr.s_addr
op_assign
id|rt-&gt;rt_src
suffix:semicolon
)brace
multiline_comment|/* Compare two addresses exactly. */
DECL|function|sctp_v4_cmp_addr
r_static
r_int
id|sctp_v4_cmp_addr
c_func
(paren
r_const
r_union
id|sctp_addr
op_star
id|addr1
comma
r_const
r_union
id|sctp_addr
op_star
id|addr2
)paren
(brace
r_if
c_cond
(paren
id|addr1-&gt;sa.sa_family
op_ne
id|addr2-&gt;sa.sa_family
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|addr1-&gt;v4.sin_port
op_ne
id|addr2-&gt;v4.sin_port
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|addr1-&gt;v4.sin_addr.s_addr
op_ne
id|addr2-&gt;v4.sin_addr.s_addr
)paren
r_return
l_int|0
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
multiline_comment|/* Initialize addr struct to INADDR_ANY. */
DECL|function|sctp_v4_inaddr_any
r_static
r_void
id|sctp_v4_inaddr_any
c_func
(paren
r_union
id|sctp_addr
op_star
id|addr
comma
r_int
r_int
id|port
)paren
(brace
id|addr-&gt;v4.sin_family
op_assign
id|AF_INET
suffix:semicolon
id|addr-&gt;v4.sin_addr.s_addr
op_assign
id|INADDR_ANY
suffix:semicolon
id|addr-&gt;v4.sin_port
op_assign
id|port
suffix:semicolon
)brace
multiline_comment|/* Is this a wildcard address? */
DECL|function|sctp_v4_is_any
r_static
r_int
id|sctp_v4_is_any
c_func
(paren
r_const
r_union
id|sctp_addr
op_star
id|addr
)paren
(brace
r_return
id|INADDR_ANY
op_eq
id|addr-&gt;v4.sin_addr.s_addr
suffix:semicolon
)brace
multiline_comment|/* This function checks if the address is a valid address to be used for&n; * SCTP binding.&n; *&n; * Output:&n; * Return 0 - If the address is a non-unicast or an illegal address.&n; * Return 1 - If the address is a unicast.&n; */
DECL|function|sctp_v4_addr_valid
r_static
r_int
id|sctp_v4_addr_valid
c_func
(paren
r_union
id|sctp_addr
op_star
id|addr
comma
r_struct
id|sctp_opt
op_star
id|sp
)paren
(brace
multiline_comment|/* Is this a non-unicast address or a unusable SCTP address? */
r_if
c_cond
(paren
id|IS_IPV4_UNUSABLE_ADDRESS
c_func
(paren
op_amp
id|addr-&gt;v4.sin_addr.s_addr
)paren
)paren
r_return
l_int|0
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
multiline_comment|/* Should this be available for binding?   */
DECL|function|sctp_v4_available
r_static
r_int
id|sctp_v4_available
c_func
(paren
r_union
id|sctp_addr
op_star
id|addr
comma
r_struct
id|sctp_opt
op_star
id|sp
)paren
(brace
r_int
id|ret
op_assign
id|inet_addr_type
c_func
(paren
id|addr-&gt;v4.sin_addr.s_addr
)paren
suffix:semicolon
multiline_comment|/* FIXME: ip_nonlocal_bind sysctl support. */
r_if
c_cond
(paren
id|addr-&gt;v4.sin_addr.s_addr
op_ne
id|INADDR_ANY
op_logical_and
id|ret
op_ne
id|RTN_LOCAL
)paren
r_return
l_int|0
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
multiline_comment|/* Checking the loopback, private and other address scopes as defined in&n; * RFC 1918.   The IPv4 scoping is based on the draft for SCTP IPv4&n; * scoping &lt;draft-stewart-tsvwg-sctp-ipv4-00.txt&gt;.&n; *&n; * Level 0 - unusable SCTP addresses&n; * Level 1 - loopback address&n; * Level 2 - link-local addresses&n; * Level 3 - private addresses.&n; * Level 4 - global addresses&n; * For INIT and INIT-ACK address list, let L be the level of&n; * of requested destination address, sender and receiver&n; * SHOULD include all of its addresses with level greater&n; * than or equal to L.&n; */
DECL|function|sctp_v4_scope
r_static
id|sctp_scope_t
id|sctp_v4_scope
c_func
(paren
r_union
id|sctp_addr
op_star
id|addr
)paren
(brace
id|sctp_scope_t
id|retval
suffix:semicolon
multiline_comment|/* Should IPv4 scoping be a sysctl configurable option&n;&t; * so users can turn it off (default on) for certain&n;&t; * unconventional networking environments?&n;&t; */
multiline_comment|/* Check for unusable SCTP addresses. */
r_if
c_cond
(paren
id|IS_IPV4_UNUSABLE_ADDRESS
c_func
(paren
op_amp
id|addr-&gt;v4.sin_addr.s_addr
)paren
)paren
(brace
id|retval
op_assign
id|SCTP_SCOPE_UNUSABLE
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|LOOPBACK
c_func
(paren
id|addr-&gt;v4.sin_addr.s_addr
)paren
)paren
(brace
id|retval
op_assign
id|SCTP_SCOPE_LOOPBACK
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|IS_IPV4_LINK_ADDRESS
c_func
(paren
op_amp
id|addr-&gt;v4.sin_addr.s_addr
)paren
)paren
(brace
id|retval
op_assign
id|SCTP_SCOPE_LINK
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|IS_IPV4_PRIVATE_ADDRESS
c_func
(paren
op_amp
id|addr-&gt;v4.sin_addr.s_addr
)paren
)paren
(brace
id|retval
op_assign
id|SCTP_SCOPE_PRIVATE
suffix:semicolon
)brace
r_else
(brace
id|retval
op_assign
id|SCTP_SCOPE_GLOBAL
suffix:semicolon
)brace
r_return
id|retval
suffix:semicolon
)brace
multiline_comment|/* Returns a valid dst cache entry for the given source and destination ip&n; * addresses. If an association is passed, trys to get a dst entry with a&n; * source address that matches an address in the bind address list.&n; */
DECL|function|sctp_v4_get_dst
r_struct
id|dst_entry
op_star
id|sctp_v4_get_dst
c_func
(paren
r_struct
id|sctp_association
op_star
id|asoc
comma
r_union
id|sctp_addr
op_star
id|daddr
comma
r_union
id|sctp_addr
op_star
id|saddr
)paren
(brace
r_struct
id|rtable
op_star
id|rt
suffix:semicolon
r_struct
id|flowi
id|fl
suffix:semicolon
r_struct
id|sctp_bind_addr
op_star
id|bp
suffix:semicolon
id|rwlock_t
op_star
id|addr_lock
suffix:semicolon
r_struct
id|sctp_sockaddr_entry
op_star
id|laddr
suffix:semicolon
r_struct
id|list_head
op_star
id|pos
suffix:semicolon
r_struct
id|dst_entry
op_star
id|dst
op_assign
l_int|NULL
suffix:semicolon
r_union
id|sctp_addr
id|dst_saddr
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|fl
comma
l_int|0x0
comma
r_sizeof
(paren
r_struct
id|flowi
)paren
)paren
suffix:semicolon
id|fl.fl4_dst
op_assign
id|daddr-&gt;v4.sin_addr.s_addr
suffix:semicolon
id|fl.proto
op_assign
id|IPPROTO_SCTP
suffix:semicolon
r_if
c_cond
(paren
id|asoc
)paren
(brace
id|fl.fl4_tos
op_assign
id|RT_CONN_FLAGS
c_func
(paren
id|asoc-&gt;base.sk
)paren
suffix:semicolon
id|fl.oif
op_assign
id|asoc-&gt;base.sk-&gt;sk_bound_dev_if
suffix:semicolon
)brace
r_if
c_cond
(paren
id|saddr
)paren
id|fl.fl4_src
op_assign
id|saddr-&gt;v4.sin_addr.s_addr
suffix:semicolon
id|SCTP_DEBUG_PRINTK
c_func
(paren
l_string|&quot;%s: DST:%u.%u.%u.%u, SRC:%u.%u.%u.%u - &quot;
comma
id|__FUNCTION__
comma
id|NIPQUAD
c_func
(paren
id|fl.fl4_dst
)paren
comma
id|NIPQUAD
c_func
(paren
id|fl.fl4_src
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ip_route_output_key
c_func
(paren
op_amp
id|rt
comma
op_amp
id|fl
)paren
)paren
(brace
id|dst
op_assign
op_amp
id|rt-&gt;u.dst
suffix:semicolon
)brace
multiline_comment|/* If there is no association or if a source address is passed, no&n;&t; * more validation is required.&n;&t; */
r_if
c_cond
(paren
op_logical_neg
id|asoc
op_logical_or
id|saddr
)paren
r_goto
id|out
suffix:semicolon
id|bp
op_assign
op_amp
id|asoc-&gt;base.bind_addr
suffix:semicolon
id|addr_lock
op_assign
op_amp
id|asoc-&gt;base.addr_lock
suffix:semicolon
r_if
c_cond
(paren
id|dst
)paren
(brace
multiline_comment|/* Walk through the bind address list and look for a bind&n;&t;&t; * address that matches the source address of the returned dst.&n;&t;&t; */
id|sctp_read_lock
c_func
(paren
id|addr_lock
)paren
suffix:semicolon
id|list_for_each
c_func
(paren
id|pos
comma
op_amp
id|bp-&gt;address_list
)paren
(brace
id|laddr
op_assign
id|list_entry
c_func
(paren
id|pos
comma
r_struct
id|sctp_sockaddr_entry
comma
id|list
)paren
suffix:semicolon
id|sctp_v4_dst_saddr
c_func
(paren
op_amp
id|dst_saddr
comma
id|dst
comma
id|bp-&gt;port
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sctp_v4_cmp_addr
c_func
(paren
op_amp
id|dst_saddr
comma
op_amp
id|laddr-&gt;a
)paren
)paren
r_goto
id|out_unlock
suffix:semicolon
)brace
id|sctp_read_unlock
c_func
(paren
id|addr_lock
)paren
suffix:semicolon
multiline_comment|/* None of the bound addresses match the source address of the&n;&t;&t; * dst. So release it.&n;&t;&t; */
id|dst_release
c_func
(paren
id|dst
)paren
suffix:semicolon
id|dst
op_assign
l_int|NULL
suffix:semicolon
)brace
multiline_comment|/* Walk through the bind address list and try to get a dst that&n;&t; * matches a bind address as the source address.&n;&t; */
id|sctp_read_lock
c_func
(paren
id|addr_lock
)paren
suffix:semicolon
id|list_for_each
c_func
(paren
id|pos
comma
op_amp
id|bp-&gt;address_list
)paren
(brace
id|laddr
op_assign
id|list_entry
c_func
(paren
id|pos
comma
r_struct
id|sctp_sockaddr_entry
comma
id|list
)paren
suffix:semicolon
r_if
c_cond
(paren
id|AF_INET
op_eq
id|laddr-&gt;a.sa.sa_family
)paren
(brace
id|fl.fl4_src
op_assign
id|laddr-&gt;a.v4.sin_addr.s_addr
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ip_route_output_key
c_func
(paren
op_amp
id|rt
comma
op_amp
id|fl
)paren
)paren
(brace
id|dst
op_assign
op_amp
id|rt-&gt;u.dst
suffix:semicolon
r_goto
id|out_unlock
suffix:semicolon
)brace
)brace
)brace
id|out_unlock
suffix:colon
id|sctp_read_unlock
c_func
(paren
id|addr_lock
)paren
suffix:semicolon
id|out
suffix:colon
r_if
c_cond
(paren
id|dst
)paren
id|SCTP_DEBUG_PRINTK
c_func
(paren
l_string|&quot;rt_dst:%u.%u.%u.%u, rt_src:%u.%u.%u.%u&bslash;n&quot;
comma
id|NIPQUAD
c_func
(paren
id|rt-&gt;rt_dst
)paren
comma
id|NIPQUAD
c_func
(paren
id|rt-&gt;rt_src
)paren
)paren
suffix:semicolon
r_else
id|SCTP_DEBUG_PRINTK
c_func
(paren
l_string|&quot;NO ROUTE&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|dst
suffix:semicolon
)brace
multiline_comment|/* For v4, the source address is cached in the route entry(dst). So no need&n; * to cache it separately and hence this is an empty routine.&n; */
DECL|function|sctp_v4_get_saddr
r_void
id|sctp_v4_get_saddr
c_func
(paren
r_struct
id|sctp_association
op_star
id|asoc
comma
r_struct
id|dst_entry
op_star
id|dst
comma
r_union
id|sctp_addr
op_star
id|daddr
comma
r_union
id|sctp_addr
op_star
id|saddr
)paren
(brace
r_struct
id|rtable
op_star
id|rt
op_assign
(paren
r_struct
id|rtable
op_star
)paren
id|dst
suffix:semicolon
r_if
c_cond
(paren
id|rt
)paren
(brace
id|saddr-&gt;v4.sin_family
op_assign
id|AF_INET
suffix:semicolon
id|saddr-&gt;v4.sin_port
op_assign
id|asoc-&gt;base.bind_addr.port
suffix:semicolon
id|saddr-&gt;v4.sin_addr.s_addr
op_assign
id|rt-&gt;rt_src
suffix:semicolon
)brace
)brace
multiline_comment|/* What interface did this skb arrive on? */
DECL|function|sctp_v4_skb_iif
r_static
r_int
id|sctp_v4_skb_iif
c_func
(paren
r_const
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_return
(paren
(paren
r_struct
id|rtable
op_star
)paren
id|skb-&gt;dst
)paren
op_member_access_from_pointer
id|rt_iif
suffix:semicolon
)brace
multiline_comment|/* Was this packet marked by Explicit Congestion Notification? */
DECL|function|sctp_v4_is_ce
r_static
r_int
id|sctp_v4_is_ce
c_func
(paren
r_const
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_return
id|INET_ECN_is_ce
c_func
(paren
id|skb-&gt;nh.iph-&gt;tos
)paren
suffix:semicolon
)brace
multiline_comment|/* Create and initialize a new sk for the socket returned by accept(). */
DECL|function|sctp_v4_create_accept_sk
r_struct
id|sock
op_star
id|sctp_v4_create_accept_sk
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_struct
id|sctp_association
op_star
id|asoc
)paren
(brace
r_struct
id|sock
op_star
id|newsk
suffix:semicolon
r_struct
id|inet_sock
op_star
id|inet
op_assign
id|inet_sk
c_func
(paren
id|sk
)paren
suffix:semicolon
r_struct
id|inet_sock
op_star
id|newinet
suffix:semicolon
id|newsk
op_assign
id|sk_alloc
c_func
(paren
id|PF_INET
comma
id|GFP_KERNEL
comma
id|sk-&gt;sk_prot-&gt;slab_obj_size
comma
id|sk-&gt;sk_prot-&gt;slab
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|newsk
)paren
r_goto
id|out
suffix:semicolon
id|sock_init_data
c_func
(paren
l_int|NULL
comma
id|newsk
)paren
suffix:semicolon
id|sk_set_owner
c_func
(paren
id|newsk
comma
id|THIS_MODULE
)paren
suffix:semicolon
id|newsk-&gt;sk_type
op_assign
id|SOCK_STREAM
suffix:semicolon
id|newsk-&gt;sk_prot
op_assign
id|sk-&gt;sk_prot
suffix:semicolon
id|newsk-&gt;sk_no_check
op_assign
id|sk-&gt;sk_no_check
suffix:semicolon
id|newsk-&gt;sk_reuse
op_assign
id|sk-&gt;sk_reuse
suffix:semicolon
id|newsk-&gt;sk_shutdown
op_assign
id|sk-&gt;sk_shutdown
suffix:semicolon
id|newsk-&gt;sk_destruct
op_assign
id|inet_sock_destruct
suffix:semicolon
id|newsk-&gt;sk_zapped
op_assign
l_int|0
suffix:semicolon
id|newsk-&gt;sk_family
op_assign
id|PF_INET
suffix:semicolon
id|newsk-&gt;sk_protocol
op_assign
id|IPPROTO_SCTP
suffix:semicolon
id|newsk-&gt;sk_backlog_rcv
op_assign
id|sk-&gt;sk_prot-&gt;backlog_rcv
suffix:semicolon
id|newinet
op_assign
id|inet_sk
c_func
(paren
id|newsk
)paren
suffix:semicolon
multiline_comment|/* Initialize sk&squot;s sport, dport, rcv_saddr and daddr for&n;&t; * getsockname() and getpeername()&n;&t; */
id|newinet-&gt;sport
op_assign
id|inet-&gt;sport
suffix:semicolon
id|newinet-&gt;saddr
op_assign
id|inet-&gt;saddr
suffix:semicolon
id|newinet-&gt;rcv_saddr
op_assign
id|inet-&gt;rcv_saddr
suffix:semicolon
id|newinet-&gt;dport
op_assign
id|htons
c_func
(paren
id|asoc-&gt;peer.port
)paren
suffix:semicolon
id|newinet-&gt;daddr
op_assign
id|asoc-&gt;peer.primary_addr.v4.sin_addr.s_addr
suffix:semicolon
id|newinet-&gt;pmtudisc
op_assign
id|inet-&gt;pmtudisc
suffix:semicolon
id|newinet-&gt;id
op_assign
l_int|0
suffix:semicolon
id|newinet-&gt;uc_ttl
op_assign
op_minus
l_int|1
suffix:semicolon
id|newinet-&gt;mc_loop
op_assign
l_int|1
suffix:semicolon
id|newinet-&gt;mc_ttl
op_assign
l_int|1
suffix:semicolon
id|newinet-&gt;mc_index
op_assign
l_int|0
suffix:semicolon
id|newinet-&gt;mc_list
op_assign
l_int|NULL
suffix:semicolon
macro_line|#ifdef INET_REFCNT_DEBUG
id|atomic_inc
c_func
(paren
op_amp
id|inet_sock_nr
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|newsk-&gt;sk_prot
op_member_access_from_pointer
id|init
c_func
(paren
id|newsk
)paren
)paren
(brace
id|sk_common_release
c_func
(paren
id|newsk
)paren
suffix:semicolon
id|newsk
op_assign
l_int|NULL
suffix:semicolon
)brace
id|out
suffix:colon
r_return
id|newsk
suffix:semicolon
)brace
multiline_comment|/* Map address, empty for v4 family */
DECL|function|sctp_v4_addr_v4map
r_static
r_void
id|sctp_v4_addr_v4map
c_func
(paren
r_struct
id|sctp_opt
op_star
id|sp
comma
r_union
id|sctp_addr
op_star
id|addr
)paren
(brace
multiline_comment|/* Empty */
)brace
multiline_comment|/* Dump the v4 addr to the seq file. */
DECL|function|sctp_v4_seq_dump_addr
r_static
r_void
id|sctp_v4_seq_dump_addr
c_func
(paren
r_struct
id|seq_file
op_star
id|seq
comma
r_union
id|sctp_addr
op_star
id|addr
)paren
(brace
id|seq_printf
c_func
(paren
id|seq
comma
l_string|&quot;%d.%d.%d.%d &quot;
comma
id|NIPQUAD
c_func
(paren
id|addr-&gt;v4.sin_addr
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/* Event handler for inet address addition/deletion events.&n; * Basically, whenever there is an event, we re-build our local address list.&n; */
DECL|function|sctp_inetaddr_event
r_int
id|sctp_inetaddr_event
c_func
(paren
r_struct
id|notifier_block
op_star
id|this
comma
r_int
r_int
id|ev
comma
r_void
op_star
id|ptr
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|sctp_spin_lock_irqsave
c_func
(paren
op_amp
id|sctp_local_addr_lock
comma
id|flags
)paren
suffix:semicolon
id|__sctp_free_local_addr_list
c_func
(paren
)paren
suffix:semicolon
id|__sctp_get_local_addr_list
c_func
(paren
)paren
suffix:semicolon
id|sctp_spin_unlock_irqrestore
c_func
(paren
op_amp
id|sctp_local_addr_lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|NOTIFY_DONE
suffix:semicolon
)brace
multiline_comment|/*&n; * Initialize the control inode/socket with a control endpoint data&n; * structure.  This endpoint is reserved exclusively for the OOTB processing.&n; */
DECL|function|sctp_ctl_sock_init
r_int
id|sctp_ctl_sock_init
c_func
(paren
r_void
)paren
(brace
r_int
id|err
suffix:semicolon
id|sa_family_t
id|family
suffix:semicolon
r_if
c_cond
(paren
id|sctp_get_pf_specific
c_func
(paren
id|PF_INET6
)paren
)paren
id|family
op_assign
id|PF_INET6
suffix:semicolon
r_else
id|family
op_assign
id|PF_INET
suffix:semicolon
id|err
op_assign
id|sock_create_kern
c_func
(paren
id|family
comma
id|SOCK_SEQPACKET
comma
id|IPPROTO_SCTP
comma
op_amp
id|sctp_ctl_socket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;SCTP: Failed to create the SCTP control socket.&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
id|sctp_ctl_socket-&gt;sk-&gt;sk_allocation
op_assign
id|GFP_ATOMIC
suffix:semicolon
id|inet_sk
c_func
(paren
id|sctp_ctl_socket-&gt;sk
)paren
op_member_access_from_pointer
id|uc_ttl
op_assign
op_minus
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* Register address family specific functions. */
DECL|function|sctp_register_af
r_int
id|sctp_register_af
c_func
(paren
r_struct
id|sctp_af
op_star
id|af
)paren
(brace
r_switch
c_cond
(paren
id|af-&gt;sa_family
)paren
(brace
r_case
id|AF_INET
suffix:colon
r_if
c_cond
(paren
id|sctp_af_v4_specific
)paren
r_return
l_int|0
suffix:semicolon
id|sctp_af_v4_specific
op_assign
id|af
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AF_INET6
suffix:colon
r_if
c_cond
(paren
id|sctp_af_v6_specific
)paren
r_return
l_int|0
suffix:semicolon
id|sctp_af_v6_specific
op_assign
id|af
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
l_int|0
suffix:semicolon
)brace
id|INIT_LIST_HEAD
c_func
(paren
op_amp
id|af-&gt;list
)paren
suffix:semicolon
id|list_add_tail
c_func
(paren
op_amp
id|af-&gt;list
comma
op_amp
id|sctp_address_families
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
multiline_comment|/* Get the table of functions for manipulating a particular address&n; * family.&n; */
DECL|function|sctp_get_af_specific
r_struct
id|sctp_af
op_star
id|sctp_get_af_specific
c_func
(paren
id|sa_family_t
id|family
)paren
(brace
r_switch
c_cond
(paren
id|family
)paren
(brace
r_case
id|AF_INET
suffix:colon
r_return
id|sctp_af_v4_specific
suffix:semicolon
r_case
id|AF_INET6
suffix:colon
r_return
id|sctp_af_v6_specific
suffix:semicolon
r_default
suffix:colon
r_return
l_int|NULL
suffix:semicolon
)brace
)brace
multiline_comment|/* Common code to initialize a AF_INET msg_name. */
DECL|function|sctp_inet_msgname
r_static
r_void
id|sctp_inet_msgname
c_func
(paren
r_char
op_star
id|msgname
comma
r_int
op_star
id|addr_len
)paren
(brace
r_struct
id|sockaddr_in
op_star
id|sin
suffix:semicolon
id|sin
op_assign
(paren
r_struct
id|sockaddr_in
op_star
)paren
id|msgname
suffix:semicolon
op_star
id|addr_len
op_assign
r_sizeof
(paren
r_struct
id|sockaddr_in
)paren
suffix:semicolon
id|sin-&gt;sin_family
op_assign
id|AF_INET
suffix:semicolon
id|memset
c_func
(paren
id|sin-&gt;sin_zero
comma
l_int|0
comma
r_sizeof
(paren
id|sin-&gt;sin_zero
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/* Copy the primary address of the peer primary address as the msg_name. */
DECL|function|sctp_inet_event_msgname
r_static
r_void
id|sctp_inet_event_msgname
c_func
(paren
r_struct
id|sctp_ulpevent
op_star
id|event
comma
r_char
op_star
id|msgname
comma
r_int
op_star
id|addr_len
)paren
(brace
r_struct
id|sockaddr_in
op_star
id|sin
comma
op_star
id|sinfrom
suffix:semicolon
r_if
c_cond
(paren
id|msgname
)paren
(brace
r_struct
id|sctp_association
op_star
id|asoc
suffix:semicolon
id|asoc
op_assign
id|event-&gt;asoc
suffix:semicolon
id|sctp_inet_msgname
c_func
(paren
id|msgname
comma
id|addr_len
)paren
suffix:semicolon
id|sin
op_assign
(paren
r_struct
id|sockaddr_in
op_star
)paren
id|msgname
suffix:semicolon
id|sinfrom
op_assign
op_amp
id|asoc-&gt;peer.primary_addr.v4
suffix:semicolon
id|sin-&gt;sin_port
op_assign
id|htons
c_func
(paren
id|asoc-&gt;peer.port
)paren
suffix:semicolon
id|sin-&gt;sin_addr.s_addr
op_assign
id|sinfrom-&gt;sin_addr.s_addr
suffix:semicolon
)brace
)brace
multiline_comment|/* Initialize and copy out a msgname from an inbound skb. */
DECL|function|sctp_inet_skb_msgname
r_static
r_void
id|sctp_inet_skb_msgname
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_char
op_star
id|msgname
comma
r_int
op_star
id|len
)paren
(brace
r_struct
id|sctphdr
op_star
id|sh
suffix:semicolon
r_struct
id|sockaddr_in
op_star
id|sin
suffix:semicolon
r_if
c_cond
(paren
id|msgname
)paren
(brace
id|sctp_inet_msgname
c_func
(paren
id|msgname
comma
id|len
)paren
suffix:semicolon
id|sin
op_assign
(paren
r_struct
id|sockaddr_in
op_star
)paren
id|msgname
suffix:semicolon
id|sh
op_assign
(paren
r_struct
id|sctphdr
op_star
)paren
id|skb-&gt;h.raw
suffix:semicolon
id|sin-&gt;sin_port
op_assign
id|sh-&gt;source
suffix:semicolon
id|sin-&gt;sin_addr.s_addr
op_assign
id|skb-&gt;nh.iph-&gt;saddr
suffix:semicolon
)brace
)brace
multiline_comment|/* Do we support this AF? */
DECL|function|sctp_inet_af_supported
r_static
r_int
id|sctp_inet_af_supported
c_func
(paren
id|sa_family_t
id|family
comma
r_struct
id|sctp_opt
op_star
id|sp
)paren
(brace
multiline_comment|/* PF_INET only supports AF_INET addresses. */
r_return
(paren
id|AF_INET
op_eq
id|family
)paren
suffix:semicolon
)brace
multiline_comment|/* Address matching with wildcards allowed. */
DECL|function|sctp_inet_cmp_addr
r_static
r_int
id|sctp_inet_cmp_addr
c_func
(paren
r_const
r_union
id|sctp_addr
op_star
id|addr1
comma
r_const
r_union
id|sctp_addr
op_star
id|addr2
comma
r_struct
id|sctp_opt
op_star
id|opt
)paren
(brace
multiline_comment|/* PF_INET only supports AF_INET addresses. */
r_if
c_cond
(paren
id|addr1-&gt;sa.sa_family
op_ne
id|addr2-&gt;sa.sa_family
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|INADDR_ANY
op_eq
id|addr1-&gt;v4.sin_addr.s_addr
op_logical_or
id|INADDR_ANY
op_eq
id|addr2-&gt;v4.sin_addr.s_addr
)paren
r_return
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|addr1-&gt;v4.sin_addr.s_addr
op_eq
id|addr2-&gt;v4.sin_addr.s_addr
)paren
r_return
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* Verify that provided sockaddr looks bindable.  Common verification has&n; * already been taken care of.&n; */
DECL|function|sctp_inet_bind_verify
r_static
r_int
id|sctp_inet_bind_verify
c_func
(paren
r_struct
id|sctp_opt
op_star
id|opt
comma
r_union
id|sctp_addr
op_star
id|addr
)paren
(brace
r_return
id|sctp_v4_available
c_func
(paren
id|addr
comma
id|opt
)paren
suffix:semicolon
)brace
multiline_comment|/* Verify that sockaddr looks sendable.  Common verification has already&n; * been taken care of.&n; */
DECL|function|sctp_inet_send_verify
r_static
r_int
id|sctp_inet_send_verify
c_func
(paren
r_struct
id|sctp_opt
op_star
id|opt
comma
r_union
id|sctp_addr
op_star
id|addr
)paren
(brace
r_return
l_int|1
suffix:semicolon
)brace
multiline_comment|/* Fill in Supported Address Type information for INIT and INIT-ACK&n; * chunks.  Returns number of addresses supported.&n; */
DECL|function|sctp_inet_supported_addrs
r_static
r_int
id|sctp_inet_supported_addrs
c_func
(paren
r_const
r_struct
id|sctp_opt
op_star
id|opt
comma
id|__u16
op_star
id|types
)paren
(brace
id|types
(braket
l_int|0
)braket
op_assign
id|SCTP_PARAM_IPV4_ADDRESS
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
multiline_comment|/* Wrapper routine that calls the ip transmit routine. */
DECL|function|sctp_v4_xmit
r_static
r_inline
r_int
id|sctp_v4_xmit
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|sctp_transport
op_star
id|transport
comma
r_int
id|ipfragok
)paren
(brace
id|SCTP_DEBUG_PRINTK
c_func
(paren
l_string|&quot;%s: skb:%p, len:%d, &quot;
l_string|&quot;src:%u.%u.%u.%u, dst:%u.%u.%u.%u&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|skb
comma
id|skb-&gt;len
comma
id|NIPQUAD
c_func
(paren
(paren
(paren
r_struct
id|rtable
op_star
)paren
id|skb-&gt;dst
)paren
op_member_access_from_pointer
id|rt_src
)paren
comma
id|NIPQUAD
c_func
(paren
(paren
(paren
r_struct
id|rtable
op_star
)paren
id|skb-&gt;dst
)paren
op_member_access_from_pointer
id|rt_dst
)paren
)paren
suffix:semicolon
id|SCTP_INC_STATS
c_func
(paren
id|SCTP_MIB_OUTSCTPPACKS
)paren
suffix:semicolon
r_return
id|ip_queue_xmit
c_func
(paren
id|skb
comma
id|ipfragok
)paren
suffix:semicolon
)brace
DECL|variable|sctp_ipv4_specific
r_struct
id|sctp_af
id|sctp_ipv4_specific
suffix:semicolon
DECL|variable|sctp_pf_inet
r_static
r_struct
id|sctp_pf
id|sctp_pf_inet
op_assign
(brace
dot
id|event_msgname
op_assign
id|sctp_inet_event_msgname
comma
dot
id|skb_msgname
op_assign
id|sctp_inet_skb_msgname
comma
dot
id|af_supported
op_assign
id|sctp_inet_af_supported
comma
dot
id|cmp_addr
op_assign
id|sctp_inet_cmp_addr
comma
dot
id|bind_verify
op_assign
id|sctp_inet_bind_verify
comma
dot
id|send_verify
op_assign
id|sctp_inet_send_verify
comma
dot
id|supported_addrs
op_assign
id|sctp_inet_supported_addrs
comma
dot
id|create_accept_sk
op_assign
id|sctp_v4_create_accept_sk
comma
dot
id|addr_v4map
op_assign
id|sctp_v4_addr_v4map
comma
dot
id|af
op_assign
op_amp
id|sctp_ipv4_specific
comma
)brace
suffix:semicolon
multiline_comment|/* Notifier for inetaddr addition/deletion events.  */
DECL|variable|sctp_inetaddr_notifier
r_static
r_struct
id|notifier_block
id|sctp_inetaddr_notifier
op_assign
(brace
dot
id|notifier_call
op_assign
id|sctp_inetaddr_event
comma
)brace
suffix:semicolon
multiline_comment|/* Socket operations.  */
DECL|variable|inet_seqpacket_ops
r_struct
id|proto_ops
id|inet_seqpacket_ops
op_assign
(brace
dot
id|family
op_assign
id|PF_INET
comma
dot
id|owner
op_assign
id|THIS_MODULE
comma
dot
id|release
op_assign
id|inet_release
comma
multiline_comment|/* Needs to be wrapped... */
dot
id|bind
op_assign
id|inet_bind
comma
dot
id|connect
op_assign
id|inet_dgram_connect
comma
dot
id|socketpair
op_assign
id|sock_no_socketpair
comma
dot
id|accept
op_assign
id|inet_accept
comma
dot
id|getname
op_assign
id|inet_getname
comma
multiline_comment|/* Semantics are different.  */
dot
id|poll
op_assign
id|sctp_poll
comma
dot
id|ioctl
op_assign
id|inet_ioctl
comma
dot
id|listen
op_assign
id|sctp_inet_listen
comma
dot
id|shutdown
op_assign
id|inet_shutdown
comma
multiline_comment|/* Looks harmless.  */
dot
id|setsockopt
op_assign
id|sock_common_setsockopt
comma
multiline_comment|/* IP_SOL IP_OPTION is a problem. */
dot
id|getsockopt
op_assign
id|sock_common_getsockopt
comma
dot
id|sendmsg
op_assign
id|inet_sendmsg
comma
dot
id|recvmsg
op_assign
id|sock_common_recvmsg
comma
dot
id|mmap
op_assign
id|sock_no_mmap
comma
dot
id|sendpage
op_assign
id|sock_no_sendpage
comma
)brace
suffix:semicolon
multiline_comment|/* Registration with AF_INET family.  */
DECL|variable|sctp_seqpacket_protosw
r_static
r_struct
id|inet_protosw
id|sctp_seqpacket_protosw
op_assign
(brace
dot
id|type
op_assign
id|SOCK_SEQPACKET
comma
dot
id|protocol
op_assign
id|IPPROTO_SCTP
comma
dot
id|prot
op_assign
op_amp
id|sctp_prot
comma
dot
id|ops
op_assign
op_amp
id|inet_seqpacket_ops
comma
dot
id|capability
op_assign
op_minus
l_int|1
comma
dot
id|no_check
op_assign
l_int|0
comma
dot
id|flags
op_assign
id|SCTP_PROTOSW_FLAG
)brace
suffix:semicolon
DECL|variable|sctp_stream_protosw
r_static
r_struct
id|inet_protosw
id|sctp_stream_protosw
op_assign
(brace
dot
id|type
op_assign
id|SOCK_STREAM
comma
dot
id|protocol
op_assign
id|IPPROTO_SCTP
comma
dot
id|prot
op_assign
op_amp
id|sctp_prot
comma
dot
id|ops
op_assign
op_amp
id|inet_seqpacket_ops
comma
dot
id|capability
op_assign
op_minus
l_int|1
comma
dot
id|no_check
op_assign
l_int|0
comma
dot
id|flags
op_assign
id|SCTP_PROTOSW_FLAG
)brace
suffix:semicolon
multiline_comment|/* Register with IP layer.  */
DECL|variable|sctp_protocol
r_static
r_struct
id|net_protocol
id|sctp_protocol
op_assign
(brace
dot
id|handler
op_assign
id|sctp_rcv
comma
dot
id|err_handler
op_assign
id|sctp_v4_err
comma
dot
id|no_policy
op_assign
l_int|1
comma
)brace
suffix:semicolon
multiline_comment|/* IPv4 address related functions.  */
DECL|variable|sctp_ipv4_specific
r_struct
id|sctp_af
id|sctp_ipv4_specific
op_assign
(brace
dot
id|sctp_xmit
op_assign
id|sctp_v4_xmit
comma
dot
id|setsockopt
op_assign
id|ip_setsockopt
comma
dot
id|getsockopt
op_assign
id|ip_getsockopt
comma
dot
id|get_dst
op_assign
id|sctp_v4_get_dst
comma
dot
id|get_saddr
op_assign
id|sctp_v4_get_saddr
comma
dot
id|copy_addrlist
op_assign
id|sctp_v4_copy_addrlist
comma
dot
id|from_skb
op_assign
id|sctp_v4_from_skb
comma
dot
id|from_sk
op_assign
id|sctp_v4_from_sk
comma
dot
id|to_sk_saddr
op_assign
id|sctp_v4_to_sk_saddr
comma
dot
id|to_sk_daddr
op_assign
id|sctp_v4_to_sk_daddr
comma
dot
id|from_addr_param
op_assign
id|sctp_v4_from_addr_param
comma
dot
id|to_addr_param
op_assign
id|sctp_v4_to_addr_param
comma
dot
id|dst_saddr
op_assign
id|sctp_v4_dst_saddr
comma
dot
id|cmp_addr
op_assign
id|sctp_v4_cmp_addr
comma
dot
id|addr_valid
op_assign
id|sctp_v4_addr_valid
comma
dot
id|inaddr_any
op_assign
id|sctp_v4_inaddr_any
comma
dot
id|is_any
op_assign
id|sctp_v4_is_any
comma
dot
id|available
op_assign
id|sctp_v4_available
comma
dot
id|scope
op_assign
id|sctp_v4_scope
comma
dot
id|skb_iif
op_assign
id|sctp_v4_skb_iif
comma
dot
id|is_ce
op_assign
id|sctp_v4_is_ce
comma
dot
id|seq_dump_addr
op_assign
id|sctp_v4_seq_dump_addr
comma
dot
id|net_header_len
op_assign
r_sizeof
(paren
r_struct
id|iphdr
)paren
comma
dot
id|sockaddr_len
op_assign
r_sizeof
(paren
r_struct
id|sockaddr_in
)paren
comma
dot
id|sa_family
op_assign
id|AF_INET
comma
)brace
suffix:semicolon
DECL|function|sctp_get_pf_specific
r_struct
id|sctp_pf
op_star
id|sctp_get_pf_specific
c_func
(paren
id|sa_family_t
id|family
)paren
(brace
r_switch
c_cond
(paren
id|family
)paren
(brace
r_case
id|PF_INET
suffix:colon
r_return
id|sctp_pf_inet_specific
suffix:semicolon
r_case
id|PF_INET6
suffix:colon
r_return
id|sctp_pf_inet6_specific
suffix:semicolon
r_default
suffix:colon
r_return
l_int|NULL
suffix:semicolon
)brace
)brace
multiline_comment|/* Register the PF specific function table.  */
DECL|function|sctp_register_pf
r_int
id|sctp_register_pf
c_func
(paren
r_struct
id|sctp_pf
op_star
id|pf
comma
id|sa_family_t
id|family
)paren
(brace
r_switch
c_cond
(paren
id|family
)paren
(brace
r_case
id|PF_INET
suffix:colon
r_if
c_cond
(paren
id|sctp_pf_inet_specific
)paren
r_return
l_int|0
suffix:semicolon
id|sctp_pf_inet_specific
op_assign
id|pf
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PF_INET6
suffix:colon
r_if
c_cond
(paren
id|sctp_pf_inet6_specific
)paren
r_return
l_int|0
suffix:semicolon
id|sctp_pf_inet6_specific
op_assign
id|pf
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
l_int|0
suffix:semicolon
)brace
r_return
l_int|1
suffix:semicolon
)brace
DECL|function|init_sctp_mibs
r_static
r_int
id|__init
id|init_sctp_mibs
c_func
(paren
r_void
)paren
(brace
id|sctp_statistics
(braket
l_int|0
)braket
op_assign
id|alloc_percpu
c_func
(paren
r_struct
id|sctp_mib
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sctp_statistics
(braket
l_int|0
)braket
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|sctp_statistics
(braket
l_int|1
)braket
op_assign
id|alloc_percpu
c_func
(paren
r_struct
id|sctp_mib
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sctp_statistics
(braket
l_int|1
)braket
)paren
(brace
id|free_percpu
c_func
(paren
id|sctp_statistics
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|cleanup_sctp_mibs
r_static
r_void
id|cleanup_sctp_mibs
c_func
(paren
r_void
)paren
(brace
id|free_percpu
c_func
(paren
id|sctp_statistics
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|free_percpu
c_func
(paren
id|sctp_statistics
(braket
l_int|1
)braket
)paren
suffix:semicolon
)brace
multiline_comment|/* Initialize the universe into something sensible.  */
DECL|function|sctp_init
id|__init
r_int
id|sctp_init
c_func
(paren
r_void
)paren
(brace
r_int
id|i
suffix:semicolon
r_int
id|status
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_int
r_int
id|goal
suffix:semicolon
r_int
id|order
suffix:semicolon
multiline_comment|/* SCTP_DEBUG sanity check. */
r_if
c_cond
(paren
op_logical_neg
id|sctp_sanity_check
c_func
(paren
)paren
)paren
r_goto
id|out
suffix:semicolon
id|status
op_assign
id|sk_alloc_slab
c_func
(paren
op_amp
id|sctp_prot
comma
l_string|&quot;sctp_sock&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
)paren
r_goto
id|out
suffix:semicolon
multiline_comment|/* Add SCTP to inet_protos hash table.  */
id|status
op_assign
op_minus
id|EAGAIN
suffix:semicolon
r_if
c_cond
(paren
id|inet_add_protocol
c_func
(paren
op_amp
id|sctp_protocol
comma
id|IPPROTO_SCTP
)paren
OL
l_int|0
)paren
r_goto
id|err_add_protocol
suffix:semicolon
multiline_comment|/* Add SCTP(TCP and UDP style) to inetsw linked list.  */
id|inet_register_protosw
c_func
(paren
op_amp
id|sctp_seqpacket_protosw
)paren
suffix:semicolon
id|inet_register_protosw
c_func
(paren
op_amp
id|sctp_stream_protosw
)paren
suffix:semicolon
multiline_comment|/* Allocate a cache pools. */
id|status
op_assign
op_minus
id|ENOBUFS
suffix:semicolon
id|sctp_bucket_cachep
op_assign
id|kmem_cache_create
c_func
(paren
l_string|&quot;sctp_bind_bucket&quot;
comma
r_sizeof
(paren
r_struct
id|sctp_bind_bucket
)paren
comma
l_int|0
comma
id|SLAB_HWCACHE_ALIGN
comma
l_int|NULL
comma
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sctp_bucket_cachep
)paren
r_goto
id|err_bucket_cachep
suffix:semicolon
id|sctp_chunk_cachep
op_assign
id|kmem_cache_create
c_func
(paren
l_string|&quot;sctp_chunk&quot;
comma
r_sizeof
(paren
r_struct
id|sctp_chunk
)paren
comma
l_int|0
comma
id|SLAB_HWCACHE_ALIGN
comma
l_int|NULL
comma
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sctp_chunk_cachep
)paren
r_goto
id|err_chunk_cachep
suffix:semicolon
multiline_comment|/* Allocate and initialise sctp mibs.  */
id|status
op_assign
id|init_sctp_mibs
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
)paren
r_goto
id|err_init_mibs
suffix:semicolon
multiline_comment|/* Initialize proc fs directory.  */
id|status
op_assign
id|sctp_proc_init
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
)paren
r_goto
id|err_init_proc
suffix:semicolon
multiline_comment|/* Initialize object count debugging.  */
id|sctp_dbg_objcnt_init
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* Initialize the SCTP specific PF functions. */
id|sctp_register_pf
c_func
(paren
op_amp
id|sctp_pf_inet
comma
id|PF_INET
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * 14. Suggested SCTP Protocol Parameter Values&n;&t; */
multiline_comment|/* The following protocol parameters are RECOMMENDED:  */
multiline_comment|/* RTO.Initial              - 3  seconds */
id|sctp_rto_initial
op_assign
id|SCTP_RTO_INITIAL
suffix:semicolon
multiline_comment|/* RTO.Min                  - 1  second */
id|sctp_rto_min
op_assign
id|SCTP_RTO_MIN
suffix:semicolon
multiline_comment|/* RTO.Max                 -  60 seconds */
id|sctp_rto_max
op_assign
id|SCTP_RTO_MAX
suffix:semicolon
multiline_comment|/* RTO.Alpha                - 1/8 */
id|sctp_rto_alpha
op_assign
id|SCTP_RTO_ALPHA
suffix:semicolon
multiline_comment|/* RTO.Beta                 - 1/4 */
id|sctp_rto_beta
op_assign
id|SCTP_RTO_BETA
suffix:semicolon
multiline_comment|/* Valid.Cookie.Life        - 60  seconds */
id|sctp_valid_cookie_life
op_assign
l_int|60
op_star
id|HZ
suffix:semicolon
multiline_comment|/* Whether Cookie Preservative is enabled(1) or not(0) */
id|sctp_cookie_preserve_enable
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* Max.Burst&t;&t;    - 4 */
id|sctp_max_burst
op_assign
id|SCTP_MAX_BURST
suffix:semicolon
multiline_comment|/* Association.Max.Retrans  - 10 attempts&n;&t; * Path.Max.Retrans         - 5  attempts (per destination address)&n;&t; * Max.Init.Retransmits     - 8  attempts&n;&t; */
id|sctp_max_retrans_association
op_assign
l_int|10
suffix:semicolon
id|sctp_max_retrans_path
op_assign
l_int|5
suffix:semicolon
id|sctp_max_retrans_init
op_assign
l_int|8
suffix:semicolon
multiline_comment|/* HB.interval              - 30 seconds */
id|sctp_hb_interval
op_assign
l_int|30
op_star
id|HZ
suffix:semicolon
multiline_comment|/* Implementation specific variables. */
multiline_comment|/* Initialize default stream count setup information. */
id|sctp_max_instreams
op_assign
id|SCTP_DEFAULT_INSTREAMS
suffix:semicolon
id|sctp_max_outstreams
op_assign
id|SCTP_DEFAULT_OUTSTREAMS
suffix:semicolon
multiline_comment|/* Initialize handle used for association ids. */
id|idr_init
c_func
(paren
op_amp
id|sctp_assocs_id
)paren
suffix:semicolon
multiline_comment|/* Size and allocate the association hash table.&n;&t; * The methodology is similar to that of the tcp hash tables.&n;&t; */
r_if
c_cond
(paren
id|num_physpages
op_ge
(paren
l_int|128
op_star
l_int|1024
)paren
)paren
id|goal
op_assign
id|num_physpages
op_rshift
(paren
l_int|22
op_minus
id|PAGE_SHIFT
)paren
suffix:semicolon
r_else
id|goal
op_assign
id|num_physpages
op_rshift
(paren
l_int|24
op_minus
id|PAGE_SHIFT
)paren
suffix:semicolon
r_for
c_loop
(paren
id|order
op_assign
l_int|0
suffix:semicolon
(paren
l_int|1UL
op_lshift
id|order
)paren
OL
id|goal
suffix:semicolon
id|order
op_increment
)paren
suffix:semicolon
r_do
(brace
id|sctp_assoc_hashsize
op_assign
(paren
l_int|1UL
op_lshift
id|order
)paren
op_star
id|PAGE_SIZE
op_div
r_sizeof
(paren
r_struct
id|sctp_hashbucket
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|sctp_assoc_hashsize
OG
(paren
l_int|64
op_star
l_int|1024
)paren
)paren
op_logical_and
id|order
OG
l_int|0
)paren
r_continue
suffix:semicolon
id|sctp_assoc_hashtable
op_assign
(paren
r_struct
id|sctp_hashbucket
op_star
)paren
id|__get_free_pages
c_func
(paren
id|GFP_ATOMIC
comma
id|order
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
op_logical_neg
id|sctp_assoc_hashtable
op_logical_and
op_decrement
id|order
OG
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sctp_assoc_hashtable
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;SCTP: Failed association hash alloc.&bslash;n&quot;
)paren
suffix:semicolon
id|status
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|err_ahash_alloc
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|sctp_assoc_hashsize
suffix:semicolon
id|i
op_increment
)paren
(brace
id|rwlock_init
c_func
(paren
op_amp
id|sctp_assoc_hashtable
(braket
id|i
)braket
dot
id|lock
)paren
suffix:semicolon
id|sctp_assoc_hashtable
(braket
id|i
)braket
dot
id|chain
op_assign
l_int|NULL
suffix:semicolon
)brace
multiline_comment|/* Allocate and initialize the endpoint hash table.  */
id|sctp_ep_hashsize
op_assign
l_int|64
suffix:semicolon
id|sctp_ep_hashtable
op_assign
(paren
r_struct
id|sctp_hashbucket
op_star
)paren
id|kmalloc
c_func
(paren
l_int|64
op_star
r_sizeof
(paren
r_struct
id|sctp_hashbucket
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sctp_ep_hashtable
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;SCTP: Failed endpoint_hash alloc.&bslash;n&quot;
)paren
suffix:semicolon
id|status
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|err_ehash_alloc
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|sctp_ep_hashsize
suffix:semicolon
id|i
op_increment
)paren
(brace
id|rwlock_init
c_func
(paren
op_amp
id|sctp_ep_hashtable
(braket
id|i
)braket
dot
id|lock
)paren
suffix:semicolon
id|sctp_ep_hashtable
(braket
id|i
)braket
dot
id|chain
op_assign
l_int|NULL
suffix:semicolon
)brace
multiline_comment|/* Allocate and initialize the SCTP port hash table.  */
r_do
(brace
id|sctp_port_hashsize
op_assign
(paren
l_int|1UL
op_lshift
id|order
)paren
op_star
id|PAGE_SIZE
op_div
r_sizeof
(paren
r_struct
id|sctp_bind_hashbucket
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|sctp_port_hashsize
OG
(paren
l_int|64
op_star
l_int|1024
)paren
)paren
op_logical_and
id|order
OG
l_int|0
)paren
r_continue
suffix:semicolon
id|sctp_port_hashtable
op_assign
(paren
r_struct
id|sctp_bind_hashbucket
op_star
)paren
id|__get_free_pages
c_func
(paren
id|GFP_ATOMIC
comma
id|order
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
op_logical_neg
id|sctp_port_hashtable
op_logical_and
op_decrement
id|order
OG
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sctp_port_hashtable
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;SCTP: Failed bind hash alloc.&quot;
)paren
suffix:semicolon
id|status
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|err_bhash_alloc
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|sctp_port_hashsize
suffix:semicolon
id|i
op_increment
)paren
(brace
id|spin_lock_init
c_func
(paren
op_amp
id|sctp_port_hashtable
(braket
id|i
)braket
dot
id|lock
)paren
suffix:semicolon
id|sctp_port_hashtable
(braket
id|i
)braket
dot
id|chain
op_assign
l_int|NULL
suffix:semicolon
)brace
id|spin_lock_init
c_func
(paren
op_amp
id|sctp_port_alloc_lock
)paren
suffix:semicolon
id|sctp_port_rover
op_assign
id|sysctl_local_port_range
(braket
l_int|0
)braket
op_minus
l_int|1
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;SCTP: Hash tables configured &quot;
l_string|&quot;(established %d bind %d)&bslash;n&quot;
comma
id|sctp_assoc_hashsize
comma
id|sctp_port_hashsize
)paren
suffix:semicolon
multiline_comment|/* Disable ADDIP by default. */
id|sctp_addip_enable
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Enable PR-SCTP by default. */
id|sctp_prsctp_enable
op_assign
l_int|1
suffix:semicolon
id|sctp_sysctl_register
c_func
(paren
)paren
suffix:semicolon
id|INIT_LIST_HEAD
c_func
(paren
op_amp
id|sctp_address_families
)paren
suffix:semicolon
id|sctp_register_af
c_func
(paren
op_amp
id|sctp_ipv4_specific
)paren
suffix:semicolon
id|status
op_assign
id|sctp_v6_init
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
)paren
r_goto
id|err_v6_init
suffix:semicolon
multiline_comment|/* Initialize the control inode/socket for handling OOTB packets.  */
r_if
c_cond
(paren
(paren
id|status
op_assign
id|sctp_ctl_sock_init
c_func
(paren
)paren
)paren
)paren
(brace
id|printk
(paren
id|KERN_ERR
l_string|&quot;SCTP: Failed to initialize the SCTP control sock.&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|err_ctl_sock_init
suffix:semicolon
)brace
multiline_comment|/* Initialize the local address list. */
id|INIT_LIST_HEAD
c_func
(paren
op_amp
id|sctp_local_addr_list
)paren
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|sctp_local_addr_lock
)paren
suffix:semicolon
multiline_comment|/* Register notifier for inet address additions/deletions. */
id|register_inetaddr_notifier
c_func
(paren
op_amp
id|sctp_inetaddr_notifier
)paren
suffix:semicolon
id|sctp_get_local_addr_list
c_func
(paren
)paren
suffix:semicolon
id|__unsafe
c_func
(paren
id|THIS_MODULE
)paren
suffix:semicolon
id|status
op_assign
l_int|0
suffix:semicolon
id|out
suffix:colon
r_return
id|status
suffix:semicolon
id|err_add_protocol
suffix:colon
id|sk_free_slab
c_func
(paren
op_amp
id|sctp_prot
)paren
suffix:semicolon
id|err_ctl_sock_init
suffix:colon
id|sctp_v6_exit
c_func
(paren
)paren
suffix:semicolon
id|err_v6_init
suffix:colon
id|sctp_sysctl_unregister
c_func
(paren
)paren
suffix:semicolon
id|list_del
c_func
(paren
op_amp
id|sctp_ipv4_specific.list
)paren
suffix:semicolon
id|free_pages
c_func
(paren
(paren
r_int
r_int
)paren
id|sctp_port_hashtable
comma
id|get_order
c_func
(paren
id|sctp_port_hashsize
op_star
r_sizeof
(paren
r_struct
id|sctp_bind_hashbucket
)paren
)paren
)paren
suffix:semicolon
id|err_bhash_alloc
suffix:colon
id|kfree
c_func
(paren
id|sctp_ep_hashtable
)paren
suffix:semicolon
id|err_ehash_alloc
suffix:colon
id|free_pages
c_func
(paren
(paren
r_int
r_int
)paren
id|sctp_assoc_hashtable
comma
id|get_order
c_func
(paren
id|sctp_assoc_hashsize
op_star
r_sizeof
(paren
r_struct
id|sctp_hashbucket
)paren
)paren
)paren
suffix:semicolon
id|err_ahash_alloc
suffix:colon
id|sctp_dbg_objcnt_exit
c_func
(paren
)paren
suffix:semicolon
id|err_init_proc
suffix:colon
id|sctp_proc_exit
c_func
(paren
)paren
suffix:semicolon
id|cleanup_sctp_mibs
c_func
(paren
)paren
suffix:semicolon
id|err_init_mibs
suffix:colon
id|kmem_cache_destroy
c_func
(paren
id|sctp_chunk_cachep
)paren
suffix:semicolon
id|err_chunk_cachep
suffix:colon
id|kmem_cache_destroy
c_func
(paren
id|sctp_bucket_cachep
)paren
suffix:semicolon
id|err_bucket_cachep
suffix:colon
id|inet_del_protocol
c_func
(paren
op_amp
id|sctp_protocol
comma
id|IPPROTO_SCTP
)paren
suffix:semicolon
id|inet_unregister_protosw
c_func
(paren
op_amp
id|sctp_seqpacket_protosw
)paren
suffix:semicolon
id|inet_unregister_protosw
c_func
(paren
op_amp
id|sctp_stream_protosw
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
multiline_comment|/* Exit handler for the SCTP protocol.  */
DECL|function|sctp_exit
id|__exit
r_void
id|sctp_exit
c_func
(paren
r_void
)paren
(brace
multiline_comment|/* BUG.  This should probably do something useful like clean&n;&t; * up all the remaining associations and all that memory.&n;&t; */
multiline_comment|/* Unregister notifier for inet address additions/deletions. */
id|unregister_inetaddr_notifier
c_func
(paren
op_amp
id|sctp_inetaddr_notifier
)paren
suffix:semicolon
multiline_comment|/* Free the local address list.  */
id|sctp_free_local_addr_list
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* Free the control endpoint.  */
id|sock_release
c_func
(paren
id|sctp_ctl_socket
)paren
suffix:semicolon
id|sctp_v6_exit
c_func
(paren
)paren
suffix:semicolon
id|sctp_sysctl_unregister
c_func
(paren
)paren
suffix:semicolon
id|list_del
c_func
(paren
op_amp
id|sctp_ipv4_specific.list
)paren
suffix:semicolon
id|free_pages
c_func
(paren
(paren
r_int
r_int
)paren
id|sctp_assoc_hashtable
comma
id|get_order
c_func
(paren
id|sctp_assoc_hashsize
op_star
r_sizeof
(paren
r_struct
id|sctp_hashbucket
)paren
)paren
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|sctp_ep_hashtable
)paren
suffix:semicolon
id|free_pages
c_func
(paren
(paren
r_int
r_int
)paren
id|sctp_port_hashtable
comma
id|get_order
c_func
(paren
id|sctp_port_hashsize
op_star
r_sizeof
(paren
r_struct
id|sctp_bind_hashbucket
)paren
)paren
)paren
suffix:semicolon
id|kmem_cache_destroy
c_func
(paren
id|sctp_chunk_cachep
)paren
suffix:semicolon
id|kmem_cache_destroy
c_func
(paren
id|sctp_bucket_cachep
)paren
suffix:semicolon
id|sctp_dbg_objcnt_exit
c_func
(paren
)paren
suffix:semicolon
id|sctp_proc_exit
c_func
(paren
)paren
suffix:semicolon
id|cleanup_sctp_mibs
c_func
(paren
)paren
suffix:semicolon
id|inet_del_protocol
c_func
(paren
op_amp
id|sctp_protocol
comma
id|IPPROTO_SCTP
)paren
suffix:semicolon
id|inet_unregister_protosw
c_func
(paren
op_amp
id|sctp_seqpacket_protosw
)paren
suffix:semicolon
id|inet_unregister_protosw
c_func
(paren
op_amp
id|sctp_stream_protosw
)paren
suffix:semicolon
id|sk_free_slab
c_func
(paren
op_amp
id|sctp_prot
)paren
suffix:semicolon
)brace
DECL|variable|sctp_init
id|module_init
c_func
(paren
id|sctp_init
)paren
suffix:semicolon
DECL|variable|sctp_exit
id|module_exit
c_func
(paren
id|sctp_exit
)paren
suffix:semicolon
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Linux Kernel SCTP developers &lt;lksctp-developers@lists.sourceforge.net&gt;&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;Support for the SCTP protocol (RFC2960)&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
eof
