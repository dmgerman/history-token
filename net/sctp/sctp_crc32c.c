multiline_comment|/* SCTP kernel reference Implementation&n; * Copyright (c) 1999-2001 Motorola, Inc.&n; * Copyright (c) 2001 International Business Machines, Corp.&n; * &n; * This file is part of the SCTP kernel reference Implementation&n; * &n; * $Header: /cvsroot/lksctp/lksctp/sctp_cvs/net/sctp/sctp_crc32c.c,v 1.9 2002/07/12 14:50:25 jgrimm Exp $&n; * &n; * SCTP Checksum functions&n; * &n; * The SCTP reference implementation is free software; &n; * you can redistribute it and/or modify it under the terms of &n; * the GNU General Public License as published by&n; * the Free Software Foundation; either version 2, or (at your option)&n; * any later version.&n; * &n; * The SCTP reference implementation is distributed in the hope that it &n; * will be useful, but WITHOUT ANY WARRANTY; without even the implied&n; *                 ************************&n; * warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.&n; * See the GNU General Public License for more details.&n; * &n; * You should have received a copy of the GNU General Public License&n; * along with GNU CC; see the file COPYING.  If not, write to&n; * the Free Software Foundation, 59 Temple Place - Suite 330,&n; * Boston, MA 02111-1307, USA.  &n; * &n; * Please send any bug reports or fixes you make to the&n; * email address(es):&n; *    lksctp developers &lt;lksctp-developers@lists.sourceforge.net&gt;&n; * &n; * Or submit a bug report through the following website:&n; *    http://www.sf.net/projects/lksctp&n; *&n; * Written or modified by: &n; *    Dinakaran Joseph &n; *    Jon Grimm &lt;jgrimm@us.ibm.com&gt;&n; * &n; * Any bugs reported given to us we will try to fix... any fixes shared will&n; * be incorporated into the next SCTP release.&n; */
DECL|variable|cvs_id
r_static
r_char
op_star
id|cvs_id
id|__attribute__
(paren
(paren
id|unused
)paren
)paren
op_assign
l_string|&quot;$Id: sctp_crc32c.c,v 1.9 2002/07/12 14:50:25 jgrimm Exp $&quot;
suffix:semicolon
multiline_comment|/* The following code has been taken directly from&n; * draft-ietf-tsvwg-sctpcsum-03.txt&n; *&n; * The code has now been modified specifically for SCTP knowledge.&n; */
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;net/sctp/sctp.h&gt;
DECL|macro|CRC32C_POLY
mdefine_line|#define CRC32C_POLY 0x1EDC6F41 
DECL|macro|CRC32C
mdefine_line|#define CRC32C(c,d) (c=(c&gt;&gt;8)^crc_c[(c^(d))&amp;0xFF]) 
multiline_comment|/* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * */
multiline_comment|/* Copyright 2001, D. Otis.  Use this program, code or tables    */
multiline_comment|/* extracted from it, as desired without restriction.            */
multiline_comment|/*                                                               */
multiline_comment|/* 32 Bit Reflected CRC table generation for SCTP.               */
multiline_comment|/* To accommodate serial byte data being shifted out least       */
multiline_comment|/* significant bit first, the table&squot;s 32 bit words are reflected */
multiline_comment|/* which flips both byte and bit MS and LS positions.  The CRC   */
multiline_comment|/* is calculated MS bits first from the perspective of the serial*/
multiline_comment|/* stream.  The x^32 term is implied and the x^0 term may also   */
multiline_comment|/* be shown as +1.  The polynomial code used is 0x1EDC6F41.      */
multiline_comment|/* Castagnoli93                                                  */
multiline_comment|/* x^32+x^28+x^27+x^26+x^25+x^23+x^22+x^20+x^19+x^18+x^14+x^13+  */
multiline_comment|/* x^11+x^10+x^9+x^8+x^6+x^0                                     */
multiline_comment|/* Guy Castagnoli Stefan Braeuer and Martin Herrman              */
multiline_comment|/* &quot;Optimization of Cyclic Redundancy-Check Codes                */
multiline_comment|/* with 24 and 32 Parity Bits&quot;,                                  */
multiline_comment|/* IEEE Transactions on Communications, Vol.41, No.6, June 1993  */
multiline_comment|/* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * */
DECL|variable|crc_c
r_int
r_int
id|crc_c
(braket
l_int|256
)braket
op_assign
(brace
l_int|0x00000000L
comma
l_int|0xF26B8303L
comma
l_int|0xE13B70F7L
comma
l_int|0x1350F3F4L
comma
l_int|0xC79A971FL
comma
l_int|0x35F1141CL
comma
l_int|0x26A1E7E8L
comma
l_int|0xD4CA64EBL
comma
l_int|0x8AD958CFL
comma
l_int|0x78B2DBCCL
comma
l_int|0x6BE22838L
comma
l_int|0x9989AB3BL
comma
l_int|0x4D43CFD0L
comma
l_int|0xBF284CD3L
comma
l_int|0xAC78BF27L
comma
l_int|0x5E133C24L
comma
l_int|0x105EC76FL
comma
l_int|0xE235446CL
comma
l_int|0xF165B798L
comma
l_int|0x030E349BL
comma
l_int|0xD7C45070L
comma
l_int|0x25AFD373L
comma
l_int|0x36FF2087L
comma
l_int|0xC494A384L
comma
l_int|0x9A879FA0L
comma
l_int|0x68EC1CA3L
comma
l_int|0x7BBCEF57L
comma
l_int|0x89D76C54L
comma
l_int|0x5D1D08BFL
comma
l_int|0xAF768BBCL
comma
l_int|0xBC267848L
comma
l_int|0x4E4DFB4BL
comma
l_int|0x20BD8EDEL
comma
l_int|0xD2D60DDDL
comma
l_int|0xC186FE29L
comma
l_int|0x33ED7D2AL
comma
l_int|0xE72719C1L
comma
l_int|0x154C9AC2L
comma
l_int|0x061C6936L
comma
l_int|0xF477EA35L
comma
l_int|0xAA64D611L
comma
l_int|0x580F5512L
comma
l_int|0x4B5FA6E6L
comma
l_int|0xB93425E5L
comma
l_int|0x6DFE410EL
comma
l_int|0x9F95C20DL
comma
l_int|0x8CC531F9L
comma
l_int|0x7EAEB2FAL
comma
l_int|0x30E349B1L
comma
l_int|0xC288CAB2L
comma
l_int|0xD1D83946L
comma
l_int|0x23B3BA45L
comma
l_int|0xF779DEAEL
comma
l_int|0x05125DADL
comma
l_int|0x1642AE59L
comma
l_int|0xE4292D5AL
comma
l_int|0xBA3A117EL
comma
l_int|0x4851927DL
comma
l_int|0x5B016189L
comma
l_int|0xA96AE28AL
comma
l_int|0x7DA08661L
comma
l_int|0x8FCB0562L
comma
l_int|0x9C9BF696L
comma
l_int|0x6EF07595L
comma
l_int|0x417B1DBCL
comma
l_int|0xB3109EBFL
comma
l_int|0xA0406D4BL
comma
l_int|0x522BEE48L
comma
l_int|0x86E18AA3L
comma
l_int|0x748A09A0L
comma
l_int|0x67DAFA54L
comma
l_int|0x95B17957L
comma
l_int|0xCBA24573L
comma
l_int|0x39C9C670L
comma
l_int|0x2A993584L
comma
l_int|0xD8F2B687L
comma
l_int|0x0C38D26CL
comma
l_int|0xFE53516FL
comma
l_int|0xED03A29BL
comma
l_int|0x1F682198L
comma
l_int|0x5125DAD3L
comma
l_int|0xA34E59D0L
comma
l_int|0xB01EAA24L
comma
l_int|0x42752927L
comma
l_int|0x96BF4DCCL
comma
l_int|0x64D4CECFL
comma
l_int|0x77843D3BL
comma
l_int|0x85EFBE38L
comma
l_int|0xDBFC821CL
comma
l_int|0x2997011FL
comma
l_int|0x3AC7F2EBL
comma
l_int|0xC8AC71E8L
comma
l_int|0x1C661503L
comma
l_int|0xEE0D9600L
comma
l_int|0xFD5D65F4L
comma
l_int|0x0F36E6F7L
comma
l_int|0x61C69362L
comma
l_int|0x93AD1061L
comma
l_int|0x80FDE395L
comma
l_int|0x72966096L
comma
l_int|0xA65C047DL
comma
l_int|0x5437877EL
comma
l_int|0x4767748AL
comma
l_int|0xB50CF789L
comma
l_int|0xEB1FCBADL
comma
l_int|0x197448AEL
comma
l_int|0x0A24BB5AL
comma
l_int|0xF84F3859L
comma
l_int|0x2C855CB2L
comma
l_int|0xDEEEDFB1L
comma
l_int|0xCDBE2C45L
comma
l_int|0x3FD5AF46L
comma
l_int|0x7198540DL
comma
l_int|0x83F3D70EL
comma
l_int|0x90A324FAL
comma
l_int|0x62C8A7F9L
comma
l_int|0xB602C312L
comma
l_int|0x44694011L
comma
l_int|0x5739B3E5L
comma
l_int|0xA55230E6L
comma
l_int|0xFB410CC2L
comma
l_int|0x092A8FC1L
comma
l_int|0x1A7A7C35L
comma
l_int|0xE811FF36L
comma
l_int|0x3CDB9BDDL
comma
l_int|0xCEB018DEL
comma
l_int|0xDDE0EB2AL
comma
l_int|0x2F8B6829L
comma
l_int|0x82F63B78L
comma
l_int|0x709DB87BL
comma
l_int|0x63CD4B8FL
comma
l_int|0x91A6C88CL
comma
l_int|0x456CAC67L
comma
l_int|0xB7072F64L
comma
l_int|0xA457DC90L
comma
l_int|0x563C5F93L
comma
l_int|0x082F63B7L
comma
l_int|0xFA44E0B4L
comma
l_int|0xE9141340L
comma
l_int|0x1B7F9043L
comma
l_int|0xCFB5F4A8L
comma
l_int|0x3DDE77ABL
comma
l_int|0x2E8E845FL
comma
l_int|0xDCE5075CL
comma
l_int|0x92A8FC17L
comma
l_int|0x60C37F14L
comma
l_int|0x73938CE0L
comma
l_int|0x81F80FE3L
comma
l_int|0x55326B08L
comma
l_int|0xA759E80BL
comma
l_int|0xB4091BFFL
comma
l_int|0x466298FCL
comma
l_int|0x1871A4D8L
comma
l_int|0xEA1A27DBL
comma
l_int|0xF94AD42FL
comma
l_int|0x0B21572CL
comma
l_int|0xDFEB33C7L
comma
l_int|0x2D80B0C4L
comma
l_int|0x3ED04330L
comma
l_int|0xCCBBC033L
comma
l_int|0xA24BB5A6L
comma
l_int|0x502036A5L
comma
l_int|0x4370C551L
comma
l_int|0xB11B4652L
comma
l_int|0x65D122B9L
comma
l_int|0x97BAA1BAL
comma
l_int|0x84EA524EL
comma
l_int|0x7681D14DL
comma
l_int|0x2892ED69L
comma
l_int|0xDAF96E6AL
comma
l_int|0xC9A99D9EL
comma
l_int|0x3BC21E9DL
comma
l_int|0xEF087A76L
comma
l_int|0x1D63F975L
comma
l_int|0x0E330A81L
comma
l_int|0xFC588982L
comma
l_int|0xB21572C9L
comma
l_int|0x407EF1CAL
comma
l_int|0x532E023EL
comma
l_int|0xA145813DL
comma
l_int|0x758FE5D6L
comma
l_int|0x87E466D5L
comma
l_int|0x94B49521L
comma
l_int|0x66DF1622L
comma
l_int|0x38CC2A06L
comma
l_int|0xCAA7A905L
comma
l_int|0xD9F75AF1L
comma
l_int|0x2B9CD9F2L
comma
l_int|0xFF56BD19L
comma
l_int|0x0D3D3E1AL
comma
l_int|0x1E6DCDEEL
comma
l_int|0xEC064EEDL
comma
l_int|0xC38D26C4L
comma
l_int|0x31E6A5C7L
comma
l_int|0x22B65633L
comma
l_int|0xD0DDD530L
comma
l_int|0x0417B1DBL
comma
l_int|0xF67C32D8L
comma
l_int|0xE52CC12CL
comma
l_int|0x1747422FL
comma
l_int|0x49547E0BL
comma
l_int|0xBB3FFD08L
comma
l_int|0xA86F0EFCL
comma
l_int|0x5A048DFFL
comma
l_int|0x8ECEE914L
comma
l_int|0x7CA56A17L
comma
l_int|0x6FF599E3L
comma
l_int|0x9D9E1AE0L
comma
l_int|0xD3D3E1ABL
comma
l_int|0x21B862A8L
comma
l_int|0x32E8915CL
comma
l_int|0xC083125FL
comma
l_int|0x144976B4L
comma
l_int|0xE622F5B7L
comma
l_int|0xF5720643L
comma
l_int|0x07198540L
comma
l_int|0x590AB964L
comma
l_int|0xAB613A67L
comma
l_int|0xB831C993L
comma
l_int|0x4A5A4A90L
comma
l_int|0x9E902E7BL
comma
l_int|0x6CFBAD78L
comma
l_int|0x7FAB5E8CL
comma
l_int|0x8DC0DD8FL
comma
l_int|0xE330A81AL
comma
l_int|0x115B2B19L
comma
l_int|0x020BD8EDL
comma
l_int|0xF0605BEEL
comma
l_int|0x24AA3F05L
comma
l_int|0xD6C1BC06L
comma
l_int|0xC5914FF2L
comma
l_int|0x37FACCF1L
comma
l_int|0x69E9F0D5L
comma
l_int|0x9B8273D6L
comma
l_int|0x88D28022L
comma
l_int|0x7AB90321L
comma
l_int|0xAE7367CAL
comma
l_int|0x5C18E4C9L
comma
l_int|0x4F48173DL
comma
l_int|0xBD23943EL
comma
l_int|0xF36E6F75L
comma
l_int|0x0105EC76L
comma
l_int|0x12551F82L
comma
l_int|0xE03E9C81L
comma
l_int|0x34F4F86AL
comma
l_int|0xC69F7B69L
comma
l_int|0xD5CF889DL
comma
l_int|0x27A40B9EL
comma
l_int|0x79B737BAL
comma
l_int|0x8BDCB4B9L
comma
l_int|0x988C474DL
comma
l_int|0x6AE7C44EL
comma
l_int|0xBE2DA0A5L
comma
l_int|0x4C4623A6L
comma
l_int|0x5F16D052L
comma
l_int|0xAD7D5351L
comma
)brace
suffix:semicolon
r_uint32
DECL|function|count_crc
id|count_crc
c_func
(paren
r_uint8
op_star
id|buffer
comma
r_uint16
id|length
)paren
(brace
r_int
r_int
id|i
suffix:semicolon
r_int
r_int
id|crc32
op_assign
op_complement
l_int|0L
suffix:semicolon
r_int
r_int
id|result
suffix:semicolon
r_int
r_char
id|byte0
comma
id|byte1
comma
id|byte2
comma
id|byte3
suffix:semicolon
multiline_comment|/* Optimize this routine to be SCTP specific, knowing how&n;&t; * to skip the checksum field of the SCTP header.&n;&t; */
multiline_comment|/* Calculate CRC up to the checksum. */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
(paren
r_sizeof
(paren
r_struct
id|sctphdr
)paren
op_minus
r_sizeof
(paren
r_uint32
)paren
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
id|CRC32C
c_func
(paren
id|crc32
comma
id|buffer
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
multiline_comment|/* Skip checksum field of the header. */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
r_sizeof
(paren
r_uint32
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
id|CRC32C
c_func
(paren
id|crc32
comma
l_int|0
)paren
suffix:semicolon
)brace
multiline_comment|/* Calculate the rest of the CRC. */
r_for
c_loop
(paren
id|i
op_assign
r_sizeof
(paren
r_struct
id|sctphdr
)paren
suffix:semicolon
id|i
OL
id|length
suffix:semicolon
id|i
op_increment
)paren
(brace
id|CRC32C
c_func
(paren
id|crc32
comma
id|buffer
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
id|result
op_assign
op_complement
id|crc32
suffix:semicolon
multiline_comment|/*  result  now holds the negated polynomial remainder;&n;&t; *  since the table and algorithm is &quot;reflected&quot; [williams95].&n;&t; *  That is,  result has the same value as if we mapped the message&n;&t; *  to a polyomial, computed the host-bit-order polynomial&n;&t; *  remainder, performed final negation, then did an end-for-end&n;&t; *  bit-reversal.  &n;&t; *  Note that a 32-bit bit-reversal is identical to four inplace&n;&t; *  8-bit reversals followed by an end-for-end byteswap.&n;&t; *  In other words, the bytes of each bit are in the right order,&n;&t; *  but the bytes have been byteswapped.  So we now do an explicit&n;&t; *  byteswap.  On a little-endian machine, this byteswap and &n;&t; *  the final ntohl cancel out and could be elided.&n;&t; */
id|byte0
op_assign
id|result
op_amp
l_int|0xff
suffix:semicolon
id|byte1
op_assign
(paren
id|result
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
suffix:semicolon
id|byte2
op_assign
(paren
id|result
op_rshift
l_int|16
)paren
op_amp
l_int|0xff
suffix:semicolon
id|byte3
op_assign
(paren
id|result
op_rshift
l_int|24
)paren
op_amp
l_int|0xff
suffix:semicolon
id|crc32
op_assign
(paren
(paren
id|byte0
op_lshift
l_int|24
)paren
op_or
(paren
id|byte1
op_lshift
l_int|16
)paren
op_or
(paren
id|byte2
op_lshift
l_int|8
)paren
op_or
id|byte3
)paren
suffix:semicolon
r_return
id|crc32
suffix:semicolon
)brace
multiline_comment|/* count_crc() */
eof
