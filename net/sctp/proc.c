multiline_comment|/* SCTP kernel reference Implementation&n; * Copyright (c) 2003 International Business Machines, Corp.&n; *&n; * This file is part of the SCTP kernel reference Implementation&n; *&n; * The SCTP reference implementation is free software;&n; * you can redistribute it and/or modify it under the terms of&n; * the GNU General Public License as published by&n; * the Free Software Foundation; either version 2, or (at your option)&n; * any later version.&n; *&n; * The SCTP reference implementation is distributed in the hope that it&n; * will be useful, but WITHOUT ANY WARRANTY; without even the implied&n; *                 ************************&n; * warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.&n; * See the GNU General Public License for more details.&n; *&n; * You should have received a copy of the GNU General Public License&n; * along with GNU CC; see the file COPYING.  If not, write to&n; * the Free Software Foundation, 59 Temple Place - Suite 330,&n; * Boston, MA 02111-1307, USA.&n; *&n; * Please send any bug reports or fixes you make to the&n; * email address(es):&n; *    lksctp developers &lt;lksctp-developers@lists.sourceforge.net&gt;&n; *&n; * Or submit a bug report through the following website:&n; *    http://www.sf.net/projects/lksctp&n; *&n; * Written or modified by:&n; *    Sridhar Samudrala &lt;sri@us.ibm.com&gt;&n; *&n; * Any bugs reported given to us we will try to fix... any fixes shared will&n; * be incorporated into the next SCTP release.&n; */
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/seq_file.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;net/sctp/sctp.h&gt;
DECL|variable|sctp_snmp_list
r_static
r_char
op_star
id|sctp_snmp_list
(braket
)braket
op_assign
(brace
DECL|macro|SCTP_SNMP_ENTRY
mdefine_line|#define SCTP_SNMP_ENTRY(x) #x 
id|SCTP_SNMP_ENTRY
c_func
(paren
id|SctpCurrEstab
)paren
comma
id|SCTP_SNMP_ENTRY
c_func
(paren
id|SctpActiveEstabs
)paren
comma
id|SCTP_SNMP_ENTRY
c_func
(paren
id|SctpPassiveEstabs
)paren
comma
id|SCTP_SNMP_ENTRY
c_func
(paren
id|SctpAborteds
)paren
comma
id|SCTP_SNMP_ENTRY
c_func
(paren
id|SctpShutdowns
)paren
comma
id|SCTP_SNMP_ENTRY
c_func
(paren
id|SctpOutOfBlues
)paren
comma
id|SCTP_SNMP_ENTRY
c_func
(paren
id|SctpChecksumErrors
)paren
comma
id|SCTP_SNMP_ENTRY
c_func
(paren
id|SctpOutCtrlChunks
)paren
comma
id|SCTP_SNMP_ENTRY
c_func
(paren
id|SctpOutOrderChunks
)paren
comma
id|SCTP_SNMP_ENTRY
c_func
(paren
id|SctpOutUnorderChunks
)paren
comma
id|SCTP_SNMP_ENTRY
c_func
(paren
id|SctpInCtrlChunks
)paren
comma
id|SCTP_SNMP_ENTRY
c_func
(paren
id|SctpInOrderChunks
)paren
comma
id|SCTP_SNMP_ENTRY
c_func
(paren
id|SctpInUnorderChunks
)paren
comma
id|SCTP_SNMP_ENTRY
c_func
(paren
id|SctpFragUsrMsgs
)paren
comma
id|SCTP_SNMP_ENTRY
c_func
(paren
id|SctpReasmUsrMsgs
)paren
comma
id|SCTP_SNMP_ENTRY
c_func
(paren
id|SctpOutSCTPPacks
)paren
comma
id|SCTP_SNMP_ENTRY
c_func
(paren
id|SctpInSCTPPacks
)paren
comma
DECL|macro|SCTP_SNMP_ENTRY
macro_line|#undef SCTP_SNMP_ENTRY
)brace
suffix:semicolon
multiline_comment|/* Return the current value of a particular entry in the mib by adding its&n; * per cpu counters.&n; */
r_static
r_int
r_int
DECL|function|fold_field
id|fold_field
c_func
(paren
r_void
op_star
id|mib
(braket
)braket
comma
r_int
id|nr
)paren
(brace
r_int
r_int
id|res
op_assign
l_int|0
suffix:semicolon
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NR_CPUS
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|cpu_possible
c_func
(paren
id|i
)paren
)paren
r_continue
suffix:semicolon
id|res
op_add_assign
op_star
(paren
(paren
r_int
r_int
op_star
)paren
(paren
(paren
(paren
r_void
op_star
)paren
id|per_cpu_ptr
c_func
(paren
id|mib
(braket
l_int|0
)braket
comma
id|i
)paren
)paren
op_plus
r_sizeof
(paren
r_int
r_int
)paren
op_star
id|nr
)paren
)paren
suffix:semicolon
id|res
op_add_assign
op_star
(paren
(paren
r_int
r_int
op_star
)paren
(paren
(paren
(paren
r_void
op_star
)paren
id|per_cpu_ptr
c_func
(paren
id|mib
(braket
l_int|1
)braket
comma
id|i
)paren
)paren
op_plus
r_sizeof
(paren
r_int
r_int
)paren
op_star
id|nr
)paren
)paren
suffix:semicolon
)brace
r_return
id|res
suffix:semicolon
)brace
multiline_comment|/* Display sctp snmp mib statistics(/proc/net/sctp/snmp). */
DECL|function|sctp_snmp_seq_show
r_static
r_int
id|sctp_snmp_seq_show
c_func
(paren
r_struct
id|seq_file
op_star
id|seq
comma
r_void
op_star
id|v
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
r_sizeof
(paren
id|sctp_snmp_list
)paren
op_div
r_sizeof
(paren
r_char
op_star
)paren
suffix:semicolon
id|i
op_increment
)paren
id|seq_printf
c_func
(paren
id|seq
comma
l_string|&quot;%-32s&bslash;t%ld&bslash;n&quot;
comma
id|sctp_snmp_list
(braket
id|i
)braket
comma
id|fold_field
c_func
(paren
(paren
r_void
op_star
op_star
)paren
id|sctp_statistics
comma
id|i
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* Initialize the seq file operations for &squot;snmp&squot; object. */
DECL|function|sctp_snmp_seq_open
r_static
r_int
id|sctp_snmp_seq_open
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
(brace
r_return
id|single_open
c_func
(paren
id|file
comma
id|sctp_snmp_seq_show
comma
l_int|NULL
)paren
suffix:semicolon
)brace
DECL|variable|sctp_snmp_seq_fops
r_static
r_struct
id|file_operations
id|sctp_snmp_seq_fops
op_assign
(brace
dot
id|owner
op_assign
id|THIS_MODULE
comma
dot
id|open
op_assign
id|sctp_snmp_seq_open
comma
dot
id|read
op_assign
id|seq_read
comma
dot
id|llseek
op_assign
id|seq_lseek
comma
dot
id|release
op_assign
id|single_release
comma
)brace
suffix:semicolon
multiline_comment|/* Set up the proc fs entry for &squot;snmp&squot; object. */
DECL|function|sctp_snmp_proc_init
r_int
id|__init
id|sctp_snmp_proc_init
c_func
(paren
r_void
)paren
(brace
r_struct
id|proc_dir_entry
op_star
id|p
suffix:semicolon
id|p
op_assign
id|create_proc_entry
c_func
(paren
l_string|&quot;snmp&quot;
comma
id|S_IRUGO
comma
id|proc_net_sctp
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|p
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|p-&gt;proc_fops
op_assign
op_amp
id|sctp_snmp_seq_fops
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* Cleanup the proc fs entry for &squot;snmp&squot; object. */
DECL|function|sctp_snmp_proc_exit
r_void
id|sctp_snmp_proc_exit
c_func
(paren
r_void
)paren
(brace
id|remove_proc_entry
c_func
(paren
l_string|&quot;snmp&quot;
comma
id|proc_net_sctp
)paren
suffix:semicolon
)brace
multiline_comment|/* Dump local addresses of an association/endpoint. */
DECL|function|sctp_seq_dump_local_addrs
r_static
r_void
id|sctp_seq_dump_local_addrs
c_func
(paren
r_struct
id|seq_file
op_star
id|seq
comma
r_struct
id|sctp_ep_common
op_star
id|epb
)paren
(brace
r_struct
id|list_head
op_star
id|pos
suffix:semicolon
r_struct
id|sockaddr_storage_list
op_star
id|laddr
suffix:semicolon
r_union
id|sctp_addr
op_star
id|addr
suffix:semicolon
r_struct
id|sctp_af
op_star
id|af
suffix:semicolon
id|list_for_each
c_func
(paren
id|pos
comma
op_amp
id|epb-&gt;bind_addr.address_list
)paren
(brace
id|laddr
op_assign
id|list_entry
c_func
(paren
id|pos
comma
r_struct
id|sockaddr_storage_list
comma
id|list
)paren
suffix:semicolon
id|addr
op_assign
(paren
r_union
id|sctp_addr
op_star
)paren
op_amp
id|laddr-&gt;a
suffix:semicolon
id|af
op_assign
id|sctp_get_af_specific
c_func
(paren
id|addr-&gt;sa.sa_family
)paren
suffix:semicolon
id|af
op_member_access_from_pointer
id|seq_dump_addr
c_func
(paren
id|seq
comma
id|addr
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* Dump remote addresses of an association. */
DECL|function|sctp_seq_dump_remote_addrs
r_static
r_void
id|sctp_seq_dump_remote_addrs
c_func
(paren
r_struct
id|seq_file
op_star
id|seq
comma
r_struct
id|sctp_association
op_star
id|assoc
)paren
(brace
r_struct
id|list_head
op_star
id|pos
suffix:semicolon
r_struct
id|sctp_transport
op_star
id|transport
suffix:semicolon
r_union
id|sctp_addr
op_star
id|addr
suffix:semicolon
r_struct
id|sctp_af
op_star
id|af
suffix:semicolon
id|list_for_each
c_func
(paren
id|pos
comma
op_amp
id|assoc-&gt;peer.transport_addr_list
)paren
(brace
id|transport
op_assign
id|list_entry
c_func
(paren
id|pos
comma
r_struct
id|sctp_transport
comma
id|transports
)paren
suffix:semicolon
id|addr
op_assign
(paren
r_union
id|sctp_addr
op_star
)paren
op_amp
id|transport-&gt;ipaddr
suffix:semicolon
id|af
op_assign
id|sctp_get_af_specific
c_func
(paren
id|addr-&gt;sa.sa_family
)paren
suffix:semicolon
id|af
op_member_access_from_pointer
id|seq_dump_addr
c_func
(paren
id|seq
comma
id|addr
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* Display sctp endpoints (/proc/net/sctp/eps). */
DECL|function|sctp_eps_seq_show
r_static
r_int
id|sctp_eps_seq_show
c_func
(paren
r_struct
id|seq_file
op_star
id|seq
comma
r_void
op_star
id|v
)paren
(brace
r_struct
id|sctp_hashbucket
op_star
id|head
suffix:semicolon
r_struct
id|sctp_ep_common
op_star
id|epb
suffix:semicolon
r_struct
id|sctp_endpoint
op_star
id|ep
suffix:semicolon
r_struct
id|sock
op_star
id|sk
suffix:semicolon
r_int
id|hash
suffix:semicolon
id|seq_printf
c_func
(paren
id|seq
comma
l_string|&quot; ENDPT     SOCK   STY SST HBKT LPORT LADDRS&bslash;n&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|hash
op_assign
l_int|0
suffix:semicolon
id|hash
OL
id|sctp_ep_hashsize
suffix:semicolon
id|hash
op_increment
)paren
(brace
id|head
op_assign
op_amp
id|sctp_ep_hashbucket
(braket
id|hash
)braket
suffix:semicolon
id|read_lock
c_func
(paren
op_amp
id|head-&gt;lock
)paren
suffix:semicolon
r_for
c_loop
(paren
id|epb
op_assign
id|head-&gt;chain
suffix:semicolon
id|epb
suffix:semicolon
id|epb
op_assign
id|epb-&gt;next
)paren
(brace
id|ep
op_assign
id|sctp_ep
c_func
(paren
id|epb
)paren
suffix:semicolon
id|sk
op_assign
id|epb-&gt;sk
suffix:semicolon
id|seq_printf
c_func
(paren
id|seq
comma
l_string|&quot;%8p %8p %-3d %-3d %-4d %-5d &quot;
comma
id|ep
comma
id|sk
comma
id|sctp_sk
c_func
(paren
id|sk
)paren
op_member_access_from_pointer
id|type
comma
id|sk-&gt;state
comma
id|hash
comma
id|epb-&gt;bind_addr.port
)paren
suffix:semicolon
id|sctp_seq_dump_local_addrs
c_func
(paren
id|seq
comma
id|epb
)paren
suffix:semicolon
id|seq_printf
c_func
(paren
id|seq
comma
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|read_unlock
c_func
(paren
op_amp
id|head-&gt;lock
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* Initialize the seq file operations for &squot;eps&squot; object. */
DECL|function|sctp_eps_seq_open
r_static
r_int
id|sctp_eps_seq_open
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
(brace
r_return
id|single_open
c_func
(paren
id|file
comma
id|sctp_eps_seq_show
comma
l_int|NULL
)paren
suffix:semicolon
)brace
DECL|variable|sctp_eps_seq_fops
r_static
r_struct
id|file_operations
id|sctp_eps_seq_fops
op_assign
(brace
dot
id|open
op_assign
id|sctp_eps_seq_open
comma
dot
id|read
op_assign
id|seq_read
comma
dot
id|llseek
op_assign
id|seq_lseek
comma
dot
id|release
op_assign
id|single_release
comma
)brace
suffix:semicolon
multiline_comment|/* Set up the proc fs entry for &squot;eps&squot; object. */
DECL|function|sctp_eps_proc_init
r_int
id|__init
id|sctp_eps_proc_init
c_func
(paren
r_void
)paren
(brace
r_struct
id|proc_dir_entry
op_star
id|p
suffix:semicolon
id|p
op_assign
id|create_proc_entry
c_func
(paren
l_string|&quot;eps&quot;
comma
id|S_IRUGO
comma
id|proc_net_sctp
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|p
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|p-&gt;proc_fops
op_assign
op_amp
id|sctp_eps_seq_fops
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* Cleanup the proc fs entry for &squot;eps&squot; object. */
DECL|function|sctp_eps_proc_exit
r_void
id|sctp_eps_proc_exit
c_func
(paren
r_void
)paren
(brace
id|remove_proc_entry
c_func
(paren
l_string|&quot;eps&quot;
comma
id|proc_net_sctp
)paren
suffix:semicolon
)brace
multiline_comment|/* Display sctp associations (/proc/net/sctp/assocs). */
DECL|function|sctp_assocs_seq_show
r_static
r_int
id|sctp_assocs_seq_show
c_func
(paren
r_struct
id|seq_file
op_star
id|seq
comma
r_void
op_star
id|v
)paren
(brace
r_struct
id|sctp_hashbucket
op_star
id|head
suffix:semicolon
r_struct
id|sctp_ep_common
op_star
id|epb
suffix:semicolon
r_struct
id|sctp_association
op_star
id|assoc
suffix:semicolon
r_struct
id|sock
op_star
id|sk
suffix:semicolon
r_int
id|hash
suffix:semicolon
id|seq_printf
c_func
(paren
id|seq
comma
l_string|&quot; ASSOC     SOCK   STY SST ST HBKT LPORT RPORT &quot;
l_string|&quot;LADDRS &lt;-&gt; RADDRS&bslash;n&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|hash
op_assign
l_int|0
suffix:semicolon
id|hash
OL
id|sctp_assoc_hashsize
suffix:semicolon
id|hash
op_increment
)paren
(brace
id|head
op_assign
op_amp
id|sctp_assoc_hashbucket
(braket
id|hash
)braket
suffix:semicolon
id|read_lock
c_func
(paren
op_amp
id|head-&gt;lock
)paren
suffix:semicolon
r_for
c_loop
(paren
id|epb
op_assign
id|head-&gt;chain
suffix:semicolon
id|epb
suffix:semicolon
id|epb
op_assign
id|epb-&gt;next
)paren
(brace
id|assoc
op_assign
id|sctp_assoc
c_func
(paren
id|epb
)paren
suffix:semicolon
id|sk
op_assign
id|epb-&gt;sk
suffix:semicolon
id|seq_printf
c_func
(paren
id|seq
comma
l_string|&quot;%8p %8p %-3d %-3d %-2d %-4d %-5d %-5d &quot;
comma
id|assoc
comma
id|sk
comma
id|sctp_sk
c_func
(paren
id|sk
)paren
op_member_access_from_pointer
id|type
comma
id|sk-&gt;state
comma
id|assoc-&gt;state
comma
id|hash
comma
id|epb-&gt;bind_addr.port
comma
id|assoc-&gt;peer.port
)paren
suffix:semicolon
id|sctp_seq_dump_local_addrs
c_func
(paren
id|seq
comma
id|epb
)paren
suffix:semicolon
id|seq_printf
c_func
(paren
id|seq
comma
l_string|&quot;&lt;-&gt; &quot;
)paren
suffix:semicolon
id|sctp_seq_dump_remote_addrs
c_func
(paren
id|seq
comma
id|assoc
)paren
suffix:semicolon
id|seq_printf
c_func
(paren
id|seq
comma
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|read_unlock
c_func
(paren
op_amp
id|head-&gt;lock
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* Initialize the seq file operations for &squot;assocs&squot; object. */
DECL|function|sctp_assocs_seq_open
r_static
r_int
id|sctp_assocs_seq_open
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
(brace
r_return
id|single_open
c_func
(paren
id|file
comma
id|sctp_assocs_seq_show
comma
l_int|NULL
)paren
suffix:semicolon
)brace
DECL|variable|sctp_assocs_seq_fops
r_static
r_struct
id|file_operations
id|sctp_assocs_seq_fops
op_assign
(brace
dot
id|open
op_assign
id|sctp_assocs_seq_open
comma
dot
id|read
op_assign
id|seq_read
comma
dot
id|llseek
op_assign
id|seq_lseek
comma
dot
id|release
op_assign
id|single_release
comma
)brace
suffix:semicolon
multiline_comment|/* Set up the proc fs entry for &squot;assocs&squot; object. */
DECL|function|sctp_assocs_proc_init
r_int
id|__init
id|sctp_assocs_proc_init
c_func
(paren
r_void
)paren
(brace
r_struct
id|proc_dir_entry
op_star
id|p
suffix:semicolon
id|p
op_assign
id|create_proc_entry
c_func
(paren
l_string|&quot;assocs&quot;
comma
id|S_IRUGO
comma
id|proc_net_sctp
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|p
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|p-&gt;proc_fops
op_assign
op_amp
id|sctp_assocs_seq_fops
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* Cleanup the proc fs entry for &squot;assocs&squot; object. */
DECL|function|sctp_assocs_proc_exit
r_void
id|sctp_assocs_proc_exit
c_func
(paren
r_void
)paren
(brace
id|remove_proc_entry
c_func
(paren
l_string|&quot;assocs&quot;
comma
id|proc_net_sctp
)paren
suffix:semicolon
)brace
eof
