multiline_comment|/*&n; * DECnet       An implementation of the DECnet protocol suite for the LINUX&n; *              operating system.  DECnet is implemented using the  BSD Socket&n; *              interface as the means of communication with the user level.&n; *&n; *              DECnet Routing Functions (Endnode and Router)&n; *&n; * Authors:     Steve Whitehouse &lt;SteveW@ACM.org&gt;&n; *              Eduardo Marcelo Serrat &lt;emserrat@geocities.com&gt;&n; *&n; * Changes:&n; *              Steve Whitehouse : Fixes to allow &quot;intra-ethernet&quot; and&n; *                                 &quot;return-to-sender&quot; bits on outgoing&n; *                                 packets.&n; *&t;&t;Steve Whitehouse : Timeouts for cached routes.&n; *              Steve Whitehouse : Use dst cache for input routes too.&n; *              Steve Whitehouse : Fixed error values in dn_send_skb.&n; *              Steve Whitehouse : Rework routing functions to better fit&n; *                                 DECnet routing design&n; *              Alexey Kuznetsov : New SMP locking&n; *              Steve Whitehouse : More SMP locking changes &amp; dn_cache_dump()&n; *              Steve Whitehouse : Prerouting NF hook, now really is prerouting.&n; *&t;&t;&t;&t;   Fixed possible skb leak in rtnetlink funcs.&n; *              Steve Whitehouse : Dave Miller&squot;s dynamic hash table sizing and&n; *                                 Alexey Kuznetsov&squot;s finer grained locking&n; *                                 from ipv4/route.c.&n; *              Steve Whitehouse : Routing is now starting to look like a&n; *                                 sensible set of code now, mainly due to&n; *                                 my copying the IPv4 routing code. The&n; *                                 hooks here are modified and will continue&n; *                                 to evolve for a while.&n; *              Steve Whitehouse : Real SMP at last :-) Also new netfilter&n; *                                 stuff. Look out raw sockets your days&n; *                                 are numbered!&n; *              Steve Whitehouse : Added return-to-sender functions. Added&n; *                                 backlog congestion level return codes.&n; *&t;&t;Steve Whitehouse : Fixed bug where routes were set up with&n; *                                 no ref count on net devices.&n; *              Steve Whitehouse : RCU for the route cache&n; *              Steve Whitehouse : Preparations for the flow cache&n; *              Steve Whitehouse : Prepare for nonlinear skbs&n; */
multiline_comment|/******************************************************************************&n;    (c) 1995-1998 E.M. Serrat&t;&t;emserrat@geocities.com&n;    &n;    This program is free software; you can redistribute it and/or modify&n;    it under the terms of the GNU General Public License as published by&n;    the Free Software Foundation; either version 2 of the License, or&n;    any later version.&n;&n;    This program is distributed in the hope that it will be useful,&n;    but WITHOUT ANY WARRANTY; without even the implied warranty of&n;    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n;    GNU General Public License for more details.&n;*******************************************************************************/
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/socket.h&gt;
macro_line|#include &lt;linux/in.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/sockios.h&gt;
macro_line|#include &lt;linux/net.h&gt;
macro_line|#include &lt;linux/netdevice.h&gt;
macro_line|#include &lt;linux/inet.h&gt;
macro_line|#include &lt;linux/route.h&gt;
macro_line|#include &lt;linux/in_route.h&gt;
macro_line|#include &lt;net/sock.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/proc_fs.h&gt;
macro_line|#include &lt;linux/seq_file.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/rtnetlink.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/netfilter_decnet.h&gt;
macro_line|#include &lt;linux/rcupdate.h&gt;
macro_line|#include &lt;linux/times.h&gt;
macro_line|#include &lt;asm/errno.h&gt;
macro_line|#include &lt;net/neighbour.h&gt;
macro_line|#include &lt;net/dst.h&gt;
macro_line|#include &lt;net/flow.h&gt;
macro_line|#include &lt;net/dn.h&gt;
macro_line|#include &lt;net/dn_dev.h&gt;
macro_line|#include &lt;net/dn_nsp.h&gt;
macro_line|#include &lt;net/dn_route.h&gt;
macro_line|#include &lt;net/dn_neigh.h&gt;
macro_line|#include &lt;net/dn_fib.h&gt;
DECL|struct|dn_rt_hash_bucket
r_struct
id|dn_rt_hash_bucket
(brace
DECL|member|chain
r_struct
id|dn_route
op_star
id|chain
suffix:semicolon
DECL|member|lock
id|spinlock_t
id|lock
suffix:semicolon
)brace
id|__attribute__
c_func
(paren
(paren
id|__aligned__
c_func
(paren
l_int|8
)paren
)paren
)paren
suffix:semicolon
r_extern
r_struct
id|neigh_table
id|dn_neigh_table
suffix:semicolon
DECL|variable|dn_hiord_addr
r_static
r_int
r_char
id|dn_hiord_addr
(braket
l_int|6
)braket
op_assign
(brace
l_int|0xAA
comma
l_int|0x00
comma
l_int|0x04
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
)brace
suffix:semicolon
DECL|variable|dn_rt_min_delay
r_int
id|dn_rt_min_delay
op_assign
l_int|2
op_star
id|HZ
suffix:semicolon
DECL|variable|dn_rt_max_delay
r_int
id|dn_rt_max_delay
op_assign
l_int|10
op_star
id|HZ
suffix:semicolon
DECL|variable|dn_rt_mtu_expires
r_int
id|dn_rt_mtu_expires
op_assign
l_int|10
op_star
l_int|60
op_star
id|HZ
suffix:semicolon
DECL|variable|dn_rt_deadline
r_static
r_int
r_int
id|dn_rt_deadline
suffix:semicolon
r_static
r_int
id|dn_dst_gc
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_struct
id|dst_entry
op_star
id|dn_dst_check
c_func
(paren
r_struct
id|dst_entry
op_star
comma
id|__u32
)paren
suffix:semicolon
r_static
r_struct
id|dst_entry
op_star
id|dn_dst_negative_advice
c_func
(paren
r_struct
id|dst_entry
op_star
)paren
suffix:semicolon
r_static
r_void
id|dn_dst_link_failure
c_func
(paren
r_struct
id|sk_buff
op_star
)paren
suffix:semicolon
r_static
r_void
id|dn_dst_update_pmtu
c_func
(paren
r_struct
id|dst_entry
op_star
id|dst
comma
id|u32
id|mtu
)paren
suffix:semicolon
r_static
r_int
id|dn_route_input
c_func
(paren
r_struct
id|sk_buff
op_star
)paren
suffix:semicolon
r_static
r_void
id|dn_run_flush
c_func
(paren
r_int
r_int
id|dummy
)paren
suffix:semicolon
DECL|variable|dn_rt_hash_table
r_static
r_struct
id|dn_rt_hash_bucket
op_star
id|dn_rt_hash_table
suffix:semicolon
DECL|variable|dn_rt_hash_mask
r_static
r_int
id|dn_rt_hash_mask
suffix:semicolon
DECL|variable|dn_route_timer
r_static
r_struct
id|timer_list
id|dn_route_timer
suffix:semicolon
DECL|variable|dn_rt_flush_timer
r_static
r_struct
id|timer_list
id|dn_rt_flush_timer
op_assign
id|TIMER_INITIALIZER
c_func
(paren
id|dn_run_flush
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
DECL|variable|decnet_dst_gc_interval
r_int
id|decnet_dst_gc_interval
op_assign
l_int|2
suffix:semicolon
DECL|variable|dn_dst_ops
r_static
r_struct
id|dst_ops
id|dn_dst_ops
op_assign
(brace
dot
id|family
op_assign
id|PF_DECnet
comma
dot
id|protocol
op_assign
id|__constant_htons
c_func
(paren
id|ETH_P_DNA_RT
)paren
comma
dot
id|gc_thresh
op_assign
l_int|128
comma
dot
id|gc
op_assign
id|dn_dst_gc
comma
dot
id|check
op_assign
id|dn_dst_check
comma
dot
id|negative_advice
op_assign
id|dn_dst_negative_advice
comma
dot
id|link_failure
op_assign
id|dn_dst_link_failure
comma
dot
id|update_pmtu
op_assign
id|dn_dst_update_pmtu
comma
dot
id|entry_size
op_assign
r_sizeof
(paren
r_struct
id|dn_route
)paren
comma
dot
id|entries
op_assign
id|ATOMIC_INIT
c_func
(paren
l_int|0
)paren
comma
)brace
suffix:semicolon
DECL|function|dn_hash
r_static
id|__inline__
r_int
id|dn_hash
c_func
(paren
r_int
r_int
id|src
comma
r_int
r_int
id|dst
)paren
(brace
r_int
r_int
id|tmp
op_assign
id|src
op_xor
id|dst
suffix:semicolon
id|tmp
op_xor_assign
(paren
id|tmp
op_rshift
l_int|3
)paren
suffix:semicolon
id|tmp
op_xor_assign
(paren
id|tmp
op_rshift
l_int|5
)paren
suffix:semicolon
id|tmp
op_xor_assign
(paren
id|tmp
op_rshift
l_int|10
)paren
suffix:semicolon
r_return
id|dn_rt_hash_mask
op_amp
(paren
r_int
)paren
id|tmp
suffix:semicolon
)brace
DECL|function|dnrt_free
r_static
r_inline
r_void
id|dnrt_free
c_func
(paren
r_struct
id|dn_route
op_star
id|rt
)paren
(brace
id|call_rcu_bh
c_func
(paren
op_amp
id|rt-&gt;u.dst.rcu_head
comma
id|dst_rcu_free
)paren
suffix:semicolon
)brace
DECL|function|dnrt_drop
r_static
r_inline
r_void
id|dnrt_drop
c_func
(paren
r_struct
id|dn_route
op_star
id|rt
)paren
(brace
r_if
c_cond
(paren
id|rt
)paren
id|dst_release
c_func
(paren
op_amp
id|rt-&gt;u.dst
)paren
suffix:semicolon
id|call_rcu_bh
c_func
(paren
op_amp
id|rt-&gt;u.dst.rcu_head
comma
id|dst_rcu_free
)paren
suffix:semicolon
)brace
DECL|function|dn_dst_check_expire
r_static
r_void
id|dn_dst_check_expire
c_func
(paren
r_int
r_int
id|dummy
)paren
(brace
r_int
id|i
suffix:semicolon
r_struct
id|dn_route
op_star
id|rt
comma
op_star
op_star
id|rtp
suffix:semicolon
r_int
r_int
id|now
op_assign
id|jiffies
suffix:semicolon
r_int
r_int
id|expire
op_assign
l_int|120
op_star
id|HZ
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
op_le
id|dn_rt_hash_mask
suffix:semicolon
id|i
op_increment
)paren
(brace
id|rtp
op_assign
op_amp
id|dn_rt_hash_table
(braket
id|i
)braket
dot
id|chain
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|dn_rt_hash_table
(braket
id|i
)braket
dot
id|lock
)paren
suffix:semicolon
r_while
c_loop
(paren
(paren
id|rt
op_assign
op_star
id|rtp
)paren
op_ne
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
id|atomic_read
c_func
(paren
op_amp
id|rt-&gt;u.dst.__refcnt
)paren
op_logical_or
(paren
id|now
op_minus
id|rt-&gt;u.dst.lastuse
)paren
OL
id|expire
)paren
(brace
id|rtp
op_assign
op_amp
id|rt-&gt;u.rt_next
suffix:semicolon
r_continue
suffix:semicolon
)brace
op_star
id|rtp
op_assign
id|rt-&gt;u.rt_next
suffix:semicolon
id|rt-&gt;u.rt_next
op_assign
l_int|NULL
suffix:semicolon
id|dnrt_free
c_func
(paren
id|rt
)paren
suffix:semicolon
)brace
id|spin_unlock
c_func
(paren
op_amp
id|dn_rt_hash_table
(braket
id|i
)braket
dot
id|lock
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|jiffies
op_minus
id|now
)paren
OG
l_int|0
)paren
r_break
suffix:semicolon
)brace
id|mod_timer
c_func
(paren
op_amp
id|dn_route_timer
comma
id|now
op_plus
id|decnet_dst_gc_interval
op_star
id|HZ
)paren
suffix:semicolon
)brace
DECL|function|dn_dst_gc
r_static
r_int
id|dn_dst_gc
c_func
(paren
r_void
)paren
(brace
r_struct
id|dn_route
op_star
id|rt
comma
op_star
op_star
id|rtp
suffix:semicolon
r_int
id|i
suffix:semicolon
r_int
r_int
id|now
op_assign
id|jiffies
suffix:semicolon
r_int
r_int
id|expire
op_assign
l_int|10
op_star
id|HZ
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
op_le
id|dn_rt_hash_mask
suffix:semicolon
id|i
op_increment
)paren
(brace
id|spin_lock_bh
c_func
(paren
op_amp
id|dn_rt_hash_table
(braket
id|i
)braket
dot
id|lock
)paren
suffix:semicolon
id|rtp
op_assign
op_amp
id|dn_rt_hash_table
(braket
id|i
)braket
dot
id|chain
suffix:semicolon
r_while
c_loop
(paren
(paren
id|rt
op_assign
op_star
id|rtp
)paren
op_ne
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
id|atomic_read
c_func
(paren
op_amp
id|rt-&gt;u.dst.__refcnt
)paren
op_logical_or
(paren
id|now
op_minus
id|rt-&gt;u.dst.lastuse
)paren
OL
id|expire
)paren
(brace
id|rtp
op_assign
op_amp
id|rt-&gt;u.rt_next
suffix:semicolon
r_continue
suffix:semicolon
)brace
op_star
id|rtp
op_assign
id|rt-&gt;u.rt_next
suffix:semicolon
id|rt-&gt;u.rt_next
op_assign
l_int|NULL
suffix:semicolon
id|dnrt_drop
c_func
(paren
id|rt
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|spin_unlock_bh
c_func
(paren
op_amp
id|dn_rt_hash_table
(braket
id|i
)braket
dot
id|lock
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * The decnet standards don&squot;t impose a particular minimum mtu, what they&n; * do insist on is that the routing layer accepts a datagram of at least&n; * 230 bytes long. Here we have to subtract the routing header length from&n; * 230 to get the minimum acceptable mtu. If there is no neighbour, then we&n; * assume the worst and use a long header size.&n; *&n; * We update both the mtu and the advertised mss (i.e. the segment size we&n; * advertise to the other end).&n; */
DECL|function|dn_dst_update_pmtu
r_static
r_void
id|dn_dst_update_pmtu
c_func
(paren
r_struct
id|dst_entry
op_star
id|dst
comma
id|u32
id|mtu
)paren
(brace
id|u32
id|min_mtu
op_assign
l_int|230
suffix:semicolon
r_struct
id|dn_dev
op_star
id|dn
op_assign
id|dst-&gt;neighbour
ques
c_cond
(paren
r_struct
id|dn_dev
op_star
)paren
id|dst-&gt;neighbour-&gt;dev-&gt;dn_ptr
suffix:colon
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|dn
op_logical_and
id|dn-&gt;use_long
op_eq
l_int|0
)paren
id|min_mtu
op_sub_assign
l_int|6
suffix:semicolon
r_else
id|min_mtu
op_sub_assign
l_int|21
suffix:semicolon
r_if
c_cond
(paren
id|dst-&gt;metrics
(braket
id|RTAX_MTU
op_minus
l_int|1
)braket
OG
id|mtu
op_logical_and
id|mtu
op_ge
id|min_mtu
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|dst_metric_locked
c_func
(paren
id|dst
comma
id|RTAX_MTU
)paren
)paren
)paren
(brace
id|dst-&gt;metrics
(braket
id|RTAX_MTU
op_minus
l_int|1
)braket
op_assign
id|mtu
suffix:semicolon
id|dst_set_expires
c_func
(paren
id|dst
comma
id|dn_rt_mtu_expires
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|dst_metric_locked
c_func
(paren
id|dst
comma
id|RTAX_ADVMSS
)paren
)paren
)paren
(brace
id|u32
id|mss
op_assign
id|mtu
op_minus
id|DN_MAX_NSP_DATA_HEADER
suffix:semicolon
r_if
c_cond
(paren
id|dst-&gt;metrics
(braket
id|RTAX_ADVMSS
op_minus
l_int|1
)braket
OG
id|mss
)paren
id|dst-&gt;metrics
(braket
id|RTAX_ADVMSS
op_minus
l_int|1
)braket
op_assign
id|mss
suffix:semicolon
)brace
)brace
)brace
multiline_comment|/* &n; * When a route has been marked obsolete. (e.g. routing cache flush)&n; */
DECL|function|dn_dst_check
r_static
r_struct
id|dst_entry
op_star
id|dn_dst_check
c_func
(paren
r_struct
id|dst_entry
op_star
id|dst
comma
id|__u32
id|cookie
)paren
(brace
id|dst_release
c_func
(paren
id|dst
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
DECL|function|dn_dst_negative_advice
r_static
r_struct
id|dst_entry
op_star
id|dn_dst_negative_advice
c_func
(paren
r_struct
id|dst_entry
op_star
id|dst
)paren
(brace
id|dst_release
c_func
(paren
id|dst
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
DECL|function|dn_dst_link_failure
r_static
r_void
id|dn_dst_link_failure
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_return
suffix:semicolon
)brace
DECL|function|compare_keys
r_static
r_inline
r_int
id|compare_keys
c_func
(paren
r_struct
id|flowi
op_star
id|fl1
comma
r_struct
id|flowi
op_star
id|fl2
)paren
(brace
r_return
id|memcmp
c_func
(paren
op_amp
id|fl1-&gt;nl_u.dn_u
comma
op_amp
id|fl2-&gt;nl_u.dn_u
comma
r_sizeof
(paren
id|fl1-&gt;nl_u.dn_u
)paren
)paren
op_eq
l_int|0
op_logical_and
id|fl1-&gt;oif
op_eq
id|fl2-&gt;oif
op_logical_and
id|fl1-&gt;iif
op_eq
id|fl2-&gt;iif
suffix:semicolon
)brace
DECL|function|dn_insert_route
r_static
r_int
id|dn_insert_route
c_func
(paren
r_struct
id|dn_route
op_star
id|rt
comma
r_int
id|hash
comma
r_struct
id|dn_route
op_star
op_star
id|rp
)paren
(brace
r_struct
id|dn_route
op_star
id|rth
comma
op_star
op_star
id|rthp
suffix:semicolon
r_int
r_int
id|now
op_assign
id|jiffies
suffix:semicolon
id|rthp
op_assign
op_amp
id|dn_rt_hash_table
(braket
id|hash
)braket
dot
id|chain
suffix:semicolon
id|spin_lock_bh
c_func
(paren
op_amp
id|dn_rt_hash_table
(braket
id|hash
)braket
dot
id|lock
)paren
suffix:semicolon
r_while
c_loop
(paren
(paren
id|rth
op_assign
op_star
id|rthp
)paren
op_ne
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
id|compare_keys
c_func
(paren
op_amp
id|rth-&gt;fl
comma
op_amp
id|rt-&gt;fl
)paren
)paren
(brace
multiline_comment|/* Put it first */
op_star
id|rthp
op_assign
id|rth-&gt;u.rt_next
suffix:semicolon
id|rcu_assign_pointer
c_func
(paren
id|rth-&gt;u.rt_next
comma
id|dn_rt_hash_table
(braket
id|hash
)braket
dot
id|chain
)paren
suffix:semicolon
id|rcu_assign_pointer
c_func
(paren
id|dn_rt_hash_table
(braket
id|hash
)braket
dot
id|chain
comma
id|rth
)paren
suffix:semicolon
id|rth-&gt;u.dst.__use
op_increment
suffix:semicolon
id|dst_hold
c_func
(paren
op_amp
id|rth-&gt;u.dst
)paren
suffix:semicolon
id|rth-&gt;u.dst.lastuse
op_assign
id|now
suffix:semicolon
id|spin_unlock_bh
c_func
(paren
op_amp
id|dn_rt_hash_table
(braket
id|hash
)braket
dot
id|lock
)paren
suffix:semicolon
id|dnrt_drop
c_func
(paren
id|rt
)paren
suffix:semicolon
op_star
id|rp
op_assign
id|rth
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|rthp
op_assign
op_amp
id|rth-&gt;u.rt_next
suffix:semicolon
)brace
id|rcu_assign_pointer
c_func
(paren
id|rt-&gt;u.rt_next
comma
id|dn_rt_hash_table
(braket
id|hash
)braket
dot
id|chain
)paren
suffix:semicolon
id|rcu_assign_pointer
c_func
(paren
id|dn_rt_hash_table
(braket
id|hash
)braket
dot
id|chain
comma
id|rt
)paren
suffix:semicolon
id|dst_hold
c_func
(paren
op_amp
id|rt-&gt;u.dst
)paren
suffix:semicolon
id|rt-&gt;u.dst.__use
op_increment
suffix:semicolon
id|rt-&gt;u.dst.lastuse
op_assign
id|now
suffix:semicolon
id|spin_unlock_bh
c_func
(paren
op_amp
id|dn_rt_hash_table
(braket
id|hash
)braket
dot
id|lock
)paren
suffix:semicolon
op_star
id|rp
op_assign
id|rt
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dn_run_flush
r_void
id|dn_run_flush
c_func
(paren
r_int
r_int
id|dummy
)paren
(brace
r_int
id|i
suffix:semicolon
r_struct
id|dn_route
op_star
id|rt
comma
op_star
id|next
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|dn_rt_hash_mask
suffix:semicolon
id|i
op_increment
)paren
(brace
id|spin_lock_bh
c_func
(paren
op_amp
id|dn_rt_hash_table
(braket
id|i
)braket
dot
id|lock
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|rt
op_assign
id|xchg
c_func
(paren
op_amp
id|dn_rt_hash_table
(braket
id|i
)braket
dot
id|chain
comma
l_int|NULL
)paren
)paren
op_eq
l_int|NULL
)paren
r_goto
id|nothing_to_declare
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
id|rt
suffix:semicolon
id|rt
op_assign
id|next
)paren
(brace
id|next
op_assign
id|rt-&gt;u.rt_next
suffix:semicolon
id|rt-&gt;u.rt_next
op_assign
l_int|NULL
suffix:semicolon
id|dst_free
c_func
(paren
(paren
r_struct
id|dst_entry
op_star
)paren
id|rt
)paren
suffix:semicolon
)brace
id|nothing_to_declare
suffix:colon
id|spin_unlock_bh
c_func
(paren
op_amp
id|dn_rt_hash_table
(braket
id|i
)braket
dot
id|lock
)paren
suffix:semicolon
)brace
)brace
r_static
id|DEFINE_SPINLOCK
c_func
(paren
id|dn_rt_flush_lock
)paren
suffix:semicolon
DECL|function|dn_rt_cache_flush
r_void
id|dn_rt_cache_flush
c_func
(paren
r_int
id|delay
)paren
(brace
r_int
r_int
id|now
op_assign
id|jiffies
suffix:semicolon
r_int
id|user_mode
op_assign
op_logical_neg
id|in_interrupt
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|delay
OL
l_int|0
)paren
id|delay
op_assign
id|dn_rt_min_delay
suffix:semicolon
id|spin_lock_bh
c_func
(paren
op_amp
id|dn_rt_flush_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|del_timer
c_func
(paren
op_amp
id|dn_rt_flush_timer
)paren
op_logical_and
id|delay
OG
l_int|0
op_logical_and
id|dn_rt_deadline
)paren
(brace
r_int
id|tmo
op_assign
(paren
r_int
)paren
(paren
id|dn_rt_deadline
op_minus
id|now
)paren
suffix:semicolon
r_if
c_cond
(paren
id|user_mode
op_logical_and
id|tmo
OL
id|dn_rt_max_delay
op_minus
id|dn_rt_min_delay
)paren
id|tmo
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|delay
OG
id|tmo
)paren
id|delay
op_assign
id|tmo
suffix:semicolon
)brace
r_if
c_cond
(paren
id|delay
op_le
l_int|0
)paren
(brace
id|spin_unlock_bh
c_func
(paren
op_amp
id|dn_rt_flush_lock
)paren
suffix:semicolon
id|dn_run_flush
c_func
(paren
l_int|0
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dn_rt_deadline
op_eq
l_int|0
)paren
id|dn_rt_deadline
op_assign
id|now
op_plus
id|dn_rt_max_delay
suffix:semicolon
id|dn_rt_flush_timer.expires
op_assign
id|now
op_plus
id|delay
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|dn_rt_flush_timer
)paren
suffix:semicolon
id|spin_unlock_bh
c_func
(paren
op_amp
id|dn_rt_flush_lock
)paren
suffix:semicolon
)brace
multiline_comment|/**&n; * dn_return_short - Return a short packet to its sender&n; * @skb: The packet to return&n; *&n; */
DECL|function|dn_return_short
r_static
r_int
id|dn_return_short
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|dn_skb_cb
op_star
id|cb
suffix:semicolon
r_int
r_char
op_star
id|ptr
suffix:semicolon
id|dn_address
op_star
id|src
suffix:semicolon
id|dn_address
op_star
id|dst
suffix:semicolon
id|dn_address
id|tmp
suffix:semicolon
multiline_comment|/* Add back headers */
id|skb_push
c_func
(paren
id|skb
comma
id|skb-&gt;data
op_minus
id|skb-&gt;nh.raw
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|skb
op_assign
id|skb_unshare
c_func
(paren
id|skb
comma
id|GFP_ATOMIC
)paren
)paren
op_eq
l_int|NULL
)paren
r_return
id|NET_RX_DROP
suffix:semicolon
id|cb
op_assign
id|DN_SKB_CB
c_func
(paren
id|skb
)paren
suffix:semicolon
multiline_comment|/* Skip packet length and point to flags */
id|ptr
op_assign
id|skb-&gt;data
op_plus
l_int|2
suffix:semicolon
op_star
id|ptr
op_increment
op_assign
(paren
id|cb-&gt;rt_flags
op_amp
op_complement
id|DN_RT_F_RQR
)paren
op_or
id|DN_RT_F_RTS
suffix:semicolon
id|dst
op_assign
(paren
id|dn_address
op_star
)paren
id|ptr
suffix:semicolon
id|ptr
op_add_assign
l_int|2
suffix:semicolon
id|src
op_assign
(paren
id|dn_address
op_star
)paren
id|ptr
suffix:semicolon
id|ptr
op_add_assign
l_int|2
suffix:semicolon
op_star
id|ptr
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Zero hop count */
multiline_comment|/* Swap source and destination */
id|tmp
op_assign
op_star
id|src
suffix:semicolon
op_star
id|src
op_assign
op_star
id|dst
suffix:semicolon
op_star
id|dst
op_assign
id|tmp
suffix:semicolon
id|skb-&gt;pkt_type
op_assign
id|PACKET_OUTGOING
suffix:semicolon
id|dn_rt_finish_output
c_func
(paren
id|skb
comma
l_int|NULL
comma
l_int|NULL
)paren
suffix:semicolon
r_return
id|NET_RX_SUCCESS
suffix:semicolon
)brace
multiline_comment|/**&n; * dn_return_long - Return a long packet to its sender&n; * @skb: The long format packet to return&n; *&n; */
DECL|function|dn_return_long
r_static
r_int
id|dn_return_long
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|dn_skb_cb
op_star
id|cb
suffix:semicolon
r_int
r_char
op_star
id|ptr
suffix:semicolon
r_int
r_char
op_star
id|src_addr
comma
op_star
id|dst_addr
suffix:semicolon
r_int
r_char
id|tmp
(braket
id|ETH_ALEN
)braket
suffix:semicolon
multiline_comment|/* Add back all headers */
id|skb_push
c_func
(paren
id|skb
comma
id|skb-&gt;data
op_minus
id|skb-&gt;nh.raw
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|skb
op_assign
id|skb_unshare
c_func
(paren
id|skb
comma
id|GFP_ATOMIC
)paren
)paren
op_eq
l_int|NULL
)paren
r_return
id|NET_RX_DROP
suffix:semicolon
id|cb
op_assign
id|DN_SKB_CB
c_func
(paren
id|skb
)paren
suffix:semicolon
multiline_comment|/* Ignore packet length and point to flags */
id|ptr
op_assign
id|skb-&gt;data
op_plus
l_int|2
suffix:semicolon
multiline_comment|/* Skip padding */
r_if
c_cond
(paren
op_star
id|ptr
op_amp
id|DN_RT_F_PF
)paren
(brace
r_char
id|padlen
op_assign
(paren
op_star
id|ptr
op_amp
op_complement
id|DN_RT_F_PF
)paren
suffix:semicolon
id|ptr
op_add_assign
id|padlen
suffix:semicolon
)brace
op_star
id|ptr
op_increment
op_assign
(paren
id|cb-&gt;rt_flags
op_amp
op_complement
id|DN_RT_F_RQR
)paren
op_or
id|DN_RT_F_RTS
suffix:semicolon
id|ptr
op_add_assign
l_int|2
suffix:semicolon
id|dst_addr
op_assign
id|ptr
suffix:semicolon
id|ptr
op_add_assign
l_int|8
suffix:semicolon
id|src_addr
op_assign
id|ptr
suffix:semicolon
id|ptr
op_add_assign
l_int|6
suffix:semicolon
op_star
id|ptr
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Zero hop count */
multiline_comment|/* Swap source and destination */
id|memcpy
c_func
(paren
id|tmp
comma
id|src_addr
comma
id|ETH_ALEN
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|src_addr
comma
id|dst_addr
comma
id|ETH_ALEN
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|dst_addr
comma
id|tmp
comma
id|ETH_ALEN
)paren
suffix:semicolon
id|skb-&gt;pkt_type
op_assign
id|PACKET_OUTGOING
suffix:semicolon
id|dn_rt_finish_output
c_func
(paren
id|skb
comma
id|dst_addr
comma
id|src_addr
)paren
suffix:semicolon
r_return
id|NET_RX_SUCCESS
suffix:semicolon
)brace
multiline_comment|/**&n; * dn_route_rx_packet - Try and find a route for an incoming packet&n; * @skb: The packet to find a route for&n; *&n; * Returns: result of input function if route is found, error code otherwise&n; */
DECL|function|dn_route_rx_packet
r_static
r_int
id|dn_route_rx_packet
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|dn_skb_cb
op_star
id|cb
op_assign
id|DN_SKB_CB
c_func
(paren
id|skb
)paren
suffix:semicolon
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|dn_route_input
c_func
(paren
id|skb
)paren
)paren
op_eq
l_int|0
)paren
r_return
id|dst_input
c_func
(paren
id|skb
)paren
suffix:semicolon
r_if
c_cond
(paren
id|decnet_debug_level
op_amp
l_int|4
)paren
(brace
r_char
op_star
id|devname
op_assign
id|skb-&gt;dev
ques
c_cond
id|skb-&gt;dev-&gt;name
suffix:colon
l_string|&quot;???&quot;
suffix:semicolon
r_struct
id|dn_skb_cb
op_star
id|cb
op_assign
id|DN_SKB_CB
c_func
(paren
id|skb
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;DECnet: dn_route_rx_packet: rt_flags=0x%02x dev=%s len=%d src=0x%04hx dst=0x%04hx err=%d type=%d&bslash;n&quot;
comma
(paren
r_int
)paren
id|cb-&gt;rt_flags
comma
id|devname
comma
id|skb-&gt;len
comma
id|cb-&gt;src
comma
id|cb-&gt;dst
comma
id|err
comma
id|skb-&gt;pkt_type
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|skb-&gt;pkt_type
op_eq
id|PACKET_HOST
)paren
op_logical_and
(paren
id|cb-&gt;rt_flags
op_amp
id|DN_RT_F_RQR
)paren
)paren
(brace
r_switch
c_cond
(paren
id|cb-&gt;rt_flags
op_amp
id|DN_RT_PKT_MSK
)paren
(brace
r_case
id|DN_RT_PKT_SHORT
suffix:colon
r_return
id|dn_return_short
c_func
(paren
id|skb
)paren
suffix:semicolon
r_case
id|DN_RT_PKT_LONG
suffix:colon
r_return
id|dn_return_long
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
)brace
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
id|NET_RX_DROP
suffix:semicolon
)brace
DECL|function|dn_route_rx_long
r_static
r_int
id|dn_route_rx_long
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|dn_skb_cb
op_star
id|cb
op_assign
id|DN_SKB_CB
c_func
(paren
id|skb
)paren
suffix:semicolon
r_int
r_char
op_star
id|ptr
op_assign
id|skb-&gt;data
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pskb_may_pull
c_func
(paren
id|skb
comma
l_int|21
)paren
)paren
multiline_comment|/* 20 for long header, 1 for shortest nsp */
r_goto
id|drop_it
suffix:semicolon
id|skb_pull
c_func
(paren
id|skb
comma
l_int|20
)paren
suffix:semicolon
id|skb-&gt;h.raw
op_assign
id|skb-&gt;data
suffix:semicolon
multiline_comment|/* Destination info */
id|ptr
op_add_assign
l_int|2
suffix:semicolon
id|cb-&gt;dst
op_assign
id|dn_htons
c_func
(paren
id|dn_eth2dn
c_func
(paren
id|ptr
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|memcmp
c_func
(paren
id|ptr
comma
id|dn_hiord_addr
comma
l_int|4
)paren
op_ne
l_int|0
)paren
r_goto
id|drop_it
suffix:semicolon
id|ptr
op_add_assign
l_int|6
suffix:semicolon
multiline_comment|/* Source info */
id|ptr
op_add_assign
l_int|2
suffix:semicolon
id|cb-&gt;src
op_assign
id|dn_htons
c_func
(paren
id|dn_eth2dn
c_func
(paren
id|ptr
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|memcmp
c_func
(paren
id|ptr
comma
id|dn_hiord_addr
comma
l_int|4
)paren
op_ne
l_int|0
)paren
r_goto
id|drop_it
suffix:semicolon
id|ptr
op_add_assign
l_int|6
suffix:semicolon
multiline_comment|/* Other junk */
id|ptr
op_increment
suffix:semicolon
id|cb-&gt;hops
op_assign
op_star
id|ptr
op_increment
suffix:semicolon
multiline_comment|/* Visit Count */
r_return
id|NF_HOOK
c_func
(paren
id|PF_DECnet
comma
id|NF_DN_PRE_ROUTING
comma
id|skb
comma
id|skb-&gt;dev
comma
l_int|NULL
comma
id|dn_route_rx_packet
)paren
suffix:semicolon
id|drop_it
suffix:colon
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
id|NET_RX_DROP
suffix:semicolon
)brace
DECL|function|dn_route_rx_short
r_static
r_int
id|dn_route_rx_short
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|dn_skb_cb
op_star
id|cb
op_assign
id|DN_SKB_CB
c_func
(paren
id|skb
)paren
suffix:semicolon
r_int
r_char
op_star
id|ptr
op_assign
id|skb-&gt;data
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pskb_may_pull
c_func
(paren
id|skb
comma
l_int|6
)paren
)paren
multiline_comment|/* 5 for short header + 1 for shortest nsp */
r_goto
id|drop_it
suffix:semicolon
id|skb_pull
c_func
(paren
id|skb
comma
l_int|5
)paren
suffix:semicolon
id|skb-&gt;h.raw
op_assign
id|skb-&gt;data
suffix:semicolon
id|cb-&gt;dst
op_assign
op_star
(paren
id|dn_address
op_star
)paren
id|ptr
suffix:semicolon
id|ptr
op_add_assign
l_int|2
suffix:semicolon
id|cb-&gt;src
op_assign
op_star
(paren
id|dn_address
op_star
)paren
id|ptr
suffix:semicolon
id|ptr
op_add_assign
l_int|2
suffix:semicolon
id|cb-&gt;hops
op_assign
op_star
id|ptr
op_amp
l_int|0x3f
suffix:semicolon
r_return
id|NF_HOOK
c_func
(paren
id|PF_DECnet
comma
id|NF_DN_PRE_ROUTING
comma
id|skb
comma
id|skb-&gt;dev
comma
l_int|NULL
comma
id|dn_route_rx_packet
)paren
suffix:semicolon
id|drop_it
suffix:colon
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
id|NET_RX_DROP
suffix:semicolon
)brace
DECL|function|dn_route_discard
r_static
r_int
id|dn_route_discard
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
multiline_comment|/*&n;&t; * I know we drop the packet here, but thats considered success in&n;&t; * this case&n;&t; */
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
id|NET_RX_SUCCESS
suffix:semicolon
)brace
DECL|function|dn_route_ptp_hello
r_static
r_int
id|dn_route_ptp_hello
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
id|dn_dev_hello
c_func
(paren
id|skb
)paren
suffix:semicolon
id|dn_neigh_pointopoint_hello
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
id|NET_RX_SUCCESS
suffix:semicolon
)brace
DECL|function|dn_route_rcv
r_int
id|dn_route_rcv
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|packet_type
op_star
id|pt
)paren
(brace
r_struct
id|dn_skb_cb
op_star
id|cb
suffix:semicolon
r_int
r_char
id|flags
op_assign
l_int|0
suffix:semicolon
id|__u16
id|len
op_assign
id|dn_ntohs
c_func
(paren
op_star
(paren
id|__u16
op_star
)paren
id|skb-&gt;data
)paren
suffix:semicolon
r_struct
id|dn_dev
op_star
id|dn
op_assign
(paren
r_struct
id|dn_dev
op_star
)paren
id|dev-&gt;dn_ptr
suffix:semicolon
r_int
r_char
id|padlen
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|dn
op_eq
l_int|NULL
)paren
r_goto
id|dump_it
suffix:semicolon
r_if
c_cond
(paren
(paren
id|skb
op_assign
id|skb_share_check
c_func
(paren
id|skb
comma
id|GFP_ATOMIC
)paren
)paren
op_eq
l_int|NULL
)paren
r_goto
id|out
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pskb_may_pull
c_func
(paren
id|skb
comma
l_int|3
)paren
)paren
r_goto
id|dump_it
suffix:semicolon
id|skb_pull
c_func
(paren
id|skb
comma
l_int|2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|len
OG
id|skb-&gt;len
)paren
r_goto
id|dump_it
suffix:semicolon
id|skb_trim
c_func
(paren
id|skb
comma
id|len
)paren
suffix:semicolon
id|flags
op_assign
op_star
id|skb-&gt;data
suffix:semicolon
id|cb
op_assign
id|DN_SKB_CB
c_func
(paren
id|skb
)paren
suffix:semicolon
id|cb-&gt;stamp
op_assign
id|jiffies
suffix:semicolon
id|cb-&gt;iif
op_assign
id|dev-&gt;ifindex
suffix:semicolon
multiline_comment|/*&n;&t; * If we have padding, remove it.&n;&t; */
r_if
c_cond
(paren
id|flags
op_amp
id|DN_RT_F_PF
)paren
(brace
id|padlen
op_assign
id|flags
op_amp
op_complement
id|DN_RT_F_PF
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pskb_may_pull
c_func
(paren
id|skb
comma
id|padlen
op_plus
l_int|1
)paren
)paren
r_goto
id|dump_it
suffix:semicolon
id|skb_pull
c_func
(paren
id|skb
comma
id|padlen
)paren
suffix:semicolon
id|flags
op_assign
op_star
id|skb-&gt;data
suffix:semicolon
)brace
id|skb-&gt;nh.raw
op_assign
id|skb-&gt;data
suffix:semicolon
multiline_comment|/*&n;&t; * Weed out future version DECnet&n;&t; */
r_if
c_cond
(paren
id|flags
op_amp
id|DN_RT_F_VER
)paren
r_goto
id|dump_it
suffix:semicolon
id|cb-&gt;rt_flags
op_assign
id|flags
suffix:semicolon
r_if
c_cond
(paren
id|decnet_debug_level
op_amp
l_int|1
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;dn_route_rcv: got 0x%02x from %s [%d %d %d]&bslash;n&quot;
comma
(paren
r_int
)paren
id|flags
comma
(paren
id|dev
)paren
ques
c_cond
id|dev-&gt;name
suffix:colon
l_string|&quot;???&quot;
comma
id|len
comma
id|skb-&gt;len
comma
id|padlen
)paren
suffix:semicolon
r_if
c_cond
(paren
id|flags
op_amp
id|DN_RT_PKT_CNTL
)paren
(brace
r_if
c_cond
(paren
id|unlikely
c_func
(paren
id|skb_is_nonlinear
c_func
(paren
id|skb
)paren
)paren
op_logical_and
id|skb_linearize
c_func
(paren
id|skb
comma
id|GFP_ATOMIC
)paren
op_ne
l_int|0
)paren
r_goto
id|dump_it
suffix:semicolon
r_switch
c_cond
(paren
id|flags
op_amp
id|DN_RT_CNTL_MSK
)paren
(brace
r_case
id|DN_RT_PKT_INIT
suffix:colon
id|dn_dev_init_pkt
c_func
(paren
id|skb
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DN_RT_PKT_VERI
suffix:colon
id|dn_dev_veri_pkt
c_func
(paren
id|skb
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dn-&gt;parms.state
op_ne
id|DN_DEV_S_RU
)paren
r_goto
id|dump_it
suffix:semicolon
r_switch
c_cond
(paren
id|flags
op_amp
id|DN_RT_CNTL_MSK
)paren
(brace
r_case
id|DN_RT_PKT_HELO
suffix:colon
r_return
id|NF_HOOK
c_func
(paren
id|PF_DECnet
comma
id|NF_DN_HELLO
comma
id|skb
comma
id|skb-&gt;dev
comma
l_int|NULL
comma
id|dn_route_ptp_hello
)paren
suffix:semicolon
r_case
id|DN_RT_PKT_L1RT
suffix:colon
r_case
id|DN_RT_PKT_L2RT
suffix:colon
r_return
id|NF_HOOK
c_func
(paren
id|PF_DECnet
comma
id|NF_DN_ROUTE
comma
id|skb
comma
id|skb-&gt;dev
comma
l_int|NULL
comma
id|dn_route_discard
)paren
suffix:semicolon
r_case
id|DN_RT_PKT_ERTH
suffix:colon
r_return
id|NF_HOOK
c_func
(paren
id|PF_DECnet
comma
id|NF_DN_HELLO
comma
id|skb
comma
id|skb-&gt;dev
comma
l_int|NULL
comma
id|dn_neigh_router_hello
)paren
suffix:semicolon
r_case
id|DN_RT_PKT_EEDH
suffix:colon
r_return
id|NF_HOOK
c_func
(paren
id|PF_DECnet
comma
id|NF_DN_HELLO
comma
id|skb
comma
id|skb-&gt;dev
comma
l_int|NULL
comma
id|dn_neigh_endnode_hello
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
id|dn-&gt;parms.state
op_ne
id|DN_DEV_S_RU
)paren
r_goto
id|dump_it
suffix:semicolon
id|skb_pull
c_func
(paren
id|skb
comma
l_int|1
)paren
suffix:semicolon
multiline_comment|/* Pull flags */
r_switch
c_cond
(paren
id|flags
op_amp
id|DN_RT_PKT_MSK
)paren
(brace
r_case
id|DN_RT_PKT_LONG
suffix:colon
r_return
id|dn_route_rx_long
c_func
(paren
id|skb
)paren
suffix:semicolon
r_case
id|DN_RT_PKT_SHORT
suffix:colon
r_return
id|dn_route_rx_short
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
)brace
id|dump_it
suffix:colon
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
id|out
suffix:colon
r_return
id|NET_RX_DROP
suffix:semicolon
)brace
DECL|function|dn_output
r_static
r_int
id|dn_output
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|dst_entry
op_star
id|dst
op_assign
id|skb-&gt;dst
suffix:semicolon
r_struct
id|dn_route
op_star
id|rt
op_assign
(paren
r_struct
id|dn_route
op_star
)paren
id|dst
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
op_assign
id|dst-&gt;dev
suffix:semicolon
r_struct
id|dn_skb_cb
op_star
id|cb
op_assign
id|DN_SKB_CB
c_func
(paren
id|skb
)paren
suffix:semicolon
r_struct
id|neighbour
op_star
id|neigh
suffix:semicolon
r_int
id|err
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
(paren
id|neigh
op_assign
id|dst-&gt;neighbour
)paren
op_eq
l_int|NULL
)paren
r_goto
id|error
suffix:semicolon
id|skb-&gt;dev
op_assign
id|dev
suffix:semicolon
id|cb-&gt;src
op_assign
id|rt-&gt;rt_saddr
suffix:semicolon
id|cb-&gt;dst
op_assign
id|rt-&gt;rt_daddr
suffix:semicolon
multiline_comment|/*&n;&t; * Always set the Intra-Ethernet bit on all outgoing packets&n;&t; * originated on this node. Only valid flag from upper layers&n;&t; * is return-to-sender-requested. Set hop count to 0 too.&n;&t; */
id|cb-&gt;rt_flags
op_and_assign
op_complement
id|DN_RT_F_RQR
suffix:semicolon
id|cb-&gt;rt_flags
op_or_assign
id|DN_RT_F_IE
suffix:semicolon
id|cb-&gt;hops
op_assign
l_int|0
suffix:semicolon
r_return
id|NF_HOOK
c_func
(paren
id|PF_DECnet
comma
id|NF_DN_LOCAL_OUT
comma
id|skb
comma
l_int|NULL
comma
id|dev
comma
id|neigh-&gt;output
)paren
suffix:semicolon
id|error
suffix:colon
r_if
c_cond
(paren
id|net_ratelimit
c_func
(paren
)paren
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;dn_output: This should not happen&bslash;n&quot;
)paren
suffix:semicolon
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|dn_forward
r_static
r_int
id|dn_forward
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|dn_skb_cb
op_star
id|cb
op_assign
id|DN_SKB_CB
c_func
(paren
id|skb
)paren
suffix:semicolon
r_struct
id|dst_entry
op_star
id|dst
op_assign
id|skb-&gt;dst
suffix:semicolon
r_struct
id|dn_dev
op_star
id|dn_db
op_assign
id|dst-&gt;dev-&gt;dn_ptr
suffix:semicolon
r_struct
id|dn_route
op_star
id|rt
suffix:semicolon
r_struct
id|neighbour
op_star
id|neigh
op_assign
id|dst-&gt;neighbour
suffix:semicolon
r_int
id|header_len
suffix:semicolon
macro_line|#ifdef CONFIG_NETFILTER
r_struct
id|net_device
op_star
id|dev
op_assign
id|skb-&gt;dev
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|skb-&gt;pkt_type
op_ne
id|PACKET_HOST
)paren
r_goto
id|drop
suffix:semicolon
multiline_comment|/* Ensure that we have enough space for headers */
id|rt
op_assign
(paren
r_struct
id|dn_route
op_star
)paren
id|skb-&gt;dst
suffix:semicolon
id|header_len
op_assign
id|dn_db-&gt;use_long
ques
c_cond
l_int|21
suffix:colon
l_int|6
suffix:semicolon
r_if
c_cond
(paren
id|skb_cow
c_func
(paren
id|skb
comma
id|LL_RESERVED_SPACE
c_func
(paren
id|rt-&gt;u.dst.dev
)paren
op_plus
id|header_len
)paren
)paren
r_goto
id|drop
suffix:semicolon
multiline_comment|/*&n;&t; * Hop count exceeded.&n;&t; */
r_if
c_cond
(paren
op_increment
id|cb-&gt;hops
OG
l_int|30
)paren
r_goto
id|drop
suffix:semicolon
id|skb-&gt;dev
op_assign
id|rt-&gt;u.dst.dev
suffix:semicolon
multiline_comment|/*&n;&t; * If packet goes out same interface it came in on, then set&n;&t; * the Intra-Ethernet bit. This has no effect for short&n;&t; * packets, so we don&squot;t need to test for them here.&n;&t; */
id|cb-&gt;rt_flags
op_and_assign
op_complement
id|DN_RT_F_IE
suffix:semicolon
r_if
c_cond
(paren
id|rt-&gt;rt_flags
op_amp
id|RTCF_DOREDIRECT
)paren
id|cb-&gt;rt_flags
op_or_assign
id|DN_RT_F_IE
suffix:semicolon
r_return
id|NF_HOOK
c_func
(paren
id|PF_DECnet
comma
id|NF_DN_FORWARD
comma
id|skb
comma
id|dev
comma
id|skb-&gt;dev
comma
id|neigh-&gt;output
)paren
suffix:semicolon
id|drop
suffix:colon
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
id|NET_RX_DROP
suffix:semicolon
)brace
multiline_comment|/*&n; * Drop packet. This is used for endnodes and for&n; * when we should not be forwarding packets from&n; * this dest.&n; */
DECL|function|dn_blackhole
r_static
r_int
id|dn_blackhole
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
id|NET_RX_DROP
suffix:semicolon
)brace
multiline_comment|/*&n; * Used to catch bugs. This should never normally get&n; * called.&n; */
DECL|function|dn_rt_bug
r_static
r_int
id|dn_rt_bug
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_if
c_cond
(paren
id|net_ratelimit
c_func
(paren
)paren
)paren
(brace
r_struct
id|dn_skb_cb
op_star
id|cb
op_assign
id|DN_SKB_CB
c_func
(paren
id|skb
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;dn_rt_bug: skb from:%04x to:%04x&bslash;n&quot;
comma
id|cb-&gt;src
comma
id|cb-&gt;dst
)paren
suffix:semicolon
)brace
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
id|NET_RX_BAD
suffix:semicolon
)brace
DECL|function|dn_rt_set_next_hop
r_static
r_int
id|dn_rt_set_next_hop
c_func
(paren
r_struct
id|dn_route
op_star
id|rt
comma
r_struct
id|dn_fib_res
op_star
id|res
)paren
(brace
r_struct
id|dn_fib_info
op_star
id|fi
op_assign
id|res-&gt;fi
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
op_assign
id|rt-&gt;u.dst.dev
suffix:semicolon
r_struct
id|neighbour
op_star
id|n
suffix:semicolon
r_int
id|mss
suffix:semicolon
r_if
c_cond
(paren
id|fi
)paren
(brace
r_if
c_cond
(paren
id|DN_FIB_RES_GW
c_func
(paren
op_star
id|res
)paren
op_logical_and
id|DN_FIB_RES_NH
id|res.nh_scope
op_eq
id|RT_SCOPE_LINK
)paren
id|rt-&gt;rt_gateway
op_assign
id|DN_FIB_RES_GW
c_func
(paren
op_star
id|res
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|rt-&gt;u.dst.metrics
comma
id|fi-&gt;fib_metrics
comma
r_sizeof
(paren
id|rt-&gt;u.dst.metrics
)paren
)paren
suffix:semicolon
)brace
id|rt-&gt;rt_type
op_assign
id|res-&gt;type
suffix:semicolon
r_if
c_cond
(paren
id|dev
op_ne
l_int|NULL
op_logical_and
id|rt-&gt;u.dst.neighbour
op_eq
l_int|NULL
)paren
(brace
id|n
op_assign
id|__neigh_lookup_errno
c_func
(paren
op_amp
id|dn_neigh_table
comma
op_amp
id|rt-&gt;rt_gateway
comma
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|IS_ERR
c_func
(paren
id|n
)paren
)paren
r_return
id|PTR_ERR
c_func
(paren
id|n
)paren
suffix:semicolon
id|rt-&gt;u.dst.neighbour
op_assign
id|n
suffix:semicolon
)brace
r_if
c_cond
(paren
id|rt-&gt;u.dst.metrics
(braket
id|RTAX_MTU
op_minus
l_int|1
)braket
op_eq
l_int|0
op_logical_or
id|rt-&gt;u.dst.metrics
(braket
id|RTAX_MTU
op_minus
l_int|1
)braket
OG
id|rt-&gt;u.dst.dev-&gt;mtu
)paren
id|rt-&gt;u.dst.metrics
(braket
id|RTAX_MTU
op_minus
l_int|1
)braket
op_assign
id|rt-&gt;u.dst.dev-&gt;mtu
suffix:semicolon
id|mss
op_assign
id|dn_mss_from_pmtu
c_func
(paren
id|dev
comma
id|dst_pmtu
c_func
(paren
op_amp
id|rt-&gt;u.dst
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rt-&gt;u.dst.metrics
(braket
id|RTAX_ADVMSS
op_minus
l_int|1
)braket
op_eq
l_int|0
op_logical_or
id|rt-&gt;u.dst.metrics
(braket
id|RTAX_ADVMSS
op_minus
l_int|1
)braket
OG
id|mss
)paren
id|rt-&gt;u.dst.metrics
(braket
id|RTAX_ADVMSS
op_minus
l_int|1
)braket
op_assign
id|mss
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dn_match_addr
r_static
r_inline
r_int
id|dn_match_addr
c_func
(paren
id|__u16
id|addr1
comma
id|__u16
id|addr2
)paren
(brace
id|__u16
id|tmp
op_assign
id|dn_ntohs
c_func
(paren
id|addr1
)paren
op_xor
id|dn_ntohs
c_func
(paren
id|addr2
)paren
suffix:semicolon
r_int
id|match
op_assign
l_int|16
suffix:semicolon
r_while
c_loop
(paren
id|tmp
)paren
(brace
id|tmp
op_rshift_assign
l_int|1
suffix:semicolon
id|match
op_decrement
suffix:semicolon
)brace
r_return
id|match
suffix:semicolon
)brace
DECL|function|dnet_select_source
r_static
id|__u16
id|dnet_select_source
c_func
(paren
r_const
r_struct
id|net_device
op_star
id|dev
comma
id|__u16
id|daddr
comma
r_int
id|scope
)paren
(brace
id|__u16
id|saddr
op_assign
l_int|0
suffix:semicolon
r_struct
id|dn_dev
op_star
id|dn_db
op_assign
id|dev-&gt;dn_ptr
suffix:semicolon
r_struct
id|dn_ifaddr
op_star
id|ifa
suffix:semicolon
r_int
id|best_match
op_assign
l_int|0
suffix:semicolon
r_int
id|ret
suffix:semicolon
id|read_lock
c_func
(paren
op_amp
id|dev_base_lock
)paren
suffix:semicolon
r_for
c_loop
(paren
id|ifa
op_assign
id|dn_db-&gt;ifa_list
suffix:semicolon
id|ifa
suffix:semicolon
id|ifa
op_assign
id|ifa-&gt;ifa_next
)paren
(brace
r_if
c_cond
(paren
id|ifa-&gt;ifa_scope
OG
id|scope
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|daddr
)paren
(brace
id|saddr
op_assign
id|ifa-&gt;ifa_local
suffix:semicolon
r_break
suffix:semicolon
)brace
id|ret
op_assign
id|dn_match_addr
c_func
(paren
id|daddr
comma
id|ifa-&gt;ifa_local
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
OG
id|best_match
)paren
id|saddr
op_assign
id|ifa-&gt;ifa_local
suffix:semicolon
r_if
c_cond
(paren
id|best_match
op_eq
l_int|0
)paren
id|saddr
op_assign
id|ifa-&gt;ifa_local
suffix:semicolon
)brace
id|read_unlock
c_func
(paren
op_amp
id|dev_base_lock
)paren
suffix:semicolon
r_return
id|saddr
suffix:semicolon
)brace
DECL|function|__dn_fib_res_prefsrc
r_static
r_inline
id|__u16
id|__dn_fib_res_prefsrc
c_func
(paren
r_struct
id|dn_fib_res
op_star
id|res
)paren
(brace
r_return
id|dnet_select_source
c_func
(paren
id|DN_FIB_RES_DEV
c_func
(paren
op_star
id|res
)paren
comma
id|DN_FIB_RES_GW
c_func
(paren
op_star
id|res
)paren
comma
id|res-&gt;scope
)paren
suffix:semicolon
)brace
DECL|function|dn_fib_rules_map_destination
r_static
r_inline
id|__u16
id|dn_fib_rules_map_destination
c_func
(paren
id|__u16
id|daddr
comma
r_struct
id|dn_fib_res
op_star
id|res
)paren
(brace
id|__u16
id|mask
op_assign
id|dnet_make_mask
c_func
(paren
id|res-&gt;prefixlen
)paren
suffix:semicolon
r_return
(paren
id|daddr
op_amp
op_complement
id|mask
)paren
op_or
id|res-&gt;fi-&gt;fib_nh-&gt;nh_gw
suffix:semicolon
)brace
DECL|function|dn_route_output_slow
r_static
r_int
id|dn_route_output_slow
c_func
(paren
r_struct
id|dst_entry
op_star
op_star
id|pprt
comma
r_const
r_struct
id|flowi
op_star
id|oldflp
comma
r_int
id|try_hard
)paren
(brace
r_struct
id|flowi
id|fl
op_assign
(brace
dot
id|nl_u
op_assign
(brace
dot
id|dn_u
op_assign
(brace
dot
id|daddr
op_assign
id|oldflp-&gt;fld_dst
comma
dot
id|saddr
op_assign
id|oldflp-&gt;fld_src
comma
dot
id|scope
op_assign
id|RT_SCOPE_UNIVERSE
comma
macro_line|#ifdef CONFIG_DECNET_ROUTE_FWMARK
dot
id|fwmark
op_assign
id|oldflp-&gt;fld_fwmark
macro_line|#endif
)brace
)brace
comma
dot
id|iif
op_assign
id|loopback_dev.ifindex
comma
dot
id|oif
op_assign
id|oldflp-&gt;oif
)brace
suffix:semicolon
r_struct
id|dn_route
op_star
id|rt
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|net_device
op_star
id|dev_out
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|neighbour
op_star
id|neigh
op_assign
l_int|NULL
suffix:semicolon
r_int
id|hash
suffix:semicolon
r_int
id|flags
op_assign
l_int|0
suffix:semicolon
r_struct
id|dn_fib_res
id|res
op_assign
(brace
dot
id|fi
op_assign
l_int|NULL
comma
dot
id|type
op_assign
id|RTN_UNICAST
)brace
suffix:semicolon
r_int
id|err
suffix:semicolon
r_int
id|free_res
op_assign
l_int|0
suffix:semicolon
id|__u16
id|gateway
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|decnet_debug_level
op_amp
l_int|16
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;dn_route_output_slow: dst=%04x src=%04x mark=%d&quot;
l_string|&quot; iif=%d oif=%d&bslash;n&quot;
comma
id|oldflp-&gt;fld_dst
comma
id|oldflp-&gt;fld_src
comma
id|oldflp-&gt;fld_fwmark
comma
id|loopback_dev.ifindex
comma
id|oldflp-&gt;oif
)paren
suffix:semicolon
multiline_comment|/* If we have an output interface, verify its a DECnet device */
r_if
c_cond
(paren
id|oldflp-&gt;oif
)paren
(brace
id|dev_out
op_assign
id|dev_get_by_index
c_func
(paren
id|oldflp-&gt;oif
)paren
suffix:semicolon
id|err
op_assign
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
id|dev_out
op_logical_and
id|dev_out-&gt;dn_ptr
op_eq
l_int|NULL
)paren
(brace
id|dev_put
c_func
(paren
id|dev_out
)paren
suffix:semicolon
id|dev_out
op_assign
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dev_out
op_eq
l_int|NULL
)paren
r_goto
id|out
suffix:semicolon
)brace
multiline_comment|/* If we have a source address, verify that its a local address */
r_if
c_cond
(paren
id|oldflp-&gt;fld_src
)paren
(brace
id|err
op_assign
op_minus
id|EADDRNOTAVAIL
suffix:semicolon
r_if
c_cond
(paren
id|dev_out
)paren
(brace
r_if
c_cond
(paren
id|dn_dev_islocal
c_func
(paren
id|dev_out
comma
id|oldflp-&gt;fld_src
)paren
)paren
r_goto
id|source_ok
suffix:semicolon
id|dev_put
c_func
(paren
id|dev_out
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|read_lock
c_func
(paren
op_amp
id|dev_base_lock
)paren
suffix:semicolon
r_for
c_loop
(paren
id|dev_out
op_assign
id|dev_base
suffix:semicolon
id|dev_out
suffix:semicolon
id|dev_out
op_assign
id|dev_out-&gt;next
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|dev_out-&gt;dn_ptr
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|dn_dev_islocal
c_func
(paren
id|dev_out
comma
id|oldflp-&gt;fld_src
)paren
)paren
r_break
suffix:semicolon
)brace
id|read_unlock
c_func
(paren
op_amp
id|dev_base_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev_out
op_eq
l_int|NULL
)paren
r_goto
id|out
suffix:semicolon
id|dev_hold
c_func
(paren
id|dev_out
)paren
suffix:semicolon
id|source_ok
suffix:colon
suffix:semicolon
)brace
multiline_comment|/* No destination? Assume its local */
r_if
c_cond
(paren
op_logical_neg
id|fl.fld_dst
)paren
(brace
id|fl.fld_dst
op_assign
id|fl.fld_src
suffix:semicolon
id|err
op_assign
op_minus
id|EADDRNOTAVAIL
suffix:semicolon
r_if
c_cond
(paren
id|dev_out
)paren
id|dev_put
c_func
(paren
id|dev_out
)paren
suffix:semicolon
id|dev_out
op_assign
op_amp
id|loopback_dev
suffix:semicolon
id|dev_hold
c_func
(paren
id|dev_out
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|fl.fld_dst
)paren
(brace
id|fl.fld_dst
op_assign
id|fl.fld_src
op_assign
id|dnet_select_source
c_func
(paren
id|dev_out
comma
l_int|0
comma
id|RT_SCOPE_HOST
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|fl.fld_dst
)paren
r_goto
id|out
suffix:semicolon
)brace
id|fl.oif
op_assign
id|loopback_dev.ifindex
suffix:semicolon
id|res.type
op_assign
id|RTN_LOCAL
suffix:semicolon
r_goto
id|make_route
suffix:semicolon
)brace
r_if
c_cond
(paren
id|decnet_debug_level
op_amp
l_int|16
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;dn_route_output_slow: initial checks complete.&quot;
l_string|&quot; dst=%o4x src=%04x oif=%d try_hard=%d&bslash;n&quot;
comma
id|fl.fld_dst
comma
id|fl.fld_src
comma
id|fl.oif
comma
id|try_hard
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * N.B. If the kernel is compiled without router support then&n;&t; * dn_fib_lookup() will evaluate to non-zero so this if () block&n;&t; * will always be executed.&n;&t; */
id|err
op_assign
op_minus
id|ESRCH
suffix:semicolon
r_if
c_cond
(paren
id|try_hard
op_logical_or
(paren
id|err
op_assign
id|dn_fib_lookup
c_func
(paren
op_amp
id|fl
comma
op_amp
id|res
)paren
)paren
op_ne
l_int|0
)paren
(brace
r_struct
id|dn_dev
op_star
id|dn_db
suffix:semicolon
r_if
c_cond
(paren
id|err
op_ne
op_minus
id|ESRCH
)paren
r_goto
id|out
suffix:semicolon
multiline_comment|/*&n;&t; &t; * Here the fallback is basically the standard algorithm for &n;&t;&t; * routing in endnodes which is described in the DECnet routing&n;&t;&t; * docs&n;&t;&t; *&n;&t;&t; * If we are not trying hard, look in neighbour cache.&n;&t;&t; * The result is tested to ensure that if a specific output&n;&t;&t; * device/source address was requested, then we honour that &n;&t;&t; * here&n;&t;&t; */
r_if
c_cond
(paren
op_logical_neg
id|try_hard
)paren
(brace
id|neigh
op_assign
id|neigh_lookup_nodev
c_func
(paren
op_amp
id|dn_neigh_table
comma
op_amp
id|fl.fld_dst
)paren
suffix:semicolon
r_if
c_cond
(paren
id|neigh
)paren
(brace
r_if
c_cond
(paren
(paren
id|oldflp-&gt;oif
op_logical_and
(paren
id|neigh-&gt;dev-&gt;ifindex
op_ne
id|oldflp-&gt;oif
)paren
)paren
op_logical_or
(paren
id|oldflp-&gt;fld_src
op_logical_and
(paren
op_logical_neg
id|dn_dev_islocal
c_func
(paren
id|neigh-&gt;dev
comma
id|oldflp-&gt;fld_src
)paren
)paren
)paren
)paren
(brace
id|neigh_release
c_func
(paren
id|neigh
)paren
suffix:semicolon
id|neigh
op_assign
l_int|NULL
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|dev_out
)paren
id|dev_put
c_func
(paren
id|dev_out
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dn_dev_islocal
c_func
(paren
id|neigh-&gt;dev
comma
id|fl.fld_dst
)paren
)paren
(brace
id|dev_out
op_assign
op_amp
id|loopback_dev
suffix:semicolon
id|res.type
op_assign
id|RTN_LOCAL
suffix:semicolon
)brace
r_else
(brace
id|dev_out
op_assign
id|neigh-&gt;dev
suffix:semicolon
)brace
id|dev_hold
c_func
(paren
id|dev_out
)paren
suffix:semicolon
r_goto
id|select_source
suffix:semicolon
)brace
)brace
)brace
multiline_comment|/* Not there? Perhaps its a local address */
r_if
c_cond
(paren
id|dev_out
op_eq
l_int|NULL
)paren
id|dev_out
op_assign
id|dn_dev_get_default
c_func
(paren
)paren
suffix:semicolon
id|err
op_assign
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
id|dev_out
op_eq
l_int|NULL
)paren
r_goto
id|out
suffix:semicolon
id|dn_db
op_assign
id|dev_out-&gt;dn_ptr
suffix:semicolon
multiline_comment|/* Possible improvement - check all devices for local addr */
r_if
c_cond
(paren
id|dn_dev_islocal
c_func
(paren
id|dev_out
comma
id|fl.fld_dst
)paren
)paren
(brace
id|dev_put
c_func
(paren
id|dev_out
)paren
suffix:semicolon
id|dev_out
op_assign
op_amp
id|loopback_dev
suffix:semicolon
id|dev_hold
c_func
(paren
id|dev_out
)paren
suffix:semicolon
id|res.type
op_assign
id|RTN_LOCAL
suffix:semicolon
r_goto
id|select_source
suffix:semicolon
)brace
multiline_comment|/* Not local either.... try sending it to the default router */
id|neigh
op_assign
id|neigh_clone
c_func
(paren
id|dn_db-&gt;router
)paren
suffix:semicolon
id|BUG_ON
c_func
(paren
id|neigh
op_logical_and
id|neigh-&gt;dev
op_ne
id|dev_out
)paren
suffix:semicolon
multiline_comment|/* Ok then, we assume its directly connected and move on */
id|select_source
suffix:colon
r_if
c_cond
(paren
id|neigh
)paren
id|gateway
op_assign
(paren
(paren
r_struct
id|dn_neigh
op_star
)paren
id|neigh
)paren
op_member_access_from_pointer
id|addr
suffix:semicolon
r_if
c_cond
(paren
id|gateway
op_eq
l_int|0
)paren
id|gateway
op_assign
id|fl.fld_dst
suffix:semicolon
r_if
c_cond
(paren
id|fl.fld_src
op_eq
l_int|0
)paren
(brace
id|fl.fld_src
op_assign
id|dnet_select_source
c_func
(paren
id|dev_out
comma
id|gateway
comma
id|res.type
op_eq
id|RTN_LOCAL
ques
c_cond
id|RT_SCOPE_HOST
suffix:colon
id|RT_SCOPE_LINK
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fl.fld_src
op_eq
l_int|0
op_logical_and
id|res.type
op_ne
id|RTN_LOCAL
)paren
r_goto
id|e_addr
suffix:semicolon
)brace
id|fl.oif
op_assign
id|dev_out-&gt;ifindex
suffix:semicolon
r_goto
id|make_route
suffix:semicolon
)brace
id|free_res
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|res.type
op_eq
id|RTN_NAT
)paren
r_goto
id|e_inval
suffix:semicolon
r_if
c_cond
(paren
id|res.type
op_eq
id|RTN_LOCAL
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|fl.fld_src
)paren
id|fl.fld_src
op_assign
id|fl.fld_dst
suffix:semicolon
r_if
c_cond
(paren
id|dev_out
)paren
id|dev_put
c_func
(paren
id|dev_out
)paren
suffix:semicolon
id|dev_out
op_assign
op_amp
id|loopback_dev
suffix:semicolon
id|dev_hold
c_func
(paren
id|dev_out
)paren
suffix:semicolon
id|fl.oif
op_assign
id|dev_out-&gt;ifindex
suffix:semicolon
r_if
c_cond
(paren
id|res.fi
)paren
id|dn_fib_info_put
c_func
(paren
id|res.fi
)paren
suffix:semicolon
id|res.fi
op_assign
l_int|NULL
suffix:semicolon
r_goto
id|make_route
suffix:semicolon
)brace
r_if
c_cond
(paren
id|res.fi-&gt;fib_nhs
OG
l_int|1
op_logical_and
id|fl.oif
op_eq
l_int|0
)paren
id|dn_fib_select_multipath
c_func
(paren
op_amp
id|fl
comma
op_amp
id|res
)paren
suffix:semicolon
multiline_comment|/* &n;&t; * We could add some logic to deal with default routes here and&n;&t; * get rid of some of the special casing above.&n;&t; */
r_if
c_cond
(paren
op_logical_neg
id|fl.fld_src
)paren
id|fl.fld_src
op_assign
id|DN_FIB_RES_PREFSRC
c_func
(paren
id|res
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev_out
)paren
id|dev_put
c_func
(paren
id|dev_out
)paren
suffix:semicolon
id|dev_out
op_assign
id|DN_FIB_RES_DEV
c_func
(paren
id|res
)paren
suffix:semicolon
id|dev_hold
c_func
(paren
id|dev_out
)paren
suffix:semicolon
id|fl.oif
op_assign
id|dev_out-&gt;ifindex
suffix:semicolon
id|gateway
op_assign
id|DN_FIB_RES_GW
c_func
(paren
id|res
)paren
suffix:semicolon
id|make_route
suffix:colon
r_if
c_cond
(paren
id|dev_out-&gt;flags
op_amp
id|IFF_LOOPBACK
)paren
id|flags
op_or_assign
id|RTCF_LOCAL
suffix:semicolon
id|rt
op_assign
id|dst_alloc
c_func
(paren
op_amp
id|dn_dst_ops
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rt
op_eq
l_int|NULL
)paren
r_goto
id|e_nobufs
suffix:semicolon
id|atomic_set
c_func
(paren
op_amp
id|rt-&gt;u.dst.__refcnt
comma
l_int|1
)paren
suffix:semicolon
id|rt-&gt;u.dst.flags
op_assign
id|DST_HOST
suffix:semicolon
id|rt-&gt;fl.fld_src
op_assign
id|oldflp-&gt;fld_src
suffix:semicolon
id|rt-&gt;fl.fld_dst
op_assign
id|oldflp-&gt;fld_dst
suffix:semicolon
id|rt-&gt;fl.oif
op_assign
id|oldflp-&gt;oif
suffix:semicolon
id|rt-&gt;fl.iif
op_assign
l_int|0
suffix:semicolon
macro_line|#ifdef CONFIG_DECNET_ROUTE_FWMARK
id|rt-&gt;fl.fld_fwmark
op_assign
id|oldflp-&gt;fld_fwmark
suffix:semicolon
macro_line|#endif
id|rt-&gt;rt_saddr
op_assign
id|fl.fld_src
suffix:semicolon
id|rt-&gt;rt_daddr
op_assign
id|fl.fld_dst
suffix:semicolon
id|rt-&gt;rt_gateway
op_assign
id|gateway
ques
c_cond
id|gateway
suffix:colon
id|fl.fld_dst
suffix:semicolon
id|rt-&gt;rt_local_src
op_assign
id|fl.fld_src
suffix:semicolon
id|rt-&gt;rt_dst_map
op_assign
id|fl.fld_dst
suffix:semicolon
id|rt-&gt;rt_src_map
op_assign
id|fl.fld_src
suffix:semicolon
id|rt-&gt;u.dst.dev
op_assign
id|dev_out
suffix:semicolon
id|dev_hold
c_func
(paren
id|dev_out
)paren
suffix:semicolon
id|rt-&gt;u.dst.neighbour
op_assign
id|neigh
suffix:semicolon
id|neigh
op_assign
l_int|NULL
suffix:semicolon
id|rt-&gt;u.dst.lastuse
op_assign
id|jiffies
suffix:semicolon
id|rt-&gt;u.dst.output
op_assign
id|dn_output
suffix:semicolon
id|rt-&gt;u.dst.input
op_assign
id|dn_rt_bug
suffix:semicolon
id|rt-&gt;rt_flags
op_assign
id|flags
suffix:semicolon
r_if
c_cond
(paren
id|flags
op_amp
id|RTCF_LOCAL
)paren
id|rt-&gt;u.dst.input
op_assign
id|dn_nsp_rx
suffix:semicolon
id|err
op_assign
id|dn_rt_set_next_hop
c_func
(paren
id|rt
comma
op_amp
id|res
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_goto
id|e_neighbour
suffix:semicolon
id|hash
op_assign
id|dn_hash
c_func
(paren
id|rt-&gt;fl.fld_src
comma
id|rt-&gt;fl.fld_dst
)paren
suffix:semicolon
id|dn_insert_route
c_func
(paren
id|rt
comma
id|hash
comma
(paren
r_struct
id|dn_route
op_star
op_star
)paren
id|pprt
)paren
suffix:semicolon
id|done
suffix:colon
r_if
c_cond
(paren
id|neigh
)paren
id|neigh_release
c_func
(paren
id|neigh
)paren
suffix:semicolon
r_if
c_cond
(paren
id|free_res
)paren
id|dn_fib_res_put
c_func
(paren
op_amp
id|res
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev_out
)paren
id|dev_put
c_func
(paren
id|dev_out
)paren
suffix:semicolon
id|out
suffix:colon
r_return
id|err
suffix:semicolon
id|e_addr
suffix:colon
id|err
op_assign
op_minus
id|EADDRNOTAVAIL
suffix:semicolon
r_goto
id|done
suffix:semicolon
id|e_inval
suffix:colon
id|err
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_goto
id|done
suffix:semicolon
id|e_nobufs
suffix:colon
id|err
op_assign
op_minus
id|ENOBUFS
suffix:semicolon
r_goto
id|done
suffix:semicolon
id|e_neighbour
suffix:colon
id|dst_free
c_func
(paren
op_amp
id|rt-&gt;u.dst
)paren
suffix:semicolon
r_goto
id|e_nobufs
suffix:semicolon
)brace
multiline_comment|/*&n; * N.B. The flags may be moved into the flowi at some future stage.&n; */
DECL|function|__dn_route_output_key
r_static
r_int
id|__dn_route_output_key
c_func
(paren
r_struct
id|dst_entry
op_star
op_star
id|pprt
comma
r_const
r_struct
id|flowi
op_star
id|flp
comma
r_int
id|flags
)paren
(brace
r_int
id|hash
op_assign
id|dn_hash
c_func
(paren
id|flp-&gt;fld_src
comma
id|flp-&gt;fld_dst
)paren
suffix:semicolon
r_struct
id|dn_route
op_star
id|rt
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|flags
op_amp
id|MSG_TRYHARD
)paren
)paren
(brace
id|rcu_read_lock_bh
c_func
(paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|rt
op_assign
id|rcu_dereference
c_func
(paren
id|dn_rt_hash_table
(braket
id|hash
)braket
dot
id|chain
)paren
suffix:semicolon
id|rt
suffix:semicolon
id|rt
op_assign
id|rcu_dereference
c_func
(paren
id|rt-&gt;u.rt_next
)paren
)paren
(brace
r_if
c_cond
(paren
(paren
id|flp-&gt;fld_dst
op_eq
id|rt-&gt;fl.fld_dst
)paren
op_logical_and
(paren
id|flp-&gt;fld_src
op_eq
id|rt-&gt;fl.fld_src
)paren
op_logical_and
macro_line|#ifdef CONFIG_DECNET_ROUTE_FWMARK
(paren
id|flp-&gt;fld_fwmark
op_eq
id|rt-&gt;fl.fld_fwmark
)paren
op_logical_and
macro_line|#endif
(paren
id|rt-&gt;fl.iif
op_eq
l_int|0
)paren
op_logical_and
(paren
id|rt-&gt;fl.oif
op_eq
id|flp-&gt;oif
)paren
)paren
(brace
id|rt-&gt;u.dst.lastuse
op_assign
id|jiffies
suffix:semicolon
id|dst_hold
c_func
(paren
op_amp
id|rt-&gt;u.dst
)paren
suffix:semicolon
id|rt-&gt;u.dst.__use
op_increment
suffix:semicolon
id|rcu_read_unlock_bh
c_func
(paren
)paren
suffix:semicolon
op_star
id|pprt
op_assign
op_amp
id|rt-&gt;u.dst
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
id|rcu_read_unlock_bh
c_func
(paren
)paren
suffix:semicolon
)brace
r_return
id|dn_route_output_slow
c_func
(paren
id|pprt
comma
id|flp
comma
id|flags
)paren
suffix:semicolon
)brace
DECL|function|dn_route_output_key
r_static
r_int
id|dn_route_output_key
c_func
(paren
r_struct
id|dst_entry
op_star
op_star
id|pprt
comma
r_struct
id|flowi
op_star
id|flp
comma
r_int
id|flags
)paren
(brace
r_int
id|err
suffix:semicolon
id|err
op_assign
id|__dn_route_output_key
c_func
(paren
id|pprt
comma
id|flp
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
op_eq
l_int|0
op_logical_and
id|flp-&gt;proto
)paren
(brace
id|err
op_assign
id|xfrm_lookup
c_func
(paren
id|pprt
comma
id|flp
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
)brace
r_return
id|err
suffix:semicolon
)brace
DECL|function|dn_route_output_sock
r_int
id|dn_route_output_sock
c_func
(paren
r_struct
id|dst_entry
op_star
op_star
id|pprt
comma
r_struct
id|flowi
op_star
id|fl
comma
r_struct
id|sock
op_star
id|sk
comma
r_int
id|flags
)paren
(brace
r_int
id|err
suffix:semicolon
id|err
op_assign
id|__dn_route_output_key
c_func
(paren
id|pprt
comma
id|fl
comma
id|flags
op_amp
id|MSG_TRYHARD
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
op_eq
l_int|0
op_logical_and
id|fl-&gt;proto
)paren
(brace
id|err
op_assign
id|xfrm_lookup
c_func
(paren
id|pprt
comma
id|fl
comma
id|sk
comma
op_logical_neg
(paren
id|flags
op_amp
id|MSG_DONTWAIT
)paren
)paren
suffix:semicolon
)brace
r_return
id|err
suffix:semicolon
)brace
DECL|function|dn_route_input_slow
r_static
r_int
id|dn_route_input_slow
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|dn_route
op_star
id|rt
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|dn_skb_cb
op_star
id|cb
op_assign
id|DN_SKB_CB
c_func
(paren
id|skb
)paren
suffix:semicolon
r_struct
id|net_device
op_star
id|in_dev
op_assign
id|skb-&gt;dev
suffix:semicolon
r_struct
id|net_device
op_star
id|out_dev
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|dn_dev
op_star
id|dn_db
suffix:semicolon
r_struct
id|neighbour
op_star
id|neigh
op_assign
l_int|NULL
suffix:semicolon
r_int
id|hash
suffix:semicolon
r_int
id|flags
op_assign
l_int|0
suffix:semicolon
id|__u16
id|gateway
op_assign
l_int|0
suffix:semicolon
id|__u16
id|local_src
op_assign
l_int|0
suffix:semicolon
r_struct
id|flowi
id|fl
op_assign
(brace
dot
id|nl_u
op_assign
(brace
dot
id|dn_u
op_assign
(brace
dot
id|daddr
op_assign
id|cb-&gt;dst
comma
dot
id|saddr
op_assign
id|cb-&gt;src
comma
dot
id|scope
op_assign
id|RT_SCOPE_UNIVERSE
comma
macro_line|#ifdef CONFIG_DECNET_ROUTE_FWMARK
dot
id|fwmark
op_assign
id|skb-&gt;nfmark
macro_line|#endif
)brace
)brace
comma
dot
id|iif
op_assign
id|skb-&gt;dev-&gt;ifindex
)brace
suffix:semicolon
r_struct
id|dn_fib_res
id|res
op_assign
(brace
dot
id|fi
op_assign
l_int|NULL
comma
dot
id|type
op_assign
id|RTN_UNREACHABLE
)brace
suffix:semicolon
r_int
id|err
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_int
id|free_res
op_assign
l_int|0
suffix:semicolon
id|dev_hold
c_func
(paren
id|in_dev
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|dn_db
op_assign
id|in_dev-&gt;dn_ptr
)paren
op_eq
l_int|NULL
)paren
r_goto
id|out
suffix:semicolon
multiline_comment|/* Zero source addresses are not allowed */
r_if
c_cond
(paren
id|fl.fld_src
op_eq
l_int|0
)paren
r_goto
id|out
suffix:semicolon
multiline_comment|/*&n;&t; * In this case we&squot;ve just received a packet from a source&n;&t; * outside ourselves pretending to come from us. We don&squot;t&n;&t; * allow it any further to prevent routing loops, spoofing and&n;&t; * other nasties. Loopback packets already have the dst attached&n;&t; * so this only affects packets which have originated elsewhere.&n;&t; */
id|err
op_assign
op_minus
id|ENOTUNIQ
suffix:semicolon
r_if
c_cond
(paren
id|dn_dev_islocal
c_func
(paren
id|in_dev
comma
id|cb-&gt;src
)paren
)paren
r_goto
id|out
suffix:semicolon
id|err
op_assign
id|dn_fib_lookup
c_func
(paren
op_amp
id|fl
comma
op_amp
id|res
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
r_if
c_cond
(paren
id|err
op_ne
op_minus
id|ESRCH
)paren
r_goto
id|out
suffix:semicolon
multiline_comment|/*&n;&t;&t; * Is the destination us ?&n;&t;&t; */
r_if
c_cond
(paren
op_logical_neg
id|dn_dev_islocal
c_func
(paren
id|in_dev
comma
id|cb-&gt;dst
)paren
)paren
r_goto
id|e_inval
suffix:semicolon
id|res.type
op_assign
id|RTN_LOCAL
suffix:semicolon
id|flags
op_or_assign
id|RTCF_DIRECTSRC
suffix:semicolon
)brace
r_else
(brace
id|__u16
id|src_map
op_assign
id|fl.fld_src
suffix:semicolon
id|free_res
op_assign
l_int|1
suffix:semicolon
id|out_dev
op_assign
id|DN_FIB_RES_DEV
c_func
(paren
id|res
)paren
suffix:semicolon
r_if
c_cond
(paren
id|out_dev
op_eq
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
id|net_ratelimit
c_func
(paren
)paren
)paren
id|printk
c_func
(paren
id|KERN_CRIT
l_string|&quot;Bug in dn_route_input_slow() &quot;
l_string|&quot;No output device&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|e_inval
suffix:semicolon
)brace
id|dev_hold
c_func
(paren
id|out_dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|res.r
)paren
id|src_map
op_assign
id|dn_fib_rules_policy
c_func
(paren
id|fl.fld_src
comma
op_amp
id|res
comma
op_amp
id|flags
)paren
suffix:semicolon
id|gateway
op_assign
id|DN_FIB_RES_GW
c_func
(paren
id|res
)paren
suffix:semicolon
r_if
c_cond
(paren
id|res.type
op_eq
id|RTN_NAT
)paren
(brace
id|fl.fld_dst
op_assign
id|dn_fib_rules_map_destination
c_func
(paren
id|fl.fld_dst
comma
op_amp
id|res
)paren
suffix:semicolon
id|dn_fib_res_put
c_func
(paren
op_amp
id|res
)paren
suffix:semicolon
id|free_res
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|dn_fib_lookup
c_func
(paren
op_amp
id|fl
comma
op_amp
id|res
)paren
)paren
r_goto
id|e_inval
suffix:semicolon
id|free_res
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|res.type
op_ne
id|RTN_UNICAST
)paren
r_goto
id|e_inval
suffix:semicolon
id|flags
op_or_assign
id|RTCF_DNAT
suffix:semicolon
id|gateway
op_assign
id|fl.fld_dst
suffix:semicolon
)brace
id|fl.fld_src
op_assign
id|src_map
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|res.type
)paren
(brace
r_case
id|RTN_UNICAST
suffix:colon
multiline_comment|/*&n;&t;&t; * Forwarding check here, we only check for forwarding&n;&t;&t; * being turned off, if you want to only forward intra&n;&t;&t; * area, its up to you to set the routing tables up&n;&t;&t; * correctly.&n;&t;&t; */
r_if
c_cond
(paren
id|dn_db-&gt;parms.forwarding
op_eq
l_int|0
)paren
r_goto
id|e_inval
suffix:semicolon
r_if
c_cond
(paren
id|res.fi-&gt;fib_nhs
OG
l_int|1
op_logical_and
id|fl.oif
op_eq
l_int|0
)paren
id|dn_fib_select_multipath
c_func
(paren
op_amp
id|fl
comma
op_amp
id|res
)paren
suffix:semicolon
multiline_comment|/* &n;&t;&t; * Check for out_dev == in_dev. We use the RTCF_DOREDIRECT&n;&t;&t; * flag as a hint to set the intra-ethernet bit when&n;&t;&t; * forwarding. If we&squot;ve got NAT in operation, we don&squot;t do&n;&t;&t; * this optimisation.&n;&t;&t; */
r_if
c_cond
(paren
id|out_dev
op_eq
id|in_dev
op_logical_and
op_logical_neg
(paren
id|flags
op_amp
id|RTCF_NAT
)paren
)paren
id|flags
op_or_assign
id|RTCF_DOREDIRECT
suffix:semicolon
id|local_src
op_assign
id|DN_FIB_RES_PREFSRC
c_func
(paren
id|res
)paren
suffix:semicolon
r_case
id|RTN_BLACKHOLE
suffix:colon
r_case
id|RTN_UNREACHABLE
suffix:colon
r_break
suffix:semicolon
r_case
id|RTN_LOCAL
suffix:colon
id|flags
op_or_assign
id|RTCF_LOCAL
suffix:semicolon
id|fl.fld_src
op_assign
id|cb-&gt;dst
suffix:semicolon
id|fl.fld_dst
op_assign
id|cb-&gt;src
suffix:semicolon
multiline_comment|/* Routing tables gave us a gateway */
r_if
c_cond
(paren
id|gateway
)paren
r_goto
id|make_route
suffix:semicolon
multiline_comment|/* Packet was intra-ethernet, so we know its on-link */
r_if
c_cond
(paren
id|cb-&gt;rt_flags
op_or
id|DN_RT_F_IE
)paren
(brace
id|gateway
op_assign
id|cb-&gt;src
suffix:semicolon
id|flags
op_or_assign
id|RTCF_DIRECTSRC
suffix:semicolon
r_goto
id|make_route
suffix:semicolon
)brace
multiline_comment|/* Use the default router if there is one */
id|neigh
op_assign
id|neigh_clone
c_func
(paren
id|dn_db-&gt;router
)paren
suffix:semicolon
r_if
c_cond
(paren
id|neigh
)paren
(brace
id|gateway
op_assign
(paren
(paren
r_struct
id|dn_neigh
op_star
)paren
id|neigh
)paren
op_member_access_from_pointer
id|addr
suffix:semicolon
r_goto
id|make_route
suffix:semicolon
)brace
multiline_comment|/* Close eyes and pray */
id|gateway
op_assign
id|cb-&gt;src
suffix:semicolon
id|flags
op_or_assign
id|RTCF_DIRECTSRC
suffix:semicolon
r_goto
id|make_route
suffix:semicolon
r_default
suffix:colon
r_goto
id|e_inval
suffix:semicolon
)brace
id|make_route
suffix:colon
id|rt
op_assign
id|dst_alloc
c_func
(paren
op_amp
id|dn_dst_ops
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rt
op_eq
l_int|NULL
)paren
r_goto
id|e_nobufs
suffix:semicolon
id|rt-&gt;rt_saddr
op_assign
id|fl.fld_src
suffix:semicolon
id|rt-&gt;rt_daddr
op_assign
id|fl.fld_dst
suffix:semicolon
id|rt-&gt;rt_gateway
op_assign
id|fl.fld_dst
suffix:semicolon
r_if
c_cond
(paren
id|gateway
)paren
id|rt-&gt;rt_gateway
op_assign
id|gateway
suffix:semicolon
id|rt-&gt;rt_local_src
op_assign
id|local_src
ques
c_cond
id|local_src
suffix:colon
id|rt-&gt;rt_saddr
suffix:semicolon
id|rt-&gt;rt_dst_map
op_assign
id|fl.fld_dst
suffix:semicolon
id|rt-&gt;rt_src_map
op_assign
id|fl.fld_src
suffix:semicolon
id|rt-&gt;fl.fld_src
op_assign
id|cb-&gt;src
suffix:semicolon
id|rt-&gt;fl.fld_dst
op_assign
id|cb-&gt;dst
suffix:semicolon
id|rt-&gt;fl.oif
op_assign
l_int|0
suffix:semicolon
id|rt-&gt;fl.iif
op_assign
id|in_dev-&gt;ifindex
suffix:semicolon
id|rt-&gt;fl.fld_fwmark
op_assign
id|fl.fld_fwmark
suffix:semicolon
id|rt-&gt;u.dst.flags
op_assign
id|DST_HOST
suffix:semicolon
id|rt-&gt;u.dst.neighbour
op_assign
id|neigh
suffix:semicolon
id|rt-&gt;u.dst.dev
op_assign
id|out_dev
suffix:semicolon
id|rt-&gt;u.dst.lastuse
op_assign
id|jiffies
suffix:semicolon
id|rt-&gt;u.dst.output
op_assign
id|dn_rt_bug
suffix:semicolon
r_switch
c_cond
(paren
id|res.type
)paren
(brace
r_case
id|RTN_UNICAST
suffix:colon
id|rt-&gt;u.dst.input
op_assign
id|dn_forward
suffix:semicolon
r_break
suffix:semicolon
r_case
id|RTN_LOCAL
suffix:colon
id|rt-&gt;u.dst.output
op_assign
id|dn_output
suffix:semicolon
id|rt-&gt;u.dst.input
op_assign
id|dn_nsp_rx
suffix:semicolon
id|rt-&gt;u.dst.dev
op_assign
id|in_dev
suffix:semicolon
id|flags
op_or_assign
id|RTCF_LOCAL
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_case
id|RTN_UNREACHABLE
suffix:colon
r_case
id|RTN_BLACKHOLE
suffix:colon
id|rt-&gt;u.dst.input
op_assign
id|dn_blackhole
suffix:semicolon
)brace
id|rt-&gt;rt_flags
op_assign
id|flags
suffix:semicolon
r_if
c_cond
(paren
id|rt-&gt;u.dst.dev
)paren
id|dev_hold
c_func
(paren
id|rt-&gt;u.dst.dev
)paren
suffix:semicolon
id|err
op_assign
id|dn_rt_set_next_hop
c_func
(paren
id|rt
comma
op_amp
id|res
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_goto
id|e_neighbour
suffix:semicolon
id|hash
op_assign
id|dn_hash
c_func
(paren
id|rt-&gt;fl.fld_src
comma
id|rt-&gt;fl.fld_dst
)paren
suffix:semicolon
id|dn_insert_route
c_func
(paren
id|rt
comma
id|hash
comma
(paren
r_struct
id|dn_route
op_star
op_star
)paren
op_amp
id|skb-&gt;dst
)paren
suffix:semicolon
id|done
suffix:colon
r_if
c_cond
(paren
id|neigh
)paren
id|neigh_release
c_func
(paren
id|neigh
)paren
suffix:semicolon
r_if
c_cond
(paren
id|free_res
)paren
id|dn_fib_res_put
c_func
(paren
op_amp
id|res
)paren
suffix:semicolon
id|dev_put
c_func
(paren
id|in_dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|out_dev
)paren
id|dev_put
c_func
(paren
id|out_dev
)paren
suffix:semicolon
id|out
suffix:colon
r_return
id|err
suffix:semicolon
id|e_inval
suffix:colon
id|err
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_goto
id|done
suffix:semicolon
id|e_nobufs
suffix:colon
id|err
op_assign
op_minus
id|ENOBUFS
suffix:semicolon
r_goto
id|done
suffix:semicolon
id|e_neighbour
suffix:colon
id|dst_free
c_func
(paren
op_amp
id|rt-&gt;u.dst
)paren
suffix:semicolon
r_goto
id|done
suffix:semicolon
)brace
DECL|function|dn_route_input
r_int
id|dn_route_input
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|dn_route
op_star
id|rt
suffix:semicolon
r_struct
id|dn_skb_cb
op_star
id|cb
op_assign
id|DN_SKB_CB
c_func
(paren
id|skb
)paren
suffix:semicolon
r_int
id|hash
op_assign
id|dn_hash
c_func
(paren
id|cb-&gt;src
comma
id|cb-&gt;dst
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb-&gt;dst
)paren
r_return
l_int|0
suffix:semicolon
id|rcu_read_lock
c_func
(paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|rt
op_assign
id|rcu_dereference
c_func
(paren
id|dn_rt_hash_table
(braket
id|hash
)braket
dot
id|chain
)paren
suffix:semicolon
id|rt
op_ne
l_int|NULL
suffix:semicolon
id|rt
op_assign
id|rcu_dereference
c_func
(paren
id|rt-&gt;u.rt_next
)paren
)paren
(brace
r_if
c_cond
(paren
(paren
id|rt-&gt;fl.fld_src
op_eq
id|cb-&gt;src
)paren
op_logical_and
(paren
id|rt-&gt;fl.fld_dst
op_eq
id|cb-&gt;dst
)paren
op_logical_and
(paren
id|rt-&gt;fl.oif
op_eq
l_int|0
)paren
op_logical_and
macro_line|#ifdef CONFIG_DECNET_ROUTE_FWMARK
(paren
id|rt-&gt;fl.fld_fwmark
op_eq
id|skb-&gt;nfmark
)paren
op_logical_and
macro_line|#endif
(paren
id|rt-&gt;fl.iif
op_eq
id|cb-&gt;iif
)paren
)paren
(brace
id|rt-&gt;u.dst.lastuse
op_assign
id|jiffies
suffix:semicolon
id|dst_hold
c_func
(paren
op_amp
id|rt-&gt;u.dst
)paren
suffix:semicolon
id|rt-&gt;u.dst.__use
op_increment
suffix:semicolon
id|rcu_read_unlock
c_func
(paren
)paren
suffix:semicolon
id|skb-&gt;dst
op_assign
(paren
r_struct
id|dst_entry
op_star
)paren
id|rt
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
id|rcu_read_unlock
c_func
(paren
)paren
suffix:semicolon
r_return
id|dn_route_input_slow
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
DECL|function|dn_rt_fill_info
r_static
r_int
id|dn_rt_fill_info
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
id|u32
id|pid
comma
id|u32
id|seq
comma
r_int
id|event
comma
r_int
id|nowait
)paren
(brace
r_struct
id|dn_route
op_star
id|rt
op_assign
(paren
r_struct
id|dn_route
op_star
)paren
id|skb-&gt;dst
suffix:semicolon
r_struct
id|rtmsg
op_star
id|r
suffix:semicolon
r_struct
id|nlmsghdr
op_star
id|nlh
suffix:semicolon
r_int
r_char
op_star
id|b
op_assign
id|skb-&gt;tail
suffix:semicolon
r_struct
id|rta_cacheinfo
id|ci
suffix:semicolon
id|nlh
op_assign
id|NLMSG_PUT
c_func
(paren
id|skb
comma
id|pid
comma
id|seq
comma
id|event
comma
r_sizeof
(paren
op_star
id|r
)paren
)paren
suffix:semicolon
id|r
op_assign
id|NLMSG_DATA
c_func
(paren
id|nlh
)paren
suffix:semicolon
id|nlh-&gt;nlmsg_flags
op_assign
(paren
id|nowait
op_logical_and
id|pid
)paren
ques
c_cond
id|NLM_F_MULTI
suffix:colon
l_int|0
suffix:semicolon
id|r-&gt;rtm_family
op_assign
id|AF_DECnet
suffix:semicolon
id|r-&gt;rtm_dst_len
op_assign
l_int|16
suffix:semicolon
id|r-&gt;rtm_src_len
op_assign
l_int|0
suffix:semicolon
id|r-&gt;rtm_tos
op_assign
l_int|0
suffix:semicolon
id|r-&gt;rtm_table
op_assign
id|RT_TABLE_MAIN
suffix:semicolon
id|r-&gt;rtm_type
op_assign
id|rt-&gt;rt_type
suffix:semicolon
id|r-&gt;rtm_flags
op_assign
(paren
id|rt-&gt;rt_flags
op_amp
op_complement
l_int|0xFFFF
)paren
op_or
id|RTM_F_CLONED
suffix:semicolon
id|r-&gt;rtm_scope
op_assign
id|RT_SCOPE_UNIVERSE
suffix:semicolon
id|r-&gt;rtm_protocol
op_assign
id|RTPROT_UNSPEC
suffix:semicolon
r_if
c_cond
(paren
id|rt-&gt;rt_flags
op_amp
id|RTCF_NOTIFY
)paren
id|r-&gt;rtm_flags
op_or_assign
id|RTM_F_NOTIFY
suffix:semicolon
id|RTA_PUT
c_func
(paren
id|skb
comma
id|RTA_DST
comma
l_int|2
comma
op_amp
id|rt-&gt;rt_daddr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rt-&gt;fl.fld_src
)paren
(brace
id|r-&gt;rtm_src_len
op_assign
l_int|16
suffix:semicolon
id|RTA_PUT
c_func
(paren
id|skb
comma
id|RTA_SRC
comma
l_int|2
comma
op_amp
id|rt-&gt;fl.fld_src
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|rt-&gt;u.dst.dev
)paren
id|RTA_PUT
c_func
(paren
id|skb
comma
id|RTA_OIF
comma
r_sizeof
(paren
r_int
)paren
comma
op_amp
id|rt-&gt;u.dst.dev-&gt;ifindex
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Note to self - change this if input routes reverse direction when&n;&t; * they deal only with inputs and not with replies like they do&n;&t; * currently.&n;&t; */
id|RTA_PUT
c_func
(paren
id|skb
comma
id|RTA_PREFSRC
comma
l_int|2
comma
op_amp
id|rt-&gt;rt_local_src
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rt-&gt;rt_daddr
op_ne
id|rt-&gt;rt_gateway
)paren
id|RTA_PUT
c_func
(paren
id|skb
comma
id|RTA_GATEWAY
comma
l_int|2
comma
op_amp
id|rt-&gt;rt_gateway
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rtnetlink_put_metrics
c_func
(paren
id|skb
comma
id|rt-&gt;u.dst.metrics
)paren
OL
l_int|0
)paren
r_goto
id|rtattr_failure
suffix:semicolon
id|ci.rta_lastuse
op_assign
id|jiffies_to_clock_t
c_func
(paren
id|jiffies
op_minus
id|rt-&gt;u.dst.lastuse
)paren
suffix:semicolon
id|ci.rta_used
op_assign
id|rt-&gt;u.dst.__use
suffix:semicolon
id|ci.rta_clntref
op_assign
id|atomic_read
c_func
(paren
op_amp
id|rt-&gt;u.dst.__refcnt
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rt-&gt;u.dst.expires
)paren
id|ci.rta_expires
op_assign
id|jiffies_to_clock_t
c_func
(paren
id|rt-&gt;u.dst.expires
op_minus
id|jiffies
)paren
suffix:semicolon
r_else
id|ci.rta_expires
op_assign
l_int|0
suffix:semicolon
id|ci.rta_error
op_assign
id|rt-&gt;u.dst.error
suffix:semicolon
id|ci.rta_id
op_assign
id|ci.rta_ts
op_assign
id|ci.rta_tsage
op_assign
l_int|0
suffix:semicolon
id|RTA_PUT
c_func
(paren
id|skb
comma
id|RTA_CACHEINFO
comma
r_sizeof
(paren
id|ci
)paren
comma
op_amp
id|ci
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rt-&gt;fl.iif
)paren
id|RTA_PUT
c_func
(paren
id|skb
comma
id|RTA_IIF
comma
r_sizeof
(paren
r_int
)paren
comma
op_amp
id|rt-&gt;fl.iif
)paren
suffix:semicolon
id|nlh-&gt;nlmsg_len
op_assign
id|skb-&gt;tail
op_minus
id|b
suffix:semicolon
r_return
id|skb-&gt;len
suffix:semicolon
id|nlmsg_failure
suffix:colon
id|rtattr_failure
suffix:colon
id|skb_trim
c_func
(paren
id|skb
comma
id|b
op_minus
id|skb-&gt;data
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
multiline_comment|/*&n; * This is called by both endnodes and routers now.&n; */
DECL|function|dn_cache_getroute
r_int
id|dn_cache_getroute
c_func
(paren
r_struct
id|sk_buff
op_star
id|in_skb
comma
r_struct
id|nlmsghdr
op_star
id|nlh
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|rtattr
op_star
op_star
id|rta
op_assign
id|arg
suffix:semicolon
r_struct
id|rtmsg
op_star
id|rtm
op_assign
id|NLMSG_DATA
c_func
(paren
id|nlh
)paren
suffix:semicolon
r_struct
id|dn_route
op_star
id|rt
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|dn_skb_cb
op_star
id|cb
suffix:semicolon
r_int
id|err
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_struct
id|flowi
id|fl
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|fl
comma
l_int|0
comma
r_sizeof
(paren
id|fl
)paren
)paren
suffix:semicolon
id|fl.proto
op_assign
id|DNPROTO_NSP
suffix:semicolon
id|skb
op_assign
id|alloc_skb
c_func
(paren
id|NLMSG_GOODSIZE
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOBUFS
suffix:semicolon
id|skb-&gt;mac.raw
op_assign
id|skb-&gt;data
suffix:semicolon
id|cb
op_assign
id|DN_SKB_CB
c_func
(paren
id|skb
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rta
(braket
id|RTA_SRC
op_minus
l_int|1
)braket
)paren
id|memcpy
c_func
(paren
op_amp
id|fl.fld_src
comma
id|RTA_DATA
c_func
(paren
id|rta
(braket
id|RTA_SRC
op_minus
l_int|1
)braket
)paren
comma
l_int|2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rta
(braket
id|RTA_DST
op_minus
l_int|1
)braket
)paren
id|memcpy
c_func
(paren
op_amp
id|fl.fld_dst
comma
id|RTA_DATA
c_func
(paren
id|rta
(braket
id|RTA_DST
op_minus
l_int|1
)braket
)paren
comma
l_int|2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rta
(braket
id|RTA_IIF
op_minus
l_int|1
)braket
)paren
id|memcpy
c_func
(paren
op_amp
id|fl.iif
comma
id|RTA_DATA
c_func
(paren
id|rta
(braket
id|RTA_IIF
op_minus
l_int|1
)braket
)paren
comma
r_sizeof
(paren
r_int
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fl.iif
)paren
(brace
r_struct
id|net_device
op_star
id|dev
suffix:semicolon
r_if
c_cond
(paren
(paren
id|dev
op_assign
id|dev_get_by_index
c_func
(paren
id|fl.iif
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|dev-&gt;dn_ptr
)paren
(brace
id|dev_put
c_func
(paren
id|dev
)paren
suffix:semicolon
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|skb-&gt;protocol
op_assign
id|__constant_htons
c_func
(paren
id|ETH_P_DNA_RT
)paren
suffix:semicolon
id|skb-&gt;dev
op_assign
id|dev
suffix:semicolon
id|cb-&gt;src
op_assign
id|fl.fld_src
suffix:semicolon
id|cb-&gt;dst
op_assign
id|fl.fld_dst
suffix:semicolon
id|local_bh_disable
c_func
(paren
)paren
suffix:semicolon
id|err
op_assign
id|dn_route_input
c_func
(paren
id|skb
)paren
suffix:semicolon
id|local_bh_enable
c_func
(paren
)paren
suffix:semicolon
id|memset
c_func
(paren
id|cb
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|dn_skb_cb
)paren
)paren
suffix:semicolon
id|rt
op_assign
(paren
r_struct
id|dn_route
op_star
)paren
id|skb-&gt;dst
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|err
op_logical_and
op_minus
id|rt-&gt;u.dst.error
)paren
id|err
op_assign
id|rt-&gt;u.dst.error
suffix:semicolon
)brace
r_else
(brace
r_int
id|oif
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|rta
(braket
id|RTA_OIF
op_minus
l_int|1
)braket
)paren
id|memcpy
c_func
(paren
op_amp
id|oif
comma
id|RTA_DATA
c_func
(paren
id|rta
(braket
id|RTA_OIF
op_minus
l_int|1
)braket
)paren
comma
r_sizeof
(paren
r_int
)paren
)paren
suffix:semicolon
id|fl.oif
op_assign
id|oif
suffix:semicolon
id|err
op_assign
id|dn_route_output_key
c_func
(paren
(paren
r_struct
id|dst_entry
op_star
op_star
)paren
op_amp
id|rt
comma
op_amp
id|fl
comma
l_int|0
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|skb-&gt;dev
)paren
id|dev_put
c_func
(paren
id|skb-&gt;dev
)paren
suffix:semicolon
id|skb-&gt;dev
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_goto
id|out_free
suffix:semicolon
id|skb-&gt;dst
op_assign
op_amp
id|rt-&gt;u.dst
suffix:semicolon
r_if
c_cond
(paren
id|rtm-&gt;rtm_flags
op_amp
id|RTM_F_NOTIFY
)paren
id|rt-&gt;rt_flags
op_or_assign
id|RTCF_NOTIFY
suffix:semicolon
id|NETLINK_CB
c_func
(paren
id|skb
)paren
dot
id|dst_pid
op_assign
id|NETLINK_CB
c_func
(paren
id|in_skb
)paren
dot
id|pid
suffix:semicolon
id|err
op_assign
id|dn_rt_fill_info
c_func
(paren
id|skb
comma
id|NETLINK_CB
c_func
(paren
id|in_skb
)paren
dot
id|pid
comma
id|nlh-&gt;nlmsg_seq
comma
id|RTM_NEWROUTE
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
op_eq
l_int|0
)paren
r_goto
id|out_free
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
(brace
id|err
op_assign
op_minus
id|EMSGSIZE
suffix:semicolon
r_goto
id|out_free
suffix:semicolon
)brace
id|err
op_assign
id|netlink_unicast
c_func
(paren
id|rtnl
comma
id|skb
comma
id|NETLINK_CB
c_func
(paren
id|in_skb
)paren
dot
id|pid
comma
id|MSG_DONTWAIT
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
id|out_free
suffix:colon
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
multiline_comment|/*&n; * For routers, this is called from dn_fib_dump, but for endnodes its&n; * called directly from the rtnetlink dispatch table.&n; */
DECL|function|dn_cache_dump
r_int
id|dn_cache_dump
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|netlink_callback
op_star
id|cb
)paren
(brace
r_struct
id|dn_route
op_star
id|rt
suffix:semicolon
r_int
id|h
comma
id|s_h
suffix:semicolon
r_int
id|idx
comma
id|s_idx
suffix:semicolon
r_if
c_cond
(paren
id|NLMSG_PAYLOAD
c_func
(paren
id|cb-&gt;nlh
comma
l_int|0
)paren
OL
r_sizeof
(paren
r_struct
id|rtmsg
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
(paren
(paren
r_struct
id|rtmsg
op_star
)paren
id|NLMSG_DATA
c_func
(paren
id|cb-&gt;nlh
)paren
)paren
op_member_access_from_pointer
id|rtm_flags
op_amp
id|RTM_F_CLONED
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|s_h
op_assign
id|cb-&gt;args
(braket
l_int|0
)braket
suffix:semicolon
id|s_idx
op_assign
id|idx
op_assign
id|cb-&gt;args
(braket
l_int|1
)braket
suffix:semicolon
r_for
c_loop
(paren
id|h
op_assign
l_int|0
suffix:semicolon
id|h
op_le
id|dn_rt_hash_mask
suffix:semicolon
id|h
op_increment
)paren
(brace
r_if
c_cond
(paren
id|h
OL
id|s_h
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|h
OG
id|s_h
)paren
id|s_idx
op_assign
l_int|0
suffix:semicolon
id|rcu_read_lock_bh
c_func
(paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|rt
op_assign
id|rcu_dereference
c_func
(paren
id|dn_rt_hash_table
(braket
id|h
)braket
dot
id|chain
)paren
comma
id|idx
op_assign
l_int|0
suffix:semicolon
id|rt
suffix:semicolon
id|rt
op_assign
id|rcu_dereference
c_func
(paren
id|rt-&gt;u.rt_next
)paren
comma
id|idx
op_increment
)paren
(brace
r_if
c_cond
(paren
id|idx
OL
id|s_idx
)paren
r_continue
suffix:semicolon
id|skb-&gt;dst
op_assign
id|dst_clone
c_func
(paren
op_amp
id|rt-&gt;u.dst
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dn_rt_fill_info
c_func
(paren
id|skb
comma
id|NETLINK_CB
c_func
(paren
id|cb-&gt;skb
)paren
dot
id|pid
comma
id|cb-&gt;nlh-&gt;nlmsg_seq
comma
id|RTM_NEWROUTE
comma
l_int|1
)paren
op_le
l_int|0
)paren
(brace
id|dst_release
c_func
(paren
id|xchg
c_func
(paren
op_amp
id|skb-&gt;dst
comma
l_int|NULL
)paren
)paren
suffix:semicolon
id|rcu_read_unlock_bh
c_func
(paren
)paren
suffix:semicolon
r_goto
id|done
suffix:semicolon
)brace
id|dst_release
c_func
(paren
id|xchg
c_func
(paren
op_amp
id|skb-&gt;dst
comma
l_int|NULL
)paren
)paren
suffix:semicolon
)brace
id|rcu_read_unlock_bh
c_func
(paren
)paren
suffix:semicolon
)brace
id|done
suffix:colon
id|cb-&gt;args
(braket
l_int|0
)braket
op_assign
id|h
suffix:semicolon
id|cb-&gt;args
(braket
l_int|1
)braket
op_assign
id|idx
suffix:semicolon
r_return
id|skb-&gt;len
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_PROC_FS
DECL|struct|dn_rt_cache_iter_state
r_struct
id|dn_rt_cache_iter_state
(brace
DECL|member|bucket
r_int
id|bucket
suffix:semicolon
)brace
suffix:semicolon
DECL|function|dn_rt_cache_get_first
r_static
r_struct
id|dn_route
op_star
id|dn_rt_cache_get_first
c_func
(paren
r_struct
id|seq_file
op_star
id|seq
)paren
(brace
r_struct
id|dn_route
op_star
id|rt
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|dn_rt_cache_iter_state
op_star
id|s
op_assign
id|seq
op_member_access_from_pointer
r_private
suffix:semicolon
r_for
c_loop
(paren
id|s-&gt;bucket
op_assign
id|dn_rt_hash_mask
suffix:semicolon
id|s-&gt;bucket
op_ge
l_int|0
suffix:semicolon
op_decrement
id|s-&gt;bucket
)paren
(brace
id|rcu_read_lock_bh
c_func
(paren
)paren
suffix:semicolon
id|rt
op_assign
id|dn_rt_hash_table
(braket
id|s-&gt;bucket
)braket
dot
id|chain
suffix:semicolon
r_if
c_cond
(paren
id|rt
)paren
r_break
suffix:semicolon
id|rcu_read_unlock_bh
c_func
(paren
)paren
suffix:semicolon
)brace
r_return
id|rt
suffix:semicolon
)brace
DECL|function|dn_rt_cache_get_next
r_static
r_struct
id|dn_route
op_star
id|dn_rt_cache_get_next
c_func
(paren
r_struct
id|seq_file
op_star
id|seq
comma
r_struct
id|dn_route
op_star
id|rt
)paren
(brace
r_struct
id|dn_rt_cache_iter_state
op_star
id|s
op_assign
id|rcu_dereference
c_func
(paren
id|seq
op_member_access_from_pointer
r_private
)paren
suffix:semicolon
id|rt
op_assign
id|rt-&gt;u.rt_next
suffix:semicolon
r_while
c_loop
(paren
op_logical_neg
id|rt
)paren
(brace
id|rcu_read_unlock_bh
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_decrement
id|s-&gt;bucket
OL
l_int|0
)paren
r_break
suffix:semicolon
id|rcu_read_lock_bh
c_func
(paren
)paren
suffix:semicolon
id|rt
op_assign
id|dn_rt_hash_table
(braket
id|s-&gt;bucket
)braket
dot
id|chain
suffix:semicolon
)brace
r_return
id|rt
suffix:semicolon
)brace
DECL|function|dn_rt_cache_seq_start
r_static
r_void
op_star
id|dn_rt_cache_seq_start
c_func
(paren
r_struct
id|seq_file
op_star
id|seq
comma
id|loff_t
op_star
id|pos
)paren
(brace
r_struct
id|dn_route
op_star
id|rt
op_assign
id|dn_rt_cache_get_first
c_func
(paren
id|seq
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rt
)paren
(brace
r_while
c_loop
(paren
op_star
id|pos
op_logical_and
(paren
id|rt
op_assign
id|dn_rt_cache_get_next
c_func
(paren
id|seq
comma
id|rt
)paren
)paren
)paren
(brace
op_decrement
op_star
id|pos
suffix:semicolon
)brace
)brace
r_return
op_star
id|pos
ques
c_cond
l_int|NULL
suffix:colon
id|rt
suffix:semicolon
)brace
DECL|function|dn_rt_cache_seq_next
r_static
r_void
op_star
id|dn_rt_cache_seq_next
c_func
(paren
r_struct
id|seq_file
op_star
id|seq
comma
r_void
op_star
id|v
comma
id|loff_t
op_star
id|pos
)paren
(brace
r_struct
id|dn_route
op_star
id|rt
op_assign
id|dn_rt_cache_get_next
c_func
(paren
id|seq
comma
id|v
)paren
suffix:semicolon
op_increment
op_star
id|pos
suffix:semicolon
r_return
id|rt
suffix:semicolon
)brace
DECL|function|dn_rt_cache_seq_stop
r_static
r_void
id|dn_rt_cache_seq_stop
c_func
(paren
r_struct
id|seq_file
op_star
id|seq
comma
r_void
op_star
id|v
)paren
(brace
r_if
c_cond
(paren
id|v
)paren
id|rcu_read_unlock_bh
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|dn_rt_cache_seq_show
r_static
r_int
id|dn_rt_cache_seq_show
c_func
(paren
r_struct
id|seq_file
op_star
id|seq
comma
r_void
op_star
id|v
)paren
(brace
r_struct
id|dn_route
op_star
id|rt
op_assign
id|v
suffix:semicolon
r_char
id|buf1
(braket
id|DN_ASCBUF_LEN
)braket
comma
id|buf2
(braket
id|DN_ASCBUF_LEN
)braket
suffix:semicolon
id|seq_printf
c_func
(paren
id|seq
comma
l_string|&quot;%-8s %-7s %-7s %04d %04d %04d&bslash;n&quot;
comma
id|rt-&gt;u.dst.dev
ques
c_cond
id|rt-&gt;u.dst.dev-&gt;name
suffix:colon
l_string|&quot;*&quot;
comma
id|dn_addr2asc
c_func
(paren
id|dn_ntohs
c_func
(paren
id|rt-&gt;rt_daddr
)paren
comma
id|buf1
)paren
comma
id|dn_addr2asc
c_func
(paren
id|dn_ntohs
c_func
(paren
id|rt-&gt;rt_saddr
)paren
comma
id|buf2
)paren
comma
id|atomic_read
c_func
(paren
op_amp
id|rt-&gt;u.dst.__refcnt
)paren
comma
id|rt-&gt;u.dst.__use
comma
(paren
r_int
)paren
id|dst_metric
c_func
(paren
op_amp
id|rt-&gt;u.dst
comma
id|RTAX_RTT
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|dn_rt_cache_seq_ops
r_static
r_struct
id|seq_operations
id|dn_rt_cache_seq_ops
op_assign
(brace
dot
id|start
op_assign
id|dn_rt_cache_seq_start
comma
dot
id|next
op_assign
id|dn_rt_cache_seq_next
comma
dot
id|stop
op_assign
id|dn_rt_cache_seq_stop
comma
dot
id|show
op_assign
id|dn_rt_cache_seq_show
comma
)brace
suffix:semicolon
DECL|function|dn_rt_cache_seq_open
r_static
r_int
id|dn_rt_cache_seq_open
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
(brace
r_struct
id|seq_file
op_star
id|seq
suffix:semicolon
r_int
id|rc
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_struct
id|dn_rt_cache_iter_state
op_star
id|s
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|s
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|s
)paren
r_goto
id|out
suffix:semicolon
id|rc
op_assign
id|seq_open
c_func
(paren
id|file
comma
op_amp
id|dn_rt_cache_seq_ops
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_goto
id|out_kfree
suffix:semicolon
id|seq
op_assign
id|file-&gt;private_data
suffix:semicolon
id|seq
op_member_access_from_pointer
r_private
op_assign
id|s
suffix:semicolon
id|memset
c_func
(paren
id|s
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|s
)paren
)paren
suffix:semicolon
id|out
suffix:colon
r_return
id|rc
suffix:semicolon
id|out_kfree
suffix:colon
id|kfree
c_func
(paren
id|s
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
DECL|variable|dn_rt_cache_seq_fops
r_static
r_struct
id|file_operations
id|dn_rt_cache_seq_fops
op_assign
(brace
dot
id|owner
op_assign
id|THIS_MODULE
comma
dot
id|open
op_assign
id|dn_rt_cache_seq_open
comma
dot
id|read
op_assign
id|seq_read
comma
dot
id|llseek
op_assign
id|seq_lseek
comma
dot
id|release
op_assign
id|seq_release_private
comma
)brace
suffix:semicolon
macro_line|#endif /* CONFIG_PROC_FS */
DECL|function|dn_route_init
r_void
id|__init
id|dn_route_init
c_func
(paren
r_void
)paren
(brace
r_int
id|i
comma
id|goal
comma
id|order
suffix:semicolon
id|dn_dst_ops.kmem_cachep
op_assign
id|kmem_cache_create
c_func
(paren
l_string|&quot;dn_dst_cache&quot;
comma
r_sizeof
(paren
r_struct
id|dn_route
)paren
comma
l_int|0
comma
id|SLAB_HWCACHE_ALIGN
comma
l_int|NULL
comma
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dn_dst_ops.kmem_cachep
)paren
id|panic
c_func
(paren
l_string|&quot;DECnet: Failed to allocate dn_dst_cache&bslash;n&quot;
)paren
suffix:semicolon
id|init_timer
c_func
(paren
op_amp
id|dn_route_timer
)paren
suffix:semicolon
id|dn_route_timer.function
op_assign
id|dn_dst_check_expire
suffix:semicolon
id|dn_route_timer.expires
op_assign
id|jiffies
op_plus
id|decnet_dst_gc_interval
op_star
id|HZ
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|dn_route_timer
)paren
suffix:semicolon
id|goal
op_assign
id|num_physpages
op_rshift
(paren
l_int|26
op_minus
id|PAGE_SHIFT
)paren
suffix:semicolon
r_for
c_loop
(paren
id|order
op_assign
l_int|0
suffix:semicolon
(paren
l_int|1UL
op_lshift
id|order
)paren
OL
id|goal
suffix:semicolon
id|order
op_increment
)paren
(brace
multiline_comment|/* NOTHING */
suffix:semicolon
)brace
multiline_comment|/*&n;         * Only want 1024 entries max, since the table is very, very unlikely&n;         * to be larger than that.&n;         */
r_while
c_loop
(paren
id|order
op_logical_and
(paren
(paren
(paren
(paren
l_int|1UL
op_lshift
id|order
)paren
op_star
id|PAGE_SIZE
)paren
op_div
r_sizeof
(paren
r_struct
id|dn_rt_hash_bucket
)paren
)paren
op_ge
l_int|2048
)paren
)paren
(brace
id|order
op_decrement
suffix:semicolon
)brace
r_do
(brace
id|dn_rt_hash_mask
op_assign
(paren
l_int|1UL
op_lshift
id|order
)paren
op_star
id|PAGE_SIZE
op_div
r_sizeof
(paren
r_struct
id|dn_rt_hash_bucket
)paren
suffix:semicolon
r_while
c_loop
(paren
id|dn_rt_hash_mask
op_amp
(paren
id|dn_rt_hash_mask
op_minus
l_int|1
)paren
)paren
(brace
id|dn_rt_hash_mask
op_decrement
suffix:semicolon
)brace
id|dn_rt_hash_table
op_assign
(paren
r_struct
id|dn_rt_hash_bucket
op_star
)paren
id|__get_free_pages
c_func
(paren
id|GFP_ATOMIC
comma
id|order
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
id|dn_rt_hash_table
op_eq
l_int|NULL
op_logical_and
op_decrement
id|order
OG
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dn_rt_hash_table
)paren
id|panic
c_func
(paren
l_string|&quot;Failed to allocate DECnet route cache hash table&bslash;n&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;DECnet: Routing cache hash table of %u buckets, %ldKbytes&bslash;n&quot;
comma
id|dn_rt_hash_mask
comma
(paren
r_int
)paren
(paren
id|dn_rt_hash_mask
op_star
r_sizeof
(paren
r_struct
id|dn_rt_hash_bucket
)paren
)paren
op_div
l_int|1024
)paren
suffix:semicolon
id|dn_rt_hash_mask
op_decrement
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
op_le
id|dn_rt_hash_mask
suffix:semicolon
id|i
op_increment
)paren
(brace
id|spin_lock_init
c_func
(paren
op_amp
id|dn_rt_hash_table
(braket
id|i
)braket
dot
id|lock
)paren
suffix:semicolon
id|dn_rt_hash_table
(braket
id|i
)braket
dot
id|chain
op_assign
l_int|NULL
suffix:semicolon
)brace
id|dn_dst_ops.gc_thresh
op_assign
(paren
id|dn_rt_hash_mask
op_plus
l_int|1
)paren
suffix:semicolon
id|proc_net_fops_create
c_func
(paren
l_string|&quot;decnet_cache&quot;
comma
id|S_IRUGO
comma
op_amp
id|dn_rt_cache_seq_fops
)paren
suffix:semicolon
)brace
DECL|function|dn_route_cleanup
r_void
id|__exit
id|dn_route_cleanup
c_func
(paren
r_void
)paren
(brace
id|del_timer
c_func
(paren
op_amp
id|dn_route_timer
)paren
suffix:semicolon
id|dn_run_flush
c_func
(paren
l_int|0
)paren
suffix:semicolon
id|proc_net_remove
c_func
(paren
l_string|&quot;decnet_cache&quot;
)paren
suffix:semicolon
)brace
eof
