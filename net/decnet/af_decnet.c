multiline_comment|/*&n; * DECnet       An implementation of the DECnet protocol suite for the LINUX&n; *              operating system.  DECnet is implemented using the  BSD Socket&n; *              interface as the means of communication with the user level.&n; *&n; *              DECnet Socket Layer Interface&n; *&n; * Authors:     Eduardo Marcelo Serrat &lt;emserrat@geocities.com&gt;&n; *              Patrick Caulfield &lt;patrick@pandh.demon.co.uk&gt;&n; *&n; * Changes:&n; *        Steve Whitehouse: Copied from Eduardo Serrat and Patrick Caulfield&squot;s&n; *                          version of the code. Original copyright preserved&n; *                          below.&n; *        Steve Whitehouse: Some bug fixes, cleaning up some code to make it&n; *                          compatible with my routing layer.&n; *        Steve Whitehouse: Merging changes from Eduardo Serrat and Patrick&n; *                          Caulfield.&n; *        Steve Whitehouse: Further bug fixes, checking module code still works&n; *                          with new routing layer.&n; *        Steve Whitehouse: Additional set/get_sockopt() calls.&n; *        Steve Whitehouse: Fixed TIOCINQ ioctl to be same as Eduardo&squot;s new&n; *                          code.&n; *        Steve Whitehouse: recvmsg() changed to try and behave in a POSIX like&n; *                          way. Didn&squot;t manage it entirely, but its better.&n; *        Steve Whitehouse: ditto for sendmsg().&n; *        Steve Whitehouse: A selection of bug fixes to various things.&n; *        Steve Whitehouse: Added TIOCOUTQ ioctl.&n; *        Steve Whitehouse: Fixes to username2sockaddr &amp; sockaddr2username.&n; *        Steve Whitehouse: Fixes to connect() error returns.&n; *       Patrick Caulfield: Fixes to delayed acceptance logic.&n; *         David S. Miller: New socket locking&n; *        Steve Whitehouse: Socket list hashing/locking&n; *         Arnaldo C. Melo: use capable, not suser&n; *        Steve Whitehouse: Removed unused code. Fix to use sk-&gt;allocation&n; *                          when required.&n; *       Patrick Caulfield: /proc/net/decnet now has object name/number&n; *        Steve Whitehouse: Fixed local port allocation, hashed sk list&n; *          Matthew Wilcox: Fixes for dn_ioctl()&n; *        Steve Whitehouse: New connect/accept logic to allow timeouts and&n; *                          prepare for sendpage etc.&n; */
multiline_comment|/******************************************************************************&n;    (c) 1995-1998 E.M. Serrat&t;&t;emserrat@geocities.com&n;    &n;    This program is free software; you can redistribute it and/or modify&n;    it under the terms of the GNU General Public License as published by&n;    the Free Software Foundation; either version 2 of the License, or&n;    any later version.&n;&n;    This program is distributed in the hope that it will be useful,&n;    but WITHOUT ANY WARRANTY; without even the implied warranty of&n;    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n;    GNU General Public License for more details.&n;&n;HISTORY:&n;&n;Version           Kernel     Date       Author/Comments&n;-------           ------     ----       ---------------&n;Version 0.0.1     2.0.30    01-dic-97&t;Eduardo Marcelo Serrat&n;&t;&t;&t;&t;&t;(emserrat@geocities.com)&n;&n;                                        First Development of DECnet Socket La-&n;&t;&t;&t;&t;&t;yer for Linux. Only supports outgoing&n;&t;&t;&t;&t;&t;connections.&n;&n;Version 0.0.2&t;  2.1.105   20-jun-98   Patrick J. Caulfield&n;&t;&t;&t;&t;&t;(patrick@pandh.demon.co.uk)&n;&n;&t;&t;&t;&t;&t;Port to new kernel development version.&n;&n;Version 0.0.3     2.1.106   25-jun-98   Eduardo Marcelo Serrat&n;&t;&t;&t;&t;&t;(emserrat@geocities.com)&n;&t;&t;&t;&t;&t;_&n;                                        Added support for incoming connections&n;                                        so we can start developing server apps&n;                                        on Linux.&n;&t;&t;&t;&t;&t;-&n;&t;&t;&t;&t;&t;Module Support&n;Version 0.0.4     2.1.109   21-jul-98   Eduardo Marcelo Serrat&n;                                       (emserrat@geocities.com)&n;                                       _&n;                                        Added support for X11R6.4. Now we can &n;                                        use DECnet transport for X on Linux!!!&n;                                       -&n;Version 0.0.5    2.1.110   01-aug-98   Eduardo Marcelo Serrat&n;                                       (emserrat@geocities.com)&n;                                       Removed bugs on flow control&n;                                       Removed bugs on incoming accessdata&n;                                       order&n;                                       -&n;Version 0.0.6    2.1.110   07-aug-98   Eduardo Marcelo Serrat&n;                                       dn_recvmsg fixes&n;&n;                                        Patrick J. Caulfield&n;                                       dn_bind fixes&n;*******************************************************************************/
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/socket.h&gt;
macro_line|#include &lt;linux/in.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/timer.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/sockios.h&gt;
macro_line|#include &lt;linux/net.h&gt;
macro_line|#include &lt;linux/netdevice.h&gt;
macro_line|#include &lt;linux/inet.h&gt;
macro_line|#include &lt;linux/route.h&gt;
macro_line|#include &lt;linux/netfilter.h&gt;
macro_line|#include &lt;linux/seq_file.h&gt;
macro_line|#include &lt;net/sock.h&gt;
macro_line|#include &lt;net/tcp.h&gt;
macro_line|#include &lt;net/flow.h&gt;
macro_line|#include &lt;asm/system.h&gt;
macro_line|#include &lt;asm/ioctls.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/proc_fs.h&gt;
macro_line|#include &lt;linux/stat.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/poll.h&gt;
macro_line|#include &lt;net/neighbour.h&gt;
macro_line|#include &lt;net/dst.h&gt;
macro_line|#include &lt;net/dn.h&gt;
macro_line|#include &lt;net/dn_nsp.h&gt;
macro_line|#include &lt;net/dn_dev.h&gt;
macro_line|#include &lt;net/dn_route.h&gt;
macro_line|#include &lt;net/dn_fib.h&gt;
macro_line|#include &lt;net/dn_neigh.h&gt;
DECL|struct|dn_sock
r_struct
id|dn_sock
(brace
DECL|member|sk
r_struct
id|sock
id|sk
suffix:semicolon
DECL|member|scp
r_struct
id|dn_scp
id|scp
suffix:semicolon
)brace
suffix:semicolon
r_static
r_void
id|dn_keepalive
c_func
(paren
r_struct
id|sock
op_star
id|sk
)paren
suffix:semicolon
DECL|macro|DN_SK_HASH_SHIFT
mdefine_line|#define DN_SK_HASH_SHIFT 8
DECL|macro|DN_SK_HASH_SIZE
mdefine_line|#define DN_SK_HASH_SIZE (1 &lt;&lt; DN_SK_HASH_SHIFT)
DECL|macro|DN_SK_HASH_MASK
mdefine_line|#define DN_SK_HASH_MASK (DN_SK_HASH_SIZE - 1)
DECL|variable|dn_sk_cachep
r_static
id|kmem_cache_t
op_star
id|dn_sk_cachep
suffix:semicolon
DECL|variable|dn_proto_ops
r_static
r_struct
id|proto_ops
id|dn_proto_ops
suffix:semicolon
DECL|variable|dn_hash_lock
r_static
id|rwlock_t
id|dn_hash_lock
op_assign
id|RW_LOCK_UNLOCKED
suffix:semicolon
DECL|variable|dn_sk_hash
r_static
r_struct
id|hlist_head
id|dn_sk_hash
(braket
id|DN_SK_HASH_SIZE
)braket
suffix:semicolon
DECL|variable|dn_wild_sk
r_static
r_struct
id|hlist_head
id|dn_wild_sk
suffix:semicolon
r_static
r_int
id|__dn_setsockopt
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_int
id|level
comma
r_int
id|optname
comma
r_char
op_star
id|optval
comma
r_int
id|optlen
comma
r_int
id|flags
)paren
suffix:semicolon
r_static
r_int
id|__dn_getsockopt
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_int
id|level
comma
r_int
id|optname
comma
r_char
op_star
id|optval
comma
r_int
op_star
id|optlen
comma
r_int
id|flags
)paren
suffix:semicolon
DECL|function|dn_find_list
r_static
r_struct
id|hlist_head
op_star
id|dn_find_list
c_func
(paren
r_struct
id|sock
op_star
id|sk
)paren
(brace
r_struct
id|dn_scp
op_star
id|scp
op_assign
id|DN_SK
c_func
(paren
id|sk
)paren
suffix:semicolon
r_if
c_cond
(paren
id|scp-&gt;addr.sdn_flags
op_amp
id|SDF_WILD
)paren
r_return
id|hlist_empty
c_func
(paren
op_amp
id|dn_wild_sk
)paren
ques
c_cond
l_int|NULL
suffix:colon
op_amp
id|dn_wild_sk
suffix:semicolon
r_return
op_amp
id|dn_sk_hash
(braket
id|scp-&gt;addrloc
op_amp
id|DN_SK_HASH_MASK
)braket
suffix:semicolon
)brace
multiline_comment|/* &n; * Valid ports are those greater than zero and not already in use.&n; */
DECL|function|check_port
r_static
r_int
id|check_port
c_func
(paren
r_int
r_int
id|port
)paren
(brace
r_struct
id|sock
op_star
id|sk
suffix:semicolon
r_struct
id|hlist_node
op_star
id|node
suffix:semicolon
r_if
c_cond
(paren
id|port
op_eq
l_int|0
)paren
r_return
op_minus
l_int|1
suffix:semicolon
id|sk_for_each
c_func
(paren
id|sk
comma
id|node
comma
op_amp
id|dn_sk_hash
(braket
id|port
op_amp
id|DN_SK_HASH_MASK
)braket
)paren
(brace
r_struct
id|dn_scp
op_star
id|scp
op_assign
id|DN_SK
c_func
(paren
id|sk
)paren
suffix:semicolon
r_if
c_cond
(paren
id|scp-&gt;addrloc
op_eq
id|port
)paren
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|port_alloc
r_static
r_int
r_int
id|port_alloc
c_func
(paren
r_struct
id|sock
op_star
id|sk
)paren
(brace
r_struct
id|dn_scp
op_star
id|scp
op_assign
id|DN_SK
c_func
(paren
id|sk
)paren
suffix:semicolon
r_static
r_int
r_int
id|port
op_assign
l_int|0x2000
suffix:semicolon
r_int
r_int
id|i_port
op_assign
id|port
suffix:semicolon
r_while
c_loop
(paren
id|check_port
c_func
(paren
op_increment
id|port
)paren
op_ne
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|port
op_eq
id|i_port
)paren
r_return
l_int|0
suffix:semicolon
)brace
id|scp-&gt;addrloc
op_assign
id|port
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
multiline_comment|/*&n; * Since this is only ever called from user&n; * level, we don&squot;t need a write_lock() version&n; * of this.&n; */
DECL|function|dn_hash_sock
r_static
r_int
id|dn_hash_sock
c_func
(paren
r_struct
id|sock
op_star
id|sk
)paren
(brace
r_struct
id|dn_scp
op_star
id|scp
op_assign
id|DN_SK
c_func
(paren
id|sk
)paren
suffix:semicolon
r_struct
id|hlist_head
op_star
id|list
suffix:semicolon
r_int
id|rv
op_assign
op_minus
id|EUSERS
suffix:semicolon
id|BUG_ON
c_func
(paren
id|sk_hashed
c_func
(paren
id|sk
)paren
)paren
suffix:semicolon
id|write_lock_bh
c_func
(paren
op_amp
id|dn_hash_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|scp-&gt;addrloc
op_logical_and
op_logical_neg
id|port_alloc
c_func
(paren
id|sk
)paren
)paren
r_goto
id|out
suffix:semicolon
id|rv
op_assign
op_minus
id|EADDRINUSE
suffix:semicolon
r_if
c_cond
(paren
(paren
id|list
op_assign
id|dn_find_list
c_func
(paren
id|sk
)paren
)paren
op_eq
l_int|NULL
)paren
r_goto
id|out
suffix:semicolon
id|sk_add_node
c_func
(paren
id|sk
comma
id|list
)paren
suffix:semicolon
id|rv
op_assign
l_int|0
suffix:semicolon
id|out
suffix:colon
id|write_unlock_bh
c_func
(paren
op_amp
id|dn_hash_lock
)paren
suffix:semicolon
r_return
id|rv
suffix:semicolon
)brace
DECL|function|dn_unhash_sock
r_static
r_void
id|dn_unhash_sock
c_func
(paren
r_struct
id|sock
op_star
id|sk
)paren
(brace
id|write_lock
c_func
(paren
op_amp
id|dn_hash_lock
)paren
suffix:semicolon
id|sk_del_node_init
c_func
(paren
id|sk
)paren
suffix:semicolon
id|write_unlock
c_func
(paren
op_amp
id|dn_hash_lock
)paren
suffix:semicolon
)brace
DECL|function|dn_unhash_sock_bh
r_static
r_void
id|dn_unhash_sock_bh
c_func
(paren
r_struct
id|sock
op_star
id|sk
)paren
(brace
id|write_lock_bh
c_func
(paren
op_amp
id|dn_hash_lock
)paren
suffix:semicolon
id|sk_del_node_init
c_func
(paren
id|sk
)paren
suffix:semicolon
id|write_unlock_bh
c_func
(paren
op_amp
id|dn_hash_lock
)paren
suffix:semicolon
)brace
DECL|function|listen_hash
r_struct
id|hlist_head
op_star
id|listen_hash
c_func
(paren
r_struct
id|sockaddr_dn
op_star
id|addr
)paren
(brace
r_int
id|i
suffix:semicolon
r_int
id|hash
op_assign
id|addr-&gt;sdn_objnum
suffix:semicolon
r_if
c_cond
(paren
id|hash
op_eq
l_int|0
)paren
(brace
id|hash
op_assign
id|addr-&gt;sdn_objnamel
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|dn_ntohs
c_func
(paren
id|addr-&gt;sdn_objnamel
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
id|hash
op_xor_assign
id|addr-&gt;sdn_objname
(braket
id|i
)braket
suffix:semicolon
id|hash
op_xor_assign
(paren
id|hash
op_lshift
l_int|3
)paren
suffix:semicolon
)brace
)brace
r_return
op_amp
id|dn_sk_hash
(braket
id|hash
op_amp
id|DN_SK_HASH_MASK
)braket
suffix:semicolon
)brace
multiline_comment|/*&n; * Called to transform a socket from bound (i.e. with a local address)&n; * into a listening socket (doesn&squot;t need a local port number) and rehashes&n; * based upon the object name/number.&n; */
DECL|function|dn_rehash_sock
r_static
r_void
id|dn_rehash_sock
c_func
(paren
r_struct
id|sock
op_star
id|sk
)paren
(brace
r_struct
id|hlist_head
op_star
id|list
suffix:semicolon
r_struct
id|dn_scp
op_star
id|scp
op_assign
id|DN_SK
c_func
(paren
id|sk
)paren
suffix:semicolon
r_if
c_cond
(paren
id|scp-&gt;addr.sdn_flags
op_amp
id|SDF_WILD
)paren
r_return
suffix:semicolon
id|write_lock_bh
c_func
(paren
op_amp
id|dn_hash_lock
)paren
suffix:semicolon
id|sk_del_node_init
c_func
(paren
id|sk
)paren
suffix:semicolon
id|DN_SK
c_func
(paren
id|sk
)paren
op_member_access_from_pointer
id|addrloc
op_assign
l_int|0
suffix:semicolon
id|list
op_assign
id|listen_hash
c_func
(paren
op_amp
id|DN_SK
c_func
(paren
id|sk
)paren
op_member_access_from_pointer
id|addr
)paren
suffix:semicolon
id|sk_add_node
c_func
(paren
id|sk
comma
id|list
)paren
suffix:semicolon
id|write_unlock_bh
c_func
(paren
op_amp
id|dn_hash_lock
)paren
suffix:semicolon
)brace
DECL|function|dn_sockaddr2username
r_int
id|dn_sockaddr2username
c_func
(paren
r_struct
id|sockaddr_dn
op_star
id|sdn
comma
r_int
r_char
op_star
id|buf
comma
r_int
r_char
id|type
)paren
(brace
r_int
id|len
op_assign
l_int|2
suffix:semicolon
op_star
id|buf
op_increment
op_assign
id|type
suffix:semicolon
r_switch
c_cond
(paren
id|type
)paren
(brace
r_case
l_int|0
suffix:colon
op_star
id|buf
op_increment
op_assign
id|sdn-&gt;sdn_objnum
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|1
suffix:colon
op_star
id|buf
op_increment
op_assign
l_int|0
suffix:semicolon
op_star
id|buf
op_increment
op_assign
id|dn_ntohs
c_func
(paren
id|sdn-&gt;sdn_objnamel
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|buf
comma
id|sdn-&gt;sdn_objname
comma
id|dn_ntohs
c_func
(paren
id|sdn-&gt;sdn_objnamel
)paren
)paren
suffix:semicolon
id|len
op_assign
l_int|3
op_plus
id|dn_ntohs
c_func
(paren
id|sdn-&gt;sdn_objnamel
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
id|memset
c_func
(paren
id|buf
comma
l_int|0
comma
l_int|5
)paren
suffix:semicolon
id|buf
op_add_assign
l_int|5
suffix:semicolon
op_star
id|buf
op_increment
op_assign
id|dn_ntohs
c_func
(paren
id|sdn-&gt;sdn_objnamel
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|buf
comma
id|sdn-&gt;sdn_objname
comma
id|dn_ntohs
c_func
(paren
id|sdn-&gt;sdn_objnamel
)paren
)paren
suffix:semicolon
id|len
op_assign
l_int|7
op_plus
id|dn_ntohs
c_func
(paren
id|sdn-&gt;sdn_objnamel
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_return
id|len
suffix:semicolon
)brace
multiline_comment|/*&n; * On reception of usernames, we handle types 1 and 0 for destination&n; * addresses only. Types 2 and 4 are used for source addresses, but the&n; * UIC, GIC are ignored and they are both treated the same way. Type 3&n; * is never used as I&squot;ve no idea what its purpose might be or what its&n; * format is.&n; */
DECL|function|dn_username2sockaddr
r_int
id|dn_username2sockaddr
c_func
(paren
r_int
r_char
op_star
id|data
comma
r_int
id|len
comma
r_struct
id|sockaddr_dn
op_star
id|sdn
comma
r_int
r_char
op_star
id|fmt
)paren
(brace
r_int
r_char
id|type
suffix:semicolon
r_int
id|size
op_assign
id|len
suffix:semicolon
r_int
id|namel
op_assign
l_int|12
suffix:semicolon
id|sdn-&gt;sdn_objnum
op_assign
l_int|0
suffix:semicolon
id|sdn-&gt;sdn_objnamel
op_assign
id|dn_htons
c_func
(paren
l_int|0
)paren
suffix:semicolon
id|memset
c_func
(paren
id|sdn-&gt;sdn_objname
comma
l_int|0
comma
id|DN_MAXOBJL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|len
OL
l_int|2
)paren
r_return
op_minus
l_int|1
suffix:semicolon
id|len
op_sub_assign
l_int|2
suffix:semicolon
op_star
id|fmt
op_assign
op_star
id|data
op_increment
suffix:semicolon
id|type
op_assign
op_star
id|data
op_increment
suffix:semicolon
r_switch
c_cond
(paren
op_star
id|fmt
)paren
(brace
r_case
l_int|0
suffix:colon
id|sdn-&gt;sdn_objnum
op_assign
id|type
suffix:semicolon
r_return
l_int|2
suffix:semicolon
r_case
l_int|1
suffix:colon
id|namel
op_assign
l_int|16
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
id|len
op_sub_assign
l_int|4
suffix:semicolon
id|data
op_add_assign
l_int|4
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|4
suffix:colon
id|len
op_sub_assign
l_int|8
suffix:semicolon
id|data
op_add_assign
l_int|8
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|len
op_sub_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|len
OL
l_int|0
)paren
r_return
op_minus
l_int|1
suffix:semicolon
id|sdn-&gt;sdn_objnamel
op_assign
id|dn_htons
c_func
(paren
op_star
id|data
op_increment
)paren
suffix:semicolon
id|len
op_sub_assign
id|dn_ntohs
c_func
(paren
id|sdn-&gt;sdn_objnamel
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|len
OL
l_int|0
)paren
op_logical_or
(paren
id|dn_ntohs
c_func
(paren
id|sdn-&gt;sdn_objnamel
)paren
OG
id|namel
)paren
)paren
r_return
op_minus
l_int|1
suffix:semicolon
id|memcpy
c_func
(paren
id|sdn-&gt;sdn_objname
comma
id|data
comma
id|dn_ntohs
c_func
(paren
id|sdn-&gt;sdn_objnamel
)paren
)paren
suffix:semicolon
r_return
id|size
op_minus
id|len
suffix:semicolon
)brace
DECL|function|dn_sklist_find_listener
r_struct
id|sock
op_star
id|dn_sklist_find_listener
c_func
(paren
r_struct
id|sockaddr_dn
op_star
id|addr
)paren
(brace
r_struct
id|hlist_head
op_star
id|list
op_assign
id|listen_hash
c_func
(paren
id|addr
)paren
suffix:semicolon
r_struct
id|hlist_node
op_star
id|node
suffix:semicolon
r_struct
id|sock
op_star
id|sk
suffix:semicolon
id|read_lock
c_func
(paren
op_amp
id|dn_hash_lock
)paren
suffix:semicolon
id|sk_for_each
c_func
(paren
id|sk
comma
id|node
comma
id|list
)paren
(brace
r_struct
id|dn_scp
op_star
id|scp
op_assign
id|DN_SK
c_func
(paren
id|sk
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;sk_state
op_ne
id|TCP_LISTEN
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|scp-&gt;addr.sdn_objnum
)paren
(brace
r_if
c_cond
(paren
id|scp-&gt;addr.sdn_objnum
op_ne
id|addr-&gt;sdn_objnum
)paren
r_continue
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|addr-&gt;sdn_objnum
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|scp-&gt;addr.sdn_objnamel
op_ne
id|addr-&gt;sdn_objnamel
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|memcmp
c_func
(paren
id|scp-&gt;addr.sdn_objname
comma
id|addr-&gt;sdn_objname
comma
id|dn_ntohs
c_func
(paren
id|addr-&gt;sdn_objnamel
)paren
)paren
op_ne
l_int|0
)paren
r_continue
suffix:semicolon
)brace
id|sock_hold
c_func
(paren
id|sk
)paren
suffix:semicolon
id|read_unlock
c_func
(paren
op_amp
id|dn_hash_lock
)paren
suffix:semicolon
r_return
id|sk
suffix:semicolon
)brace
id|sk
op_assign
id|sk_head
c_func
(paren
op_amp
id|dn_wild_sk
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sk
)paren
(brace
r_if
c_cond
(paren
id|sk-&gt;sk_state
op_eq
id|TCP_LISTEN
)paren
id|sock_hold
c_func
(paren
id|sk
)paren
suffix:semicolon
r_else
id|sk
op_assign
l_int|NULL
suffix:semicolon
)brace
id|read_unlock
c_func
(paren
op_amp
id|dn_hash_lock
)paren
suffix:semicolon
r_return
id|sk
suffix:semicolon
)brace
DECL|function|dn_find_by_skb
r_struct
id|sock
op_star
id|dn_find_by_skb
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|dn_skb_cb
op_star
id|cb
op_assign
id|DN_SKB_CB
c_func
(paren
id|skb
)paren
suffix:semicolon
r_struct
id|sock
op_star
id|sk
suffix:semicolon
r_struct
id|hlist_node
op_star
id|node
suffix:semicolon
r_struct
id|dn_scp
op_star
id|scp
suffix:semicolon
id|read_lock
c_func
(paren
op_amp
id|dn_hash_lock
)paren
suffix:semicolon
id|sk_for_each
c_func
(paren
id|sk
comma
id|node
comma
op_amp
id|dn_sk_hash
(braket
id|cb-&gt;dst_port
op_amp
id|DN_SK_HASH_MASK
)braket
)paren
(brace
id|scp
op_assign
id|DN_SK
c_func
(paren
id|sk
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cb-&gt;src
op_ne
id|dn_saddr2dn
c_func
(paren
op_amp
id|scp-&gt;peer
)paren
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|cb-&gt;dst_port
op_ne
id|scp-&gt;addrloc
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|scp-&gt;addrrem
op_logical_and
(paren
id|cb-&gt;src_port
op_ne
id|scp-&gt;addrrem
)paren
)paren
r_continue
suffix:semicolon
id|sock_hold
c_func
(paren
id|sk
)paren
suffix:semicolon
r_goto
id|found
suffix:semicolon
)brace
id|sk
op_assign
l_int|NULL
suffix:semicolon
id|found
suffix:colon
id|read_unlock
c_func
(paren
op_amp
id|dn_hash_lock
)paren
suffix:semicolon
r_return
id|sk
suffix:semicolon
)brace
DECL|function|dn_destruct
r_static
r_void
id|dn_destruct
c_func
(paren
r_struct
id|sock
op_star
id|sk
)paren
(brace
r_struct
id|dn_scp
op_star
id|scp
op_assign
id|DN_SK
c_func
(paren
id|sk
)paren
suffix:semicolon
id|skb_queue_purge
c_func
(paren
op_amp
id|scp-&gt;data_xmit_queue
)paren
suffix:semicolon
id|skb_queue_purge
c_func
(paren
op_amp
id|scp-&gt;other_xmit_queue
)paren
suffix:semicolon
id|skb_queue_purge
c_func
(paren
op_amp
id|scp-&gt;other_receive_queue
)paren
suffix:semicolon
id|dst_release
c_func
(paren
id|xchg
c_func
(paren
op_amp
id|sk-&gt;sk_dst_cache
comma
l_int|NULL
)paren
)paren
suffix:semicolon
)brace
DECL|function|dn_alloc_sock
r_struct
id|sock
op_star
id|dn_alloc_sock
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_int
id|gfp
)paren
(brace
r_struct
id|dn_scp
op_star
id|scp
suffix:semicolon
r_struct
id|sock
op_star
id|sk
op_assign
id|sk_alloc
c_func
(paren
id|PF_DECnet
comma
id|gfp
comma
r_sizeof
(paren
r_struct
id|dn_sock
)paren
comma
id|dn_sk_cachep
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sk
)paren
r_goto
id|out
suffix:semicolon
id|DN_SK
c_func
(paren
id|sk
)paren
op_assign
id|scp
op_assign
(paren
r_struct
id|dn_scp
op_star
)paren
(paren
id|sk
op_plus
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sock
)paren
id|sock-&gt;ops
op_assign
op_amp
id|dn_proto_ops
suffix:semicolon
id|sock_init_data
c_func
(paren
id|sock
comma
id|sk
)paren
suffix:semicolon
id|sk_set_owner
c_func
(paren
id|sk
comma
id|THIS_MODULE
)paren
suffix:semicolon
id|sk-&gt;sk_backlog_rcv
op_assign
id|dn_nsp_backlog_rcv
suffix:semicolon
id|sk-&gt;sk_destruct
op_assign
id|dn_destruct
suffix:semicolon
id|sk-&gt;sk_no_check
op_assign
l_int|1
suffix:semicolon
id|sk-&gt;sk_family
op_assign
id|PF_DECnet
suffix:semicolon
id|sk-&gt;sk_protocol
op_assign
l_int|0
suffix:semicolon
id|sk-&gt;sk_allocation
op_assign
id|gfp
suffix:semicolon
multiline_comment|/* Initialization of DECnet Session Control Port&t;&t;*/
id|scp-&gt;state
op_assign
id|DN_O
suffix:semicolon
multiline_comment|/* Open&t;&t;&t;*/
id|scp-&gt;numdat
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* Next data seg to tx&t;*/
id|scp-&gt;numoth
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* Next oth data to tx  */
id|scp-&gt;ackxmt_dat
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Last data seg ack&squot;ed */
id|scp-&gt;ackxmt_oth
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Last oth data ack&squot;ed */
id|scp-&gt;ackrcv_dat
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Highest data ack recv*/
id|scp-&gt;ackrcv_oth
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Last oth data ack rec*/
id|scp-&gt;flowrem_sw
op_assign
id|DN_SEND
suffix:semicolon
id|scp-&gt;flowloc_sw
op_assign
id|DN_SEND
suffix:semicolon
id|scp-&gt;flowrem_dat
op_assign
l_int|0
suffix:semicolon
id|scp-&gt;flowrem_oth
op_assign
l_int|1
suffix:semicolon
id|scp-&gt;flowloc_dat
op_assign
l_int|0
suffix:semicolon
id|scp-&gt;flowloc_oth
op_assign
l_int|1
suffix:semicolon
id|scp-&gt;services_rem
op_assign
l_int|0
suffix:semicolon
id|scp-&gt;services_loc
op_assign
l_int|1
op_or
id|NSP_FC_NONE
suffix:semicolon
id|scp-&gt;info_rem
op_assign
l_int|0
suffix:semicolon
id|scp-&gt;info_loc
op_assign
l_int|0x03
suffix:semicolon
multiline_comment|/* NSP version 4.1 */
id|scp-&gt;segsize_rem
op_assign
l_int|230
op_minus
id|DN_MAX_NSP_DATA_HEADER
suffix:semicolon
multiline_comment|/* Default: Updated by remote segsize */
id|scp-&gt;nonagle
op_assign
l_int|0
suffix:semicolon
id|scp-&gt;multi_ireq
op_assign
l_int|1
suffix:semicolon
id|scp-&gt;accept_mode
op_assign
id|ACC_IMMED
suffix:semicolon
id|scp-&gt;addr.sdn_family
op_assign
id|AF_DECnet
suffix:semicolon
id|scp-&gt;peer.sdn_family
op_assign
id|AF_DECnet
suffix:semicolon
id|scp-&gt;accessdata.acc_accl
op_assign
l_int|5
suffix:semicolon
id|memcpy
c_func
(paren
id|scp-&gt;accessdata.acc_acc
comma
l_string|&quot;LINUX&quot;
comma
l_int|5
)paren
suffix:semicolon
id|scp-&gt;max_window
op_assign
id|NSP_MAX_WINDOW
suffix:semicolon
id|scp-&gt;snd_window
op_assign
id|NSP_MIN_WINDOW
suffix:semicolon
id|scp-&gt;nsp_srtt
op_assign
id|NSP_INITIAL_SRTT
suffix:semicolon
id|scp-&gt;nsp_rttvar
op_assign
id|NSP_INITIAL_RTTVAR
suffix:semicolon
id|scp-&gt;nsp_rxtshift
op_assign
l_int|0
suffix:semicolon
id|skb_queue_head_init
c_func
(paren
op_amp
id|scp-&gt;data_xmit_queue
)paren
suffix:semicolon
id|skb_queue_head_init
c_func
(paren
op_amp
id|scp-&gt;other_xmit_queue
)paren
suffix:semicolon
id|skb_queue_head_init
c_func
(paren
op_amp
id|scp-&gt;other_receive_queue
)paren
suffix:semicolon
id|scp-&gt;persist
op_assign
l_int|0
suffix:semicolon
id|scp-&gt;persist_fxn
op_assign
l_int|NULL
suffix:semicolon
id|scp-&gt;keepalive
op_assign
l_int|10
op_star
id|HZ
suffix:semicolon
id|scp-&gt;keepalive_fxn
op_assign
id|dn_keepalive
suffix:semicolon
id|init_timer
c_func
(paren
op_amp
id|scp-&gt;delack_timer
)paren
suffix:semicolon
id|scp-&gt;delack_pending
op_assign
l_int|0
suffix:semicolon
id|scp-&gt;delack_fxn
op_assign
id|dn_nsp_delayed_ack
suffix:semicolon
id|dn_start_slow_timer
c_func
(paren
id|sk
)paren
suffix:semicolon
id|out
suffix:colon
r_return
id|sk
suffix:semicolon
)brace
multiline_comment|/*&n; * Keepalive timer.&n; * FIXME: Should respond to SO_KEEPALIVE etc.&n; */
DECL|function|dn_keepalive
r_static
r_void
id|dn_keepalive
c_func
(paren
r_struct
id|sock
op_star
id|sk
)paren
(brace
r_struct
id|dn_scp
op_star
id|scp
op_assign
id|DN_SK
c_func
(paren
id|sk
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * By checking the other_data transmit queue is empty&n;&t; * we are double checking that we are not sending too&n;&t; * many of these keepalive frames.&n;&t; */
r_if
c_cond
(paren
id|skb_queue_len
c_func
(paren
op_amp
id|scp-&gt;other_xmit_queue
)paren
op_eq
l_int|0
)paren
id|dn_nsp_send_link
c_func
(paren
id|sk
comma
id|DN_NOCHANGE
comma
l_int|0
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Timer for shutdown/destroyed sockets.&n; * When socket is dead &amp; no packets have been sent for a&n; * certain amount of time, they are removed by this&n; * routine. Also takes care of sending out DI &amp; DC&n; * frames at correct times.&n; */
DECL|function|dn_destroy_timer
r_int
id|dn_destroy_timer
c_func
(paren
r_struct
id|sock
op_star
id|sk
)paren
(brace
r_struct
id|dn_scp
op_star
id|scp
op_assign
id|DN_SK
c_func
(paren
id|sk
)paren
suffix:semicolon
id|scp-&gt;persist
op_assign
id|dn_nsp_persist
c_func
(paren
id|sk
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|scp-&gt;state
)paren
(brace
r_case
id|DN_DI
suffix:colon
id|dn_nsp_send_disc
c_func
(paren
id|sk
comma
id|NSP_DISCINIT
comma
l_int|0
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|scp-&gt;nsp_rxtshift
op_ge
id|decnet_di_count
)paren
id|scp-&gt;state
op_assign
id|DN_CN
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|DN_DR
suffix:colon
id|dn_nsp_send_disc
c_func
(paren
id|sk
comma
id|NSP_DISCINIT
comma
l_int|0
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|scp-&gt;nsp_rxtshift
op_ge
id|decnet_dr_count
)paren
id|scp-&gt;state
op_assign
id|DN_DRC
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|DN_DN
suffix:colon
r_if
c_cond
(paren
id|scp-&gt;nsp_rxtshift
OL
id|decnet_dn_count
)paren
(brace
multiline_comment|/* printk(KERN_DEBUG &quot;dn_destroy_timer: DN&bslash;n&quot;); */
id|dn_nsp_send_disc
c_func
(paren
id|sk
comma
id|NSP_DISCCONF
comma
id|NSP_REASON_DC
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
id|scp-&gt;persist
op_assign
(paren
id|HZ
op_star
id|decnet_time_wait
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;sk_socket
)paren
r_return
l_int|0
suffix:semicolon
id|dn_stop_fast_timer
c_func
(paren
id|sk
)paren
suffix:semicolon
multiline_comment|/* unlikely, but possible that this is runninng */
r_if
c_cond
(paren
(paren
id|jiffies
op_minus
id|scp-&gt;stamp
)paren
op_ge
(paren
id|HZ
op_star
id|decnet_time_wait
)paren
)paren
(brace
id|dn_unhash_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
id|sock_put
c_func
(paren
id|sk
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dn_destroy_sock
r_static
r_void
id|dn_destroy_sock
c_func
(paren
r_struct
id|sock
op_star
id|sk
)paren
(brace
r_struct
id|dn_scp
op_star
id|scp
op_assign
id|DN_SK
c_func
(paren
id|sk
)paren
suffix:semicolon
id|scp-&gt;nsp_rxtshift
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* reset back off */
r_if
c_cond
(paren
id|sk-&gt;sk_socket
)paren
(brace
r_if
c_cond
(paren
id|sk-&gt;sk_socket-&gt;state
op_ne
id|SS_UNCONNECTED
)paren
id|sk-&gt;sk_socket-&gt;state
op_assign
id|SS_DISCONNECTING
suffix:semicolon
)brace
id|sk-&gt;sk_state
op_assign
id|TCP_CLOSE
suffix:semicolon
r_switch
c_cond
(paren
id|scp-&gt;state
)paren
(brace
r_case
id|DN_DN
suffix:colon
id|dn_nsp_send_disc
c_func
(paren
id|sk
comma
id|NSP_DISCCONF
comma
id|NSP_REASON_DC
comma
id|sk-&gt;sk_allocation
)paren
suffix:semicolon
id|scp-&gt;persist_fxn
op_assign
id|dn_destroy_timer
suffix:semicolon
id|scp-&gt;persist
op_assign
id|dn_nsp_persist
c_func
(paren
id|sk
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DN_CR
suffix:colon
id|scp-&gt;state
op_assign
id|DN_DR
suffix:semicolon
r_goto
id|disc_reject
suffix:semicolon
r_case
id|DN_RUN
suffix:colon
id|scp-&gt;state
op_assign
id|DN_DI
suffix:semicolon
r_case
id|DN_DI
suffix:colon
r_case
id|DN_DR
suffix:colon
id|disc_reject
suffix:colon
id|dn_nsp_send_disc
c_func
(paren
id|sk
comma
id|NSP_DISCINIT
comma
l_int|0
comma
id|sk-&gt;sk_allocation
)paren
suffix:semicolon
r_case
id|DN_NC
suffix:colon
r_case
id|DN_NR
suffix:colon
r_case
id|DN_RJ
suffix:colon
r_case
id|DN_DIC
suffix:colon
r_case
id|DN_CN
suffix:colon
r_case
id|DN_DRC
suffix:colon
r_case
id|DN_CI
suffix:colon
r_case
id|DN_CD
suffix:colon
id|scp-&gt;persist_fxn
op_assign
id|dn_destroy_timer
suffix:semicolon
id|scp-&gt;persist
op_assign
id|dn_nsp_persist
c_func
(paren
id|sk
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;DECnet: dn_destroy_sock passed socket in invalid state&bslash;n&quot;
)paren
suffix:semicolon
r_case
id|DN_O
suffix:colon
id|dn_stop_fast_timer
c_func
(paren
id|sk
)paren
suffix:semicolon
id|dn_stop_slow_timer
c_func
(paren
id|sk
)paren
suffix:semicolon
id|dn_unhash_sock_bh
c_func
(paren
id|sk
)paren
suffix:semicolon
id|sock_put
c_func
(paren
id|sk
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
DECL|function|dn_addr2asc
r_char
op_star
id|dn_addr2asc
c_func
(paren
id|dn_address
id|addr
comma
r_char
op_star
id|buf
)paren
(brace
r_int
r_int
id|node
comma
id|area
suffix:semicolon
id|node
op_assign
id|addr
op_amp
l_int|0x03ff
suffix:semicolon
id|area
op_assign
id|addr
op_rshift
l_int|10
suffix:semicolon
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%hd.%hd&quot;
comma
id|area
comma
id|node
)paren
suffix:semicolon
r_return
id|buf
suffix:semicolon
)brace
DECL|function|dn_create
r_static
r_int
id|dn_create
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_int
id|protocol
)paren
(brace
r_struct
id|sock
op_star
id|sk
suffix:semicolon
r_switch
c_cond
(paren
id|sock-&gt;type
)paren
(brace
r_case
id|SOCK_SEQPACKET
suffix:colon
r_if
c_cond
(paren
id|protocol
op_ne
id|DNPROTO_NSP
)paren
r_return
op_minus
id|EPROTONOSUPPORT
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SOCK_STREAM
suffix:colon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|ESOCKTNOSUPPORT
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|sk
op_assign
id|dn_alloc_sock
c_func
(paren
id|sock
comma
id|GFP_KERNEL
)paren
)paren
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOBUFS
suffix:semicolon
id|sk-&gt;sk_protocol
op_assign
id|protocol
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|dn_release
id|dn_release
c_func
(paren
r_struct
id|socket
op_star
id|sock
)paren
(brace
r_struct
id|sock
op_star
id|sk
op_assign
id|sock-&gt;sk
suffix:semicolon
r_if
c_cond
(paren
id|sk
)paren
(brace
id|sock_orphan
c_func
(paren
id|sk
)paren
suffix:semicolon
id|sock_hold
c_func
(paren
id|sk
)paren
suffix:semicolon
id|lock_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
id|dn_destroy_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
id|release_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
id|sock_put
c_func
(paren
id|sk
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dn_bind
r_static
r_int
id|dn_bind
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_struct
id|sockaddr
op_star
id|uaddr
comma
r_int
id|addr_len
)paren
(brace
r_struct
id|sock
op_star
id|sk
op_assign
id|sock-&gt;sk
suffix:semicolon
r_struct
id|dn_scp
op_star
id|scp
op_assign
id|DN_SK
c_func
(paren
id|sk
)paren
suffix:semicolon
r_struct
id|sockaddr_dn
op_star
id|saddr
op_assign
(paren
r_struct
id|sockaddr_dn
op_star
)paren
id|uaddr
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
suffix:semicolon
r_int
id|rv
suffix:semicolon
r_if
c_cond
(paren
id|addr_len
op_ne
r_sizeof
(paren
r_struct
id|sockaddr_dn
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|saddr-&gt;sdn_family
op_ne
id|AF_DECnet
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|dn_ntohs
c_func
(paren
id|saddr-&gt;sdn_nodeaddrl
)paren
op_logical_and
(paren
id|dn_ntohs
c_func
(paren
id|saddr-&gt;sdn_nodeaddrl
)paren
op_ne
l_int|2
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|dn_ntohs
c_func
(paren
id|saddr-&gt;sdn_objnamel
)paren
OG
id|DN_MAXOBJL
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|saddr-&gt;sdn_flags
op_amp
op_complement
id|SDF_WILD
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
macro_line|#if 1
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_NET_BIND_SERVICE
)paren
op_logical_and
(paren
id|saddr-&gt;sdn_objnum
op_logical_or
(paren
id|saddr-&gt;sdn_flags
op_amp
id|SDF_WILD
)paren
)paren
)paren
r_return
op_minus
id|EACCES
suffix:semicolon
macro_line|#else
multiline_comment|/*&n;&t; * Maybe put the default actions in the default security ops for&n;&t; * dn_prot_sock ? Would be nice if the capable call would go there&n;&t; * too.&n;&t; */
r_if
c_cond
(paren
id|security_dn_prot_sock
c_func
(paren
id|saddr
)paren
op_logical_and
op_logical_neg
id|capable
c_func
(paren
id|CAP_NET_BIND_SERVICE
)paren
op_logical_or
id|saddr-&gt;sdn_objnum
op_logical_or
(paren
id|saddr-&gt;sdn_flags
op_amp
id|SDF_WILD
)paren
)paren
r_return
op_minus
id|EACCES
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
op_logical_neg
(paren
id|saddr-&gt;sdn_flags
op_amp
id|SDF_WILD
)paren
)paren
(brace
r_if
c_cond
(paren
id|dn_ntohs
c_func
(paren
id|saddr-&gt;sdn_nodeaddrl
)paren
)paren
(brace
id|read_lock
c_func
(paren
op_amp
id|dev_base_lock
)paren
suffix:semicolon
r_for
c_loop
(paren
id|dev
op_assign
id|dev_base
suffix:semicolon
id|dev
suffix:semicolon
id|dev
op_assign
id|dev-&gt;next
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|dev-&gt;dn_ptr
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|dn_dev_islocal
c_func
(paren
id|dev
comma
id|dn_saddr2dn
c_func
(paren
id|saddr
)paren
)paren
)paren
r_break
suffix:semicolon
)brace
id|read_unlock
c_func
(paren
op_amp
id|dev_base_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev
op_eq
l_int|NULL
)paren
r_return
op_minus
id|EADDRNOTAVAIL
suffix:semicolon
)brace
)brace
id|rv
op_assign
op_minus
id|EINVAL
suffix:semicolon
id|lock_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;sk_zapped
)paren
(brace
id|memcpy
c_func
(paren
op_amp
id|scp-&gt;addr
comma
id|saddr
comma
id|addr_len
)paren
suffix:semicolon
id|sk-&gt;sk_zapped
op_assign
l_int|0
suffix:semicolon
id|rv
op_assign
id|dn_hash_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rv
)paren
(brace
id|sk-&gt;sk_zapped
op_assign
l_int|1
suffix:semicolon
)brace
)brace
id|release_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
r_return
id|rv
suffix:semicolon
)brace
DECL|function|dn_auto_bind
r_static
r_int
id|dn_auto_bind
c_func
(paren
r_struct
id|socket
op_star
id|sock
)paren
(brace
r_struct
id|sock
op_star
id|sk
op_assign
id|sock-&gt;sk
suffix:semicolon
r_struct
id|dn_scp
op_star
id|scp
op_assign
id|DN_SK
c_func
(paren
id|sk
)paren
suffix:semicolon
r_int
id|rv
suffix:semicolon
id|sk-&gt;sk_zapped
op_assign
l_int|0
suffix:semicolon
id|scp-&gt;addr.sdn_flags
op_assign
l_int|0
suffix:semicolon
id|scp-&gt;addr.sdn_objnum
op_assign
l_int|0
suffix:semicolon
multiline_comment|/*&n;&t; * This stuff is to keep compatibility with Eduardo&squot;s&n;&t; * patch. I hope I can dispense with it shortly...&n;&t; */
r_if
c_cond
(paren
(paren
id|scp-&gt;accessdata.acc_accl
op_ne
l_int|0
)paren
op_logical_and
(paren
id|scp-&gt;accessdata.acc_accl
op_le
l_int|12
)paren
)paren
(brace
id|scp-&gt;addr.sdn_objnamel
op_assign
id|dn_htons
c_func
(paren
id|scp-&gt;accessdata.acc_accl
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|scp-&gt;addr.sdn_objname
comma
id|scp-&gt;accessdata.acc_acc
comma
id|dn_ntohs
c_func
(paren
id|scp-&gt;addr.sdn_objnamel
)paren
)paren
suffix:semicolon
id|scp-&gt;accessdata.acc_accl
op_assign
l_int|0
suffix:semicolon
id|memset
c_func
(paren
id|scp-&gt;accessdata.acc_acc
comma
l_int|0
comma
l_int|40
)paren
suffix:semicolon
)brace
multiline_comment|/* End of compatibility stuff */
id|scp-&gt;addr.sdn_add.a_len
op_assign
id|dn_htons
c_func
(paren
l_int|2
)paren
suffix:semicolon
id|rv
op_assign
id|dn_dev_bind_default
c_func
(paren
(paren
id|dn_address
op_star
)paren
id|scp-&gt;addr.sdn_add.a_addr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rv
op_eq
l_int|0
)paren
(brace
id|rv
op_assign
id|dn_hash_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rv
)paren
(brace
id|sk-&gt;sk_zapped
op_assign
l_int|1
suffix:semicolon
)brace
)brace
r_return
id|rv
suffix:semicolon
)brace
DECL|function|dn_confirm_accept
r_static
r_int
id|dn_confirm_accept
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_int
op_star
id|timeo
comma
r_int
id|allocation
)paren
(brace
r_struct
id|dn_scp
op_star
id|scp
op_assign
id|DN_SK
c_func
(paren
id|sk
)paren
suffix:semicolon
id|DEFINE_WAIT
c_func
(paren
id|wait
)paren
suffix:semicolon
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
id|scp-&gt;state
op_ne
id|DN_CR
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|scp-&gt;state
op_assign
id|DN_CC
suffix:semicolon
id|scp-&gt;segsize_loc
op_assign
id|dst_path_metric
c_func
(paren
id|__sk_dst_get
c_func
(paren
id|sk
)paren
comma
id|RTAX_ADVMSS
)paren
suffix:semicolon
id|dn_send_conn_conf
c_func
(paren
id|sk
comma
id|allocation
)paren
suffix:semicolon
id|prepare_to_wait
c_func
(paren
id|sk-&gt;sk_sleep
comma
op_amp
id|wait
comma
id|TASK_INTERRUPTIBLE
)paren
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
(brace
id|release_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
r_if
c_cond
(paren
id|scp-&gt;state
op_eq
id|DN_CC
)paren
op_star
id|timeo
op_assign
id|schedule_timeout
c_func
(paren
op_star
id|timeo
)paren
suffix:semicolon
id|lock_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
id|err
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|scp-&gt;state
op_eq
id|DN_RUN
)paren
r_break
suffix:semicolon
id|err
op_assign
id|sock_error
c_func
(paren
id|sk
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_break
suffix:semicolon
id|err
op_assign
id|sock_intr_errno
c_func
(paren
op_star
id|timeo
)paren
suffix:semicolon
r_if
c_cond
(paren
id|signal_pending
c_func
(paren
id|current
)paren
)paren
r_break
suffix:semicolon
id|err
op_assign
op_minus
id|EAGAIN
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
op_star
id|timeo
)paren
r_break
suffix:semicolon
id|prepare_to_wait
c_func
(paren
id|sk-&gt;sk_sleep
comma
op_amp
id|wait
comma
id|TASK_INTERRUPTIBLE
)paren
suffix:semicolon
)brace
id|finish_wait
c_func
(paren
id|sk-&gt;sk_sleep
comma
op_amp
id|wait
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
op_eq
l_int|0
)paren
(brace
id|sk-&gt;sk_socket-&gt;state
op_assign
id|SS_CONNECTED
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|scp-&gt;state
op_ne
id|DN_CC
)paren
(brace
id|sk-&gt;sk_socket-&gt;state
op_assign
id|SS_UNCONNECTED
suffix:semicolon
)brace
r_return
id|err
suffix:semicolon
)brace
DECL|function|dn_wait_run
r_static
r_int
id|dn_wait_run
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_int
op_star
id|timeo
)paren
(brace
r_struct
id|dn_scp
op_star
id|scp
op_assign
id|DN_SK
c_func
(paren
id|sk
)paren
suffix:semicolon
id|DEFINE_WAIT
c_func
(paren
id|wait
)paren
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|scp-&gt;state
op_eq
id|DN_RUN
)paren
r_goto
id|out
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
op_star
id|timeo
)paren
r_return
op_minus
id|EALREADY
suffix:semicolon
id|prepare_to_wait
c_func
(paren
id|sk-&gt;sk_sleep
comma
op_amp
id|wait
comma
id|TASK_INTERRUPTIBLE
)paren
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
(brace
id|release_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
r_if
c_cond
(paren
id|scp-&gt;state
op_eq
id|DN_CI
op_logical_or
id|scp-&gt;state
op_eq
id|DN_CC
)paren
op_star
id|timeo
op_assign
id|schedule_timeout
c_func
(paren
op_star
id|timeo
)paren
suffix:semicolon
id|lock_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
id|err
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|scp-&gt;state
op_eq
id|DN_RUN
)paren
r_break
suffix:semicolon
id|err
op_assign
id|sock_error
c_func
(paren
id|sk
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_break
suffix:semicolon
id|err
op_assign
id|sock_intr_errno
c_func
(paren
op_star
id|timeo
)paren
suffix:semicolon
r_if
c_cond
(paren
id|signal_pending
c_func
(paren
id|current
)paren
)paren
r_break
suffix:semicolon
id|err
op_assign
op_minus
id|ETIMEDOUT
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
op_star
id|timeo
)paren
r_break
suffix:semicolon
id|prepare_to_wait
c_func
(paren
id|sk-&gt;sk_sleep
comma
op_amp
id|wait
comma
id|TASK_INTERRUPTIBLE
)paren
suffix:semicolon
)brace
id|finish_wait
c_func
(paren
id|sk-&gt;sk_sleep
comma
op_amp
id|wait
)paren
suffix:semicolon
id|out
suffix:colon
r_if
c_cond
(paren
id|err
op_eq
l_int|0
)paren
(brace
id|sk-&gt;sk_socket-&gt;state
op_assign
id|SS_CONNECTED
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|scp-&gt;state
op_ne
id|DN_CI
op_logical_and
id|scp-&gt;state
op_ne
id|DN_CC
)paren
(brace
id|sk-&gt;sk_socket-&gt;state
op_assign
id|SS_UNCONNECTED
suffix:semicolon
)brace
r_return
id|err
suffix:semicolon
)brace
DECL|function|__dn_connect
r_static
r_int
id|__dn_connect
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_struct
id|sockaddr_dn
op_star
id|addr
comma
r_int
id|addrlen
comma
r_int
op_star
id|timeo
comma
r_int
id|flags
)paren
(brace
r_struct
id|socket
op_star
id|sock
op_assign
id|sk-&gt;sk_socket
suffix:semicolon
r_struct
id|dn_scp
op_star
id|scp
op_assign
id|DN_SK
c_func
(paren
id|sk
)paren
suffix:semicolon
r_int
id|err
op_assign
op_minus
id|EISCONN
suffix:semicolon
r_struct
id|flowi
id|fl
suffix:semicolon
r_if
c_cond
(paren
id|sock-&gt;state
op_eq
id|SS_CONNECTED
)paren
r_goto
id|out
suffix:semicolon
r_if
c_cond
(paren
id|sock-&gt;state
op_eq
id|SS_CONNECTING
)paren
(brace
id|err
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|scp-&gt;state
op_eq
id|DN_RUN
)paren
(brace
id|sock-&gt;state
op_assign
id|SS_CONNECTED
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|err
op_assign
op_minus
id|ECONNREFUSED
suffix:semicolon
r_if
c_cond
(paren
id|scp-&gt;state
op_ne
id|DN_CI
op_logical_and
id|scp-&gt;state
op_ne
id|DN_CC
)paren
(brace
id|sock-&gt;state
op_assign
id|SS_UNCONNECTED
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_return
id|dn_wait_run
c_func
(paren
id|sk
comma
id|timeo
)paren
suffix:semicolon
)brace
id|err
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|scp-&gt;state
op_ne
id|DN_O
)paren
r_goto
id|out
suffix:semicolon
r_if
c_cond
(paren
id|addr
op_eq
l_int|NULL
op_logical_or
id|addrlen
op_ne
r_sizeof
(paren
r_struct
id|sockaddr_dn
)paren
)paren
r_goto
id|out
suffix:semicolon
r_if
c_cond
(paren
id|addr-&gt;sdn_family
op_ne
id|AF_DECnet
)paren
r_goto
id|out
suffix:semicolon
r_if
c_cond
(paren
id|addr-&gt;sdn_flags
op_amp
id|SDF_WILD
)paren
r_goto
id|out
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;sk_zapped
)paren
(brace
id|err
op_assign
id|dn_auto_bind
c_func
(paren
id|sk-&gt;sk_socket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_goto
id|out
suffix:semicolon
)brace
id|memcpy
c_func
(paren
op_amp
id|scp-&gt;peer
comma
id|addr
comma
r_sizeof
(paren
r_struct
id|sockaddr_dn
)paren
)paren
suffix:semicolon
id|err
op_assign
op_minus
id|EHOSTUNREACH
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|fl
comma
l_int|0
comma
r_sizeof
(paren
id|fl
)paren
)paren
suffix:semicolon
id|fl.oif
op_assign
id|sk-&gt;sk_bound_dev_if
suffix:semicolon
id|fl.fld_dst
op_assign
id|dn_saddr2dn
c_func
(paren
op_amp
id|scp-&gt;peer
)paren
suffix:semicolon
id|fl.fld_src
op_assign
id|dn_saddr2dn
c_func
(paren
op_amp
id|scp-&gt;addr
)paren
suffix:semicolon
id|dn_sk_ports_copy
c_func
(paren
op_amp
id|fl
comma
id|scp
)paren
suffix:semicolon
id|fl.proto
op_assign
id|DNPROTO_NSP
suffix:semicolon
r_if
c_cond
(paren
id|dn_route_output_sock
c_func
(paren
op_amp
id|sk-&gt;sk_dst_cache
comma
op_amp
id|fl
comma
id|sk
comma
id|flags
)paren
OL
l_int|0
)paren
r_goto
id|out
suffix:semicolon
id|sk-&gt;sk_route_caps
op_assign
id|sk-&gt;sk_dst_cache-&gt;dev-&gt;features
suffix:semicolon
id|sock-&gt;state
op_assign
id|SS_CONNECTING
suffix:semicolon
id|scp-&gt;state
op_assign
id|DN_CI
suffix:semicolon
id|scp-&gt;segsize_loc
op_assign
id|dst_path_metric
c_func
(paren
id|sk-&gt;sk_dst_cache
comma
id|RTAX_ADVMSS
)paren
suffix:semicolon
id|dn_nsp_send_conninit
c_func
(paren
id|sk
comma
id|NSP_CI
)paren
suffix:semicolon
id|err
op_assign
op_minus
id|EINPROGRESS
suffix:semicolon
r_if
c_cond
(paren
op_star
id|timeo
)paren
(brace
id|err
op_assign
id|dn_wait_run
c_func
(paren
id|sk
comma
id|timeo
)paren
suffix:semicolon
)brace
id|out
suffix:colon
r_return
id|err
suffix:semicolon
)brace
DECL|function|dn_connect
r_static
r_int
id|dn_connect
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_struct
id|sockaddr
op_star
id|uaddr
comma
r_int
id|addrlen
comma
r_int
id|flags
)paren
(brace
r_struct
id|sockaddr_dn
op_star
id|addr
op_assign
(paren
r_struct
id|sockaddr_dn
op_star
)paren
id|uaddr
suffix:semicolon
r_struct
id|sock
op_star
id|sk
op_assign
id|sock-&gt;sk
suffix:semicolon
r_int
id|err
suffix:semicolon
r_int
id|timeo
op_assign
id|sock_sndtimeo
c_func
(paren
id|sk
comma
id|flags
op_amp
id|O_NONBLOCK
)paren
suffix:semicolon
id|lock_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
id|err
op_assign
id|__dn_connect
c_func
(paren
id|sk
comma
id|addr
comma
id|addrlen
comma
op_amp
id|timeo
comma
l_int|0
)paren
suffix:semicolon
id|release_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|dn_check_state
r_static
r_inline
r_int
id|dn_check_state
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_struct
id|sockaddr_dn
op_star
id|addr
comma
r_int
id|addrlen
comma
r_int
op_star
id|timeo
comma
r_int
id|flags
)paren
(brace
r_struct
id|dn_scp
op_star
id|scp
op_assign
id|DN_SK
c_func
(paren
id|sk
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|scp-&gt;state
)paren
(brace
r_case
id|DN_RUN
suffix:colon
r_return
l_int|0
suffix:semicolon
r_case
id|DN_CR
suffix:colon
r_return
id|dn_confirm_accept
c_func
(paren
id|sk
comma
id|timeo
comma
id|sk-&gt;sk_allocation
)paren
suffix:semicolon
r_case
id|DN_CI
suffix:colon
r_case
id|DN_CC
suffix:colon
r_return
id|dn_wait_run
c_func
(paren
id|sk
comma
id|timeo
)paren
suffix:semicolon
r_case
id|DN_O
suffix:colon
r_return
id|__dn_connect
c_func
(paren
id|sk
comma
id|addr
comma
id|addrlen
comma
id|timeo
comma
id|flags
)paren
suffix:semicolon
)brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
DECL|function|dn_access_copy
r_static
r_void
id|dn_access_copy
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|accessdata_dn
op_star
id|acc
)paren
(brace
r_int
r_char
op_star
id|ptr
op_assign
id|skb-&gt;data
suffix:semicolon
id|acc-&gt;acc_userl
op_assign
op_star
id|ptr
op_increment
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|acc-&gt;acc_user
comma
id|ptr
comma
id|acc-&gt;acc_userl
)paren
suffix:semicolon
id|ptr
op_add_assign
id|acc-&gt;acc_userl
suffix:semicolon
id|acc-&gt;acc_passl
op_assign
op_star
id|ptr
op_increment
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|acc-&gt;acc_pass
comma
id|ptr
comma
id|acc-&gt;acc_passl
)paren
suffix:semicolon
id|ptr
op_add_assign
id|acc-&gt;acc_passl
suffix:semicolon
id|acc-&gt;acc_accl
op_assign
op_star
id|ptr
op_increment
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|acc-&gt;acc_acc
comma
id|ptr
comma
id|acc-&gt;acc_accl
)paren
suffix:semicolon
id|skb_pull
c_func
(paren
id|skb
comma
id|acc-&gt;acc_accl
op_plus
id|acc-&gt;acc_passl
op_plus
id|acc-&gt;acc_userl
op_plus
l_int|3
)paren
suffix:semicolon
)brace
DECL|function|dn_user_copy
r_static
r_void
id|dn_user_copy
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|optdata_dn
op_star
id|opt
)paren
(brace
r_int
r_char
op_star
id|ptr
op_assign
id|skb-&gt;data
suffix:semicolon
id|opt-&gt;opt_optl
op_assign
op_star
id|ptr
op_increment
suffix:semicolon
id|opt-&gt;opt_status
op_assign
l_int|0
suffix:semicolon
id|memcpy
c_func
(paren
id|opt-&gt;opt_data
comma
id|ptr
comma
id|opt-&gt;opt_optl
)paren
suffix:semicolon
id|skb_pull
c_func
(paren
id|skb
comma
id|opt-&gt;opt_optl
op_plus
l_int|1
)paren
suffix:semicolon
)brace
DECL|function|dn_wait_for_connect
r_static
r_struct
id|sk_buff
op_star
id|dn_wait_for_connect
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_int
op_star
id|timeo
)paren
(brace
id|DEFINE_WAIT
c_func
(paren
id|wait
)paren
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
op_assign
l_int|NULL
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
id|prepare_to_wait
c_func
(paren
id|sk-&gt;sk_sleep
comma
op_amp
id|wait
comma
id|TASK_INTERRUPTIBLE
)paren
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
(brace
id|release_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
id|skb
op_assign
id|skb_dequeue
c_func
(paren
op_amp
id|sk-&gt;sk_receive_queue
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_eq
l_int|NULL
)paren
(brace
op_star
id|timeo
op_assign
id|schedule_timeout
c_func
(paren
op_star
id|timeo
)paren
suffix:semicolon
id|skb
op_assign
id|skb_dequeue
c_func
(paren
op_amp
id|sk-&gt;sk_receive_queue
)paren
suffix:semicolon
)brace
id|lock_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_ne
l_int|NULL
)paren
r_break
suffix:semicolon
id|err
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;sk_state
op_ne
id|TCP_LISTEN
)paren
r_break
suffix:semicolon
id|err
op_assign
id|sock_intr_errno
c_func
(paren
op_star
id|timeo
)paren
suffix:semicolon
r_if
c_cond
(paren
id|signal_pending
c_func
(paren
id|current
)paren
)paren
r_break
suffix:semicolon
id|err
op_assign
op_minus
id|EAGAIN
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
op_star
id|timeo
)paren
r_break
suffix:semicolon
id|prepare_to_wait
c_func
(paren
id|sk-&gt;sk_sleep
comma
op_amp
id|wait
comma
id|TASK_INTERRUPTIBLE
)paren
suffix:semicolon
)brace
id|finish_wait
c_func
(paren
id|sk-&gt;sk_sleep
comma
op_amp
id|wait
)paren
suffix:semicolon
r_return
id|skb
op_eq
l_int|NULL
ques
c_cond
id|ERR_PTR
c_func
(paren
id|err
)paren
suffix:colon
id|skb
suffix:semicolon
)brace
DECL|function|dn_accept
r_static
r_int
id|dn_accept
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_struct
id|socket
op_star
id|newsock
comma
r_int
id|flags
)paren
(brace
r_struct
id|sock
op_star
id|sk
op_assign
id|sock-&gt;sk
comma
op_star
id|newsk
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|dn_skb_cb
op_star
id|cb
suffix:semicolon
r_int
r_char
id|menuver
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
r_int
r_char
id|type
suffix:semicolon
r_int
id|timeo
op_assign
id|sock_rcvtimeo
c_func
(paren
id|sk
comma
id|flags
op_amp
id|O_NONBLOCK
)paren
suffix:semicolon
id|lock_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;sk_state
op_ne
id|TCP_LISTEN
op_logical_or
id|DN_SK
c_func
(paren
id|sk
)paren
op_member_access_from_pointer
id|state
op_ne
id|DN_O
)paren
(brace
id|release_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|skb
op_assign
id|skb_dequeue
c_func
(paren
op_amp
id|sk-&gt;sk_receive_queue
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_eq
l_int|NULL
)paren
(brace
id|skb
op_assign
id|dn_wait_for_connect
c_func
(paren
id|sk
comma
op_amp
id|timeo
)paren
suffix:semicolon
r_if
c_cond
(paren
id|IS_ERR
c_func
(paren
id|skb
)paren
)paren
(brace
id|release_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
r_return
id|PTR_ERR
c_func
(paren
id|sk
)paren
suffix:semicolon
)brace
)brace
id|cb
op_assign
id|DN_SKB_CB
c_func
(paren
id|skb
)paren
suffix:semicolon
id|sk-&gt;sk_ack_backlog
op_decrement
suffix:semicolon
id|newsk
op_assign
id|dn_alloc_sock
c_func
(paren
id|newsock
comma
id|sk-&gt;sk_allocation
)paren
suffix:semicolon
r_if
c_cond
(paren
id|newsk
op_eq
l_int|NULL
)paren
(brace
id|release_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
op_minus
id|ENOBUFS
suffix:semicolon
)brace
id|release_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
id|dst_release
c_func
(paren
id|xchg
c_func
(paren
op_amp
id|newsk-&gt;sk_dst_cache
comma
id|skb-&gt;dst
)paren
)paren
suffix:semicolon
id|skb-&gt;dst
op_assign
l_int|NULL
suffix:semicolon
id|DN_SK
c_func
(paren
id|newsk
)paren
op_member_access_from_pointer
id|state
op_assign
id|DN_CR
suffix:semicolon
id|DN_SK
c_func
(paren
id|newsk
)paren
op_member_access_from_pointer
id|addrrem
op_assign
id|cb-&gt;src_port
suffix:semicolon
id|DN_SK
c_func
(paren
id|newsk
)paren
op_member_access_from_pointer
id|services_rem
op_assign
id|cb-&gt;services
suffix:semicolon
id|DN_SK
c_func
(paren
id|newsk
)paren
op_member_access_from_pointer
id|info_rem
op_assign
id|cb-&gt;info
suffix:semicolon
id|DN_SK
c_func
(paren
id|newsk
)paren
op_member_access_from_pointer
id|segsize_rem
op_assign
id|cb-&gt;segsize
suffix:semicolon
id|DN_SK
c_func
(paren
id|newsk
)paren
op_member_access_from_pointer
id|accept_mode
op_assign
id|DN_SK
c_func
(paren
id|sk
)paren
op_member_access_from_pointer
id|accept_mode
suffix:semicolon
r_if
c_cond
(paren
id|DN_SK
c_func
(paren
id|newsk
)paren
op_member_access_from_pointer
id|segsize_rem
OL
l_int|230
)paren
id|DN_SK
c_func
(paren
id|newsk
)paren
op_member_access_from_pointer
id|segsize_rem
op_assign
l_int|230
suffix:semicolon
r_if
c_cond
(paren
(paren
id|DN_SK
c_func
(paren
id|newsk
)paren
op_member_access_from_pointer
id|services_rem
op_amp
id|NSP_FC_MASK
)paren
op_eq
id|NSP_FC_NONE
)paren
id|DN_SK
c_func
(paren
id|newsk
)paren
op_member_access_from_pointer
id|max_window
op_assign
id|decnet_no_fc_max_cwnd
suffix:semicolon
id|newsk-&gt;sk_state
op_assign
id|TCP_LISTEN
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
(paren
id|DN_SK
c_func
(paren
id|newsk
)paren
op_member_access_from_pointer
id|addr
)paren
comma
op_amp
(paren
id|DN_SK
c_func
(paren
id|sk
)paren
op_member_access_from_pointer
id|addr
)paren
comma
r_sizeof
(paren
r_struct
id|sockaddr_dn
)paren
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * If we are listening on a wild socket, we don&squot;t want&n;&t; * the newly created socket on the wrong hash queue.&n;&t; */
id|DN_SK
c_func
(paren
id|newsk
)paren
op_member_access_from_pointer
id|addr.sdn_flags
op_and_assign
op_complement
id|SDF_WILD
suffix:semicolon
id|skb_pull
c_func
(paren
id|skb
comma
id|dn_username2sockaddr
c_func
(paren
id|skb-&gt;data
comma
id|skb-&gt;len
comma
op_amp
(paren
id|DN_SK
c_func
(paren
id|newsk
)paren
op_member_access_from_pointer
id|addr
)paren
comma
op_amp
id|type
)paren
)paren
suffix:semicolon
id|skb_pull
c_func
(paren
id|skb
comma
id|dn_username2sockaddr
c_func
(paren
id|skb-&gt;data
comma
id|skb-&gt;len
comma
op_amp
(paren
id|DN_SK
c_func
(paren
id|newsk
)paren
op_member_access_from_pointer
id|peer
)paren
comma
op_amp
id|type
)paren
)paren
suffix:semicolon
op_star
(paren
id|dn_address
op_star
)paren
(paren
id|DN_SK
c_func
(paren
id|newsk
)paren
op_member_access_from_pointer
id|peer.sdn_add.a_addr
)paren
op_assign
id|cb-&gt;src
suffix:semicolon
op_star
(paren
id|dn_address
op_star
)paren
(paren
id|DN_SK
c_func
(paren
id|newsk
)paren
op_member_access_from_pointer
id|addr.sdn_add.a_addr
)paren
op_assign
id|cb-&gt;dst
suffix:semicolon
id|menuver
op_assign
op_star
id|skb-&gt;data
suffix:semicolon
id|skb_pull
c_func
(paren
id|skb
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|menuver
op_amp
id|DN_MENUVER_ACC
)paren
id|dn_access_copy
c_func
(paren
id|skb
comma
op_amp
(paren
id|DN_SK
c_func
(paren
id|newsk
)paren
op_member_access_from_pointer
id|accessdata
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|menuver
op_amp
id|DN_MENUVER_USR
)paren
id|dn_user_copy
c_func
(paren
id|skb
comma
op_amp
(paren
id|DN_SK
c_func
(paren
id|newsk
)paren
op_member_access_from_pointer
id|conndata_in
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|menuver
op_amp
id|DN_MENUVER_PRX
)paren
id|DN_SK
c_func
(paren
id|newsk
)paren
op_member_access_from_pointer
id|peer.sdn_flags
op_or_assign
id|SDF_PROXY
suffix:semicolon
r_if
c_cond
(paren
id|menuver
op_amp
id|DN_MENUVER_UIC
)paren
id|DN_SK
c_func
(paren
id|newsk
)paren
op_member_access_from_pointer
id|peer.sdn_flags
op_or_assign
id|SDF_UICPROXY
suffix:semicolon
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
(paren
id|DN_SK
c_func
(paren
id|newsk
)paren
op_member_access_from_pointer
id|conndata_out
)paren
comma
op_amp
(paren
id|DN_SK
c_func
(paren
id|sk
)paren
op_member_access_from_pointer
id|conndata_out
)paren
comma
r_sizeof
(paren
r_struct
id|optdata_dn
)paren
)paren
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
(paren
id|DN_SK
c_func
(paren
id|newsk
)paren
op_member_access_from_pointer
id|discdata_out
)paren
comma
op_amp
(paren
id|DN_SK
c_func
(paren
id|sk
)paren
op_member_access_from_pointer
id|discdata_out
)paren
comma
r_sizeof
(paren
r_struct
id|optdata_dn
)paren
)paren
suffix:semicolon
id|lock_sock
c_func
(paren
id|newsk
)paren
suffix:semicolon
id|err
op_assign
id|dn_hash_sock
c_func
(paren
id|newsk
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
op_eq
l_int|0
)paren
(brace
id|newsk-&gt;sk_zapped
op_assign
l_int|0
suffix:semicolon
id|dn_send_conn_ack
c_func
(paren
id|newsk
)paren
suffix:semicolon
multiline_comment|/*&n;&t; &t; * Here we use sk-&gt;sk_allocation since although the conn conf is&n;&t; &t; * for the newsk, the context is the old socket.&n;&t; &t; */
r_if
c_cond
(paren
id|DN_SK
c_func
(paren
id|newsk
)paren
op_member_access_from_pointer
id|accept_mode
op_eq
id|ACC_IMMED
)paren
id|err
op_assign
id|dn_confirm_accept
c_func
(paren
id|newsk
comma
op_amp
id|timeo
comma
id|sk-&gt;sk_allocation
)paren
suffix:semicolon
)brace
id|release_sock
c_func
(paren
id|newsk
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|dn_getname
r_static
r_int
id|dn_getname
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_struct
id|sockaddr
op_star
id|uaddr
comma
r_int
op_star
id|uaddr_len
comma
r_int
id|peer
)paren
(brace
r_struct
id|sockaddr_dn
op_star
id|sa
op_assign
(paren
r_struct
id|sockaddr_dn
op_star
)paren
id|uaddr
suffix:semicolon
r_struct
id|sock
op_star
id|sk
op_assign
id|sock-&gt;sk
suffix:semicolon
r_struct
id|dn_scp
op_star
id|scp
op_assign
id|DN_SK
c_func
(paren
id|sk
)paren
suffix:semicolon
op_star
id|uaddr_len
op_assign
r_sizeof
(paren
r_struct
id|sockaddr_dn
)paren
suffix:semicolon
id|lock_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
r_if
c_cond
(paren
id|peer
)paren
(brace
r_if
c_cond
(paren
(paren
id|sock-&gt;state
op_ne
id|SS_CONNECTED
op_logical_and
id|sock-&gt;state
op_ne
id|SS_CONNECTING
)paren
op_logical_and
id|scp-&gt;accept_mode
op_eq
id|ACC_IMMED
)paren
r_return
op_minus
id|ENOTCONN
suffix:semicolon
id|memcpy
c_func
(paren
id|sa
comma
op_amp
id|scp-&gt;peer
comma
r_sizeof
(paren
r_struct
id|sockaddr_dn
)paren
)paren
suffix:semicolon
)brace
r_else
(brace
id|memcpy
c_func
(paren
id|sa
comma
op_amp
id|scp-&gt;addr
comma
r_sizeof
(paren
r_struct
id|sockaddr_dn
)paren
)paren
suffix:semicolon
)brace
id|release_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dn_poll
r_static
r_int
r_int
id|dn_poll
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_struct
id|socket
op_star
id|sock
comma
id|poll_table
op_star
id|wait
)paren
(brace
r_struct
id|sock
op_star
id|sk
op_assign
id|sock-&gt;sk
suffix:semicolon
r_struct
id|dn_scp
op_star
id|scp
op_assign
id|DN_SK
c_func
(paren
id|sk
)paren
suffix:semicolon
r_int
id|mask
op_assign
id|datagram_poll
c_func
(paren
id|file
comma
id|sock
comma
id|wait
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb_queue_len
c_func
(paren
op_amp
id|scp-&gt;other_receive_queue
)paren
)paren
id|mask
op_or_assign
id|POLLRDBAND
suffix:semicolon
r_return
id|mask
suffix:semicolon
)brace
DECL|function|dn_ioctl
r_static
r_int
id|dn_ioctl
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
r_struct
id|sock
op_star
id|sk
op_assign
id|sock-&gt;sk
suffix:semicolon
r_struct
id|dn_scp
op_star
id|scp
op_assign
id|DN_SK
c_func
(paren
id|sk
)paren
suffix:semicolon
r_int
id|err
op_assign
op_minus
id|EOPNOTSUPP
suffix:semicolon
r_int
id|amount
op_assign
l_int|0
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_int
id|val
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|SIOCGIFADDR
suffix:colon
r_case
id|SIOCSIFADDR
suffix:colon
r_return
id|dn_dev_ioctl
c_func
(paren
id|cmd
comma
(paren
r_void
op_star
)paren
id|arg
)paren
suffix:semicolon
r_case
id|SIOCATMARK
suffix:colon
id|lock_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
id|val
op_assign
(paren
id|skb_queue_len
c_func
(paren
op_amp
id|scp-&gt;other_receive_queue
)paren
op_ne
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|scp-&gt;state
op_ne
id|DN_RUN
)paren
id|val
op_assign
op_minus
id|ENOTCONN
suffix:semicolon
id|release_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
r_return
id|val
suffix:semicolon
r_case
id|TIOCOUTQ
suffix:colon
id|amount
op_assign
id|sk-&gt;sk_sndbuf
op_minus
id|atomic_read
c_func
(paren
op_amp
id|sk-&gt;sk_wmem_alloc
)paren
suffix:semicolon
r_if
c_cond
(paren
id|amount
OL
l_int|0
)paren
id|amount
op_assign
l_int|0
suffix:semicolon
id|err
op_assign
id|put_user
c_func
(paren
id|amount
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|TIOCINQ
suffix:colon
id|lock_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|skb
op_assign
id|skb_peek
c_func
(paren
op_amp
id|scp-&gt;other_receive_queue
)paren
)paren
op_ne
l_int|NULL
)paren
(brace
id|amount
op_assign
id|skb-&gt;len
suffix:semicolon
)brace
r_else
(brace
r_struct
id|sk_buff
op_star
id|skb
op_assign
id|sk-&gt;sk_receive_queue.next
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
(brace
r_if
c_cond
(paren
id|skb
op_eq
(paren
r_struct
id|sk_buff
op_star
)paren
op_amp
id|sk-&gt;sk_receive_queue
)paren
r_break
suffix:semicolon
id|amount
op_add_assign
id|skb-&gt;len
suffix:semicolon
id|skb
op_assign
id|skb-&gt;next
suffix:semicolon
)brace
)brace
id|release_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
id|err
op_assign
id|put_user
c_func
(paren
id|amount
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|err
op_assign
id|dev_ioctl
c_func
(paren
id|cmd
comma
(paren
r_void
op_star
)paren
id|arg
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_return
id|err
suffix:semicolon
)brace
DECL|function|dn_listen
r_static
r_int
id|dn_listen
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_int
id|backlog
)paren
(brace
r_struct
id|sock
op_star
id|sk
op_assign
id|sock-&gt;sk
suffix:semicolon
r_int
id|err
op_assign
op_minus
id|EINVAL
suffix:semicolon
id|lock_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;sk_zapped
)paren
r_goto
id|out
suffix:semicolon
r_if
c_cond
(paren
(paren
id|DN_SK
c_func
(paren
id|sk
)paren
op_member_access_from_pointer
id|state
op_ne
id|DN_O
)paren
op_logical_or
(paren
id|sk-&gt;sk_state
op_eq
id|TCP_LISTEN
)paren
)paren
r_goto
id|out
suffix:semicolon
id|sk-&gt;sk_max_ack_backlog
op_assign
id|backlog
suffix:semicolon
id|sk-&gt;sk_ack_backlog
op_assign
l_int|0
suffix:semicolon
id|sk-&gt;sk_state
op_assign
id|TCP_LISTEN
suffix:semicolon
id|err
op_assign
l_int|0
suffix:semicolon
id|dn_rehash_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
id|out
suffix:colon
id|release_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|dn_shutdown
r_static
r_int
id|dn_shutdown
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_int
id|how
)paren
(brace
r_struct
id|sock
op_star
id|sk
op_assign
id|sock-&gt;sk
suffix:semicolon
r_struct
id|dn_scp
op_star
id|scp
op_assign
id|DN_SK
c_func
(paren
id|sk
)paren
suffix:semicolon
r_int
id|err
op_assign
op_minus
id|ENOTCONN
suffix:semicolon
id|lock_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sock-&gt;state
op_eq
id|SS_UNCONNECTED
)paren
r_goto
id|out
suffix:semicolon
id|err
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|sock-&gt;state
op_eq
id|SS_DISCONNECTING
)paren
r_goto
id|out
suffix:semicolon
id|err
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|scp-&gt;state
op_eq
id|DN_O
)paren
r_goto
id|out
suffix:semicolon
r_if
c_cond
(paren
id|how
op_ne
id|SHUTDOWN_MASK
)paren
r_goto
id|out
suffix:semicolon
id|sk-&gt;sk_shutdown
op_assign
id|how
suffix:semicolon
id|dn_destroy_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
id|err
op_assign
l_int|0
suffix:semicolon
id|out
suffix:colon
id|release_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|dn_setsockopt
r_static
r_int
id|dn_setsockopt
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_int
id|level
comma
r_int
id|optname
comma
r_char
op_star
id|optval
comma
r_int
id|optlen
)paren
(brace
r_struct
id|sock
op_star
id|sk
op_assign
id|sock-&gt;sk
suffix:semicolon
r_int
id|err
suffix:semicolon
id|lock_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
id|err
op_assign
id|__dn_setsockopt
c_func
(paren
id|sock
comma
id|level
comma
id|optname
comma
id|optval
comma
id|optlen
comma
l_int|0
)paren
suffix:semicolon
id|release_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|__dn_setsockopt
r_static
r_int
id|__dn_setsockopt
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_int
id|level
comma
r_int
id|optname
comma
r_char
op_star
id|optval
comma
r_int
id|optlen
comma
r_int
id|flags
)paren
(brace
r_struct
id|sock
op_star
id|sk
op_assign
id|sock-&gt;sk
suffix:semicolon
r_struct
id|dn_scp
op_star
id|scp
op_assign
id|DN_SK
c_func
(paren
id|sk
)paren
suffix:semicolon
r_int
id|timeo
suffix:semicolon
r_union
(brace
r_struct
id|optdata_dn
id|opt
suffix:semicolon
r_struct
id|accessdata_dn
id|acc
suffix:semicolon
r_int
id|mode
suffix:semicolon
r_int
r_int
id|win
suffix:semicolon
r_int
id|val
suffix:semicolon
r_int
r_char
id|services
suffix:semicolon
r_int
r_char
id|info
suffix:semicolon
)brace
id|u
suffix:semicolon
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
id|optlen
op_logical_and
op_logical_neg
id|optval
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|optlen
OG
r_sizeof
(paren
id|u
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|u
comma
id|optval
comma
id|optlen
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_switch
c_cond
(paren
id|optname
)paren
(brace
r_case
id|DSO_CONDATA
suffix:colon
r_if
c_cond
(paren
id|sock-&gt;state
op_eq
id|SS_CONNECTED
)paren
r_return
op_minus
id|EISCONN
suffix:semicolon
r_if
c_cond
(paren
(paren
id|scp-&gt;state
op_ne
id|DN_O
)paren
op_logical_and
(paren
id|scp-&gt;state
op_ne
id|DN_CR
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|optlen
op_ne
r_sizeof
(paren
r_struct
id|optdata_dn
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|u.opt.opt_optl
OG
l_int|16
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|scp-&gt;conndata_out
comma
op_amp
id|u.opt
comma
id|optlen
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DSO_DISDATA
suffix:colon
r_if
c_cond
(paren
id|sock-&gt;state
op_ne
id|SS_CONNECTED
op_logical_and
id|scp-&gt;accept_mode
op_eq
id|ACC_IMMED
)paren
r_return
op_minus
id|ENOTCONN
suffix:semicolon
r_if
c_cond
(paren
id|optlen
op_ne
r_sizeof
(paren
r_struct
id|optdata_dn
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|u.opt.opt_optl
OG
l_int|16
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|scp-&gt;discdata_out
comma
op_amp
id|u.opt
comma
id|optlen
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DSO_CONACCESS
suffix:colon
r_if
c_cond
(paren
id|sock-&gt;state
op_eq
id|SS_CONNECTED
)paren
r_return
op_minus
id|EISCONN
suffix:semicolon
r_if
c_cond
(paren
id|scp-&gt;state
op_ne
id|DN_O
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|optlen
op_ne
r_sizeof
(paren
r_struct
id|accessdata_dn
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
(paren
id|u.acc.acc_accl
OG
id|DN_MAXACCL
)paren
op_logical_or
(paren
id|u.acc.acc_passl
OG
id|DN_MAXACCL
)paren
op_logical_or
(paren
id|u.acc.acc_userl
OG
id|DN_MAXACCL
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|scp-&gt;accessdata
comma
op_amp
id|u.acc
comma
id|optlen
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DSO_ACCEPTMODE
suffix:colon
r_if
c_cond
(paren
id|sock-&gt;state
op_eq
id|SS_CONNECTED
)paren
r_return
op_minus
id|EISCONN
suffix:semicolon
r_if
c_cond
(paren
id|scp-&gt;state
op_ne
id|DN_O
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|optlen
op_ne
r_sizeof
(paren
r_int
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
(paren
id|u.mode
op_ne
id|ACC_IMMED
)paren
op_logical_and
(paren
id|u.mode
op_ne
id|ACC_DEFER
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|scp-&gt;accept_mode
op_assign
(paren
r_int
r_char
)paren
id|u.mode
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DSO_CONACCEPT
suffix:colon
r_if
c_cond
(paren
id|scp-&gt;state
op_ne
id|DN_CR
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|timeo
op_assign
id|sock_rcvtimeo
c_func
(paren
id|sk
comma
l_int|0
)paren
suffix:semicolon
id|err
op_assign
id|dn_confirm_accept
c_func
(paren
id|sk
comma
op_amp
id|timeo
comma
id|sk-&gt;sk_allocation
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
r_case
id|DSO_CONREJECT
suffix:colon
r_if
c_cond
(paren
id|scp-&gt;state
op_ne
id|DN_CR
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|scp-&gt;state
op_assign
id|DN_DR
suffix:semicolon
id|sk-&gt;sk_shutdown
op_assign
id|SHUTDOWN_MASK
suffix:semicolon
id|dn_nsp_send_disc
c_func
(paren
id|sk
comma
l_int|0x38
comma
l_int|0
comma
id|sk-&gt;sk_allocation
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
macro_line|#ifdef CONFIG_NETFILTER
r_return
id|nf_setsockopt
c_func
(paren
id|sk
comma
id|PF_DECnet
comma
id|optname
comma
id|optval
comma
id|optlen
)paren
suffix:semicolon
macro_line|#endif
r_case
id|DSO_LINKINFO
suffix:colon
r_case
id|DSO_STREAM
suffix:colon
r_case
id|DSO_SEQPACKET
suffix:colon
r_return
op_minus
id|ENOPROTOOPT
suffix:semicolon
r_case
id|DSO_MAXWINDOW
suffix:colon
r_if
c_cond
(paren
id|optlen
op_ne
r_sizeof
(paren
r_int
r_int
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|u.win
OG
id|NSP_MAX_WINDOW
)paren
id|u.win
op_assign
id|NSP_MAX_WINDOW
suffix:semicolon
r_if
c_cond
(paren
id|u.win
op_eq
l_int|0
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|scp-&gt;max_window
op_assign
id|u.win
suffix:semicolon
r_if
c_cond
(paren
id|scp-&gt;snd_window
OG
id|u.win
)paren
id|scp-&gt;snd_window
op_assign
id|u.win
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DSO_NODELAY
suffix:colon
r_if
c_cond
(paren
id|optlen
op_ne
r_sizeof
(paren
r_int
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|scp-&gt;nonagle
op_eq
l_int|2
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|scp-&gt;nonagle
op_assign
(paren
id|u.val
op_eq
l_int|0
)paren
ques
c_cond
l_int|0
suffix:colon
l_int|1
suffix:semicolon
multiline_comment|/* if (scp-&gt;nonagle == 1) { Push pending frames } */
r_break
suffix:semicolon
r_case
id|DSO_CORK
suffix:colon
r_if
c_cond
(paren
id|optlen
op_ne
r_sizeof
(paren
r_int
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|scp-&gt;nonagle
op_eq
l_int|1
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|scp-&gt;nonagle
op_assign
(paren
id|u.val
op_eq
l_int|0
)paren
ques
c_cond
l_int|0
suffix:colon
l_int|2
suffix:semicolon
multiline_comment|/* if (scp-&gt;nonagle == 0) { Push pending frames } */
r_break
suffix:semicolon
r_case
id|DSO_SERVICES
suffix:colon
r_if
c_cond
(paren
id|optlen
op_ne
r_sizeof
(paren
r_int
r_char
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
(paren
id|u.services
op_amp
op_complement
id|NSP_FC_MASK
)paren
op_ne
l_int|0x01
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
(paren
id|u.services
op_amp
id|NSP_FC_MASK
)paren
op_eq
id|NSP_FC_MASK
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|scp-&gt;services_loc
op_assign
id|u.services
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DSO_INFO
suffix:colon
r_if
c_cond
(paren
id|optlen
op_ne
r_sizeof
(paren
r_int
r_char
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|u.info
op_amp
l_int|0xfc
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|scp-&gt;info_loc
op_assign
id|u.info
suffix:semicolon
r_break
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dn_getsockopt
r_static
r_int
id|dn_getsockopt
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_int
id|level
comma
r_int
id|optname
comma
r_char
op_star
id|optval
comma
r_int
op_star
id|optlen
)paren
(brace
r_struct
id|sock
op_star
id|sk
op_assign
id|sock-&gt;sk
suffix:semicolon
r_int
id|err
suffix:semicolon
id|lock_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
id|err
op_assign
id|__dn_getsockopt
c_func
(paren
id|sock
comma
id|level
comma
id|optname
comma
id|optval
comma
id|optlen
comma
l_int|0
)paren
suffix:semicolon
id|release_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|__dn_getsockopt
r_static
r_int
id|__dn_getsockopt
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_int
id|level
comma
r_int
id|optname
comma
r_char
op_star
id|optval
comma
r_int
op_star
id|optlen
comma
r_int
id|flags
)paren
(brace
r_struct
id|sock
op_star
id|sk
op_assign
id|sock-&gt;sk
suffix:semicolon
r_struct
id|dn_scp
op_star
id|scp
op_assign
id|DN_SK
c_func
(paren
id|sk
)paren
suffix:semicolon
r_struct
id|linkinfo_dn
id|link
suffix:semicolon
r_int
r_int
id|r_len
suffix:semicolon
r_void
op_star
id|r_data
op_assign
l_int|NULL
suffix:semicolon
r_int
r_int
id|val
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|r_len
comma
id|optlen
)paren
)paren
(brace
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|optname
)paren
(brace
r_case
id|DSO_CONDATA
suffix:colon
r_if
c_cond
(paren
id|r_len
OG
r_sizeof
(paren
r_struct
id|optdata_dn
)paren
)paren
id|r_len
op_assign
r_sizeof
(paren
r_struct
id|optdata_dn
)paren
suffix:semicolon
id|r_data
op_assign
op_amp
id|scp-&gt;conndata_in
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DSO_DISDATA
suffix:colon
r_if
c_cond
(paren
id|r_len
OG
r_sizeof
(paren
r_struct
id|optdata_dn
)paren
)paren
id|r_len
op_assign
r_sizeof
(paren
r_struct
id|optdata_dn
)paren
suffix:semicolon
id|r_data
op_assign
op_amp
id|scp-&gt;discdata_in
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DSO_CONACCESS
suffix:colon
r_if
c_cond
(paren
id|r_len
OG
r_sizeof
(paren
r_struct
id|accessdata_dn
)paren
)paren
id|r_len
op_assign
r_sizeof
(paren
r_struct
id|accessdata_dn
)paren
suffix:semicolon
id|r_data
op_assign
op_amp
id|scp-&gt;accessdata
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DSO_ACCEPTMODE
suffix:colon
r_if
c_cond
(paren
id|r_len
OG
r_sizeof
(paren
r_int
r_char
)paren
)paren
id|r_len
op_assign
r_sizeof
(paren
r_int
r_char
)paren
suffix:semicolon
id|r_data
op_assign
op_amp
id|scp-&gt;accept_mode
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DSO_LINKINFO
suffix:colon
r_if
c_cond
(paren
id|r_len
OG
r_sizeof
(paren
r_struct
id|linkinfo_dn
)paren
)paren
id|r_len
op_assign
r_sizeof
(paren
r_struct
id|linkinfo_dn
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|sock-&gt;state
)paren
(brace
r_case
id|SS_CONNECTING
suffix:colon
id|link.idn_linkstate
op_assign
id|LL_CONNECTING
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SS_DISCONNECTING
suffix:colon
id|link.idn_linkstate
op_assign
id|LL_DISCONNECTING
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SS_CONNECTED
suffix:colon
id|link.idn_linkstate
op_assign
id|LL_RUNNING
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|link.idn_linkstate
op_assign
id|LL_INACTIVE
suffix:semicolon
)brace
id|link.idn_segsize
op_assign
id|scp-&gt;segsize_rem
suffix:semicolon
id|r_data
op_assign
op_amp
id|link
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
(brace
)brace
macro_line|#ifdef CONFIG_NETFILTER
(brace
r_int
id|val
comma
id|len
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|len
comma
id|optlen
)paren
)paren
(brace
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
id|val
op_assign
id|nf_getsockopt
c_func
(paren
id|sk
comma
id|PF_DECnet
comma
id|optname
comma
id|optval
comma
op_amp
id|len
)paren
suffix:semicolon
r_if
c_cond
(paren
id|val
op_ge
l_int|0
)paren
id|val
op_assign
id|put_user
c_func
(paren
id|len
comma
id|optlen
)paren
suffix:semicolon
r_return
id|val
suffix:semicolon
)brace
macro_line|#endif
r_case
id|DSO_STREAM
suffix:colon
r_case
id|DSO_SEQPACKET
suffix:colon
r_case
id|DSO_CONACCEPT
suffix:colon
r_case
id|DSO_CONREJECT
suffix:colon
r_return
op_minus
id|ENOPROTOOPT
suffix:semicolon
r_case
id|DSO_MAXWINDOW
suffix:colon
r_if
c_cond
(paren
id|r_len
OG
r_sizeof
(paren
r_int
r_int
)paren
)paren
id|r_len
op_assign
r_sizeof
(paren
r_int
r_int
)paren
suffix:semicolon
id|r_data
op_assign
op_amp
id|scp-&gt;max_window
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DSO_NODELAY
suffix:colon
r_if
c_cond
(paren
id|r_len
OG
r_sizeof
(paren
r_int
)paren
)paren
id|r_len
op_assign
r_sizeof
(paren
r_int
)paren
suffix:semicolon
id|val
op_assign
(paren
id|scp-&gt;nonagle
op_eq
l_int|1
)paren
suffix:semicolon
id|r_data
op_assign
op_amp
id|val
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DSO_CORK
suffix:colon
r_if
c_cond
(paren
id|r_len
OG
r_sizeof
(paren
r_int
)paren
)paren
id|r_len
op_assign
r_sizeof
(paren
r_int
)paren
suffix:semicolon
id|val
op_assign
(paren
id|scp-&gt;nonagle
op_eq
l_int|2
)paren
suffix:semicolon
id|r_data
op_assign
op_amp
id|val
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DSO_SERVICES
suffix:colon
r_if
c_cond
(paren
id|r_len
OG
r_sizeof
(paren
r_int
r_char
)paren
)paren
id|r_len
op_assign
r_sizeof
(paren
r_int
r_char
)paren
suffix:semicolon
id|r_data
op_assign
op_amp
id|scp-&gt;services_rem
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DSO_INFO
suffix:colon
r_if
c_cond
(paren
id|r_len
OG
r_sizeof
(paren
r_int
r_char
)paren
)paren
id|r_len
op_assign
r_sizeof
(paren
r_int
r_char
)paren
suffix:semicolon
id|r_data
op_assign
op_amp
id|scp-&gt;info_rem
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|r_data
)paren
(brace
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|optval
comma
id|r_data
comma
id|r_len
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|put_user
c_func
(paren
id|r_len
comma
id|optlen
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dn_data_ready
r_static
r_int
id|dn_data_ready
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_struct
id|sk_buff_head
op_star
id|q
comma
r_int
id|flags
comma
r_int
id|target
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
op_assign
id|q-&gt;next
suffix:semicolon
r_int
id|len
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|flags
op_amp
id|MSG_OOB
)paren
r_return
id|skb_queue_len
c_func
(paren
id|q
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|skb
op_ne
(paren
r_struct
id|sk_buff
op_star
)paren
id|q
)paren
(brace
r_struct
id|dn_skb_cb
op_star
id|cb
op_assign
id|DN_SKB_CB
c_func
(paren
id|skb
)paren
suffix:semicolon
id|len
op_add_assign
id|skb-&gt;len
suffix:semicolon
r_if
c_cond
(paren
id|cb-&gt;nsp_flags
op_amp
l_int|0x40
)paren
(brace
multiline_comment|/* SOCK_SEQPACKET reads to EOM */
r_if
c_cond
(paren
id|sk-&gt;sk_type
op_eq
id|SOCK_SEQPACKET
)paren
r_return
l_int|1
suffix:semicolon
multiline_comment|/* so does SOCK_STREAM unless WAITALL is specified */
r_if
c_cond
(paren
op_logical_neg
(paren
id|flags
op_amp
id|MSG_WAITALL
)paren
)paren
r_return
l_int|1
suffix:semicolon
)brace
multiline_comment|/* minimum data length for read exceeded */
r_if
c_cond
(paren
id|len
op_ge
id|target
)paren
r_return
l_int|1
suffix:semicolon
id|skb
op_assign
id|skb-&gt;next
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dn_recvmsg
r_static
r_int
id|dn_recvmsg
c_func
(paren
r_struct
id|kiocb
op_star
id|iocb
comma
r_struct
id|socket
op_star
id|sock
comma
r_struct
id|msghdr
op_star
id|msg
comma
r_int
id|size
comma
r_int
id|flags
)paren
(brace
r_struct
id|sock
op_star
id|sk
op_assign
id|sock-&gt;sk
suffix:semicolon
r_struct
id|dn_scp
op_star
id|scp
op_assign
id|DN_SK
c_func
(paren
id|sk
)paren
suffix:semicolon
r_struct
id|sk_buff_head
op_star
id|queue
op_assign
op_amp
id|sk-&gt;sk_receive_queue
suffix:semicolon
r_int
id|target
op_assign
id|size
OG
l_int|1
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
r_int
id|copied
op_assign
l_int|0
suffix:semicolon
r_int
id|rv
op_assign
l_int|0
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
comma
op_star
id|nskb
suffix:semicolon
r_struct
id|dn_skb_cb
op_star
id|cb
op_assign
l_int|NULL
suffix:semicolon
r_int
r_char
id|eor
op_assign
l_int|0
suffix:semicolon
r_int
id|timeo
op_assign
id|sock_rcvtimeo
c_func
(paren
id|sk
comma
id|flags
op_amp
id|MSG_DONTWAIT
)paren
suffix:semicolon
id|lock_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;sk_zapped
)paren
(brace
id|rv
op_assign
op_minus
id|EADDRNOTAVAIL
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|rv
op_assign
id|dn_check_state
c_func
(paren
id|sk
comma
l_int|NULL
comma
l_int|0
comma
op_amp
id|timeo
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rv
)paren
r_goto
id|out
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;sk_shutdown
op_amp
id|RCV_SHUTDOWN
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|flags
op_amp
id|MSG_NOSIGNAL
)paren
)paren
id|send_sig
c_func
(paren
id|SIGPIPE
comma
id|current
comma
l_int|0
)paren
suffix:semicolon
id|rv
op_assign
op_minus
id|EPIPE
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_if
c_cond
(paren
id|flags
op_amp
op_complement
(paren
id|MSG_PEEK
op_or
id|MSG_OOB
op_or
id|MSG_WAITALL
op_or
id|MSG_DONTWAIT
op_or
id|MSG_NOSIGNAL
)paren
)paren
(brace
id|rv
op_assign
op_minus
id|EOPNOTSUPP
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_if
c_cond
(paren
id|flags
op_amp
id|MSG_OOB
)paren
id|queue
op_assign
op_amp
id|scp-&gt;other_receive_queue
suffix:semicolon
r_if
c_cond
(paren
id|flags
op_amp
id|MSG_WAITALL
)paren
id|target
op_assign
id|size
suffix:semicolon
multiline_comment|/*&n;&t; * See if there is data ready to read, sleep if there isn&squot;t&n;&t; */
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
(brace
r_if
c_cond
(paren
id|sk-&gt;sk_err
)paren
r_goto
id|out
suffix:semicolon
r_if
c_cond
(paren
id|skb_queue_len
c_func
(paren
op_amp
id|scp-&gt;other_receive_queue
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|flags
op_amp
id|MSG_OOB
)paren
)paren
(brace
id|msg-&gt;msg_flags
op_or_assign
id|MSG_OOB
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|scp-&gt;other_report
)paren
(brace
id|scp-&gt;other_report
op_assign
l_int|1
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
)brace
)brace
r_if
c_cond
(paren
id|scp-&gt;state
op_ne
id|DN_RUN
)paren
r_goto
id|out
suffix:semicolon
r_if
c_cond
(paren
id|signal_pending
c_func
(paren
id|current
)paren
)paren
(brace
id|rv
op_assign
op_minus
id|ERESTARTSYS
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dn_data_ready
c_func
(paren
id|sk
comma
id|queue
comma
id|flags
comma
id|target
)paren
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|flags
op_amp
id|MSG_DONTWAIT
)paren
(brace
id|rv
op_assign
op_minus
id|EWOULDBLOCK
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|set_bit
c_func
(paren
id|SOCK_ASYNC_WAITDATA
comma
op_amp
id|sock-&gt;flags
)paren
suffix:semicolon
id|SOCK_SLEEP_PRE
c_func
(paren
id|sk
)paren
r_if
c_cond
(paren
op_logical_neg
id|dn_data_ready
c_func
(paren
id|sk
comma
id|queue
comma
id|flags
comma
id|target
)paren
)paren
id|schedule
c_func
(paren
)paren
suffix:semicolon
id|SOCK_SLEEP_POST
c_func
(paren
id|sk
)paren
id|clear_bit
c_func
(paren
id|SOCK_ASYNC_WAITDATA
comma
op_amp
id|sock-&gt;flags
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|skb
op_assign
id|queue-&gt;next
suffix:semicolon
id|skb
op_ne
(paren
r_struct
id|sk_buff
op_star
)paren
id|queue
suffix:semicolon
id|skb
op_assign
id|nskb
)paren
(brace
r_int
id|chunk
op_assign
id|skb-&gt;len
suffix:semicolon
id|cb
op_assign
id|DN_SKB_CB
c_func
(paren
id|skb
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|chunk
op_plus
id|copied
)paren
OG
id|size
)paren
id|chunk
op_assign
id|size
op_minus
id|copied
suffix:semicolon
r_if
c_cond
(paren
id|memcpy_toiovec
c_func
(paren
id|msg-&gt;msg_iov
comma
id|skb-&gt;data
comma
id|chunk
)paren
)paren
(brace
id|rv
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_break
suffix:semicolon
)brace
id|copied
op_add_assign
id|chunk
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|flags
op_amp
id|MSG_PEEK
)paren
)paren
id|skb_pull
c_func
(paren
id|skb
comma
id|chunk
)paren
suffix:semicolon
id|eor
op_assign
id|cb-&gt;nsp_flags
op_amp
l_int|0x40
suffix:semicolon
id|nskb
op_assign
id|skb-&gt;next
suffix:semicolon
r_if
c_cond
(paren
id|skb-&gt;len
op_eq
l_int|0
)paren
(brace
id|skb_unlink
c_func
(paren
id|skb
)paren
suffix:semicolon
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
multiline_comment|/* &n;&t;&t;&t; * N.B. Don&squot;t refer to skb or cb after this point&n;&t;&t;&t; * in loop.&n;&t;&t;&t; */
r_if
c_cond
(paren
(paren
id|scp-&gt;flowloc_sw
op_eq
id|DN_DONTSEND
)paren
op_logical_and
op_logical_neg
id|dn_congested
c_func
(paren
id|sk
)paren
)paren
(brace
id|scp-&gt;flowloc_sw
op_assign
id|DN_SEND
suffix:semicolon
id|dn_nsp_send_link
c_func
(paren
id|sk
comma
id|DN_SEND
comma
l_int|0
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|eor
)paren
(brace
r_if
c_cond
(paren
id|sk-&gt;sk_type
op_eq
id|SOCK_SEQPACKET
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|flags
op_amp
id|MSG_WAITALL
)paren
)paren
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|flags
op_amp
id|MSG_OOB
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|copied
op_ge
id|target
)paren
r_break
suffix:semicolon
)brace
id|rv
op_assign
id|copied
suffix:semicolon
r_if
c_cond
(paren
id|eor
op_logical_and
(paren
id|sk-&gt;sk_type
op_eq
id|SOCK_SEQPACKET
)paren
)paren
id|msg-&gt;msg_flags
op_or_assign
id|MSG_EOR
suffix:semicolon
id|out
suffix:colon
r_if
c_cond
(paren
id|rv
op_eq
l_int|0
)paren
id|rv
op_assign
(paren
id|flags
op_amp
id|MSG_PEEK
)paren
ques
c_cond
op_minus
id|sk-&gt;sk_err
suffix:colon
id|sock_error
c_func
(paren
id|sk
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|rv
op_ge
l_int|0
)paren
op_logical_and
id|msg-&gt;msg_name
)paren
(brace
id|memcpy
c_func
(paren
id|msg-&gt;msg_name
comma
op_amp
id|scp-&gt;peer
comma
r_sizeof
(paren
r_struct
id|sockaddr_dn
)paren
)paren
suffix:semicolon
id|msg-&gt;msg_namelen
op_assign
r_sizeof
(paren
r_struct
id|sockaddr_dn
)paren
suffix:semicolon
)brace
id|release_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
r_return
id|rv
suffix:semicolon
)brace
DECL|function|dn_queue_too_long
r_static
r_inline
r_int
id|dn_queue_too_long
c_func
(paren
r_struct
id|dn_scp
op_star
id|scp
comma
r_struct
id|sk_buff_head
op_star
id|queue
comma
r_int
id|flags
)paren
(brace
r_int
r_char
id|fctype
op_assign
id|scp-&gt;services_rem
op_amp
id|NSP_FC_MASK
suffix:semicolon
r_if
c_cond
(paren
id|skb_queue_len
c_func
(paren
id|queue
)paren
op_ge
id|scp-&gt;snd_window
)paren
r_return
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|fctype
op_ne
id|NSP_FC_NONE
)paren
(brace
r_if
c_cond
(paren
id|flags
op_amp
id|MSG_OOB
)paren
(brace
r_if
c_cond
(paren
id|scp-&gt;flowrem_oth
op_eq
l_int|0
)paren
r_return
l_int|1
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|scp-&gt;flowrem_dat
op_eq
l_int|0
)paren
r_return
l_int|1
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * The DECnet spec requires the the &quot;routing layer&quot; accepts packets which&n; * are at least 230 bytes in size. This excludes any headers which the NSP&n; * layer might add, so we always assume that we&squot;ll be using the maximal&n; * length header on data packets. The variation in length is due to the&n; * inclusion (or not) of the two 16 bit acknowledgement fields so it doesn&squot;t&n; * make much practical difference.&n; */
DECL|function|dn_mss_from_pmtu
r_int
id|dn_mss_from_pmtu
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|mtu
)paren
(brace
r_int
id|mss
op_assign
l_int|230
op_minus
id|DN_MAX_NSP_DATA_HEADER
suffix:semicolon
r_if
c_cond
(paren
id|dev
)paren
(brace
r_struct
id|dn_dev
op_star
id|dn_db
op_assign
id|dev-&gt;dn_ptr
suffix:semicolon
id|mtu
op_sub_assign
id|LL_RESERVED_SPACE
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dn_db-&gt;use_long
)paren
id|mtu
op_sub_assign
l_int|21
suffix:semicolon
r_else
id|mtu
op_sub_assign
l_int|6
suffix:semicolon
id|mtu
op_sub_assign
id|DN_MAX_NSP_DATA_HEADER
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/*&n;&t;&t; * 21 = long header, 16 = guess at MAC header length&n;&t;&t; */
id|mtu
op_sub_assign
(paren
l_int|21
op_plus
id|DN_MAX_NSP_DATA_HEADER
op_plus
l_int|16
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|mtu
OG
id|mss
)paren
id|mss
op_assign
id|mtu
suffix:semicolon
r_return
id|mss
suffix:semicolon
)brace
DECL|function|dn_current_mss
r_static
r_inline
r_int
r_int
id|dn_current_mss
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_int
id|flags
)paren
(brace
r_struct
id|dst_entry
op_star
id|dst
op_assign
id|__sk_dst_get
c_func
(paren
id|sk
)paren
suffix:semicolon
r_struct
id|dn_scp
op_star
id|scp
op_assign
id|DN_SK
c_func
(paren
id|sk
)paren
suffix:semicolon
r_int
id|mss_now
op_assign
id|min_t
c_func
(paren
r_int
comma
id|scp-&gt;segsize_loc
comma
id|scp-&gt;segsize_rem
)paren
suffix:semicolon
multiline_comment|/* Other data messages are limited to 16 bytes per packet */
r_if
c_cond
(paren
id|flags
op_amp
id|MSG_OOB
)paren
r_return
l_int|16
suffix:semicolon
multiline_comment|/* This works out the maximum size of segment we can send out */
r_if
c_cond
(paren
id|dst
)paren
(brace
id|u32
id|mtu
op_assign
id|dst_pmtu
c_func
(paren
id|dst
)paren
suffix:semicolon
id|mss_now
op_assign
id|min_t
c_func
(paren
r_int
comma
id|dn_mss_from_pmtu
c_func
(paren
id|dst-&gt;dev
comma
id|mtu
)paren
comma
id|mss_now
)paren
suffix:semicolon
)brace
r_return
id|mss_now
suffix:semicolon
)brace
DECL|function|dn_error
r_static
r_int
id|dn_error
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_int
id|flags
comma
r_int
id|err
)paren
(brace
r_if
c_cond
(paren
id|err
op_eq
op_minus
id|EPIPE
)paren
id|err
op_assign
id|sock_error
c_func
(paren
id|sk
)paren
ques
c_cond
suffix:colon
op_minus
id|EPIPE
suffix:semicolon
r_if
c_cond
(paren
id|err
op_eq
op_minus
id|EPIPE
op_logical_and
op_logical_neg
(paren
id|flags
op_amp
id|MSG_NOSIGNAL
)paren
)paren
id|send_sig
c_func
(paren
id|SIGPIPE
comma
id|current
comma
l_int|0
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|dn_sendmsg
r_static
r_int
id|dn_sendmsg
c_func
(paren
r_struct
id|kiocb
op_star
id|iocb
comma
r_struct
id|socket
op_star
id|sock
comma
r_struct
id|msghdr
op_star
id|msg
comma
r_int
id|size
)paren
(brace
r_struct
id|sock
op_star
id|sk
op_assign
id|sock-&gt;sk
suffix:semicolon
r_struct
id|dn_scp
op_star
id|scp
op_assign
id|DN_SK
c_func
(paren
id|sk
)paren
suffix:semicolon
r_int
id|mss
suffix:semicolon
r_struct
id|sk_buff_head
op_star
id|queue
op_assign
op_amp
id|scp-&gt;data_xmit_queue
suffix:semicolon
r_int
id|flags
op_assign
id|msg-&gt;msg_flags
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
r_int
id|sent
op_assign
l_int|0
suffix:semicolon
r_int
id|addr_len
op_assign
id|msg-&gt;msg_namelen
suffix:semicolon
r_struct
id|sockaddr_dn
op_star
id|addr
op_assign
(paren
r_struct
id|sockaddr_dn
op_star
)paren
id|msg-&gt;msg_name
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|dn_skb_cb
op_star
id|cb
suffix:semicolon
r_int
id|len
suffix:semicolon
r_int
r_char
id|fctype
suffix:semicolon
r_int
id|timeo
op_assign
id|sock_sndtimeo
c_func
(paren
id|sk
comma
id|flags
op_amp
id|MSG_DONTWAIT
)paren
suffix:semicolon
r_if
c_cond
(paren
id|flags
op_amp
op_complement
(paren
id|MSG_TRYHARD
op_or
id|MSG_OOB
op_or
id|MSG_DONTWAIT
op_or
id|MSG_EOR
op_or
id|MSG_NOSIGNAL
op_or
id|MSG_MORE
)paren
)paren
r_return
op_minus
id|EOPNOTSUPP
suffix:semicolon
r_if
c_cond
(paren
id|addr_len
op_logical_and
(paren
id|addr_len
op_ne
r_sizeof
(paren
r_struct
id|sockaddr_dn
)paren
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
multiline_comment|/*&n;&t; * The only difference between stream sockets and sequenced packet&n;&t; * sockets is that the stream sockets always behave as if MSG_EOR&n;&t; * has been set.&n;&t; */
r_if
c_cond
(paren
id|sock-&gt;type
op_eq
id|SOCK_STREAM
)paren
(brace
r_if
c_cond
(paren
id|flags
op_amp
id|MSG_EOR
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|flags
op_or_assign
id|MSG_EOR
suffix:semicolon
)brace
id|lock_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
id|err
op_assign
id|dn_check_state
c_func
(paren
id|sk
comma
id|addr
comma
id|addr_len
comma
op_amp
id|timeo
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_goto
id|out_err
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;sk_shutdown
op_amp
id|SEND_SHUTDOWN
)paren
(brace
id|err
op_assign
op_minus
id|EPIPE
suffix:semicolon
r_goto
id|out_err
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|flags
op_amp
id|MSG_TRYHARD
)paren
op_logical_and
id|sk-&gt;sk_dst_cache
)paren
id|dst_negative_advice
c_func
(paren
op_amp
id|sk-&gt;sk_dst_cache
)paren
suffix:semicolon
id|mss
op_assign
id|scp-&gt;segsize_rem
suffix:semicolon
id|fctype
op_assign
id|scp-&gt;services_rem
op_amp
id|NSP_FC_MASK
suffix:semicolon
id|mss
op_assign
id|dn_current_mss
c_func
(paren
id|sk
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|flags
op_amp
id|MSG_OOB
)paren
(brace
id|queue
op_assign
op_amp
id|scp-&gt;other_xmit_queue
suffix:semicolon
r_if
c_cond
(paren
id|size
OG
id|mss
)paren
(brace
id|err
op_assign
op_minus
id|EMSGSIZE
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
)brace
id|scp-&gt;persist_fxn
op_assign
id|dn_nsp_xmit_timeout
suffix:semicolon
r_while
c_loop
(paren
id|sent
OL
id|size
)paren
(brace
id|err
op_assign
id|sock_error
c_func
(paren
id|sk
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_goto
id|out
suffix:semicolon
r_if
c_cond
(paren
id|signal_pending
c_func
(paren
id|current
)paren
)paren
(brace
id|err
op_assign
op_minus
id|ERESTARTSYS
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
multiline_comment|/*&n;&t;&t; * Calculate size that we wish to send.&n;&t;&t; */
id|len
op_assign
id|size
op_minus
id|sent
suffix:semicolon
r_if
c_cond
(paren
id|len
OG
id|mss
)paren
id|len
op_assign
id|mss
suffix:semicolon
multiline_comment|/*&n;&t;&t; * Wait for queue size to go down below the window&n;&t;&t; * size.&n;&t;&t; */
r_if
c_cond
(paren
id|dn_queue_too_long
c_func
(paren
id|scp
comma
id|queue
comma
id|flags
)paren
)paren
(brace
r_if
c_cond
(paren
id|flags
op_amp
id|MSG_DONTWAIT
)paren
(brace
id|err
op_assign
op_minus
id|EWOULDBLOCK
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|SOCK_SLEEP_PRE
c_func
(paren
id|sk
)paren
r_if
c_cond
(paren
id|dn_queue_too_long
c_func
(paren
id|scp
comma
id|queue
comma
id|flags
)paren
)paren
id|schedule
c_func
(paren
)paren
suffix:semicolon
id|SOCK_SLEEP_POST
c_func
(paren
id|sk
)paren
r_continue
suffix:semicolon
)brace
multiline_comment|/*&n;&t;&t; * Get a suitably sized skb.&n;&t;&t; */
id|skb
op_assign
id|dn_alloc_send_skb
c_func
(paren
id|sk
comma
op_amp
id|len
comma
id|flags
op_amp
id|MSG_DONTWAIT
comma
op_amp
id|err
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
r_continue
suffix:semicolon
id|cb
op_assign
id|DN_SKB_CB
c_func
(paren
id|skb
)paren
suffix:semicolon
id|skb_reserve
c_func
(paren
id|skb
comma
id|DN_MAX_NSP_DATA_HEADER
)paren
suffix:semicolon
r_if
c_cond
(paren
id|memcpy_fromiovec
c_func
(paren
id|skb_put
c_func
(paren
id|skb
comma
id|len
)paren
comma
id|msg-&gt;msg_iov
comma
id|len
)paren
)paren
(brace
id|err
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_if
c_cond
(paren
id|flags
op_amp
id|MSG_OOB
)paren
(brace
id|cb-&gt;nsp_flags
op_assign
l_int|0x30
suffix:semicolon
r_if
c_cond
(paren
id|fctype
op_ne
id|NSP_FC_NONE
)paren
id|scp-&gt;flowrem_oth
op_decrement
suffix:semicolon
)brace
r_else
(brace
id|cb-&gt;nsp_flags
op_assign
l_int|0x00
suffix:semicolon
r_if
c_cond
(paren
id|scp-&gt;seg_total
op_eq
l_int|0
)paren
id|cb-&gt;nsp_flags
op_or_assign
l_int|0x20
suffix:semicolon
id|scp-&gt;seg_total
op_add_assign
id|len
suffix:semicolon
r_if
c_cond
(paren
(paren
(paren
id|sent
op_plus
id|len
)paren
op_eq
id|size
)paren
op_logical_and
(paren
id|flags
op_amp
id|MSG_EOR
)paren
)paren
(brace
id|cb-&gt;nsp_flags
op_or_assign
l_int|0x40
suffix:semicolon
id|scp-&gt;seg_total
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|fctype
op_eq
id|NSP_FC_SCMC
)paren
id|scp-&gt;flowrem_dat
op_decrement
suffix:semicolon
)brace
r_if
c_cond
(paren
id|fctype
op_eq
id|NSP_FC_SRC
)paren
id|scp-&gt;flowrem_dat
op_decrement
suffix:semicolon
)brace
id|sent
op_add_assign
id|len
suffix:semicolon
id|dn_nsp_queue_xmit
c_func
(paren
id|sk
comma
id|skb
comma
id|sk-&gt;sk_allocation
comma
id|flags
op_amp
id|MSG_OOB
)paren
suffix:semicolon
id|skb
op_assign
l_int|NULL
suffix:semicolon
id|scp-&gt;persist
op_assign
id|dn_nsp_persist
c_func
(paren
id|sk
)paren
suffix:semicolon
)brace
id|out
suffix:colon
r_if
c_cond
(paren
id|skb
)paren
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
id|release_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
r_return
id|sent
ques
c_cond
id|sent
suffix:colon
id|err
suffix:semicolon
id|out_err
suffix:colon
id|err
op_assign
id|dn_error
c_func
(paren
id|sk
comma
id|flags
comma
id|err
)paren
suffix:semicolon
id|release_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|dn_device_event
r_static
r_int
id|dn_device_event
c_func
(paren
r_struct
id|notifier_block
op_star
id|this
comma
r_int
r_int
id|event
comma
r_void
op_star
id|ptr
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
(paren
r_struct
id|net_device
op_star
)paren
id|ptr
suffix:semicolon
r_switch
c_cond
(paren
id|event
)paren
(brace
r_case
id|NETDEV_UP
suffix:colon
id|dn_dev_up
c_func
(paren
id|dev
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|NETDEV_DOWN
suffix:colon
id|dn_dev_down
c_func
(paren
id|dev
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_break
suffix:semicolon
)brace
r_return
id|NOTIFY_DONE
suffix:semicolon
)brace
DECL|variable|dn_dev_notifier
r_static
r_struct
id|notifier_block
id|dn_dev_notifier
op_assign
(brace
dot
id|notifier_call
op_assign
id|dn_device_event
comma
)brace
suffix:semicolon
r_extern
r_int
id|dn_route_rcv
c_func
(paren
r_struct
id|sk_buff
op_star
comma
r_struct
id|net_device
op_star
comma
r_struct
id|packet_type
op_star
)paren
suffix:semicolon
DECL|variable|dn_dix_packet_type
r_static
r_struct
id|packet_type
id|dn_dix_packet_type
op_assign
(brace
dot
id|type
op_assign
id|__constant_htons
c_func
(paren
id|ETH_P_DNA_RT
)paren
comma
dot
id|dev
op_assign
l_int|NULL
comma
multiline_comment|/* All devices */
dot
id|func
op_assign
id|dn_route_rcv
comma
dot
id|data
op_assign
(paren
r_void
op_star
)paren
l_int|1
comma
)brace
suffix:semicolon
macro_line|#ifdef CONFIG_PROC_FS
DECL|struct|dn_iter_state
r_struct
id|dn_iter_state
(brace
DECL|member|bucket
r_int
id|bucket
suffix:semicolon
)brace
suffix:semicolon
DECL|function|dn_socket_get_first
r_static
r_struct
id|sock
op_star
id|dn_socket_get_first
c_func
(paren
r_struct
id|seq_file
op_star
id|seq
)paren
(brace
r_struct
id|dn_iter_state
op_star
id|state
op_assign
id|seq
op_member_access_from_pointer
r_private
suffix:semicolon
r_struct
id|sock
op_star
id|n
op_assign
l_int|NULL
suffix:semicolon
r_for
c_loop
(paren
id|state-&gt;bucket
op_assign
l_int|0
suffix:semicolon
id|state-&gt;bucket
OL
id|DN_SK_HASH_SIZE
suffix:semicolon
op_increment
id|state-&gt;bucket
)paren
(brace
id|n
op_assign
id|sk_head
c_func
(paren
op_amp
id|dn_sk_hash
(braket
id|state-&gt;bucket
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|n
)paren
r_break
suffix:semicolon
)brace
r_return
id|n
suffix:semicolon
)brace
DECL|function|dn_socket_get_next
r_static
r_struct
id|sock
op_star
id|dn_socket_get_next
c_func
(paren
r_struct
id|seq_file
op_star
id|seq
comma
r_struct
id|sock
op_star
id|n
)paren
(brace
r_struct
id|dn_iter_state
op_star
id|state
op_assign
id|seq
op_member_access_from_pointer
r_private
suffix:semicolon
id|n
op_assign
id|sk_next
c_func
(paren
id|n
)paren
suffix:semicolon
id|try_again
suffix:colon
r_if
c_cond
(paren
id|n
)paren
r_goto
id|out
suffix:semicolon
r_if
c_cond
(paren
op_increment
id|state-&gt;bucket
op_ge
id|DN_SK_HASH_SIZE
)paren
r_goto
id|out
suffix:semicolon
id|n
op_assign
id|sk_head
c_func
(paren
op_amp
id|dn_sk_hash
(braket
id|state-&gt;bucket
)braket
)paren
suffix:semicolon
r_goto
id|try_again
suffix:semicolon
id|out
suffix:colon
r_return
id|n
suffix:semicolon
)brace
DECL|function|socket_get_idx
r_static
r_struct
id|sock
op_star
id|socket_get_idx
c_func
(paren
r_struct
id|seq_file
op_star
id|seq
comma
id|loff_t
op_star
id|pos
)paren
(brace
r_struct
id|sock
op_star
id|sk
op_assign
id|dn_socket_get_first
c_func
(paren
id|seq
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sk
)paren
(brace
r_while
c_loop
(paren
op_star
id|pos
op_logical_and
(paren
id|sk
op_assign
id|dn_socket_get_next
c_func
(paren
id|seq
comma
id|sk
)paren
)paren
)paren
(brace
op_decrement
op_star
id|pos
suffix:semicolon
)brace
)brace
r_return
op_star
id|pos
ques
c_cond
l_int|NULL
suffix:colon
id|sk
suffix:semicolon
)brace
DECL|function|dn_socket_get_idx
r_static
r_void
op_star
id|dn_socket_get_idx
c_func
(paren
r_struct
id|seq_file
op_star
id|seq
comma
id|loff_t
id|pos
)paren
(brace
r_void
op_star
id|rc
suffix:semicolon
id|read_lock_bh
c_func
(paren
op_amp
id|dn_hash_lock
)paren
suffix:semicolon
id|rc
op_assign
id|socket_get_idx
c_func
(paren
id|seq
comma
op_amp
id|pos
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|rc
)paren
(brace
id|read_unlock_bh
c_func
(paren
op_amp
id|dn_hash_lock
)paren
suffix:semicolon
)brace
r_return
id|rc
suffix:semicolon
)brace
DECL|function|dn_socket_seq_start
r_static
r_void
op_star
id|dn_socket_seq_start
c_func
(paren
r_struct
id|seq_file
op_star
id|seq
comma
id|loff_t
op_star
id|pos
)paren
(brace
r_return
op_star
id|pos
ques
c_cond
id|dn_socket_get_idx
c_func
(paren
id|seq
comma
op_star
id|pos
op_minus
l_int|1
)paren
suffix:colon
(paren
r_void
op_star
)paren
l_int|1
suffix:semicolon
)brace
DECL|function|dn_socket_seq_next
r_static
r_void
op_star
id|dn_socket_seq_next
c_func
(paren
r_struct
id|seq_file
op_star
id|seq
comma
r_void
op_star
id|v
comma
id|loff_t
op_star
id|pos
)paren
(brace
r_void
op_star
id|rc
suffix:semicolon
r_if
c_cond
(paren
id|v
op_eq
(paren
r_void
op_star
)paren
l_int|1
)paren
(brace
id|rc
op_assign
id|dn_socket_get_idx
c_func
(paren
id|seq
comma
l_int|0
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|rc
op_assign
id|dn_socket_get_next
c_func
(paren
id|seq
comma
id|v
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_goto
id|out
suffix:semicolon
id|read_unlock_bh
c_func
(paren
op_amp
id|dn_hash_lock
)paren
suffix:semicolon
id|out
suffix:colon
op_increment
op_star
id|pos
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
DECL|function|dn_socket_seq_stop
r_static
r_void
id|dn_socket_seq_stop
c_func
(paren
r_struct
id|seq_file
op_star
id|seq
comma
r_void
op_star
id|v
)paren
(brace
r_if
c_cond
(paren
id|v
op_logical_and
id|v
op_ne
(paren
r_void
op_star
)paren
l_int|1
)paren
id|read_unlock_bh
c_func
(paren
op_amp
id|dn_hash_lock
)paren
suffix:semicolon
)brace
DECL|macro|IS_NOT_PRINTABLE
mdefine_line|#define IS_NOT_PRINTABLE(x) ((x) &lt; 32 || (x) &gt; 126)
DECL|function|dn_printable_object
r_static
r_void
id|dn_printable_object
c_func
(paren
r_struct
id|sockaddr_dn
op_star
id|dn
comma
r_int
r_char
op_star
id|buf
)paren
(brace
r_int
id|i
suffix:semicolon
r_switch
c_cond
(paren
id|dn_ntohs
c_func
(paren
id|dn-&gt;sdn_objnamel
)paren
)paren
(brace
r_case
l_int|0
suffix:colon
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%d&quot;
comma
id|dn-&gt;sdn_objnum
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
(brace
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|dn_ntohs
c_func
(paren
id|dn-&gt;sdn_objnamel
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
id|buf
(braket
id|i
)braket
op_assign
id|dn-&gt;sdn_objname
(braket
id|i
)braket
suffix:semicolon
r_if
c_cond
(paren
id|IS_NOT_PRINTABLE
c_func
(paren
id|buf
(braket
id|i
)braket
)paren
)paren
id|buf
(braket
id|i
)braket
op_assign
l_char|&squot;.&squot;
suffix:semicolon
)brace
id|buf
(braket
id|i
)braket
op_assign
l_int|0
suffix:semicolon
)brace
)brace
DECL|function|dn_state2asc
r_static
r_char
op_star
id|dn_state2asc
c_func
(paren
r_int
r_char
id|state
)paren
(brace
r_switch
c_cond
(paren
id|state
)paren
(brace
r_case
id|DN_O
suffix:colon
r_return
l_string|&quot;OPEN&quot;
suffix:semicolon
r_case
id|DN_CR
suffix:colon
r_return
l_string|&quot;  CR&quot;
suffix:semicolon
r_case
id|DN_DR
suffix:colon
r_return
l_string|&quot;  DR&quot;
suffix:semicolon
r_case
id|DN_DRC
suffix:colon
r_return
l_string|&quot; DRC&quot;
suffix:semicolon
r_case
id|DN_CC
suffix:colon
r_return
l_string|&quot;  CC&quot;
suffix:semicolon
r_case
id|DN_CI
suffix:colon
r_return
l_string|&quot;  CI&quot;
suffix:semicolon
r_case
id|DN_NR
suffix:colon
r_return
l_string|&quot;  NR&quot;
suffix:semicolon
r_case
id|DN_NC
suffix:colon
r_return
l_string|&quot;  NC&quot;
suffix:semicolon
r_case
id|DN_CD
suffix:colon
r_return
l_string|&quot;  CD&quot;
suffix:semicolon
r_case
id|DN_RJ
suffix:colon
r_return
l_string|&quot;  RJ&quot;
suffix:semicolon
r_case
id|DN_RUN
suffix:colon
r_return
l_string|&quot; RUN&quot;
suffix:semicolon
r_case
id|DN_DI
suffix:colon
r_return
l_string|&quot;  DI&quot;
suffix:semicolon
r_case
id|DN_DIC
suffix:colon
r_return
l_string|&quot; DIC&quot;
suffix:semicolon
r_case
id|DN_DN
suffix:colon
r_return
l_string|&quot;  DN&quot;
suffix:semicolon
r_case
id|DN_CL
suffix:colon
r_return
l_string|&quot;  CL&quot;
suffix:semicolon
r_case
id|DN_CN
suffix:colon
r_return
l_string|&quot;  CN&quot;
suffix:semicolon
)brace
r_return
l_string|&quot;????&quot;
suffix:semicolon
)brace
DECL|function|dn_socket_format_entry
r_static
r_inline
r_void
id|dn_socket_format_entry
c_func
(paren
r_struct
id|seq_file
op_star
id|seq
comma
r_struct
id|sock
op_star
id|sk
)paren
(brace
r_struct
id|dn_scp
op_star
id|scp
op_assign
id|DN_SK
c_func
(paren
id|sk
)paren
suffix:semicolon
r_char
id|buf1
(braket
id|DN_ASCBUF_LEN
)braket
suffix:semicolon
r_char
id|buf2
(braket
id|DN_ASCBUF_LEN
)braket
suffix:semicolon
r_char
id|local_object
(braket
id|DN_MAXOBJL
op_plus
l_int|3
)braket
suffix:semicolon
r_char
id|remote_object
(braket
id|DN_MAXOBJL
op_plus
l_int|3
)braket
suffix:semicolon
id|dn_printable_object
c_func
(paren
op_amp
id|scp-&gt;addr
comma
id|local_object
)paren
suffix:semicolon
id|dn_printable_object
c_func
(paren
op_amp
id|scp-&gt;peer
comma
id|remote_object
)paren
suffix:semicolon
id|seq_printf
c_func
(paren
id|seq
comma
l_string|&quot;%6s/%04X %04d:%04d %04d:%04d %01d %-16s &quot;
l_string|&quot;%6s/%04X %04d:%04d %04d:%04d %01d %-16s %4s %s&bslash;n&quot;
comma
id|dn_addr2asc
c_func
(paren
id|dn_ntohs
c_func
(paren
id|dn_saddr2dn
c_func
(paren
op_amp
id|scp-&gt;addr
)paren
)paren
comma
id|buf1
)paren
comma
id|scp-&gt;addrloc
comma
id|scp-&gt;numdat
comma
id|scp-&gt;numoth
comma
id|scp-&gt;ackxmt_dat
comma
id|scp-&gt;ackxmt_oth
comma
id|scp-&gt;flowloc_sw
comma
id|local_object
comma
id|dn_addr2asc
c_func
(paren
id|dn_ntohs
c_func
(paren
id|dn_saddr2dn
c_func
(paren
op_amp
id|scp-&gt;peer
)paren
)paren
comma
id|buf2
)paren
comma
id|scp-&gt;addrrem
comma
id|scp-&gt;numdat_rcv
comma
id|scp-&gt;numoth_rcv
comma
id|scp-&gt;ackrcv_dat
comma
id|scp-&gt;ackrcv_oth
comma
id|scp-&gt;flowrem_sw
comma
id|remote_object
comma
id|dn_state2asc
c_func
(paren
id|scp-&gt;state
)paren
comma
(paren
(paren
id|scp-&gt;accept_mode
op_eq
id|ACC_IMMED
)paren
ques
c_cond
l_string|&quot;IMMED&quot;
suffix:colon
l_string|&quot;DEFER&quot;
)paren
)paren
suffix:semicolon
)brace
DECL|function|dn_socket_seq_show
r_static
r_int
id|dn_socket_seq_show
c_func
(paren
r_struct
id|seq_file
op_star
id|seq
comma
r_void
op_star
id|v
)paren
(brace
r_if
c_cond
(paren
id|v
op_eq
(paren
r_void
op_star
)paren
l_int|1
)paren
(brace
id|seq_puts
c_func
(paren
id|seq
comma
l_string|&quot;Local                                              Remote&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_else
(brace
id|dn_socket_format_entry
c_func
(paren
id|seq
comma
id|v
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|dn_socket_seq_ops
r_static
r_struct
id|seq_operations
id|dn_socket_seq_ops
op_assign
(brace
dot
id|start
op_assign
id|dn_socket_seq_start
comma
dot
id|next
op_assign
id|dn_socket_seq_next
comma
dot
id|stop
op_assign
id|dn_socket_seq_stop
comma
dot
id|show
op_assign
id|dn_socket_seq_show
comma
)brace
suffix:semicolon
DECL|function|dn_socket_seq_open
r_static
r_int
id|dn_socket_seq_open
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
(brace
r_struct
id|seq_file
op_star
id|seq
suffix:semicolon
r_int
id|rc
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_struct
id|dn_iter_state
op_star
id|s
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|s
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|s
)paren
r_goto
id|out
suffix:semicolon
id|rc
op_assign
id|seq_open
c_func
(paren
id|file
comma
op_amp
id|dn_socket_seq_ops
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_goto
id|out_kfree
suffix:semicolon
id|seq
op_assign
id|file-&gt;private_data
suffix:semicolon
id|seq
op_member_access_from_pointer
r_private
op_assign
id|s
suffix:semicolon
id|memset
c_func
(paren
id|s
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|s
)paren
)paren
suffix:semicolon
id|out
suffix:colon
r_return
id|rc
suffix:semicolon
id|out_kfree
suffix:colon
id|kfree
c_func
(paren
id|s
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
DECL|variable|dn_socket_seq_fops
r_static
r_struct
id|file_operations
id|dn_socket_seq_fops
op_assign
(brace
dot
id|open
op_assign
id|dn_socket_seq_open
comma
dot
id|read
op_assign
id|seq_read
comma
dot
id|llseek
op_assign
id|seq_lseek
comma
dot
id|release
op_assign
id|seq_release_private
comma
)brace
suffix:semicolon
macro_line|#endif
DECL|variable|dn_family_ops
r_static
r_struct
id|net_proto_family
id|dn_family_ops
op_assign
(brace
dot
id|family
op_assign
id|AF_DECnet
comma
dot
id|create
op_assign
id|dn_create
comma
dot
id|owner
op_assign
id|THIS_MODULE
comma
)brace
suffix:semicolon
DECL|variable|dn_proto_ops
r_static
r_struct
id|proto_ops
id|dn_proto_ops
op_assign
(brace
dot
id|family
op_assign
id|AF_DECnet
comma
dot
id|owner
op_assign
id|THIS_MODULE
comma
dot
id|release
op_assign
id|dn_release
comma
dot
id|bind
op_assign
id|dn_bind
comma
dot
id|connect
op_assign
id|dn_connect
comma
dot
id|socketpair
op_assign
id|sock_no_socketpair
comma
dot
id|accept
op_assign
id|dn_accept
comma
dot
id|getname
op_assign
id|dn_getname
comma
dot
id|poll
op_assign
id|dn_poll
comma
dot
id|ioctl
op_assign
id|dn_ioctl
comma
dot
id|listen
op_assign
id|dn_listen
comma
dot
id|shutdown
op_assign
id|dn_shutdown
comma
dot
id|setsockopt
op_assign
id|dn_setsockopt
comma
dot
id|getsockopt
op_assign
id|dn_getsockopt
comma
dot
id|sendmsg
op_assign
id|dn_sendmsg
comma
dot
id|recvmsg
op_assign
id|dn_recvmsg
comma
dot
id|mmap
op_assign
id|sock_no_mmap
comma
dot
id|sendpage
op_assign
id|sock_no_sendpage
comma
)brace
suffix:semicolon
r_void
id|dn_register_sysctl
c_func
(paren
r_void
)paren
suffix:semicolon
r_void
id|dn_unregister_sysctl
c_func
(paren
r_void
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;The Linux DECnet Network Protocol&quot;
)paren
suffix:semicolon
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Linux DECnet Project Team&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
DECL|variable|__initdata
r_static
r_char
id|banner
(braket
)braket
id|__initdata
op_assign
id|KERN_INFO
l_string|&quot;NET4: DECnet for Linux: V.2.5.68s (C) 1995-2003 Linux DECnet Project Team&bslash;n&quot;
suffix:semicolon
DECL|function|decnet_init
r_static
r_int
id|__init
id|decnet_init
c_func
(paren
r_void
)paren
(brace
id|printk
c_func
(paren
id|banner
)paren
suffix:semicolon
id|dn_sk_cachep
op_assign
id|kmem_cache_create
c_func
(paren
l_string|&quot;decnet_socket_cache&quot;
comma
r_sizeof
(paren
r_struct
id|dn_sock
)paren
comma
l_int|0
comma
id|SLAB_HWCACHE_ALIGN
comma
l_int|NULL
comma
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dn_sk_cachep
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|sock_register
c_func
(paren
op_amp
id|dn_family_ops
)paren
suffix:semicolon
id|dev_add_pack
c_func
(paren
op_amp
id|dn_dix_packet_type
)paren
suffix:semicolon
id|register_netdevice_notifier
c_func
(paren
op_amp
id|dn_dev_notifier
)paren
suffix:semicolon
id|proc_net_fops_create
c_func
(paren
l_string|&quot;decnet&quot;
comma
id|S_IRUGO
comma
op_amp
id|dn_socket_seq_fops
)paren
suffix:semicolon
id|dn_neigh_init
c_func
(paren
)paren
suffix:semicolon
id|dn_dev_init
c_func
(paren
)paren
suffix:semicolon
id|dn_route_init
c_func
(paren
)paren
suffix:semicolon
id|dn_fib_init
c_func
(paren
)paren
suffix:semicolon
id|dn_register_sysctl
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Prevent DECnet module unloading until its fixed properly.&n;&t; * Requires an audit of the code to check for memory leaks and&n;&t; * initialisation problems etc.&n;&t; */
id|try_module_get
c_func
(paren
id|THIS_MODULE
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|decnet_exit
r_static
r_void
id|__exit
id|decnet_exit
c_func
(paren
r_void
)paren
(brace
id|sock_unregister
c_func
(paren
id|AF_DECnet
)paren
suffix:semicolon
id|dev_remove_pack
c_func
(paren
op_amp
id|dn_dix_packet_type
)paren
suffix:semicolon
id|dn_unregister_sysctl
c_func
(paren
)paren
suffix:semicolon
id|unregister_netdevice_notifier
c_func
(paren
op_amp
id|dn_dev_notifier
)paren
suffix:semicolon
id|dn_route_cleanup
c_func
(paren
)paren
suffix:semicolon
id|dn_dev_cleanup
c_func
(paren
)paren
suffix:semicolon
id|dn_neigh_cleanup
c_func
(paren
)paren
suffix:semicolon
id|dn_fib_cleanup
c_func
(paren
)paren
suffix:semicolon
id|proc_net_remove
c_func
(paren
l_string|&quot;decnet&quot;
)paren
suffix:semicolon
id|kmem_cache_destroy
c_func
(paren
id|dn_sk_cachep
)paren
suffix:semicolon
)brace
DECL|variable|decnet_init
id|module_init
c_func
(paren
id|decnet_init
)paren
suffix:semicolon
DECL|variable|decnet_exit
id|module_exit
c_func
(paren
id|decnet_exit
)paren
suffix:semicolon
eof
