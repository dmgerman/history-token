multiline_comment|/*&n; * DECnet       An implementation of the DECnet protocol suite for the LINUX&n; *              operating system.  DECnet is implemented using the  BSD Socket&n; *              interface as the means of communication with the user level.&n; *&n; *              DECnet Network Services Protocol (Output)&n; *&n; * Author:      Eduardo Marcelo Serrat &lt;emserrat@geocities.com&gt;&n; *&n; * Changes:&n; *&n; *    Steve Whitehouse:  Split into dn_nsp_in.c and dn_nsp_out.c from&n; *                       original dn_nsp.c.&n; *    Steve Whitehouse:  Updated to work with my new routing architecture.&n; *    Steve Whitehouse:  Added changes from Eduardo Serrat&squot;s patches.&n; *    Steve Whitehouse:  Now conninits have the &quot;return&quot; bit set.&n; *    Steve Whitehouse:  Fixes to check alloc&squot;d skbs are non NULL!&n; *                       Moved output state machine into one function&n; *    Steve Whitehouse:  New output state machine&n; *         Paul Koning:  Connect Confirm message fix.&n; *      Eduardo Serrat:  Fix to stop dn_nsp_do_disc() sending malformed packets.&n; *    Steve Whitehouse:  dn_nsp_output() and friends needed a spring clean&n; */
multiline_comment|/******************************************************************************&n;    (c) 1995-1998 E.M. Serrat&t;&t;emserrat@geocities.com&n;    &n;    This program is free software; you can redistribute it and/or modify&n;    it under the terms of the GNU General Public License as published by&n;    the Free Software Foundation; either version 2 of the License, or&n;    any later version.&n;&n;    This program is distributed in the hope that it will be useful,&n;    but WITHOUT ANY WARRANTY; without even the implied warranty of&n;    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n;    GNU General Public License for more details.&n;*******************************************************************************/
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/socket.h&gt;
macro_line|#include &lt;linux/in.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/timer.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/sockios.h&gt;
macro_line|#include &lt;linux/net.h&gt;
macro_line|#include &lt;linux/netdevice.h&gt;
macro_line|#include &lt;linux/inet.h&gt;
macro_line|#include &lt;linux/route.h&gt;
macro_line|#include &lt;net/sock.h&gt;
macro_line|#include &lt;asm/segment.h&gt;
macro_line|#include &lt;asm/system.h&gt;
macro_line|#include &lt;linux/fcntl.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/termios.h&gt;      
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/proc_fs.h&gt;
macro_line|#include &lt;linux/stat.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/poll.h&gt;
macro_line|#include &lt;linux/if_packet.h&gt;
macro_line|#include &lt;net/neighbour.h&gt;
macro_line|#include &lt;net/dst.h&gt;
macro_line|#include &lt;net/dn_nsp.h&gt;
macro_line|#include &lt;net/dn_dev.h&gt;
macro_line|#include &lt;net/dn_route.h&gt;
DECL|variable|nsp_backoff
r_static
r_int
id|nsp_backoff
(braket
id|NSP_MAXRXTSHIFT
op_plus
l_int|1
)braket
op_assign
(brace
l_int|1
comma
l_int|2
comma
l_int|4
comma
l_int|8
comma
l_int|16
comma
l_int|32
comma
l_int|64
comma
l_int|64
comma
l_int|64
comma
l_int|64
comma
l_int|64
comma
l_int|64
comma
l_int|64
)brace
suffix:semicolon
multiline_comment|/*&n; * If sk == NULL, then we assume that we are supposed to be making&n; * a routing layer skb. If sk != NULL, then we are supposed to be&n; * creating an skb for the NSP layer.&n; *&n; * The eventual aim is for each socket to have a cached header size&n; * for its outgoing packets, and to set hdr from this when sk != NULL.&n; */
DECL|function|dn_alloc_skb
r_struct
id|sk_buff
op_star
id|dn_alloc_skb
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_int
id|size
comma
r_int
id|pri
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_int
id|hdr
op_assign
l_int|64
suffix:semicolon
r_if
c_cond
(paren
(paren
id|skb
op_assign
id|alloc_skb
c_func
(paren
id|size
op_plus
id|hdr
comma
id|pri
)paren
)paren
op_eq
l_int|NULL
)paren
r_return
l_int|NULL
suffix:semicolon
id|skb-&gt;protocol
op_assign
id|__constant_htons
c_func
(paren
id|ETH_P_DNA_RT
)paren
suffix:semicolon
id|skb-&gt;pkt_type
op_assign
id|PACKET_OUTGOING
suffix:semicolon
r_if
c_cond
(paren
id|sk
)paren
id|skb_set_owner_w
c_func
(paren
id|skb
comma
id|sk
)paren
suffix:semicolon
id|skb_reserve
c_func
(paren
id|skb
comma
id|hdr
)paren
suffix:semicolon
r_return
id|skb
suffix:semicolon
)brace
multiline_comment|/*&n; * Wrapper for the above, for allocs of data skbs. We try and get the&n; * whole size thats been asked for (plus 11 bytes of header). If this&n; * fails, then we try for any size over 16 bytes for SOCK_STREAMS.&n; */
DECL|function|dn_alloc_send_skb
r_struct
id|sk_buff
op_star
id|dn_alloc_send_skb
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_int
op_star
id|size
comma
r_int
id|noblock
comma
r_int
op_star
id|err
)paren
(brace
r_int
id|space
suffix:semicolon
r_int
id|len
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
op_assign
l_int|NULL
suffix:semicolon
op_star
id|err
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|skb
op_eq
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
id|signal_pending
c_func
(paren
id|current
)paren
)paren
(brace
op_star
id|err
op_assign
id|ERESTARTSYS
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sk-&gt;shutdown
op_amp
id|SEND_SHUTDOWN
)paren
(brace
op_star
id|err
op_assign
id|EINVAL
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sk-&gt;err
)paren
r_break
suffix:semicolon
id|len
op_assign
op_star
id|size
op_plus
l_int|11
suffix:semicolon
id|space
op_assign
id|sk-&gt;sndbuf
op_minus
id|atomic_read
c_func
(paren
op_amp
id|sk-&gt;wmem_alloc
)paren
suffix:semicolon
r_if
c_cond
(paren
id|space
OL
id|len
)paren
(brace
r_if
c_cond
(paren
(paren
id|sk-&gt;socket-&gt;type
op_eq
id|SOCK_STREAM
)paren
op_logical_and
(paren
id|space
op_ge
(paren
l_int|16
op_plus
l_int|11
)paren
)paren
)paren
id|len
op_assign
id|space
suffix:semicolon
)brace
r_if
c_cond
(paren
id|space
OL
id|len
)paren
(brace
id|set_bit
c_func
(paren
id|SOCK_ASYNC_NOSPACE
comma
op_amp
id|sk-&gt;socket-&gt;flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|noblock
)paren
(brace
op_star
id|err
op_assign
id|EWOULDBLOCK
suffix:semicolon
r_break
suffix:semicolon
)brace
id|clear_bit
c_func
(paren
id|SOCK_ASYNC_WAITDATA
comma
op_amp
id|sk-&gt;socket-&gt;flags
)paren
suffix:semicolon
id|SOCK_SLEEP_PRE
c_func
(paren
id|sk
)paren
r_if
c_cond
(paren
(paren
id|sk-&gt;sndbuf
op_minus
id|atomic_read
c_func
(paren
op_amp
id|sk-&gt;wmem_alloc
)paren
)paren
OL
id|len
)paren
id|schedule
c_func
(paren
)paren
suffix:semicolon
id|SOCK_SLEEP_POST
c_func
(paren
id|sk
)paren
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|skb
op_assign
id|dn_alloc_skb
c_func
(paren
id|sk
comma
id|len
comma
id|sk-&gt;allocation
)paren
)paren
op_eq
l_int|NULL
)paren
r_continue
suffix:semicolon
op_star
id|size
op_assign
id|len
op_minus
l_int|11
suffix:semicolon
)brace
r_return
id|skb
suffix:semicolon
)brace
multiline_comment|/*&n; * Calculate persist timer based upon the smoothed round&n; * trip time and the variance. Backoff according to the&n; * nsp_backoff[] array.&n; */
DECL|function|dn_nsp_persist
r_int
r_int
id|dn_nsp_persist
c_func
(paren
r_struct
id|sock
op_star
id|sk
)paren
(brace
r_struct
id|dn_scp
op_star
id|scp
op_assign
id|DN_SK
c_func
(paren
id|sk
)paren
suffix:semicolon
r_int
r_int
id|t
op_assign
(paren
(paren
id|scp-&gt;nsp_srtt
op_rshift
l_int|2
)paren
op_plus
id|scp-&gt;nsp_rttvar
)paren
op_rshift
l_int|1
suffix:semicolon
id|t
op_mul_assign
id|nsp_backoff
(braket
id|scp-&gt;nsp_rxtshift
)braket
suffix:semicolon
r_if
c_cond
(paren
id|t
OL
id|HZ
)paren
id|t
op_assign
id|HZ
suffix:semicolon
r_if
c_cond
(paren
id|t
OG
(paren
l_int|600
op_star
id|HZ
)paren
)paren
id|t
op_assign
(paren
l_int|600
op_star
id|HZ
)paren
suffix:semicolon
r_if
c_cond
(paren
id|scp-&gt;nsp_rxtshift
OL
id|NSP_MAXRXTSHIFT
)paren
id|scp-&gt;nsp_rxtshift
op_increment
suffix:semicolon
multiline_comment|/* printk(KERN_DEBUG &quot;rxtshift %lu, t=%lu&bslash;n&quot;, scp-&gt;nsp_rxtshift, t); */
r_return
id|t
suffix:semicolon
)brace
multiline_comment|/*&n; * This is called each time we get an estimate for the rtt&n; * on the link.&n; */
DECL|function|dn_nsp_rtt
r_static
r_void
id|dn_nsp_rtt
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_int
id|rtt
)paren
(brace
r_struct
id|dn_scp
op_star
id|scp
op_assign
id|DN_SK
c_func
(paren
id|sk
)paren
suffix:semicolon
r_int
id|srtt
op_assign
(paren
r_int
)paren
id|scp-&gt;nsp_srtt
suffix:semicolon
r_int
id|rttvar
op_assign
(paren
r_int
)paren
id|scp-&gt;nsp_rttvar
suffix:semicolon
r_int
id|delta
suffix:semicolon
multiline_comment|/*&n;&t; * If the jiffies clock flips over in the middle of timestamp&n;&t; * gathering this value might turn out negative, so we make sure&n;&t; * that is it always positive here.&n;&t; */
r_if
c_cond
(paren
id|rtt
OL
l_int|0
)paren
id|rtt
op_assign
op_minus
id|rtt
suffix:semicolon
multiline_comment|/*&n;&t; * Add new rtt to smoothed average&n;&t; */
id|delta
op_assign
(paren
(paren
id|rtt
op_lshift
l_int|3
)paren
op_minus
id|srtt
)paren
suffix:semicolon
id|srtt
op_add_assign
(paren
id|delta
op_rshift
l_int|3
)paren
suffix:semicolon
r_if
c_cond
(paren
id|srtt
op_ge
l_int|1
)paren
id|scp-&gt;nsp_srtt
op_assign
(paren
r_int
r_int
)paren
id|srtt
suffix:semicolon
r_else
id|scp-&gt;nsp_srtt
op_assign
l_int|1
suffix:semicolon
multiline_comment|/*&n;&t; * Add new rtt varience to smoothed varience&n;&t; */
id|delta
op_rshift_assign
l_int|1
suffix:semicolon
id|rttvar
op_add_assign
(paren
(paren
(paren
(paren
id|delta
OG
l_int|0
)paren
ques
c_cond
(paren
id|delta
)paren
suffix:colon
(paren
op_minus
id|delta
)paren
)paren
op_minus
id|rttvar
)paren
op_rshift
l_int|2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rttvar
op_ge
l_int|1
)paren
id|scp-&gt;nsp_rttvar
op_assign
(paren
r_int
r_int
)paren
id|rttvar
suffix:semicolon
r_else
id|scp-&gt;nsp_rttvar
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* printk(KERN_DEBUG &quot;srtt=%lu rttvar=%lu&bslash;n&quot;, scp-&gt;nsp_srtt, scp-&gt;nsp_rttvar); */
)brace
multiline_comment|/**&n; * dn_nsp_clone_and_send - Send a data packet by cloning it&n; * @skb: The packet to clone and transmit&n; * @gfp: memory allocation flag&n; *&n; * Clone a queued data or other data packet and transmit it.&n; *&n; * Returns: The number of times the packet has been sent previously&n; */
DECL|function|dn_nsp_clone_and_send
r_static
r_inline
r_int
id|dn_nsp_clone_and_send
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_int
id|gfp
)paren
(brace
r_struct
id|dn_skb_cb
op_star
id|cb
op_assign
id|DN_SKB_CB
c_func
(paren
id|skb
)paren
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb2
suffix:semicolon
r_int
id|ret
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
(paren
id|skb2
op_assign
id|skb_clone
c_func
(paren
id|skb
comma
id|gfp
)paren
)paren
op_ne
l_int|NULL
)paren
(brace
id|ret
op_assign
id|cb-&gt;xmit_count
suffix:semicolon
id|cb-&gt;xmit_count
op_increment
suffix:semicolon
id|cb-&gt;stamp
op_assign
id|jiffies
suffix:semicolon
id|skb2-&gt;sk
op_assign
id|skb-&gt;sk
suffix:semicolon
id|dn_nsp_send
c_func
(paren
id|skb2
)paren
suffix:semicolon
)brace
r_return
id|ret
suffix:semicolon
)brace
multiline_comment|/**&n; * dn_nsp_output - Try and send something from socket queues&n; * @sk: The socket whose queues are to be investigated&n; * @gfp: The memory allocation flags&n; *&n; * Try and send the packet on the end of the data and other data queues.&n; * Other data gets priority over data, and if we retransmit a packet we&n; * reduce the window by dividing it in two.&n; *&n; */
DECL|function|dn_nsp_output
r_void
id|dn_nsp_output
c_func
(paren
r_struct
id|sock
op_star
id|sk
)paren
(brace
r_struct
id|dn_scp
op_star
id|scp
op_assign
id|DN_SK
c_func
(paren
id|sk
)paren
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_int
id|reduce_win
op_assign
l_int|0
suffix:semicolon
multiline_comment|/*&n;&t; * First we check for otherdata/linkservice messages&n;&t; */
r_if
c_cond
(paren
(paren
id|skb
op_assign
id|skb_peek
c_func
(paren
op_amp
id|scp-&gt;other_xmit_queue
)paren
)paren
op_ne
l_int|NULL
)paren
id|reduce_win
op_assign
id|dn_nsp_clone_and_send
c_func
(paren
id|skb
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * If we may not send any data, we don&squot;t.&n;&t; * If we are still trying to get some other data down the&n;&t; * channel, we don&squot;t try and send any data.&n;&t; */
r_if
c_cond
(paren
id|reduce_win
op_logical_or
(paren
id|scp-&gt;flowrem_sw
op_ne
id|DN_SEND
)paren
)paren
r_goto
id|recalc_window
suffix:semicolon
r_if
c_cond
(paren
(paren
id|skb
op_assign
id|skb_peek
c_func
(paren
op_amp
id|scp-&gt;data_xmit_queue
)paren
)paren
op_ne
l_int|NULL
)paren
id|reduce_win
op_assign
id|dn_nsp_clone_and_send
c_func
(paren
id|skb
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * If we&squot;ve sent any frame more than once, we cut the&n;&t; * send window size in half. There is always a minimum&n;&t; * window size of one available.&n;&t; */
id|recalc_window
suffix:colon
r_if
c_cond
(paren
id|reduce_win
)paren
(brace
id|scp-&gt;snd_window
op_rshift_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|scp-&gt;snd_window
OL
id|NSP_MIN_WINDOW
)paren
id|scp-&gt;snd_window
op_assign
id|NSP_MIN_WINDOW
suffix:semicolon
)brace
)brace
DECL|function|dn_nsp_xmit_timeout
r_int
id|dn_nsp_xmit_timeout
c_func
(paren
r_struct
id|sock
op_star
id|sk
)paren
(brace
r_struct
id|dn_scp
op_star
id|scp
op_assign
id|DN_SK
c_func
(paren
id|sk
)paren
suffix:semicolon
id|dn_nsp_output
c_func
(paren
id|sk
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb_queue_len
c_func
(paren
op_amp
id|scp-&gt;data_xmit_queue
)paren
op_logical_or
id|skb_queue_len
c_func
(paren
op_amp
id|scp-&gt;other_xmit_queue
)paren
)paren
id|scp-&gt;persist
op_assign
id|dn_nsp_persist
c_func
(paren
id|sk
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dn_mk_common_header
r_static
r_inline
r_int
r_char
op_star
id|dn_mk_common_header
c_func
(paren
r_struct
id|dn_scp
op_star
id|scp
comma
r_struct
id|sk_buff
op_star
id|skb
comma
r_int
r_char
id|msgflag
comma
r_int
id|len
)paren
(brace
r_int
r_char
op_star
id|ptr
op_assign
id|skb_push
c_func
(paren
id|skb
comma
id|len
)paren
suffix:semicolon
r_if
c_cond
(paren
id|len
OL
l_int|5
)paren
id|BUG
c_func
(paren
)paren
suffix:semicolon
op_star
id|ptr
op_increment
op_assign
id|msgflag
suffix:semicolon
op_star
(paren
(paren
r_int
r_int
op_star
)paren
id|ptr
)paren
op_assign
id|scp-&gt;addrrem
suffix:semicolon
id|ptr
op_add_assign
l_int|2
suffix:semicolon
op_star
(paren
(paren
r_int
r_int
op_star
)paren
id|ptr
)paren
op_assign
id|scp-&gt;addrloc
suffix:semicolon
id|ptr
op_add_assign
l_int|2
suffix:semicolon
r_return
id|ptr
suffix:semicolon
)brace
DECL|function|dn_mk_ack_header
r_static
r_int
r_int
op_star
id|dn_mk_ack_header
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_struct
id|sk_buff
op_star
id|skb
comma
r_int
r_char
id|msgflag
comma
r_int
id|hlen
comma
r_int
id|other
)paren
(brace
r_struct
id|dn_scp
op_star
id|scp
op_assign
id|DN_SK
c_func
(paren
id|sk
)paren
suffix:semicolon
r_int
r_int
id|acknum
op_assign
id|scp-&gt;numdat_rcv
op_amp
l_int|0x0FFF
suffix:semicolon
r_int
r_int
id|ackcrs
op_assign
id|scp-&gt;numoth_rcv
op_amp
l_int|0x0FFF
suffix:semicolon
r_int
r_int
op_star
id|ptr
suffix:semicolon
r_if
c_cond
(paren
id|hlen
OL
l_int|9
)paren
id|BUG
c_func
(paren
)paren
suffix:semicolon
id|scp-&gt;ackxmt_dat
op_assign
id|acknum
suffix:semicolon
id|scp-&gt;ackxmt_oth
op_assign
id|ackcrs
suffix:semicolon
id|acknum
op_or_assign
l_int|0x8000
suffix:semicolon
id|ackcrs
op_or_assign
l_int|0x8000
suffix:semicolon
multiline_comment|/* If this is an &quot;other data/ack&quot; message, swap acknum and ackcrs */
r_if
c_cond
(paren
id|other
)paren
(brace
r_int
r_int
id|tmp
op_assign
id|acknum
suffix:semicolon
id|acknum
op_assign
id|ackcrs
suffix:semicolon
id|ackcrs
op_assign
id|tmp
suffix:semicolon
)brace
multiline_comment|/* Set &quot;cross subchannel&quot; bit in ackcrs */
id|ackcrs
op_or_assign
l_int|0x2000
suffix:semicolon
id|ptr
op_assign
(paren
r_int
r_int
op_star
)paren
id|dn_mk_common_header
c_func
(paren
id|scp
comma
id|skb
comma
id|msgflag
comma
id|hlen
)paren
suffix:semicolon
op_star
id|ptr
op_increment
op_assign
id|dn_htons
c_func
(paren
id|acknum
)paren
suffix:semicolon
op_star
id|ptr
op_increment
op_assign
id|dn_htons
c_func
(paren
id|ackcrs
)paren
suffix:semicolon
r_return
id|ptr
suffix:semicolon
)brace
DECL|function|dn_nsp_queue_xmit
r_void
id|dn_nsp_queue_xmit
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_struct
id|sk_buff
op_star
id|skb
comma
r_int
id|gfp
comma
r_int
id|oth
)paren
(brace
r_struct
id|dn_scp
op_star
id|scp
op_assign
id|DN_SK
c_func
(paren
id|sk
)paren
suffix:semicolon
r_struct
id|dn_skb_cb
op_star
id|cb
op_assign
id|DN_SKB_CB
c_func
(paren
id|skb
)paren
suffix:semicolon
r_int
r_int
id|t
op_assign
(paren
(paren
id|scp-&gt;nsp_srtt
op_rshift
l_int|2
)paren
op_plus
id|scp-&gt;nsp_rttvar
)paren
op_rshift
l_int|1
suffix:semicolon
multiline_comment|/*&n;&t; * Slow start: If we have been idle for more than&n;&t; * one RTT, then reset window to min size.&n;&t; */
r_if
c_cond
(paren
(paren
id|jiffies
op_minus
id|scp-&gt;stamp
)paren
OG
id|t
)paren
id|scp-&gt;snd_window
op_assign
id|NSP_MIN_WINDOW
suffix:semicolon
multiline_comment|/* printk(KERN_DEBUG &quot;Window: %lu&bslash;n&quot;, scp-&gt;snd_window); */
id|cb-&gt;xmit_count
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|oth
)paren
id|skb_queue_tail
c_func
(paren
op_amp
id|scp-&gt;other_xmit_queue
comma
id|skb
)paren
suffix:semicolon
r_else
id|skb_queue_tail
c_func
(paren
op_amp
id|scp-&gt;data_xmit_queue
comma
id|skb
)paren
suffix:semicolon
r_if
c_cond
(paren
id|scp-&gt;flowrem_sw
op_ne
id|DN_SEND
)paren
r_return
suffix:semicolon
id|dn_nsp_clone_and_send
c_func
(paren
id|skb
comma
id|gfp
)paren
suffix:semicolon
)brace
DECL|function|dn_nsp_check_xmit_queue
r_int
id|dn_nsp_check_xmit_queue
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|sk_buff_head
op_star
id|q
comma
r_int
r_int
id|acknum
)paren
(brace
r_struct
id|dn_skb_cb
op_star
id|cb
op_assign
id|DN_SKB_CB
c_func
(paren
id|skb
)paren
suffix:semicolon
r_struct
id|dn_scp
op_star
id|scp
op_assign
id|DN_SK
c_func
(paren
id|sk
)paren
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb2
comma
op_star
id|list
comma
op_star
id|ack
op_assign
l_int|NULL
suffix:semicolon
r_int
id|wakeup
op_assign
l_int|0
suffix:semicolon
r_int
id|try_retrans
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|reftime
op_assign
id|cb-&gt;stamp
suffix:semicolon
r_int
r_int
id|pkttime
suffix:semicolon
r_int
r_int
id|xmit_count
suffix:semicolon
r_int
r_int
id|segnum
suffix:semicolon
id|skb2
op_assign
id|q-&gt;next
suffix:semicolon
id|list
op_assign
(paren
r_struct
id|sk_buff
op_star
)paren
id|q
suffix:semicolon
r_while
c_loop
(paren
id|list
op_ne
id|skb2
)paren
(brace
r_struct
id|dn_skb_cb
op_star
id|cb2
op_assign
id|DN_SKB_CB
c_func
(paren
id|skb2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|before_or_equal
c_func
(paren
id|cb2-&gt;segnum
comma
id|acknum
)paren
)paren
id|ack
op_assign
id|skb2
suffix:semicolon
multiline_comment|/* printk(KERN_DEBUG &quot;ack: %s %04x %04x&bslash;n&quot;, ack ? &quot;ACK&quot; : &quot;SKIP&quot;, (int)cb2-&gt;segnum, (int)acknum); */
id|skb2
op_assign
id|skb2-&gt;next
suffix:semicolon
r_if
c_cond
(paren
id|ack
op_eq
l_int|NULL
)paren
r_continue
suffix:semicolon
multiline_comment|/* printk(KERN_DEBUG &quot;check_xmit_queue: %04x, %d&bslash;n&quot;, acknum, cb2-&gt;xmit_count); */
multiline_comment|/* Does _last_ packet acked have xmit_count &gt; 1 */
id|try_retrans
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Remember to wake up the sending process */
id|wakeup
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* Keep various statistics */
id|pkttime
op_assign
id|cb2-&gt;stamp
suffix:semicolon
id|xmit_count
op_assign
id|cb2-&gt;xmit_count
suffix:semicolon
id|segnum
op_assign
id|cb2-&gt;segnum
suffix:semicolon
multiline_comment|/* Remove and drop ack&squot;ed packet */
id|skb_unlink
c_func
(paren
id|ack
)paren
suffix:semicolon
id|kfree_skb
c_func
(paren
id|ack
)paren
suffix:semicolon
id|ack
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/*&n;&t;&t; * We don&squot;t expect to see acknowledgements for packets we&n;&t;&t; * haven&squot;t sent yet.&n;&t;&t; */
r_if
c_cond
(paren
id|xmit_count
op_eq
l_int|0
)paren
id|BUG
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/*&n;&t;&t; * If the packet has only been sent once, we can use it&n;&t;&t; * to calculate the RTT and also open the window a little&n;&t;&t; * further.&n;&t;&t; */
r_if
c_cond
(paren
id|xmit_count
op_eq
l_int|1
)paren
(brace
r_if
c_cond
(paren
id|equal
c_func
(paren
id|segnum
comma
id|acknum
)paren
)paren
id|dn_nsp_rtt
c_func
(paren
id|sk
comma
(paren
r_int
)paren
(paren
id|pkttime
op_minus
id|reftime
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|scp-&gt;snd_window
OL
id|scp-&gt;max_window
)paren
id|scp-&gt;snd_window
op_increment
suffix:semicolon
)brace
multiline_comment|/*&n;&t;&t; * Packet has been sent more than once. If this is the last&n;&t;&t; * packet to be acknowledged then we want to send the next&n;&t;&t; * packet in the send queue again (assumes the remote host does&n;&t;&t; * go-back-N error control).&n;&t;&t; */
r_if
c_cond
(paren
id|xmit_count
OG
l_int|1
)paren
id|try_retrans
op_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|try_retrans
)paren
id|dn_nsp_output
c_func
(paren
id|sk
)paren
suffix:semicolon
r_return
id|wakeup
suffix:semicolon
)brace
DECL|function|dn_nsp_send_data_ack
r_void
id|dn_nsp_send_data_ack
c_func
(paren
r_struct
id|sock
op_star
id|sk
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
(paren
id|skb
op_assign
id|dn_alloc_skb
c_func
(paren
id|sk
comma
l_int|9
comma
id|GFP_ATOMIC
)paren
)paren
op_eq
l_int|NULL
)paren
r_return
suffix:semicolon
id|skb_reserve
c_func
(paren
id|skb
comma
l_int|9
)paren
suffix:semicolon
id|dn_mk_ack_header
c_func
(paren
id|sk
comma
id|skb
comma
l_int|0x04
comma
l_int|9
comma
l_int|0
)paren
suffix:semicolon
id|dn_nsp_send
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
DECL|function|dn_nsp_send_oth_ack
r_void
id|dn_nsp_send_oth_ack
c_func
(paren
r_struct
id|sock
op_star
id|sk
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
(paren
id|skb
op_assign
id|dn_alloc_skb
c_func
(paren
id|sk
comma
l_int|9
comma
id|GFP_ATOMIC
)paren
)paren
op_eq
l_int|NULL
)paren
r_return
suffix:semicolon
id|skb_reserve
c_func
(paren
id|skb
comma
l_int|9
)paren
suffix:semicolon
id|dn_mk_ack_header
c_func
(paren
id|sk
comma
id|skb
comma
l_int|0x14
comma
l_int|9
comma
l_int|1
)paren
suffix:semicolon
id|dn_nsp_send
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
DECL|function|dn_send_conn_ack
r_void
id|dn_send_conn_ack
(paren
r_struct
id|sock
op_star
id|sk
)paren
(brace
r_struct
id|dn_scp
op_star
id|scp
op_assign
id|DN_SK
c_func
(paren
id|sk
)paren
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|nsp_conn_ack_msg
op_star
id|msg
suffix:semicolon
r_if
c_cond
(paren
(paren
id|skb
op_assign
id|dn_alloc_skb
c_func
(paren
id|sk
comma
l_int|3
comma
id|sk-&gt;allocation
)paren
)paren
op_eq
l_int|NULL
)paren
r_return
suffix:semicolon
id|msg
op_assign
(paren
r_struct
id|nsp_conn_ack_msg
op_star
)paren
id|skb_put
c_func
(paren
id|skb
comma
l_int|3
)paren
suffix:semicolon
id|msg-&gt;msgflg
op_assign
l_int|0x24
suffix:semicolon
id|msg-&gt;dstaddr
op_assign
id|scp-&gt;addrrem
suffix:semicolon
id|dn_nsp_send
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
DECL|function|dn_nsp_delayed_ack
r_void
id|dn_nsp_delayed_ack
c_func
(paren
r_struct
id|sock
op_star
id|sk
)paren
(brace
r_struct
id|dn_scp
op_star
id|scp
op_assign
id|DN_SK
c_func
(paren
id|sk
)paren
suffix:semicolon
r_if
c_cond
(paren
id|scp-&gt;ackxmt_oth
op_ne
id|scp-&gt;numoth_rcv
)paren
id|dn_nsp_send_oth_ack
c_func
(paren
id|sk
)paren
suffix:semicolon
r_if
c_cond
(paren
id|scp-&gt;ackxmt_dat
op_ne
id|scp-&gt;numdat_rcv
)paren
id|dn_nsp_send_data_ack
c_func
(paren
id|sk
)paren
suffix:semicolon
)brace
DECL|function|dn_nsp_retrans_conn_conf
r_static
r_int
id|dn_nsp_retrans_conn_conf
c_func
(paren
r_struct
id|sock
op_star
id|sk
)paren
(brace
r_struct
id|dn_scp
op_star
id|scp
op_assign
id|DN_SK
c_func
(paren
id|sk
)paren
suffix:semicolon
r_if
c_cond
(paren
id|scp-&gt;state
op_eq
id|DN_CC
)paren
id|dn_send_conn_conf
c_func
(paren
id|sk
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dn_send_conn_conf
r_void
id|dn_send_conn_conf
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_int
id|gfp
)paren
(brace
r_struct
id|dn_scp
op_star
id|scp
op_assign
id|DN_SK
c_func
(paren
id|sk
)paren
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|nsp_conn_init_msg
op_star
id|msg
suffix:semicolon
r_int
r_char
id|len
op_assign
id|scp-&gt;conndata_out.opt_optl
suffix:semicolon
r_if
c_cond
(paren
(paren
id|skb
op_assign
id|dn_alloc_skb
c_func
(paren
id|sk
comma
l_int|50
op_plus
id|scp-&gt;conndata_out.opt_optl
comma
id|gfp
)paren
)paren
op_eq
l_int|NULL
)paren
r_return
suffix:semicolon
id|msg
op_assign
(paren
r_struct
id|nsp_conn_init_msg
op_star
)paren
id|skb_put
c_func
(paren
id|skb
comma
r_sizeof
(paren
op_star
id|msg
)paren
)paren
suffix:semicolon
id|msg-&gt;msgflg
op_assign
l_int|0x28
suffix:semicolon
id|msg-&gt;dstaddr
op_assign
id|scp-&gt;addrrem
suffix:semicolon
id|msg-&gt;srcaddr
op_assign
id|scp-&gt;addrloc
suffix:semicolon
id|msg-&gt;services
op_assign
id|scp-&gt;services_loc
suffix:semicolon
id|msg-&gt;info
op_assign
id|scp-&gt;info_loc
suffix:semicolon
id|msg-&gt;segsize
op_assign
id|dn_htons
c_func
(paren
id|scp-&gt;segsize_loc
)paren
suffix:semicolon
op_star
id|skb_put
c_func
(paren
id|skb
comma
l_int|1
)paren
op_assign
id|len
suffix:semicolon
r_if
c_cond
(paren
id|len
OG
l_int|0
)paren
id|memcpy
c_func
(paren
id|skb_put
c_func
(paren
id|skb
comma
id|len
)paren
comma
id|scp-&gt;conndata_out.opt_data
comma
id|len
)paren
suffix:semicolon
id|dn_nsp_send
c_func
(paren
id|skb
)paren
suffix:semicolon
id|scp-&gt;persist
op_assign
id|dn_nsp_persist
c_func
(paren
id|sk
)paren
suffix:semicolon
id|scp-&gt;persist_fxn
op_assign
id|dn_nsp_retrans_conn_conf
suffix:semicolon
)brace
DECL|function|dn_nsp_do_disc
r_static
id|__inline__
r_void
id|dn_nsp_do_disc
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_int
r_char
id|msgflg
comma
r_int
r_int
id|reason
comma
r_int
id|gfp
comma
r_struct
id|dst_entry
op_star
id|dst
comma
r_int
id|ddl
comma
r_int
r_char
op_star
id|dd
comma
id|__u16
id|rem
comma
id|__u16
id|loc
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
op_assign
l_int|NULL
suffix:semicolon
r_int
id|size
op_assign
l_int|7
op_plus
id|ddl
op_plus
(paren
(paren
id|msgflg
op_eq
id|NSP_DISCINIT
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
)paren
suffix:semicolon
r_int
r_char
op_star
id|msg
suffix:semicolon
r_if
c_cond
(paren
(paren
id|dst
op_eq
l_int|NULL
)paren
op_logical_or
(paren
id|rem
op_eq
l_int|0
)paren
)paren
(brace
r_if
c_cond
(paren
id|net_ratelimit
c_func
(paren
)paren
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;DECnet: dn_nsp_do_disc: BUG! Please report this to SteveW@ACM.org rem=%u dst=%p&bslash;n&quot;
comma
(paren
r_int
)paren
id|rem
comma
id|dst
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|skb
op_assign
id|dn_alloc_skb
c_func
(paren
id|sk
comma
id|size
comma
id|gfp
)paren
)paren
op_eq
l_int|NULL
)paren
r_return
suffix:semicolon
id|msg
op_assign
id|skb_put
c_func
(paren
id|skb
comma
id|size
)paren
suffix:semicolon
op_star
id|msg
op_increment
op_assign
id|msgflg
suffix:semicolon
op_star
(paren
id|__u16
op_star
)paren
id|msg
op_assign
id|rem
suffix:semicolon
id|msg
op_add_assign
l_int|2
suffix:semicolon
op_star
(paren
id|__u16
op_star
)paren
id|msg
op_assign
id|loc
suffix:semicolon
id|msg
op_add_assign
l_int|2
suffix:semicolon
op_star
(paren
id|__u16
op_star
)paren
id|msg
op_assign
id|dn_htons
c_func
(paren
id|reason
)paren
suffix:semicolon
id|msg
op_add_assign
l_int|2
suffix:semicolon
r_if
c_cond
(paren
id|msgflg
op_eq
id|NSP_DISCINIT
)paren
op_star
id|msg
op_increment
op_assign
id|ddl
suffix:semicolon
r_if
c_cond
(paren
id|ddl
)paren
(brace
id|memcpy
c_func
(paren
id|msg
comma
id|dd
comma
id|ddl
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * This doesn&squot;t go via the dn_nsp_send() fucntion since we need&n;&t; * to be able to send disc packets out which have no socket&n;&t; * associations.&n;&t; */
id|skb-&gt;dst
op_assign
id|dst_clone
c_func
(paren
id|dst
)paren
suffix:semicolon
id|skb-&gt;dst
op_member_access_from_pointer
id|output
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
DECL|function|dn_nsp_send_disc
r_void
id|dn_nsp_send_disc
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_int
r_char
id|msgflg
comma
r_int
r_int
id|reason
comma
r_int
id|gfp
)paren
(brace
r_struct
id|dn_scp
op_star
id|scp
op_assign
id|DN_SK
c_func
(paren
id|sk
)paren
suffix:semicolon
r_int
id|ddl
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|msgflg
op_eq
id|NSP_DISCINIT
)paren
id|ddl
op_assign
id|scp-&gt;discdata_out.opt_optl
suffix:semicolon
r_if
c_cond
(paren
id|reason
op_eq
l_int|0
)paren
id|reason
op_assign
id|scp-&gt;discdata_out.opt_status
suffix:semicolon
id|dn_nsp_do_disc
c_func
(paren
id|sk
comma
id|msgflg
comma
id|reason
comma
id|gfp
comma
id|sk-&gt;dst_cache
comma
id|ddl
comma
id|scp-&gt;discdata_out.opt_data
comma
id|scp-&gt;addrrem
comma
id|scp-&gt;addrloc
)paren
suffix:semicolon
)brace
DECL|function|dn_nsp_return_disc
r_void
id|dn_nsp_return_disc
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_int
r_char
id|msgflg
comma
r_int
r_int
id|reason
)paren
(brace
r_struct
id|dn_skb_cb
op_star
id|cb
op_assign
id|DN_SKB_CB
c_func
(paren
id|skb
)paren
suffix:semicolon
r_int
id|ddl
op_assign
l_int|0
suffix:semicolon
r_int
id|gfp
op_assign
id|GFP_ATOMIC
suffix:semicolon
id|dn_nsp_do_disc
c_func
(paren
l_int|NULL
comma
id|msgflg
comma
id|reason
comma
id|gfp
comma
id|skb-&gt;dst
comma
id|ddl
comma
l_int|NULL
comma
id|cb-&gt;src_port
comma
id|cb-&gt;dst_port
)paren
suffix:semicolon
)brace
DECL|function|dn_nsp_send_link
r_void
id|dn_nsp_send_link
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_int
r_char
id|lsflags
comma
r_char
id|fcval
)paren
(brace
r_struct
id|dn_scp
op_star
id|scp
op_assign
id|DN_SK
c_func
(paren
id|sk
)paren
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_int
r_int
op_star
id|segnum
suffix:semicolon
r_int
r_char
op_star
id|ptr
suffix:semicolon
r_int
id|gfp
op_assign
id|GFP_ATOMIC
suffix:semicolon
r_if
c_cond
(paren
(paren
id|skb
op_assign
id|dn_alloc_skb
c_func
(paren
id|sk
comma
l_int|13
comma
id|gfp
)paren
)paren
op_eq
l_int|NULL
)paren
r_return
suffix:semicolon
id|skb_reserve
c_func
(paren
id|skb
comma
l_int|13
)paren
suffix:semicolon
id|segnum
op_assign
id|dn_mk_ack_header
c_func
(paren
id|sk
comma
id|skb
comma
l_int|0x10
comma
l_int|13
comma
l_int|1
)paren
suffix:semicolon
op_star
id|segnum
op_assign
id|dn_htons
c_func
(paren
id|scp-&gt;numoth
)paren
suffix:semicolon
id|DN_SKB_CB
c_func
(paren
id|skb
)paren
op_member_access_from_pointer
id|segnum
op_assign
id|scp-&gt;numoth
suffix:semicolon
id|seq_add
c_func
(paren
op_amp
id|scp-&gt;numoth
comma
l_int|1
)paren
suffix:semicolon
id|ptr
op_assign
(paren
r_int
r_char
op_star
)paren
(paren
id|segnum
op_plus
l_int|1
)paren
suffix:semicolon
op_star
id|ptr
op_increment
op_assign
id|lsflags
suffix:semicolon
op_star
id|ptr
op_assign
id|fcval
suffix:semicolon
id|dn_nsp_queue_xmit
c_func
(paren
id|sk
comma
id|skb
comma
id|gfp
comma
l_int|1
)paren
suffix:semicolon
id|scp-&gt;persist
op_assign
id|dn_nsp_persist
c_func
(paren
id|sk
)paren
suffix:semicolon
id|scp-&gt;persist_fxn
op_assign
id|dn_nsp_xmit_timeout
suffix:semicolon
)brace
DECL|function|dn_nsp_retrans_conninit
r_static
r_int
id|dn_nsp_retrans_conninit
c_func
(paren
r_struct
id|sock
op_star
id|sk
)paren
(brace
r_struct
id|dn_scp
op_star
id|scp
op_assign
id|DN_SK
c_func
(paren
id|sk
)paren
suffix:semicolon
r_if
c_cond
(paren
id|scp-&gt;state
op_eq
id|DN_CI
)paren
id|dn_nsp_send_conninit
c_func
(paren
id|sk
comma
id|NSP_RCI
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dn_nsp_send_conninit
r_void
id|dn_nsp_send_conninit
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_int
r_char
id|msgflg
)paren
(brace
r_struct
id|dn_scp
op_star
id|scp
op_assign
id|DN_SK
c_func
(paren
id|sk
)paren
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|nsp_conn_init_msg
op_star
id|msg
suffix:semicolon
r_int
r_char
id|aux
suffix:semicolon
r_int
r_char
id|menuver
suffix:semicolon
r_struct
id|dn_skb_cb
op_star
id|cb
suffix:semicolon
r_int
r_char
id|type
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
(paren
id|skb
op_assign
id|dn_alloc_skb
c_func
(paren
id|sk
comma
l_int|200
comma
(paren
id|msgflg
op_eq
id|NSP_CI
)paren
ques
c_cond
id|sk-&gt;allocation
suffix:colon
id|GFP_ATOMIC
)paren
)paren
op_eq
l_int|NULL
)paren
r_return
suffix:semicolon
id|cb
op_assign
id|DN_SKB_CB
c_func
(paren
id|skb
)paren
suffix:semicolon
id|msg
op_assign
(paren
r_struct
id|nsp_conn_init_msg
op_star
)paren
id|skb_put
c_func
(paren
id|skb
comma
r_sizeof
(paren
op_star
id|msg
)paren
)paren
suffix:semicolon
id|msg-&gt;msgflg
op_assign
id|msgflg
suffix:semicolon
id|msg-&gt;dstaddr
op_assign
l_int|0x0000
suffix:semicolon
multiline_comment|/* Remote Node will assign it*/
id|msg-&gt;srcaddr
op_assign
id|scp-&gt;addrloc
suffix:semicolon
id|msg-&gt;services
op_assign
id|scp-&gt;services_loc
suffix:semicolon
multiline_comment|/* Requested flow control    */
id|msg-&gt;info
op_assign
id|scp-&gt;info_loc
suffix:semicolon
multiline_comment|/* Version Number            */
id|msg-&gt;segsize
op_assign
id|dn_htons
c_func
(paren
id|scp-&gt;segsize_loc
)paren
suffix:semicolon
multiline_comment|/* Max segment size  */
r_if
c_cond
(paren
id|scp-&gt;peer.sdn_objnum
)paren
id|type
op_assign
l_int|0
suffix:semicolon
id|skb_put
c_func
(paren
id|skb
comma
id|dn_sockaddr2username
c_func
(paren
op_amp
id|scp-&gt;peer
comma
id|skb-&gt;tail
comma
id|type
)paren
)paren
suffix:semicolon
id|skb_put
c_func
(paren
id|skb
comma
id|dn_sockaddr2username
c_func
(paren
op_amp
id|scp-&gt;addr
comma
id|skb-&gt;tail
comma
l_int|2
)paren
)paren
suffix:semicolon
id|menuver
op_assign
id|DN_MENUVER_ACC
op_or
id|DN_MENUVER_USR
suffix:semicolon
r_if
c_cond
(paren
id|scp-&gt;peer.sdn_flags
op_amp
id|SDF_PROXY
)paren
id|menuver
op_or_assign
id|DN_MENUVER_PRX
suffix:semicolon
r_if
c_cond
(paren
id|scp-&gt;peer.sdn_flags
op_amp
id|SDF_UICPROXY
)paren
id|menuver
op_or_assign
id|DN_MENUVER_UIC
suffix:semicolon
op_star
id|skb_put
c_func
(paren
id|skb
comma
l_int|1
)paren
op_assign
id|menuver
suffix:semicolon
multiline_comment|/* Menu Version&t;&t;*/
id|aux
op_assign
id|scp-&gt;accessdata.acc_userl
suffix:semicolon
op_star
id|skb_put
c_func
(paren
id|skb
comma
l_int|1
)paren
op_assign
id|aux
suffix:semicolon
r_if
c_cond
(paren
id|aux
OG
l_int|0
)paren
id|memcpy
c_func
(paren
id|skb_put
c_func
(paren
id|skb
comma
id|aux
)paren
comma
id|scp-&gt;accessdata.acc_user
comma
id|aux
)paren
suffix:semicolon
id|aux
op_assign
id|scp-&gt;accessdata.acc_passl
suffix:semicolon
op_star
id|skb_put
c_func
(paren
id|skb
comma
l_int|1
)paren
op_assign
id|aux
suffix:semicolon
r_if
c_cond
(paren
id|aux
OG
l_int|0
)paren
id|memcpy
c_func
(paren
id|skb_put
c_func
(paren
id|skb
comma
id|aux
)paren
comma
id|scp-&gt;accessdata.acc_pass
comma
id|aux
)paren
suffix:semicolon
id|aux
op_assign
id|scp-&gt;accessdata.acc_accl
suffix:semicolon
op_star
id|skb_put
c_func
(paren
id|skb
comma
l_int|1
)paren
op_assign
id|aux
suffix:semicolon
r_if
c_cond
(paren
id|aux
OG
l_int|0
)paren
id|memcpy
c_func
(paren
id|skb_put
c_func
(paren
id|skb
comma
id|aux
)paren
comma
id|scp-&gt;accessdata.acc_acc
comma
id|aux
)paren
suffix:semicolon
id|aux
op_assign
id|scp-&gt;conndata_out.opt_optl
suffix:semicolon
op_star
id|skb_put
c_func
(paren
id|skb
comma
l_int|1
)paren
op_assign
id|aux
suffix:semicolon
r_if
c_cond
(paren
id|aux
OG
l_int|0
)paren
id|memcpy
c_func
(paren
id|skb_put
c_func
(paren
id|skb
comma
id|aux
)paren
comma
id|scp-&gt;conndata_out.opt_data
comma
id|aux
)paren
suffix:semicolon
id|scp-&gt;persist
op_assign
id|dn_nsp_persist
c_func
(paren
id|sk
)paren
suffix:semicolon
id|scp-&gt;persist_fxn
op_assign
id|dn_nsp_retrans_conninit
suffix:semicolon
id|cb-&gt;rt_flags
op_assign
id|DN_RT_F_RQR
suffix:semicolon
id|dn_nsp_send
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
eof
