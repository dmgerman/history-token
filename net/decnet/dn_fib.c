multiline_comment|/*&n; * DECnet       An implementation of the DECnet protocol suite for the LINUX&n; *              operating system.  DECnet is implemented using the  BSD Socket&n; *              interface as the means of communication with the user level.&n; *&n; *              DECnet Routing Forwarding Information Base (Glue/Info List)&n; *&n; * Author:      Steve Whitehouse &lt;SteveW@ACM.org&gt;&n; *&n; *&n; * Changes:&n; *              Alexey Kuznetsov : SMP locking changes&n; *              Steve Whitehouse : Rewrote it... Well to be more correct, I&n; *                                 copied most of it from the ipv4 fib code.&n; *              Steve Whitehouse : Updated it in style and fixed a few bugs&n; *                                 which were fixed in the ipv4 code since&n; *                                 this code was copied from it.&n; *&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/net.h&gt;
macro_line|#include &lt;linux/socket.h&gt;
macro_line|#include &lt;linux/sockios.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/skbuff.h&gt;
macro_line|#include &lt;linux/netlink.h&gt;
macro_line|#include &lt;linux/rtnetlink.h&gt;
macro_line|#include &lt;linux/proc_fs.h&gt;
macro_line|#include &lt;linux/netdevice.h&gt;
macro_line|#include &lt;linux/timer.h&gt;
macro_line|#include &lt;linux/spinlock.h&gt;
macro_line|#include &lt;asm/atomic.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;net/neighbour.h&gt;
macro_line|#include &lt;net/dst.h&gt;
macro_line|#include &lt;net/flow.h&gt;
macro_line|#include &lt;net/dn.h&gt;
macro_line|#include &lt;net/dn_route.h&gt;
macro_line|#include &lt;net/dn_fib.h&gt;
macro_line|#include &lt;net/dn_neigh.h&gt;
macro_line|#include &lt;net/dn_dev.h&gt;
DECL|macro|RT_MIN_TABLE
mdefine_line|#define RT_MIN_TABLE 1
DECL|macro|for_fib_info
mdefine_line|#define for_fib_info() { struct dn_fib_info *fi;&bslash;&n;&t;for(fi = dn_fib_info_list; fi; fi = fi-&gt;fib_next)
DECL|macro|endfor_fib_info
mdefine_line|#define endfor_fib_info() }
DECL|macro|for_nexthops
mdefine_line|#define for_nexthops(fi) { int nhsel; const struct dn_fib_nh *nh;&bslash;&n;&t;for(nhsel = 0, nh = (fi)-&gt;fib_nh; nhsel &lt; (fi)-&gt;fib_nhs; nh++, nhsel++)
DECL|macro|change_nexthops
mdefine_line|#define change_nexthops(fi) { int nhsel; struct dn_fib_nh *nh;&bslash;&n;&t;for(nhsel = 0, nh = (struct dn_fib_nh *)((fi)-&gt;fib_nh); nhsel &lt; (fi)-&gt;fib_nhs; nh++, nhsel++)
DECL|macro|endfor_nexthops
mdefine_line|#define endfor_nexthops(fi) }
r_extern
r_int
id|dn_cache_dump
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|netlink_callback
op_star
id|cb
)paren
suffix:semicolon
r_static
id|DEFINE_SPINLOCK
c_func
(paren
id|dn_fib_multipath_lock
)paren
suffix:semicolon
DECL|variable|dn_fib_info_list
r_static
r_struct
id|dn_fib_info
op_star
id|dn_fib_info_list
suffix:semicolon
r_static
id|DEFINE_RWLOCK
c_func
(paren
id|dn_fib_info_lock
)paren
suffix:semicolon
r_static
r_struct
(brace
DECL|member|error
r_int
id|error
suffix:semicolon
DECL|member|scope
id|u8
id|scope
suffix:semicolon
DECL|variable|dn_fib_props
)brace
id|dn_fib_props
(braket
id|RTA_MAX
op_plus
l_int|1
)braket
op_assign
(brace
(braket
id|RTN_UNSPEC
)braket
op_assign
(brace
dot
id|error
op_assign
l_int|0
comma
dot
id|scope
op_assign
id|RT_SCOPE_NOWHERE
)brace
comma
(braket
id|RTN_UNICAST
)braket
op_assign
(brace
dot
id|error
op_assign
l_int|0
comma
dot
id|scope
op_assign
id|RT_SCOPE_UNIVERSE
)brace
comma
(braket
id|RTN_LOCAL
)braket
op_assign
(brace
dot
id|error
op_assign
l_int|0
comma
dot
id|scope
op_assign
id|RT_SCOPE_HOST
)brace
comma
(braket
id|RTN_BROADCAST
)braket
op_assign
(brace
dot
id|error
op_assign
op_minus
id|EINVAL
comma
dot
id|scope
op_assign
id|RT_SCOPE_NOWHERE
)brace
comma
(braket
id|RTN_ANYCAST
)braket
op_assign
(brace
dot
id|error
op_assign
op_minus
id|EINVAL
comma
dot
id|scope
op_assign
id|RT_SCOPE_NOWHERE
)brace
comma
(braket
id|RTN_MULTICAST
)braket
op_assign
(brace
dot
id|error
op_assign
op_minus
id|EINVAL
comma
dot
id|scope
op_assign
id|RT_SCOPE_NOWHERE
)brace
comma
(braket
id|RTN_BLACKHOLE
)braket
op_assign
(brace
dot
id|error
op_assign
op_minus
id|EINVAL
comma
dot
id|scope
op_assign
id|RT_SCOPE_UNIVERSE
)brace
comma
(braket
id|RTN_UNREACHABLE
)braket
op_assign
(brace
dot
id|error
op_assign
op_minus
id|EHOSTUNREACH
comma
dot
id|scope
op_assign
id|RT_SCOPE_UNIVERSE
)brace
comma
(braket
id|RTN_PROHIBIT
)braket
op_assign
(brace
dot
id|error
op_assign
op_minus
id|EACCES
comma
dot
id|scope
op_assign
id|RT_SCOPE_UNIVERSE
)brace
comma
(braket
id|RTN_THROW
)braket
op_assign
(brace
dot
id|error
op_assign
op_minus
id|EAGAIN
comma
dot
id|scope
op_assign
id|RT_SCOPE_UNIVERSE
)brace
comma
(braket
id|RTN_NAT
)braket
op_assign
(brace
dot
id|error
op_assign
l_int|0
comma
dot
id|scope
op_assign
id|RT_SCOPE_NOWHERE
)brace
comma
(braket
id|RTN_XRESOLVE
)braket
op_assign
(brace
dot
id|error
op_assign
op_minus
id|EINVAL
comma
dot
id|scope
op_assign
id|RT_SCOPE_NOWHERE
)brace
comma
)brace
suffix:semicolon
DECL|function|dn_fib_free_info
r_void
id|dn_fib_free_info
c_func
(paren
r_struct
id|dn_fib_info
op_star
id|fi
)paren
(brace
r_if
c_cond
(paren
id|fi-&gt;fib_dead
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;DECnet: BUG! Attempt to free alive dn_fib_info&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|change_nexthops
c_func
(paren
id|fi
)paren
(brace
r_if
c_cond
(paren
id|nh-&gt;nh_dev
)paren
id|dev_put
c_func
(paren
id|nh-&gt;nh_dev
)paren
suffix:semicolon
id|nh-&gt;nh_dev
op_assign
l_int|NULL
suffix:semicolon
)brace
id|endfor_nexthops
c_func
(paren
id|fi
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|fi
)paren
suffix:semicolon
)brace
DECL|function|dn_fib_release_info
r_void
id|dn_fib_release_info
c_func
(paren
r_struct
id|dn_fib_info
op_star
id|fi
)paren
(brace
id|write_lock
c_func
(paren
op_amp
id|dn_fib_info_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fi
op_logical_and
op_decrement
id|fi-&gt;fib_treeref
op_eq
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|fi-&gt;fib_next
)paren
id|fi-&gt;fib_next-&gt;fib_prev
op_assign
id|fi-&gt;fib_prev
suffix:semicolon
r_if
c_cond
(paren
id|fi-&gt;fib_prev
)paren
id|fi-&gt;fib_prev-&gt;fib_next
op_assign
id|fi-&gt;fib_next
suffix:semicolon
r_if
c_cond
(paren
id|fi
op_eq
id|dn_fib_info_list
)paren
id|dn_fib_info_list
op_assign
id|fi-&gt;fib_next
suffix:semicolon
id|fi-&gt;fib_dead
op_assign
l_int|1
suffix:semicolon
id|dn_fib_info_put
c_func
(paren
id|fi
)paren
suffix:semicolon
)brace
id|write_unlock
c_func
(paren
op_amp
id|dn_fib_info_lock
)paren
suffix:semicolon
)brace
DECL|function|dn_fib_nh_comp
r_static
r_inline
r_int
id|dn_fib_nh_comp
c_func
(paren
r_const
r_struct
id|dn_fib_info
op_star
id|fi
comma
r_const
r_struct
id|dn_fib_info
op_star
id|ofi
)paren
(brace
r_const
r_struct
id|dn_fib_nh
op_star
id|onh
op_assign
id|ofi-&gt;fib_nh
suffix:semicolon
id|for_nexthops
c_func
(paren
id|fi
)paren
(brace
r_if
c_cond
(paren
id|nh-&gt;nh_oif
op_ne
id|onh-&gt;nh_oif
op_logical_or
id|nh-&gt;nh_gw
op_ne
id|onh-&gt;nh_gw
op_logical_or
id|nh-&gt;nh_scope
op_ne
id|onh-&gt;nh_scope
op_logical_or
id|nh-&gt;nh_weight
op_ne
id|onh-&gt;nh_weight
op_logical_or
(paren
(paren
id|nh-&gt;nh_flags
op_xor
id|onh-&gt;nh_flags
)paren
op_amp
op_complement
id|RTNH_F_DEAD
)paren
)paren
r_return
op_minus
l_int|1
suffix:semicolon
id|onh
op_increment
suffix:semicolon
)brace
id|endfor_nexthops
c_func
(paren
id|fi
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dn_fib_find_info
r_static
r_inline
r_struct
id|dn_fib_info
op_star
id|dn_fib_find_info
c_func
(paren
r_const
r_struct
id|dn_fib_info
op_star
id|nfi
)paren
(brace
id|for_fib_info
c_func
(paren
)paren
(brace
r_if
c_cond
(paren
id|fi-&gt;fib_nhs
op_ne
id|nfi-&gt;fib_nhs
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|nfi-&gt;fib_protocol
op_eq
id|fi-&gt;fib_protocol
op_logical_and
id|nfi-&gt;fib_prefsrc
op_eq
id|fi-&gt;fib_prefsrc
op_logical_and
id|nfi-&gt;fib_priority
op_eq
id|fi-&gt;fib_priority
op_logical_and
id|memcmp
c_func
(paren
id|nfi-&gt;fib_metrics
comma
id|fi-&gt;fib_metrics
comma
r_sizeof
(paren
id|fi-&gt;fib_metrics
)paren
)paren
op_eq
l_int|0
op_logical_and
(paren
(paren
id|nfi-&gt;fib_flags
op_xor
id|fi-&gt;fib_flags
)paren
op_amp
op_complement
id|RTNH_F_DEAD
)paren
op_eq
l_int|0
op_logical_and
(paren
id|nfi-&gt;fib_nhs
op_eq
l_int|0
op_logical_or
id|dn_fib_nh_comp
c_func
(paren
id|fi
comma
id|nfi
)paren
op_eq
l_int|0
)paren
)paren
r_return
id|fi
suffix:semicolon
)brace
id|endfor_fib_info
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
DECL|function|dn_fib_get_attr16
id|u16
id|dn_fib_get_attr16
c_func
(paren
r_struct
id|rtattr
op_star
id|attr
comma
r_int
id|attrlen
comma
r_int
id|type
)paren
(brace
r_while
c_loop
(paren
id|RTA_OK
c_func
(paren
id|attr
comma
id|attrlen
)paren
)paren
(brace
r_if
c_cond
(paren
id|attr-&gt;rta_type
op_eq
id|type
)paren
r_return
op_star
(paren
id|u16
op_star
)paren
id|RTA_DATA
c_func
(paren
id|attr
)paren
suffix:semicolon
id|attr
op_assign
id|RTA_NEXT
c_func
(paren
id|attr
comma
id|attrlen
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dn_fib_count_nhs
r_static
r_int
id|dn_fib_count_nhs
c_func
(paren
r_struct
id|rtattr
op_star
id|rta
)paren
(brace
r_int
id|nhs
op_assign
l_int|0
suffix:semicolon
r_struct
id|rtnexthop
op_star
id|nhp
op_assign
id|RTA_DATA
c_func
(paren
id|rta
)paren
suffix:semicolon
r_int
id|nhlen
op_assign
id|RTA_PAYLOAD
c_func
(paren
id|rta
)paren
suffix:semicolon
r_while
c_loop
(paren
id|nhlen
op_ge
(paren
r_int
)paren
r_sizeof
(paren
r_struct
id|rtnexthop
)paren
)paren
(brace
r_if
c_cond
(paren
(paren
id|nhlen
op_sub_assign
id|nhp-&gt;rtnh_len
)paren
OL
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
id|nhs
op_increment
suffix:semicolon
id|nhp
op_assign
id|RTNH_NEXT
c_func
(paren
id|nhp
)paren
suffix:semicolon
)brace
r_return
id|nhs
suffix:semicolon
)brace
DECL|function|dn_fib_get_nhs
r_static
r_int
id|dn_fib_get_nhs
c_func
(paren
r_struct
id|dn_fib_info
op_star
id|fi
comma
r_const
r_struct
id|rtattr
op_star
id|rta
comma
r_const
r_struct
id|rtmsg
op_star
id|r
)paren
(brace
r_struct
id|rtnexthop
op_star
id|nhp
op_assign
id|RTA_DATA
c_func
(paren
id|rta
)paren
suffix:semicolon
r_int
id|nhlen
op_assign
id|RTA_PAYLOAD
c_func
(paren
id|rta
)paren
suffix:semicolon
id|change_nexthops
c_func
(paren
id|fi
)paren
(brace
r_int
id|attrlen
op_assign
id|nhlen
op_minus
r_sizeof
(paren
r_struct
id|rtnexthop
)paren
suffix:semicolon
r_if
c_cond
(paren
id|attrlen
OL
l_int|0
op_logical_or
(paren
id|nhlen
op_sub_assign
id|nhp-&gt;rtnh_len
)paren
OL
l_int|0
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|nh-&gt;nh_flags
op_assign
(paren
id|r-&gt;rtm_flags
op_amp
op_complement
l_int|0xFF
)paren
op_or
id|nhp-&gt;rtnh_flags
suffix:semicolon
id|nh-&gt;nh_oif
op_assign
id|nhp-&gt;rtnh_ifindex
suffix:semicolon
id|nh-&gt;nh_weight
op_assign
id|nhp-&gt;rtnh_hops
op_plus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|attrlen
)paren
(brace
id|nh-&gt;nh_gw
op_assign
id|dn_fib_get_attr16
c_func
(paren
id|RTNH_DATA
c_func
(paren
id|nhp
)paren
comma
id|attrlen
comma
id|RTA_GATEWAY
)paren
suffix:semicolon
)brace
id|nhp
op_assign
id|RTNH_NEXT
c_func
(paren
id|nhp
)paren
suffix:semicolon
)brace
id|endfor_nexthops
c_func
(paren
id|fi
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dn_fib_check_nh
r_static
r_int
id|dn_fib_check_nh
c_func
(paren
r_const
r_struct
id|rtmsg
op_star
id|r
comma
r_struct
id|dn_fib_info
op_star
id|fi
comma
r_struct
id|dn_fib_nh
op_star
id|nh
)paren
(brace
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
id|nh-&gt;nh_gw
)paren
(brace
r_struct
id|flowi
id|fl
suffix:semicolon
r_struct
id|dn_fib_res
id|res
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|fl
comma
l_int|0
comma
r_sizeof
(paren
id|fl
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|nh-&gt;nh_flags
op_amp
id|RTNH_F_ONLINK
)paren
(brace
r_struct
id|net_device
op_star
id|dev
suffix:semicolon
r_if
c_cond
(paren
id|r-&gt;rtm_scope
op_ge
id|RT_SCOPE_LINK
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|dnet_addr_type
c_func
(paren
id|nh-&gt;nh_gw
)paren
op_ne
id|RTN_UNICAST
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
(paren
id|dev
op_assign
id|__dev_get_by_index
c_func
(paren
id|nh-&gt;nh_oif
)paren
)paren
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|dev-&gt;flags
op_amp
id|IFF_UP
)paren
)paren
r_return
op_minus
id|ENETDOWN
suffix:semicolon
id|nh-&gt;nh_dev
op_assign
id|dev
suffix:semicolon
id|dev_hold
c_func
(paren
id|dev
)paren
suffix:semicolon
id|nh-&gt;nh_scope
op_assign
id|RT_SCOPE_LINK
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|memset
c_func
(paren
op_amp
id|fl
comma
l_int|0
comma
r_sizeof
(paren
id|fl
)paren
)paren
suffix:semicolon
id|fl.fld_dst
op_assign
id|nh-&gt;nh_gw
suffix:semicolon
id|fl.oif
op_assign
id|nh-&gt;nh_oif
suffix:semicolon
id|fl.fld_scope
op_assign
id|r-&gt;rtm_scope
op_plus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|fl.fld_scope
OL
id|RT_SCOPE_LINK
)paren
id|fl.fld_scope
op_assign
id|RT_SCOPE_LINK
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|dn_fib_lookup
c_func
(paren
op_amp
id|fl
comma
op_amp
id|res
)paren
)paren
op_ne
l_int|0
)paren
r_return
id|err
suffix:semicolon
id|err
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|res.type
op_ne
id|RTN_UNICAST
op_logical_and
id|res.type
op_ne
id|RTN_LOCAL
)paren
r_goto
id|out
suffix:semicolon
id|nh-&gt;nh_scope
op_assign
id|res.scope
suffix:semicolon
id|nh-&gt;nh_oif
op_assign
id|DN_FIB_RES_OIF
c_func
(paren
id|res
)paren
suffix:semicolon
id|nh-&gt;nh_dev
op_assign
id|DN_FIB_RES_DEV
c_func
(paren
id|res
)paren
suffix:semicolon
r_if
c_cond
(paren
id|nh-&gt;nh_dev
op_eq
l_int|NULL
)paren
r_goto
id|out
suffix:semicolon
id|dev_hold
c_func
(paren
id|nh-&gt;nh_dev
)paren
suffix:semicolon
id|err
op_assign
op_minus
id|ENETDOWN
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|nh-&gt;nh_dev-&gt;flags
op_amp
id|IFF_UP
)paren
)paren
r_goto
id|out
suffix:semicolon
id|err
op_assign
l_int|0
suffix:semicolon
id|out
suffix:colon
id|dn_fib_res_put
c_func
(paren
op_amp
id|res
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
r_else
(brace
r_struct
id|net_device
op_star
id|dev
suffix:semicolon
r_if
c_cond
(paren
id|nh-&gt;nh_flags
op_amp
(paren
id|RTNH_F_PERVASIVE
op_or
id|RTNH_F_ONLINK
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|dev
op_assign
id|__dev_get_by_index
c_func
(paren
id|nh-&gt;nh_oif
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev
op_eq
l_int|NULL
op_logical_or
id|dev-&gt;dn_ptr
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|dev-&gt;flags
op_amp
id|IFF_UP
)paren
)paren
r_return
op_minus
id|ENETDOWN
suffix:semicolon
id|nh-&gt;nh_dev
op_assign
id|dev
suffix:semicolon
id|dev_hold
c_func
(paren
id|nh-&gt;nh_dev
)paren
suffix:semicolon
id|nh-&gt;nh_scope
op_assign
id|RT_SCOPE_HOST
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dn_fib_create_info
r_struct
id|dn_fib_info
op_star
id|dn_fib_create_info
c_func
(paren
r_const
r_struct
id|rtmsg
op_star
id|r
comma
r_struct
id|dn_kern_rta
op_star
id|rta
comma
r_const
r_struct
id|nlmsghdr
op_star
id|nlh
comma
r_int
op_star
id|errp
)paren
(brace
r_int
id|err
suffix:semicolon
r_struct
id|dn_fib_info
op_star
id|fi
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|dn_fib_info
op_star
id|ofi
suffix:semicolon
r_int
id|nhs
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|dn_fib_props
(braket
id|r-&gt;rtm_type
)braket
dot
id|scope
OG
id|r-&gt;rtm_scope
)paren
r_goto
id|err_inval
suffix:semicolon
r_if
c_cond
(paren
id|rta-&gt;rta_mp
)paren
(brace
id|nhs
op_assign
id|dn_fib_count_nhs
c_func
(paren
id|rta-&gt;rta_mp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|nhs
op_eq
l_int|0
)paren
r_goto
id|err_inval
suffix:semicolon
)brace
id|fi
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|fi
)paren
op_plus
id|nhs
op_star
r_sizeof
(paren
r_struct
id|dn_fib_nh
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
id|err
op_assign
op_minus
id|ENOBUFS
suffix:semicolon
r_if
c_cond
(paren
id|fi
op_eq
l_int|NULL
)paren
r_goto
id|failure
suffix:semicolon
id|memset
c_func
(paren
id|fi
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|fi
)paren
op_plus
id|nhs
op_star
r_sizeof
(paren
r_struct
id|dn_fib_nh
)paren
)paren
suffix:semicolon
id|fi-&gt;fib_protocol
op_assign
id|r-&gt;rtm_protocol
suffix:semicolon
id|fi-&gt;fib_nhs
op_assign
id|nhs
suffix:semicolon
id|fi-&gt;fib_flags
op_assign
id|r-&gt;rtm_flags
suffix:semicolon
r_if
c_cond
(paren
id|rta-&gt;rta_priority
)paren
id|fi-&gt;fib_priority
op_assign
op_star
id|rta-&gt;rta_priority
suffix:semicolon
r_if
c_cond
(paren
id|rta-&gt;rta_mx
)paren
(brace
r_int
id|attrlen
op_assign
id|RTA_PAYLOAD
c_func
(paren
id|rta-&gt;rta_mx
)paren
suffix:semicolon
r_struct
id|rtattr
op_star
id|attr
op_assign
id|RTA_DATA
c_func
(paren
id|rta-&gt;rta_mx
)paren
suffix:semicolon
r_while
c_loop
(paren
id|RTA_OK
c_func
(paren
id|attr
comma
id|attrlen
)paren
)paren
(brace
r_int
id|flavour
op_assign
id|attr-&gt;rta_type
suffix:semicolon
r_if
c_cond
(paren
id|flavour
)paren
(brace
r_if
c_cond
(paren
id|flavour
OG
id|RTAX_MAX
)paren
r_goto
id|err_inval
suffix:semicolon
id|fi-&gt;fib_metrics
(braket
id|flavour
op_minus
l_int|1
)braket
op_assign
op_star
(paren
r_int
op_star
)paren
id|RTA_DATA
c_func
(paren
id|attr
)paren
suffix:semicolon
)brace
id|attr
op_assign
id|RTA_NEXT
c_func
(paren
id|attr
comma
id|attrlen
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|rta-&gt;rta_prefsrc
)paren
id|memcpy
c_func
(paren
op_amp
id|fi-&gt;fib_prefsrc
comma
id|rta-&gt;rta_prefsrc
comma
l_int|2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rta-&gt;rta_mp
)paren
(brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|dn_fib_get_nhs
c_func
(paren
id|fi
comma
id|rta-&gt;rta_mp
comma
id|r
)paren
)paren
op_ne
l_int|0
)paren
r_goto
id|failure
suffix:semicolon
r_if
c_cond
(paren
id|rta-&gt;rta_oif
op_logical_and
id|fi-&gt;fib_nh-&gt;nh_oif
op_ne
op_star
id|rta-&gt;rta_oif
)paren
r_goto
id|err_inval
suffix:semicolon
r_if
c_cond
(paren
id|rta-&gt;rta_gw
op_logical_and
id|memcmp
c_func
(paren
op_amp
id|fi-&gt;fib_nh-&gt;nh_gw
comma
id|rta-&gt;rta_gw
comma
l_int|2
)paren
)paren
r_goto
id|err_inval
suffix:semicolon
)brace
r_else
(brace
r_struct
id|dn_fib_nh
op_star
id|nh
op_assign
id|fi-&gt;fib_nh
suffix:semicolon
r_if
c_cond
(paren
id|rta-&gt;rta_oif
)paren
id|nh-&gt;nh_oif
op_assign
op_star
id|rta-&gt;rta_oif
suffix:semicolon
r_if
c_cond
(paren
id|rta-&gt;rta_gw
)paren
id|memcpy
c_func
(paren
op_amp
id|nh-&gt;nh_gw
comma
id|rta-&gt;rta_gw
comma
l_int|2
)paren
suffix:semicolon
id|nh-&gt;nh_flags
op_assign
id|r-&gt;rtm_flags
suffix:semicolon
id|nh-&gt;nh_weight
op_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|r-&gt;rtm_type
op_eq
id|RTN_NAT
)paren
(brace
r_if
c_cond
(paren
id|rta-&gt;rta_gw
op_eq
l_int|NULL
op_logical_or
id|nhs
op_ne
l_int|1
op_logical_or
id|rta-&gt;rta_oif
)paren
r_goto
id|err_inval
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|fi-&gt;fib_nh-&gt;nh_gw
comma
id|rta-&gt;rta_gw
comma
l_int|2
)paren
suffix:semicolon
r_goto
id|link_it
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dn_fib_props
(braket
id|r-&gt;rtm_type
)braket
dot
id|error
)paren
(brace
r_if
c_cond
(paren
id|rta-&gt;rta_gw
op_logical_or
id|rta-&gt;rta_oif
op_logical_or
id|rta-&gt;rta_mp
)paren
r_goto
id|err_inval
suffix:semicolon
r_goto
id|link_it
suffix:semicolon
)brace
r_if
c_cond
(paren
id|r-&gt;rtm_scope
OG
id|RT_SCOPE_HOST
)paren
r_goto
id|err_inval
suffix:semicolon
r_if
c_cond
(paren
id|r-&gt;rtm_scope
op_eq
id|RT_SCOPE_HOST
)paren
(brace
r_struct
id|dn_fib_nh
op_star
id|nh
op_assign
id|fi-&gt;fib_nh
suffix:semicolon
multiline_comment|/* Local address is added */
r_if
c_cond
(paren
id|nhs
op_ne
l_int|1
op_logical_or
id|nh-&gt;nh_gw
)paren
r_goto
id|err_inval
suffix:semicolon
id|nh-&gt;nh_scope
op_assign
id|RT_SCOPE_NOWHERE
suffix:semicolon
id|nh-&gt;nh_dev
op_assign
id|dev_get_by_index
c_func
(paren
id|fi-&gt;fib_nh-&gt;nh_oif
)paren
suffix:semicolon
id|err
op_assign
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
id|nh-&gt;nh_dev
op_eq
l_int|NULL
)paren
r_goto
id|failure
suffix:semicolon
)brace
r_else
(brace
id|change_nexthops
c_func
(paren
id|fi
)paren
(brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|dn_fib_check_nh
c_func
(paren
id|r
comma
id|fi
comma
id|nh
)paren
)paren
op_ne
l_int|0
)paren
r_goto
id|failure
suffix:semicolon
)brace
id|endfor_nexthops
c_func
(paren
id|fi
)paren
)brace
r_if
c_cond
(paren
id|fi-&gt;fib_prefsrc
)paren
(brace
r_if
c_cond
(paren
id|r-&gt;rtm_type
op_ne
id|RTN_LOCAL
op_logical_or
id|rta-&gt;rta_dst
op_eq
l_int|NULL
op_logical_or
id|memcmp
c_func
(paren
op_amp
id|fi-&gt;fib_prefsrc
comma
id|rta-&gt;rta_dst
comma
l_int|2
)paren
)paren
r_if
c_cond
(paren
id|dnet_addr_type
c_func
(paren
id|fi-&gt;fib_prefsrc
)paren
op_ne
id|RTN_LOCAL
)paren
r_goto
id|err_inval
suffix:semicolon
)brace
id|link_it
suffix:colon
r_if
c_cond
(paren
(paren
id|ofi
op_assign
id|dn_fib_find_info
c_func
(paren
id|fi
)paren
)paren
op_ne
l_int|NULL
)paren
(brace
id|fi-&gt;fib_dead
op_assign
l_int|1
suffix:semicolon
id|dn_fib_free_info
c_func
(paren
id|fi
)paren
suffix:semicolon
id|ofi-&gt;fib_treeref
op_increment
suffix:semicolon
r_return
id|ofi
suffix:semicolon
)brace
id|fi-&gt;fib_treeref
op_increment
suffix:semicolon
id|atomic_inc
c_func
(paren
op_amp
id|fi-&gt;fib_clntref
)paren
suffix:semicolon
id|write_lock
c_func
(paren
op_amp
id|dn_fib_info_lock
)paren
suffix:semicolon
id|fi-&gt;fib_next
op_assign
id|dn_fib_info_list
suffix:semicolon
id|fi-&gt;fib_prev
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|dn_fib_info_list
)paren
id|dn_fib_info_list-&gt;fib_prev
op_assign
id|fi
suffix:semicolon
id|dn_fib_info_list
op_assign
id|fi
suffix:semicolon
id|write_unlock
c_func
(paren
op_amp
id|dn_fib_info_lock
)paren
suffix:semicolon
r_return
id|fi
suffix:semicolon
id|err_inval
suffix:colon
id|err
op_assign
op_minus
id|EINVAL
suffix:semicolon
id|failure
suffix:colon
op_star
id|errp
op_assign
id|err
suffix:semicolon
r_if
c_cond
(paren
id|fi
)paren
(brace
id|fi-&gt;fib_dead
op_assign
l_int|1
suffix:semicolon
id|dn_fib_free_info
c_func
(paren
id|fi
)paren
suffix:semicolon
)brace
r_return
l_int|NULL
suffix:semicolon
)brace
DECL|function|dn_fib_semantic_match
r_int
id|dn_fib_semantic_match
c_func
(paren
r_int
id|type
comma
r_struct
id|dn_fib_info
op_star
id|fi
comma
r_const
r_struct
id|flowi
op_star
id|fl
comma
r_struct
id|dn_fib_res
op_star
id|res
)paren
(brace
r_int
id|err
op_assign
id|dn_fib_props
(braket
id|type
)braket
dot
id|error
suffix:semicolon
r_if
c_cond
(paren
id|err
op_eq
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|fi-&gt;fib_flags
op_amp
id|RTNH_F_DEAD
)paren
r_return
l_int|1
suffix:semicolon
id|res-&gt;fi
op_assign
id|fi
suffix:semicolon
r_switch
c_cond
(paren
id|type
)paren
(brace
r_case
id|RTN_NAT
suffix:colon
id|DN_FIB_RES_RESET
c_func
(paren
op_star
id|res
)paren
suffix:semicolon
id|atomic_inc
c_func
(paren
op_amp
id|fi-&gt;fib_clntref
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|RTN_UNICAST
suffix:colon
r_case
id|RTN_LOCAL
suffix:colon
id|for_nexthops
c_func
(paren
id|fi
)paren
(brace
r_if
c_cond
(paren
id|nh-&gt;nh_flags
op_amp
id|RTNH_F_DEAD
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|fl-&gt;oif
op_logical_or
id|fl-&gt;oif
op_eq
id|nh-&gt;nh_oif
)paren
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|nhsel
OL
id|fi-&gt;fib_nhs
)paren
(brace
id|res-&gt;nh_sel
op_assign
id|nhsel
suffix:semicolon
id|atomic_inc
c_func
(paren
op_amp
id|fi-&gt;fib_clntref
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|endfor_nexthops
c_func
(paren
id|fi
)paren
suffix:semicolon
id|res-&gt;fi
op_assign
l_int|NULL
suffix:semicolon
r_return
l_int|1
suffix:semicolon
r_default
suffix:colon
(brace
)brace
r_if
c_cond
(paren
id|net_ratelimit
c_func
(paren
)paren
)paren
id|printk
c_func
(paren
l_string|&quot;DECnet: impossible routing event : dn_fib_semantic_match type=%d&bslash;n&quot;
comma
id|type
)paren
suffix:semicolon
id|res-&gt;fi
op_assign
l_int|NULL
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
)brace
r_return
id|err
suffix:semicolon
)brace
DECL|function|dn_fib_select_multipath
r_void
id|dn_fib_select_multipath
c_func
(paren
r_const
r_struct
id|flowi
op_star
id|fl
comma
r_struct
id|dn_fib_res
op_star
id|res
)paren
(brace
r_struct
id|dn_fib_info
op_star
id|fi
op_assign
id|res-&gt;fi
suffix:semicolon
r_int
id|w
suffix:semicolon
id|spin_lock_bh
c_func
(paren
op_amp
id|dn_fib_multipath_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fi-&gt;fib_power
op_le
l_int|0
)paren
(brace
r_int
id|power
op_assign
l_int|0
suffix:semicolon
id|change_nexthops
c_func
(paren
id|fi
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|nh-&gt;nh_flags
op_amp
id|RTNH_F_DEAD
)paren
)paren
(brace
id|power
op_add_assign
id|nh-&gt;nh_weight
suffix:semicolon
id|nh-&gt;nh_power
op_assign
id|nh-&gt;nh_weight
suffix:semicolon
)brace
)brace
id|endfor_nexthops
c_func
(paren
id|fi
)paren
suffix:semicolon
id|fi-&gt;fib_power
op_assign
id|power
suffix:semicolon
r_if
c_cond
(paren
id|power
OL
l_int|0
)paren
(brace
id|spin_unlock_bh
c_func
(paren
op_amp
id|dn_fib_multipath_lock
)paren
suffix:semicolon
id|res-&gt;nh_sel
op_assign
l_int|0
suffix:semicolon
r_return
suffix:semicolon
)brace
)brace
id|w
op_assign
id|jiffies
op_mod
id|fi-&gt;fib_power
suffix:semicolon
id|change_nexthops
c_func
(paren
id|fi
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|nh-&gt;nh_flags
op_amp
id|RTNH_F_DEAD
)paren
op_logical_and
id|nh-&gt;nh_power
)paren
(brace
r_if
c_cond
(paren
(paren
id|w
op_sub_assign
id|nh-&gt;nh_power
)paren
op_le
l_int|0
)paren
(brace
id|nh-&gt;nh_power
op_decrement
suffix:semicolon
id|fi-&gt;fib_power
op_decrement
suffix:semicolon
id|res-&gt;nh_sel
op_assign
id|nhsel
suffix:semicolon
id|spin_unlock_bh
c_func
(paren
op_amp
id|dn_fib_multipath_lock
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
)brace
)brace
id|endfor_nexthops
c_func
(paren
id|fi
)paren
suffix:semicolon
id|res-&gt;nh_sel
op_assign
l_int|0
suffix:semicolon
id|spin_unlock_bh
c_func
(paren
op_amp
id|dn_fib_multipath_lock
)paren
suffix:semicolon
)brace
DECL|function|dn_fib_check_attr
r_static
r_int
id|dn_fib_check_attr
c_func
(paren
r_struct
id|rtmsg
op_star
id|r
comma
r_struct
id|rtattr
op_star
op_star
id|rta
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|1
suffix:semicolon
id|i
op_le
id|RTA_MAX
suffix:semicolon
id|i
op_increment
)paren
(brace
r_struct
id|rtattr
op_star
id|attr
op_assign
id|rta
(braket
id|i
op_minus
l_int|1
)braket
suffix:semicolon
r_if
c_cond
(paren
id|attr
)paren
(brace
r_if
c_cond
(paren
id|RTA_PAYLOAD
c_func
(paren
id|attr
)paren
OL
l_int|4
op_logical_and
id|RTA_PAYLOAD
c_func
(paren
id|attr
)paren
op_ne
l_int|2
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|i
op_ne
id|RTA_MULTIPATH
op_logical_and
id|i
op_ne
id|RTA_METRICS
)paren
id|rta
(braket
id|i
op_minus
l_int|1
)braket
op_assign
(paren
r_struct
id|rtattr
op_star
)paren
id|RTA_DATA
c_func
(paren
id|attr
)paren
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dn_fib_rtm_delroute
r_int
id|dn_fib_rtm_delroute
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|nlmsghdr
op_star
id|nlh
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|dn_fib_table
op_star
id|tb
suffix:semicolon
r_struct
id|rtattr
op_star
op_star
id|rta
op_assign
id|arg
suffix:semicolon
r_struct
id|rtmsg
op_star
id|r
op_assign
id|NLMSG_DATA
c_func
(paren
id|nlh
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dn_fib_check_attr
c_func
(paren
id|r
comma
id|rta
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|tb
op_assign
id|dn_fib_get_table
c_func
(paren
id|r-&gt;rtm_table
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tb
)paren
r_return
id|tb
op_member_access_from_pointer
r_delete
(paren
id|tb
comma
id|r
comma
(paren
r_struct
id|dn_kern_rta
op_star
)paren
id|rta
comma
id|nlh
comma
op_amp
id|NETLINK_CB
c_func
(paren
id|skb
)paren
)paren
suffix:semicolon
r_return
op_minus
id|ESRCH
suffix:semicolon
)brace
DECL|function|dn_fib_rtm_newroute
r_int
id|dn_fib_rtm_newroute
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|nlmsghdr
op_star
id|nlh
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|dn_fib_table
op_star
id|tb
suffix:semicolon
r_struct
id|rtattr
op_star
op_star
id|rta
op_assign
id|arg
suffix:semicolon
r_struct
id|rtmsg
op_star
id|r
op_assign
id|NLMSG_DATA
c_func
(paren
id|nlh
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dn_fib_check_attr
c_func
(paren
id|r
comma
id|rta
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|tb
op_assign
id|dn_fib_get_table
c_func
(paren
id|r-&gt;rtm_table
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tb
)paren
r_return
id|tb
op_member_access_from_pointer
id|insert
c_func
(paren
id|tb
comma
id|r
comma
(paren
r_struct
id|dn_kern_rta
op_star
)paren
id|rta
comma
id|nlh
comma
op_amp
id|NETLINK_CB
c_func
(paren
id|skb
)paren
)paren
suffix:semicolon
r_return
op_minus
id|ENOBUFS
suffix:semicolon
)brace
DECL|function|dn_fib_dump
r_int
id|dn_fib_dump
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|netlink_callback
op_star
id|cb
)paren
(brace
r_int
id|t
suffix:semicolon
r_int
id|s_t
suffix:semicolon
r_struct
id|dn_fib_table
op_star
id|tb
suffix:semicolon
r_if
c_cond
(paren
id|NLMSG_PAYLOAD
c_func
(paren
id|cb-&gt;nlh
comma
l_int|0
)paren
op_ge
r_sizeof
(paren
r_struct
id|rtmsg
)paren
op_logical_and
(paren
(paren
r_struct
id|rtmsg
op_star
)paren
id|NLMSG_DATA
c_func
(paren
id|cb-&gt;nlh
)paren
)paren
op_member_access_from_pointer
id|rtm_flags
op_amp
id|RTM_F_CLONED
)paren
r_return
id|dn_cache_dump
c_func
(paren
id|skb
comma
id|cb
)paren
suffix:semicolon
id|s_t
op_assign
id|cb-&gt;args
(braket
l_int|0
)braket
suffix:semicolon
r_if
c_cond
(paren
id|s_t
op_eq
l_int|0
)paren
id|s_t
op_assign
id|cb-&gt;args
(braket
l_int|0
)braket
op_assign
id|RT_MIN_TABLE
suffix:semicolon
r_for
c_loop
(paren
id|t
op_assign
id|s_t
suffix:semicolon
id|t
op_le
id|RT_TABLE_MAX
suffix:semicolon
id|t
op_increment
)paren
(brace
r_if
c_cond
(paren
id|t
OL
id|s_t
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|t
OG
id|s_t
)paren
id|memset
c_func
(paren
op_amp
id|cb-&gt;args
(braket
l_int|1
)braket
comma
l_int|0
comma
r_sizeof
(paren
id|cb-&gt;args
)paren
op_minus
r_sizeof
(paren
r_int
)paren
)paren
suffix:semicolon
id|tb
op_assign
id|dn_fib_get_table
c_func
(paren
id|t
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tb
op_eq
l_int|NULL
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|tb
op_member_access_from_pointer
id|dump
c_func
(paren
id|tb
comma
id|skb
comma
id|cb
)paren
OL
l_int|0
)paren
r_break
suffix:semicolon
)brace
id|cb-&gt;args
(braket
l_int|0
)braket
op_assign
id|t
suffix:semicolon
r_return
id|skb-&gt;len
suffix:semicolon
)brace
DECL|function|fib_magic
r_static
r_void
id|fib_magic
c_func
(paren
r_int
id|cmd
comma
r_int
id|type
comma
id|__u16
id|dst
comma
r_int
id|dst_len
comma
r_struct
id|dn_ifaddr
op_star
id|ifa
)paren
(brace
r_struct
id|dn_fib_table
op_star
id|tb
suffix:semicolon
r_struct
(brace
r_struct
id|nlmsghdr
id|nlh
suffix:semicolon
r_struct
id|rtmsg
id|rtm
suffix:semicolon
)brace
id|req
suffix:semicolon
r_struct
id|dn_kern_rta
id|rta
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|req.rtm
comma
l_int|0
comma
r_sizeof
(paren
id|req.rtm
)paren
)paren
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|rta
comma
l_int|0
comma
r_sizeof
(paren
id|rta
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|type
op_eq
id|RTN_UNICAST
)paren
id|tb
op_assign
id|dn_fib_get_table
c_func
(paren
id|RT_MIN_TABLE
comma
l_int|1
)paren
suffix:semicolon
r_else
id|tb
op_assign
id|dn_fib_get_table
c_func
(paren
id|RT_TABLE_LOCAL
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tb
op_eq
l_int|NULL
)paren
r_return
suffix:semicolon
id|req.nlh.nlmsg_len
op_assign
r_sizeof
(paren
id|req
)paren
suffix:semicolon
id|req.nlh.nlmsg_type
op_assign
id|cmd
suffix:semicolon
id|req.nlh.nlmsg_flags
op_assign
id|NLM_F_REQUEST
op_or
id|NLM_F_CREATE
op_or
id|NLM_F_APPEND
suffix:semicolon
id|req.nlh.nlmsg_pid
op_assign
l_int|0
suffix:semicolon
id|req.nlh.nlmsg_seq
op_assign
l_int|0
suffix:semicolon
id|req.rtm.rtm_dst_len
op_assign
id|dst_len
suffix:semicolon
id|req.rtm.rtm_table
op_assign
id|tb-&gt;n
suffix:semicolon
id|req.rtm.rtm_protocol
op_assign
id|RTPROT_KERNEL
suffix:semicolon
id|req.rtm.rtm_scope
op_assign
(paren
id|type
op_ne
id|RTN_LOCAL
ques
c_cond
id|RT_SCOPE_LINK
suffix:colon
id|RT_SCOPE_HOST
)paren
suffix:semicolon
id|req.rtm.rtm_type
op_assign
id|type
suffix:semicolon
id|rta.rta_dst
op_assign
op_amp
id|dst
suffix:semicolon
id|rta.rta_prefsrc
op_assign
op_amp
id|ifa-&gt;ifa_local
suffix:semicolon
id|rta.rta_oif
op_assign
op_amp
id|ifa-&gt;ifa_dev-&gt;dev-&gt;ifindex
suffix:semicolon
r_if
c_cond
(paren
id|cmd
op_eq
id|RTM_NEWROUTE
)paren
id|tb
op_member_access_from_pointer
id|insert
c_func
(paren
id|tb
comma
op_amp
id|req.rtm
comma
op_amp
id|rta
comma
op_amp
id|req.nlh
comma
l_int|NULL
)paren
suffix:semicolon
r_else
id|tb
op_member_access_from_pointer
r_delete
(paren
id|tb
comma
op_amp
id|req.rtm
comma
op_amp
id|rta
comma
op_amp
id|req.nlh
comma
l_int|NULL
)paren
suffix:semicolon
)brace
DECL|function|dn_fib_add_ifaddr
r_static
r_void
id|dn_fib_add_ifaddr
c_func
(paren
r_struct
id|dn_ifaddr
op_star
id|ifa
)paren
(brace
id|fib_magic
c_func
(paren
id|RTM_NEWROUTE
comma
id|RTN_LOCAL
comma
id|ifa-&gt;ifa_local
comma
l_int|16
comma
id|ifa
)paren
suffix:semicolon
macro_line|#if 0
r_if
c_cond
(paren
op_logical_neg
(paren
id|dev-&gt;flags
op_amp
id|IFF_UP
)paren
)paren
r_return
suffix:semicolon
multiline_comment|/* In the future, we will want to add default routes here */
macro_line|#endif
)brace
DECL|function|dn_fib_del_ifaddr
r_static
r_void
id|dn_fib_del_ifaddr
c_func
(paren
r_struct
id|dn_ifaddr
op_star
id|ifa
)paren
(brace
r_int
id|found_it
op_assign
l_int|0
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
suffix:semicolon
r_struct
id|dn_dev
op_star
id|dn_db
suffix:semicolon
r_struct
id|dn_ifaddr
op_star
id|ifa2
suffix:semicolon
id|ASSERT_RTNL
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* Scan device list */
id|read_lock
c_func
(paren
op_amp
id|dev_base_lock
)paren
suffix:semicolon
r_for
c_loop
(paren
id|dev
op_assign
id|dev_base
suffix:semicolon
id|dev
suffix:semicolon
id|dev
op_assign
id|dev-&gt;next
)paren
(brace
id|dn_db
op_assign
id|dev-&gt;dn_ptr
suffix:semicolon
r_if
c_cond
(paren
id|dn_db
op_eq
l_int|NULL
)paren
r_continue
suffix:semicolon
r_for
c_loop
(paren
id|ifa2
op_assign
id|dn_db-&gt;ifa_list
suffix:semicolon
id|ifa2
suffix:semicolon
id|ifa2
op_assign
id|ifa2-&gt;ifa_next
)paren
(brace
r_if
c_cond
(paren
id|ifa2-&gt;ifa_local
op_eq
id|ifa-&gt;ifa_local
)paren
(brace
id|found_it
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
)brace
id|read_unlock
c_func
(paren
op_amp
id|dev_base_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|found_it
op_eq
l_int|0
)paren
(brace
id|fib_magic
c_func
(paren
id|RTM_DELROUTE
comma
id|RTN_LOCAL
comma
id|ifa-&gt;ifa_local
comma
l_int|16
comma
id|ifa
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dnet_addr_type
c_func
(paren
id|ifa-&gt;ifa_local
)paren
op_ne
id|RTN_LOCAL
)paren
(brace
r_if
c_cond
(paren
id|dn_fib_sync_down
c_func
(paren
id|ifa-&gt;ifa_local
comma
l_int|NULL
comma
l_int|0
)paren
)paren
id|dn_fib_flush
c_func
(paren
)paren
suffix:semicolon
)brace
)brace
)brace
DECL|function|dn_fib_disable_addr
r_static
r_void
id|dn_fib_disable_addr
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|force
)paren
(brace
r_if
c_cond
(paren
id|dn_fib_sync_down
c_func
(paren
l_int|0
comma
id|dev
comma
id|force
)paren
)paren
id|dn_fib_flush
c_func
(paren
)paren
suffix:semicolon
id|dn_rt_cache_flush
c_func
(paren
l_int|0
)paren
suffix:semicolon
id|neigh_ifdown
c_func
(paren
op_amp
id|dn_neigh_table
comma
id|dev
)paren
suffix:semicolon
)brace
DECL|function|dn_fib_dnaddr_event
r_static
r_int
id|dn_fib_dnaddr_event
c_func
(paren
r_struct
id|notifier_block
op_star
id|this
comma
r_int
r_int
id|event
comma
r_void
op_star
id|ptr
)paren
(brace
r_struct
id|dn_ifaddr
op_star
id|ifa
op_assign
(paren
r_struct
id|dn_ifaddr
op_star
)paren
id|ptr
suffix:semicolon
r_switch
c_cond
(paren
id|event
)paren
(brace
r_case
id|NETDEV_UP
suffix:colon
id|dn_fib_add_ifaddr
c_func
(paren
id|ifa
)paren
suffix:semicolon
id|dn_fib_sync_up
c_func
(paren
id|ifa-&gt;ifa_dev-&gt;dev
)paren
suffix:semicolon
id|dn_rt_cache_flush
c_func
(paren
op_minus
l_int|1
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|NETDEV_DOWN
suffix:colon
id|dn_fib_del_ifaddr
c_func
(paren
id|ifa
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ifa-&gt;ifa_dev
op_logical_and
id|ifa-&gt;ifa_dev-&gt;ifa_list
op_eq
l_int|NULL
)paren
(brace
id|dn_fib_disable_addr
c_func
(paren
id|ifa-&gt;ifa_dev-&gt;dev
comma
l_int|1
)paren
suffix:semicolon
)brace
r_else
(brace
id|dn_rt_cache_flush
c_func
(paren
op_minus
l_int|1
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
r_return
id|NOTIFY_DONE
suffix:semicolon
)brace
DECL|function|dn_fib_sync_down
r_int
id|dn_fib_sync_down
c_func
(paren
id|dn_address
id|local
comma
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|force
)paren
(brace
r_int
id|ret
op_assign
l_int|0
suffix:semicolon
r_int
id|scope
op_assign
id|RT_SCOPE_NOWHERE
suffix:semicolon
r_if
c_cond
(paren
id|force
)paren
id|scope
op_assign
op_minus
l_int|1
suffix:semicolon
id|for_fib_info
c_func
(paren
)paren
(brace
multiline_comment|/* &n;                 * This makes no sense for DECnet.... we will almost&n;                 * certainly have more than one local address the same&n;                 * over all our interfaces. It needs thinking about&n;                 * some more.&n;                 */
r_if
c_cond
(paren
id|local
op_logical_and
id|fi-&gt;fib_prefsrc
op_eq
id|local
)paren
(brace
id|fi-&gt;fib_flags
op_or_assign
id|RTNH_F_DEAD
suffix:semicolon
id|ret
op_increment
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|dev
op_logical_and
id|fi-&gt;fib_nhs
)paren
(brace
r_int
id|dead
op_assign
l_int|0
suffix:semicolon
id|change_nexthops
c_func
(paren
id|fi
)paren
(brace
r_if
c_cond
(paren
id|nh-&gt;nh_flags
op_amp
id|RTNH_F_DEAD
)paren
id|dead
op_increment
suffix:semicolon
r_else
r_if
c_cond
(paren
id|nh-&gt;nh_dev
op_eq
id|dev
op_logical_and
id|nh-&gt;nh_scope
op_ne
id|scope
)paren
(brace
id|spin_lock_bh
c_func
(paren
op_amp
id|dn_fib_multipath_lock
)paren
suffix:semicolon
id|nh-&gt;nh_flags
op_or_assign
id|RTNH_F_DEAD
suffix:semicolon
id|fi-&gt;fib_power
op_sub_assign
id|nh-&gt;nh_power
suffix:semicolon
id|nh-&gt;nh_power
op_assign
l_int|0
suffix:semicolon
id|spin_unlock_bh
c_func
(paren
op_amp
id|dn_fib_multipath_lock
)paren
suffix:semicolon
id|dead
op_increment
suffix:semicolon
)brace
)brace
id|endfor_nexthops
c_func
(paren
id|fi
)paren
r_if
c_cond
(paren
id|dead
op_eq
id|fi-&gt;fib_nhs
)paren
(brace
id|fi-&gt;fib_flags
op_or_assign
id|RTNH_F_DEAD
suffix:semicolon
id|ret
op_increment
suffix:semicolon
)brace
)brace
)brace
id|endfor_fib_info
c_func
(paren
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|function|dn_fib_sync_up
r_int
id|dn_fib_sync_up
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_int
id|ret
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|dev-&gt;flags
op_amp
id|IFF_UP
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|for_fib_info
c_func
(paren
)paren
(brace
r_int
id|alive
op_assign
l_int|0
suffix:semicolon
id|change_nexthops
c_func
(paren
id|fi
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|nh-&gt;nh_flags
op_amp
id|RTNH_F_DEAD
)paren
)paren
(brace
id|alive
op_increment
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
id|nh-&gt;nh_dev
op_eq
l_int|NULL
op_logical_or
op_logical_neg
(paren
id|nh-&gt;nh_dev-&gt;flags
op_amp
id|IFF_UP
)paren
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|nh-&gt;nh_dev
op_ne
id|dev
op_logical_or
id|dev-&gt;dn_ptr
op_eq
l_int|NULL
)paren
r_continue
suffix:semicolon
id|alive
op_increment
suffix:semicolon
id|spin_lock_bh
c_func
(paren
op_amp
id|dn_fib_multipath_lock
)paren
suffix:semicolon
id|nh-&gt;nh_power
op_assign
l_int|0
suffix:semicolon
id|nh-&gt;nh_flags
op_and_assign
op_complement
id|RTNH_F_DEAD
suffix:semicolon
id|spin_unlock_bh
c_func
(paren
op_amp
id|dn_fib_multipath_lock
)paren
suffix:semicolon
)brace
id|endfor_nexthops
c_func
(paren
id|fi
)paren
suffix:semicolon
r_if
c_cond
(paren
id|alive
OG
l_int|0
)paren
(brace
id|fi-&gt;fib_flags
op_and_assign
op_complement
id|RTNH_F_DEAD
suffix:semicolon
id|ret
op_increment
suffix:semicolon
)brace
)brace
id|endfor_fib_info
c_func
(paren
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|function|dn_fib_flush
r_void
id|dn_fib_flush
c_func
(paren
r_void
)paren
(brace
r_int
id|flushed
op_assign
l_int|0
suffix:semicolon
r_struct
id|dn_fib_table
op_star
id|tb
suffix:semicolon
r_int
id|id
suffix:semicolon
r_for
c_loop
(paren
id|id
op_assign
id|RT_TABLE_MAX
suffix:semicolon
id|id
OG
l_int|0
suffix:semicolon
id|id
op_decrement
)paren
(brace
r_if
c_cond
(paren
(paren
id|tb
op_assign
id|dn_fib_get_table
c_func
(paren
id|id
comma
l_int|0
)paren
)paren
op_eq
l_int|NULL
)paren
r_continue
suffix:semicolon
id|flushed
op_add_assign
id|tb
op_member_access_from_pointer
id|flush
c_func
(paren
id|tb
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|flushed
)paren
id|dn_rt_cache_flush
c_func
(paren
op_minus
l_int|1
)paren
suffix:semicolon
)brace
DECL|variable|dn_fib_dnaddr_notifier
r_static
r_struct
id|notifier_block
id|dn_fib_dnaddr_notifier
op_assign
(brace
dot
id|notifier_call
op_assign
id|dn_fib_dnaddr_event
comma
)brace
suffix:semicolon
DECL|function|dn_fib_cleanup
r_void
id|__exit
id|dn_fib_cleanup
c_func
(paren
r_void
)paren
(brace
id|dn_fib_table_cleanup
c_func
(paren
)paren
suffix:semicolon
id|dn_fib_rules_cleanup
c_func
(paren
)paren
suffix:semicolon
id|unregister_dnaddr_notifier
c_func
(paren
op_amp
id|dn_fib_dnaddr_notifier
)paren
suffix:semicolon
)brace
DECL|function|dn_fib_init
r_void
id|__init
id|dn_fib_init
c_func
(paren
r_void
)paren
(brace
id|dn_fib_table_init
c_func
(paren
)paren
suffix:semicolon
id|dn_fib_rules_init
c_func
(paren
)paren
suffix:semicolon
id|register_dnaddr_notifier
c_func
(paren
op_amp
id|dn_fib_dnaddr_notifier
)paren
suffix:semicolon
)brace
eof
