multiline_comment|/*&n; *&t;AARP:&t;&t;An implementation of the AppleTalk AARP protocol for&n; *&t;&t;&t;Ethernet &squot;ELAP&squot;.&n; *&n; *&t;&t;Alan Cox  &lt;Alan.Cox@linux.org&gt;&n; *&n; *&t;This doesn&squot;t fit cleanly with the IP arp. Potentially we can use&n; *&t;the generic neighbour discovery code to clean this up.&n; *&n; *&t;FIXME:&n; *&t;&t;We ought to handle the retransmits with a single list and a&n; *&t;separate fast timer for when it is needed.&n; *&t;&t;Use neighbour discovery code.&n; *&t;&t;Token Ring Support.&n; *&n; *&t;&t;This program is free software; you can redistribute it and/or&n; *&t;&t;modify it under the terms of the GNU General Public License&n; *&t;&t;as published by the Free Software Foundation; either version&n; *&t;&t;2 of the License, or (at your option) any later version.&n; *&n; *&n; *&t;References:&n; *&t;&t;Inside AppleTalk (2nd Ed).&n; *&t;Fixes:&n; *&t;&t;Jaume Grau&t;-&t;flush caches on AARP_PROBE&n; *&t;&t;Rob Newberry&t;-&t;Added proxy AARP and AARP proc fs,&n; *&t;&t;&t;&t;&t;moved probing from DDP module.&n; *&t;&t;Arnaldo C. Melo -&t;don&squot;t mangle rx packets&n; *&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/if_arp.h&gt;
macro_line|#include &lt;net/sock.h&gt;
macro_line|#include &lt;net/datalink.h&gt;
macro_line|#include &lt;net/psnap.h&gt;
macro_line|#include &lt;linux/atalk.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/proc_fs.h&gt;
macro_line|#include &lt;linux/seq_file.h&gt;
DECL|variable|sysctl_aarp_expiry_time
r_int
id|sysctl_aarp_expiry_time
op_assign
id|AARP_EXPIRY_TIME
suffix:semicolon
DECL|variable|sysctl_aarp_tick_time
r_int
id|sysctl_aarp_tick_time
op_assign
id|AARP_TICK_TIME
suffix:semicolon
DECL|variable|sysctl_aarp_retransmit_limit
r_int
id|sysctl_aarp_retransmit_limit
op_assign
id|AARP_RETRANSMIT_LIMIT
suffix:semicolon
DECL|variable|sysctl_aarp_resolve_time
r_int
id|sysctl_aarp_resolve_time
op_assign
id|AARP_RESOLVE_TIME
suffix:semicolon
multiline_comment|/* Lists of aarp entries */
multiline_comment|/**&n; *&t;struct aarp_entry - AARP entry&n; *&t;@last_sent - Last time we xmitted the aarp request&n; *&t;@packet_queue - Queue of frames wait for resolution&n; *&t;@status - Used for proxy AARP&n; *&t;expires_at - Entry expiry time&n; *&t;target_addr - DDP Address&n; *&t;dev - Device to use&n; *&t;hwaddr - Physical i/f address of target/router&n; *&t;xmit_count - When this hits 10 we give up&n; *&t;next - Next entry in chain&n; */
DECL|struct|aarp_entry
r_struct
id|aarp_entry
(brace
multiline_comment|/* These first two are only used for unresolved entries */
DECL|member|last_sent
r_int
r_int
id|last_sent
suffix:semicolon
DECL|member|packet_queue
r_struct
id|sk_buff_head
id|packet_queue
suffix:semicolon
DECL|member|status
r_int
id|status
suffix:semicolon
DECL|member|expires_at
r_int
r_int
id|expires_at
suffix:semicolon
DECL|member|target_addr
r_struct
id|atalk_addr
id|target_addr
suffix:semicolon
DECL|member|dev
r_struct
id|net_device
op_star
id|dev
suffix:semicolon
DECL|member|hwaddr
r_char
id|hwaddr
(braket
l_int|6
)braket
suffix:semicolon
DECL|member|xmit_count
r_int
r_int
id|xmit_count
suffix:semicolon
DECL|member|next
r_struct
id|aarp_entry
op_star
id|next
suffix:semicolon
)brace
suffix:semicolon
multiline_comment|/* Hashed list of resolved, unresolved and proxy entries */
DECL|variable|resolved
r_static
r_struct
id|aarp_entry
op_star
id|resolved
(braket
id|AARP_HASH_SIZE
)braket
suffix:semicolon
DECL|variable|unresolved
r_static
r_struct
id|aarp_entry
op_star
id|unresolved
(braket
id|AARP_HASH_SIZE
)braket
suffix:semicolon
DECL|variable|proxies
r_static
r_struct
id|aarp_entry
op_star
id|proxies
(braket
id|AARP_HASH_SIZE
)braket
suffix:semicolon
DECL|variable|unresolved_count
r_static
r_int
id|unresolved_count
suffix:semicolon
multiline_comment|/* One lock protects it all. */
DECL|variable|aarp_lock
r_static
id|rwlock_t
id|aarp_lock
op_assign
id|RW_LOCK_UNLOCKED
suffix:semicolon
multiline_comment|/* Used to walk the list and purge/kick entries.  */
DECL|variable|aarp_timer
r_static
r_struct
id|timer_list
id|aarp_timer
suffix:semicolon
multiline_comment|/*&n; *&t;Delete an aarp queue&n; *&n; *&t;Must run under aarp_lock.&n; */
DECL|function|__aarp_expire
r_static
r_void
id|__aarp_expire
c_func
(paren
r_struct
id|aarp_entry
op_star
id|a
)paren
(brace
id|skb_queue_purge
c_func
(paren
op_amp
id|a-&gt;packet_queue
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|a
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;Send an aarp queue entry request&n; *&n; *&t;Must run under aarp_lock.&n; */
DECL|function|__aarp_send_query
r_static
r_void
id|__aarp_send_query
c_func
(paren
r_struct
id|aarp_entry
op_star
id|a
)paren
(brace
r_static
r_int
r_char
id|aarp_eth_multicast
(braket
id|ETH_ALEN
)braket
op_assign
(brace
l_int|0x09
comma
l_int|0x00
comma
l_int|0x07
comma
l_int|0xFF
comma
l_int|0xFF
comma
l_int|0xFF
)brace
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
op_assign
id|a-&gt;dev
suffix:semicolon
r_struct
id|elapaarp
op_star
id|eah
suffix:semicolon
r_int
id|len
op_assign
id|dev-&gt;hard_header_len
op_plus
r_sizeof
(paren
op_star
id|eah
)paren
op_plus
id|aarp_dl-&gt;header_length
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
op_assign
id|alloc_skb
c_func
(paren
id|len
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_struct
id|atalk_addr
op_star
id|sat
op_assign
id|atalk_find_dev_addr
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sat
)paren
(brace
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/* Set up the buffer */
id|skb_reserve
c_func
(paren
id|skb
comma
id|dev-&gt;hard_header_len
op_plus
id|aarp_dl-&gt;header_length
)paren
suffix:semicolon
id|skb-&gt;nh.raw
op_assign
id|skb-&gt;h.raw
op_assign
id|skb_put
c_func
(paren
id|skb
comma
r_sizeof
(paren
op_star
id|eah
)paren
)paren
suffix:semicolon
id|skb-&gt;protocol
op_assign
id|htons
c_func
(paren
id|ETH_P_ATALK
)paren
suffix:semicolon
id|skb-&gt;dev
op_assign
id|dev
suffix:semicolon
id|eah
op_assign
id|aarp_hdr
c_func
(paren
id|skb
)paren
suffix:semicolon
multiline_comment|/* Set up the ARP */
id|eah-&gt;hw_type
op_assign
id|htons
c_func
(paren
id|AARP_HW_TYPE_ETHERNET
)paren
suffix:semicolon
id|eah-&gt;pa_type
op_assign
id|htons
c_func
(paren
id|ETH_P_ATALK
)paren
suffix:semicolon
id|eah-&gt;hw_len
op_assign
id|ETH_ALEN
suffix:semicolon
id|eah-&gt;pa_len
op_assign
id|AARP_PA_ALEN
suffix:semicolon
id|eah-&gt;function
op_assign
id|htons
c_func
(paren
id|AARP_REQUEST
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|eah-&gt;hw_src
comma
id|dev-&gt;dev_addr
comma
id|ETH_ALEN
)paren
suffix:semicolon
id|eah-&gt;pa_src_zero
op_assign
l_int|0
suffix:semicolon
id|eah-&gt;pa_src_net
op_assign
id|sat-&gt;s_net
suffix:semicolon
id|eah-&gt;pa_src_node
op_assign
id|sat-&gt;s_node
suffix:semicolon
id|memset
c_func
(paren
id|eah-&gt;hw_dst
comma
l_char|&squot;&bslash;0&squot;
comma
id|ETH_ALEN
)paren
suffix:semicolon
id|eah-&gt;pa_dst_zero
op_assign
l_int|0
suffix:semicolon
id|eah-&gt;pa_dst_net
op_assign
id|a-&gt;target_addr.s_net
suffix:semicolon
id|eah-&gt;pa_dst_node
op_assign
id|a-&gt;target_addr.s_node
suffix:semicolon
multiline_comment|/* Send it */
id|aarp_dl
op_member_access_from_pointer
id|request
c_func
(paren
id|aarp_dl
comma
id|skb
comma
id|aarp_eth_multicast
)paren
suffix:semicolon
multiline_comment|/* Update the sending count */
id|a-&gt;xmit_count
op_increment
suffix:semicolon
id|a-&gt;last_sent
op_assign
id|jiffies
suffix:semicolon
)brace
multiline_comment|/* This runs under aarp_lock and in softint context, so only atomic memory&n; * allocations can be used. */
DECL|function|aarp_send_reply
r_static
r_void
id|aarp_send_reply
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|atalk_addr
op_star
id|us
comma
r_struct
id|atalk_addr
op_star
id|them
comma
r_int
r_char
op_star
id|sha
)paren
(brace
r_struct
id|elapaarp
op_star
id|eah
suffix:semicolon
r_int
id|len
op_assign
id|dev-&gt;hard_header_len
op_plus
r_sizeof
(paren
op_star
id|eah
)paren
op_plus
id|aarp_dl-&gt;header_length
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
op_assign
id|alloc_skb
c_func
(paren
id|len
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
r_return
suffix:semicolon
multiline_comment|/* Set up the buffer */
id|skb_reserve
c_func
(paren
id|skb
comma
id|dev-&gt;hard_header_len
op_plus
id|aarp_dl-&gt;header_length
)paren
suffix:semicolon
id|skb-&gt;nh.raw
op_assign
id|skb-&gt;h.raw
op_assign
id|skb_put
c_func
(paren
id|skb
comma
r_sizeof
(paren
op_star
id|eah
)paren
)paren
suffix:semicolon
id|skb-&gt;protocol
op_assign
id|htons
c_func
(paren
id|ETH_P_ATALK
)paren
suffix:semicolon
id|skb-&gt;dev
op_assign
id|dev
suffix:semicolon
id|eah
op_assign
id|aarp_hdr
c_func
(paren
id|skb
)paren
suffix:semicolon
multiline_comment|/* Set up the ARP */
id|eah-&gt;hw_type
op_assign
id|htons
c_func
(paren
id|AARP_HW_TYPE_ETHERNET
)paren
suffix:semicolon
id|eah-&gt;pa_type
op_assign
id|htons
c_func
(paren
id|ETH_P_ATALK
)paren
suffix:semicolon
id|eah-&gt;hw_len
op_assign
id|ETH_ALEN
suffix:semicolon
id|eah-&gt;pa_len
op_assign
id|AARP_PA_ALEN
suffix:semicolon
id|eah-&gt;function
op_assign
id|htons
c_func
(paren
id|AARP_REPLY
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|eah-&gt;hw_src
comma
id|dev-&gt;dev_addr
comma
id|ETH_ALEN
)paren
suffix:semicolon
id|eah-&gt;pa_src_zero
op_assign
l_int|0
suffix:semicolon
id|eah-&gt;pa_src_net
op_assign
id|us-&gt;s_net
suffix:semicolon
id|eah-&gt;pa_src_node
op_assign
id|us-&gt;s_node
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sha
)paren
id|memset
c_func
(paren
id|eah-&gt;hw_dst
comma
l_char|&squot;&bslash;0&squot;
comma
id|ETH_ALEN
)paren
suffix:semicolon
r_else
id|memcpy
c_func
(paren
id|eah-&gt;hw_dst
comma
id|sha
comma
id|ETH_ALEN
)paren
suffix:semicolon
id|eah-&gt;pa_dst_zero
op_assign
l_int|0
suffix:semicolon
id|eah-&gt;pa_dst_net
op_assign
id|them-&gt;s_net
suffix:semicolon
id|eah-&gt;pa_dst_node
op_assign
id|them-&gt;s_node
suffix:semicolon
multiline_comment|/* Send it */
id|aarp_dl
op_member_access_from_pointer
id|request
c_func
(paren
id|aarp_dl
comma
id|skb
comma
id|sha
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;Send probe frames. Called from aarp_probe_network and&n; *&t;aarp_proxy_probe_network.&n; */
DECL|function|aarp_send_probe
r_void
id|aarp_send_probe
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|atalk_addr
op_star
id|us
)paren
(brace
r_struct
id|elapaarp
op_star
id|eah
suffix:semicolon
r_int
id|len
op_assign
id|dev-&gt;hard_header_len
op_plus
r_sizeof
(paren
op_star
id|eah
)paren
op_plus
id|aarp_dl-&gt;header_length
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
op_assign
id|alloc_skb
c_func
(paren
id|len
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_static
r_int
r_char
id|aarp_eth_multicast
(braket
id|ETH_ALEN
)braket
op_assign
(brace
l_int|0x09
comma
l_int|0x00
comma
l_int|0x07
comma
l_int|0xFF
comma
l_int|0xFF
comma
l_int|0xFF
)brace
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
r_return
suffix:semicolon
multiline_comment|/* Set up the buffer */
id|skb_reserve
c_func
(paren
id|skb
comma
id|dev-&gt;hard_header_len
op_plus
id|aarp_dl-&gt;header_length
)paren
suffix:semicolon
id|skb-&gt;nh.raw
op_assign
id|skb-&gt;h.raw
op_assign
id|skb_put
c_func
(paren
id|skb
comma
r_sizeof
(paren
op_star
id|eah
)paren
)paren
suffix:semicolon
id|skb-&gt;protocol
op_assign
id|htons
c_func
(paren
id|ETH_P_ATALK
)paren
suffix:semicolon
id|skb-&gt;dev
op_assign
id|dev
suffix:semicolon
id|eah
op_assign
id|aarp_hdr
c_func
(paren
id|skb
)paren
suffix:semicolon
multiline_comment|/* Set up the ARP */
id|eah-&gt;hw_type
op_assign
id|htons
c_func
(paren
id|AARP_HW_TYPE_ETHERNET
)paren
suffix:semicolon
id|eah-&gt;pa_type
op_assign
id|htons
c_func
(paren
id|ETH_P_ATALK
)paren
suffix:semicolon
id|eah-&gt;hw_len
op_assign
id|ETH_ALEN
suffix:semicolon
id|eah-&gt;pa_len
op_assign
id|AARP_PA_ALEN
suffix:semicolon
id|eah-&gt;function
op_assign
id|htons
c_func
(paren
id|AARP_PROBE
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|eah-&gt;hw_src
comma
id|dev-&gt;dev_addr
comma
id|ETH_ALEN
)paren
suffix:semicolon
id|eah-&gt;pa_src_zero
op_assign
l_int|0
suffix:semicolon
id|eah-&gt;pa_src_net
op_assign
id|us-&gt;s_net
suffix:semicolon
id|eah-&gt;pa_src_node
op_assign
id|us-&gt;s_node
suffix:semicolon
id|memset
c_func
(paren
id|eah-&gt;hw_dst
comma
l_char|&squot;&bslash;0&squot;
comma
id|ETH_ALEN
)paren
suffix:semicolon
id|eah-&gt;pa_dst_zero
op_assign
l_int|0
suffix:semicolon
id|eah-&gt;pa_dst_net
op_assign
id|us-&gt;s_net
suffix:semicolon
id|eah-&gt;pa_dst_node
op_assign
id|us-&gt;s_node
suffix:semicolon
multiline_comment|/* Send it */
id|aarp_dl
op_member_access_from_pointer
id|request
c_func
(paren
id|aarp_dl
comma
id|skb
comma
id|aarp_eth_multicast
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;Handle an aarp timer expire&n; *&n; *&t;Must run under the aarp_lock.&n; */
DECL|function|__aarp_expire_timer
r_static
r_void
id|__aarp_expire_timer
c_func
(paren
r_struct
id|aarp_entry
op_star
op_star
id|n
)paren
(brace
r_struct
id|aarp_entry
op_star
id|t
suffix:semicolon
r_while
c_loop
(paren
op_star
id|n
)paren
multiline_comment|/* Expired ? */
r_if
c_cond
(paren
id|time_after
c_func
(paren
id|jiffies
comma
(paren
op_star
id|n
)paren
op_member_access_from_pointer
id|expires_at
)paren
)paren
(brace
id|t
op_assign
op_star
id|n
suffix:semicolon
op_star
id|n
op_assign
(paren
op_star
id|n
)paren
op_member_access_from_pointer
id|next
suffix:semicolon
id|__aarp_expire
c_func
(paren
id|t
)paren
suffix:semicolon
)brace
r_else
id|n
op_assign
op_amp
(paren
(paren
op_star
id|n
)paren
op_member_access_from_pointer
id|next
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;Kick all pending requests 5 times a second.&n; *&n; *&t;Must run under the aarp_lock.&n; */
DECL|function|__aarp_kick
r_static
r_void
id|__aarp_kick
c_func
(paren
r_struct
id|aarp_entry
op_star
op_star
id|n
)paren
(brace
r_struct
id|aarp_entry
op_star
id|t
suffix:semicolon
r_while
c_loop
(paren
op_star
id|n
)paren
multiline_comment|/* Expired: if this will be the 11th tx, we delete instead. */
r_if
c_cond
(paren
(paren
op_star
id|n
)paren
op_member_access_from_pointer
id|xmit_count
op_ge
id|sysctl_aarp_retransmit_limit
)paren
(brace
id|t
op_assign
op_star
id|n
suffix:semicolon
op_star
id|n
op_assign
(paren
op_star
id|n
)paren
op_member_access_from_pointer
id|next
suffix:semicolon
id|__aarp_expire
c_func
(paren
id|t
)paren
suffix:semicolon
)brace
r_else
(brace
id|__aarp_send_query
c_func
(paren
op_star
id|n
)paren
suffix:semicolon
id|n
op_assign
op_amp
(paren
(paren
op_star
id|n
)paren
op_member_access_from_pointer
id|next
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; *&t;A device has gone down. Take all entries referring to the device&n; *&t;and remove them.&n; *&n; *&t;Must run under the aarp_lock.&n; */
DECL|function|__aarp_expire_device
r_static
r_void
id|__aarp_expire_device
c_func
(paren
r_struct
id|aarp_entry
op_star
op_star
id|n
comma
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|aarp_entry
op_star
id|t
suffix:semicolon
r_while
c_loop
(paren
op_star
id|n
)paren
r_if
c_cond
(paren
(paren
op_star
id|n
)paren
op_member_access_from_pointer
id|dev
op_eq
id|dev
)paren
(brace
id|t
op_assign
op_star
id|n
suffix:semicolon
op_star
id|n
op_assign
(paren
op_star
id|n
)paren
op_member_access_from_pointer
id|next
suffix:semicolon
id|__aarp_expire
c_func
(paren
id|t
)paren
suffix:semicolon
)brace
r_else
id|n
op_assign
op_amp
(paren
(paren
op_star
id|n
)paren
op_member_access_from_pointer
id|next
)paren
suffix:semicolon
)brace
multiline_comment|/* Handle the timer event */
DECL|function|aarp_expire_timeout
r_static
r_void
id|aarp_expire_timeout
c_func
(paren
r_int
r_int
id|unused
)paren
(brace
r_int
id|ct
suffix:semicolon
id|write_lock_bh
c_func
(paren
op_amp
id|aarp_lock
)paren
suffix:semicolon
r_for
c_loop
(paren
id|ct
op_assign
l_int|0
suffix:semicolon
id|ct
OL
id|AARP_HASH_SIZE
suffix:semicolon
id|ct
op_increment
)paren
(brace
id|__aarp_expire_timer
c_func
(paren
op_amp
id|resolved
(braket
id|ct
)braket
)paren
suffix:semicolon
id|__aarp_kick
c_func
(paren
op_amp
id|unresolved
(braket
id|ct
)braket
)paren
suffix:semicolon
id|__aarp_expire_timer
c_func
(paren
op_amp
id|unresolved
(braket
id|ct
)braket
)paren
suffix:semicolon
id|__aarp_expire_timer
c_func
(paren
op_amp
id|proxies
(braket
id|ct
)braket
)paren
suffix:semicolon
)brace
id|write_unlock_bh
c_func
(paren
op_amp
id|aarp_lock
)paren
suffix:semicolon
id|mod_timer
c_func
(paren
op_amp
id|aarp_timer
comma
id|jiffies
op_plus
(paren
id|unresolved_count
ques
c_cond
id|sysctl_aarp_tick_time
suffix:colon
id|sysctl_aarp_expiry_time
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/* Network device notifier chain handler. */
DECL|function|aarp_device_event
r_static
r_int
id|aarp_device_event
c_func
(paren
r_struct
id|notifier_block
op_star
id|this
comma
r_int
r_int
id|event
comma
r_void
op_star
id|ptr
)paren
(brace
r_int
id|ct
suffix:semicolon
r_if
c_cond
(paren
id|event
op_eq
id|NETDEV_DOWN
)paren
(brace
id|write_lock_bh
c_func
(paren
op_amp
id|aarp_lock
)paren
suffix:semicolon
r_for
c_loop
(paren
id|ct
op_assign
l_int|0
suffix:semicolon
id|ct
OL
id|AARP_HASH_SIZE
suffix:semicolon
id|ct
op_increment
)paren
(brace
id|__aarp_expire_device
c_func
(paren
op_amp
id|resolved
(braket
id|ct
)braket
comma
id|ptr
)paren
suffix:semicolon
id|__aarp_expire_device
c_func
(paren
op_amp
id|unresolved
(braket
id|ct
)braket
comma
id|ptr
)paren
suffix:semicolon
id|__aarp_expire_device
c_func
(paren
op_amp
id|proxies
(braket
id|ct
)braket
comma
id|ptr
)paren
suffix:semicolon
)brace
id|write_unlock_bh
c_func
(paren
op_amp
id|aarp_lock
)paren
suffix:semicolon
)brace
r_return
id|NOTIFY_DONE
suffix:semicolon
)brace
multiline_comment|/* Expire all entries in a hash chain */
DECL|function|__aarp_expire_all
r_static
r_void
id|__aarp_expire_all
c_func
(paren
r_struct
id|aarp_entry
op_star
op_star
id|n
)paren
(brace
r_struct
id|aarp_entry
op_star
id|t
suffix:semicolon
r_while
c_loop
(paren
op_star
id|n
)paren
(brace
id|t
op_assign
op_star
id|n
suffix:semicolon
op_star
id|n
op_assign
(paren
op_star
id|n
)paren
op_member_access_from_pointer
id|next
suffix:semicolon
id|__aarp_expire
c_func
(paren
id|t
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* Cleanup all hash chains -- module unloading */
DECL|function|aarp_purge
r_static
r_void
id|aarp_purge
c_func
(paren
r_void
)paren
(brace
r_int
id|ct
suffix:semicolon
id|write_lock_bh
c_func
(paren
op_amp
id|aarp_lock
)paren
suffix:semicolon
r_for
c_loop
(paren
id|ct
op_assign
l_int|0
suffix:semicolon
id|ct
OL
id|AARP_HASH_SIZE
suffix:semicolon
id|ct
op_increment
)paren
(brace
id|__aarp_expire_all
c_func
(paren
op_amp
id|resolved
(braket
id|ct
)braket
)paren
suffix:semicolon
id|__aarp_expire_all
c_func
(paren
op_amp
id|unresolved
(braket
id|ct
)braket
)paren
suffix:semicolon
id|__aarp_expire_all
c_func
(paren
op_amp
id|proxies
(braket
id|ct
)braket
)paren
suffix:semicolon
)brace
id|write_unlock_bh
c_func
(paren
op_amp
id|aarp_lock
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;Create a new aarp entry.  This must use GFP_ATOMIC because it&n; *&t;runs while holding spinlocks.&n; */
DECL|function|aarp_alloc
r_static
r_struct
id|aarp_entry
op_star
id|aarp_alloc
c_func
(paren
r_void
)paren
(brace
r_struct
id|aarp_entry
op_star
id|a
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|a
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|a
)paren
id|skb_queue_head_init
c_func
(paren
op_amp
id|a-&gt;packet_queue
)paren
suffix:semicolon
r_return
id|a
suffix:semicolon
)brace
multiline_comment|/*&n; * Find an entry. We might return an expired but not yet purged entry. We&n; * don&squot;t care as it will do no harm.&n; *&n; * This must run under the aarp_lock.&n; */
DECL|function|__aarp_find_entry
r_static
r_struct
id|aarp_entry
op_star
id|__aarp_find_entry
c_func
(paren
r_struct
id|aarp_entry
op_star
id|list
comma
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|atalk_addr
op_star
id|sat
)paren
(brace
r_while
c_loop
(paren
id|list
)paren
(brace
r_if
c_cond
(paren
id|list-&gt;target_addr.s_net
op_eq
id|sat-&gt;s_net
op_logical_and
id|list-&gt;target_addr.s_node
op_eq
id|sat-&gt;s_node
op_logical_and
id|list-&gt;dev
op_eq
id|dev
)paren
r_break
suffix:semicolon
id|list
op_assign
id|list-&gt;next
suffix:semicolon
)brace
r_return
id|list
suffix:semicolon
)brace
multiline_comment|/* Called from the DDP code, and thus must be exported. */
DECL|function|aarp_proxy_remove
r_void
id|aarp_proxy_remove
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|atalk_addr
op_star
id|sa
)paren
(brace
r_int
id|hash
op_assign
id|sa-&gt;s_node
op_mod
(paren
id|AARP_HASH_SIZE
op_minus
l_int|1
)paren
suffix:semicolon
r_struct
id|aarp_entry
op_star
id|a
suffix:semicolon
id|write_lock_bh
c_func
(paren
op_amp
id|aarp_lock
)paren
suffix:semicolon
id|a
op_assign
id|__aarp_find_entry
c_func
(paren
id|proxies
(braket
id|hash
)braket
comma
id|dev
comma
id|sa
)paren
suffix:semicolon
r_if
c_cond
(paren
id|a
)paren
id|a-&gt;expires_at
op_assign
id|jiffies
op_minus
l_int|1
suffix:semicolon
id|write_unlock_bh
c_func
(paren
op_amp
id|aarp_lock
)paren
suffix:semicolon
)brace
multiline_comment|/* This must run under aarp_lock. */
DECL|function|__aarp_proxy_find
r_static
r_struct
id|atalk_addr
op_star
id|__aarp_proxy_find
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|atalk_addr
op_star
id|sa
)paren
(brace
r_int
id|hash
op_assign
id|sa-&gt;s_node
op_mod
(paren
id|AARP_HASH_SIZE
op_minus
l_int|1
)paren
suffix:semicolon
r_struct
id|aarp_entry
op_star
id|a
op_assign
id|__aarp_find_entry
c_func
(paren
id|proxies
(braket
id|hash
)braket
comma
id|dev
comma
id|sa
)paren
suffix:semicolon
r_return
id|a
ques
c_cond
id|sa
suffix:colon
l_int|NULL
suffix:semicolon
)brace
multiline_comment|/*&n; * Probe a Phase 1 device or a device that requires its Net:Node to&n; * be set via an ioctl.&n; */
DECL|function|aarp_send_probe_phase1
r_void
id|aarp_send_probe_phase1
c_func
(paren
r_struct
id|atalk_iface
op_star
id|iface
)paren
(brace
r_struct
id|ifreq
id|atreq
suffix:semicolon
r_struct
id|sockaddr_at
op_star
id|sa
op_assign
(paren
r_struct
id|sockaddr_at
op_star
)paren
op_amp
id|atreq.ifr_addr
suffix:semicolon
id|sa-&gt;sat_addr.s_node
op_assign
id|iface-&gt;address.s_node
suffix:semicolon
id|sa-&gt;sat_addr.s_net
op_assign
id|ntohs
c_func
(paren
id|iface-&gt;address.s_net
)paren
suffix:semicolon
multiline_comment|/* We pass the Net:Node to the drivers/cards by a Device ioctl. */
r_if
c_cond
(paren
op_logical_neg
(paren
id|iface-&gt;dev
op_member_access_from_pointer
id|do_ioctl
c_func
(paren
id|iface-&gt;dev
comma
op_amp
id|atreq
comma
id|SIOCSIFADDR
)paren
)paren
)paren
(brace
(paren
r_void
)paren
id|iface-&gt;dev
op_member_access_from_pointer
id|do_ioctl
c_func
(paren
id|iface-&gt;dev
comma
op_amp
id|atreq
comma
id|SIOCGIFADDR
)paren
suffix:semicolon
r_if
c_cond
(paren
id|iface-&gt;address.s_net
op_ne
id|htons
c_func
(paren
id|sa-&gt;sat_addr.s_net
)paren
op_logical_or
id|iface-&gt;address.s_node
op_ne
id|sa-&gt;sat_addr.s_node
)paren
id|iface-&gt;status
op_or_assign
id|ATIF_PROBE_FAIL
suffix:semicolon
id|iface-&gt;address.s_net
op_assign
id|htons
c_func
(paren
id|sa-&gt;sat_addr.s_net
)paren
suffix:semicolon
id|iface-&gt;address.s_node
op_assign
id|sa-&gt;sat_addr.s_node
suffix:semicolon
)brace
)brace
DECL|function|aarp_probe_network
r_void
id|aarp_probe_network
c_func
(paren
r_struct
id|atalk_iface
op_star
id|atif
)paren
(brace
r_if
c_cond
(paren
id|atif-&gt;dev-&gt;type
op_eq
id|ARPHRD_LOCALTLK
op_logical_or
id|atif-&gt;dev-&gt;type
op_eq
id|ARPHRD_PPP
)paren
id|aarp_send_probe_phase1
c_func
(paren
id|atif
)paren
suffix:semicolon
r_else
(brace
r_int
r_int
id|count
suffix:semicolon
r_for
c_loop
(paren
id|count
op_assign
l_int|0
suffix:semicolon
id|count
OL
id|AARP_RETRANSMIT_LIMIT
suffix:semicolon
id|count
op_increment
)paren
(brace
id|aarp_send_probe
c_func
(paren
id|atif-&gt;dev
comma
op_amp
id|atif-&gt;address
)paren
suffix:semicolon
multiline_comment|/* Defer 1/10th */
id|current-&gt;state
op_assign
id|TASK_INTERRUPTIBLE
suffix:semicolon
id|schedule_timeout
c_func
(paren
id|HZ
op_div
l_int|10
)paren
suffix:semicolon
r_if
c_cond
(paren
id|atif-&gt;status
op_amp
id|ATIF_PROBE_FAIL
)paren
r_break
suffix:semicolon
)brace
)brace
)brace
DECL|function|aarp_proxy_probe_network
r_int
id|aarp_proxy_probe_network
c_func
(paren
r_struct
id|atalk_iface
op_star
id|atif
comma
r_struct
id|atalk_addr
op_star
id|sa
)paren
(brace
r_int
id|hash
comma
id|retval
op_assign
op_minus
id|EPROTONOSUPPORT
suffix:semicolon
r_struct
id|aarp_entry
op_star
id|entry
suffix:semicolon
r_int
r_int
id|count
suffix:semicolon
multiline_comment|/*&n;&t; * we don&squot;t currently support LocalTalk or PPP for proxy AARP;&n;&t; * if someone wants to try and add it, have fun&n;&t; */
r_if
c_cond
(paren
id|atif-&gt;dev-&gt;type
op_eq
id|ARPHRD_LOCALTLK
op_logical_or
id|atif-&gt;dev-&gt;type
op_eq
id|ARPHRD_PPP
)paren
r_goto
id|out
suffix:semicolon
multiline_comment|/*&n;&t; * create a new AARP entry with the flags set to be published --&n;&t; * we need this one to hang around even if it&squot;s in use&n;&t; */
id|entry
op_assign
id|aarp_alloc
c_func
(paren
)paren
suffix:semicolon
id|retval
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|entry
)paren
r_goto
id|out
suffix:semicolon
id|entry-&gt;expires_at
op_assign
op_minus
l_int|1
suffix:semicolon
id|entry-&gt;status
op_assign
id|ATIF_PROBE
suffix:semicolon
id|entry-&gt;target_addr.s_node
op_assign
id|sa-&gt;s_node
suffix:semicolon
id|entry-&gt;target_addr.s_net
op_assign
id|sa-&gt;s_net
suffix:semicolon
id|entry-&gt;dev
op_assign
id|atif-&gt;dev
suffix:semicolon
id|write_lock_bh
c_func
(paren
op_amp
id|aarp_lock
)paren
suffix:semicolon
id|hash
op_assign
id|sa-&gt;s_node
op_mod
(paren
id|AARP_HASH_SIZE
op_minus
l_int|1
)paren
suffix:semicolon
id|entry-&gt;next
op_assign
id|proxies
(braket
id|hash
)braket
suffix:semicolon
id|proxies
(braket
id|hash
)braket
op_assign
id|entry
suffix:semicolon
r_for
c_loop
(paren
id|count
op_assign
l_int|0
suffix:semicolon
id|count
OL
id|AARP_RETRANSMIT_LIMIT
suffix:semicolon
id|count
op_increment
)paren
(brace
id|aarp_send_probe
c_func
(paren
id|atif-&gt;dev
comma
id|sa
)paren
suffix:semicolon
multiline_comment|/* Defer 1/10th */
id|current-&gt;state
op_assign
id|TASK_INTERRUPTIBLE
suffix:semicolon
id|write_unlock_bh
c_func
(paren
op_amp
id|aarp_lock
)paren
suffix:semicolon
id|schedule_timeout
c_func
(paren
id|HZ
op_div
l_int|10
)paren
suffix:semicolon
id|write_lock_bh
c_func
(paren
op_amp
id|aarp_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|entry-&gt;status
op_amp
id|ATIF_PROBE_FAIL
)paren
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|entry-&gt;status
op_amp
id|ATIF_PROBE_FAIL
)paren
(brace
id|entry-&gt;expires_at
op_assign
id|jiffies
op_minus
l_int|1
suffix:semicolon
multiline_comment|/* free the entry */
id|retval
op_assign
op_minus
id|EADDRINUSE
suffix:semicolon
multiline_comment|/* return network full */
)brace
r_else
(brace
multiline_comment|/* clear the probing flag */
id|entry-&gt;status
op_and_assign
op_complement
id|ATIF_PROBE
suffix:semicolon
id|retval
op_assign
l_int|1
suffix:semicolon
)brace
id|write_unlock_bh
c_func
(paren
op_amp
id|aarp_lock
)paren
suffix:semicolon
id|out
suffix:colon
r_return
id|retval
suffix:semicolon
)brace
multiline_comment|/* Send a DDP frame */
DECL|function|aarp_send_ddp
r_int
id|aarp_send_ddp
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|atalk_addr
op_star
id|sa
comma
r_void
op_star
id|hwaddr
)paren
(brace
r_static
r_char
id|ddp_eth_multicast
(braket
id|ETH_ALEN
)braket
op_assign
(brace
l_int|0x09
comma
l_int|0x00
comma
l_int|0x07
comma
l_int|0xFF
comma
l_int|0xFF
comma
l_int|0xFF
)brace
suffix:semicolon
r_int
id|hash
suffix:semicolon
r_struct
id|aarp_entry
op_star
id|a
suffix:semicolon
id|skb-&gt;nh.raw
op_assign
id|skb-&gt;data
suffix:semicolon
multiline_comment|/* Check for LocalTalk first */
r_if
c_cond
(paren
id|dev-&gt;type
op_eq
id|ARPHRD_LOCALTLK
)paren
(brace
r_struct
id|atalk_addr
op_star
id|at
op_assign
id|atalk_find_dev_addr
c_func
(paren
id|dev
)paren
suffix:semicolon
r_struct
id|ddpehdr
op_star
id|ddp
op_assign
(paren
r_struct
id|ddpehdr
op_star
)paren
id|skb-&gt;data
suffix:semicolon
r_int
id|ft
op_assign
l_int|2
suffix:semicolon
multiline_comment|/*&n;&t;&t; * Compressible ?&n;&t;&t; *&n;&t;&t; * IFF: src_net == dest_net == device_net&n;&t;&t; * (zero matches anything)&n;&t;&t; */
r_if
c_cond
(paren
(paren
op_logical_neg
id|ddp-&gt;deh_snet
op_logical_or
id|at-&gt;s_net
op_eq
id|ddp-&gt;deh_snet
)paren
op_logical_and
(paren
op_logical_neg
id|ddp-&gt;deh_dnet
op_logical_or
id|at-&gt;s_net
op_eq
id|ddp-&gt;deh_dnet
)paren
)paren
(brace
id|skb_pull
c_func
(paren
id|skb
comma
r_sizeof
(paren
op_star
id|ddp
)paren
op_minus
l_int|4
)paren
suffix:semicolon
multiline_comment|/*&n;&t;&t;&t; *&t;The upper two remaining bytes are the port&n;&t;&t;&t; *&t;numbers&t;we just happen to need. Now put the&n;&t;&t;&t; *&t;length in the lower two.&n;&t;&t;&t; */
op_star
(paren
(paren
id|__u16
op_star
)paren
id|skb-&gt;data
)paren
op_assign
id|htons
c_func
(paren
id|skb-&gt;len
)paren
suffix:semicolon
id|ft
op_assign
l_int|1
suffix:semicolon
)brace
multiline_comment|/*&n;&t;&t; * Nice and easy. No AARP type protocols occur here so we can&n;&t;&t; * just shovel it out with a 3 byte LLAP header&n;&t;&t; */
id|skb_push
c_func
(paren
id|skb
comma
l_int|3
)paren
suffix:semicolon
id|skb-&gt;data
(braket
l_int|0
)braket
op_assign
id|sa-&gt;s_node
suffix:semicolon
id|skb-&gt;data
(braket
l_int|1
)braket
op_assign
id|at-&gt;s_node
suffix:semicolon
id|skb-&gt;data
(braket
l_int|2
)braket
op_assign
id|ft
suffix:semicolon
id|skb-&gt;dev
op_assign
id|dev
suffix:semicolon
r_goto
id|sendit
suffix:semicolon
)brace
multiline_comment|/* On a PPP link we neither compress nor aarp.  */
r_if
c_cond
(paren
id|dev-&gt;type
op_eq
id|ARPHRD_PPP
)paren
(brace
id|skb-&gt;protocol
op_assign
id|htons
c_func
(paren
id|ETH_P_PPPTALK
)paren
suffix:semicolon
id|skb-&gt;dev
op_assign
id|dev
suffix:semicolon
r_goto
id|sendit
suffix:semicolon
)brace
multiline_comment|/* Non ELAP we cannot do. */
r_if
c_cond
(paren
id|dev-&gt;type
op_ne
id|ARPHRD_ETHER
)paren
r_return
op_minus
l_int|1
suffix:semicolon
id|skb-&gt;dev
op_assign
id|dev
suffix:semicolon
id|skb-&gt;protocol
op_assign
id|htons
c_func
(paren
id|ETH_P_ATALK
)paren
suffix:semicolon
id|hash
op_assign
id|sa-&gt;s_node
op_mod
(paren
id|AARP_HASH_SIZE
op_minus
l_int|1
)paren
suffix:semicolon
multiline_comment|/* Do we have a resolved entry? */
r_if
c_cond
(paren
id|sa-&gt;s_node
op_eq
id|ATADDR_BCAST
)paren
(brace
multiline_comment|/* Send it */
id|ddp_dl
op_member_access_from_pointer
id|request
c_func
(paren
id|ddp_dl
comma
id|skb
comma
id|ddp_eth_multicast
)paren
suffix:semicolon
r_goto
id|sent
suffix:semicolon
)brace
id|write_lock_bh
c_func
(paren
op_amp
id|aarp_lock
)paren
suffix:semicolon
id|a
op_assign
id|__aarp_find_entry
c_func
(paren
id|resolved
(braket
id|hash
)braket
comma
id|dev
comma
id|sa
)paren
suffix:semicolon
r_if
c_cond
(paren
id|a
)paren
(brace
multiline_comment|/* Return 1 and fill in the address */
id|a-&gt;expires_at
op_assign
id|jiffies
op_plus
(paren
id|sysctl_aarp_expiry_time
op_star
l_int|10
)paren
suffix:semicolon
id|ddp_dl
op_member_access_from_pointer
id|request
c_func
(paren
id|ddp_dl
comma
id|skb
comma
id|a-&gt;hwaddr
)paren
suffix:semicolon
id|write_unlock_bh
c_func
(paren
op_amp
id|aarp_lock
)paren
suffix:semicolon
r_goto
id|sent
suffix:semicolon
)brace
multiline_comment|/* Do we have an unresolved entry: This is the less common path */
id|a
op_assign
id|__aarp_find_entry
c_func
(paren
id|unresolved
(braket
id|hash
)braket
comma
id|dev
comma
id|sa
)paren
suffix:semicolon
r_if
c_cond
(paren
id|a
)paren
(brace
multiline_comment|/* Queue onto the unresolved queue */
id|skb_queue_tail
c_func
(paren
op_amp
id|a-&gt;packet_queue
comma
id|skb
)paren
suffix:semicolon
r_goto
id|out_unlock
suffix:semicolon
)brace
multiline_comment|/* Allocate a new entry */
id|a
op_assign
id|aarp_alloc
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|a
)paren
(brace
multiline_comment|/* Whoops slipped... good job it&squot;s an unreliable protocol 8) */
id|write_unlock_bh
c_func
(paren
op_amp
id|aarp_lock
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
multiline_comment|/* Set up the queue */
id|skb_queue_tail
c_func
(paren
op_amp
id|a-&gt;packet_queue
comma
id|skb
)paren
suffix:semicolon
id|a-&gt;expires_at
op_assign
id|jiffies
op_plus
id|sysctl_aarp_resolve_time
suffix:semicolon
id|a-&gt;dev
op_assign
id|dev
suffix:semicolon
id|a-&gt;next
op_assign
id|unresolved
(braket
id|hash
)braket
suffix:semicolon
id|a-&gt;target_addr
op_assign
op_star
id|sa
suffix:semicolon
id|a-&gt;xmit_count
op_assign
l_int|0
suffix:semicolon
id|unresolved
(braket
id|hash
)braket
op_assign
id|a
suffix:semicolon
id|unresolved_count
op_increment
suffix:semicolon
multiline_comment|/* Send an initial request for the address */
id|__aarp_send_query
c_func
(paren
id|a
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Switch to fast timer if needed (That is if this is the first&n;&t; * unresolved entry to get added)&n;&t; */
r_if
c_cond
(paren
id|unresolved_count
op_eq
l_int|1
)paren
id|mod_timer
c_func
(paren
op_amp
id|aarp_timer
comma
id|jiffies
op_plus
id|sysctl_aarp_tick_time
)paren
suffix:semicolon
multiline_comment|/* Now finally, it is safe to drop the lock. */
id|out_unlock
suffix:colon
id|write_unlock_bh
c_func
(paren
op_amp
id|aarp_lock
)paren
suffix:semicolon
multiline_comment|/* Tell the ddp layer we have taken over for this frame. */
r_return
l_int|0
suffix:semicolon
id|sendit
suffix:colon
r_if
c_cond
(paren
id|skb-&gt;sk
)paren
id|skb-&gt;priority
op_assign
id|skb-&gt;sk-&gt;sk_priority
suffix:semicolon
id|dev_queue_xmit
c_func
(paren
id|skb
)paren
suffix:semicolon
id|sent
suffix:colon
r_return
l_int|1
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;An entry in the aarp unresolved queue has become resolved. Send&n; *&t;all the frames queued under it.&n; *&n; *&t;Must run under aarp_lock.&n; */
DECL|function|__aarp_resolved
r_static
r_void
id|__aarp_resolved
c_func
(paren
r_struct
id|aarp_entry
op_star
op_star
id|list
comma
r_struct
id|aarp_entry
op_star
id|a
comma
r_int
id|hash
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_while
c_loop
(paren
op_star
id|list
)paren
r_if
c_cond
(paren
op_star
id|list
op_eq
id|a
)paren
(brace
id|unresolved_count
op_decrement
suffix:semicolon
op_star
id|list
op_assign
id|a-&gt;next
suffix:semicolon
multiline_comment|/* Move into the resolved list */
id|a-&gt;next
op_assign
id|resolved
(braket
id|hash
)braket
suffix:semicolon
id|resolved
(braket
id|hash
)braket
op_assign
id|a
suffix:semicolon
multiline_comment|/* Kick frames off */
r_while
c_loop
(paren
(paren
id|skb
op_assign
id|skb_dequeue
c_func
(paren
op_amp
id|a-&gt;packet_queue
)paren
)paren
op_ne
l_int|NULL
)paren
(brace
id|a-&gt;expires_at
op_assign
id|jiffies
op_plus
id|sysctl_aarp_expiry_time
op_star
l_int|10
suffix:semicolon
id|ddp_dl
op_member_access_from_pointer
id|request
c_func
(paren
id|ddp_dl
comma
id|skb
comma
id|a-&gt;hwaddr
)paren
suffix:semicolon
)brace
)brace
r_else
id|list
op_assign
op_amp
(paren
(paren
op_star
id|list
)paren
op_member_access_from_pointer
id|next
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;This is called by the SNAP driver whenever we see an AARP SNAP&n; *&t;frame. We currently only support Ethernet.&n; */
DECL|function|aarp_rcv
r_static
r_int
id|aarp_rcv
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|packet_type
op_star
id|pt
)paren
(brace
r_struct
id|elapaarp
op_star
id|ea
op_assign
id|aarp_hdr
c_func
(paren
id|skb
)paren
suffix:semicolon
r_int
id|hash
comma
id|ret
op_assign
l_int|0
suffix:semicolon
id|__u16
id|function
suffix:semicolon
r_struct
id|aarp_entry
op_star
id|a
suffix:semicolon
r_struct
id|atalk_addr
id|sa
comma
op_star
id|ma
comma
id|da
suffix:semicolon
r_struct
id|atalk_iface
op_star
id|ifa
suffix:semicolon
multiline_comment|/* We only do Ethernet SNAP AARP. */
r_if
c_cond
(paren
id|dev-&gt;type
op_ne
id|ARPHRD_ETHER
)paren
r_goto
id|out0
suffix:semicolon
multiline_comment|/* Frame size ok? */
r_if
c_cond
(paren
op_logical_neg
id|skb_pull
c_func
(paren
id|skb
comma
r_sizeof
(paren
op_star
id|ea
)paren
)paren
)paren
r_goto
id|out0
suffix:semicolon
id|function
op_assign
id|ntohs
c_func
(paren
id|ea-&gt;function
)paren
suffix:semicolon
multiline_comment|/* Sanity check fields. */
r_if
c_cond
(paren
id|function
template_param
id|AARP_PROBE
op_logical_or
id|ea-&gt;hw_len
op_ne
id|ETH_ALEN
op_logical_or
id|ea-&gt;pa_len
op_ne
id|AARP_PA_ALEN
op_logical_or
id|ea-&gt;pa_src_zero
op_logical_or
id|ea-&gt;pa_dst_zero
)paren
r_goto
id|out0
suffix:semicolon
multiline_comment|/* Looks good. */
id|hash
op_assign
id|ea-&gt;pa_src_node
op_mod
(paren
id|AARP_HASH_SIZE
op_minus
l_int|1
)paren
suffix:semicolon
multiline_comment|/* Build an address. */
id|sa.s_node
op_assign
id|ea-&gt;pa_src_node
suffix:semicolon
id|sa.s_net
op_assign
id|ea-&gt;pa_src_net
suffix:semicolon
multiline_comment|/* Process the packet. Check for replies of me. */
id|ifa
op_assign
id|atalk_find_dev
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ifa
)paren
r_goto
id|out1
suffix:semicolon
r_if
c_cond
(paren
id|ifa-&gt;status
op_amp
id|ATIF_PROBE
op_logical_and
id|ifa-&gt;address.s_node
op_eq
id|ea-&gt;pa_dst_node
op_logical_and
id|ifa-&gt;address.s_net
op_eq
id|ea-&gt;pa_dst_net
)paren
(brace
id|ifa-&gt;status
op_or_assign
id|ATIF_PROBE_FAIL
suffix:semicolon
multiline_comment|/* Fail the probe (in use) */
r_goto
id|out1
suffix:semicolon
)brace
multiline_comment|/* Check for replies of proxy AARP entries */
id|da.s_node
op_assign
id|ea-&gt;pa_dst_node
suffix:semicolon
id|da.s_net
op_assign
id|ea-&gt;pa_dst_net
suffix:semicolon
id|write_lock_bh
c_func
(paren
op_amp
id|aarp_lock
)paren
suffix:semicolon
id|a
op_assign
id|__aarp_find_entry
c_func
(paren
id|proxies
(braket
id|hash
)braket
comma
id|dev
comma
op_amp
id|da
)paren
suffix:semicolon
r_if
c_cond
(paren
id|a
op_logical_and
id|a-&gt;status
op_amp
id|ATIF_PROBE
)paren
(brace
id|a-&gt;status
op_or_assign
id|ATIF_PROBE_FAIL
suffix:semicolon
multiline_comment|/*&n;&t;&t; * we do not respond to probe or request packets for&n;&t;&t; * this address while we are probing this address&n;&t;&t; */
r_goto
id|unlock
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|function
)paren
(brace
r_case
id|AARP_REPLY
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|unresolved_count
)paren
multiline_comment|/* Speed up */
r_break
suffix:semicolon
multiline_comment|/* Find the entry.  */
id|a
op_assign
id|__aarp_find_entry
c_func
(paren
id|unresolved
(braket
id|hash
)braket
comma
id|dev
comma
op_amp
id|sa
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|a
op_logical_or
id|dev
op_ne
id|a-&gt;dev
)paren
r_break
suffix:semicolon
multiline_comment|/* We can fill one in - this is good. */
id|memcpy
c_func
(paren
id|a-&gt;hwaddr
comma
id|ea-&gt;hw_src
comma
id|ETH_ALEN
)paren
suffix:semicolon
id|__aarp_resolved
c_func
(paren
op_amp
id|unresolved
(braket
id|hash
)braket
comma
id|a
comma
id|hash
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|unresolved_count
)paren
id|mod_timer
c_func
(paren
op_amp
id|aarp_timer
comma
id|jiffies
op_plus
id|sysctl_aarp_expiry_time
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AARP_REQUEST
suffix:colon
r_case
id|AARP_PROBE
suffix:colon
multiline_comment|/*&n;&t;&t;&t; * If it is my address set ma to my address and reply.&n;&t;&t;&t; * We can treat probe and request the same.  Probe&n;&t;&t;&t; * simply means we shouldn&squot;t cache the querying host,&n;&t;&t;&t; * as in a probe they are proposing an address not&n;&t;&t;&t; * using one.&n;&t;&t;&t; *&n;&t;&t;&t; * Support for proxy-AARP added. We check if the&n;&t;&t;&t; * address is one of our proxies before we toss the&n;&t;&t;&t; * packet out.&n;&t;&t;&t; */
id|sa.s_node
op_assign
id|ea-&gt;pa_dst_node
suffix:semicolon
id|sa.s_net
op_assign
id|ea-&gt;pa_dst_net
suffix:semicolon
multiline_comment|/* See if we have a matching proxy. */
id|ma
op_assign
id|__aarp_proxy_find
c_func
(paren
id|dev
comma
op_amp
id|sa
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ma
)paren
id|ma
op_assign
op_amp
id|ifa-&gt;address
suffix:semicolon
r_else
(brace
multiline_comment|/* We need to make a copy of the entry. */
id|da.s_node
op_assign
id|sa.s_node
suffix:semicolon
id|da.s_net
op_assign
id|da.s_net
suffix:semicolon
id|ma
op_assign
op_amp
id|da
suffix:semicolon
)brace
r_if
c_cond
(paren
id|function
op_eq
id|AARP_PROBE
)paren
(brace
multiline_comment|/*&n;&t;&t;&t;&t; * A probe implies someone trying to get an&n;&t;&t;&t;&t; * address. So as a precaution flush any&n;&t;&t;&t;&t; * entries we have for this address.&n;&t;&t;&t;&t; */
r_struct
id|aarp_entry
op_star
id|a
suffix:semicolon
id|a
op_assign
id|__aarp_find_entry
c_func
(paren
id|resolved
(braket
id|sa.s_node
op_mod
(paren
id|AARP_HASH_SIZE
op_minus
l_int|1
)paren
)braket
comma
id|skb-&gt;dev
comma
op_amp
id|sa
)paren
suffix:semicolon
multiline_comment|/*&n;&t;&t;&t;&t; * Make it expire next tick - that avoids us&n;&t;&t;&t;&t; * getting into a probe/flush/learn/probe/&n;&t;&t;&t;&t; * flush/learn cycle during probing of a slow&n;&t;&t;&t;&t; * to respond host addr.&n;&t;&t;&t;&t; */
r_if
c_cond
(paren
id|a
)paren
(brace
id|a-&gt;expires_at
op_assign
id|jiffies
op_minus
l_int|1
suffix:semicolon
id|mod_timer
c_func
(paren
op_amp
id|aarp_timer
comma
id|jiffies
op_plus
id|sysctl_aarp_tick_time
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|sa.s_node
op_ne
id|ma-&gt;s_node
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|sa.s_net
op_logical_and
id|ma-&gt;s_net
op_logical_and
id|sa.s_net
op_ne
id|ma-&gt;s_net
)paren
r_break
suffix:semicolon
id|sa.s_node
op_assign
id|ea-&gt;pa_src_node
suffix:semicolon
id|sa.s_net
op_assign
id|ea-&gt;pa_src_net
suffix:semicolon
multiline_comment|/* aarp_my_address has found the address to use for us.&n;&t;&t;&t;*/
id|aarp_send_reply
c_func
(paren
id|dev
comma
id|ma
comma
op_amp
id|sa
comma
id|ea-&gt;hw_src
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|unlock
suffix:colon
id|write_unlock_bh
c_func
(paren
op_amp
id|aarp_lock
)paren
suffix:semicolon
id|out1
suffix:colon
id|ret
op_assign
l_int|1
suffix:semicolon
id|out0
suffix:colon
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|variable|aarp_notifier
r_static
r_struct
id|notifier_block
id|aarp_notifier
op_assign
(brace
dot
id|notifier_call
op_assign
id|aarp_device_event
comma
)brace
suffix:semicolon
DECL|variable|aarp_snap_id
r_static
r_int
r_char
id|aarp_snap_id
(braket
)braket
op_assign
(brace
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x80
comma
l_int|0xF3
)brace
suffix:semicolon
DECL|function|aarp_proto_init
r_void
id|__init
id|aarp_proto_init
c_func
(paren
r_void
)paren
(brace
id|aarp_dl
op_assign
id|register_snap_client
c_func
(paren
id|aarp_snap_id
comma
id|aarp_rcv
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|aarp_dl
)paren
id|printk
c_func
(paren
id|KERN_CRIT
l_string|&quot;Unable to register AARP with SNAP.&bslash;n&quot;
)paren
suffix:semicolon
id|init_timer
c_func
(paren
op_amp
id|aarp_timer
)paren
suffix:semicolon
id|aarp_timer.function
op_assign
id|aarp_expire_timeout
suffix:semicolon
id|aarp_timer.data
op_assign
l_int|0
suffix:semicolon
id|aarp_timer.expires
op_assign
id|jiffies
op_plus
id|sysctl_aarp_expiry_time
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|aarp_timer
)paren
suffix:semicolon
id|register_netdevice_notifier
c_func
(paren
op_amp
id|aarp_notifier
)paren
suffix:semicolon
)brace
multiline_comment|/* Remove the AARP entries associated with a device. */
DECL|function|aarp_device_down
r_void
id|aarp_device_down
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_int
id|ct
suffix:semicolon
id|write_lock_bh
c_func
(paren
op_amp
id|aarp_lock
)paren
suffix:semicolon
r_for
c_loop
(paren
id|ct
op_assign
l_int|0
suffix:semicolon
id|ct
OL
id|AARP_HASH_SIZE
suffix:semicolon
id|ct
op_increment
)paren
(brace
id|__aarp_expire_device
c_func
(paren
op_amp
id|resolved
(braket
id|ct
)braket
comma
id|dev
)paren
suffix:semicolon
id|__aarp_expire_device
c_func
(paren
op_amp
id|unresolved
(braket
id|ct
)braket
comma
id|dev
)paren
suffix:semicolon
id|__aarp_expire_device
c_func
(paren
op_amp
id|proxies
(braket
id|ct
)braket
comma
id|dev
)paren
suffix:semicolon
)brace
id|write_unlock_bh
c_func
(paren
op_amp
id|aarp_lock
)paren
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_PROC_FS
DECL|struct|aarp_iter_state
r_struct
id|aarp_iter_state
(brace
DECL|member|bucket
r_int
id|bucket
suffix:semicolon
DECL|member|table
r_struct
id|aarp_entry
op_star
op_star
id|table
suffix:semicolon
)brace
suffix:semicolon
multiline_comment|/*&n; * Get the aarp entry that is in the chain described&n; * by the iterator. &n; * If pos is set then skip till that index.&n; * pos = 1 is the first entry&n; */
DECL|function|iter_next
r_static
r_struct
id|aarp_entry
op_star
id|iter_next
c_func
(paren
r_struct
id|aarp_iter_state
op_star
id|iter
comma
id|loff_t
op_star
id|pos
)paren
(brace
r_int
id|ct
op_assign
id|iter-&gt;bucket
suffix:semicolon
r_struct
id|aarp_entry
op_star
op_star
id|table
op_assign
id|iter-&gt;table
suffix:semicolon
id|loff_t
id|off
op_assign
l_int|0
suffix:semicolon
r_struct
id|aarp_entry
op_star
id|entry
suffix:semicolon
id|rescan
suffix:colon
r_while
c_loop
(paren
id|ct
OL
id|AARP_HASH_SIZE
)paren
(brace
r_for
c_loop
(paren
id|entry
op_assign
id|table
(braket
id|ct
)braket
suffix:semicolon
id|entry
suffix:semicolon
id|entry
op_assign
id|entry-&gt;next
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|pos
op_logical_or
op_increment
id|off
op_eq
op_star
id|pos
)paren
(brace
id|iter-&gt;table
op_assign
id|table
suffix:semicolon
id|iter-&gt;bucket
op_assign
id|ct
suffix:semicolon
r_return
id|entry
suffix:semicolon
)brace
)brace
op_increment
id|ct
suffix:semicolon
)brace
r_if
c_cond
(paren
id|table
op_eq
id|resolved
)paren
(brace
id|ct
op_assign
l_int|0
suffix:semicolon
id|table
op_assign
id|unresolved
suffix:semicolon
r_goto
id|rescan
suffix:semicolon
)brace
r_if
c_cond
(paren
id|table
op_eq
id|unresolved
)paren
(brace
id|ct
op_assign
l_int|0
suffix:semicolon
id|table
op_assign
id|proxies
suffix:semicolon
r_goto
id|rescan
suffix:semicolon
)brace
r_return
l_int|NULL
suffix:semicolon
)brace
DECL|function|aarp_seq_start
r_static
r_void
op_star
id|aarp_seq_start
c_func
(paren
r_struct
id|seq_file
op_star
id|seq
comma
id|loff_t
op_star
id|pos
)paren
(brace
r_struct
id|aarp_iter_state
op_star
id|iter
op_assign
id|seq
op_member_access_from_pointer
r_private
suffix:semicolon
id|read_lock_bh
c_func
(paren
op_amp
id|aarp_lock
)paren
suffix:semicolon
id|iter-&gt;table
op_assign
id|resolved
suffix:semicolon
id|iter-&gt;bucket
op_assign
l_int|0
suffix:semicolon
r_return
op_star
id|pos
ques
c_cond
id|iter_next
c_func
(paren
id|iter
comma
id|pos
)paren
suffix:colon
(paren
(paren
r_void
op_star
)paren
l_int|1
)paren
suffix:semicolon
)brace
DECL|function|aarp_seq_next
r_static
r_void
op_star
id|aarp_seq_next
c_func
(paren
r_struct
id|seq_file
op_star
id|seq
comma
r_void
op_star
id|v
comma
id|loff_t
op_star
id|pos
)paren
(brace
r_struct
id|aarp_entry
op_star
id|entry
op_assign
id|v
suffix:semicolon
r_struct
id|aarp_iter_state
op_star
id|iter
op_assign
id|seq
op_member_access_from_pointer
r_private
suffix:semicolon
op_increment
op_star
id|pos
suffix:semicolon
multiline_comment|/* first line after header */
r_if
c_cond
(paren
id|v
op_eq
(paren
(paren
r_void
op_star
)paren
l_int|1
)paren
)paren
id|entry
op_assign
id|iter_next
c_func
(paren
id|iter
comma
l_int|NULL
)paren
suffix:semicolon
multiline_comment|/* next entry in current bucket */
r_else
r_if
c_cond
(paren
id|entry-&gt;next
)paren
id|entry
op_assign
id|entry-&gt;next
suffix:semicolon
multiline_comment|/* next bucket or table */
r_else
(brace
op_increment
id|iter-&gt;bucket
suffix:semicolon
id|entry
op_assign
id|iter_next
c_func
(paren
id|iter
comma
l_int|NULL
)paren
suffix:semicolon
)brace
r_return
id|entry
suffix:semicolon
)brace
DECL|function|aarp_seq_stop
r_static
r_void
id|aarp_seq_stop
c_func
(paren
r_struct
id|seq_file
op_star
id|seq
comma
r_void
op_star
id|v
)paren
(brace
id|read_unlock_bh
c_func
(paren
op_amp
id|aarp_lock
)paren
suffix:semicolon
)brace
DECL|function|dt2str
r_static
r_const
r_char
op_star
id|dt2str
c_func
(paren
r_int
r_int
id|ticks
)paren
(brace
r_static
r_char
id|buf
(braket
l_int|32
)braket
suffix:semicolon
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%ld.%02ld&quot;
comma
id|ticks
op_div
id|HZ
comma
(paren
(paren
id|ticks
op_mod
id|HZ
)paren
op_star
l_int|100
)paren
op_div
id|HZ
)paren
suffix:semicolon
r_return
id|buf
suffix:semicolon
)brace
DECL|function|aarp_seq_show
r_static
r_int
id|aarp_seq_show
c_func
(paren
r_struct
id|seq_file
op_star
id|seq
comma
r_void
op_star
id|v
)paren
(brace
r_struct
id|aarp_iter_state
op_star
id|iter
op_assign
id|seq
op_member_access_from_pointer
r_private
suffix:semicolon
r_struct
id|aarp_entry
op_star
id|entry
op_assign
id|v
suffix:semicolon
r_int
r_int
id|now
op_assign
id|jiffies
suffix:semicolon
r_if
c_cond
(paren
id|v
op_eq
(paren
(paren
r_void
op_star
)paren
l_int|1
)paren
)paren
id|seq_puts
c_func
(paren
id|seq
comma
l_string|&quot;Address  Interface   Hardware Address&quot;
l_string|&quot;   Expires LastSend  Retry Status&bslash;n&quot;
)paren
suffix:semicolon
r_else
(brace
id|seq_printf
c_func
(paren
id|seq
comma
l_string|&quot;%04X:%02X  %-12s&quot;
comma
id|ntohs
c_func
(paren
id|entry-&gt;target_addr.s_net
)paren
comma
(paren
r_int
r_int
)paren
id|entry-&gt;target_addr.s_node
comma
id|entry-&gt;dev
ques
c_cond
id|entry-&gt;dev-&gt;name
suffix:colon
l_string|&quot;????&quot;
)paren
suffix:semicolon
id|seq_printf
c_func
(paren
id|seq
comma
l_string|&quot;%02X:%02X:%02X:%02X:%02X:%02X&quot;
comma
id|entry-&gt;hwaddr
(braket
l_int|0
)braket
op_amp
l_int|0xFF
comma
id|entry-&gt;hwaddr
(braket
l_int|1
)braket
op_amp
l_int|0xFF
comma
id|entry-&gt;hwaddr
(braket
l_int|2
)braket
op_amp
l_int|0xFF
comma
id|entry-&gt;hwaddr
(braket
l_int|3
)braket
op_amp
l_int|0xFF
comma
id|entry-&gt;hwaddr
(braket
l_int|4
)braket
op_amp
l_int|0xFF
comma
id|entry-&gt;hwaddr
(braket
l_int|5
)braket
op_amp
l_int|0xFF
)paren
suffix:semicolon
id|seq_printf
c_func
(paren
id|seq
comma
l_string|&quot; %8s&quot;
comma
id|dt2str
c_func
(paren
(paren
r_int
)paren
id|entry-&gt;expires_at
op_minus
(paren
r_int
)paren
id|now
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|iter-&gt;table
op_eq
id|unresolved
)paren
id|seq_printf
c_func
(paren
id|seq
comma
l_string|&quot; %8s %6hu&quot;
comma
id|dt2str
c_func
(paren
id|now
op_minus
id|entry-&gt;last_sent
)paren
comma
id|entry-&gt;xmit_count
)paren
suffix:semicolon
r_else
id|seq_puts
c_func
(paren
id|seq
comma
l_string|&quot;                &quot;
)paren
suffix:semicolon
id|seq_printf
c_func
(paren
id|seq
comma
l_string|&quot; %s&bslash;n&quot;
comma
(paren
id|iter-&gt;table
op_eq
id|resolved
)paren
ques
c_cond
l_string|&quot;resolved&quot;
suffix:colon
(paren
id|iter-&gt;table
op_eq
id|unresolved
)paren
ques
c_cond
l_string|&quot;unresolved&quot;
suffix:colon
(paren
id|iter-&gt;table
op_eq
id|proxies
)paren
ques
c_cond
l_string|&quot;proxies&quot;
suffix:colon
l_string|&quot;unknown&quot;
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|aarp_seq_ops
r_static
r_struct
id|seq_operations
id|aarp_seq_ops
op_assign
(brace
dot
id|start
op_assign
id|aarp_seq_start
comma
dot
id|next
op_assign
id|aarp_seq_next
comma
dot
id|stop
op_assign
id|aarp_seq_stop
comma
dot
id|show
op_assign
id|aarp_seq_show
comma
)brace
suffix:semicolon
DECL|function|aarp_seq_open
r_static
r_int
id|aarp_seq_open
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
(brace
r_struct
id|seq_file
op_star
id|seq
suffix:semicolon
r_int
id|rc
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_struct
id|aarp_iter_state
op_star
id|s
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|s
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|s
)paren
r_goto
id|out
suffix:semicolon
id|rc
op_assign
id|seq_open
c_func
(paren
id|file
comma
op_amp
id|aarp_seq_ops
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_goto
id|out_kfree
suffix:semicolon
id|seq
op_assign
id|file-&gt;private_data
suffix:semicolon
id|seq
op_member_access_from_pointer
r_private
op_assign
id|s
suffix:semicolon
id|memset
c_func
(paren
id|s
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|s
)paren
)paren
suffix:semicolon
id|out
suffix:colon
r_return
id|rc
suffix:semicolon
id|out_kfree
suffix:colon
id|kfree
c_func
(paren
id|s
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
DECL|variable|atalk_seq_arp_fops
r_struct
id|file_operations
id|atalk_seq_arp_fops
op_assign
(brace
dot
id|owner
op_assign
id|THIS_MODULE
comma
dot
id|open
op_assign
id|aarp_seq_open
comma
dot
id|read
op_assign
id|seq_read
comma
dot
id|llseek
op_assign
id|seq_lseek
comma
dot
id|release
op_assign
id|seq_release_private
comma
)brace
suffix:semicolon
macro_line|#endif
multiline_comment|/* General module cleanup. Called from cleanup_module() in ddp.c. */
DECL|function|aarp_cleanup_module
r_void
id|aarp_cleanup_module
c_func
(paren
r_void
)paren
(brace
id|del_timer_sync
c_func
(paren
op_amp
id|aarp_timer
)paren
suffix:semicolon
id|unregister_netdevice_notifier
c_func
(paren
op_amp
id|aarp_notifier
)paren
suffix:semicolon
id|unregister_snap_client
c_func
(paren
id|aarp_dl
)paren
suffix:semicolon
id|aarp_purge
c_func
(paren
)paren
suffix:semicolon
)brace
eof
