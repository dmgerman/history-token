multiline_comment|/*&n; *&t;NET3:&t;Support for 802.2 demultiplexing off Ethernet (Token ring&n; *&t;&t;is kept separate see p8022tr.c)&n; *&t;&t;This program is free software; you can redistribute it and/or&n; *&t;&t;modify it under the terms of the GNU General Public License&n; *&t;&t;as published by the Free Software Foundation; either version&n; *&t;&t;2 of the License, or (at your option) any later version.&n; *&n; *&t;&t;Demultiplex 802.2 encoded protocols. We match the entry by the&n; *&t;&t;SSAP/DSAP pair and then deliver to the registered datalink that&n; *&t;&t;matches. The control byte is ignored and handling of such items&n; *&t;&t;is up to the routine passed the frame.&n; *&n; *&t;&t;Unlike the 802.3 datalink we have a list of 802.2 entries as&n; *&t;&t;there are multiple protocols to demux. The list is currently&n; *&t;&t;short (3 or 4 entries at most). The current demux assumes this.&n; */
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/netdevice.h&gt;
macro_line|#include &lt;linux/skbuff.h&gt;
macro_line|#include &lt;net/datalink.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/in.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;net/p8022.h&gt;
macro_line|#include &lt;net/llc_sap.h&gt;
DECL|function|p8022_request
r_static
r_int
id|p8022_request
c_func
(paren
r_struct
id|datalink_proto
op_star
id|dl
comma
r_struct
id|sk_buff
op_star
id|skb
comma
r_int
r_char
op_star
id|dest
)paren
(brace
r_union
id|llc_u_prim_data
id|prim_data
suffix:semicolon
r_struct
id|llc_prim_if_block
id|prim
suffix:semicolon
id|prim.data
op_assign
op_amp
id|prim_data
suffix:semicolon
id|prim.sap
op_assign
id|dl-&gt;sap
suffix:semicolon
id|prim.prim
op_assign
id|LLC_DATAUNIT_PRIM
suffix:semicolon
id|prim_data.test.skb
op_assign
id|skb
suffix:semicolon
id|prim_data.test.saddr.lsap
op_assign
id|dl-&gt;sap-&gt;laddr.lsap
suffix:semicolon
id|prim_data.test.daddr.lsap
op_assign
id|dl-&gt;sap-&gt;laddr.lsap
suffix:semicolon
id|memcpy
c_func
(paren
id|prim_data.test.saddr.mac
comma
id|skb-&gt;dev-&gt;dev_addr
comma
id|IFHWADDRLEN
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|prim_data.test.daddr.mac
comma
id|dest
comma
id|IFHWADDRLEN
)paren
suffix:semicolon
r_return
id|dl-&gt;sap
op_member_access_from_pointer
id|req
c_func
(paren
op_amp
id|prim
)paren
suffix:semicolon
)brace
DECL|function|register_8022_client
r_struct
id|datalink_proto
op_star
id|register_8022_client
c_func
(paren
r_int
r_char
id|type
comma
r_int
(paren
op_star
id|indicate
)paren
(paren
r_struct
id|llc_prim_if_block
op_star
id|prim
)paren
)paren
(brace
r_struct
id|datalink_proto
op_star
id|proto
suffix:semicolon
id|proto
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|proto
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|proto
)paren
(brace
id|proto-&gt;type
(braket
l_int|0
)braket
op_assign
id|type
suffix:semicolon
id|proto-&gt;header_length
op_assign
l_int|3
suffix:semicolon
id|proto-&gt;request
op_assign
id|p8022_request
suffix:semicolon
id|proto-&gt;sap
op_assign
id|llc_sap_open
c_func
(paren
id|indicate
comma
l_int|NULL
comma
id|type
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|proto-&gt;sap
)paren
(brace
id|kfree
c_func
(paren
id|proto
)paren
suffix:semicolon
id|proto
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
r_return
id|proto
suffix:semicolon
)brace
DECL|function|unregister_8022_client
r_void
id|unregister_8022_client
c_func
(paren
r_struct
id|datalink_proto
op_star
id|proto
)paren
(brace
id|llc_sap_close
c_func
(paren
id|proto-&gt;sap
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|proto
)paren
suffix:semicolon
)brace
DECL|variable|register_8022_client
id|EXPORT_SYMBOL
c_func
(paren
id|register_8022_client
)paren
suffix:semicolon
DECL|variable|unregister_8022_client
id|EXPORT_SYMBOL
c_func
(paren
id|unregister_8022_client
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
eof
