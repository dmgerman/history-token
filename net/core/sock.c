multiline_comment|/*&n; * INET&t;&t;An implementation of the TCP/IP protocol suite for the LINUX&n; *&t;&t;operating system.  INET is implemented using the  BSD Socket&n; *&t;&t;interface as the means of communication with the user level.&n; *&n; *&t;&t;Generic socket support routines. Memory allocators, socket lock/release&n; *&t;&t;handler for protocols to use and generic option handler.&n; *&n; *&n; * Version:&t;$Id: sock.c,v 1.117 2002/02/01 22:01:03 davem Exp $&n; *&n; * Authors:&t;Ross Biro, &lt;bir7@leland.Stanford.Edu&gt;&n; *&t;&t;Fred N. van Kempen, &lt;waltje@uWalt.NL.Mugnet.ORG&gt;&n; *&t;&t;Florian La Roche, &lt;flla@stud.uni-sb.de&gt;&n; *&t;&t;Alan Cox, &lt;A.Cox@swansea.ac.uk&gt;&n; *&n; * Fixes:&n; *&t;&t;Alan Cox&t;: &t;Numerous verify_area() problems&n; *&t;&t;Alan Cox&t;:&t;Connecting on a connecting socket&n; *&t;&t;&t;&t;&t;now returns an error for tcp.&n; *&t;&t;Alan Cox&t;:&t;sock-&gt;protocol is set correctly.&n; *&t;&t;&t;&t;&t;and is not sometimes left as 0.&n; *&t;&t;Alan Cox&t;:&t;connect handles icmp errors on a&n; *&t;&t;&t;&t;&t;connect properly. Unfortunately there&n; *&t;&t;&t;&t;&t;is a restart syscall nasty there. I&n; *&t;&t;&t;&t;&t;can&squot;t match BSD without hacking the C&n; *&t;&t;&t;&t;&t;library. Ideas urgently sought!&n; *&t;&t;Alan Cox&t;:&t;Disallow bind() to addresses that are&n; *&t;&t;&t;&t;&t;not ours - especially broadcast ones!!&n; *&t;&t;Alan Cox&t;:&t;Socket 1024 _IS_ ok for users. (fencepost)&n; *&t;&t;Alan Cox&t;:&t;sock_wfree/sock_rfree don&squot;t destroy sockets,&n; *&t;&t;&t;&t;&t;instead they leave that for the DESTROY timer.&n; *&t;&t;Alan Cox&t;:&t;Clean up error flag in accept&n; *&t;&t;Alan Cox&t;:&t;TCP ack handling is buggy, the DESTROY timer&n; *&t;&t;&t;&t;&t;was buggy. Put a remove_sock() in the handler&n; *&t;&t;&t;&t;&t;for memory when we hit 0. Also altered the timer&n; *&t;&t;&t;&t;&t;code. The ACK stuff can wait and needs major &n; *&t;&t;&t;&t;&t;TCP layer surgery.&n; *&t;&t;Alan Cox&t;:&t;Fixed TCP ack bug, removed remove sock&n; *&t;&t;&t;&t;&t;and fixed timer/inet_bh race.&n; *&t;&t;Alan Cox&t;:&t;Added zapped flag for TCP&n; *&t;&t;Alan Cox&t;:&t;Move kfree_skb into skbuff.c and tidied up surplus code&n; *&t;&t;Alan Cox&t;:&t;for new sk_buff allocations wmalloc/rmalloc now call alloc_skb&n; *&t;&t;Alan Cox&t;:&t;kfree_s calls now are kfree_skbmem so we can track skb resources&n; *&t;&t;Alan Cox&t;:&t;Supports socket option broadcast now as does udp. Packet and raw need fixing.&n; *&t;&t;Alan Cox&t;:&t;Added RCVBUF,SNDBUF size setting. It suddenly occurred to me how easy it was so...&n; *&t;&t;Rick Sladkey&t;:&t;Relaxed UDP rules for matching packets.&n; *&t;&t;C.E.Hawkins&t;:&t;IFF_PROMISC/SIOCGHWADDR support&n; *&t;Pauline Middelink&t;:&t;identd support&n; *&t;&t;Alan Cox&t;:&t;Fixed connect() taking signals I think.&n; *&t;&t;Alan Cox&t;:&t;SO_LINGER supported&n; *&t;&t;Alan Cox&t;:&t;Error reporting fixes&n; *&t;&t;Anonymous&t;:&t;inet_create tidied up (sk-&gt;reuse setting)&n; *&t;&t;Alan Cox&t;:&t;inet sockets don&squot;t set sk-&gt;type!&n; *&t;&t;Alan Cox&t;:&t;Split socket option code&n; *&t;&t;Alan Cox&t;:&t;Callbacks&n; *&t;&t;Alan Cox&t;:&t;Nagle flag for Charles &amp; Johannes stuff&n; *&t;&t;Alex&t;&t;:&t;Removed restriction on inet fioctl&n; *&t;&t;Alan Cox&t;:&t;Splitting INET from NET core&n; *&t;&t;Alan Cox&t;:&t;Fixed bogus SO_TYPE handling in getsockopt()&n; *&t;&t;Adam Caldwell&t;:&t;Missing return in SO_DONTROUTE/SO_DEBUG code&n; *&t;&t;Alan Cox&t;:&t;Split IP from generic code&n; *&t;&t;Alan Cox&t;:&t;New kfree_skbmem()&n; *&t;&t;Alan Cox&t;:&t;Make SO_DEBUG superuser only.&n; *&t;&t;Alan Cox&t;:&t;Allow anyone to clear SO_DEBUG&n; *&t;&t;&t;&t;&t;(compatibility fix)&n; *&t;&t;Alan Cox&t;:&t;Added optimistic memory grabbing for AF_UNIX throughput.&n; *&t;&t;Alan Cox&t;:&t;Allocator for a socket is settable.&n; *&t;&t;Alan Cox&t;:&t;SO_ERROR includes soft errors.&n; *&t;&t;Alan Cox&t;:&t;Allow NULL arguments on some SO_ opts&n; *&t;&t;Alan Cox&t;: &t;Generic socket allocation to make hooks&n; *&t;&t;&t;&t;&t;easier (suggested by Craig Metz).&n; *&t;&t;Michael Pall&t;:&t;SO_ERROR returns positive errno again&n; *              Steve Whitehouse:       Added default destructor to free&n; *                                      protocol private data.&n; *              Steve Whitehouse:       Added various other default routines&n; *                                      common to several socket families.&n; *              Chris Evans     :       Call suser() check last on F_SETOWN&n; *&t;&t;Jay Schulist&t;:&t;Added SO_ATTACH_FILTER and SO_DETACH_FILTER.&n; *&t;&t;Andi Kleen&t;:&t;Add sock_kmalloc()/sock_kfree_s()&n; *&t;&t;Andi Kleen&t;:&t;Fix write_space callback&n; *&t;&t;Chris Evans&t;:&t;Security fixes - signedness again&n; *&t;&t;Arnaldo C. Melo :       cleanups, use skb_queue_purge&n; *&n; * To Fix:&n; *&n; *&n; *&t;&t;This program is free software; you can redistribute it and/or&n; *&t;&t;modify it under the terms of the GNU General Public License&n; *&t;&t;as published by the Free Software Foundation; either version&n; *&t;&t;2 of the License, or (at your option) any later version.&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/socket.h&gt;
macro_line|#include &lt;linux/in.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/major.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/timer.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/sockios.h&gt;
macro_line|#include &lt;linux/net.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/poll.h&gt;
macro_line|#include &lt;linux/tcp.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;asm/system.h&gt;
macro_line|#include &lt;linux/netdevice.h&gt;
macro_line|#include &lt;net/protocol.h&gt;
macro_line|#include &lt;linux/skbuff.h&gt;
macro_line|#include &lt;net/sock.h&gt;
macro_line|#include &lt;net/xfrm.h&gt;
macro_line|#include &lt;linux/ipsec.h&gt;
macro_line|#include &lt;linux/filter.h&gt;
macro_line|#ifdef CONFIG_INET
macro_line|#include &lt;net/tcp.h&gt;
macro_line|#endif
multiline_comment|/* Take into consideration the size of the struct sk_buff overhead in the&n; * determination of these values, since that is non-constant across&n; * platforms.  This makes socket queueing behavior and performance&n; * not depend upon such differences.&n; */
DECL|macro|_SK_MEM_PACKETS
mdefine_line|#define _SK_MEM_PACKETS&t;&t;256
DECL|macro|_SK_MEM_OVERHEAD
mdefine_line|#define _SK_MEM_OVERHEAD&t;(sizeof(struct sk_buff) + 256)
DECL|macro|SK_WMEM_MAX
mdefine_line|#define SK_WMEM_MAX&t;&t;(_SK_MEM_OVERHEAD * _SK_MEM_PACKETS)
DECL|macro|SK_RMEM_MAX
mdefine_line|#define SK_RMEM_MAX&t;&t;(_SK_MEM_OVERHEAD * _SK_MEM_PACKETS)
multiline_comment|/* Run time adjustable parameters. */
DECL|variable|sysctl_wmem_max
id|__u32
id|sysctl_wmem_max
op_assign
id|SK_WMEM_MAX
suffix:semicolon
DECL|variable|sysctl_rmem_max
id|__u32
id|sysctl_rmem_max
op_assign
id|SK_RMEM_MAX
suffix:semicolon
DECL|variable|sysctl_wmem_default
id|__u32
id|sysctl_wmem_default
op_assign
id|SK_WMEM_MAX
suffix:semicolon
DECL|variable|sysctl_rmem_default
id|__u32
id|sysctl_rmem_default
op_assign
id|SK_RMEM_MAX
suffix:semicolon
multiline_comment|/* Maximal space eaten by iovec or ancilliary data plus some space */
DECL|variable|sysctl_optmem_max
r_int
id|sysctl_optmem_max
op_assign
r_sizeof
(paren
r_int
r_int
)paren
op_star
(paren
l_int|2
op_star
id|UIO_MAXIOV
op_plus
l_int|512
)paren
suffix:semicolon
DECL|function|sock_set_timeout
r_static
r_int
id|sock_set_timeout
c_func
(paren
r_int
op_star
id|timeo_p
comma
r_char
id|__user
op_star
id|optval
comma
r_int
id|optlen
)paren
(brace
r_struct
id|timeval
id|tv
suffix:semicolon
r_if
c_cond
(paren
id|optlen
OL
r_sizeof
(paren
id|tv
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|tv
comma
id|optval
comma
r_sizeof
(paren
id|tv
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
op_star
id|timeo_p
op_assign
id|MAX_SCHEDULE_TIMEOUT
suffix:semicolon
r_if
c_cond
(paren
id|tv.tv_sec
op_eq
l_int|0
op_logical_and
id|tv.tv_usec
op_eq
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|tv.tv_sec
OL
(paren
id|MAX_SCHEDULE_TIMEOUT
op_div
id|HZ
op_minus
l_int|1
)paren
)paren
op_star
id|timeo_p
op_assign
id|tv.tv_sec
op_star
id|HZ
op_plus
(paren
id|tv.tv_usec
op_plus
(paren
l_int|1000000
op_div
id|HZ
op_minus
l_int|1
)paren
)paren
op_div
(paren
l_int|1000000
op_div
id|HZ
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sock_warn_obsolete_bsdism
r_static
r_void
id|sock_warn_obsolete_bsdism
c_func
(paren
r_const
r_char
op_star
id|name
)paren
(brace
r_static
r_int
id|warned
suffix:semicolon
r_static
r_char
id|warncomm
(braket
l_int|16
)braket
suffix:semicolon
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|warncomm
comma
id|current-&gt;comm
)paren
op_logical_and
id|warned
OL
l_int|5
)paren
(brace
id|strcpy
c_func
(paren
id|warncomm
comma
id|current-&gt;comm
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;process `%s&squot; is using obsolete &quot;
l_string|&quot;%s SO_BSDCOMPAT&bslash;n&quot;
comma
id|warncomm
comma
id|name
)paren
suffix:semicolon
id|warned
op_increment
suffix:semicolon
)brace
)brace
DECL|function|sock_disable_timestamp
r_static
r_void
id|sock_disable_timestamp
c_func
(paren
r_struct
id|sock
op_star
id|sk
)paren
(brace
r_if
c_cond
(paren
id|sock_flag
c_func
(paren
id|sk
comma
id|SOCK_TIMESTAMP
)paren
)paren
(brace
id|sock_reset_flag
c_func
(paren
id|sk
comma
id|SOCK_TIMESTAMP
)paren
suffix:semicolon
id|net_disable_timestamp
c_func
(paren
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; *&t;This is meant for all protocols to use and covers goings on&n; *&t;at the socket level. Everything here is generic.&n; */
DECL|function|sock_setsockopt
r_int
id|sock_setsockopt
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_int
id|level
comma
r_int
id|optname
comma
r_char
id|__user
op_star
id|optval
comma
r_int
id|optlen
)paren
(brace
r_struct
id|sock
op_star
id|sk
op_assign
id|sock-&gt;sk
suffix:semicolon
r_struct
id|sk_filter
op_star
id|filter
suffix:semicolon
r_int
id|val
suffix:semicolon
r_int
id|valbool
suffix:semicolon
r_struct
id|linger
id|ling
suffix:semicolon
r_int
id|ret
op_assign
l_int|0
suffix:semicolon
multiline_comment|/*&n;&t; *&t;Options without arguments&n;&t; */
macro_line|#ifdef SO_DONTLINGER&t;&t;/* Compatibility item... */
r_switch
c_cond
(paren
id|optname
)paren
(brace
r_case
id|SO_DONTLINGER
suffix:colon
id|sock_reset_flag
c_func
(paren
id|sk
comma
id|SOCK_LINGER
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#endif&t;
r_if
c_cond
(paren
id|optlen
OL
r_sizeof
(paren
r_int
)paren
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|val
comma
(paren
r_int
id|__user
op_star
)paren
id|optval
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|valbool
op_assign
id|val
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
id|lock_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|optname
)paren
(brace
r_case
id|SO_DEBUG
suffix:colon
r_if
c_cond
(paren
id|val
op_logical_and
op_logical_neg
id|capable
c_func
(paren
id|CAP_NET_ADMIN
)paren
)paren
(brace
id|ret
op_assign
op_minus
id|EACCES
suffix:semicolon
)brace
r_else
id|sk-&gt;sk_debug
op_assign
id|valbool
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SO_REUSEADDR
suffix:colon
id|sk-&gt;sk_reuse
op_assign
id|valbool
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SO_TYPE
suffix:colon
r_case
id|SO_ERROR
suffix:colon
id|ret
op_assign
op_minus
id|ENOPROTOOPT
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SO_DONTROUTE
suffix:colon
id|sk-&gt;sk_localroute
op_assign
id|valbool
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SO_BROADCAST
suffix:colon
id|sock_valbool_flag
c_func
(paren
id|sk
comma
id|SOCK_BROADCAST
comma
id|valbool
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SO_SNDBUF
suffix:colon
multiline_comment|/* Don&squot;t error on this BSD doesn&squot;t and if you think&n;&t;&t;&t;   about it this is right. Otherwise apps have to&n;&t;&t;&t;   play &squot;guess the biggest size&squot; games. RCVBUF/SNDBUF&n;&t;&t;&t;   are treated in BSD as hints */
r_if
c_cond
(paren
id|val
OG
id|sysctl_wmem_max
)paren
id|val
op_assign
id|sysctl_wmem_max
suffix:semicolon
id|sk-&gt;sk_userlocks
op_or_assign
id|SOCK_SNDBUF_LOCK
suffix:semicolon
r_if
c_cond
(paren
(paren
id|val
op_star
l_int|2
)paren
OL
id|SOCK_MIN_SNDBUF
)paren
id|sk-&gt;sk_sndbuf
op_assign
id|SOCK_MIN_SNDBUF
suffix:semicolon
r_else
id|sk-&gt;sk_sndbuf
op_assign
id|val
op_star
l_int|2
suffix:semicolon
multiline_comment|/*&n;&t;&t;&t; *&t;Wake up sending tasks if we&n;&t;&t;&t; *&t;upped the value.&n;&t;&t;&t; */
id|sk
op_member_access_from_pointer
id|sk_write_space
c_func
(paren
id|sk
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SO_RCVBUF
suffix:colon
multiline_comment|/* Don&squot;t error on this BSD doesn&squot;t and if you think&n;&t;&t;&t;   about it this is right. Otherwise apps have to&n;&t;&t;&t;   play &squot;guess the biggest size&squot; games. RCVBUF/SNDBUF&n;&t;&t;&t;   are treated in BSD as hints */
r_if
c_cond
(paren
id|val
OG
id|sysctl_rmem_max
)paren
id|val
op_assign
id|sysctl_rmem_max
suffix:semicolon
id|sk-&gt;sk_userlocks
op_or_assign
id|SOCK_RCVBUF_LOCK
suffix:semicolon
multiline_comment|/* FIXME: is this lower bound the right one? */
r_if
c_cond
(paren
(paren
id|val
op_star
l_int|2
)paren
OL
id|SOCK_MIN_RCVBUF
)paren
id|sk-&gt;sk_rcvbuf
op_assign
id|SOCK_MIN_RCVBUF
suffix:semicolon
r_else
id|sk-&gt;sk_rcvbuf
op_assign
id|val
op_star
l_int|2
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SO_KEEPALIVE
suffix:colon
macro_line|#ifdef CONFIG_INET
r_if
c_cond
(paren
id|sk-&gt;sk_protocol
op_eq
id|IPPROTO_TCP
)paren
id|tcp_set_keepalive
c_func
(paren
id|sk
comma
id|valbool
)paren
suffix:semicolon
macro_line|#endif
id|sock_valbool_flag
c_func
(paren
id|sk
comma
id|SOCK_KEEPOPEN
comma
id|valbool
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SO_OOBINLINE
suffix:colon
id|sock_valbool_flag
c_func
(paren
id|sk
comma
id|SOCK_URGINLINE
comma
id|valbool
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SO_NO_CHECK
suffix:colon
id|sk-&gt;sk_no_check
op_assign
id|valbool
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SO_PRIORITY
suffix:colon
r_if
c_cond
(paren
(paren
id|val
op_ge
l_int|0
op_logical_and
id|val
op_le
l_int|6
)paren
op_logical_or
id|capable
c_func
(paren
id|CAP_NET_ADMIN
)paren
)paren
id|sk-&gt;sk_priority
op_assign
id|val
suffix:semicolon
r_else
id|ret
op_assign
op_minus
id|EPERM
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SO_LINGER
suffix:colon
r_if
c_cond
(paren
id|optlen
OL
r_sizeof
(paren
id|ling
)paren
)paren
(brace
id|ret
op_assign
op_minus
id|EINVAL
suffix:semicolon
multiline_comment|/* 1003.1g */
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|ling
comma
id|optval
comma
r_sizeof
(paren
id|ling
)paren
)paren
)paren
(brace
id|ret
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|ling.l_onoff
)paren
id|sock_reset_flag
c_func
(paren
id|sk
comma
id|SOCK_LINGER
)paren
suffix:semicolon
r_else
(brace
macro_line|#if (BITS_PER_LONG == 32)
r_if
c_cond
(paren
id|ling.l_linger
op_ge
id|MAX_SCHEDULE_TIMEOUT
op_div
id|HZ
)paren
id|sk-&gt;sk_lingertime
op_assign
id|MAX_SCHEDULE_TIMEOUT
suffix:semicolon
r_else
macro_line|#endif
id|sk-&gt;sk_lingertime
op_assign
id|ling.l_linger
op_star
id|HZ
suffix:semicolon
id|sock_set_flag
c_func
(paren
id|sk
comma
id|SOCK_LINGER
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|SO_BSDCOMPAT
suffix:colon
id|sock_warn_obsolete_bsdism
c_func
(paren
l_string|&quot;setsockopt&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SO_PASSCRED
suffix:colon
id|sock-&gt;passcred
op_assign
id|valbool
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SO_TIMESTAMP
suffix:colon
id|sk-&gt;sk_rcvtstamp
op_assign
id|valbool
suffix:semicolon
r_if
c_cond
(paren
id|valbool
)paren
id|sock_enable_timestamp
c_func
(paren
id|sk
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SO_RCVLOWAT
suffix:colon
r_if
c_cond
(paren
id|val
OL
l_int|0
)paren
id|val
op_assign
id|INT_MAX
suffix:semicolon
id|sk-&gt;sk_rcvlowat
op_assign
id|val
ques
c_cond
suffix:colon
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SO_RCVTIMEO
suffix:colon
id|ret
op_assign
id|sock_set_timeout
c_func
(paren
op_amp
id|sk-&gt;sk_rcvtimeo
comma
id|optval
comma
id|optlen
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SO_SNDTIMEO
suffix:colon
id|ret
op_assign
id|sock_set_timeout
c_func
(paren
op_amp
id|sk-&gt;sk_sndtimeo
comma
id|optval
comma
id|optlen
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#ifdef CONFIG_NETDEVICES
r_case
id|SO_BINDTODEVICE
suffix:colon
(brace
r_char
id|devname
(braket
id|IFNAMSIZ
)braket
suffix:semicolon
multiline_comment|/* Sorry... */
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_NET_RAW
)paren
)paren
(brace
id|ret
op_assign
op_minus
id|EPERM
suffix:semicolon
r_break
suffix:semicolon
)brace
multiline_comment|/* Bind this socket to a particular device like &quot;eth0&quot;,&n;&t;&t;&t; * as specified in the passed interface name. If the&n;&t;&t;&t; * name is &quot;&quot; or the option length is zero the socket &n;&t;&t;&t; * is not bound. &n;&t;&t;&t; */
r_if
c_cond
(paren
op_logical_neg
id|valbool
)paren
(brace
id|sk-&gt;sk_bound_dev_if
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|optlen
OG
id|IFNAMSIZ
)paren
id|optlen
op_assign
id|IFNAMSIZ
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
id|devname
comma
id|optval
comma
id|optlen
)paren
)paren
(brace
id|ret
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_break
suffix:semicolon
)brace
multiline_comment|/* Remove any cached route for this socket. */
id|sk_dst_reset
c_func
(paren
id|sk
)paren
suffix:semicolon
r_if
c_cond
(paren
id|devname
(braket
l_int|0
)braket
op_eq
l_char|&squot;&bslash;0&squot;
)paren
(brace
id|sk-&gt;sk_bound_dev_if
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
id|dev_get_by_name
c_func
(paren
id|devname
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev
)paren
(brace
id|ret
op_assign
op_minus
id|ENODEV
suffix:semicolon
r_break
suffix:semicolon
)brace
id|sk-&gt;sk_bound_dev_if
op_assign
id|dev-&gt;ifindex
suffix:semicolon
id|dev_put
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
)brace
r_break
suffix:semicolon
)brace
macro_line|#endif
r_case
id|SO_ATTACH_FILTER
suffix:colon
id|ret
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|optlen
op_eq
r_sizeof
(paren
r_struct
id|sock_fprog
)paren
)paren
(brace
r_struct
id|sock_fprog
id|fprog
suffix:semicolon
id|ret
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|fprog
comma
id|optval
comma
r_sizeof
(paren
id|fprog
)paren
)paren
)paren
r_break
suffix:semicolon
id|ret
op_assign
id|sk_attach_filter
c_func
(paren
op_amp
id|fprog
comma
id|sk
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|SO_DETACH_FILTER
suffix:colon
id|spin_lock_bh
c_func
(paren
op_amp
id|sk-&gt;sk_lock.slock
)paren
suffix:semicolon
id|filter
op_assign
id|sk-&gt;sk_filter
suffix:semicolon
r_if
c_cond
(paren
id|filter
)paren
(brace
id|sk-&gt;sk_filter
op_assign
l_int|NULL
suffix:semicolon
id|spin_unlock_bh
c_func
(paren
op_amp
id|sk-&gt;sk_lock.slock
)paren
suffix:semicolon
id|sk_filter_release
c_func
(paren
id|sk
comma
id|filter
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|spin_unlock_bh
c_func
(paren
op_amp
id|sk-&gt;sk_lock.slock
)paren
suffix:semicolon
id|ret
op_assign
op_minus
id|ENONET
suffix:semicolon
r_break
suffix:semicolon
multiline_comment|/* We implement the SO_SNDLOWAT etc to&n;&t;&t;   not be settable (1003.1g 5.3) */
r_default
suffix:colon
id|ret
op_assign
op_minus
id|ENOPROTOOPT
suffix:semicolon
r_break
suffix:semicolon
)brace
id|release_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|function|sock_getsockopt
r_int
id|sock_getsockopt
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_int
id|level
comma
r_int
id|optname
comma
r_char
id|__user
op_star
id|optval
comma
r_int
id|__user
op_star
id|optlen
)paren
(brace
r_struct
id|sock
op_star
id|sk
op_assign
id|sock-&gt;sk
suffix:semicolon
r_union
(brace
r_int
id|val
suffix:semicolon
r_struct
id|linger
id|ling
suffix:semicolon
r_struct
id|timeval
id|tm
suffix:semicolon
)brace
id|v
suffix:semicolon
r_int
r_int
id|lv
op_assign
r_sizeof
(paren
r_int
)paren
suffix:semicolon
r_int
id|len
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|len
comma
id|optlen
)paren
)paren
(brace
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
r_if
c_cond
(paren
id|len
OL
l_int|0
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|optname
)paren
(brace
r_case
id|SO_DEBUG
suffix:colon
id|v.val
op_assign
id|sk-&gt;sk_debug
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SO_DONTROUTE
suffix:colon
id|v.val
op_assign
id|sk-&gt;sk_localroute
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SO_BROADCAST
suffix:colon
id|v.val
op_assign
op_logical_neg
op_logical_neg
id|sock_flag
c_func
(paren
id|sk
comma
id|SOCK_BROADCAST
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SO_SNDBUF
suffix:colon
id|v.val
op_assign
id|sk-&gt;sk_sndbuf
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SO_RCVBUF
suffix:colon
id|v.val
op_assign
id|sk-&gt;sk_rcvbuf
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SO_REUSEADDR
suffix:colon
id|v.val
op_assign
id|sk-&gt;sk_reuse
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SO_KEEPALIVE
suffix:colon
id|v.val
op_assign
op_logical_neg
op_logical_neg
id|sock_flag
c_func
(paren
id|sk
comma
id|SOCK_KEEPOPEN
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SO_TYPE
suffix:colon
id|v.val
op_assign
id|sk-&gt;sk_type
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SO_ERROR
suffix:colon
id|v.val
op_assign
op_minus
id|sock_error
c_func
(paren
id|sk
)paren
suffix:semicolon
r_if
c_cond
(paren
id|v.val
op_eq
l_int|0
)paren
(brace
id|v.val
op_assign
id|xchg
c_func
(paren
op_amp
id|sk-&gt;sk_err_soft
comma
l_int|0
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|SO_OOBINLINE
suffix:colon
id|v.val
op_assign
op_logical_neg
op_logical_neg
id|sock_flag
c_func
(paren
id|sk
comma
id|SOCK_URGINLINE
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SO_NO_CHECK
suffix:colon
id|v.val
op_assign
id|sk-&gt;sk_no_check
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SO_PRIORITY
suffix:colon
id|v.val
op_assign
id|sk-&gt;sk_priority
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SO_LINGER
suffix:colon
id|lv
op_assign
r_sizeof
(paren
id|v.ling
)paren
suffix:semicolon
id|v.ling.l_onoff
op_assign
op_logical_neg
op_logical_neg
id|sock_flag
c_func
(paren
id|sk
comma
id|SOCK_LINGER
)paren
suffix:semicolon
id|v.ling.l_linger
op_assign
id|sk-&gt;sk_lingertime
op_div
id|HZ
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SO_BSDCOMPAT
suffix:colon
id|sock_warn_obsolete_bsdism
c_func
(paren
l_string|&quot;getsockopt&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SO_TIMESTAMP
suffix:colon
id|v.val
op_assign
id|sk-&gt;sk_rcvtstamp
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SO_RCVTIMEO
suffix:colon
id|lv
op_assign
r_sizeof
(paren
r_struct
id|timeval
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;sk_rcvtimeo
op_eq
id|MAX_SCHEDULE_TIMEOUT
)paren
(brace
id|v.tm.tv_sec
op_assign
l_int|0
suffix:semicolon
id|v.tm.tv_usec
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|v.tm.tv_sec
op_assign
id|sk-&gt;sk_rcvtimeo
op_div
id|HZ
suffix:semicolon
id|v.tm.tv_usec
op_assign
(paren
(paren
id|sk-&gt;sk_rcvtimeo
op_mod
id|HZ
)paren
op_star
l_int|1000000
)paren
op_div
id|HZ
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|SO_SNDTIMEO
suffix:colon
id|lv
op_assign
r_sizeof
(paren
r_struct
id|timeval
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;sk_sndtimeo
op_eq
id|MAX_SCHEDULE_TIMEOUT
)paren
(brace
id|v.tm.tv_sec
op_assign
l_int|0
suffix:semicolon
id|v.tm.tv_usec
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|v.tm.tv_sec
op_assign
id|sk-&gt;sk_sndtimeo
op_div
id|HZ
suffix:semicolon
id|v.tm.tv_usec
op_assign
(paren
(paren
id|sk-&gt;sk_sndtimeo
op_mod
id|HZ
)paren
op_star
l_int|1000000
)paren
op_div
id|HZ
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|SO_RCVLOWAT
suffix:colon
id|v.val
op_assign
id|sk-&gt;sk_rcvlowat
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SO_SNDLOWAT
suffix:colon
id|v.val
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SO_PASSCRED
suffix:colon
id|v.val
op_assign
id|sock-&gt;passcred
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SO_PEERCRED
suffix:colon
r_if
c_cond
(paren
id|len
OG
r_sizeof
(paren
id|sk-&gt;sk_peercred
)paren
)paren
id|len
op_assign
r_sizeof
(paren
id|sk-&gt;sk_peercred
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|optval
comma
op_amp
id|sk-&gt;sk_peercred
comma
id|len
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_goto
id|lenout
suffix:semicolon
r_case
id|SO_PEERNAME
suffix:colon
(brace
r_char
id|address
(braket
l_int|128
)braket
suffix:semicolon
r_if
c_cond
(paren
id|sock-&gt;ops
op_member_access_from_pointer
id|getname
c_func
(paren
id|sock
comma
(paren
r_struct
id|sockaddr
op_star
)paren
id|address
comma
op_amp
id|lv
comma
l_int|2
)paren
)paren
r_return
op_minus
id|ENOTCONN
suffix:semicolon
r_if
c_cond
(paren
id|lv
OL
id|len
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|optval
comma
id|address
comma
id|len
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_goto
id|lenout
suffix:semicolon
)brace
multiline_comment|/* Dubious BSD thing... Probably nobody even uses it, but&n;&t;&t; * the UNIX standard wants it for whatever reason... -DaveM&n;&t;&t; */
r_case
id|SO_ACCEPTCONN
suffix:colon
id|v.val
op_assign
id|sk-&gt;sk_state
op_eq
id|TCP_LISTEN
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SO_PEERSEC
suffix:colon
r_return
id|security_socket_getpeersec
c_func
(paren
id|sock
comma
id|optval
comma
id|optlen
comma
id|len
)paren
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|ENOPROTOOPT
suffix:semicolon
)brace
r_if
c_cond
(paren
id|len
OG
id|lv
)paren
id|len
op_assign
id|lv
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|optval
comma
op_amp
id|v
comma
id|len
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|lenout
suffix:colon
r_if
c_cond
(paren
id|put_user
c_func
(paren
id|len
comma
id|optlen
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|sk_cachep
r_static
id|kmem_cache_t
op_star
id|sk_cachep
suffix:semicolon
multiline_comment|/**&n; *&t;sk_alloc - All socket objects are allocated here&n; *&t;@family - protocol family&n; *&t;@priority - for allocation (%GFP_KERNEL, %GFP_ATOMIC, etc)&n; *&t;@zero_it - zeroes the allocated sock&n; *&t;@slab - alternate slab&n; *&n; *&t;All socket objects are allocated here. If @zero_it is non-zero&n; *&t;it should have the size of the are to be zeroed, because the&n; *&t;private slabcaches have different sizes of the generic struct sock.&n; *&t;1 has been kept as a way to say sizeof(struct sock).&n; */
DECL|function|sk_alloc
r_struct
id|sock
op_star
id|sk_alloc
c_func
(paren
r_int
id|family
comma
r_int
id|priority
comma
r_int
id|zero_it
comma
id|kmem_cache_t
op_star
id|slab
)paren
(brace
r_struct
id|sock
op_star
id|sk
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|slab
)paren
id|slab
op_assign
id|sk_cachep
suffix:semicolon
id|sk
op_assign
id|kmem_cache_alloc
c_func
(paren
id|slab
comma
id|priority
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sk
)paren
(brace
r_if
c_cond
(paren
id|zero_it
)paren
(brace
id|memset
c_func
(paren
id|sk
comma
l_int|0
comma
id|zero_it
op_eq
l_int|1
ques
c_cond
r_sizeof
(paren
r_struct
id|sock
)paren
suffix:colon
id|zero_it
)paren
suffix:semicolon
id|sk-&gt;sk_family
op_assign
id|family
suffix:semicolon
id|sock_lock_init
c_func
(paren
id|sk
)paren
suffix:semicolon
)brace
id|sk-&gt;sk_slab
op_assign
id|slab
suffix:semicolon
r_if
c_cond
(paren
id|security_sk_alloc
c_func
(paren
id|sk
comma
id|family
comma
id|priority
)paren
)paren
(brace
id|kmem_cache_free
c_func
(paren
id|slab
comma
id|sk
)paren
suffix:semicolon
id|sk
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
r_return
id|sk
suffix:semicolon
)brace
DECL|function|sk_free
r_void
id|sk_free
c_func
(paren
r_struct
id|sock
op_star
id|sk
)paren
(brace
r_struct
id|sk_filter
op_star
id|filter
suffix:semicolon
r_struct
id|module
op_star
id|owner
op_assign
id|sk-&gt;sk_owner
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;sk_destruct
)paren
id|sk
op_member_access_from_pointer
id|sk_destruct
c_func
(paren
id|sk
)paren
suffix:semicolon
id|filter
op_assign
id|sk-&gt;sk_filter
suffix:semicolon
r_if
c_cond
(paren
id|filter
)paren
(brace
id|sk_filter_release
c_func
(paren
id|sk
comma
id|filter
)paren
suffix:semicolon
id|sk-&gt;sk_filter
op_assign
l_int|NULL
suffix:semicolon
)brace
id|sock_disable_timestamp
c_func
(paren
id|sk
)paren
suffix:semicolon
r_if
c_cond
(paren
id|atomic_read
c_func
(paren
op_amp
id|sk-&gt;sk_omem_alloc
)paren
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: optmem leakage (%d bytes) detected.&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|atomic_read
c_func
(paren
op_amp
id|sk-&gt;sk_omem_alloc
)paren
)paren
suffix:semicolon
id|security_sk_free
c_func
(paren
id|sk
)paren
suffix:semicolon
id|kmem_cache_free
c_func
(paren
id|sk-&gt;sk_slab
comma
id|sk
)paren
suffix:semicolon
id|module_put
c_func
(paren
id|owner
)paren
suffix:semicolon
)brace
DECL|function|sk_init
r_void
id|__init
id|sk_init
c_func
(paren
r_void
)paren
(brace
id|sk_cachep
op_assign
id|kmem_cache_create
c_func
(paren
l_string|&quot;sock&quot;
comma
r_sizeof
(paren
r_struct
id|sock
)paren
comma
l_int|0
comma
id|SLAB_HWCACHE_ALIGN
comma
l_int|NULL
comma
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sk_cachep
)paren
id|printk
c_func
(paren
id|KERN_CRIT
l_string|&quot;sk_init: Cannot create sock SLAB cache!&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|num_physpages
op_le
l_int|4096
)paren
(brace
id|sysctl_wmem_max
op_assign
l_int|32767
suffix:semicolon
id|sysctl_rmem_max
op_assign
l_int|32767
suffix:semicolon
id|sysctl_wmem_default
op_assign
l_int|32767
suffix:semicolon
id|sysctl_rmem_default
op_assign
l_int|32767
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|num_physpages
op_ge
l_int|131072
)paren
(brace
id|sysctl_wmem_max
op_assign
l_int|131071
suffix:semicolon
id|sysctl_rmem_max
op_assign
l_int|131071
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; *&t;Simple resource managers for sockets.&n; */
multiline_comment|/* &n; * Write buffer destructor automatically called from kfree_skb. &n; */
DECL|function|sock_wfree
r_void
id|sock_wfree
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|sock
op_star
id|sk
op_assign
id|skb-&gt;sk
suffix:semicolon
multiline_comment|/* In case it might be waiting for more memory. */
id|atomic_sub
c_func
(paren
id|skb-&gt;truesize
comma
op_amp
id|sk-&gt;sk_wmem_alloc
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sk-&gt;sk_use_write_queue
)paren
id|sk
op_member_access_from_pointer
id|sk_write_space
c_func
(paren
id|sk
)paren
suffix:semicolon
id|sock_put
c_func
(paren
id|sk
)paren
suffix:semicolon
)brace
multiline_comment|/* &n; * Read buffer destructor automatically called from kfree_skb. &n; */
DECL|function|sock_rfree
r_void
id|sock_rfree
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|sock
op_star
id|sk
op_assign
id|skb-&gt;sk
suffix:semicolon
id|atomic_sub
c_func
(paren
id|skb-&gt;truesize
comma
op_amp
id|sk-&gt;sk_rmem_alloc
)paren
suffix:semicolon
)brace
DECL|function|sock_i_uid
r_int
id|sock_i_uid
c_func
(paren
r_struct
id|sock
op_star
id|sk
)paren
(brace
r_int
id|uid
suffix:semicolon
id|read_lock
c_func
(paren
op_amp
id|sk-&gt;sk_callback_lock
)paren
suffix:semicolon
id|uid
op_assign
id|sk-&gt;sk_socket
ques
c_cond
id|SOCK_INODE
c_func
(paren
id|sk-&gt;sk_socket
)paren
op_member_access_from_pointer
id|i_uid
suffix:colon
l_int|0
suffix:semicolon
id|read_unlock
c_func
(paren
op_amp
id|sk-&gt;sk_callback_lock
)paren
suffix:semicolon
r_return
id|uid
suffix:semicolon
)brace
DECL|function|sock_i_ino
r_int
r_int
id|sock_i_ino
c_func
(paren
r_struct
id|sock
op_star
id|sk
)paren
(brace
r_int
r_int
id|ino
suffix:semicolon
id|read_lock
c_func
(paren
op_amp
id|sk-&gt;sk_callback_lock
)paren
suffix:semicolon
id|ino
op_assign
id|sk-&gt;sk_socket
ques
c_cond
id|SOCK_INODE
c_func
(paren
id|sk-&gt;sk_socket
)paren
op_member_access_from_pointer
id|i_ino
suffix:colon
l_int|0
suffix:semicolon
id|read_unlock
c_func
(paren
op_amp
id|sk-&gt;sk_callback_lock
)paren
suffix:semicolon
r_return
id|ino
suffix:semicolon
)brace
multiline_comment|/*&n; * Allocate a skb from the socket&squot;s send buffer.&n; */
DECL|function|sock_wmalloc
r_struct
id|sk_buff
op_star
id|sock_wmalloc
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_int
r_int
id|size
comma
r_int
id|force
comma
r_int
id|priority
)paren
(brace
r_if
c_cond
(paren
id|force
op_logical_or
id|atomic_read
c_func
(paren
op_amp
id|sk-&gt;sk_wmem_alloc
)paren
OL
id|sk-&gt;sk_sndbuf
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
op_assign
id|alloc_skb
c_func
(paren
id|size
comma
id|priority
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
)paren
(brace
id|skb_set_owner_w
c_func
(paren
id|skb
comma
id|sk
)paren
suffix:semicolon
r_return
id|skb
suffix:semicolon
)brace
)brace
r_return
l_int|NULL
suffix:semicolon
)brace
multiline_comment|/*&n; * Allocate a skb from the socket&squot;s receive buffer.&n; */
DECL|function|sock_rmalloc
r_struct
id|sk_buff
op_star
id|sock_rmalloc
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_int
r_int
id|size
comma
r_int
id|force
comma
r_int
id|priority
)paren
(brace
r_if
c_cond
(paren
id|force
op_logical_or
id|atomic_read
c_func
(paren
op_amp
id|sk-&gt;sk_rmem_alloc
)paren
OL
id|sk-&gt;sk_rcvbuf
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
op_assign
id|alloc_skb
c_func
(paren
id|size
comma
id|priority
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
)paren
(brace
id|skb_set_owner_r
c_func
(paren
id|skb
comma
id|sk
)paren
suffix:semicolon
r_return
id|skb
suffix:semicolon
)brace
)brace
r_return
l_int|NULL
suffix:semicolon
)brace
multiline_comment|/* &n; * Allocate a memory block from the socket&squot;s option memory buffer.&n; */
DECL|function|sock_kmalloc
r_void
op_star
id|sock_kmalloc
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_int
id|size
comma
r_int
id|priority
)paren
(brace
r_if
c_cond
(paren
(paren
r_int
)paren
id|size
op_le
id|sysctl_optmem_max
op_logical_and
id|atomic_read
c_func
(paren
op_amp
id|sk-&gt;sk_omem_alloc
)paren
op_plus
id|size
OL
id|sysctl_optmem_max
)paren
(brace
r_void
op_star
id|mem
suffix:semicolon
multiline_comment|/* First do the add, to avoid the race if kmalloc&n; &t;&t; * might sleep.&n;&t;&t; */
id|atomic_add
c_func
(paren
id|size
comma
op_amp
id|sk-&gt;sk_omem_alloc
)paren
suffix:semicolon
id|mem
op_assign
id|kmalloc
c_func
(paren
id|size
comma
id|priority
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mem
)paren
r_return
id|mem
suffix:semicolon
id|atomic_sub
c_func
(paren
id|size
comma
op_amp
id|sk-&gt;sk_omem_alloc
)paren
suffix:semicolon
)brace
r_return
l_int|NULL
suffix:semicolon
)brace
multiline_comment|/*&n; * Free an option memory block.&n; */
DECL|function|sock_kfree_s
r_void
id|sock_kfree_s
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_void
op_star
id|mem
comma
r_int
id|size
)paren
(brace
id|kfree
c_func
(paren
id|mem
)paren
suffix:semicolon
id|atomic_sub
c_func
(paren
id|size
comma
op_amp
id|sk-&gt;sk_omem_alloc
)paren
suffix:semicolon
)brace
multiline_comment|/* It is almost wait_for_tcp_memory minus release_sock/lock_sock.&n;   I think, these locks should be removed for datagram sockets.&n; */
DECL|function|sock_wait_for_wmem
r_static
r_int
id|sock_wait_for_wmem
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_int
id|timeo
)paren
(brace
id|DEFINE_WAIT
c_func
(paren
id|wait
)paren
suffix:semicolon
id|clear_bit
c_func
(paren
id|SOCK_ASYNC_NOSPACE
comma
op_amp
id|sk-&gt;sk_socket-&gt;flags
)paren
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|timeo
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|signal_pending
c_func
(paren
id|current
)paren
)paren
r_break
suffix:semicolon
id|set_bit
c_func
(paren
id|SOCK_NOSPACE
comma
op_amp
id|sk-&gt;sk_socket-&gt;flags
)paren
suffix:semicolon
id|prepare_to_wait
c_func
(paren
id|sk-&gt;sk_sleep
comma
op_amp
id|wait
comma
id|TASK_INTERRUPTIBLE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|atomic_read
c_func
(paren
op_amp
id|sk-&gt;sk_wmem_alloc
)paren
OL
id|sk-&gt;sk_sndbuf
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;sk_shutdown
op_amp
id|SEND_SHUTDOWN
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;sk_err
)paren
r_break
suffix:semicolon
id|timeo
op_assign
id|schedule_timeout
c_func
(paren
id|timeo
)paren
suffix:semicolon
)brace
id|finish_wait
c_func
(paren
id|sk-&gt;sk_sleep
comma
op_amp
id|wait
)paren
suffix:semicolon
r_return
id|timeo
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;Generic send/receive buffer handlers&n; */
DECL|function|sock_alloc_send_pskb
r_struct
id|sk_buff
op_star
id|sock_alloc_send_pskb
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_int
r_int
id|header_len
comma
r_int
r_int
id|data_len
comma
r_int
id|noblock
comma
r_int
op_star
id|errcode
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_int
r_int
id|gfp_mask
suffix:semicolon
r_int
id|timeo
suffix:semicolon
r_int
id|err
suffix:semicolon
id|gfp_mask
op_assign
id|sk-&gt;sk_allocation
suffix:semicolon
r_if
c_cond
(paren
id|gfp_mask
op_amp
id|__GFP_WAIT
)paren
id|gfp_mask
op_or_assign
id|__GFP_REPEAT
suffix:semicolon
id|timeo
op_assign
id|sock_sndtimeo
c_func
(paren
id|sk
comma
id|noblock
)paren
suffix:semicolon
r_while
c_loop
(paren
l_int|1
)paren
(brace
id|err
op_assign
id|sock_error
c_func
(paren
id|sk
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
op_ne
l_int|0
)paren
r_goto
id|failure
suffix:semicolon
id|err
op_assign
op_minus
id|EPIPE
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;sk_shutdown
op_amp
id|SEND_SHUTDOWN
)paren
r_goto
id|failure
suffix:semicolon
r_if
c_cond
(paren
id|atomic_read
c_func
(paren
op_amp
id|sk-&gt;sk_wmem_alloc
)paren
OL
id|sk-&gt;sk_sndbuf
)paren
(brace
id|skb
op_assign
id|alloc_skb
c_func
(paren
id|header_len
comma
id|sk-&gt;sk_allocation
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
)paren
(brace
r_int
id|npages
suffix:semicolon
r_int
id|i
suffix:semicolon
multiline_comment|/* No pages, we&squot;re done... */
r_if
c_cond
(paren
op_logical_neg
id|data_len
)paren
r_break
suffix:semicolon
id|npages
op_assign
(paren
id|data_len
op_plus
(paren
id|PAGE_SIZE
op_minus
l_int|1
)paren
)paren
op_rshift
id|PAGE_SHIFT
suffix:semicolon
id|skb-&gt;truesize
op_add_assign
id|data_len
suffix:semicolon
id|skb_shinfo
c_func
(paren
id|skb
)paren
op_member_access_from_pointer
id|nr_frags
op_assign
id|npages
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|npages
suffix:semicolon
id|i
op_increment
)paren
(brace
r_struct
id|page
op_star
id|page
suffix:semicolon
id|skb_frag_t
op_star
id|frag
suffix:semicolon
id|page
op_assign
id|alloc_pages
c_func
(paren
id|sk-&gt;sk_allocation
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|page
)paren
(brace
id|err
op_assign
op_minus
id|ENOBUFS
suffix:semicolon
id|skb_shinfo
c_func
(paren
id|skb
)paren
op_member_access_from_pointer
id|nr_frags
op_assign
id|i
suffix:semicolon
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_goto
id|failure
suffix:semicolon
)brace
id|frag
op_assign
op_amp
id|skb_shinfo
c_func
(paren
id|skb
)paren
op_member_access_from_pointer
id|frags
(braket
id|i
)braket
suffix:semicolon
id|frag-&gt;page
op_assign
id|page
suffix:semicolon
id|frag-&gt;page_offset
op_assign
l_int|0
suffix:semicolon
id|frag-&gt;size
op_assign
(paren
id|data_len
op_ge
id|PAGE_SIZE
ques
c_cond
id|PAGE_SIZE
suffix:colon
id|data_len
)paren
suffix:semicolon
id|data_len
op_sub_assign
id|PAGE_SIZE
suffix:semicolon
)brace
multiline_comment|/* Full success... */
r_break
suffix:semicolon
)brace
id|err
op_assign
op_minus
id|ENOBUFS
suffix:semicolon
r_goto
id|failure
suffix:semicolon
)brace
id|set_bit
c_func
(paren
id|SOCK_ASYNC_NOSPACE
comma
op_amp
id|sk-&gt;sk_socket-&gt;flags
)paren
suffix:semicolon
id|set_bit
c_func
(paren
id|SOCK_NOSPACE
comma
op_amp
id|sk-&gt;sk_socket-&gt;flags
)paren
suffix:semicolon
id|err
op_assign
op_minus
id|EAGAIN
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|timeo
)paren
r_goto
id|failure
suffix:semicolon
r_if
c_cond
(paren
id|signal_pending
c_func
(paren
id|current
)paren
)paren
r_goto
id|interrupted
suffix:semicolon
id|timeo
op_assign
id|sock_wait_for_wmem
c_func
(paren
id|sk
comma
id|timeo
)paren
suffix:semicolon
)brace
id|skb_set_owner_w
c_func
(paren
id|skb
comma
id|sk
)paren
suffix:semicolon
r_return
id|skb
suffix:semicolon
id|interrupted
suffix:colon
id|err
op_assign
id|sock_intr_errno
c_func
(paren
id|timeo
)paren
suffix:semicolon
id|failure
suffix:colon
op_star
id|errcode
op_assign
id|err
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
DECL|function|sock_alloc_send_skb
r_struct
id|sk_buff
op_star
id|sock_alloc_send_skb
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_int
r_int
id|size
comma
r_int
id|noblock
comma
r_int
op_star
id|errcode
)paren
(brace
r_return
id|sock_alloc_send_pskb
c_func
(paren
id|sk
comma
id|size
comma
l_int|0
comma
id|noblock
comma
id|errcode
)paren
suffix:semicolon
)brace
DECL|function|__lock_sock
r_static
r_void
id|__lock_sock
c_func
(paren
r_struct
id|sock
op_star
id|sk
)paren
(brace
id|DEFINE_WAIT
c_func
(paren
id|wait
)paren
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
(brace
id|prepare_to_wait_exclusive
c_func
(paren
op_amp
id|sk-&gt;sk_lock.wq
comma
op_amp
id|wait
comma
id|TASK_UNINTERRUPTIBLE
)paren
suffix:semicolon
id|spin_unlock_bh
c_func
(paren
op_amp
id|sk-&gt;sk_lock.slock
)paren
suffix:semicolon
id|schedule
c_func
(paren
)paren
suffix:semicolon
id|spin_lock_bh
c_func
(paren
op_amp
id|sk-&gt;sk_lock.slock
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sock_owned_by_user
c_func
(paren
id|sk
)paren
)paren
(brace
r_break
suffix:semicolon
)brace
)brace
id|finish_wait
c_func
(paren
op_amp
id|sk-&gt;sk_lock.wq
comma
op_amp
id|wait
)paren
suffix:semicolon
)brace
DECL|function|__release_sock
r_static
r_void
id|__release_sock
c_func
(paren
r_struct
id|sock
op_star
id|sk
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
op_assign
id|sk-&gt;sk_backlog.head
suffix:semicolon
r_do
(brace
id|sk-&gt;sk_backlog.head
op_assign
id|sk-&gt;sk_backlog.tail
op_assign
l_int|NULL
suffix:semicolon
id|bh_unlock_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
r_do
(brace
r_struct
id|sk_buff
op_star
id|next
op_assign
id|skb-&gt;next
suffix:semicolon
id|skb-&gt;next
op_assign
l_int|NULL
suffix:semicolon
id|sk
op_member_access_from_pointer
id|sk_backlog_rcv
c_func
(paren
id|sk
comma
id|skb
)paren
suffix:semicolon
id|skb
op_assign
id|next
suffix:semicolon
)brace
r_while
c_loop
(paren
id|skb
op_ne
l_int|NULL
)paren
suffix:semicolon
id|bh_lock_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
(paren
id|skb
op_assign
id|sk-&gt;sk_backlog.head
)paren
op_ne
l_int|NULL
)paren
(brace
suffix:semicolon
)brace
)brace
multiline_comment|/**&n; * sk_wait_data - wait for data to arrive at sk_receive_queue&n; * sk - sock to wait on&n; * timeo - for how long&n; *&n; * Now socket state including sk-&gt;sk_err is changed only under lock,&n; * hence we may omit checks after joining wait queue.&n; * We check receive queue before schedule() only as optimization;&n; * it is very likely that release_sock() added new data.&n; */
DECL|function|sk_wait_data
r_int
id|sk_wait_data
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_int
op_star
id|timeo
)paren
(brace
r_int
id|rc
suffix:semicolon
id|DEFINE_WAIT
c_func
(paren
id|wait
)paren
suffix:semicolon
id|prepare_to_wait
c_func
(paren
id|sk-&gt;sk_sleep
comma
op_amp
id|wait
comma
id|TASK_INTERRUPTIBLE
)paren
suffix:semicolon
id|set_bit
c_func
(paren
id|SOCK_ASYNC_WAITDATA
comma
op_amp
id|sk-&gt;sk_socket-&gt;flags
)paren
suffix:semicolon
id|rc
op_assign
id|sk_wait_event
c_func
(paren
id|sk
comma
id|timeo
comma
op_logical_neg
id|skb_queue_empty
c_func
(paren
op_amp
id|sk-&gt;sk_receive_queue
)paren
)paren
suffix:semicolon
id|clear_bit
c_func
(paren
id|SOCK_ASYNC_WAITDATA
comma
op_amp
id|sk-&gt;sk_socket-&gt;flags
)paren
suffix:semicolon
id|finish_wait
c_func
(paren
id|sk-&gt;sk_sleep
comma
op_amp
id|wait
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
DECL|variable|sk_wait_data
id|EXPORT_SYMBOL
c_func
(paren
id|sk_wait_data
)paren
suffix:semicolon
multiline_comment|/*&n; * Set of default routines for initialising struct proto_ops when&n; * the protocol does not support a particular function. In certain&n; * cases where it makes no sense for a protocol to have a &quot;do nothing&quot;&n; * function, some default processing is provided.&n; */
DECL|function|sock_no_bind
r_int
id|sock_no_bind
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_struct
id|sockaddr
op_star
id|saddr
comma
r_int
id|len
)paren
(brace
r_return
op_minus
id|EOPNOTSUPP
suffix:semicolon
)brace
DECL|function|sock_no_connect
r_int
id|sock_no_connect
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_struct
id|sockaddr
op_star
id|saddr
comma
r_int
id|len
comma
r_int
id|flags
)paren
(brace
r_return
op_minus
id|EOPNOTSUPP
suffix:semicolon
)brace
DECL|function|sock_no_socketpair
r_int
id|sock_no_socketpair
c_func
(paren
r_struct
id|socket
op_star
id|sock1
comma
r_struct
id|socket
op_star
id|sock2
)paren
(brace
r_return
op_minus
id|EOPNOTSUPP
suffix:semicolon
)brace
DECL|function|sock_no_accept
r_int
id|sock_no_accept
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_struct
id|socket
op_star
id|newsock
comma
r_int
id|flags
)paren
(brace
r_return
op_minus
id|EOPNOTSUPP
suffix:semicolon
)brace
DECL|function|sock_no_getname
r_int
id|sock_no_getname
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_struct
id|sockaddr
op_star
id|saddr
comma
r_int
op_star
id|len
comma
r_int
id|peer
)paren
(brace
r_return
op_minus
id|EOPNOTSUPP
suffix:semicolon
)brace
DECL|function|sock_no_poll
r_int
r_int
id|sock_no_poll
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_struct
id|socket
op_star
id|sock
comma
id|poll_table
op_star
id|pt
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sock_no_ioctl
r_int
id|sock_no_ioctl
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
r_return
op_minus
id|EOPNOTSUPP
suffix:semicolon
)brace
DECL|function|sock_no_listen
r_int
id|sock_no_listen
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_int
id|backlog
)paren
(brace
r_return
op_minus
id|EOPNOTSUPP
suffix:semicolon
)brace
DECL|function|sock_no_shutdown
r_int
id|sock_no_shutdown
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_int
id|how
)paren
(brace
r_return
op_minus
id|EOPNOTSUPP
suffix:semicolon
)brace
DECL|function|sock_no_setsockopt
r_int
id|sock_no_setsockopt
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_int
id|level
comma
r_int
id|optname
comma
r_char
id|__user
op_star
id|optval
comma
r_int
id|optlen
)paren
(brace
r_return
op_minus
id|EOPNOTSUPP
suffix:semicolon
)brace
DECL|function|sock_no_getsockopt
r_int
id|sock_no_getsockopt
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_int
id|level
comma
r_int
id|optname
comma
r_char
id|__user
op_star
id|optval
comma
r_int
id|__user
op_star
id|optlen
)paren
(brace
r_return
op_minus
id|EOPNOTSUPP
suffix:semicolon
)brace
DECL|function|sock_no_sendmsg
r_int
id|sock_no_sendmsg
c_func
(paren
r_struct
id|kiocb
op_star
id|iocb
comma
r_struct
id|socket
op_star
id|sock
comma
r_struct
id|msghdr
op_star
id|m
comma
r_int
id|len
)paren
(brace
r_return
op_minus
id|EOPNOTSUPP
suffix:semicolon
)brace
DECL|function|sock_no_recvmsg
r_int
id|sock_no_recvmsg
c_func
(paren
r_struct
id|kiocb
op_star
id|iocb
comma
r_struct
id|socket
op_star
id|sock
comma
r_struct
id|msghdr
op_star
id|m
comma
r_int
id|len
comma
r_int
id|flags
)paren
(brace
r_return
op_minus
id|EOPNOTSUPP
suffix:semicolon
)brace
DECL|function|sock_no_mmap
r_int
id|sock_no_mmap
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_struct
id|socket
op_star
id|sock
comma
r_struct
id|vm_area_struct
op_star
id|vma
)paren
(brace
multiline_comment|/* Mirror missing mmap method error code */
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
DECL|function|sock_no_sendpage
id|ssize_t
id|sock_no_sendpage
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_struct
id|page
op_star
id|page
comma
r_int
id|offset
comma
r_int
id|size
comma
r_int
id|flags
)paren
(brace
id|ssize_t
id|res
suffix:semicolon
r_struct
id|msghdr
id|msg
op_assign
(brace
dot
id|msg_flags
op_assign
id|flags
)brace
suffix:semicolon
r_struct
id|kvec
id|iov
suffix:semicolon
r_char
op_star
id|kaddr
op_assign
id|kmap
c_func
(paren
id|page
)paren
suffix:semicolon
id|iov.iov_base
op_assign
id|kaddr
op_plus
id|offset
suffix:semicolon
id|iov.iov_len
op_assign
id|size
suffix:semicolon
id|res
op_assign
id|kernel_sendmsg
c_func
(paren
id|sock
comma
op_amp
id|msg
comma
op_amp
id|iov
comma
l_int|1
comma
id|size
)paren
suffix:semicolon
id|kunmap
c_func
(paren
id|page
)paren
suffix:semicolon
r_return
id|res
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;Default Socket Callbacks&n; */
DECL|function|sock_def_wakeup
r_void
id|sock_def_wakeup
c_func
(paren
r_struct
id|sock
op_star
id|sk
)paren
(brace
id|read_lock
c_func
(paren
op_amp
id|sk-&gt;sk_callback_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;sk_sleep
op_logical_and
id|waitqueue_active
c_func
(paren
id|sk-&gt;sk_sleep
)paren
)paren
id|wake_up_interruptible_all
c_func
(paren
id|sk-&gt;sk_sleep
)paren
suffix:semicolon
id|read_unlock
c_func
(paren
op_amp
id|sk-&gt;sk_callback_lock
)paren
suffix:semicolon
)brace
DECL|function|sock_def_error_report
r_void
id|sock_def_error_report
c_func
(paren
r_struct
id|sock
op_star
id|sk
)paren
(brace
id|read_lock
c_func
(paren
op_amp
id|sk-&gt;sk_callback_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;sk_sleep
op_logical_and
id|waitqueue_active
c_func
(paren
id|sk-&gt;sk_sleep
)paren
)paren
id|wake_up_interruptible
c_func
(paren
id|sk-&gt;sk_sleep
)paren
suffix:semicolon
id|sk_wake_async
c_func
(paren
id|sk
comma
l_int|0
comma
id|POLL_ERR
)paren
suffix:semicolon
id|read_unlock
c_func
(paren
op_amp
id|sk-&gt;sk_callback_lock
)paren
suffix:semicolon
)brace
DECL|function|sock_def_readable
r_void
id|sock_def_readable
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_int
id|len
)paren
(brace
id|read_lock
c_func
(paren
op_amp
id|sk-&gt;sk_callback_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;sk_sleep
op_logical_and
id|waitqueue_active
c_func
(paren
id|sk-&gt;sk_sleep
)paren
)paren
id|wake_up_interruptible
c_func
(paren
id|sk-&gt;sk_sleep
)paren
suffix:semicolon
id|sk_wake_async
c_func
(paren
id|sk
comma
l_int|1
comma
id|POLL_IN
)paren
suffix:semicolon
id|read_unlock
c_func
(paren
op_amp
id|sk-&gt;sk_callback_lock
)paren
suffix:semicolon
)brace
DECL|function|sock_def_write_space
r_void
id|sock_def_write_space
c_func
(paren
r_struct
id|sock
op_star
id|sk
)paren
(brace
id|read_lock
c_func
(paren
op_amp
id|sk-&gt;sk_callback_lock
)paren
suffix:semicolon
multiline_comment|/* Do not wake up a writer until he can make &quot;significant&quot;&n;&t; * progress.  --DaveM&n;&t; */
r_if
c_cond
(paren
(paren
id|atomic_read
c_func
(paren
op_amp
id|sk-&gt;sk_wmem_alloc
)paren
op_lshift
l_int|1
)paren
op_le
id|sk-&gt;sk_sndbuf
)paren
(brace
r_if
c_cond
(paren
id|sk-&gt;sk_sleep
op_logical_and
id|waitqueue_active
c_func
(paren
id|sk-&gt;sk_sleep
)paren
)paren
id|wake_up_interruptible
c_func
(paren
id|sk-&gt;sk_sleep
)paren
suffix:semicolon
multiline_comment|/* Should agree with poll, otherwise some programs break */
r_if
c_cond
(paren
id|sock_writeable
c_func
(paren
id|sk
)paren
)paren
id|sk_wake_async
c_func
(paren
id|sk
comma
l_int|2
comma
id|POLL_OUT
)paren
suffix:semicolon
)brace
id|read_unlock
c_func
(paren
op_amp
id|sk-&gt;sk_callback_lock
)paren
suffix:semicolon
)brace
DECL|function|sock_def_destruct
r_void
id|sock_def_destruct
c_func
(paren
r_struct
id|sock
op_star
id|sk
)paren
(brace
r_if
c_cond
(paren
id|sk-&gt;sk_protinfo
)paren
id|kfree
c_func
(paren
id|sk-&gt;sk_protinfo
)paren
suffix:semicolon
)brace
DECL|function|sk_send_sigurg
r_void
id|sk_send_sigurg
c_func
(paren
r_struct
id|sock
op_star
id|sk
)paren
(brace
r_if
c_cond
(paren
id|sk-&gt;sk_socket
op_logical_and
id|sk-&gt;sk_socket-&gt;file
)paren
r_if
c_cond
(paren
id|send_sigurg
c_func
(paren
op_amp
id|sk-&gt;sk_socket-&gt;file-&gt;f_owner
)paren
)paren
id|sk_wake_async
c_func
(paren
id|sk
comma
l_int|3
comma
id|POLL_PRI
)paren
suffix:semicolon
)brace
DECL|function|sk_reset_timer
r_void
id|sk_reset_timer
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_struct
id|timer_list
op_star
id|timer
comma
r_int
r_int
id|expires
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|mod_timer
c_func
(paren
id|timer
comma
id|expires
)paren
)paren
id|sock_hold
c_func
(paren
id|sk
)paren
suffix:semicolon
)brace
DECL|variable|sk_reset_timer
id|EXPORT_SYMBOL
c_func
(paren
id|sk_reset_timer
)paren
suffix:semicolon
DECL|function|sk_stop_timer
r_void
id|sk_stop_timer
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_struct
id|timer_list
op_star
id|timer
)paren
(brace
r_if
c_cond
(paren
id|timer_pending
c_func
(paren
id|timer
)paren
op_logical_and
id|del_timer
c_func
(paren
id|timer
)paren
)paren
id|__sock_put
c_func
(paren
id|sk
)paren
suffix:semicolon
)brace
DECL|variable|sk_stop_timer
id|EXPORT_SYMBOL
c_func
(paren
id|sk_stop_timer
)paren
suffix:semicolon
DECL|function|sock_init_data
r_void
id|sock_init_data
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_struct
id|sock
op_star
id|sk
)paren
(brace
id|skb_queue_head_init
c_func
(paren
op_amp
id|sk-&gt;sk_receive_queue
)paren
suffix:semicolon
id|skb_queue_head_init
c_func
(paren
op_amp
id|sk-&gt;sk_write_queue
)paren
suffix:semicolon
id|skb_queue_head_init
c_func
(paren
op_amp
id|sk-&gt;sk_error_queue
)paren
suffix:semicolon
id|sk-&gt;sk_send_head
op_assign
l_int|NULL
suffix:semicolon
id|init_timer
c_func
(paren
op_amp
id|sk-&gt;sk_timer
)paren
suffix:semicolon
id|sk-&gt;sk_allocation
op_assign
id|GFP_KERNEL
suffix:semicolon
id|sk-&gt;sk_rcvbuf
op_assign
id|sysctl_rmem_default
suffix:semicolon
id|sk-&gt;sk_sndbuf
op_assign
id|sysctl_wmem_default
suffix:semicolon
id|sk-&gt;sk_state
op_assign
id|TCP_CLOSE
suffix:semicolon
id|sk-&gt;sk_zapped
op_assign
l_int|1
suffix:semicolon
id|sk-&gt;sk_socket
op_assign
id|sock
suffix:semicolon
r_if
c_cond
(paren
id|sock
)paren
(brace
id|sk-&gt;sk_type
op_assign
id|sock-&gt;type
suffix:semicolon
id|sk-&gt;sk_sleep
op_assign
op_amp
id|sock-&gt;wait
suffix:semicolon
id|sock-&gt;sk
op_assign
id|sk
suffix:semicolon
)brace
r_else
id|sk-&gt;sk_sleep
op_assign
l_int|NULL
suffix:semicolon
id|rwlock_init
c_func
(paren
op_amp
id|sk-&gt;sk_dst_lock
)paren
suffix:semicolon
id|rwlock_init
c_func
(paren
op_amp
id|sk-&gt;sk_callback_lock
)paren
suffix:semicolon
id|sk-&gt;sk_state_change
op_assign
id|sock_def_wakeup
suffix:semicolon
id|sk-&gt;sk_data_ready
op_assign
id|sock_def_readable
suffix:semicolon
id|sk-&gt;sk_write_space
op_assign
id|sock_def_write_space
suffix:semicolon
id|sk-&gt;sk_error_report
op_assign
id|sock_def_error_report
suffix:semicolon
id|sk-&gt;sk_destruct
op_assign
id|sock_def_destruct
suffix:semicolon
id|sk-&gt;sk_sndmsg_page
op_assign
l_int|NULL
suffix:semicolon
id|sk-&gt;sk_sndmsg_off
op_assign
l_int|0
suffix:semicolon
id|sk-&gt;sk_peercred.pid
op_assign
l_int|0
suffix:semicolon
id|sk-&gt;sk_peercred.uid
op_assign
op_minus
l_int|1
suffix:semicolon
id|sk-&gt;sk_peercred.gid
op_assign
op_minus
l_int|1
suffix:semicolon
id|sk-&gt;sk_write_pending
op_assign
l_int|0
suffix:semicolon
id|sk-&gt;sk_rcvlowat
op_assign
l_int|1
suffix:semicolon
id|sk-&gt;sk_rcvtimeo
op_assign
id|MAX_SCHEDULE_TIMEOUT
suffix:semicolon
id|sk-&gt;sk_sndtimeo
op_assign
id|MAX_SCHEDULE_TIMEOUT
suffix:semicolon
id|sk-&gt;sk_owner
op_assign
l_int|NULL
suffix:semicolon
id|sk-&gt;sk_stamp.tv_sec
op_assign
op_minus
l_int|1L
suffix:semicolon
id|sk-&gt;sk_stamp.tv_usec
op_assign
op_minus
l_int|1L
suffix:semicolon
id|atomic_set
c_func
(paren
op_amp
id|sk-&gt;sk_refcnt
comma
l_int|1
)paren
suffix:semicolon
)brace
DECL|function|lock_sock
r_void
id|fastcall
id|lock_sock
c_func
(paren
r_struct
id|sock
op_star
id|sk
)paren
(brace
id|might_sleep
c_func
(paren
)paren
suffix:semicolon
id|spin_lock_bh
c_func
(paren
op_amp
(paren
id|sk-&gt;sk_lock.slock
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;sk_lock.owner
)paren
id|__lock_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
id|sk-&gt;sk_lock.owner
op_assign
(paren
r_void
op_star
)paren
l_int|1
suffix:semicolon
id|spin_unlock_bh
c_func
(paren
op_amp
(paren
id|sk-&gt;sk_lock.slock
)paren
)paren
suffix:semicolon
)brace
DECL|variable|lock_sock
id|EXPORT_SYMBOL
c_func
(paren
id|lock_sock
)paren
suffix:semicolon
DECL|function|release_sock
r_void
id|fastcall
id|release_sock
c_func
(paren
r_struct
id|sock
op_star
id|sk
)paren
(brace
id|spin_lock_bh
c_func
(paren
op_amp
(paren
id|sk-&gt;sk_lock.slock
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;sk_backlog.tail
)paren
id|__release_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
id|sk-&gt;sk_lock.owner
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|waitqueue_active
c_func
(paren
op_amp
(paren
id|sk-&gt;sk_lock.wq
)paren
)paren
)paren
id|wake_up
c_func
(paren
op_amp
(paren
id|sk-&gt;sk_lock.wq
)paren
)paren
suffix:semicolon
id|spin_unlock_bh
c_func
(paren
op_amp
(paren
id|sk-&gt;sk_lock.slock
)paren
)paren
suffix:semicolon
)brace
DECL|variable|release_sock
id|EXPORT_SYMBOL
c_func
(paren
id|release_sock
)paren
suffix:semicolon
DECL|function|sock_get_timestamp
r_int
id|sock_get_timestamp
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_struct
id|timeval
id|__user
op_star
id|userstamp
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|sock_flag
c_func
(paren
id|sk
comma
id|SOCK_TIMESTAMP
)paren
)paren
id|sock_enable_timestamp
c_func
(paren
id|sk
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;sk_stamp.tv_sec
op_eq
op_minus
l_int|1
)paren
r_return
op_minus
id|ENOENT
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;sk_stamp.tv_sec
op_eq
l_int|0
)paren
id|do_gettimeofday
c_func
(paren
op_amp
id|sk-&gt;sk_stamp
)paren
suffix:semicolon
r_return
id|copy_to_user
c_func
(paren
id|userstamp
comma
op_amp
id|sk-&gt;sk_stamp
comma
r_sizeof
(paren
r_struct
id|timeval
)paren
)paren
ques
c_cond
op_minus
id|EFAULT
suffix:colon
l_int|0
suffix:semicolon
)brace
DECL|variable|sock_get_timestamp
id|EXPORT_SYMBOL
c_func
(paren
id|sock_get_timestamp
)paren
suffix:semicolon
DECL|function|sock_enable_timestamp
r_void
id|sock_enable_timestamp
c_func
(paren
r_struct
id|sock
op_star
id|sk
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|sock_flag
c_func
(paren
id|sk
comma
id|SOCK_TIMESTAMP
)paren
)paren
(brace
id|sock_set_flag
c_func
(paren
id|sk
comma
id|SOCK_TIMESTAMP
)paren
suffix:semicolon
id|net_enable_timestamp
c_func
(paren
)paren
suffix:semicolon
)brace
)brace
DECL|variable|sock_enable_timestamp
id|EXPORT_SYMBOL
c_func
(paren
id|sock_enable_timestamp
)paren
suffix:semicolon
multiline_comment|/*&n; *&t;Get a socket option on an socket.&n; *&n; *&t;FIX: POSIX 1003.1g is very ambiguous here. It states that&n; *&t;asynchronous errors should be reported by getsockopt. We assume&n; *&t;this means if you specify SO_ERROR (otherwise whats the point of it).&n; */
DECL|function|sock_common_getsockopt
r_int
id|sock_common_getsockopt
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_int
id|level
comma
r_int
id|optname
comma
r_char
id|__user
op_star
id|optval
comma
r_int
id|__user
op_star
id|optlen
)paren
(brace
r_struct
id|sock
op_star
id|sk
op_assign
id|sock-&gt;sk
suffix:semicolon
r_return
id|sk-&gt;sk_prot
op_member_access_from_pointer
id|getsockopt
c_func
(paren
id|sk
comma
id|level
comma
id|optname
comma
id|optval
comma
id|optlen
)paren
suffix:semicolon
)brace
DECL|variable|sock_common_getsockopt
id|EXPORT_SYMBOL
c_func
(paren
id|sock_common_getsockopt
)paren
suffix:semicolon
DECL|function|sock_common_recvmsg
r_int
id|sock_common_recvmsg
c_func
(paren
r_struct
id|kiocb
op_star
id|iocb
comma
r_struct
id|socket
op_star
id|sock
comma
r_struct
id|msghdr
op_star
id|msg
comma
r_int
id|size
comma
r_int
id|flags
)paren
(brace
r_struct
id|sock
op_star
id|sk
op_assign
id|sock-&gt;sk
suffix:semicolon
r_int
id|addr_len
op_assign
l_int|0
suffix:semicolon
r_int
id|err
suffix:semicolon
id|err
op_assign
id|sk-&gt;sk_prot
op_member_access_from_pointer
id|recvmsg
c_func
(paren
id|iocb
comma
id|sk
comma
id|msg
comma
id|size
comma
id|flags
op_amp
id|MSG_DONTWAIT
comma
id|flags
op_amp
op_complement
id|MSG_DONTWAIT
comma
op_amp
id|addr_len
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
op_ge
l_int|0
)paren
id|msg-&gt;msg_namelen
op_assign
id|addr_len
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|variable|sock_common_recvmsg
id|EXPORT_SYMBOL
c_func
(paren
id|sock_common_recvmsg
)paren
suffix:semicolon
multiline_comment|/*&n; *&t;Set socket options on an inet socket.&n; */
DECL|function|sock_common_setsockopt
r_int
id|sock_common_setsockopt
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_int
id|level
comma
r_int
id|optname
comma
r_char
id|__user
op_star
id|optval
comma
r_int
id|optlen
)paren
(brace
r_struct
id|sock
op_star
id|sk
op_assign
id|sock-&gt;sk
suffix:semicolon
r_return
id|sk-&gt;sk_prot
op_member_access_from_pointer
id|setsockopt
c_func
(paren
id|sk
comma
id|level
comma
id|optname
comma
id|optval
comma
id|optlen
)paren
suffix:semicolon
)brace
DECL|variable|sock_common_setsockopt
id|EXPORT_SYMBOL
c_func
(paren
id|sock_common_setsockopt
)paren
suffix:semicolon
DECL|function|sk_common_release
r_void
id|sk_common_release
c_func
(paren
r_struct
id|sock
op_star
id|sk
)paren
(brace
r_if
c_cond
(paren
id|sk-&gt;sk_prot-&gt;destroy
)paren
id|sk-&gt;sk_prot
op_member_access_from_pointer
id|destroy
c_func
(paren
id|sk
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Observation: when sock_common_release is called, processes have&n;&t; * no access to socket. But net still has.&n;&t; * Step one, detach it from networking:&n;&t; *&n;&t; * A. Remove from hash tables.&n;&t; */
id|sk-&gt;sk_prot
op_member_access_from_pointer
id|unhash
c_func
(paren
id|sk
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * In this point socket cannot receive new packets, but it is possible&n;&t; * that some packets are in flight because some CPU runs receiver and&n;&t; * did hash table lookup before we unhashed socket. They will achieve&n;&t; * receive queue and will be purged by socket destructor.&n;&t; *&n;&t; * Also we still have packets pending on receive queue and probably,&n;&t; * our own packets waiting in device queues. sock_destroy will drain&n;&t; * receive queue, but transmitted packets will delay socket destruction&n;&t; * until the last reference will be released.&n;&t; */
id|sock_orphan
c_func
(paren
id|sk
)paren
suffix:semicolon
id|xfrm_sk_free_policy
c_func
(paren
id|sk
)paren
suffix:semicolon
macro_line|#ifdef INET_REFCNT_DEBUG
r_if
c_cond
(paren
id|atomic_read
c_func
(paren
op_amp
id|sk-&gt;sk_refcnt
)paren
op_ne
l_int|1
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;Destruction of the socket %p delayed, c=%d&bslash;n&quot;
comma
id|sk
comma
id|atomic_read
c_func
(paren
op_amp
id|sk-&gt;sk_refcnt
)paren
)paren
suffix:semicolon
macro_line|#endif
id|sock_put
c_func
(paren
id|sk
)paren
suffix:semicolon
)brace
DECL|variable|sk_common_release
id|EXPORT_SYMBOL
c_func
(paren
id|sk_common_release
)paren
suffix:semicolon
DECL|function|sk_alloc_slab
r_int
id|sk_alloc_slab
c_func
(paren
r_struct
id|proto
op_star
id|prot
comma
r_char
op_star
id|name
)paren
(brace
id|prot-&gt;slab
op_assign
id|kmem_cache_create
c_func
(paren
id|name
comma
id|prot-&gt;slab_obj_size
comma
l_int|0
comma
id|SLAB_HWCACHE_ALIGN
comma
l_int|NULL
comma
l_int|NULL
)paren
suffix:semicolon
r_return
id|prot-&gt;slab
op_ne
l_int|NULL
ques
c_cond
l_int|0
suffix:colon
op_minus
id|ENOBUFS
suffix:semicolon
)brace
DECL|variable|sk_alloc_slab
id|EXPORT_SYMBOL
c_func
(paren
id|sk_alloc_slab
)paren
suffix:semicolon
DECL|function|sk_free_slab
r_void
id|sk_free_slab
c_func
(paren
r_struct
id|proto
op_star
id|prot
)paren
(brace
r_if
c_cond
(paren
id|prot-&gt;slab
op_ne
l_int|NULL
)paren
(brace
id|kmem_cache_destroy
c_func
(paren
id|prot-&gt;slab
)paren
suffix:semicolon
id|prot-&gt;slab
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
DECL|variable|sk_free_slab
id|EXPORT_SYMBOL
c_func
(paren
id|sk_free_slab
)paren
suffix:semicolon
DECL|variable|sk_alloc
id|EXPORT_SYMBOL
c_func
(paren
id|sk_alloc
)paren
suffix:semicolon
DECL|variable|sk_free
id|EXPORT_SYMBOL
c_func
(paren
id|sk_free
)paren
suffix:semicolon
DECL|variable|sk_send_sigurg
id|EXPORT_SYMBOL
c_func
(paren
id|sk_send_sigurg
)paren
suffix:semicolon
DECL|variable|sock_alloc_send_pskb
id|EXPORT_SYMBOL
c_func
(paren
id|sock_alloc_send_pskb
)paren
suffix:semicolon
DECL|variable|sock_alloc_send_skb
id|EXPORT_SYMBOL
c_func
(paren
id|sock_alloc_send_skb
)paren
suffix:semicolon
DECL|variable|sock_init_data
id|EXPORT_SYMBOL
c_func
(paren
id|sock_init_data
)paren
suffix:semicolon
DECL|variable|sock_kfree_s
id|EXPORT_SYMBOL
c_func
(paren
id|sock_kfree_s
)paren
suffix:semicolon
DECL|variable|sock_kmalloc
id|EXPORT_SYMBOL
c_func
(paren
id|sock_kmalloc
)paren
suffix:semicolon
DECL|variable|sock_no_accept
id|EXPORT_SYMBOL
c_func
(paren
id|sock_no_accept
)paren
suffix:semicolon
DECL|variable|sock_no_bind
id|EXPORT_SYMBOL
c_func
(paren
id|sock_no_bind
)paren
suffix:semicolon
DECL|variable|sock_no_connect
id|EXPORT_SYMBOL
c_func
(paren
id|sock_no_connect
)paren
suffix:semicolon
DECL|variable|sock_no_getname
id|EXPORT_SYMBOL
c_func
(paren
id|sock_no_getname
)paren
suffix:semicolon
DECL|variable|sock_no_getsockopt
id|EXPORT_SYMBOL
c_func
(paren
id|sock_no_getsockopt
)paren
suffix:semicolon
DECL|variable|sock_no_ioctl
id|EXPORT_SYMBOL
c_func
(paren
id|sock_no_ioctl
)paren
suffix:semicolon
DECL|variable|sock_no_listen
id|EXPORT_SYMBOL
c_func
(paren
id|sock_no_listen
)paren
suffix:semicolon
DECL|variable|sock_no_mmap
id|EXPORT_SYMBOL
c_func
(paren
id|sock_no_mmap
)paren
suffix:semicolon
DECL|variable|sock_no_poll
id|EXPORT_SYMBOL
c_func
(paren
id|sock_no_poll
)paren
suffix:semicolon
DECL|variable|sock_no_recvmsg
id|EXPORT_SYMBOL
c_func
(paren
id|sock_no_recvmsg
)paren
suffix:semicolon
DECL|variable|sock_no_sendmsg
id|EXPORT_SYMBOL
c_func
(paren
id|sock_no_sendmsg
)paren
suffix:semicolon
DECL|variable|sock_no_sendpage
id|EXPORT_SYMBOL
c_func
(paren
id|sock_no_sendpage
)paren
suffix:semicolon
DECL|variable|sock_no_setsockopt
id|EXPORT_SYMBOL
c_func
(paren
id|sock_no_setsockopt
)paren
suffix:semicolon
DECL|variable|sock_no_shutdown
id|EXPORT_SYMBOL
c_func
(paren
id|sock_no_shutdown
)paren
suffix:semicolon
DECL|variable|sock_no_socketpair
id|EXPORT_SYMBOL
c_func
(paren
id|sock_no_socketpair
)paren
suffix:semicolon
DECL|variable|sock_rfree
id|EXPORT_SYMBOL
c_func
(paren
id|sock_rfree
)paren
suffix:semicolon
DECL|variable|sock_setsockopt
id|EXPORT_SYMBOL
c_func
(paren
id|sock_setsockopt
)paren
suffix:semicolon
DECL|variable|sock_wfree
id|EXPORT_SYMBOL
c_func
(paren
id|sock_wfree
)paren
suffix:semicolon
DECL|variable|sock_wmalloc
id|EXPORT_SYMBOL
c_func
(paren
id|sock_wmalloc
)paren
suffix:semicolon
DECL|variable|sock_i_uid
id|EXPORT_SYMBOL
c_func
(paren
id|sock_i_uid
)paren
suffix:semicolon
DECL|variable|sock_i_ino
id|EXPORT_SYMBOL
c_func
(paren
id|sock_i_ino
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_SYSCTL
DECL|variable|sysctl_optmem_max
id|EXPORT_SYMBOL
c_func
(paren
id|sysctl_optmem_max
)paren
suffix:semicolon
DECL|variable|sysctl_rmem_max
id|EXPORT_SYMBOL
c_func
(paren
id|sysctl_rmem_max
)paren
suffix:semicolon
DECL|variable|sysctl_wmem_max
id|EXPORT_SYMBOL
c_func
(paren
id|sysctl_wmem_max
)paren
suffix:semicolon
macro_line|#endif
eof
