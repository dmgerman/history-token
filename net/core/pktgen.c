multiline_comment|/* -*-linux-c-*-&n; * $Id: pktgen.c,v 1.8 2002/07/15 19:30:17 robert Exp $&n; * pktgen.c: Packet Generator for performance evaluation.&n; *&n; * Copyright 2001, 2002 by Robert Olsson &lt;robert.olsson@its.uu.se&gt;&n; *&t;&t;&t;&t; Uppsala University, Sweden&n; *&n; * A tool for loading the network with preconfigurated packets.&n; * The tool is implemented as a linux module.  Parameters are output &n; * device, IPG (interpacket gap), number of packets, and whether&n; * to use multiple SKBs or just the same one.&n; * pktgen uses the installed interface&squot;s output routine.&n; *&n; * Additional hacking by:&n; *&n; * Jens.Laas@data.slu.se&n; * Improved by ANK. 010120.&n; * Improved by ANK even more. 010212.&n; * MAC address typo fixed. 010417 --ro&n; * Integrated.  020301 --DaveM&n; * Added multiskb option 020301 --DaveM&n; * Scaling of results. 020417--sigurdur@linpro.no&n; * Significant re-work of the module:&n; *   *  Updated to support generation over multiple interfaces at once&n; *       by creating 32 /proc/net/pg* files.  Each file can be manipulated&n; *       individually.&n; *   *  Converted many counters to __u64 to allow longer runs.&n; *   *  Allow configuration of ranges, like min/max IP address, MACs,&n; *       and UDP-ports, for both source and destination, and can&n; *       set to use a random distribution or sequentially walk the range.&n; *   *  Can now change some values after starting.&n; *   *  Place 12-byte packet in UDP payload with magic number,&n; *       sequence number, and timestamp.  Will write receiver next.&n; *   *  The new changes seem to have a performance impact of around 1%,&n; *       as far as I can tell.&n; *   --Ben Greear &lt;greearb@candelatech.com&gt;&n; * Integrated to 2.5.x 021029 --Lucio Maciel (luciomaciel@zipmail.com.br)&n; *&n; * Renamed multiskb to clone_skb and cleaned up sending core for two distinct &n; * skb modes. A clone_skb=0 mode for Ben &quot;ranges&quot; work and a clone_skb != 0 &n; * as a &quot;fastpath&quot; with a configurable number of clones after alloc&squot;s.&n; *&n; * clone_skb=0 means all packets are allocated this also means ranges time &n; * stamps etc can be used. clone_skb=100 means 1 malloc is followed by 100 &n; * clones.&n; *&n; * Also moved to /proc/net/pktgen/ &n; * --ro &n; *&n; * Fix refcount off by one if first packet fails, potential null deref, &n; * memleak 030710- KJP&n; *&n; * Fixed unaligned access on IA-64 Grant Grundler &lt;grundler@parisc-linux.org&gt;&n; *&n; * New xmit() return, do_div and misc clean up by Stephen Hemminger &n; * &lt;shemminger@osdl.org&gt; 040923&n; *&n; * See Documentation/networking/pktgen.txt for how to use this.&n; */
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/moduleparam.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/ptrace.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/ioport.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/inet.h&gt;
macro_line|#include &lt;linux/rcupdate.h&gt;
macro_line|#include &lt;linux/bitops.h&gt;
macro_line|#include &lt;asm/byteorder.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/dma.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;linux/in.h&gt;
macro_line|#include &lt;linux/ip.h&gt;
macro_line|#include &lt;linux/udp.h&gt;
macro_line|#include &lt;linux/skbuff.h&gt;
macro_line|#include &lt;linux/netdevice.h&gt;
macro_line|#include &lt;linux/inetdevice.h&gt;
macro_line|#include &lt;linux/rtnetlink.h&gt;
macro_line|#include &lt;linux/proc_fs.h&gt;
macro_line|#include &lt;linux/if_arp.h&gt;
macro_line|#include &lt;net/checksum.h&gt;
macro_line|#include &lt;asm/timex.h&gt;
DECL|macro|cycles
mdefine_line|#define cycles()&t;((u32)get_cycles())
DECL|macro|VERSION
mdefine_line|#define VERSION &quot;pktgen version 1.32&quot;
DECL|variable|__initdata
r_static
r_char
id|version
(braket
)braket
id|__initdata
op_assign
l_string|&quot;pktgen.c: v1.4: Packet Generator for packet performance testing.&bslash;n&quot;
suffix:semicolon
multiline_comment|/* Used to help with determining the pkts on receive */
DECL|macro|PKTGEN_MAGIC
mdefine_line|#define PKTGEN_MAGIC 0xbe9be955
multiline_comment|/* Keep information per interface */
DECL|struct|pktgen_info
r_struct
id|pktgen_info
(brace
multiline_comment|/* Parameters */
multiline_comment|/* If min != max, then we will either do a linear iteration, or&n;&t; * we will do a random selection from within the range.&n;&t; */
DECL|member|flags
id|__u32
id|flags
suffix:semicolon
DECL|macro|F_IPSRC_RND
mdefine_line|#define F_IPSRC_RND   (1&lt;&lt;0)  /* IP-Src Random  */
DECL|macro|F_IPDST_RND
mdefine_line|#define F_IPDST_RND   (1&lt;&lt;1)  /* IP-Dst Random  */
DECL|macro|F_UDPSRC_RND
mdefine_line|#define F_UDPSRC_RND  (1&lt;&lt;2)  /* UDP-Src Random */
DECL|macro|F_UDPDST_RND
mdefine_line|#define F_UDPDST_RND  (1&lt;&lt;3)  /* UDP-Dst Random */
DECL|macro|F_MACSRC_RND
mdefine_line|#define F_MACSRC_RND  (1&lt;&lt;4)  /* MAC-Src Random */
DECL|macro|F_MACDST_RND
mdefine_line|#define F_MACDST_RND  (1&lt;&lt;5)  /* MAC-Dst Random */
DECL|macro|F_SET_SRCMAC
mdefine_line|#define F_SET_SRCMAC  (1&lt;&lt;6)  /* Specify-Src-Mac &n;&t;&t;&t;&t; (default is to use Interface&squot;s MAC Addr) */
DECL|macro|F_SET_SRCIP
mdefine_line|#define F_SET_SRCIP   (1&lt;&lt;7)  /*  Specify-Src-IP&n;&t;&t;&t;&t;  (default is to use Interface&squot;s IP Addr) */ 
DECL|member|pkt_size
r_int
id|pkt_size
suffix:semicolon
multiline_comment|/* = ETH_ZLEN; */
DECL|member|nfrags
r_int
id|nfrags
suffix:semicolon
DECL|member|ipg
id|__u32
id|ipg
suffix:semicolon
multiline_comment|/* Default Interpacket gap in nsec */
DECL|member|count
id|__u64
id|count
suffix:semicolon
multiline_comment|/* Default No packets to send */
DECL|member|sofar
id|__u64
id|sofar
suffix:semicolon
multiline_comment|/* How many pkts we&squot;ve sent so far */
DECL|member|errors
id|__u64
id|errors
suffix:semicolon
multiline_comment|/* Errors when trying to transmit, pkts will be re-sent */
DECL|member|started_at
r_struct
id|timeval
id|started_at
suffix:semicolon
DECL|member|stopped_at
r_struct
id|timeval
id|stopped_at
suffix:semicolon
DECL|member|idle_acc
id|__u64
id|idle_acc
suffix:semicolon
DECL|member|seq_num
id|__u32
id|seq_num
suffix:semicolon
DECL|member|clone_skb
r_int
id|clone_skb
suffix:semicolon
multiline_comment|/* Use multiple SKBs during packet gen.  If this number&n;&t;&t;&t;  * is greater than 1, then that many coppies of the same&n;&t;&t;&t;  * packet will be sent before a new packet is allocated.&n;&t;&t;&t;  * For instance, if you want to send 1024 identical packets&n;&t;&t;&t;  * before creating a new packet, set clone_skb to 1024.&n;&t;&t;&t;  */
DECL|member|busy
r_int
id|busy
suffix:semicolon
DECL|member|do_run_run
r_int
id|do_run_run
suffix:semicolon
multiline_comment|/* if this changes to false, the test will stop */
DECL|member|outdev
r_char
id|outdev
(braket
l_int|32
)braket
suffix:semicolon
DECL|member|dst_min
r_char
id|dst_min
(braket
l_int|32
)braket
suffix:semicolon
DECL|member|dst_max
r_char
id|dst_max
(braket
l_int|32
)braket
suffix:semicolon
DECL|member|src_min
r_char
id|src_min
(braket
l_int|32
)braket
suffix:semicolon
DECL|member|src_max
r_char
id|src_max
(braket
l_int|32
)braket
suffix:semicolon
multiline_comment|/* If we&squot;re doing ranges, random or incremental, then this&n;&t; * defines the min/max for those ranges.&n;&t; */
DECL|member|saddr_min
id|__u32
id|saddr_min
suffix:semicolon
multiline_comment|/* inclusive, source IP address */
DECL|member|saddr_max
id|__u32
id|saddr_max
suffix:semicolon
multiline_comment|/* exclusive, source IP address */
DECL|member|daddr_min
id|__u32
id|daddr_min
suffix:semicolon
multiline_comment|/* inclusive, dest IP address */
DECL|member|daddr_max
id|__u32
id|daddr_max
suffix:semicolon
multiline_comment|/* exclusive, dest IP address */
DECL|member|udp_src_min
id|__u16
id|udp_src_min
suffix:semicolon
multiline_comment|/* inclusive, source UDP port */
DECL|member|udp_src_max
id|__u16
id|udp_src_max
suffix:semicolon
multiline_comment|/* exclusive, source UDP port */
DECL|member|udp_dst_min
id|__u16
id|udp_dst_min
suffix:semicolon
multiline_comment|/* inclusive, dest UDP port */
DECL|member|udp_dst_max
id|__u16
id|udp_dst_max
suffix:semicolon
multiline_comment|/* exclusive, dest UDP port */
DECL|member|src_mac_count
id|__u32
id|src_mac_count
suffix:semicolon
multiline_comment|/* How many MACs to iterate through */
DECL|member|dst_mac_count
id|__u32
id|dst_mac_count
suffix:semicolon
multiline_comment|/* How many MACs to iterate through */
DECL|member|dst_mac
r_int
r_char
id|dst_mac
(braket
l_int|6
)braket
suffix:semicolon
DECL|member|src_mac
r_int
r_char
id|src_mac
(braket
l_int|6
)braket
suffix:semicolon
DECL|member|cur_dst_mac_offset
id|__u32
id|cur_dst_mac_offset
suffix:semicolon
DECL|member|cur_src_mac_offset
id|__u32
id|cur_src_mac_offset
suffix:semicolon
DECL|member|cur_saddr
id|__u32
id|cur_saddr
suffix:semicolon
DECL|member|cur_daddr
id|__u32
id|cur_daddr
suffix:semicolon
DECL|member|cur_udp_dst
id|__u16
id|cur_udp_dst
suffix:semicolon
DECL|member|cur_udp_src
id|__u16
id|cur_udp_src
suffix:semicolon
DECL|member|hh
id|__u8
id|hh
(braket
l_int|14
)braket
suffix:semicolon
multiline_comment|/* = { &n;&t;   0x00, 0x80, 0xC8, 0x79, 0xB3, 0xCB, &n;&t;   &n;&t;   We fill in SRC address later&n;&t;   0x00, 0x00, 0x00, 0x00, 0x00, 0x00,&n;&t;   0x08, 0x00&n;&t;   };&n;&t;*/
DECL|member|pad
id|__u16
id|pad
suffix:semicolon
multiline_comment|/* pad out the hh struct to an even 16 bytes */
DECL|member|result
r_char
id|result
(braket
l_int|512
)braket
suffix:semicolon
multiline_comment|/* proc file names */
DECL|member|fname
r_char
id|fname
(braket
l_int|80
)braket
suffix:semicolon
DECL|member|busy_fname
r_char
id|busy_fname
(braket
l_int|80
)braket
suffix:semicolon
DECL|member|proc_ent
r_struct
id|proc_dir_entry
op_star
id|proc_ent
suffix:semicolon
DECL|member|busy_proc_ent
r_struct
id|proc_dir_entry
op_star
id|busy_proc_ent
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|pktgen_hdr
r_struct
id|pktgen_hdr
(brace
DECL|member|pgh_magic
id|__u32
id|pgh_magic
suffix:semicolon
DECL|member|seq_num
id|__u32
id|seq_num
suffix:semicolon
DECL|member|tv_sec
id|__u32
id|tv_sec
suffix:semicolon
DECL|member|tv_usec
id|__u32
id|tv_usec
suffix:semicolon
)brace
suffix:semicolon
DECL|variable|cpu_speed
r_static
r_int
id|cpu_speed
suffix:semicolon
DECL|variable|debug
r_static
r_int
id|debug
suffix:semicolon
multiline_comment|/* Module parameters, defaults. */
DECL|variable|count_d
r_static
r_int
id|count_d
op_assign
l_int|100000
suffix:semicolon
DECL|variable|ipg_d
r_static
r_int
id|ipg_d
suffix:semicolon
DECL|variable|clone_skb_d
r_static
r_int
id|clone_skb_d
suffix:semicolon
DECL|macro|MAX_PKTGEN
mdefine_line|#define MAX_PKTGEN 8
DECL|variable|pginfos
r_static
r_struct
id|pktgen_info
id|pginfos
(braket
id|MAX_PKTGEN
)braket
suffix:semicolon
multiline_comment|/** Convert to miliseconds */
DECL|function|tv_to_ms
r_static
r_inline
id|__u64
id|tv_to_ms
c_func
(paren
r_const
r_struct
id|timeval
op_star
id|tv
)paren
(brace
id|__u64
id|ms
op_assign
id|tv-&gt;tv_usec
op_div
l_int|1000
suffix:semicolon
id|ms
op_add_assign
(paren
id|__u64
)paren
id|tv-&gt;tv_sec
op_star
(paren
id|__u64
)paren
l_int|1000
suffix:semicolon
r_return
id|ms
suffix:semicolon
)brace
DECL|function|getCurMs
r_static
r_inline
id|__u64
id|getCurMs
c_func
(paren
r_void
)paren
(brace
r_struct
id|timeval
id|tv
suffix:semicolon
id|do_gettimeofday
c_func
(paren
op_amp
id|tv
)paren
suffix:semicolon
r_return
id|tv_to_ms
c_func
(paren
op_amp
id|tv
)paren
suffix:semicolon
)brace
DECL|macro|PG_PROC_DIR
mdefine_line|#define PG_PROC_DIR &quot;pktgen&quot;
DECL|variable|proc_dir
r_static
r_struct
id|proc_dir_entry
op_star
id|proc_dir
suffix:semicolon
DECL|function|setup_inject
r_static
r_struct
id|net_device
op_star
id|setup_inject
c_func
(paren
r_struct
id|pktgen_info
op_star
id|info
)paren
(brace
r_struct
id|net_device
op_star
id|odev
suffix:semicolon
id|odev
op_assign
id|dev_get_by_name
c_func
(paren
id|info-&gt;outdev
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|odev
)paren
(brace
id|sprintf
c_func
(paren
id|info-&gt;result
comma
l_string|&quot;No such netdevice: &bslash;&quot;%s&bslash;&quot;&quot;
comma
id|info-&gt;outdev
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_if
c_cond
(paren
id|odev-&gt;type
op_ne
id|ARPHRD_ETHER
)paren
(brace
id|sprintf
c_func
(paren
id|info-&gt;result
comma
l_string|&quot;Not ethernet device: &bslash;&quot;%s&bslash;&quot;&quot;
comma
id|info-&gt;outdev
)paren
suffix:semicolon
r_goto
id|out_put
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|netif_running
c_func
(paren
id|odev
)paren
)paren
(brace
id|sprintf
c_func
(paren
id|info-&gt;result
comma
l_string|&quot;Device is down: &bslash;&quot;%s&bslash;&quot;&quot;
comma
id|info-&gt;outdev
)paren
suffix:semicolon
r_goto
id|out_put
suffix:semicolon
)brace
multiline_comment|/* Default to the interface&squot;s mac if not explicitly set. */
r_if
c_cond
(paren
op_logical_neg
(paren
id|info-&gt;flags
op_amp
id|F_SET_SRCMAC
)paren
)paren
(brace
id|memcpy
c_func
(paren
op_amp
(paren
id|info-&gt;hh
(braket
l_int|6
)braket
)paren
comma
id|odev-&gt;dev_addr
comma
l_int|6
)paren
suffix:semicolon
)brace
r_else
(brace
id|memcpy
c_func
(paren
op_amp
(paren
id|info-&gt;hh
(braket
l_int|6
)braket
)paren
comma
id|info-&gt;src_mac
comma
l_int|6
)paren
suffix:semicolon
)brace
multiline_comment|/* Set up Dest MAC */
id|memcpy
c_func
(paren
op_amp
(paren
id|info-&gt;hh
(braket
l_int|0
)braket
)paren
comma
id|info-&gt;dst_mac
comma
l_int|6
)paren
suffix:semicolon
id|info-&gt;saddr_min
op_assign
l_int|0
suffix:semicolon
id|info-&gt;saddr_max
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|strlen
c_func
(paren
id|info-&gt;src_min
)paren
op_eq
l_int|0
)paren
(brace
r_struct
id|in_device
op_star
id|in_dev
suffix:semicolon
id|rcu_read_lock
c_func
(paren
)paren
suffix:semicolon
id|in_dev
op_assign
id|__in_dev_get
c_func
(paren
id|odev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|in_dev
)paren
(brace
r_if
c_cond
(paren
id|in_dev-&gt;ifa_list
)paren
(brace
id|info-&gt;saddr_min
op_assign
id|in_dev-&gt;ifa_list-&gt;ifa_address
suffix:semicolon
id|info-&gt;saddr_max
op_assign
id|info-&gt;saddr_min
suffix:semicolon
)brace
)brace
id|rcu_read_unlock
c_func
(paren
)paren
suffix:semicolon
)brace
r_else
(brace
id|info-&gt;saddr_min
op_assign
id|in_aton
c_func
(paren
id|info-&gt;src_min
)paren
suffix:semicolon
id|info-&gt;saddr_max
op_assign
id|in_aton
c_func
(paren
id|info-&gt;src_max
)paren
suffix:semicolon
)brace
id|info-&gt;daddr_min
op_assign
id|in_aton
c_func
(paren
id|info-&gt;dst_min
)paren
suffix:semicolon
id|info-&gt;daddr_max
op_assign
id|in_aton
c_func
(paren
id|info-&gt;dst_max
)paren
suffix:semicolon
multiline_comment|/* Initialize current values. */
id|info-&gt;cur_dst_mac_offset
op_assign
l_int|0
suffix:semicolon
id|info-&gt;cur_src_mac_offset
op_assign
l_int|0
suffix:semicolon
id|info-&gt;cur_saddr
op_assign
id|info-&gt;saddr_min
suffix:semicolon
id|info-&gt;cur_daddr
op_assign
id|info-&gt;daddr_min
suffix:semicolon
id|info-&gt;cur_udp_dst
op_assign
id|info-&gt;udp_dst_min
suffix:semicolon
id|info-&gt;cur_udp_src
op_assign
id|info-&gt;udp_src_min
suffix:semicolon
r_return
id|odev
suffix:semicolon
id|out_put
suffix:colon
id|dev_put
c_func
(paren
id|odev
)paren
suffix:semicolon
id|out
suffix:colon
r_return
l_int|NULL
suffix:semicolon
)brace
DECL|function|nanospin
r_static
r_void
id|nanospin
c_func
(paren
r_int
id|ipg
comma
r_struct
id|pktgen_info
op_star
id|info
)paren
(brace
id|u32
id|idle_start
comma
id|idle
suffix:semicolon
id|idle_start
op_assign
id|cycles
c_func
(paren
)paren
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
(brace
id|barrier
c_func
(paren
)paren
suffix:semicolon
id|idle
op_assign
id|cycles
c_func
(paren
)paren
op_minus
id|idle_start
suffix:semicolon
r_if
c_cond
(paren
id|idle
op_star
l_int|1000
op_ge
id|ipg
op_star
id|cpu_speed
)paren
r_break
suffix:semicolon
)brace
id|info-&gt;idle_acc
op_add_assign
id|idle
suffix:semicolon
)brace
DECL|function|calc_mhz
r_static
r_int
id|calc_mhz
c_func
(paren
r_void
)paren
(brace
r_struct
id|timeval
id|start
comma
id|stop
suffix:semicolon
id|u32
id|start_s
comma
id|elapsed
suffix:semicolon
id|do_gettimeofday
c_func
(paren
op_amp
id|start
)paren
suffix:semicolon
id|start_s
op_assign
id|cycles
c_func
(paren
)paren
suffix:semicolon
r_do
(brace
id|barrier
c_func
(paren
)paren
suffix:semicolon
id|elapsed
op_assign
id|cycles
c_func
(paren
)paren
op_minus
id|start_s
suffix:semicolon
r_if
c_cond
(paren
id|elapsed
op_eq
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
)brace
r_while
c_loop
(paren
id|elapsed
OL
l_int|1000
op_star
l_int|50000
)paren
suffix:semicolon
id|do_gettimeofday
c_func
(paren
op_amp
id|stop
)paren
suffix:semicolon
r_return
id|elapsed
op_div
(paren
id|stop.tv_usec
op_minus
id|start.tv_usec
op_plus
l_int|1000000
op_star
(paren
id|stop.tv_sec
op_minus
id|start.tv_sec
)paren
)paren
suffix:semicolon
)brace
DECL|function|cycles_calibrate
r_static
r_void
id|cycles_calibrate
c_func
(paren
r_void
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|3
suffix:semicolon
id|i
op_increment
)paren
(brace
r_int
id|res
op_assign
id|calc_mhz
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|res
OG
id|cpu_speed
)paren
id|cpu_speed
op_assign
id|res
suffix:semicolon
)brace
)brace
multiline_comment|/* Increment/randomize headers according to flags and current values&n; * for IP src/dest, UDP src/dst port, MAC-Addr src/dst&n; */
DECL|function|mod_cur_headers
r_static
r_void
id|mod_cur_headers
c_func
(paren
r_struct
id|pktgen_info
op_star
id|info
)paren
(brace
id|__u32
id|imn
suffix:semicolon
id|__u32
id|imx
suffix:semicolon
multiline_comment|/*  Deal with source MAC */
r_if
c_cond
(paren
id|info-&gt;src_mac_count
OG
l_int|1
)paren
(brace
id|__u32
id|mc
suffix:semicolon
id|__u32
id|tmp
suffix:semicolon
r_if
c_cond
(paren
id|info-&gt;flags
op_amp
id|F_MACSRC_RND
)paren
(brace
id|mc
op_assign
id|net_random
c_func
(paren
)paren
op_mod
(paren
id|info-&gt;src_mac_count
)paren
suffix:semicolon
)brace
r_else
(brace
id|mc
op_assign
id|info-&gt;cur_src_mac_offset
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|info-&gt;cur_src_mac_offset
OG
id|info-&gt;src_mac_count
)paren
(brace
id|info-&gt;cur_src_mac_offset
op_assign
l_int|0
suffix:semicolon
)brace
)brace
id|tmp
op_assign
id|info-&gt;src_mac
(braket
l_int|5
)braket
op_plus
(paren
id|mc
op_amp
l_int|0xFF
)paren
suffix:semicolon
id|info-&gt;hh
(braket
l_int|11
)braket
op_assign
id|tmp
suffix:semicolon
id|tmp
op_assign
(paren
id|info-&gt;src_mac
(braket
l_int|4
)braket
op_plus
(paren
(paren
id|mc
op_rshift
l_int|8
)paren
op_amp
l_int|0xFF
)paren
op_plus
(paren
id|tmp
op_rshift
l_int|8
)paren
)paren
suffix:semicolon
id|info-&gt;hh
(braket
l_int|10
)braket
op_assign
id|tmp
suffix:semicolon
id|tmp
op_assign
(paren
id|info-&gt;src_mac
(braket
l_int|3
)braket
op_plus
(paren
(paren
id|mc
op_rshift
l_int|16
)paren
op_amp
l_int|0xFF
)paren
op_plus
(paren
id|tmp
op_rshift
l_int|8
)paren
)paren
suffix:semicolon
id|info-&gt;hh
(braket
l_int|9
)braket
op_assign
id|tmp
suffix:semicolon
id|tmp
op_assign
(paren
id|info-&gt;src_mac
(braket
l_int|2
)braket
op_plus
(paren
(paren
id|mc
op_rshift
l_int|24
)paren
op_amp
l_int|0xFF
)paren
op_plus
(paren
id|tmp
op_rshift
l_int|8
)paren
)paren
suffix:semicolon
id|info-&gt;hh
(braket
l_int|8
)braket
op_assign
id|tmp
suffix:semicolon
id|tmp
op_assign
(paren
id|info-&gt;src_mac
(braket
l_int|1
)braket
op_plus
(paren
id|tmp
op_rshift
l_int|8
)paren
)paren
suffix:semicolon
id|info-&gt;hh
(braket
l_int|7
)braket
op_assign
id|tmp
suffix:semicolon
)brace
multiline_comment|/*  Deal with Destination MAC */
r_if
c_cond
(paren
id|info-&gt;dst_mac_count
OG
l_int|1
)paren
(brace
id|__u32
id|mc
suffix:semicolon
id|__u32
id|tmp
suffix:semicolon
r_if
c_cond
(paren
id|info-&gt;flags
op_amp
id|F_MACDST_RND
)paren
(brace
id|mc
op_assign
id|net_random
c_func
(paren
)paren
op_mod
(paren
id|info-&gt;dst_mac_count
)paren
suffix:semicolon
)brace
r_else
(brace
id|mc
op_assign
id|info-&gt;cur_dst_mac_offset
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|info-&gt;cur_dst_mac_offset
OG
id|info-&gt;dst_mac_count
)paren
(brace
id|info-&gt;cur_dst_mac_offset
op_assign
l_int|0
suffix:semicolon
)brace
)brace
id|tmp
op_assign
id|info-&gt;dst_mac
(braket
l_int|5
)braket
op_plus
(paren
id|mc
op_amp
l_int|0xFF
)paren
suffix:semicolon
id|info-&gt;hh
(braket
l_int|5
)braket
op_assign
id|tmp
suffix:semicolon
id|tmp
op_assign
(paren
id|info-&gt;dst_mac
(braket
l_int|4
)braket
op_plus
(paren
(paren
id|mc
op_rshift
l_int|8
)paren
op_amp
l_int|0xFF
)paren
op_plus
(paren
id|tmp
op_rshift
l_int|8
)paren
)paren
suffix:semicolon
id|info-&gt;hh
(braket
l_int|4
)braket
op_assign
id|tmp
suffix:semicolon
id|tmp
op_assign
(paren
id|info-&gt;dst_mac
(braket
l_int|3
)braket
op_plus
(paren
(paren
id|mc
op_rshift
l_int|16
)paren
op_amp
l_int|0xFF
)paren
op_plus
(paren
id|tmp
op_rshift
l_int|8
)paren
)paren
suffix:semicolon
id|info-&gt;hh
(braket
l_int|3
)braket
op_assign
id|tmp
suffix:semicolon
id|tmp
op_assign
(paren
id|info-&gt;dst_mac
(braket
l_int|2
)braket
op_plus
(paren
(paren
id|mc
op_rshift
l_int|24
)paren
op_amp
l_int|0xFF
)paren
op_plus
(paren
id|tmp
op_rshift
l_int|8
)paren
)paren
suffix:semicolon
id|info-&gt;hh
(braket
l_int|2
)braket
op_assign
id|tmp
suffix:semicolon
id|tmp
op_assign
(paren
id|info-&gt;dst_mac
(braket
l_int|1
)braket
op_plus
(paren
id|tmp
op_rshift
l_int|8
)paren
)paren
suffix:semicolon
id|info-&gt;hh
(braket
l_int|1
)braket
op_assign
id|tmp
suffix:semicolon
)brace
r_if
c_cond
(paren
id|info-&gt;udp_src_min
OL
id|info-&gt;udp_src_max
)paren
(brace
r_if
c_cond
(paren
id|info-&gt;flags
op_amp
id|F_UDPSRC_RND
)paren
(brace
id|info-&gt;cur_udp_src
op_assign
(paren
(paren
id|net_random
c_func
(paren
)paren
op_mod
(paren
id|info-&gt;udp_src_max
op_minus
id|info-&gt;udp_src_min
)paren
)paren
op_plus
id|info-&gt;udp_src_min
)paren
suffix:semicolon
)brace
r_else
(brace
id|info-&gt;cur_udp_src
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|info-&gt;cur_udp_src
op_ge
id|info-&gt;udp_src_max
)paren
(brace
id|info-&gt;cur_udp_src
op_assign
id|info-&gt;udp_src_min
suffix:semicolon
)brace
)brace
)brace
r_if
c_cond
(paren
id|info-&gt;udp_dst_min
OL
id|info-&gt;udp_dst_max
)paren
(brace
r_if
c_cond
(paren
id|info-&gt;flags
op_amp
id|F_UDPDST_RND
)paren
(brace
id|info-&gt;cur_udp_dst
op_assign
(paren
(paren
id|net_random
c_func
(paren
)paren
op_mod
(paren
id|info-&gt;udp_dst_max
op_minus
id|info-&gt;udp_dst_min
)paren
)paren
op_plus
id|info-&gt;udp_dst_min
)paren
suffix:semicolon
)brace
r_else
(brace
id|info-&gt;cur_udp_dst
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|info-&gt;cur_udp_dst
op_ge
id|info-&gt;udp_dst_max
)paren
(brace
id|info-&gt;cur_udp_dst
op_assign
id|info-&gt;udp_dst_min
suffix:semicolon
)brace
)brace
)brace
r_if
c_cond
(paren
(paren
id|imn
op_assign
id|ntohl
c_func
(paren
id|info-&gt;saddr_min
)paren
)paren
OL
(paren
id|imx
op_assign
id|ntohl
c_func
(paren
id|info-&gt;saddr_max
)paren
)paren
)paren
(brace
id|__u32
id|t
suffix:semicolon
r_if
c_cond
(paren
id|info-&gt;flags
op_amp
id|F_IPSRC_RND
)paren
(brace
id|t
op_assign
(paren
(paren
id|net_random
c_func
(paren
)paren
op_mod
(paren
id|imx
op_minus
id|imn
)paren
)paren
op_plus
id|imn
)paren
suffix:semicolon
)brace
r_else
(brace
id|t
op_assign
id|ntohl
c_func
(paren
id|info-&gt;cur_saddr
)paren
suffix:semicolon
id|t
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|t
op_ge
id|imx
)paren
(brace
id|t
op_assign
id|imn
suffix:semicolon
)brace
)brace
id|info-&gt;cur_saddr
op_assign
id|htonl
c_func
(paren
id|t
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|imn
op_assign
id|ntohl
c_func
(paren
id|info-&gt;daddr_min
)paren
)paren
OL
(paren
id|imx
op_assign
id|ntohl
c_func
(paren
id|info-&gt;daddr_max
)paren
)paren
)paren
(brace
id|__u32
id|t
suffix:semicolon
r_if
c_cond
(paren
id|info-&gt;flags
op_amp
id|F_IPDST_RND
)paren
(brace
id|t
op_assign
(paren
(paren
id|net_random
c_func
(paren
)paren
op_mod
(paren
id|imx
op_minus
id|imn
)paren
)paren
op_plus
id|imn
)paren
suffix:semicolon
)brace
r_else
(brace
id|t
op_assign
id|ntohl
c_func
(paren
id|info-&gt;cur_daddr
)paren
suffix:semicolon
id|t
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|t
op_ge
id|imx
)paren
(brace
id|t
op_assign
id|imn
suffix:semicolon
)brace
)brace
id|info-&gt;cur_daddr
op_assign
id|htonl
c_func
(paren
id|t
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* mod_cur_headers */
DECL|function|fill_packet
r_static
r_struct
id|sk_buff
op_star
id|fill_packet
c_func
(paren
r_struct
id|net_device
op_star
id|odev
comma
r_struct
id|pktgen_info
op_star
id|info
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
op_assign
l_int|NULL
suffix:semicolon
id|__u8
op_star
id|eth
suffix:semicolon
r_struct
id|udphdr
op_star
id|udph
suffix:semicolon
r_int
id|datalen
comma
id|iplen
suffix:semicolon
r_struct
id|iphdr
op_star
id|iph
suffix:semicolon
r_struct
id|pktgen_hdr
op_star
id|pgh
op_assign
l_int|NULL
suffix:semicolon
id|skb
op_assign
id|alloc_skb
c_func
(paren
id|info-&gt;pkt_size
op_plus
l_int|64
op_plus
l_int|16
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
(brace
id|sprintf
c_func
(paren
id|info-&gt;result
comma
l_string|&quot;No memory&quot;
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|skb_reserve
c_func
(paren
id|skb
comma
l_int|16
)paren
suffix:semicolon
multiline_comment|/*  Reserve for ethernet and IP header  */
id|eth
op_assign
(paren
id|__u8
op_star
)paren
id|skb_push
c_func
(paren
id|skb
comma
l_int|14
)paren
suffix:semicolon
id|iph
op_assign
(paren
r_struct
id|iphdr
op_star
)paren
id|skb_put
c_func
(paren
id|skb
comma
r_sizeof
(paren
r_struct
id|iphdr
)paren
)paren
suffix:semicolon
id|udph
op_assign
(paren
r_struct
id|udphdr
op_star
)paren
id|skb_put
c_func
(paren
id|skb
comma
r_sizeof
(paren
r_struct
id|udphdr
)paren
)paren
suffix:semicolon
multiline_comment|/* Update any of the values, used when we&squot;re incrementing various&n;&t; * fields.&n;&t; */
id|mod_cur_headers
c_func
(paren
id|info
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|eth
comma
id|info-&gt;hh
comma
l_int|14
)paren
suffix:semicolon
id|datalen
op_assign
id|info-&gt;pkt_size
op_minus
l_int|14
op_minus
l_int|20
op_minus
l_int|8
suffix:semicolon
multiline_comment|/* Eth + IPh + UDPh */
r_if
c_cond
(paren
id|datalen
OL
r_sizeof
(paren
r_struct
id|pktgen_hdr
)paren
)paren
(brace
id|datalen
op_assign
r_sizeof
(paren
r_struct
id|pktgen_hdr
)paren
suffix:semicolon
)brace
id|udph-&gt;source
op_assign
id|htons
c_func
(paren
id|info-&gt;cur_udp_src
)paren
suffix:semicolon
id|udph-&gt;dest
op_assign
id|htons
c_func
(paren
id|info-&gt;cur_udp_dst
)paren
suffix:semicolon
id|udph-&gt;len
op_assign
id|htons
c_func
(paren
id|datalen
op_plus
l_int|8
)paren
suffix:semicolon
multiline_comment|/* DATA + udphdr */
id|udph-&gt;check
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* No checksum */
id|iph-&gt;ihl
op_assign
l_int|5
suffix:semicolon
id|iph-&gt;version
op_assign
l_int|4
suffix:semicolon
id|iph-&gt;ttl
op_assign
l_int|3
suffix:semicolon
id|iph-&gt;tos
op_assign
l_int|0
suffix:semicolon
id|iph-&gt;protocol
op_assign
id|IPPROTO_UDP
suffix:semicolon
multiline_comment|/* UDP */
id|iph-&gt;saddr
op_assign
id|info-&gt;cur_saddr
suffix:semicolon
id|iph-&gt;daddr
op_assign
id|info-&gt;cur_daddr
suffix:semicolon
id|iph-&gt;frag_off
op_assign
l_int|0
suffix:semicolon
id|iplen
op_assign
l_int|20
op_plus
l_int|8
op_plus
id|datalen
suffix:semicolon
id|iph-&gt;tot_len
op_assign
id|htons
c_func
(paren
id|iplen
)paren
suffix:semicolon
id|iph-&gt;check
op_assign
l_int|0
suffix:semicolon
id|iph-&gt;check
op_assign
id|ip_fast_csum
c_func
(paren
(paren
r_void
op_star
)paren
id|iph
comma
id|iph-&gt;ihl
)paren
suffix:semicolon
id|skb-&gt;protocol
op_assign
id|__constant_htons
c_func
(paren
id|ETH_P_IP
)paren
suffix:semicolon
id|skb-&gt;mac.raw
op_assign
(paren
(paren
id|u8
op_star
)paren
id|iph
)paren
op_minus
l_int|14
suffix:semicolon
id|skb-&gt;dev
op_assign
id|odev
suffix:semicolon
id|skb-&gt;pkt_type
op_assign
id|PACKET_HOST
suffix:semicolon
r_if
c_cond
(paren
id|info-&gt;nfrags
op_le
l_int|0
)paren
(brace
id|pgh
op_assign
(paren
r_struct
id|pktgen_hdr
op_star
)paren
id|skb_put
c_func
(paren
id|skb
comma
id|datalen
)paren
suffix:semicolon
)brace
r_else
(brace
r_int
id|frags
op_assign
id|info-&gt;nfrags
suffix:semicolon
r_int
id|i
suffix:semicolon
multiline_comment|/* TODO: Verify this is OK...it sure is ugly. --Ben */
id|pgh
op_assign
(paren
r_struct
id|pktgen_hdr
op_star
)paren
(paren
(paren
(paren
r_char
op_star
)paren
(paren
id|udph
)paren
)paren
op_plus
l_int|8
)paren
suffix:semicolon
r_if
c_cond
(paren
id|frags
OG
id|MAX_SKB_FRAGS
)paren
id|frags
op_assign
id|MAX_SKB_FRAGS
suffix:semicolon
r_if
c_cond
(paren
id|datalen
OG
id|frags
op_star
id|PAGE_SIZE
)paren
(brace
id|skb_put
c_func
(paren
id|skb
comma
id|datalen
op_minus
id|frags
op_star
id|PAGE_SIZE
)paren
suffix:semicolon
id|datalen
op_assign
id|frags
op_star
id|PAGE_SIZE
suffix:semicolon
)brace
id|i
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|datalen
OG
l_int|0
)paren
(brace
r_struct
id|page
op_star
id|page
op_assign
id|alloc_pages
c_func
(paren
id|GFP_KERNEL
comma
l_int|0
)paren
suffix:semicolon
id|skb_shinfo
c_func
(paren
id|skb
)paren
op_member_access_from_pointer
id|frags
(braket
id|i
)braket
dot
id|page
op_assign
id|page
suffix:semicolon
id|skb_shinfo
c_func
(paren
id|skb
)paren
op_member_access_from_pointer
id|frags
(braket
id|i
)braket
dot
id|page_offset
op_assign
l_int|0
suffix:semicolon
id|skb_shinfo
c_func
(paren
id|skb
)paren
op_member_access_from_pointer
id|frags
(braket
id|i
)braket
dot
id|size
op_assign
(paren
id|datalen
OL
id|PAGE_SIZE
ques
c_cond
id|datalen
suffix:colon
id|PAGE_SIZE
)paren
suffix:semicolon
id|datalen
op_sub_assign
id|skb_shinfo
c_func
(paren
id|skb
)paren
op_member_access_from_pointer
id|frags
(braket
id|i
)braket
dot
id|size
suffix:semicolon
id|skb-&gt;len
op_add_assign
id|skb_shinfo
c_func
(paren
id|skb
)paren
op_member_access_from_pointer
id|frags
(braket
id|i
)braket
dot
id|size
suffix:semicolon
id|skb-&gt;data_len
op_add_assign
id|skb_shinfo
c_func
(paren
id|skb
)paren
op_member_access_from_pointer
id|frags
(braket
id|i
)braket
dot
id|size
suffix:semicolon
id|i
op_increment
suffix:semicolon
id|skb_shinfo
c_func
(paren
id|skb
)paren
op_member_access_from_pointer
id|nr_frags
op_assign
id|i
suffix:semicolon
)brace
r_while
c_loop
(paren
id|i
OL
id|frags
)paren
(brace
r_int
id|rem
suffix:semicolon
r_if
c_cond
(paren
id|i
op_eq
l_int|0
)paren
r_break
suffix:semicolon
id|rem
op_assign
id|skb_shinfo
c_func
(paren
id|skb
)paren
op_member_access_from_pointer
id|frags
(braket
id|i
op_minus
l_int|1
)braket
dot
id|size
op_div
l_int|2
suffix:semicolon
r_if
c_cond
(paren
id|rem
op_eq
l_int|0
)paren
r_break
suffix:semicolon
id|skb_shinfo
c_func
(paren
id|skb
)paren
op_member_access_from_pointer
id|frags
(braket
id|i
op_minus
l_int|1
)braket
dot
id|size
op_sub_assign
id|rem
suffix:semicolon
id|skb_shinfo
c_func
(paren
id|skb
)paren
op_member_access_from_pointer
id|frags
(braket
id|i
)braket
op_assign
id|skb_shinfo
c_func
(paren
id|skb
)paren
op_member_access_from_pointer
id|frags
(braket
id|i
op_minus
l_int|1
)braket
suffix:semicolon
id|get_page
c_func
(paren
id|skb_shinfo
c_func
(paren
id|skb
)paren
op_member_access_from_pointer
id|frags
(braket
id|i
)braket
dot
id|page
)paren
suffix:semicolon
id|skb_shinfo
c_func
(paren
id|skb
)paren
op_member_access_from_pointer
id|frags
(braket
id|i
)braket
dot
id|page
op_assign
id|skb_shinfo
c_func
(paren
id|skb
)paren
op_member_access_from_pointer
id|frags
(braket
id|i
op_minus
l_int|1
)braket
dot
id|page
suffix:semicolon
id|skb_shinfo
c_func
(paren
id|skb
)paren
op_member_access_from_pointer
id|frags
(braket
id|i
)braket
dot
id|page_offset
op_add_assign
id|skb_shinfo
c_func
(paren
id|skb
)paren
op_member_access_from_pointer
id|frags
(braket
id|i
op_minus
l_int|1
)braket
dot
id|size
suffix:semicolon
id|skb_shinfo
c_func
(paren
id|skb
)paren
op_member_access_from_pointer
id|frags
(braket
id|i
)braket
dot
id|size
op_assign
id|rem
suffix:semicolon
id|i
op_increment
suffix:semicolon
id|skb_shinfo
c_func
(paren
id|skb
)paren
op_member_access_from_pointer
id|nr_frags
op_assign
id|i
suffix:semicolon
)brace
)brace
multiline_comment|/* Stamp the time, and sequence number, convert them to network byte order */
r_if
c_cond
(paren
id|pgh
)paren
(brace
r_struct
id|timeval
id|timestamp
suffix:semicolon
id|pgh-&gt;pgh_magic
op_assign
id|htonl
c_func
(paren
id|PKTGEN_MAGIC
)paren
suffix:semicolon
id|pgh-&gt;seq_num
op_assign
id|htonl
c_func
(paren
id|info-&gt;seq_num
)paren
suffix:semicolon
id|do_gettimeofday
c_func
(paren
op_amp
id|timestamp
)paren
suffix:semicolon
id|pgh-&gt;tv_sec
op_assign
id|htonl
c_func
(paren
id|timestamp.tv_sec
)paren
suffix:semicolon
id|pgh-&gt;tv_usec
op_assign
id|htonl
c_func
(paren
id|timestamp.tv_usec
)paren
suffix:semicolon
)brace
r_return
id|skb
suffix:semicolon
)brace
DECL|function|show_results
r_static
r_void
id|show_results
c_func
(paren
r_struct
id|pktgen_info
op_star
id|info
comma
r_int
id|nr_frags
)paren
(brace
id|__u64
id|total
comma
id|bps
comma
id|mbps
comma
id|pps
suffix:semicolon
r_int
r_int
id|idle
suffix:semicolon
r_int
id|size
op_assign
id|info-&gt;pkt_size
op_plus
l_int|4
suffix:semicolon
multiline_comment|/* incl 32bit ethernet CRC */
r_char
op_star
id|p
op_assign
id|info-&gt;result
suffix:semicolon
id|total
op_assign
(paren
id|info-&gt;stopped_at.tv_sec
op_minus
id|info-&gt;started_at.tv_sec
)paren
op_star
l_int|1000000ull
op_plus
id|info-&gt;stopped_at.tv_usec
op_minus
id|info-&gt;started_at.tv_usec
suffix:semicolon
id|BUG_ON
c_func
(paren
id|cpu_speed
op_eq
l_int|0
)paren
suffix:semicolon
id|idle
op_assign
id|info-&gt;idle_acc
suffix:semicolon
id|do_div
c_func
(paren
id|idle
comma
id|cpu_speed
)paren
suffix:semicolon
id|p
op_add_assign
id|sprintf
c_func
(paren
id|p
comma
l_string|&quot;OK: %llu(c%llu+d%lu) usec, %llu (%dbyte,%dfrags)&bslash;n&quot;
comma
(paren
r_int
r_int
r_int
)paren
id|total
comma
(paren
r_int
r_int
r_int
)paren
(paren
id|total
op_minus
id|idle
)paren
comma
id|idle
comma
(paren
r_int
r_int
r_int
)paren
id|info-&gt;sofar
comma
id|size
comma
id|nr_frags
)paren
suffix:semicolon
id|pps
op_assign
id|info-&gt;sofar
op_star
id|USEC_PER_SEC
suffix:semicolon
r_while
c_loop
(paren
(paren
id|total
op_rshift
l_int|32
)paren
op_ne
l_int|0
)paren
(brace
id|pps
op_rshift_assign
l_int|1
suffix:semicolon
id|total
op_rshift_assign
l_int|1
suffix:semicolon
)brace
id|do_div
c_func
(paren
id|pps
comma
id|total
)paren
suffix:semicolon
id|bps
op_assign
id|pps
op_star
l_int|8
op_star
id|size
suffix:semicolon
id|mbps
op_assign
id|bps
suffix:semicolon
id|do_div
c_func
(paren
id|mbps
comma
l_int|1000000
)paren
suffix:semicolon
id|p
op_add_assign
id|sprintf
c_func
(paren
id|p
comma
l_string|&quot;  %llupps %lluMb/sec (%llubps) errors: %llu&quot;
comma
(paren
r_int
r_int
r_int
)paren
id|pps
comma
(paren
r_int
r_int
r_int
)paren
id|mbps
comma
(paren
r_int
r_int
r_int
)paren
id|bps
comma
(paren
r_int
r_int
r_int
)paren
id|info-&gt;errors
)paren
suffix:semicolon
)brace
DECL|function|inject
r_static
r_void
id|inject
c_func
(paren
r_struct
id|pktgen_info
op_star
id|info
)paren
(brace
r_struct
id|net_device
op_star
id|odev
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
op_assign
l_int|NULL
suffix:semicolon
id|__u64
id|lcount
op_assign
l_int|0
suffix:semicolon
r_int
id|ret
suffix:semicolon
r_int
id|last_ok
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* Was last skb sent? &n;&t;&t;&t;&t;    * Or a failed transmit of some sort?  This will keep&n;&t;&t;&t;&t;    * sequence numbers in order, for example.&n;&t;&t;&t;&t;    */
id|__u64
id|fp
op_assign
l_int|0
suffix:semicolon
id|__u32
id|fp_tmp
op_assign
l_int|0
suffix:semicolon
id|odev
op_assign
id|setup_inject
c_func
(paren
id|info
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|odev
)paren
r_return
suffix:semicolon
id|info-&gt;do_run_run
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* Cranke yeself! */
id|info-&gt;idle_acc
op_assign
l_int|0
suffix:semicolon
id|info-&gt;sofar
op_assign
l_int|0
suffix:semicolon
id|info-&gt;errors
op_assign
l_int|0
suffix:semicolon
id|lcount
op_assign
id|info-&gt;count
suffix:semicolon
multiline_comment|/* Build our initial pkt and place it as a re-try pkt. */
id|skb
op_assign
id|fill_packet
c_func
(paren
id|odev
comma
id|info
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_eq
l_int|NULL
)paren
r_goto
id|out_reldev
suffix:semicolon
id|do_gettimeofday
c_func
(paren
op_amp
(paren
id|info-&gt;started_at
)paren
)paren
suffix:semicolon
r_while
c_loop
(paren
id|info-&gt;do_run_run
)paren
(brace
multiline_comment|/* Set a time-stamp, so build a new pkt each time */
r_if
c_cond
(paren
id|last_ok
)paren
(brace
r_if
c_cond
(paren
op_increment
id|fp_tmp
op_ge
id|info-&gt;clone_skb
)paren
(brace
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
id|skb
op_assign
id|fill_packet
c_func
(paren
id|odev
comma
id|info
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_eq
l_int|NULL
)paren
(brace
r_goto
id|out_reldev
suffix:semicolon
)brace
id|fp
op_increment
suffix:semicolon
id|fp_tmp
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* reset counter */
)brace
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|odev-&gt;features
op_amp
id|NETIF_F_LLTX
)paren
)paren
id|spin_lock_bh
c_func
(paren
op_amp
id|odev-&gt;xmit_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|netif_queue_stopped
c_func
(paren
id|odev
)paren
)paren
(brace
id|atomic_inc
c_func
(paren
op_amp
id|skb-&gt;users
)paren
suffix:semicolon
id|retry
suffix:colon
id|ret
op_assign
id|odev
op_member_access_from_pointer
id|hard_start_xmit
c_func
(paren
id|skb
comma
id|odev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|likely
c_func
(paren
id|ret
op_eq
id|NETDEV_TX_OK
)paren
)paren
(brace
id|last_ok
op_assign
l_int|1
suffix:semicolon
id|info-&gt;sofar
op_increment
suffix:semicolon
id|info-&gt;seq_num
op_increment
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|ret
op_eq
id|NETDEV_TX_LOCKED
op_logical_and
(paren
id|odev-&gt;features
op_amp
id|NETIF_F_LLTX
)paren
)paren
(brace
id|cpu_relax
c_func
(paren
)paren
suffix:semicolon
r_goto
id|retry
suffix:semicolon
)brace
r_else
(brace
id|atomic_dec
c_func
(paren
op_amp
id|skb-&gt;users
)paren
suffix:semicolon
r_if
c_cond
(paren
id|debug
op_logical_and
id|net_ratelimit
c_func
(paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;Hard xmit error&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|info-&gt;errors
op_increment
suffix:semicolon
id|last_ok
op_assign
l_int|0
suffix:semicolon
)brace
)brace
r_else
(brace
multiline_comment|/* Re-try it next time */
id|last_ok
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|odev-&gt;features
op_amp
id|NETIF_F_LLTX
)paren
)paren
id|spin_unlock_bh
c_func
(paren
op_amp
id|odev-&gt;xmit_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|info-&gt;ipg
)paren
(brace
multiline_comment|/* Try not to busy-spin if we have larger sleep times.&n;&t;&t;&t; * TODO:  Investigate better ways to do this.&n;&t;&t;&t; */
r_if
c_cond
(paren
id|info-&gt;ipg
OL
l_int|10000
)paren
(brace
multiline_comment|/* 10 usecs or less */
id|nanospin
c_func
(paren
id|info-&gt;ipg
comma
id|info
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|info-&gt;ipg
OL
l_int|10000000
)paren
(brace
multiline_comment|/* 10ms or less */
id|udelay
c_func
(paren
id|info-&gt;ipg
op_div
l_int|1000
)paren
suffix:semicolon
)brace
r_else
(brace
id|mdelay
c_func
(paren
id|info-&gt;ipg
op_div
l_int|1000000
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|signal_pending
c_func
(paren
id|current
)paren
)paren
(brace
r_break
suffix:semicolon
)brace
multiline_comment|/* If lcount is zero, then run forever */
r_if
c_cond
(paren
(paren
id|lcount
op_ne
l_int|0
)paren
op_logical_and
(paren
op_decrement
id|lcount
op_eq
l_int|0
)paren
)paren
(brace
r_if
c_cond
(paren
id|atomic_read
c_func
(paren
op_amp
id|skb-&gt;users
)paren
op_ne
l_int|1
)paren
(brace
id|u32
id|idle_start
comma
id|idle
suffix:semicolon
id|idle_start
op_assign
id|cycles
c_func
(paren
)paren
suffix:semicolon
r_while
c_loop
(paren
id|atomic_read
c_func
(paren
op_amp
id|skb-&gt;users
)paren
op_ne
l_int|1
)paren
(brace
r_if
c_cond
(paren
id|signal_pending
c_func
(paren
id|current
)paren
)paren
(brace
r_break
suffix:semicolon
)brace
id|schedule
c_func
(paren
)paren
suffix:semicolon
)brace
id|idle
op_assign
id|cycles
c_func
(paren
)paren
op_minus
id|idle_start
suffix:semicolon
id|info-&gt;idle_acc
op_add_assign
id|idle
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|netif_queue_stopped
c_func
(paren
id|odev
)paren
op_logical_or
id|need_resched
c_func
(paren
)paren
)paren
(brace
id|u32
id|idle_start
comma
id|idle
suffix:semicolon
id|idle_start
op_assign
id|cycles
c_func
(paren
)paren
suffix:semicolon
r_do
(brace
r_if
c_cond
(paren
id|signal_pending
c_func
(paren
id|current
)paren
)paren
(brace
id|info-&gt;do_run_run
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|netif_running
c_func
(paren
id|odev
)paren
)paren
(brace
id|info-&gt;do_run_run
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|need_resched
c_func
(paren
)paren
)paren
id|schedule
c_func
(paren
)paren
suffix:semicolon
r_else
id|do_softirq
c_func
(paren
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
id|netif_queue_stopped
c_func
(paren
id|odev
)paren
)paren
suffix:semicolon
id|idle
op_assign
id|cycles
c_func
(paren
)paren
op_minus
id|idle_start
suffix:semicolon
id|info-&gt;idle_acc
op_add_assign
id|idle
suffix:semicolon
)brace
)brace
multiline_comment|/* while we should be running */
id|do_gettimeofday
c_func
(paren
op_amp
(paren
id|info-&gt;stopped_at
)paren
)paren
suffix:semicolon
id|show_results
c_func
(paren
id|info
comma
id|skb_shinfo
c_func
(paren
id|skb
)paren
op_member_access_from_pointer
id|nr_frags
)paren
suffix:semicolon
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
id|out_reldev
suffix:colon
r_if
c_cond
(paren
id|odev
)paren
(brace
id|dev_put
c_func
(paren
id|odev
)paren
suffix:semicolon
id|odev
op_assign
l_int|NULL
suffix:semicolon
)brace
r_return
suffix:semicolon
)brace
multiline_comment|/* proc/net/pktgen/pg */
DECL|function|proc_busy_read
r_static
r_int
id|proc_busy_read
c_func
(paren
r_char
op_star
id|buf
comma
r_char
op_star
op_star
id|start
comma
id|off_t
id|offset
comma
r_int
id|len
comma
r_int
op_star
id|eof
comma
r_void
op_star
id|data
)paren
(brace
r_char
op_star
id|p
suffix:semicolon
r_int
id|idx
op_assign
(paren
r_int
)paren
(paren
r_int
)paren
(paren
id|data
)paren
suffix:semicolon
r_struct
id|pktgen_info
op_star
id|info
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
(paren
id|idx
OL
l_int|0
)paren
op_logical_or
(paren
id|idx
op_ge
id|MAX_PKTGEN
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;ERROR: idx: %i is out of range in proc_write&bslash;n&quot;
comma
id|idx
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|info
op_assign
op_amp
(paren
id|pginfos
(braket
id|idx
)braket
)paren
suffix:semicolon
id|p
op_assign
id|buf
suffix:semicolon
id|p
op_add_assign
id|sprintf
c_func
(paren
id|p
comma
l_string|&quot;%d&bslash;n&quot;
comma
id|info-&gt;busy
)paren
suffix:semicolon
op_star
id|eof
op_assign
l_int|1
suffix:semicolon
r_return
id|p
op_minus
id|buf
suffix:semicolon
)brace
DECL|function|proc_read
r_static
r_int
id|proc_read
c_func
(paren
r_char
op_star
id|buf
comma
r_char
op_star
op_star
id|start
comma
id|off_t
id|offset
comma
r_int
id|len
comma
r_int
op_star
id|eof
comma
r_void
op_star
id|data
)paren
(brace
r_char
op_star
id|p
suffix:semicolon
r_int
id|i
suffix:semicolon
r_int
id|idx
op_assign
(paren
r_int
)paren
(paren
r_int
)paren
(paren
id|data
)paren
suffix:semicolon
r_struct
id|pktgen_info
op_star
id|info
op_assign
l_int|NULL
suffix:semicolon
id|__u64
id|sa
suffix:semicolon
id|__u64
id|stopped
suffix:semicolon
id|__u64
id|now
op_assign
id|getCurMs
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|idx
OL
l_int|0
)paren
op_logical_or
(paren
id|idx
op_ge
id|MAX_PKTGEN
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;ERROR: idx: %i is out of range in proc_write&bslash;n&quot;
comma
id|idx
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|info
op_assign
op_amp
(paren
id|pginfos
(braket
id|idx
)braket
)paren
suffix:semicolon
id|p
op_assign
id|buf
suffix:semicolon
id|p
op_add_assign
id|sprintf
c_func
(paren
id|p
comma
l_string|&quot;%s&bslash;n&quot;
comma
id|VERSION
)paren
suffix:semicolon
multiline_comment|/* Help with parsing compatibility */
id|p
op_add_assign
id|sprintf
c_func
(paren
id|p
comma
l_string|&quot;Params: count %llu  pkt_size: %u  frags: %d  ipg: %u  clone_skb: %d odev &bslash;&quot;%s&bslash;&quot;&bslash;n&quot;
comma
(paren
r_int
r_int
r_int
)paren
id|info-&gt;count
comma
id|info-&gt;pkt_size
comma
id|info-&gt;nfrags
comma
id|info-&gt;ipg
comma
id|info-&gt;clone_skb
comma
id|info-&gt;outdev
)paren
suffix:semicolon
id|p
op_add_assign
id|sprintf
c_func
(paren
id|p
comma
l_string|&quot;     dst_min: %s  dst_max: %s  src_min: %s  src_max: %s&bslash;n&quot;
comma
id|info-&gt;dst_min
comma
id|info-&gt;dst_max
comma
id|info-&gt;src_min
comma
id|info-&gt;src_max
)paren
suffix:semicolon
id|p
op_add_assign
id|sprintf
c_func
(paren
id|p
comma
l_string|&quot;     src_mac: &quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|6
suffix:semicolon
id|i
op_increment
)paren
(brace
id|p
op_add_assign
id|sprintf
c_func
(paren
id|p
comma
l_string|&quot;%02X%s&quot;
comma
id|info-&gt;src_mac
(braket
id|i
)braket
comma
id|i
op_eq
l_int|5
ques
c_cond
l_string|&quot;  &quot;
suffix:colon
l_string|&quot;:&quot;
)paren
suffix:semicolon
)brace
id|p
op_add_assign
id|sprintf
c_func
(paren
id|p
comma
l_string|&quot;dst_mac: &quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|6
suffix:semicolon
id|i
op_increment
)paren
(brace
id|p
op_add_assign
id|sprintf
c_func
(paren
id|p
comma
l_string|&quot;%02X%s&quot;
comma
id|info-&gt;dst_mac
(braket
id|i
)braket
comma
id|i
op_eq
l_int|5
ques
c_cond
l_string|&quot;&bslash;n&quot;
suffix:colon
l_string|&quot;:&quot;
)paren
suffix:semicolon
)brace
id|p
op_add_assign
id|sprintf
c_func
(paren
id|p
comma
l_string|&quot;     udp_src_min: %d  udp_src_max: %d  udp_dst_min: %d  udp_dst_max: %d&bslash;n&quot;
comma
id|info-&gt;udp_src_min
comma
id|info-&gt;udp_src_max
comma
id|info-&gt;udp_dst_min
comma
id|info-&gt;udp_dst_max
)paren
suffix:semicolon
id|p
op_add_assign
id|sprintf
c_func
(paren
id|p
comma
l_string|&quot;     src_mac_count: %d  dst_mac_count: %d&bslash;n     Flags: &quot;
comma
id|info-&gt;src_mac_count
comma
id|info-&gt;dst_mac_count
)paren
suffix:semicolon
r_if
c_cond
(paren
id|info-&gt;flags
op_amp
id|F_IPSRC_RND
)paren
(brace
id|p
op_add_assign
id|sprintf
c_func
(paren
id|p
comma
l_string|&quot;IPSRC_RND  &quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|info-&gt;flags
op_amp
id|F_IPDST_RND
)paren
(brace
id|p
op_add_assign
id|sprintf
c_func
(paren
id|p
comma
l_string|&quot;IPDST_RND  &quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|info-&gt;flags
op_amp
id|F_UDPSRC_RND
)paren
(brace
id|p
op_add_assign
id|sprintf
c_func
(paren
id|p
comma
l_string|&quot;UDPSRC_RND  &quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|info-&gt;flags
op_amp
id|F_UDPDST_RND
)paren
(brace
id|p
op_add_assign
id|sprintf
c_func
(paren
id|p
comma
l_string|&quot;UDPDST_RND  &quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|info-&gt;flags
op_amp
id|F_MACSRC_RND
)paren
(brace
id|p
op_add_assign
id|sprintf
c_func
(paren
id|p
comma
l_string|&quot;MACSRC_RND  &quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|info-&gt;flags
op_amp
id|F_MACDST_RND
)paren
(brace
id|p
op_add_assign
id|sprintf
c_func
(paren
id|p
comma
l_string|&quot;MACDST_RND  &quot;
)paren
suffix:semicolon
)brace
id|p
op_add_assign
id|sprintf
c_func
(paren
id|p
comma
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|sa
op_assign
id|tv_to_ms
c_func
(paren
op_amp
(paren
id|info-&gt;started_at
)paren
)paren
suffix:semicolon
id|stopped
op_assign
id|tv_to_ms
c_func
(paren
op_amp
(paren
id|info-&gt;stopped_at
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|info-&gt;do_run_run
)paren
(brace
id|stopped
op_assign
id|now
suffix:semicolon
multiline_comment|/* not really stopped, more like last-running-at */
)brace
id|p
op_add_assign
id|sprintf
c_func
(paren
id|p
comma
l_string|&quot;Current:&bslash;n     pkts-sofar: %llu  errors: %llu&bslash;n     started: %llums  stopped: %llums  now: %llums  idle: %lluns&bslash;n&quot;
comma
(paren
r_int
r_int
r_int
)paren
id|info-&gt;sofar
comma
(paren
r_int
r_int
r_int
)paren
id|info-&gt;errors
comma
(paren
r_int
r_int
r_int
)paren
id|sa
comma
(paren
r_int
r_int
r_int
)paren
id|stopped
comma
(paren
r_int
r_int
r_int
)paren
id|now
comma
(paren
r_int
r_int
r_int
)paren
id|info-&gt;idle_acc
)paren
suffix:semicolon
id|p
op_add_assign
id|sprintf
c_func
(paren
id|p
comma
l_string|&quot;     seq_num: %d  cur_dst_mac_offset: %d  cur_src_mac_offset: %d&bslash;n&quot;
comma
id|info-&gt;seq_num
comma
id|info-&gt;cur_dst_mac_offset
comma
id|info-&gt;cur_src_mac_offset
)paren
suffix:semicolon
id|p
op_add_assign
id|sprintf
c_func
(paren
id|p
comma
l_string|&quot;     cur_saddr: 0x%x  cur_daddr: 0x%x  cur_udp_dst: %d  cur_udp_src: %d&bslash;n&quot;
comma
id|info-&gt;cur_saddr
comma
id|info-&gt;cur_daddr
comma
id|info-&gt;cur_udp_dst
comma
id|info-&gt;cur_udp_src
)paren
suffix:semicolon
r_if
c_cond
(paren
id|info-&gt;result
(braket
l_int|0
)braket
)paren
id|p
op_add_assign
id|sprintf
c_func
(paren
id|p
comma
l_string|&quot;Result: %s&bslash;n&quot;
comma
id|info-&gt;result
)paren
suffix:semicolon
r_else
id|p
op_add_assign
id|sprintf
c_func
(paren
id|p
comma
l_string|&quot;Result: Idle&bslash;n&quot;
)paren
suffix:semicolon
op_star
id|eof
op_assign
l_int|1
suffix:semicolon
r_return
id|p
op_minus
id|buf
suffix:semicolon
)brace
DECL|function|count_trail_chars
r_static
r_int
id|count_trail_chars
c_func
(paren
r_const
r_char
id|__user
op_star
id|user_buffer
comma
r_int
r_int
id|maxlen
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|maxlen
suffix:semicolon
id|i
op_increment
)paren
(brace
r_char
id|c
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|c
comma
op_amp
id|user_buffer
(braket
id|i
)braket
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_switch
c_cond
(paren
id|c
)paren
(brace
r_case
l_char|&squot;&bslash;&quot;&squot;
suffix:colon
r_case
l_char|&squot;&bslash;n&squot;
suffix:colon
r_case
l_char|&squot;&bslash;r&squot;
suffix:colon
r_case
l_char|&squot;&bslash;t&squot;
suffix:colon
r_case
l_char|&squot; &squot;
suffix:colon
r_case
l_char|&squot;=&squot;
suffix:colon
r_break
suffix:semicolon
r_default
suffix:colon
r_goto
id|done
suffix:semicolon
)brace
suffix:semicolon
)brace
id|done
suffix:colon
r_return
id|i
suffix:semicolon
)brace
DECL|function|num_arg
r_static
r_int
r_int
id|num_arg
c_func
(paren
r_const
r_char
id|__user
op_star
id|user_buffer
comma
r_int
r_int
id|maxlen
comma
r_int
r_int
op_star
id|num
)paren
(brace
r_int
id|i
op_assign
l_int|0
suffix:semicolon
op_star
id|num
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
id|i
OL
id|maxlen
suffix:semicolon
id|i
op_increment
)paren
(brace
r_char
id|c
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|c
comma
op_amp
id|user_buffer
(braket
id|i
)braket
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
(paren
id|c
op_ge
l_char|&squot;0&squot;
)paren
op_logical_and
(paren
id|c
op_le
l_char|&squot;9&squot;
)paren
)paren
(brace
op_star
id|num
op_mul_assign
l_int|10
suffix:semicolon
op_star
id|num
op_add_assign
id|c
op_minus
l_char|&squot;0&squot;
suffix:semicolon
)brace
r_else
r_break
suffix:semicolon
)brace
r_return
id|i
suffix:semicolon
)brace
DECL|function|strn_len
r_static
r_int
id|strn_len
c_func
(paren
r_const
r_char
id|__user
op_star
id|user_buffer
comma
r_int
r_int
id|maxlen
)paren
(brace
r_int
id|i
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
id|i
OL
id|maxlen
suffix:semicolon
id|i
op_increment
)paren
(brace
r_char
id|c
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|c
comma
op_amp
id|user_buffer
(braket
id|i
)braket
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_switch
c_cond
(paren
id|c
)paren
(brace
r_case
l_char|&squot;&bslash;&quot;&squot;
suffix:colon
r_case
l_char|&squot;&bslash;n&squot;
suffix:colon
r_case
l_char|&squot;&bslash;r&squot;
suffix:colon
r_case
l_char|&squot;&bslash;t&squot;
suffix:colon
r_case
l_char|&squot; &squot;
suffix:colon
r_goto
id|done_str
suffix:semicolon
r_default
suffix:colon
r_break
suffix:semicolon
)brace
suffix:semicolon
)brace
id|done_str
suffix:colon
r_return
id|i
suffix:semicolon
)brace
DECL|function|proc_write
r_static
r_int
id|proc_write
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_const
r_char
id|__user
op_star
id|user_buffer
comma
r_int
r_int
id|count
comma
r_void
op_star
id|data
)paren
(brace
r_int
id|i
op_assign
l_int|0
comma
id|max
comma
id|len
suffix:semicolon
r_char
id|name
(braket
l_int|16
)braket
comma
id|valstr
(braket
l_int|32
)braket
suffix:semicolon
r_int
r_int
id|value
op_assign
l_int|0
suffix:semicolon
r_int
id|idx
op_assign
(paren
r_int
)paren
(paren
r_int
)paren
(paren
id|data
)paren
suffix:semicolon
r_struct
id|pktgen_info
op_star
id|info
op_assign
l_int|NULL
suffix:semicolon
r_char
op_star
id|result
op_assign
l_int|NULL
suffix:semicolon
r_int
id|tmp
suffix:semicolon
r_if
c_cond
(paren
(paren
id|idx
OL
l_int|0
)paren
op_logical_or
(paren
id|idx
op_ge
id|MAX_PKTGEN
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;ERROR: idx: %i is out of range in proc_write&bslash;n&quot;
comma
id|idx
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|info
op_assign
op_amp
(paren
id|pginfos
(braket
id|idx
)braket
)paren
suffix:semicolon
id|result
op_assign
op_amp
(paren
id|info-&gt;result
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|count
OL
l_int|1
)paren
(brace
id|sprintf
c_func
(paren
id|result
comma
l_string|&quot;Wrong command format&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|max
op_assign
id|count
op_minus
id|i
suffix:semicolon
id|tmp
op_assign
id|count_trail_chars
c_func
(paren
op_amp
id|user_buffer
(braket
id|i
)braket
comma
id|max
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tmp
OL
l_int|0
)paren
r_return
id|tmp
suffix:semicolon
id|i
op_add_assign
id|tmp
suffix:semicolon
multiline_comment|/* Read variable name */
id|len
op_assign
id|strn_len
c_func
(paren
op_amp
id|user_buffer
(braket
id|i
)braket
comma
r_sizeof
(paren
id|name
)paren
op_minus
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|len
OL
l_int|0
)paren
r_return
id|len
suffix:semicolon
id|memset
c_func
(paren
id|name
comma
l_int|0
comma
r_sizeof
(paren
id|name
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
id|name
comma
op_amp
id|user_buffer
(braket
id|i
)braket
comma
id|len
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|i
op_add_assign
id|len
suffix:semicolon
id|max
op_assign
id|count
op_minus
id|i
suffix:semicolon
id|len
op_assign
id|count_trail_chars
c_func
(paren
op_amp
id|user_buffer
(braket
id|i
)braket
comma
id|max
)paren
suffix:semicolon
r_if
c_cond
(paren
id|len
OL
l_int|0
)paren
r_return
id|len
suffix:semicolon
id|i
op_add_assign
id|len
suffix:semicolon
r_if
c_cond
(paren
id|debug
)paren
id|printk
c_func
(paren
l_string|&quot;pg: %s,%lu&bslash;n&quot;
comma
id|name
comma
id|count
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|name
comma
l_string|&quot;stop&quot;
)paren
)paren
(brace
r_if
c_cond
(paren
id|info-&gt;do_run_run
)paren
(brace
id|strcpy
c_func
(paren
id|result
comma
l_string|&quot;Stopping&quot;
)paren
suffix:semicolon
)brace
r_else
(brace
id|strcpy
c_func
(paren
id|result
comma
l_string|&quot;Already stopped...&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|info-&gt;do_run_run
op_assign
l_int|0
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|name
comma
l_string|&quot;pkt_size&quot;
)paren
)paren
(brace
id|len
op_assign
id|num_arg
c_func
(paren
op_amp
id|user_buffer
(braket
id|i
)braket
comma
l_int|10
comma
op_amp
id|value
)paren
suffix:semicolon
r_if
c_cond
(paren
id|len
OL
l_int|0
)paren
r_return
id|len
suffix:semicolon
id|i
op_add_assign
id|len
suffix:semicolon
r_if
c_cond
(paren
id|value
OL
l_int|14
op_plus
l_int|20
op_plus
l_int|8
)paren
id|value
op_assign
l_int|14
op_plus
l_int|20
op_plus
l_int|8
suffix:semicolon
id|info-&gt;pkt_size
op_assign
id|value
suffix:semicolon
id|sprintf
c_func
(paren
id|result
comma
l_string|&quot;OK: pkt_size=%u&quot;
comma
id|info-&gt;pkt_size
)paren
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|name
comma
l_string|&quot;frags&quot;
)paren
)paren
(brace
id|len
op_assign
id|num_arg
c_func
(paren
op_amp
id|user_buffer
(braket
id|i
)braket
comma
l_int|10
comma
op_amp
id|value
)paren
suffix:semicolon
r_if
c_cond
(paren
id|len
OL
l_int|0
)paren
r_return
id|len
suffix:semicolon
id|i
op_add_assign
id|len
suffix:semicolon
id|info-&gt;nfrags
op_assign
id|value
suffix:semicolon
id|sprintf
c_func
(paren
id|result
comma
l_string|&quot;OK: frags=%u&quot;
comma
id|info-&gt;nfrags
)paren
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|name
comma
l_string|&quot;ipg&quot;
)paren
)paren
(brace
id|len
op_assign
id|num_arg
c_func
(paren
op_amp
id|user_buffer
(braket
id|i
)braket
comma
l_int|10
comma
op_amp
id|value
)paren
suffix:semicolon
r_if
c_cond
(paren
id|len
OL
l_int|0
)paren
r_return
id|len
suffix:semicolon
id|i
op_add_assign
id|len
suffix:semicolon
id|info-&gt;ipg
op_assign
id|value
suffix:semicolon
id|sprintf
c_func
(paren
id|result
comma
l_string|&quot;OK: ipg=%u&quot;
comma
id|info-&gt;ipg
)paren
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|name
comma
l_string|&quot;udp_src_min&quot;
)paren
)paren
(brace
id|len
op_assign
id|num_arg
c_func
(paren
op_amp
id|user_buffer
(braket
id|i
)braket
comma
l_int|10
comma
op_amp
id|value
)paren
suffix:semicolon
r_if
c_cond
(paren
id|len
OL
l_int|0
)paren
r_return
id|len
suffix:semicolon
id|i
op_add_assign
id|len
suffix:semicolon
id|info-&gt;udp_src_min
op_assign
id|value
suffix:semicolon
id|sprintf
c_func
(paren
id|result
comma
l_string|&quot;OK: udp_src_min=%u&quot;
comma
id|info-&gt;udp_src_min
)paren
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|name
comma
l_string|&quot;udp_dst_min&quot;
)paren
)paren
(brace
id|len
op_assign
id|num_arg
c_func
(paren
op_amp
id|user_buffer
(braket
id|i
)braket
comma
l_int|10
comma
op_amp
id|value
)paren
suffix:semicolon
r_if
c_cond
(paren
id|len
OL
l_int|0
)paren
r_return
id|len
suffix:semicolon
id|i
op_add_assign
id|len
suffix:semicolon
id|info-&gt;udp_dst_min
op_assign
id|value
suffix:semicolon
id|sprintf
c_func
(paren
id|result
comma
l_string|&quot;OK: udp_dst_min=%u&quot;
comma
id|info-&gt;udp_dst_min
)paren
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|name
comma
l_string|&quot;udp_src_max&quot;
)paren
)paren
(brace
id|len
op_assign
id|num_arg
c_func
(paren
op_amp
id|user_buffer
(braket
id|i
)braket
comma
l_int|10
comma
op_amp
id|value
)paren
suffix:semicolon
r_if
c_cond
(paren
id|len
OL
l_int|0
)paren
r_return
id|len
suffix:semicolon
id|i
op_add_assign
id|len
suffix:semicolon
id|info-&gt;udp_src_max
op_assign
id|value
suffix:semicolon
id|sprintf
c_func
(paren
id|result
comma
l_string|&quot;OK: udp_src_max=%u&quot;
comma
id|info-&gt;udp_src_max
)paren
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|name
comma
l_string|&quot;udp_dst_max&quot;
)paren
)paren
(brace
id|len
op_assign
id|num_arg
c_func
(paren
op_amp
id|user_buffer
(braket
id|i
)braket
comma
l_int|10
comma
op_amp
id|value
)paren
suffix:semicolon
r_if
c_cond
(paren
id|len
OL
l_int|0
)paren
r_return
id|len
suffix:semicolon
id|i
op_add_assign
id|len
suffix:semicolon
id|info-&gt;udp_dst_max
op_assign
id|value
suffix:semicolon
id|sprintf
c_func
(paren
id|result
comma
l_string|&quot;OK: udp_dst_max=%u&quot;
comma
id|info-&gt;udp_dst_max
)paren
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|name
comma
l_string|&quot;clone_skb&quot;
)paren
)paren
(brace
id|len
op_assign
id|num_arg
c_func
(paren
op_amp
id|user_buffer
(braket
id|i
)braket
comma
l_int|10
comma
op_amp
id|value
)paren
suffix:semicolon
r_if
c_cond
(paren
id|len
OL
l_int|0
)paren
r_return
id|len
suffix:semicolon
id|i
op_add_assign
id|len
suffix:semicolon
id|info-&gt;clone_skb
op_assign
id|value
suffix:semicolon
id|sprintf
c_func
(paren
id|result
comma
l_string|&quot;OK: clone_skb=%d&quot;
comma
id|info-&gt;clone_skb
)paren
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|name
comma
l_string|&quot;count&quot;
)paren
)paren
(brace
id|len
op_assign
id|num_arg
c_func
(paren
op_amp
id|user_buffer
(braket
id|i
)braket
comma
l_int|10
comma
op_amp
id|value
)paren
suffix:semicolon
r_if
c_cond
(paren
id|len
OL
l_int|0
)paren
r_return
id|len
suffix:semicolon
id|i
op_add_assign
id|len
suffix:semicolon
id|info-&gt;count
op_assign
id|value
suffix:semicolon
id|sprintf
c_func
(paren
id|result
comma
l_string|&quot;OK: count=%llu&quot;
comma
(paren
r_int
r_int
r_int
)paren
id|info-&gt;count
)paren
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|name
comma
l_string|&quot;src_mac_count&quot;
)paren
)paren
(brace
id|len
op_assign
id|num_arg
c_func
(paren
op_amp
id|user_buffer
(braket
id|i
)braket
comma
l_int|10
comma
op_amp
id|value
)paren
suffix:semicolon
r_if
c_cond
(paren
id|len
OL
l_int|0
)paren
r_return
id|len
suffix:semicolon
id|i
op_add_assign
id|len
suffix:semicolon
id|info-&gt;src_mac_count
op_assign
id|value
suffix:semicolon
id|sprintf
c_func
(paren
id|result
comma
l_string|&quot;OK: src_mac_count=%d&quot;
comma
id|info-&gt;src_mac_count
)paren
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|name
comma
l_string|&quot;dst_mac_count&quot;
)paren
)paren
(brace
id|len
op_assign
id|num_arg
c_func
(paren
op_amp
id|user_buffer
(braket
id|i
)braket
comma
l_int|10
comma
op_amp
id|value
)paren
suffix:semicolon
r_if
c_cond
(paren
id|len
OL
l_int|0
)paren
r_return
id|len
suffix:semicolon
id|i
op_add_assign
id|len
suffix:semicolon
id|info-&gt;dst_mac_count
op_assign
id|value
suffix:semicolon
id|sprintf
c_func
(paren
id|result
comma
l_string|&quot;OK: dst_mac_count=%d&quot;
comma
id|info-&gt;dst_mac_count
)paren
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|name
comma
l_string|&quot;odev&quot;
)paren
)paren
(brace
id|len
op_assign
id|strn_len
c_func
(paren
op_amp
id|user_buffer
(braket
id|i
)braket
comma
r_sizeof
(paren
id|info-&gt;outdev
)paren
op_minus
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|len
OL
l_int|0
)paren
r_return
id|len
suffix:semicolon
id|memset
c_func
(paren
id|info-&gt;outdev
comma
l_int|0
comma
r_sizeof
(paren
id|info-&gt;outdev
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
id|info-&gt;outdev
comma
op_amp
id|user_buffer
(braket
id|i
)braket
comma
id|len
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|i
op_add_assign
id|len
suffix:semicolon
id|sprintf
c_func
(paren
id|result
comma
l_string|&quot;OK: odev=%s&quot;
comma
id|info-&gt;outdev
)paren
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|name
comma
l_string|&quot;flag&quot;
)paren
)paren
(brace
r_char
id|f
(braket
l_int|32
)braket
suffix:semicolon
id|len
op_assign
id|strn_len
c_func
(paren
op_amp
id|user_buffer
(braket
id|i
)braket
comma
r_sizeof
(paren
id|f
)paren
op_minus
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|len
OL
l_int|0
)paren
r_return
id|len
suffix:semicolon
id|memset
c_func
(paren
id|f
comma
l_int|0
comma
l_int|32
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
id|f
comma
op_amp
id|user_buffer
(braket
id|i
)braket
comma
id|len
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|i
op_add_assign
id|len
suffix:semicolon
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|f
comma
l_string|&quot;IPSRC_RND&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|info-&gt;flags
op_or_assign
id|F_IPSRC_RND
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|f
comma
l_string|&quot;!IPSRC_RND&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|info-&gt;flags
op_and_assign
op_complement
id|F_IPSRC_RND
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|f
comma
l_string|&quot;IPDST_RND&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|info-&gt;flags
op_or_assign
id|F_IPDST_RND
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|f
comma
l_string|&quot;!IPDST_RND&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|info-&gt;flags
op_and_assign
op_complement
id|F_IPDST_RND
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|f
comma
l_string|&quot;UDPSRC_RND&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|info-&gt;flags
op_or_assign
id|F_UDPSRC_RND
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|f
comma
l_string|&quot;!UDPSRC_RND&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|info-&gt;flags
op_and_assign
op_complement
id|F_UDPSRC_RND
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|f
comma
l_string|&quot;UDPDST_RND&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|info-&gt;flags
op_or_assign
id|F_UDPDST_RND
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|f
comma
l_string|&quot;!UDPDST_RND&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|info-&gt;flags
op_and_assign
op_complement
id|F_UDPDST_RND
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|f
comma
l_string|&quot;MACSRC_RND&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|info-&gt;flags
op_or_assign
id|F_MACSRC_RND
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|f
comma
l_string|&quot;!MACSRC_RND&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|info-&gt;flags
op_and_assign
op_complement
id|F_MACSRC_RND
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|f
comma
l_string|&quot;MACDST_RND&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|info-&gt;flags
op_or_assign
id|F_MACDST_RND
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|f
comma
l_string|&quot;!MACDST_RND&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|info-&gt;flags
op_and_assign
op_complement
id|F_MACDST_RND
suffix:semicolon
)brace
r_else
(brace
id|sprintf
c_func
(paren
id|result
comma
l_string|&quot;Flag -:%s:- unknown&bslash;nAvailable flags, (prepend ! to un-set flag):&bslash;n%s&quot;
comma
id|f
comma
l_string|&quot;IPSRC_RND, IPDST_RND, UDPSRC_RND, UDPDST_RND, MACSRC_RND, MACDST_RND&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
id|sprintf
c_func
(paren
id|result
comma
l_string|&quot;OK: flags=0x%x&quot;
comma
id|info-&gt;flags
)paren
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|name
comma
l_string|&quot;dst_min&quot;
)paren
op_logical_or
op_logical_neg
id|strcmp
c_func
(paren
id|name
comma
l_string|&quot;dst&quot;
)paren
)paren
(brace
id|len
op_assign
id|strn_len
c_func
(paren
op_amp
id|user_buffer
(braket
id|i
)braket
comma
r_sizeof
(paren
id|info-&gt;dst_min
)paren
op_minus
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|len
OL
l_int|0
)paren
r_return
id|len
suffix:semicolon
id|memset
c_func
(paren
id|info-&gt;dst_min
comma
l_int|0
comma
r_sizeof
(paren
id|info-&gt;dst_min
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
id|info-&gt;dst_min
comma
op_amp
id|user_buffer
(braket
id|i
)braket
comma
id|len
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|debug
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;pg: dst_min set to: %s&bslash;n&quot;
comma
id|info-&gt;dst_min
)paren
suffix:semicolon
)brace
id|i
op_add_assign
id|len
suffix:semicolon
id|sprintf
c_func
(paren
id|result
comma
l_string|&quot;OK: dst_min=%s&quot;
comma
id|info-&gt;dst_min
)paren
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|name
comma
l_string|&quot;dst_max&quot;
)paren
)paren
(brace
id|len
op_assign
id|strn_len
c_func
(paren
op_amp
id|user_buffer
(braket
id|i
)braket
comma
r_sizeof
(paren
id|info-&gt;dst_max
)paren
op_minus
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|len
OL
l_int|0
)paren
r_return
id|len
suffix:semicolon
id|memset
c_func
(paren
id|info-&gt;dst_max
comma
l_int|0
comma
r_sizeof
(paren
id|info-&gt;dst_max
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
id|info-&gt;dst_max
comma
op_amp
id|user_buffer
(braket
id|i
)braket
comma
id|len
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|debug
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;pg: dst_max set to: %s&bslash;n&quot;
comma
id|info-&gt;dst_max
)paren
suffix:semicolon
)brace
id|i
op_add_assign
id|len
suffix:semicolon
id|sprintf
c_func
(paren
id|result
comma
l_string|&quot;OK: dst_max=%s&quot;
comma
id|info-&gt;dst_max
)paren
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|name
comma
l_string|&quot;src_min&quot;
)paren
)paren
(brace
id|len
op_assign
id|strn_len
c_func
(paren
op_amp
id|user_buffer
(braket
id|i
)braket
comma
r_sizeof
(paren
id|info-&gt;src_min
)paren
op_minus
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|len
OL
l_int|0
)paren
r_return
id|len
suffix:semicolon
id|memset
c_func
(paren
id|info-&gt;src_min
comma
l_int|0
comma
r_sizeof
(paren
id|info-&gt;src_min
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
id|info-&gt;src_min
comma
op_amp
id|user_buffer
(braket
id|i
)braket
comma
id|len
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|debug
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;pg: src_min set to: %s&bslash;n&quot;
comma
id|info-&gt;src_min
)paren
suffix:semicolon
)brace
id|i
op_add_assign
id|len
suffix:semicolon
id|sprintf
c_func
(paren
id|result
comma
l_string|&quot;OK: src_min=%s&quot;
comma
id|info-&gt;src_min
)paren
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|name
comma
l_string|&quot;src_max&quot;
)paren
)paren
(brace
id|len
op_assign
id|strn_len
c_func
(paren
op_amp
id|user_buffer
(braket
id|i
)braket
comma
r_sizeof
(paren
id|info-&gt;src_max
)paren
op_minus
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|len
OL
l_int|0
)paren
r_return
id|len
suffix:semicolon
id|memset
c_func
(paren
id|info-&gt;src_max
comma
l_int|0
comma
r_sizeof
(paren
id|info-&gt;src_max
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
id|info-&gt;src_max
comma
op_amp
id|user_buffer
(braket
id|i
)braket
comma
id|len
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|debug
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;pg: src_max set to: %s&bslash;n&quot;
comma
id|info-&gt;src_max
)paren
suffix:semicolon
)brace
id|i
op_add_assign
id|len
suffix:semicolon
id|sprintf
c_func
(paren
id|result
comma
l_string|&quot;OK: src_max=%s&quot;
comma
id|info-&gt;src_max
)paren
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|name
comma
l_string|&quot;dstmac&quot;
)paren
)paren
(brace
r_char
op_star
id|v
op_assign
id|valstr
suffix:semicolon
r_int
r_char
op_star
id|m
op_assign
id|info-&gt;dst_mac
suffix:semicolon
id|len
op_assign
id|strn_len
c_func
(paren
op_amp
id|user_buffer
(braket
id|i
)braket
comma
r_sizeof
(paren
id|valstr
)paren
op_minus
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|len
OL
l_int|0
)paren
r_return
id|len
suffix:semicolon
id|memset
c_func
(paren
id|valstr
comma
l_int|0
comma
r_sizeof
(paren
id|valstr
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
id|valstr
comma
op_amp
id|user_buffer
(braket
id|i
)braket
comma
id|len
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|i
op_add_assign
id|len
suffix:semicolon
r_for
c_loop
(paren
op_star
id|m
op_assign
l_int|0
suffix:semicolon
op_star
id|v
op_logical_and
id|m
OL
id|info-&gt;dst_mac
op_plus
l_int|6
suffix:semicolon
id|v
op_increment
)paren
(brace
r_if
c_cond
(paren
op_star
id|v
op_ge
l_char|&squot;0&squot;
op_logical_and
op_star
id|v
op_le
l_char|&squot;9&squot;
)paren
(brace
op_star
id|m
op_mul_assign
l_int|16
suffix:semicolon
op_star
id|m
op_add_assign
op_star
id|v
op_minus
l_char|&squot;0&squot;
suffix:semicolon
)brace
r_if
c_cond
(paren
op_star
id|v
op_ge
l_char|&squot;A&squot;
op_logical_and
op_star
id|v
op_le
l_char|&squot;F&squot;
)paren
(brace
op_star
id|m
op_mul_assign
l_int|16
suffix:semicolon
op_star
id|m
op_add_assign
op_star
id|v
op_minus
l_char|&squot;A&squot;
op_plus
l_int|10
suffix:semicolon
)brace
r_if
c_cond
(paren
op_star
id|v
op_ge
l_char|&squot;a&squot;
op_logical_and
op_star
id|v
op_le
l_char|&squot;f&squot;
)paren
(brace
op_star
id|m
op_mul_assign
l_int|16
suffix:semicolon
op_star
id|m
op_add_assign
op_star
id|v
op_minus
l_char|&squot;a&squot;
op_plus
l_int|10
suffix:semicolon
)brace
r_if
c_cond
(paren
op_star
id|v
op_eq
l_char|&squot;:&squot;
)paren
(brace
id|m
op_increment
suffix:semicolon
op_star
id|m
op_assign
l_int|0
suffix:semicolon
)brace
)brace
id|sprintf
c_func
(paren
id|result
comma
l_string|&quot;OK: dstmac&quot;
)paren
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|name
comma
l_string|&quot;srcmac&quot;
)paren
)paren
(brace
r_char
op_star
id|v
op_assign
id|valstr
suffix:semicolon
r_int
r_char
op_star
id|m
op_assign
id|info-&gt;src_mac
suffix:semicolon
id|len
op_assign
id|strn_len
c_func
(paren
op_amp
id|user_buffer
(braket
id|i
)braket
comma
r_sizeof
(paren
id|valstr
)paren
op_minus
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|len
OL
l_int|0
)paren
r_return
id|len
suffix:semicolon
id|memset
c_func
(paren
id|valstr
comma
l_int|0
comma
r_sizeof
(paren
id|valstr
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
id|valstr
comma
op_amp
id|user_buffer
(braket
id|i
)braket
comma
id|len
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|i
op_add_assign
id|len
suffix:semicolon
r_for
c_loop
(paren
op_star
id|m
op_assign
l_int|0
suffix:semicolon
op_star
id|v
op_logical_and
id|m
OL
id|info-&gt;src_mac
op_plus
l_int|6
suffix:semicolon
id|v
op_increment
)paren
(brace
r_if
c_cond
(paren
op_star
id|v
op_ge
l_char|&squot;0&squot;
op_logical_and
op_star
id|v
op_le
l_char|&squot;9&squot;
)paren
(brace
op_star
id|m
op_mul_assign
l_int|16
suffix:semicolon
op_star
id|m
op_add_assign
op_star
id|v
op_minus
l_char|&squot;0&squot;
suffix:semicolon
)brace
r_if
c_cond
(paren
op_star
id|v
op_ge
l_char|&squot;A&squot;
op_logical_and
op_star
id|v
op_le
l_char|&squot;F&squot;
)paren
(brace
op_star
id|m
op_mul_assign
l_int|16
suffix:semicolon
op_star
id|m
op_add_assign
op_star
id|v
op_minus
l_char|&squot;A&squot;
op_plus
l_int|10
suffix:semicolon
)brace
r_if
c_cond
(paren
op_star
id|v
op_ge
l_char|&squot;a&squot;
op_logical_and
op_star
id|v
op_le
l_char|&squot;f&squot;
)paren
(brace
op_star
id|m
op_mul_assign
l_int|16
suffix:semicolon
op_star
id|m
op_add_assign
op_star
id|v
op_minus
l_char|&squot;a&squot;
op_plus
l_int|10
suffix:semicolon
)brace
r_if
c_cond
(paren
op_star
id|v
op_eq
l_char|&squot;:&squot;
)paren
(brace
id|m
op_increment
suffix:semicolon
op_star
id|m
op_assign
l_int|0
suffix:semicolon
)brace
)brace
id|sprintf
c_func
(paren
id|result
comma
l_string|&quot;OK: srcmac&quot;
)paren
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|name
comma
l_string|&quot;inject&quot;
)paren
op_logical_or
op_logical_neg
id|strcmp
c_func
(paren
id|name
comma
l_string|&quot;start&quot;
)paren
)paren
(brace
r_if
c_cond
(paren
id|info-&gt;busy
)paren
(brace
id|strcpy
c_func
(paren
id|info-&gt;result
comma
l_string|&quot;Already running...&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_else
(brace
id|info-&gt;busy
op_assign
l_int|1
suffix:semicolon
id|strcpy
c_func
(paren
id|info-&gt;result
comma
l_string|&quot;Starting&quot;
)paren
suffix:semicolon
id|inject
c_func
(paren
id|info
)paren
suffix:semicolon
id|info-&gt;busy
op_assign
l_int|0
suffix:semicolon
)brace
r_return
id|count
suffix:semicolon
)brace
id|sprintf
c_func
(paren
id|info-&gt;result
comma
l_string|&quot;No such parameter &bslash;&quot;%s&bslash;&quot;&quot;
comma
id|name
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
DECL|function|create_proc_dir
r_static
r_int
id|create_proc_dir
c_func
(paren
r_void
)paren
(brace
r_int
id|len
suffix:semicolon
multiline_comment|/*  does proc_dir already exists */
id|len
op_assign
id|strlen
c_func
(paren
id|PG_PROC_DIR
)paren
suffix:semicolon
r_for
c_loop
(paren
id|proc_dir
op_assign
id|proc_net-&gt;subdir
suffix:semicolon
id|proc_dir
suffix:semicolon
id|proc_dir
op_assign
id|proc_dir-&gt;next
)paren
(brace
r_if
c_cond
(paren
(paren
id|proc_dir-&gt;namelen
op_eq
id|len
)paren
op_logical_and
(paren
op_logical_neg
id|memcmp
c_func
(paren
id|proc_dir-&gt;name
comma
id|PG_PROC_DIR
comma
id|len
)paren
)paren
)paren
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|proc_dir
)paren
id|proc_dir
op_assign
id|create_proc_entry
c_func
(paren
id|PG_PROC_DIR
comma
id|S_IFDIR
comma
id|proc_net
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|proc_dir
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
DECL|function|remove_proc_dir
r_static
r_int
id|remove_proc_dir
c_func
(paren
r_void
)paren
(brace
id|remove_proc_entry
c_func
(paren
id|PG_PROC_DIR
comma
id|proc_net
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
DECL|function|init
r_static
r_int
id|__init
id|init
c_func
(paren
r_void
)paren
(brace
r_int
id|i
suffix:semicolon
id|printk
c_func
(paren
id|version
)paren
suffix:semicolon
id|cycles_calibrate
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cpu_speed
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;pktgen: Error: your machine does not have working cycle counter.&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|create_proc_dir
c_func
(paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|MAX_PKTGEN
suffix:semicolon
id|i
op_increment
)paren
(brace
id|memset
c_func
(paren
op_amp
(paren
id|pginfos
(braket
id|i
)braket
)paren
comma
l_int|0
comma
r_sizeof
(paren
id|pginfos
(braket
id|i
)braket
)paren
)paren
suffix:semicolon
id|pginfos
(braket
id|i
)braket
dot
id|pkt_size
op_assign
id|ETH_ZLEN
suffix:semicolon
id|pginfos
(braket
id|i
)braket
dot
id|nfrags
op_assign
l_int|0
suffix:semicolon
id|pginfos
(braket
id|i
)braket
dot
id|clone_skb
op_assign
id|clone_skb_d
suffix:semicolon
id|pginfos
(braket
id|i
)braket
dot
id|ipg
op_assign
id|ipg_d
suffix:semicolon
id|pginfos
(braket
id|i
)braket
dot
id|count
op_assign
id|count_d
suffix:semicolon
id|pginfos
(braket
id|i
)braket
dot
id|sofar
op_assign
l_int|0
suffix:semicolon
id|pginfos
(braket
id|i
)braket
dot
id|hh
(braket
l_int|12
)braket
op_assign
l_int|0x08
suffix:semicolon
multiline_comment|/* fill in protocol.  Rest is filled in later. */
id|pginfos
(braket
id|i
)braket
dot
id|hh
(braket
l_int|13
)braket
op_assign
l_int|0x00
suffix:semicolon
id|pginfos
(braket
id|i
)braket
dot
id|udp_src_min
op_assign
l_int|9
suffix:semicolon
multiline_comment|/* sink NULL */
id|pginfos
(braket
id|i
)braket
dot
id|udp_src_max
op_assign
l_int|9
suffix:semicolon
id|pginfos
(braket
id|i
)braket
dot
id|udp_dst_min
op_assign
l_int|9
suffix:semicolon
id|pginfos
(braket
id|i
)braket
dot
id|udp_dst_max
op_assign
l_int|9
suffix:semicolon
id|sprintf
c_func
(paren
id|pginfos
(braket
id|i
)braket
dot
id|fname
comma
l_string|&quot;net/%s/pg%i&quot;
comma
id|PG_PROC_DIR
comma
id|i
)paren
suffix:semicolon
id|pginfos
(braket
id|i
)braket
dot
id|proc_ent
op_assign
id|create_proc_entry
c_func
(paren
id|pginfos
(braket
id|i
)braket
dot
id|fname
comma
l_int|0600
comma
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pginfos
(braket
id|i
)braket
dot
id|proc_ent
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;pktgen: Error: cannot create net/%s/pg procfs entry.&bslash;n&quot;
comma
id|PG_PROC_DIR
)paren
suffix:semicolon
r_goto
id|cleanup_mem
suffix:semicolon
)brace
id|pginfos
(braket
id|i
)braket
dot
id|proc_ent-&gt;read_proc
op_assign
id|proc_read
suffix:semicolon
id|pginfos
(braket
id|i
)braket
dot
id|proc_ent-&gt;write_proc
op_assign
id|proc_write
suffix:semicolon
id|pginfos
(braket
id|i
)braket
dot
id|proc_ent-&gt;data
op_assign
(paren
r_void
op_star
)paren
(paren
r_int
)paren
(paren
id|i
)paren
suffix:semicolon
id|pginfos
(braket
id|i
)braket
dot
id|proc_ent-&gt;owner
op_assign
id|THIS_MODULE
suffix:semicolon
id|sprintf
c_func
(paren
id|pginfos
(braket
id|i
)braket
dot
id|busy_fname
comma
l_string|&quot;net/%s/pg_busy%i&quot;
comma
id|PG_PROC_DIR
comma
id|i
)paren
suffix:semicolon
id|pginfos
(braket
id|i
)braket
dot
id|busy_proc_ent
op_assign
id|create_proc_entry
c_func
(paren
id|pginfos
(braket
id|i
)braket
dot
id|busy_fname
comma
l_int|0
comma
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pginfos
(braket
id|i
)braket
dot
id|busy_proc_ent
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;pktgen: Error: cannot create net/%s/pg_busy procfs entry.&bslash;n&quot;
comma
id|PG_PROC_DIR
)paren
suffix:semicolon
r_goto
id|cleanup_mem
suffix:semicolon
)brace
id|pginfos
(braket
id|i
)braket
dot
id|busy_proc_ent-&gt;read_proc
op_assign
id|proc_busy_read
suffix:semicolon
id|pginfos
(braket
id|i
)braket
dot
id|busy_proc_ent-&gt;data
op_assign
(paren
r_void
op_star
)paren
(paren
r_int
)paren
(paren
id|i
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
id|cleanup_mem
suffix:colon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|MAX_PKTGEN
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|strlen
c_func
(paren
id|pginfos
(braket
id|i
)braket
dot
id|fname
)paren
)paren
(brace
id|remove_proc_entry
c_func
(paren
id|pginfos
(braket
id|i
)braket
dot
id|fname
comma
l_int|NULL
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|strlen
c_func
(paren
id|pginfos
(braket
id|i
)braket
dot
id|busy_fname
)paren
)paren
(brace
id|remove_proc_entry
c_func
(paren
id|pginfos
(braket
id|i
)braket
dot
id|busy_fname
comma
l_int|NULL
)paren
suffix:semicolon
)brace
)brace
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
DECL|function|cleanup
r_static
r_void
id|__exit
id|cleanup
c_func
(paren
r_void
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|MAX_PKTGEN
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|strlen
c_func
(paren
id|pginfos
(braket
id|i
)braket
dot
id|fname
)paren
)paren
(brace
id|remove_proc_entry
c_func
(paren
id|pginfos
(braket
id|i
)braket
dot
id|fname
comma
l_int|NULL
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|strlen
c_func
(paren
id|pginfos
(braket
id|i
)braket
dot
id|busy_fname
)paren
)paren
(brace
id|remove_proc_entry
c_func
(paren
id|pginfos
(braket
id|i
)braket
dot
id|busy_fname
comma
l_int|NULL
)paren
suffix:semicolon
)brace
)brace
id|remove_proc_dir
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|variable|init
id|module_init
c_func
(paren
id|init
)paren
suffix:semicolon
DECL|variable|cleanup
id|module_exit
c_func
(paren
id|cleanup
)paren
suffix:semicolon
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Robert Olsson &lt;robert.olsson@its.uu.se&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;Packet Generator tool&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
id|module_param
c_func
(paren
id|count_d
comma
r_int
comma
l_int|0
)paren
suffix:semicolon
id|module_param
c_func
(paren
id|ipg_d
comma
r_int
comma
l_int|0
)paren
suffix:semicolon
id|module_param
c_func
(paren
id|cpu_speed
comma
r_int
comma
l_int|0
)paren
suffix:semicolon
id|module_param
c_func
(paren
id|clone_skb_d
comma
r_int
comma
l_int|0
)paren
suffix:semicolon
eof
