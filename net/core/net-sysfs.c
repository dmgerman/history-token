multiline_comment|/*&n; * net-sysfs.c - network device class and attributes&n; *&n; * Copyright (c) 2003 Stephen Hemminber &lt;shemminger@osdl.org&gt;&n; * &n; *&n; * TODO:&n; * last_tx&n; * last_rx&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/netdevice.h&gt;
macro_line|#include &lt;linux/if_arp.h&gt;
macro_line|#include &lt;net/sock.h&gt;
macro_line|#include &lt;linux/rtnetlink.h&gt;
DECL|variable|if_port_text
r_const
r_char
op_star
id|if_port_text
(braket
)braket
op_assign
(brace
(braket
id|IF_PORT_UNKNOWN
)braket
op_assign
l_string|&quot;unknown&quot;
comma
(braket
id|IF_PORT_10BASE2
)braket
op_assign
l_string|&quot;BNC&quot;
comma
(braket
id|IF_PORT_10BASET
)braket
op_assign
l_string|&quot;10baseT&quot;
comma
(braket
id|IF_PORT_AUI
)braket
op_assign
l_string|&quot;AUI&quot;
comma
(braket
id|IF_PORT_100BASET
)braket
op_assign
l_string|&quot;100baseT&quot;
comma
(braket
id|IF_PORT_100BASETX
)braket
op_assign
l_string|&quot;100baseTX&quot;
comma
(braket
id|IF_PORT_100BASEFX
)braket
op_assign
l_string|&quot;100baseFX&quot;
)brace
suffix:semicolon
DECL|macro|to_net_dev
mdefine_line|#define to_net_dev(class) container_of((class), struct net_device, class_dev)
multiline_comment|/* generate a show function for  simple field */
DECL|macro|NETDEVICE_SHOW
mdefine_line|#define NETDEVICE_SHOW(field, format_string)&t;&t;&t;&t;&bslash;&n;static ssize_t show_##field(struct class_device *dev, char *buf)&t;&bslash;&n;{&t;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;return sprintf(buf, format_string, to_net_dev(dev)-&gt;field);&t;&bslash;&n;}
multiline_comment|/* generate a store function for a field with locking */
DECL|macro|NETDEVICE_STORE
mdefine_line|#define NETDEVICE_STORE(field)&t;&t;&t;&t;&t;&t;&bslash;&n;static ssize_t &t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;store_##field(struct class_device *dev, const char *buf, size_t len)&t;&bslash;&n;{&t;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;char *endp;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;long new = simple_strtol(buf, &amp;endp, 16);&t;&t;&t;&bslash;&n;&t;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;if (endp == buf || new &lt; 0)&t;&t;&t;&t;&t;&bslash;&n;&t;&t;return -EINVAL;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;if (!capable(CAP_NET_ADMIN))&t;&t;&t;&t;&t;&bslash;&n;&t;&t;return -EPERM;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;rtnl_lock();&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;to_net_dev(dev)-&gt;field = new;&t;&t;&t;&t;&t;&bslash;&n;&t;rtnl_unlock();&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;return len;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;}
multiline_comment|/* generate a read-only network device class attribute */
DECL|macro|NETDEVICE_ATTR
mdefine_line|#define NETDEVICE_ATTR(field, format_string)&t;&t;&t;&t;&bslash;&n;NETDEVICE_SHOW(field, format_string)&t;&t;&t;&t;&t;&bslash;&n;static CLASS_DEVICE_ATTR(field, S_IRUGO, show_##field, NULL)&t;&t;&bslash;&n;
id|NETDEVICE_ATTR
c_func
(paren
id|addr_len
comma
l_string|&quot;%d&bslash;n&quot;
)paren
suffix:semicolon
id|NETDEVICE_ATTR
c_func
(paren
id|iflink
comma
l_string|&quot;%d&bslash;n&quot;
)paren
suffix:semicolon
id|NETDEVICE_ATTR
c_func
(paren
id|ifindex
comma
l_string|&quot;%d&bslash;n&quot;
)paren
suffix:semicolon
id|NETDEVICE_ATTR
c_func
(paren
id|features
comma
l_string|&quot;%#x&bslash;n&quot;
)paren
suffix:semicolon
id|NETDEVICE_ATTR
c_func
(paren
id|type
comma
l_string|&quot;%d&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* TODO: only a few devices set this now should fix others. */
DECL|function|show_port
r_static
id|ssize_t
id|show_port
c_func
(paren
r_struct
id|class_device
op_star
id|dev
comma
r_char
op_star
id|buf
)paren
(brace
r_int
r_char
id|port
op_assign
id|to_net_dev
c_func
(paren
id|dev
)paren
op_member_access_from_pointer
id|if_port
suffix:semicolon
r_char
op_star
id|cp
op_assign
id|buf
suffix:semicolon
id|cp
op_add_assign
id|sprintf
c_func
(paren
id|cp
comma
l_string|&quot;%d&quot;
comma
id|port
)paren
suffix:semicolon
r_if
c_cond
(paren
id|port
OL
id|ARRAY_SIZE
c_func
(paren
id|if_port_text
)paren
)paren
id|cp
op_add_assign
id|sprintf
c_func
(paren
id|cp
comma
l_string|&quot; (%s)&quot;
comma
id|if_port_text
(braket
id|port
)braket
)paren
suffix:semicolon
op_star
id|cp
op_increment
op_assign
l_char|&squot;&bslash;n&squot;
suffix:semicolon
r_return
id|cp
op_minus
id|buf
suffix:semicolon
)brace
r_static
id|CLASS_DEVICE_ATTR
c_func
(paren
id|if_port
comma
id|S_IRUGO
comma
id|show_port
comma
l_int|NULL
)paren
suffix:semicolon
DECL|function|format_addr
r_static
id|ssize_t
id|format_addr
c_func
(paren
r_char
op_star
id|buf
comma
r_const
r_int
r_char
op_star
id|addr
comma
r_int
id|len
)paren
(brace
r_int
id|i
suffix:semicolon
r_char
op_star
id|cp
op_assign
id|buf
suffix:semicolon
id|read_lock
c_func
(paren
op_amp
id|dev_base_lock
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|len
suffix:semicolon
id|i
op_increment
)paren
id|cp
op_add_assign
id|sprintf
c_func
(paren
id|cp
comma
l_string|&quot;%02x%c&quot;
comma
id|addr
(braket
id|i
)braket
comma
id|i
op_eq
(paren
id|len
op_minus
l_int|1
)paren
ques
c_cond
l_char|&squot;&bslash;n&squot;
suffix:colon
l_char|&squot;:&squot;
)paren
suffix:semicolon
id|read_unlock
c_func
(paren
op_amp
id|dev_base_lock
)paren
suffix:semicolon
r_return
id|cp
op_minus
id|buf
suffix:semicolon
)brace
DECL|function|show_address
r_static
id|ssize_t
id|show_address
c_func
(paren
r_struct
id|class_device
op_star
id|dev
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|net_device
op_star
id|net
op_assign
id|to_net_dev
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
id|format_addr
c_func
(paren
id|buf
comma
id|net-&gt;dev_addr
comma
id|net-&gt;addr_len
)paren
suffix:semicolon
)brace
DECL|function|show_broadcast
r_static
id|ssize_t
id|show_broadcast
c_func
(paren
r_struct
id|class_device
op_star
id|dev
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|net_device
op_star
id|net
op_assign
id|to_net_dev
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
id|format_addr
c_func
(paren
id|buf
comma
id|net-&gt;broadcast
comma
id|net-&gt;addr_len
)paren
suffix:semicolon
)brace
r_static
id|CLASS_DEVICE_ATTR
c_func
(paren
id|address
comma
id|S_IRUGO
comma
id|show_address
comma
l_int|NULL
)paren
suffix:semicolon
r_static
id|CLASS_DEVICE_ATTR
c_func
(paren
id|broadcast
comma
id|S_IRUGO
comma
id|show_broadcast
comma
l_int|NULL
)paren
suffix:semicolon
multiline_comment|/* read-write attributes */
id|NETDEVICE_SHOW
c_func
(paren
id|mtu
comma
l_string|&quot;%d&bslash;n&quot;
)paren
suffix:semicolon
DECL|function|store_mtu
r_static
id|ssize_t
id|store_mtu
c_func
(paren
r_struct
id|class_device
op_star
id|dev
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|len
)paren
(brace
r_char
op_star
id|endp
suffix:semicolon
r_int
id|new_mtu
suffix:semicolon
r_int
id|err
suffix:semicolon
id|new_mtu
op_assign
id|simple_strtoul
c_func
(paren
id|buf
comma
op_amp
id|endp
comma
l_int|10
)paren
suffix:semicolon
r_if
c_cond
(paren
id|endp
op_eq
id|buf
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_NET_ADMIN
)paren
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
id|rtnl_lock
c_func
(paren
)paren
suffix:semicolon
id|err
op_assign
id|dev_set_mtu
c_func
(paren
id|to_net_dev
c_func
(paren
id|dev
)paren
comma
id|new_mtu
)paren
suffix:semicolon
id|rtnl_unlock
c_func
(paren
)paren
suffix:semicolon
r_return
id|err
op_eq
l_int|0
ques
c_cond
id|len
suffix:colon
id|err
suffix:semicolon
)brace
r_static
id|CLASS_DEVICE_ATTR
c_func
(paren
id|mtu
comma
id|S_IRUGO
op_or
id|S_IWUSR
comma
id|show_mtu
comma
id|store_mtu
)paren
suffix:semicolon
id|NETDEVICE_SHOW
c_func
(paren
id|flags
comma
l_string|&quot;%#x&bslash;n&quot;
)paren
suffix:semicolon
DECL|function|store_flags
r_static
id|ssize_t
id|store_flags
c_func
(paren
r_struct
id|class_device
op_star
id|dev
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|len
)paren
(brace
r_int
r_int
id|new_flags
suffix:semicolon
r_char
op_star
id|endp
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
id|new_flags
op_assign
id|simple_strtoul
c_func
(paren
id|buf
comma
op_amp
id|endp
comma
l_int|16
)paren
suffix:semicolon
r_if
c_cond
(paren
id|endp
op_eq
id|buf
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_NET_ADMIN
)paren
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
id|rtnl_lock
c_func
(paren
)paren
suffix:semicolon
id|err
op_assign
id|dev_change_flags
c_func
(paren
id|to_net_dev
c_func
(paren
id|dev
)paren
comma
id|new_flags
)paren
suffix:semicolon
id|rtnl_unlock
c_func
(paren
)paren
suffix:semicolon
r_return
id|err
ques
c_cond
id|err
suffix:colon
id|len
suffix:semicolon
)brace
r_static
id|CLASS_DEVICE_ATTR
c_func
(paren
id|flags
comma
id|S_IRUGO
op_or
id|S_IWUSR
comma
id|show_flags
comma
id|store_flags
)paren
suffix:semicolon
id|NETDEVICE_SHOW
c_func
(paren
id|tx_queue_len
comma
l_string|&quot;%lu&bslash;n&quot;
)paren
suffix:semicolon
DECL|variable|tx_queue_len
id|NETDEVICE_STORE
c_func
(paren
id|tx_queue_len
)paren
suffix:semicolon
r_static
id|CLASS_DEVICE_ATTR
c_func
(paren
id|tx_queue_len
comma
id|S_IRUGO
op_or
id|S_IWUSR
comma
id|show_tx_queue_len
comma
id|store_tx_queue_len
)paren
suffix:semicolon
DECL|variable|net_class
r_static
r_struct
r_class
id|net_class
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;net&quot;
comma
)brace
suffix:semicolon
DECL|variable|net_class_attributes
r_static
r_struct
id|class_device_attribute
op_star
id|net_class_attributes
(braket
)braket
op_assign
(brace
op_amp
id|class_device_attr_ifindex
comma
op_amp
id|class_device_attr_iflink
comma
op_amp
id|class_device_attr_addr_len
comma
op_amp
id|class_device_attr_tx_queue_len
comma
op_amp
id|class_device_attr_features
comma
op_amp
id|class_device_attr_mtu
comma
op_amp
id|class_device_attr_flags
comma
op_amp
id|class_device_attr_if_port
comma
op_amp
id|class_device_attr_type
comma
op_amp
id|class_device_attr_address
comma
op_amp
id|class_device_attr_broadcast
comma
l_int|NULL
)brace
suffix:semicolon
DECL|struct|netstat_fs_entry
r_struct
id|netstat_fs_entry
(brace
DECL|member|attr
r_struct
id|attribute
id|attr
suffix:semicolon
DECL|member|show
id|ssize_t
(paren
op_star
id|show
)paren
(paren
r_const
r_struct
id|net_device_stats
op_star
comma
r_char
op_star
)paren
suffix:semicolon
DECL|member|store
id|ssize_t
(paren
op_star
id|store
)paren
(paren
r_struct
id|net_device_stats
op_star
comma
r_const
r_char
op_star
comma
r_int
)paren
suffix:semicolon
)brace
suffix:semicolon
DECL|function|net_device_stat_show
r_static
id|ssize_t
id|net_device_stat_show
c_func
(paren
r_int
r_int
id|var
comma
r_char
op_star
id|buf
)paren
(brace
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%ld&bslash;n&quot;
comma
id|var
)paren
suffix:semicolon
)brace
multiline_comment|/* generate a read-only statistics attribute */
DECL|macro|NETDEVICE_STAT
mdefine_line|#define NETDEVICE_STAT(_NAME)&t;&t;&t;&t;&t;&t;&bslash;&n;static ssize_t show_stat_##_NAME(const struct net_device_stats *stats,&t;&bslash;&n;&t;&t;&t;&t; char *buf)&t;&t;&t;&t;&bslash;&n;{&t;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;return net_device_stat_show(stats-&gt;_NAME, buf);&t;&t;&t;&bslash;&n;}&t;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;static struct netstat_fs_entry net_stat_##_NAME  = {&t;&t;   &t;&bslash;&n;&t;.attr = {.name = __stringify(_NAME), .mode = S_IRUGO },&t;&t;&bslash;&n;&t;.show = show_stat_##_NAME,&t;&t;&t;&t;&t;&bslash;&n;}
DECL|variable|rx_packets
id|NETDEVICE_STAT
c_func
(paren
id|rx_packets
)paren
suffix:semicolon
DECL|variable|tx_packets
id|NETDEVICE_STAT
c_func
(paren
id|tx_packets
)paren
suffix:semicolon
DECL|variable|rx_bytes
id|NETDEVICE_STAT
c_func
(paren
id|rx_bytes
)paren
suffix:semicolon
DECL|variable|tx_bytes
id|NETDEVICE_STAT
c_func
(paren
id|tx_bytes
)paren
suffix:semicolon
DECL|variable|rx_errors
id|NETDEVICE_STAT
c_func
(paren
id|rx_errors
)paren
suffix:semicolon
DECL|variable|tx_errors
id|NETDEVICE_STAT
c_func
(paren
id|tx_errors
)paren
suffix:semicolon
DECL|variable|rx_dropped
id|NETDEVICE_STAT
c_func
(paren
id|rx_dropped
)paren
suffix:semicolon
DECL|variable|tx_dropped
id|NETDEVICE_STAT
c_func
(paren
id|tx_dropped
)paren
suffix:semicolon
DECL|variable|multicast
id|NETDEVICE_STAT
c_func
(paren
id|multicast
)paren
suffix:semicolon
DECL|variable|collisions
id|NETDEVICE_STAT
c_func
(paren
id|collisions
)paren
suffix:semicolon
DECL|variable|rx_length_errors
id|NETDEVICE_STAT
c_func
(paren
id|rx_length_errors
)paren
suffix:semicolon
DECL|variable|rx_over_errors
id|NETDEVICE_STAT
c_func
(paren
id|rx_over_errors
)paren
suffix:semicolon
DECL|variable|rx_crc_errors
id|NETDEVICE_STAT
c_func
(paren
id|rx_crc_errors
)paren
suffix:semicolon
DECL|variable|rx_frame_errors
id|NETDEVICE_STAT
c_func
(paren
id|rx_frame_errors
)paren
suffix:semicolon
DECL|variable|rx_fifo_errors
id|NETDEVICE_STAT
c_func
(paren
id|rx_fifo_errors
)paren
suffix:semicolon
DECL|variable|rx_missed_errors
id|NETDEVICE_STAT
c_func
(paren
id|rx_missed_errors
)paren
suffix:semicolon
DECL|variable|tx_aborted_errors
id|NETDEVICE_STAT
c_func
(paren
id|tx_aborted_errors
)paren
suffix:semicolon
DECL|variable|tx_carrier_errors
id|NETDEVICE_STAT
c_func
(paren
id|tx_carrier_errors
)paren
suffix:semicolon
DECL|variable|tx_fifo_errors
id|NETDEVICE_STAT
c_func
(paren
id|tx_fifo_errors
)paren
suffix:semicolon
DECL|variable|tx_heartbeat_errors
id|NETDEVICE_STAT
c_func
(paren
id|tx_heartbeat_errors
)paren
suffix:semicolon
DECL|variable|tx_window_errors
id|NETDEVICE_STAT
c_func
(paren
id|tx_window_errors
)paren
suffix:semicolon
DECL|variable|rx_compressed
id|NETDEVICE_STAT
c_func
(paren
id|rx_compressed
)paren
suffix:semicolon
DECL|variable|tx_compressed
id|NETDEVICE_STAT
c_func
(paren
id|tx_compressed
)paren
suffix:semicolon
DECL|variable|default_attrs
r_static
r_struct
id|attribute
op_star
id|default_attrs
(braket
)braket
op_assign
(brace
op_amp
id|net_stat_rx_packets.attr
comma
op_amp
id|net_stat_tx_packets.attr
comma
op_amp
id|net_stat_rx_bytes.attr
comma
op_amp
id|net_stat_tx_bytes.attr
comma
op_amp
id|net_stat_rx_errors.attr
comma
op_amp
id|net_stat_tx_errors.attr
comma
op_amp
id|net_stat_rx_dropped.attr
comma
op_amp
id|net_stat_tx_dropped.attr
comma
op_amp
id|net_stat_multicast.attr
comma
op_amp
id|net_stat_collisions.attr
comma
op_amp
id|net_stat_rx_length_errors.attr
comma
op_amp
id|net_stat_rx_over_errors.attr
comma
op_amp
id|net_stat_rx_crc_errors.attr
comma
op_amp
id|net_stat_rx_frame_errors.attr
comma
op_amp
id|net_stat_rx_fifo_errors.attr
comma
op_amp
id|net_stat_rx_missed_errors.attr
comma
op_amp
id|net_stat_tx_aborted_errors.attr
comma
op_amp
id|net_stat_tx_carrier_errors.attr
comma
op_amp
id|net_stat_tx_fifo_errors.attr
comma
op_amp
id|net_stat_tx_heartbeat_errors.attr
comma
op_amp
id|net_stat_tx_window_errors.attr
comma
op_amp
id|net_stat_rx_compressed.attr
comma
op_amp
id|net_stat_tx_compressed.attr
comma
l_int|NULL
)brace
suffix:semicolon
r_static
id|ssize_t
DECL|function|netstat_attr_show
id|netstat_attr_show
c_func
(paren
r_struct
id|kobject
op_star
id|kobj
comma
r_struct
id|attribute
op_star
id|attr
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|netstat_fs_entry
op_star
id|entry
op_assign
id|container_of
c_func
(paren
id|attr
comma
r_struct
id|netstat_fs_entry
comma
id|attr
)paren
suffix:semicolon
r_struct
id|class_device
op_star
id|class_dev
op_assign
id|container_of
c_func
(paren
id|kobj-&gt;parent
comma
r_struct
id|class_device
comma
id|kobj
)paren
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
op_assign
id|to_net_dev
c_func
(paren
id|class_dev
)paren
suffix:semicolon
r_struct
id|net_device_stats
op_star
id|stats
op_assign
id|dev-&gt;get_stats
ques
c_cond
id|dev
op_member_access_from_pointer
id|get_stats
c_func
(paren
id|dev
)paren
suffix:colon
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|stats
op_logical_and
id|entry-&gt;show
)paren
r_return
id|entry
op_member_access_from_pointer
id|show
c_func
(paren
id|stats
comma
id|buf
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
DECL|variable|netstat_sysfs_ops
r_static
r_struct
id|sysfs_ops
id|netstat_sysfs_ops
op_assign
(brace
dot
id|show
op_assign
id|netstat_attr_show
comma
)brace
suffix:semicolon
DECL|variable|netstat_ktype
r_static
r_struct
id|kobj_type
id|netstat_ktype
op_assign
(brace
dot
id|sysfs_ops
op_assign
op_amp
id|netstat_sysfs_ops
comma
dot
id|default_attrs
op_assign
id|default_attrs
comma
)brace
suffix:semicolon
multiline_comment|/* Create sysfs entries for network device. */
DECL|function|netdev_register_sysfs
r_int
id|netdev_register_sysfs
c_func
(paren
r_struct
id|net_device
op_star
id|net
)paren
(brace
r_struct
id|class_device
op_star
id|class_dev
op_assign
op_amp
(paren
id|net-&gt;class_dev
)paren
suffix:semicolon
r_int
id|i
suffix:semicolon
r_struct
id|class_device_attribute
op_star
id|attr
suffix:semicolon
r_int
id|ret
suffix:semicolon
id|class_dev
op_member_access_from_pointer
r_class
op_assign
op_amp
id|net_class
suffix:semicolon
id|class_dev-&gt;class_data
op_assign
id|net
suffix:semicolon
id|strlcpy
c_func
(paren
id|class_dev-&gt;class_id
comma
id|net-&gt;name
comma
id|BUS_ID_SIZE
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|class_device_register
c_func
(paren
id|class_dev
)paren
)paren
)paren
r_goto
id|out
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
(paren
id|attr
op_assign
id|net_class_attributes
(braket
id|i
)braket
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|class_device_create_file
c_func
(paren
id|class_dev
comma
id|attr
)paren
)paren
)paren
r_goto
id|out_unreg
suffix:semicolon
)brace
id|net-&gt;stats_kobj.parent
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|net-&gt;get_stats
)paren
(brace
r_struct
id|kobject
op_star
id|k
op_assign
op_amp
id|net-&gt;stats_kobj
suffix:semicolon
id|k-&gt;parent
op_assign
id|kobject_get
c_func
(paren
op_amp
id|class_dev-&gt;kobj
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|k-&gt;parent
)paren
(brace
id|ret
op_assign
op_minus
id|EBUSY
suffix:semicolon
r_goto
id|out_unreg
suffix:semicolon
)brace
id|strlcpy
c_func
(paren
id|k-&gt;name
comma
l_string|&quot;statistics&quot;
comma
id|KOBJ_NAME_LEN
)paren
suffix:semicolon
id|k-&gt;ktype
op_assign
op_amp
id|netstat_ktype
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|kobject_register
c_func
(paren
id|k
)paren
)paren
)paren
(brace
r_goto
id|out_unreg
suffix:semicolon
)brace
)brace
id|out
suffix:colon
r_return
id|ret
suffix:semicolon
id|out_unreg
suffix:colon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: sysfs attribute registration failed %d&bslash;n&quot;
comma
id|net-&gt;name
comma
id|ret
)paren
suffix:semicolon
id|class_device_unregister
c_func
(paren
id|class_dev
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
DECL|function|netdev_unregister_sysfs
r_void
id|netdev_unregister_sysfs
c_func
(paren
r_struct
id|net_device
op_star
id|net
)paren
(brace
r_if
c_cond
(paren
id|net-&gt;stats_kobj.parent
)paren
id|kobject_unregister
c_func
(paren
op_amp
id|net-&gt;stats_kobj
)paren
suffix:semicolon
id|class_device_unregister
c_func
(paren
op_amp
id|net-&gt;class_dev
)paren
suffix:semicolon
)brace
DECL|function|netdev_sysfs_init
r_int
id|netdev_sysfs_init
c_func
(paren
r_void
)paren
(brace
r_return
id|class_register
c_func
(paren
op_amp
id|net_class
)paren
suffix:semicolon
)brace
eof
