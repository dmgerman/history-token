multiline_comment|/*&n; *&t;Sysfs attributes of bridge ports&n; *&t;Linux ethernet bridge&n; *&n; *&t;Authors:&n; *&t;Stephen Hemminger&t;&t;&lt;shemminger@osdl.org&gt;&n; *&n; *&t;This program is free software; you can redistribute it and/or&n; *&t;modify it under the terms of the GNU General Public License&n; *&t;as published by the Free Software Foundation; either version&n; *&t;2 of the License, or (at your option) any later version.&n; */
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/netdevice.h&gt;
macro_line|#include &lt;linux/if_bridge.h&gt;
macro_line|#include &lt;linux/rtnetlink.h&gt;
macro_line|#include &lt;linux/spinlock.h&gt;
macro_line|#include &quot;br_private.h&quot;
DECL|struct|brport_attribute
r_struct
id|brport_attribute
(brace
DECL|member|attr
r_struct
id|attribute
id|attr
suffix:semicolon
DECL|member|show
id|ssize_t
(paren
op_star
id|show
)paren
(paren
r_struct
id|net_bridge_port
op_star
comma
r_char
op_star
)paren
suffix:semicolon
DECL|member|store
id|ssize_t
(paren
op_star
id|store
)paren
(paren
r_struct
id|net_bridge_port
op_star
comma
r_int
r_int
)paren
suffix:semicolon
)brace
suffix:semicolon
DECL|macro|BRPORT_ATTR
mdefine_line|#define BRPORT_ATTR(_name,_mode,_show,_store)&t;&t;        &bslash;&n;struct brport_attribute brport_attr_##_name = { &t;        &bslash;&n;&t;.attr = {.name = __stringify(_name), &t;&t;&t;&bslash;&n;&t;&t; .mode = _mode, &t;&t;&t;&t;&bslash;&n;&t;&t; .owner = THIS_MODULE, },&t;&t;&t;&bslash;&n;&t;.show&t;= _show,&t;&t;&t;&t;&t;&bslash;&n;&t;.store&t;= _store,&t;&t;&t;&t;&t;&bslash;&n;};
DECL|function|show_path_cost
r_static
id|ssize_t
id|show_path_cost
c_func
(paren
r_struct
id|net_bridge_port
op_star
id|p
comma
r_char
op_star
id|buf
)paren
(brace
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%d&bslash;n&quot;
comma
id|p-&gt;path_cost
)paren
suffix:semicolon
)brace
DECL|function|store_path_cost
r_static
id|ssize_t
id|store_path_cost
c_func
(paren
r_struct
id|net_bridge_port
op_star
id|p
comma
r_int
r_int
id|v
)paren
(brace
id|br_stp_set_path_cost
c_func
(paren
id|p
comma
id|v
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
id|BRPORT_ATTR
c_func
(paren
id|path_cost
comma
id|S_IRUGO
op_or
id|S_IWUSR
comma
id|show_path_cost
comma
id|store_path_cost
)paren
suffix:semicolon
DECL|function|show_priority
r_static
id|ssize_t
id|show_priority
c_func
(paren
r_struct
id|net_bridge_port
op_star
id|p
comma
r_char
op_star
id|buf
)paren
(brace
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%d&bslash;n&quot;
comma
id|p-&gt;priority
)paren
suffix:semicolon
)brace
DECL|function|store_priority
r_static
id|ssize_t
id|store_priority
c_func
(paren
r_struct
id|net_bridge_port
op_star
id|p
comma
r_int
r_int
id|v
)paren
(brace
r_if
c_cond
(paren
id|v
op_ge
(paren
l_int|1
op_lshift
(paren
l_int|16
op_minus
id|BR_PORT_BITS
)paren
)paren
)paren
r_return
op_minus
id|ERANGE
suffix:semicolon
id|br_stp_set_port_priority
c_func
(paren
id|p
comma
id|v
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
id|BRPORT_ATTR
c_func
(paren
id|priority
comma
id|S_IRUGO
op_or
id|S_IWUSR
comma
id|show_priority
comma
id|store_priority
)paren
suffix:semicolon
DECL|function|show_designated_root
r_static
id|ssize_t
id|show_designated_root
c_func
(paren
r_struct
id|net_bridge_port
op_star
id|p
comma
r_char
op_star
id|buf
)paren
(brace
r_return
id|br_show_bridge_id
c_func
(paren
id|buf
comma
op_amp
id|p-&gt;designated_root
)paren
suffix:semicolon
)brace
r_static
id|BRPORT_ATTR
c_func
(paren
id|designated_root
comma
id|S_IRUGO
comma
id|show_designated_root
comma
l_int|NULL
)paren
suffix:semicolon
DECL|function|show_designated_bridge
r_static
id|ssize_t
id|show_designated_bridge
c_func
(paren
r_struct
id|net_bridge_port
op_star
id|p
comma
r_char
op_star
id|buf
)paren
(brace
r_return
id|br_show_bridge_id
c_func
(paren
id|buf
comma
op_amp
id|p-&gt;designated_bridge
)paren
suffix:semicolon
)brace
r_static
id|BRPORT_ATTR
c_func
(paren
id|designated_bridge
comma
id|S_IRUGO
comma
id|show_designated_bridge
comma
l_int|NULL
)paren
suffix:semicolon
DECL|function|show_designated_port
r_static
id|ssize_t
id|show_designated_port
c_func
(paren
r_struct
id|net_bridge_port
op_star
id|p
comma
r_char
op_star
id|buf
)paren
(brace
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%d&bslash;n&quot;
comma
id|p-&gt;designated_port
)paren
suffix:semicolon
)brace
r_static
id|BRPORT_ATTR
c_func
(paren
id|designated_port
comma
id|S_IRUGO
comma
id|show_designated_port
comma
l_int|NULL
)paren
suffix:semicolon
DECL|function|show_designated_cost
r_static
id|ssize_t
id|show_designated_cost
c_func
(paren
r_struct
id|net_bridge_port
op_star
id|p
comma
r_char
op_star
id|buf
)paren
(brace
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%d&bslash;n&quot;
comma
id|p-&gt;designated_cost
)paren
suffix:semicolon
)brace
r_static
id|BRPORT_ATTR
c_func
(paren
id|designated_cost
comma
id|S_IRUGO
comma
id|show_designated_cost
comma
l_int|NULL
)paren
suffix:semicolon
DECL|function|show_port_id
r_static
id|ssize_t
id|show_port_id
c_func
(paren
r_struct
id|net_bridge_port
op_star
id|p
comma
r_char
op_star
id|buf
)paren
(brace
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;0x%x&bslash;n&quot;
comma
id|p-&gt;port_id
)paren
suffix:semicolon
)brace
r_static
id|BRPORT_ATTR
c_func
(paren
id|port_id
comma
id|S_IRUGO
comma
id|show_port_id
comma
l_int|NULL
)paren
suffix:semicolon
DECL|function|show_port_no
r_static
id|ssize_t
id|show_port_no
c_func
(paren
r_struct
id|net_bridge_port
op_star
id|p
comma
r_char
op_star
id|buf
)paren
(brace
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;0x%x&bslash;n&quot;
comma
id|p-&gt;port_no
)paren
suffix:semicolon
)brace
r_static
id|BRPORT_ATTR
c_func
(paren
id|port_no
comma
id|S_IRUGO
comma
id|show_port_no
comma
l_int|NULL
)paren
suffix:semicolon
DECL|function|show_change_ack
r_static
id|ssize_t
id|show_change_ack
c_func
(paren
r_struct
id|net_bridge_port
op_star
id|p
comma
r_char
op_star
id|buf
)paren
(brace
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%d&bslash;n&quot;
comma
id|p-&gt;topology_change_ack
)paren
suffix:semicolon
)brace
r_static
id|BRPORT_ATTR
c_func
(paren
id|change_ack
comma
id|S_IRUGO
comma
id|show_change_ack
comma
l_int|NULL
)paren
suffix:semicolon
DECL|function|show_config_pending
r_static
id|ssize_t
id|show_config_pending
c_func
(paren
r_struct
id|net_bridge_port
op_star
id|p
comma
r_char
op_star
id|buf
)paren
(brace
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%d&bslash;n&quot;
comma
id|p-&gt;config_pending
)paren
suffix:semicolon
)brace
r_static
id|BRPORT_ATTR
c_func
(paren
id|config_pending
comma
id|S_IRUGO
comma
id|show_config_pending
comma
l_int|NULL
)paren
suffix:semicolon
DECL|function|show_port_state
r_static
id|ssize_t
id|show_port_state
c_func
(paren
r_struct
id|net_bridge_port
op_star
id|p
comma
r_char
op_star
id|buf
)paren
(brace
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%d&bslash;n&quot;
comma
id|p-&gt;state
)paren
suffix:semicolon
)brace
r_static
id|BRPORT_ATTR
c_func
(paren
id|state
comma
id|S_IRUGO
comma
id|show_port_state
comma
l_int|NULL
)paren
suffix:semicolon
DECL|function|show_message_age_timer
r_static
id|ssize_t
id|show_message_age_timer
c_func
(paren
r_struct
id|net_bridge_port
op_star
id|p
comma
r_char
op_star
id|buf
)paren
(brace
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%ld&bslash;n&quot;
comma
id|br_timer_value
c_func
(paren
op_amp
id|p-&gt;message_age_timer
)paren
)paren
suffix:semicolon
)brace
r_static
id|BRPORT_ATTR
c_func
(paren
id|message_age_timer
comma
id|S_IRUGO
comma
id|show_message_age_timer
comma
l_int|NULL
)paren
suffix:semicolon
DECL|function|show_forward_delay_timer
r_static
id|ssize_t
id|show_forward_delay_timer
c_func
(paren
r_struct
id|net_bridge_port
op_star
id|p
comma
r_char
op_star
id|buf
)paren
(brace
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%ld&bslash;n&quot;
comma
id|br_timer_value
c_func
(paren
op_amp
id|p-&gt;forward_delay_timer
)paren
)paren
suffix:semicolon
)brace
r_static
id|BRPORT_ATTR
c_func
(paren
id|forward_delay_timer
comma
id|S_IRUGO
comma
id|show_forward_delay_timer
comma
l_int|NULL
)paren
suffix:semicolon
DECL|function|show_hold_timer
r_static
id|ssize_t
id|show_hold_timer
c_func
(paren
r_struct
id|net_bridge_port
op_star
id|p
comma
r_char
op_star
id|buf
)paren
(brace
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%ld&bslash;n&quot;
comma
id|br_timer_value
c_func
(paren
op_amp
id|p-&gt;hold_timer
)paren
)paren
suffix:semicolon
)brace
r_static
id|BRPORT_ATTR
c_func
(paren
id|hold_timer
comma
id|S_IRUGO
comma
id|show_hold_timer
comma
l_int|NULL
)paren
suffix:semicolon
DECL|variable|brport_attrs
r_static
r_struct
id|brport_attribute
op_star
id|brport_attrs
(braket
)braket
op_assign
(brace
op_amp
id|brport_attr_path_cost
comma
op_amp
id|brport_attr_priority
comma
op_amp
id|brport_attr_port_id
comma
op_amp
id|brport_attr_port_no
comma
op_amp
id|brport_attr_designated_root
comma
op_amp
id|brport_attr_designated_bridge
comma
op_amp
id|brport_attr_designated_port
comma
op_amp
id|brport_attr_designated_cost
comma
op_amp
id|brport_attr_state
comma
op_amp
id|brport_attr_change_ack
comma
op_amp
id|brport_attr_config_pending
comma
op_amp
id|brport_attr_message_age_timer
comma
op_amp
id|brport_attr_forward_delay_timer
comma
op_amp
id|brport_attr_hold_timer
comma
l_int|NULL
)brace
suffix:semicolon
DECL|macro|to_brport_attr
mdefine_line|#define to_brport_attr(_at) container_of(_at, struct brport_attribute, attr)
DECL|macro|to_brport
mdefine_line|#define to_brport(obj)&t;container_of(obj, struct net_bridge_port, kobj)
DECL|function|brport_show
r_static
id|ssize_t
id|brport_show
c_func
(paren
r_struct
id|kobject
op_star
id|kobj
comma
r_struct
id|attribute
op_star
id|attr
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|brport_attribute
op_star
id|brport_attr
op_assign
id|to_brport_attr
c_func
(paren
id|attr
)paren
suffix:semicolon
r_struct
id|net_bridge_port
op_star
id|p
op_assign
id|to_brport
c_func
(paren
id|kobj
)paren
suffix:semicolon
r_return
id|brport_attr
op_member_access_from_pointer
id|show
c_func
(paren
id|p
comma
id|buf
)paren
suffix:semicolon
)brace
DECL|function|brport_store
r_static
id|ssize_t
id|brport_store
c_func
(paren
r_struct
id|kobject
op_star
id|kobj
comma
r_struct
id|attribute
op_star
id|attr
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
)paren
(brace
r_struct
id|brport_attribute
op_star
id|brport_attr
op_assign
id|to_brport_attr
c_func
(paren
id|attr
)paren
suffix:semicolon
r_struct
id|net_bridge_port
op_star
id|p
op_assign
id|to_brport
c_func
(paren
id|kobj
)paren
suffix:semicolon
id|ssize_t
id|ret
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_char
op_star
id|endp
suffix:semicolon
r_int
r_int
id|val
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_NET_ADMIN
)paren
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
id|val
op_assign
id|simple_strtoul
c_func
(paren
id|buf
comma
op_amp
id|endp
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|endp
op_ne
id|buf
)paren
(brace
id|rtnl_lock
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;dev
op_logical_and
id|p-&gt;br
op_logical_and
id|brport_attr-&gt;store
)paren
(brace
id|spin_lock_bh
c_func
(paren
op_amp
id|p-&gt;br-&gt;lock
)paren
suffix:semicolon
id|ret
op_assign
id|brport_attr
op_member_access_from_pointer
id|store
c_func
(paren
id|p
comma
id|val
)paren
suffix:semicolon
id|spin_unlock_bh
c_func
(paren
op_amp
id|p-&gt;br-&gt;lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
op_eq
l_int|0
)paren
id|ret
op_assign
id|count
suffix:semicolon
)brace
id|rtnl_unlock
c_func
(paren
)paren
suffix:semicolon
)brace
r_return
id|ret
suffix:semicolon
)brace
multiline_comment|/* called from kobject_put when port ref count goes to zero. */
DECL|function|brport_release
r_static
r_void
id|brport_release
c_func
(paren
r_struct
id|kobject
op_star
id|kobj
)paren
(brace
id|kfree
c_func
(paren
id|container_of
c_func
(paren
id|kobj
comma
r_struct
id|net_bridge_port
comma
id|kobj
)paren
)paren
suffix:semicolon
)brace
DECL|variable|brport_sysfs_ops
r_static
r_struct
id|sysfs_ops
id|brport_sysfs_ops
op_assign
(brace
dot
id|show
op_assign
id|brport_show
comma
dot
id|store
op_assign
id|brport_store
comma
)brace
suffix:semicolon
DECL|variable|brport_ktype
r_static
r_struct
id|kobj_type
id|brport_ktype
op_assign
(brace
dot
id|sysfs_ops
op_assign
op_amp
id|brport_sysfs_ops
comma
dot
id|release
op_assign
id|brport_release
comma
)brace
suffix:semicolon
multiline_comment|/*&n; * Add sysfs entries to ethernet device added to a bridge.&n; * Creates a brport subdirectory with bridge attributes.&n; * Puts symlink in bridge&squot;s brport subdirectory&n; */
DECL|function|br_sysfs_addif
r_int
id|br_sysfs_addif
c_func
(paren
r_struct
id|net_bridge_port
op_star
id|p
)paren
(brace
r_struct
id|net_bridge
op_star
id|br
op_assign
id|p-&gt;br
suffix:semicolon
r_struct
id|brport_attribute
op_star
op_star
id|a
suffix:semicolon
r_int
id|err
suffix:semicolon
id|ASSERT_RTNL
c_func
(paren
)paren
suffix:semicolon
id|kobject_set_name
c_func
(paren
op_amp
id|p-&gt;kobj
comma
id|SYSFS_BRIDGE_PORT_ATTR
)paren
suffix:semicolon
id|p-&gt;kobj.ktype
op_assign
op_amp
id|brport_ktype
suffix:semicolon
id|p-&gt;kobj.parent
op_assign
op_amp
(paren
id|p-&gt;dev-&gt;class_dev.kobj
)paren
suffix:semicolon
id|p-&gt;kobj.kset
op_assign
l_int|NULL
suffix:semicolon
id|err
op_assign
id|kobject_add
c_func
(paren
op_amp
id|p-&gt;kobj
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
r_goto
id|out1
suffix:semicolon
)brace
id|err
op_assign
id|sysfs_create_link
c_func
(paren
op_amp
id|p-&gt;kobj
comma
op_amp
id|br-&gt;dev-&gt;class_dev.kobj
comma
id|SYSFS_BRIDGE_PORT_LINK
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_goto
id|out2
suffix:semicolon
r_for
c_loop
(paren
id|a
op_assign
id|brport_attrs
suffix:semicolon
op_star
id|a
suffix:semicolon
op_increment
id|a
)paren
(brace
id|err
op_assign
id|sysfs_create_file
c_func
(paren
op_amp
id|p-&gt;kobj
comma
op_amp
(paren
(paren
op_star
id|a
)paren
op_member_access_from_pointer
id|attr
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_goto
id|out2
suffix:semicolon
)brace
id|err
op_assign
id|sysfs_create_link
c_func
(paren
op_amp
id|br-&gt;ifobj
comma
op_amp
id|p-&gt;kobj
comma
id|p-&gt;dev-&gt;name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_goto
id|out2
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|out2
suffix:colon
id|kobject_del
c_func
(paren
op_amp
id|p-&gt;kobj
)paren
suffix:semicolon
id|out1
suffix:colon
r_return
id|err
suffix:semicolon
)brace
DECL|function|br_sysfs_removeif
r_void
id|br_sysfs_removeif
c_func
(paren
r_struct
id|net_bridge_port
op_star
id|p
)paren
(brace
id|pr_debug
c_func
(paren
l_string|&quot;br_sysfs_removeif&bslash;n&quot;
)paren
suffix:semicolon
id|sysfs_remove_link
c_func
(paren
op_amp
id|p-&gt;br-&gt;ifobj
comma
id|p-&gt;dev-&gt;name
)paren
suffix:semicolon
id|kobject_del
c_func
(paren
op_amp
id|p-&gt;kobj
)paren
suffix:semicolon
)brace
DECL|function|br_sysfs_freeif
r_void
id|br_sysfs_freeif
c_func
(paren
r_struct
id|net_bridge_port
op_star
id|p
)paren
(brace
id|pr_debug
c_func
(paren
l_string|&quot;br_sysfs_freeif&bslash;n&quot;
)paren
suffix:semicolon
id|kobject_put
c_func
(paren
op_amp
id|p-&gt;kobj
)paren
suffix:semicolon
)brace
eof
