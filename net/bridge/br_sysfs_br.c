multiline_comment|/*&n; *&t;Sysfs attributes of bridge ports&n; *&t;Linux ethernet bridge&n; *&n; *&t;Authors:&n; *&t;Stephen Hemminger&t;&t;&lt;shemminger@osdl.org&gt;&n; *&n; *&t;This program is free software; you can redistribute it and/or&n; *&t;modify it under the terms of the GNU General Public License&n; *&t;as published by the Free Software Foundation; either version&n; *&t;2 of the License, or (at your option) any later version.&n; */
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/netdevice.h&gt;
macro_line|#include &lt;linux/if_bridge.h&gt;
macro_line|#include &lt;linux/rtnetlink.h&gt;
macro_line|#include &lt;linux/spinlock.h&gt;
macro_line|#include &lt;linux/times.h&gt;
macro_line|#include &quot;br_private.h&quot;
DECL|macro|to_class_dev
mdefine_line|#define to_class_dev(obj) container_of(obj,struct class_device,kobj)
DECL|macro|to_net_dev
mdefine_line|#define to_net_dev(class) container_of(class, struct net_device, class_dev)
DECL|macro|to_bridge
mdefine_line|#define to_bridge(cd)&t;((struct net_bridge *)(to_net_dev(cd)-&gt;priv))
multiline_comment|/*&n; * Common code for storing bridge parameters.&n; */
DECL|function|store_bridge_parm
r_static
id|ssize_t
id|store_bridge_parm
c_func
(paren
r_struct
id|class_device
op_star
id|cd
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|len
comma
r_void
(paren
op_star
id|set
)paren
(paren
r_struct
id|net_bridge
op_star
comma
r_int
r_int
)paren
)paren
(brace
r_struct
id|net_bridge
op_star
id|br
op_assign
id|to_bridge
c_func
(paren
id|cd
)paren
suffix:semicolon
r_char
op_star
id|endp
suffix:semicolon
r_int
r_int
id|val
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_NET_ADMIN
)paren
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
id|val
op_assign
id|simple_strtoul
c_func
(paren
id|buf
comma
op_amp
id|endp
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|endp
op_eq
id|buf
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|spin_lock_bh
c_func
(paren
op_amp
id|br-&gt;lock
)paren
suffix:semicolon
(paren
op_star
id|set
)paren
(paren
id|br
comma
id|val
)paren
suffix:semicolon
id|spin_unlock_bh
c_func
(paren
op_amp
id|br-&gt;lock
)paren
suffix:semicolon
r_return
id|len
suffix:semicolon
)brace
DECL|function|show_forward_delay
r_static
id|ssize_t
id|show_forward_delay
c_func
(paren
r_struct
id|class_device
op_star
id|cd
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|net_bridge
op_star
id|br
op_assign
id|to_bridge
c_func
(paren
id|cd
)paren
suffix:semicolon
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%lu&bslash;n&quot;
comma
id|jiffies_to_clock_t
c_func
(paren
id|br-&gt;forward_delay
)paren
)paren
suffix:semicolon
)brace
DECL|function|set_forward_delay
r_static
r_void
id|set_forward_delay
c_func
(paren
r_struct
id|net_bridge
op_star
id|br
comma
r_int
r_int
id|val
)paren
(brace
r_int
r_int
id|delay
op_assign
id|clock_t_to_jiffies
c_func
(paren
id|val
)paren
suffix:semicolon
id|br-&gt;forward_delay
op_assign
id|delay
suffix:semicolon
r_if
c_cond
(paren
id|br_is_root_bridge
c_func
(paren
id|br
)paren
)paren
id|br-&gt;bridge_forward_delay
op_assign
id|delay
suffix:semicolon
)brace
DECL|function|store_forward_delay
r_static
id|ssize_t
id|store_forward_delay
c_func
(paren
r_struct
id|class_device
op_star
id|cd
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|len
)paren
(brace
r_return
id|store_bridge_parm
c_func
(paren
id|cd
comma
id|buf
comma
id|len
comma
id|set_forward_delay
)paren
suffix:semicolon
)brace
r_static
id|CLASS_DEVICE_ATTR
c_func
(paren
id|forward_delay
comma
id|S_IRUGO
op_or
id|S_IWUSR
comma
id|show_forward_delay
comma
id|store_forward_delay
)paren
suffix:semicolon
DECL|function|show_hello_time
r_static
id|ssize_t
id|show_hello_time
c_func
(paren
r_struct
id|class_device
op_star
id|cd
comma
r_char
op_star
id|buf
)paren
(brace
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%lu&bslash;n&quot;
comma
id|jiffies_to_clock_t
c_func
(paren
id|to_bridge
c_func
(paren
id|cd
)paren
op_member_access_from_pointer
id|hello_time
)paren
)paren
suffix:semicolon
)brace
DECL|function|set_hello_time
r_static
r_void
id|set_hello_time
c_func
(paren
r_struct
id|net_bridge
op_star
id|br
comma
r_int
r_int
id|val
)paren
(brace
r_int
r_int
id|t
op_assign
id|clock_t_to_jiffies
c_func
(paren
id|val
)paren
suffix:semicolon
id|br-&gt;hello_time
op_assign
id|t
suffix:semicolon
r_if
c_cond
(paren
id|br_is_root_bridge
c_func
(paren
id|br
)paren
)paren
id|br-&gt;bridge_hello_time
op_assign
id|t
suffix:semicolon
)brace
DECL|function|store_hello_time
r_static
id|ssize_t
id|store_hello_time
c_func
(paren
r_struct
id|class_device
op_star
id|cd
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|len
)paren
(brace
r_return
id|store_bridge_parm
c_func
(paren
id|cd
comma
id|buf
comma
id|len
comma
id|set_hello_time
)paren
suffix:semicolon
)brace
r_static
id|CLASS_DEVICE_ATTR
c_func
(paren
id|hello_time
comma
id|S_IRUGO
op_or
id|S_IWUSR
comma
id|show_hello_time
comma
id|store_hello_time
)paren
suffix:semicolon
DECL|function|show_max_age
r_static
id|ssize_t
id|show_max_age
c_func
(paren
r_struct
id|class_device
op_star
id|cd
comma
r_char
op_star
id|buf
)paren
(brace
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%lu&bslash;n&quot;
comma
id|jiffies_to_clock_t
c_func
(paren
id|to_bridge
c_func
(paren
id|cd
)paren
op_member_access_from_pointer
id|max_age
)paren
)paren
suffix:semicolon
)brace
DECL|function|set_max_age
r_static
r_void
id|set_max_age
c_func
(paren
r_struct
id|net_bridge
op_star
id|br
comma
r_int
r_int
id|val
)paren
(brace
r_int
r_int
id|t
op_assign
id|clock_t_to_jiffies
c_func
(paren
id|val
)paren
suffix:semicolon
id|br-&gt;max_age
op_assign
id|t
suffix:semicolon
r_if
c_cond
(paren
id|br_is_root_bridge
c_func
(paren
id|br
)paren
)paren
id|br-&gt;bridge_max_age
op_assign
id|t
suffix:semicolon
)brace
DECL|function|store_max_age
r_static
id|ssize_t
id|store_max_age
c_func
(paren
r_struct
id|class_device
op_star
id|cd
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|len
)paren
(brace
r_return
id|store_bridge_parm
c_func
(paren
id|cd
comma
id|buf
comma
id|len
comma
id|set_max_age
)paren
suffix:semicolon
)brace
r_static
id|CLASS_DEVICE_ATTR
c_func
(paren
id|max_age
comma
id|S_IRUGO
op_or
id|S_IWUSR
comma
id|show_max_age
comma
id|store_max_age
)paren
suffix:semicolon
DECL|function|show_ageing_time
r_static
id|ssize_t
id|show_ageing_time
c_func
(paren
r_struct
id|class_device
op_star
id|cd
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|net_bridge
op_star
id|br
op_assign
id|to_bridge
c_func
(paren
id|cd
)paren
suffix:semicolon
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%lu&bslash;n&quot;
comma
id|jiffies_to_clock_t
c_func
(paren
id|br-&gt;ageing_time
)paren
)paren
suffix:semicolon
)brace
DECL|function|set_ageing_time
r_static
r_void
id|set_ageing_time
c_func
(paren
r_struct
id|net_bridge
op_star
id|br
comma
r_int
r_int
id|val
)paren
(brace
id|br-&gt;ageing_time
op_assign
id|clock_t_to_jiffies
c_func
(paren
id|val
)paren
suffix:semicolon
)brace
DECL|function|store_ageing_time
r_static
id|ssize_t
id|store_ageing_time
c_func
(paren
r_struct
id|class_device
op_star
id|cd
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|len
)paren
(brace
r_return
id|store_bridge_parm
c_func
(paren
id|cd
comma
id|buf
comma
id|len
comma
id|set_ageing_time
)paren
suffix:semicolon
)brace
r_static
id|CLASS_DEVICE_ATTR
c_func
(paren
id|ageing_time
comma
id|S_IRUGO
op_or
id|S_IWUSR
comma
id|show_ageing_time
comma
id|store_ageing_time
)paren
suffix:semicolon
DECL|function|show_stp_state
r_static
id|ssize_t
id|show_stp_state
c_func
(paren
r_struct
id|class_device
op_star
id|cd
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|net_bridge
op_star
id|br
op_assign
id|to_bridge
c_func
(paren
id|cd
)paren
suffix:semicolon
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%d&bslash;n&quot;
comma
id|br-&gt;stp_enabled
)paren
suffix:semicolon
)brace
DECL|function|set_stp_state
r_static
r_void
id|set_stp_state
c_func
(paren
r_struct
id|net_bridge
op_star
id|br
comma
r_int
r_int
id|val
)paren
(brace
id|br-&gt;stp_enabled
op_assign
id|val
suffix:semicolon
)brace
DECL|function|store_stp_state
r_static
id|ssize_t
id|store_stp_state
c_func
(paren
r_struct
id|class_device
op_star
id|cd
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|len
)paren
(brace
r_return
id|store_bridge_parm
c_func
(paren
id|cd
comma
id|buf
comma
id|len
comma
id|set_stp_state
)paren
suffix:semicolon
)brace
r_static
id|CLASS_DEVICE_ATTR
c_func
(paren
id|stp_state
comma
id|S_IRUGO
op_or
id|S_IWUSR
comma
id|show_stp_state
comma
id|store_stp_state
)paren
suffix:semicolon
DECL|function|show_priority
r_static
id|ssize_t
id|show_priority
c_func
(paren
r_struct
id|class_device
op_star
id|cd
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|net_bridge
op_star
id|br
op_assign
id|to_bridge
c_func
(paren
id|cd
)paren
suffix:semicolon
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%d&bslash;n&quot;
comma
(paren
id|br-&gt;bridge_id.prio
(braket
l_int|0
)braket
op_lshift
l_int|8
)paren
op_or
id|br-&gt;bridge_id.prio
(braket
l_int|1
)braket
)paren
suffix:semicolon
)brace
DECL|function|set_priority
r_static
r_void
id|set_priority
c_func
(paren
r_struct
id|net_bridge
op_star
id|br
comma
r_int
r_int
id|val
)paren
(brace
id|br_stp_set_bridge_priority
c_func
(paren
id|br
comma
(paren
id|u16
)paren
id|val
)paren
suffix:semicolon
)brace
DECL|function|store_priority
r_static
id|ssize_t
id|store_priority
c_func
(paren
r_struct
id|class_device
op_star
id|cd
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|len
)paren
(brace
r_return
id|store_bridge_parm
c_func
(paren
id|cd
comma
id|buf
comma
id|len
comma
id|set_priority
)paren
suffix:semicolon
)brace
r_static
id|CLASS_DEVICE_ATTR
c_func
(paren
id|priority
comma
id|S_IRUGO
op_or
id|S_IWUSR
comma
id|show_priority
comma
id|store_priority
)paren
suffix:semicolon
DECL|function|show_root_id
r_static
id|ssize_t
id|show_root_id
c_func
(paren
r_struct
id|class_device
op_star
id|cd
comma
r_char
op_star
id|buf
)paren
(brace
r_return
id|br_show_bridge_id
c_func
(paren
id|buf
comma
op_amp
id|to_bridge
c_func
(paren
id|cd
)paren
op_member_access_from_pointer
id|designated_root
)paren
suffix:semicolon
)brace
r_static
id|CLASS_DEVICE_ATTR
c_func
(paren
id|root_id
comma
id|S_IRUGO
comma
id|show_root_id
comma
l_int|NULL
)paren
suffix:semicolon
DECL|function|show_bridge_id
r_static
id|ssize_t
id|show_bridge_id
c_func
(paren
r_struct
id|class_device
op_star
id|cd
comma
r_char
op_star
id|buf
)paren
(brace
r_return
id|br_show_bridge_id
c_func
(paren
id|buf
comma
op_amp
id|to_bridge
c_func
(paren
id|cd
)paren
op_member_access_from_pointer
id|bridge_id
)paren
suffix:semicolon
)brace
r_static
id|CLASS_DEVICE_ATTR
c_func
(paren
id|bridge_id
comma
id|S_IRUGO
comma
id|show_bridge_id
comma
l_int|NULL
)paren
suffix:semicolon
DECL|function|show_root_port
r_static
id|ssize_t
id|show_root_port
c_func
(paren
r_struct
id|class_device
op_star
id|cd
comma
r_char
op_star
id|buf
)paren
(brace
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%d&bslash;n&quot;
comma
id|to_bridge
c_func
(paren
id|cd
)paren
op_member_access_from_pointer
id|root_port
)paren
suffix:semicolon
)brace
r_static
id|CLASS_DEVICE_ATTR
c_func
(paren
id|root_port
comma
id|S_IRUGO
comma
id|show_root_port
comma
l_int|NULL
)paren
suffix:semicolon
DECL|function|show_root_path_cost
r_static
id|ssize_t
id|show_root_path_cost
c_func
(paren
r_struct
id|class_device
op_star
id|cd
comma
r_char
op_star
id|buf
)paren
(brace
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%d&bslash;n&quot;
comma
id|to_bridge
c_func
(paren
id|cd
)paren
op_member_access_from_pointer
id|root_path_cost
)paren
suffix:semicolon
)brace
r_static
id|CLASS_DEVICE_ATTR
c_func
(paren
id|root_path_cost
comma
id|S_IRUGO
comma
id|show_root_path_cost
comma
l_int|NULL
)paren
suffix:semicolon
DECL|function|show_topology_change
r_static
id|ssize_t
id|show_topology_change
c_func
(paren
r_struct
id|class_device
op_star
id|cd
comma
r_char
op_star
id|buf
)paren
(brace
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%d&bslash;n&quot;
comma
id|to_bridge
c_func
(paren
id|cd
)paren
op_member_access_from_pointer
id|topology_change
)paren
suffix:semicolon
)brace
r_static
id|CLASS_DEVICE_ATTR
c_func
(paren
id|topology_change
comma
id|S_IRUGO
comma
id|show_topology_change
comma
l_int|NULL
)paren
suffix:semicolon
DECL|function|show_topology_change_detected
r_static
id|ssize_t
id|show_topology_change_detected
c_func
(paren
r_struct
id|class_device
op_star
id|cd
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|net_bridge
op_star
id|br
op_assign
id|to_bridge
c_func
(paren
id|cd
)paren
suffix:semicolon
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%d&bslash;n&quot;
comma
id|br-&gt;topology_change_detected
)paren
suffix:semicolon
)brace
r_static
id|CLASS_DEVICE_ATTR
c_func
(paren
id|topology_change_detected
comma
id|S_IRUGO
comma
id|show_topology_change_detected
comma
l_int|NULL
)paren
suffix:semicolon
DECL|function|show_hello_timer
r_static
id|ssize_t
id|show_hello_timer
c_func
(paren
r_struct
id|class_device
op_star
id|cd
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|net_bridge
op_star
id|br
op_assign
id|to_bridge
c_func
(paren
id|cd
)paren
suffix:semicolon
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%ld&bslash;n&quot;
comma
id|br_timer_value
c_func
(paren
op_amp
id|br-&gt;hello_timer
)paren
)paren
suffix:semicolon
)brace
r_static
id|CLASS_DEVICE_ATTR
c_func
(paren
id|hello_timer
comma
id|S_IRUGO
comma
id|show_hello_timer
comma
l_int|NULL
)paren
suffix:semicolon
DECL|function|show_tcn_timer
r_static
id|ssize_t
id|show_tcn_timer
c_func
(paren
r_struct
id|class_device
op_star
id|cd
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|net_bridge
op_star
id|br
op_assign
id|to_bridge
c_func
(paren
id|cd
)paren
suffix:semicolon
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%ld&bslash;n&quot;
comma
id|br_timer_value
c_func
(paren
op_amp
id|br-&gt;tcn_timer
)paren
)paren
suffix:semicolon
)brace
r_static
id|CLASS_DEVICE_ATTR
c_func
(paren
id|tcn_timer
comma
id|S_IRUGO
comma
id|show_tcn_timer
comma
l_int|NULL
)paren
suffix:semicolon
DECL|function|show_topology_change_timer
r_static
id|ssize_t
id|show_topology_change_timer
c_func
(paren
r_struct
id|class_device
op_star
id|cd
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|net_bridge
op_star
id|br
op_assign
id|to_bridge
c_func
(paren
id|cd
)paren
suffix:semicolon
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%ld&bslash;n&quot;
comma
id|br_timer_value
c_func
(paren
op_amp
id|br-&gt;topology_change_timer
)paren
)paren
suffix:semicolon
)brace
r_static
id|CLASS_DEVICE_ATTR
c_func
(paren
id|topology_change_timer
comma
id|S_IRUGO
comma
id|show_topology_change_timer
comma
l_int|NULL
)paren
suffix:semicolon
DECL|function|show_gc_timer
r_static
id|ssize_t
id|show_gc_timer
c_func
(paren
r_struct
id|class_device
op_star
id|cd
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|net_bridge
op_star
id|br
op_assign
id|to_bridge
c_func
(paren
id|cd
)paren
suffix:semicolon
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%ld&bslash;n&quot;
comma
id|br_timer_value
c_func
(paren
op_amp
id|br-&gt;gc_timer
)paren
)paren
suffix:semicolon
)brace
r_static
id|CLASS_DEVICE_ATTR
c_func
(paren
id|gc_timer
comma
id|S_IRUGO
comma
id|show_gc_timer
comma
l_int|NULL
)paren
suffix:semicolon
DECL|variable|bridge_attrs
r_static
r_struct
id|attribute
op_star
id|bridge_attrs
(braket
)braket
op_assign
(brace
op_amp
id|class_device_attr_forward_delay.attr
comma
op_amp
id|class_device_attr_hello_time.attr
comma
op_amp
id|class_device_attr_max_age.attr
comma
op_amp
id|class_device_attr_ageing_time.attr
comma
op_amp
id|class_device_attr_stp_state.attr
comma
op_amp
id|class_device_attr_priority.attr
comma
op_amp
id|class_device_attr_bridge_id.attr
comma
op_amp
id|class_device_attr_root_id.attr
comma
op_amp
id|class_device_attr_root_path_cost.attr
comma
op_amp
id|class_device_attr_root_port.attr
comma
op_amp
id|class_device_attr_topology_change.attr
comma
op_amp
id|class_device_attr_topology_change_detected.attr
comma
op_amp
id|class_device_attr_hello_timer.attr
comma
op_amp
id|class_device_attr_tcn_timer.attr
comma
op_amp
id|class_device_attr_topology_change_timer.attr
comma
op_amp
id|class_device_attr_gc_timer.attr
comma
l_int|NULL
)brace
suffix:semicolon
DECL|variable|bridge_group
r_static
r_struct
id|attribute_group
id|bridge_group
op_assign
(brace
dot
id|name
op_assign
id|SYSFS_BRIDGE_ATTR
comma
dot
id|attrs
op_assign
id|bridge_attrs
comma
)brace
suffix:semicolon
multiline_comment|/*&n; * Export the forwarding information table as a binary file&n; * The records are struct __fdb_entry.&n; *&n; * Returns the number of bytes read.&n; */
DECL|function|brforward_read
r_static
id|ssize_t
id|brforward_read
c_func
(paren
r_struct
id|kobject
op_star
id|kobj
comma
r_char
op_star
id|buf
comma
id|loff_t
id|off
comma
r_int
id|count
)paren
(brace
r_struct
id|class_device
op_star
id|cdev
op_assign
id|to_class_dev
c_func
(paren
id|kobj
)paren
suffix:semicolon
r_struct
id|net_bridge
op_star
id|br
op_assign
id|to_bridge
c_func
(paren
id|cdev
)paren
suffix:semicolon
r_int
id|n
suffix:semicolon
multiline_comment|/* must read whole records */
r_if
c_cond
(paren
id|off
op_mod
r_sizeof
(paren
r_struct
id|__fdb_entry
)paren
op_ne
l_int|0
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|n
op_assign
id|br_fdb_fillbuf
c_func
(paren
id|br
comma
id|buf
comma
id|count
op_div
r_sizeof
(paren
r_struct
id|__fdb_entry
)paren
comma
id|off
op_div
r_sizeof
(paren
r_struct
id|__fdb_entry
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|n
OG
l_int|0
)paren
id|n
op_mul_assign
r_sizeof
(paren
r_struct
id|__fdb_entry
)paren
suffix:semicolon
r_return
id|n
suffix:semicolon
)brace
DECL|variable|bridge_forward
r_static
r_struct
id|bin_attribute
id|bridge_forward
op_assign
(brace
dot
id|attr
op_assign
(brace
dot
id|name
op_assign
id|SYSFS_BRIDGE_FDB
comma
dot
id|mode
op_assign
id|S_IRUGO
comma
dot
id|owner
op_assign
id|THIS_MODULE
comma
)brace
comma
dot
id|read
op_assign
id|brforward_read
comma
)brace
suffix:semicolon
multiline_comment|/*&n; * Add entries in sysfs onto the existing network class device&n; * for the bridge.&n; *   Adds a attribute group &quot;bridge&quot; containing tuning parameters.&n; *   Binary attribute containing the forward table&n; *   Sub directory to hold links to interfaces.&n; *&n; * Note: the ifobj exists only to be a subdirectory&n; *   to hold links.  The ifobj exists in same data structure&n; *   as it&squot;s parent the bridge so reference counting works.&n; */
DECL|function|br_sysfs_addbr
r_int
id|br_sysfs_addbr
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|kobject
op_star
id|brobj
op_assign
op_amp
id|dev-&gt;class_dev.kobj
suffix:semicolon
r_struct
id|net_bridge
op_star
id|br
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_int
id|err
suffix:semicolon
id|err
op_assign
id|sysfs_create_group
c_func
(paren
id|brobj
comma
op_amp
id|bridge_group
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|pr_info
c_func
(paren
l_string|&quot;%s: can&squot;t create group %s/%s&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|dev-&gt;name
comma
id|bridge_group.name
)paren
suffix:semicolon
r_goto
id|out1
suffix:semicolon
)brace
id|err
op_assign
id|sysfs_create_bin_file
c_func
(paren
id|brobj
comma
op_amp
id|bridge_forward
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|pr_info
c_func
(paren
l_string|&quot;%s: can&squot;t create attribue file %s/%s&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|dev-&gt;name
comma
id|bridge_forward.attr.name
)paren
suffix:semicolon
r_goto
id|out2
suffix:semicolon
)brace
id|kobject_set_name
c_func
(paren
op_amp
id|br-&gt;ifobj
comma
id|SYSFS_BRIDGE_PORT_SUBDIR
)paren
suffix:semicolon
id|br-&gt;ifobj.ktype
op_assign
l_int|NULL
suffix:semicolon
id|br-&gt;ifobj.kset
op_assign
l_int|NULL
suffix:semicolon
id|br-&gt;ifobj.parent
op_assign
id|brobj
suffix:semicolon
id|err
op_assign
id|kobject_register
c_func
(paren
op_amp
id|br-&gt;ifobj
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|pr_info
c_func
(paren
l_string|&quot;%s: can&squot;t add kobject (directory) %s/%s&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|dev-&gt;name
comma
id|br-&gt;ifobj.name
)paren
suffix:semicolon
r_goto
id|out3
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
id|out3
suffix:colon
id|sysfs_remove_bin_file
c_func
(paren
op_amp
id|dev-&gt;class_dev.kobj
comma
op_amp
id|bridge_forward
)paren
suffix:semicolon
id|out2
suffix:colon
id|sysfs_remove_group
c_func
(paren
op_amp
id|dev-&gt;class_dev.kobj
comma
op_amp
id|bridge_group
)paren
suffix:semicolon
id|out1
suffix:colon
r_return
id|err
suffix:semicolon
)brace
DECL|function|br_sysfs_delbr
r_void
id|br_sysfs_delbr
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|kobject
op_star
id|kobj
op_assign
op_amp
id|dev-&gt;class_dev.kobj
suffix:semicolon
r_struct
id|net_bridge
op_star
id|br
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
id|kobject_unregister
c_func
(paren
op_amp
id|br-&gt;ifobj
)paren
suffix:semicolon
id|sysfs_remove_bin_file
c_func
(paren
id|kobj
comma
op_amp
id|bridge_forward
)paren
suffix:semicolon
id|sysfs_remove_group
c_func
(paren
id|kobj
comma
op_amp
id|bridge_group
)paren
suffix:semicolon
)brace
eof
