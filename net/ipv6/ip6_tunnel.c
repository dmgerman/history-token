multiline_comment|/*&n; *&t;IPv6 over IPv6 tunnel device&n; *&t;Linux INET6 implementation&n; *&n; *&t;Authors:&n; *&t;Ville Nuorvala&t;&t;&lt;vnuorval@tcs.hut.fi&gt;&t;&n; *&n; *&t;$Id$&n; *&n; *      Based on:&n; *      linux/net/ipv6/sit.c&n; *&n; *      RFC 2473&n; *&n; *&t;This program is free software; you can redistribute it and/or&n; *      modify it under the terms of the GNU General Public License&n; *      as published by the Free Software Foundation; either version&n; *      2 of the License, or (at your option) any later version.&n; *&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/sockios.h&gt;
macro_line|#include &lt;linux/if.h&gt;
macro_line|#include &lt;linux/in.h&gt;
macro_line|#include &lt;linux/ip.h&gt;
macro_line|#include &lt;linux/if_tunnel.h&gt;
macro_line|#include &lt;linux/net.h&gt;
macro_line|#include &lt;linux/in6.h&gt;
macro_line|#include &lt;linux/netdevice.h&gt;
macro_line|#include &lt;linux/if_arp.h&gt;
macro_line|#include &lt;linux/icmpv6.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/route.h&gt;
macro_line|#include &lt;linux/rtnetlink.h&gt;
macro_line|#include &lt;linux/netfilter_ipv6.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;asm/atomic.h&gt;
macro_line|#include &lt;net/ip.h&gt;
macro_line|#include &lt;net/ipv6.h&gt;
macro_line|#include &lt;net/protocol.h&gt;
macro_line|#include &lt;net/ip6_route.h&gt;
macro_line|#include &lt;net/addrconf.h&gt;
macro_line|#include &lt;net/ip6_tunnel.h&gt;
macro_line|#include &lt;net/xfrm.h&gt;
macro_line|#include &lt;net/dsfield.h&gt;
macro_line|#include &lt;net/inet_ecn.h&gt;
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Ville Nuorvala&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;IPv6-in-IPv6 tunnel&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
DECL|macro|IPV6_TLV_TEL_DST_SIZE
mdefine_line|#define IPV6_TLV_TEL_DST_SIZE 8
macro_line|#ifdef IP6_TNL_DEBUG
DECL|macro|IP6_TNL_TRACE
mdefine_line|#define IP6_TNL_TRACE(x...) printk(KERN_DEBUG &quot;%s:&quot; x &quot;&bslash;n&quot;, __FUNCTION__)
macro_line|#else
DECL|macro|IP6_TNL_TRACE
mdefine_line|#define IP6_TNL_TRACE(x...) do {;} while(0)
macro_line|#endif
DECL|macro|IPV6_TCLASS_MASK
mdefine_line|#define IPV6_TCLASS_MASK (IPV6_FLOWINFO_MASK &amp; ~IPV6_FLOWLABEL_MASK)
DECL|macro|HASH_SIZE
mdefine_line|#define HASH_SIZE  32
DECL|macro|HASH
mdefine_line|#define HASH(addr) (((addr)-&gt;s6_addr32[0] ^ (addr)-&gt;s6_addr32[1] ^ &bslash;&n;&t;             (addr)-&gt;s6_addr32[2] ^ (addr)-&gt;s6_addr32[3]) &amp; &bslash;&n;                    (HASH_SIZE - 1))
r_static
r_int
id|ip6ip6_fb_tnl_dev_init
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|ip6ip6_tnl_dev_init
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_void
id|ip6ip6_tnl_dev_setup
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
multiline_comment|/* the IPv6 tunnel fallback device */
DECL|variable|ip6ip6_fb_tnl_dev
r_static
r_struct
id|net_device
op_star
id|ip6ip6_fb_tnl_dev
suffix:semicolon
multiline_comment|/* lists for storing tunnels in use */
DECL|variable|tnls_r_l
r_static
r_struct
id|ip6_tnl
op_star
id|tnls_r_l
(braket
id|HASH_SIZE
)braket
suffix:semicolon
DECL|variable|tnls_wc
r_static
r_struct
id|ip6_tnl
op_star
id|tnls_wc
(braket
l_int|1
)braket
suffix:semicolon
DECL|variable|tnls
r_static
r_struct
id|ip6_tnl
op_star
op_star
id|tnls
(braket
l_int|2
)braket
op_assign
(brace
id|tnls_wc
comma
id|tnls_r_l
)brace
suffix:semicolon
multiline_comment|/* lock for the tunnel lists */
r_static
id|DEFINE_RWLOCK
c_func
(paren
id|ip6ip6_lock
)paren
suffix:semicolon
DECL|function|ip6_tnl_dst_check
r_static
r_inline
r_struct
id|dst_entry
op_star
id|ip6_tnl_dst_check
c_func
(paren
r_struct
id|ip6_tnl
op_star
id|t
)paren
(brace
r_struct
id|dst_entry
op_star
id|dst
op_assign
id|t-&gt;dst_cache
suffix:semicolon
r_if
c_cond
(paren
id|dst
op_logical_and
id|dst-&gt;obsolete
op_logical_and
id|dst-&gt;ops
op_member_access_from_pointer
id|check
c_func
(paren
id|dst
comma
id|t-&gt;dst_cookie
)paren
op_eq
l_int|NULL
)paren
(brace
id|t-&gt;dst_cache
op_assign
l_int|NULL
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
r_return
id|dst
suffix:semicolon
)brace
DECL|function|ip6_tnl_dst_reset
r_static
r_inline
r_void
id|ip6_tnl_dst_reset
c_func
(paren
r_struct
id|ip6_tnl
op_star
id|t
)paren
(brace
id|dst_release
c_func
(paren
id|t-&gt;dst_cache
)paren
suffix:semicolon
id|t-&gt;dst_cache
op_assign
l_int|NULL
suffix:semicolon
)brace
DECL|function|ip6_tnl_dst_store
r_static
r_inline
r_void
id|ip6_tnl_dst_store
c_func
(paren
r_struct
id|ip6_tnl
op_star
id|t
comma
r_struct
id|dst_entry
op_star
id|dst
)paren
(brace
r_struct
id|rt6_info
op_star
id|rt
op_assign
(paren
r_struct
id|rt6_info
op_star
)paren
id|dst
suffix:semicolon
id|t-&gt;dst_cookie
op_assign
id|rt-&gt;rt6i_node
ques
c_cond
id|rt-&gt;rt6i_node-&gt;fn_sernum
suffix:colon
l_int|0
suffix:semicolon
id|dst_release
c_func
(paren
id|t-&gt;dst_cache
)paren
suffix:semicolon
id|t-&gt;dst_cache
op_assign
id|dst
suffix:semicolon
)brace
multiline_comment|/**&n; * ip6ip6_tnl_lookup - fetch tunnel matching the end-point addresses&n; *   @remote: the address of the tunnel exit-point &n; *   @local: the address of the tunnel entry-point &n; *&n; * Return:  &n; *   tunnel matching given end-points if found,&n; *   else fallback tunnel if its device is up, &n; *   else %NULL&n; **/
r_static
r_struct
id|ip6_tnl
op_star
DECL|function|ip6ip6_tnl_lookup
id|ip6ip6_tnl_lookup
c_func
(paren
r_struct
id|in6_addr
op_star
id|remote
comma
r_struct
id|in6_addr
op_star
id|local
)paren
(brace
r_int
id|h0
op_assign
id|HASH
c_func
(paren
id|remote
)paren
suffix:semicolon
r_int
id|h1
op_assign
id|HASH
c_func
(paren
id|local
)paren
suffix:semicolon
r_struct
id|ip6_tnl
op_star
id|t
suffix:semicolon
r_for
c_loop
(paren
id|t
op_assign
id|tnls_r_l
(braket
id|h0
op_xor
id|h1
)braket
suffix:semicolon
id|t
suffix:semicolon
id|t
op_assign
id|t-&gt;next
)paren
(brace
r_if
c_cond
(paren
id|ipv6_addr_equal
c_func
(paren
id|local
comma
op_amp
id|t-&gt;parms.laddr
)paren
op_logical_and
id|ipv6_addr_equal
c_func
(paren
id|remote
comma
op_amp
id|t-&gt;parms.raddr
)paren
op_logical_and
(paren
id|t-&gt;dev-&gt;flags
op_amp
id|IFF_UP
)paren
)paren
r_return
id|t
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|t
op_assign
id|tnls_wc
(braket
l_int|0
)braket
)paren
op_ne
l_int|NULL
op_logical_and
(paren
id|t-&gt;dev-&gt;flags
op_amp
id|IFF_UP
)paren
)paren
r_return
id|t
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
multiline_comment|/**&n; * ip6ip6_bucket - get head of list matching given tunnel parameters&n; *   @p: parameters containing tunnel end-points &n; *&n; * Description:&n; *   ip6ip6_bucket() returns the head of the list matching the &n; *   &amp;struct in6_addr entries laddr and raddr in @p.&n; *&n; * Return: head of IPv6 tunnel list &n; **/
r_static
r_struct
id|ip6_tnl
op_star
op_star
DECL|function|ip6ip6_bucket
id|ip6ip6_bucket
c_func
(paren
r_struct
id|ip6_tnl_parm
op_star
id|p
)paren
(brace
r_struct
id|in6_addr
op_star
id|remote
op_assign
op_amp
id|p-&gt;raddr
suffix:semicolon
r_struct
id|in6_addr
op_star
id|local
op_assign
op_amp
id|p-&gt;laddr
suffix:semicolon
r_int
id|h
op_assign
l_int|0
suffix:semicolon
r_int
id|prio
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ipv6_addr_any
c_func
(paren
id|remote
)paren
op_logical_or
op_logical_neg
id|ipv6_addr_any
c_func
(paren
id|local
)paren
)paren
(brace
id|prio
op_assign
l_int|1
suffix:semicolon
id|h
op_assign
id|HASH
c_func
(paren
id|remote
)paren
op_xor
id|HASH
c_func
(paren
id|local
)paren
suffix:semicolon
)brace
r_return
op_amp
id|tnls
(braket
id|prio
)braket
(braket
id|h
)braket
suffix:semicolon
)brace
multiline_comment|/**&n; * ip6ip6_tnl_link - add tunnel to hash table&n; *   @t: tunnel to be added&n; **/
r_static
r_void
DECL|function|ip6ip6_tnl_link
id|ip6ip6_tnl_link
c_func
(paren
r_struct
id|ip6_tnl
op_star
id|t
)paren
(brace
r_struct
id|ip6_tnl
op_star
op_star
id|tp
op_assign
id|ip6ip6_bucket
c_func
(paren
op_amp
id|t-&gt;parms
)paren
suffix:semicolon
id|write_lock_bh
c_func
(paren
op_amp
id|ip6ip6_lock
)paren
suffix:semicolon
id|t-&gt;next
op_assign
op_star
id|tp
suffix:semicolon
id|write_unlock_bh
c_func
(paren
op_amp
id|ip6ip6_lock
)paren
suffix:semicolon
op_star
id|tp
op_assign
id|t
suffix:semicolon
)brace
multiline_comment|/**&n; * ip6ip6_tnl_unlink - remove tunnel from hash table&n; *   @t: tunnel to be removed&n; **/
r_static
r_void
DECL|function|ip6ip6_tnl_unlink
id|ip6ip6_tnl_unlink
c_func
(paren
r_struct
id|ip6_tnl
op_star
id|t
)paren
(brace
r_struct
id|ip6_tnl
op_star
op_star
id|tp
suffix:semicolon
r_for
c_loop
(paren
id|tp
op_assign
id|ip6ip6_bucket
c_func
(paren
op_amp
id|t-&gt;parms
)paren
suffix:semicolon
op_star
id|tp
suffix:semicolon
id|tp
op_assign
op_amp
(paren
op_star
id|tp
)paren
op_member_access_from_pointer
id|next
)paren
(brace
r_if
c_cond
(paren
id|t
op_eq
op_star
id|tp
)paren
(brace
id|write_lock_bh
c_func
(paren
op_amp
id|ip6ip6_lock
)paren
suffix:semicolon
op_star
id|tp
op_assign
id|t-&gt;next
suffix:semicolon
id|write_unlock_bh
c_func
(paren
op_amp
id|ip6ip6_lock
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
)brace
multiline_comment|/**&n; * ip6_tnl_create() - create a new tunnel&n; *   @p: tunnel parameters&n; *   @pt: pointer to new tunnel&n; *&n; * Description:&n; *   Create tunnel matching given parameters.&n; * &n; * Return: &n; *   0 on success&n; **/
r_static
r_int
DECL|function|ip6_tnl_create
id|ip6_tnl_create
c_func
(paren
r_struct
id|ip6_tnl_parm
op_star
id|p
comma
r_struct
id|ip6_tnl
op_star
op_star
id|pt
)paren
(brace
r_struct
id|net_device
op_star
id|dev
suffix:semicolon
r_struct
id|ip6_tnl
op_star
id|t
suffix:semicolon
r_char
id|name
(braket
id|IFNAMSIZ
)braket
suffix:semicolon
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;name
(braket
l_int|0
)braket
)paren
(brace
id|strlcpy
c_func
(paren
id|name
comma
id|p-&gt;name
comma
id|IFNAMSIZ
)paren
suffix:semicolon
)brace
r_else
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|1
suffix:semicolon
id|i
OL
id|IP6_TNL_MAX
suffix:semicolon
id|i
op_increment
)paren
(brace
id|sprintf
c_func
(paren
id|name
comma
l_string|&quot;ip6tnl%d&quot;
comma
id|i
)paren
suffix:semicolon
r_if
c_cond
(paren
id|__dev_get_by_name
c_func
(paren
id|name
)paren
op_eq
l_int|NULL
)paren
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|i
op_eq
id|IP6_TNL_MAX
)paren
r_return
op_minus
id|ENOBUFS
suffix:semicolon
)brace
id|dev
op_assign
id|alloc_netdev
c_func
(paren
r_sizeof
(paren
op_star
id|t
)paren
comma
id|name
comma
id|ip6ip6_tnl_dev_setup
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|t
op_assign
id|dev-&gt;priv
suffix:semicolon
id|dev-&gt;init
op_assign
id|ip6ip6_tnl_dev_init
suffix:semicolon
id|t-&gt;parms
op_assign
op_star
id|p
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|register_netdevice
c_func
(paren
id|dev
)paren
)paren
OL
l_int|0
)paren
(brace
id|free_netdev
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
id|dev_hold
c_func
(paren
id|dev
)paren
suffix:semicolon
id|ip6ip6_tnl_link
c_func
(paren
id|t
)paren
suffix:semicolon
op_star
id|pt
op_assign
id|t
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/**&n; * ip6ip6_tnl_locate - find or create tunnel matching given parameters&n; *   @p: tunnel parameters &n; *   @create: != 0 if allowed to create new tunnel if no match found&n; *&n; * Description:&n; *   ip6ip6_tnl_locate() first tries to locate an existing tunnel&n; *   based on @parms. If this is unsuccessful, but @create is set a new&n; *   tunnel device is created and registered for use.&n; *&n; * Return:&n; *   0 if tunnel located or created,&n; *   -EINVAL if parameters incorrect,&n; *   -ENODEV if no matching tunnel available&n; **/
r_static
r_int
DECL|function|ip6ip6_tnl_locate
id|ip6ip6_tnl_locate
c_func
(paren
r_struct
id|ip6_tnl_parm
op_star
id|p
comma
r_struct
id|ip6_tnl
op_star
op_star
id|pt
comma
r_int
id|create
)paren
(brace
r_struct
id|in6_addr
op_star
id|remote
op_assign
op_amp
id|p-&gt;raddr
suffix:semicolon
r_struct
id|in6_addr
op_star
id|local
op_assign
op_amp
id|p-&gt;laddr
suffix:semicolon
r_struct
id|ip6_tnl
op_star
id|t
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;proto
op_ne
id|IPPROTO_IPV6
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_for
c_loop
(paren
id|t
op_assign
op_star
id|ip6ip6_bucket
c_func
(paren
id|p
)paren
suffix:semicolon
id|t
suffix:semicolon
id|t
op_assign
id|t-&gt;next
)paren
(brace
r_if
c_cond
(paren
id|ipv6_addr_equal
c_func
(paren
id|local
comma
op_amp
id|t-&gt;parms.laddr
)paren
op_logical_and
id|ipv6_addr_equal
c_func
(paren
id|remote
comma
op_amp
id|t-&gt;parms.raddr
)paren
)paren
(brace
op_star
id|pt
op_assign
id|t
suffix:semicolon
r_return
(paren
id|create
ques
c_cond
op_minus
id|EEXIST
suffix:colon
l_int|0
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
op_logical_neg
id|create
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_return
id|ip6_tnl_create
c_func
(paren
id|p
comma
id|pt
)paren
suffix:semicolon
)brace
multiline_comment|/**&n; * ip6ip6_tnl_dev_uninit - tunnel device uninitializer&n; *   @dev: the device to be destroyed&n; *   &n; * Description:&n; *   ip6ip6_tnl_dev_uninit() removes tunnel from its list&n; **/
r_static
r_void
DECL|function|ip6ip6_tnl_dev_uninit
id|ip6ip6_tnl_dev_uninit
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|ip6_tnl
op_star
id|t
op_assign
id|dev-&gt;priv
suffix:semicolon
r_if
c_cond
(paren
id|dev
op_eq
id|ip6ip6_fb_tnl_dev
)paren
(brace
id|write_lock_bh
c_func
(paren
op_amp
id|ip6ip6_lock
)paren
suffix:semicolon
id|tnls_wc
(braket
l_int|0
)braket
op_assign
l_int|NULL
suffix:semicolon
id|write_unlock_bh
c_func
(paren
op_amp
id|ip6ip6_lock
)paren
suffix:semicolon
)brace
r_else
(brace
id|ip6ip6_tnl_unlink
c_func
(paren
id|t
)paren
suffix:semicolon
)brace
id|ip6_tnl_dst_reset
c_func
(paren
id|t
)paren
suffix:semicolon
id|dev_put
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
multiline_comment|/**&n; * parse_tvl_tnl_enc_lim - handle encapsulation limit option&n; *   @skb: received socket buffer&n; *&n; * Return: &n; *   0 if none was found, &n; *   else index to encapsulation limit&n; **/
r_static
id|__u16
DECL|function|parse_tlv_tnl_enc_lim
id|parse_tlv_tnl_enc_lim
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
id|__u8
op_star
id|raw
)paren
(brace
r_struct
id|ipv6hdr
op_star
id|ipv6h
op_assign
(paren
r_struct
id|ipv6hdr
op_star
)paren
id|raw
suffix:semicolon
id|__u8
id|nexthdr
op_assign
id|ipv6h-&gt;nexthdr
suffix:semicolon
id|__u16
id|off
op_assign
r_sizeof
(paren
op_star
id|ipv6h
)paren
suffix:semicolon
r_while
c_loop
(paren
id|ipv6_ext_hdr
c_func
(paren
id|nexthdr
)paren
op_logical_and
id|nexthdr
op_ne
id|NEXTHDR_NONE
)paren
(brace
id|__u16
id|optlen
op_assign
l_int|0
suffix:semicolon
r_struct
id|ipv6_opt_hdr
op_star
id|hdr
suffix:semicolon
r_if
c_cond
(paren
id|raw
op_plus
id|off
op_plus
r_sizeof
(paren
op_star
id|hdr
)paren
OG
id|skb-&gt;data
op_logical_and
op_logical_neg
id|pskb_may_pull
c_func
(paren
id|skb
comma
id|raw
op_minus
id|skb-&gt;data
op_plus
id|off
op_plus
r_sizeof
(paren
op_star
id|hdr
)paren
)paren
)paren
r_break
suffix:semicolon
id|hdr
op_assign
(paren
r_struct
id|ipv6_opt_hdr
op_star
)paren
(paren
id|raw
op_plus
id|off
)paren
suffix:semicolon
r_if
c_cond
(paren
id|nexthdr
op_eq
id|NEXTHDR_FRAGMENT
)paren
(brace
r_struct
id|frag_hdr
op_star
id|frag_hdr
op_assign
(paren
r_struct
id|frag_hdr
op_star
)paren
id|hdr
suffix:semicolon
r_if
c_cond
(paren
id|frag_hdr-&gt;frag_off
)paren
r_break
suffix:semicolon
id|optlen
op_assign
l_int|8
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|nexthdr
op_eq
id|NEXTHDR_AUTH
)paren
(brace
id|optlen
op_assign
(paren
id|hdr-&gt;hdrlen
op_plus
l_int|2
)paren
op_lshift
l_int|2
suffix:semicolon
)brace
r_else
(brace
id|optlen
op_assign
id|ipv6_optlen
c_func
(paren
id|hdr
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|nexthdr
op_eq
id|NEXTHDR_DEST
)paren
(brace
id|__u16
id|i
op_assign
id|off
op_plus
l_int|2
suffix:semicolon
r_while
c_loop
(paren
l_int|1
)paren
(brace
r_struct
id|ipv6_tlv_tnl_enc_lim
op_star
id|tel
suffix:semicolon
multiline_comment|/* No more room for encapsulation limit */
r_if
c_cond
(paren
id|i
op_plus
r_sizeof
(paren
op_star
id|tel
)paren
OG
id|off
op_plus
id|optlen
)paren
r_break
suffix:semicolon
id|tel
op_assign
(paren
r_struct
id|ipv6_tlv_tnl_enc_lim
op_star
)paren
op_amp
id|raw
(braket
id|i
)braket
suffix:semicolon
multiline_comment|/* return index of option if found and valid */
r_if
c_cond
(paren
id|tel-&gt;type
op_eq
id|IPV6_TLV_TNL_ENCAP_LIMIT
op_logical_and
id|tel-&gt;length
op_eq
l_int|1
)paren
r_return
id|i
suffix:semicolon
multiline_comment|/* else jump to next option */
r_if
c_cond
(paren
id|tel-&gt;type
)paren
id|i
op_add_assign
id|tel-&gt;length
op_plus
l_int|2
suffix:semicolon
r_else
id|i
op_increment
suffix:semicolon
)brace
)brace
id|nexthdr
op_assign
id|hdr-&gt;nexthdr
suffix:semicolon
id|off
op_add_assign
id|optlen
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/**&n; * ip6ip6_err - tunnel error handler&n; *&n; * Description:&n; *   ip6ip6_err() should handle errors in the tunnel according&n; *   to the specifications in RFC 2473.&n; **/
r_static
r_void
DECL|function|ip6ip6_err
id|ip6ip6_err
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|inet6_skb_parm
op_star
id|opt
comma
r_int
id|type
comma
r_int
id|code
comma
r_int
id|offset
comma
id|__u32
id|info
)paren
(brace
r_struct
id|ipv6hdr
op_star
id|ipv6h
op_assign
(paren
r_struct
id|ipv6hdr
op_star
)paren
id|skb-&gt;data
suffix:semicolon
r_struct
id|ip6_tnl
op_star
id|t
suffix:semicolon
r_int
id|rel_msg
op_assign
l_int|0
suffix:semicolon
r_int
id|rel_type
op_assign
id|ICMPV6_DEST_UNREACH
suffix:semicolon
r_int
id|rel_code
op_assign
id|ICMPV6_ADDR_UNREACH
suffix:semicolon
id|__u32
id|rel_info
op_assign
l_int|0
suffix:semicolon
id|__u16
id|len
suffix:semicolon
multiline_comment|/* If the packet doesn&squot;t contain the original IPv6 header we are &n;&t;   in trouble since we might need the source address for further &n;&t;   processing of the error. */
id|read_lock
c_func
(paren
op_amp
id|ip6ip6_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|t
op_assign
id|ip6ip6_tnl_lookup
c_func
(paren
op_amp
id|ipv6h-&gt;daddr
comma
op_amp
id|ipv6h-&gt;saddr
)paren
)paren
op_eq
l_int|NULL
)paren
r_goto
id|out
suffix:semicolon
r_switch
c_cond
(paren
id|type
)paren
(brace
id|__u32
id|teli
suffix:semicolon
r_struct
id|ipv6_tlv_tnl_enc_lim
op_star
id|tel
suffix:semicolon
id|__u32
id|mtu
suffix:semicolon
r_case
id|ICMPV6_DEST_UNREACH
suffix:colon
r_if
c_cond
(paren
id|net_ratelimit
c_func
(paren
)paren
)paren
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Path to destination invalid &quot;
l_string|&quot;or inactive!&bslash;n&quot;
comma
id|t-&gt;parms.name
)paren
suffix:semicolon
id|rel_msg
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ICMPV6_TIME_EXCEED
suffix:colon
r_if
c_cond
(paren
id|code
op_eq
id|ICMPV6_EXC_HOPLIMIT
)paren
(brace
r_if
c_cond
(paren
id|net_ratelimit
c_func
(paren
)paren
)paren
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Too small hop limit or &quot;
l_string|&quot;routing loop in tunnel!&bslash;n&quot;
comma
id|t-&gt;parms.name
)paren
suffix:semicolon
id|rel_msg
op_assign
l_int|1
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|ICMPV6_PARAMPROB
suffix:colon
multiline_comment|/* ignore if parameter problem not caused by a tunnel&n;&t;&t;   encapsulation limit sub-option */
r_if
c_cond
(paren
id|code
op_ne
id|ICMPV6_HDR_FIELD
)paren
(brace
r_break
suffix:semicolon
)brace
id|teli
op_assign
id|parse_tlv_tnl_enc_lim
c_func
(paren
id|skb
comma
id|skb-&gt;data
)paren
suffix:semicolon
r_if
c_cond
(paren
id|teli
op_logical_and
id|teli
op_eq
id|ntohl
c_func
(paren
id|info
)paren
op_minus
l_int|2
)paren
(brace
id|tel
op_assign
(paren
r_struct
id|ipv6_tlv_tnl_enc_lim
op_star
)paren
op_amp
id|skb-&gt;data
(braket
id|teli
)braket
suffix:semicolon
r_if
c_cond
(paren
id|tel-&gt;encap_limit
op_eq
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|net_ratelimit
c_func
(paren
)paren
)paren
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Too small encapsulation &quot;
l_string|&quot;limit or routing loop in &quot;
l_string|&quot;tunnel!&bslash;n&quot;
comma
id|t-&gt;parms.name
)paren
suffix:semicolon
id|rel_msg
op_assign
l_int|1
suffix:semicolon
)brace
)brace
r_break
suffix:semicolon
r_case
id|ICMPV6_PKT_TOOBIG
suffix:colon
id|mtu
op_assign
id|ntohl
c_func
(paren
id|info
)paren
op_minus
id|offset
suffix:semicolon
r_if
c_cond
(paren
id|mtu
OL
id|IPV6_MIN_MTU
)paren
id|mtu
op_assign
id|IPV6_MIN_MTU
suffix:semicolon
id|t-&gt;dev-&gt;mtu
op_assign
id|mtu
suffix:semicolon
r_if
c_cond
(paren
(paren
id|len
op_assign
r_sizeof
(paren
op_star
id|ipv6h
)paren
op_plus
id|ipv6h-&gt;payload_len
)paren
OG
id|mtu
)paren
(brace
id|rel_type
op_assign
id|ICMPV6_PKT_TOOBIG
suffix:semicolon
id|rel_code
op_assign
l_int|0
suffix:semicolon
id|rel_info
op_assign
id|mtu
suffix:semicolon
id|rel_msg
op_assign
l_int|1
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|rel_msg
op_logical_and
id|pskb_may_pull
c_func
(paren
id|skb
comma
id|offset
op_plus
r_sizeof
(paren
op_star
id|ipv6h
)paren
)paren
)paren
(brace
r_struct
id|rt6_info
op_star
id|rt
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb2
op_assign
id|skb_clone
c_func
(paren
id|skb
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb2
)paren
r_goto
id|out
suffix:semicolon
id|dst_release
c_func
(paren
id|skb2-&gt;dst
)paren
suffix:semicolon
id|skb2-&gt;dst
op_assign
l_int|NULL
suffix:semicolon
id|skb_pull
c_func
(paren
id|skb2
comma
id|offset
)paren
suffix:semicolon
id|skb2-&gt;nh.raw
op_assign
id|skb2-&gt;data
suffix:semicolon
multiline_comment|/* Try to guess incoming interface */
id|rt
op_assign
id|rt6_lookup
c_func
(paren
op_amp
id|skb2-&gt;nh.ipv6h-&gt;saddr
comma
l_int|NULL
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rt
op_logical_and
id|rt-&gt;rt6i_dev
)paren
id|skb2-&gt;dev
op_assign
id|rt-&gt;rt6i_dev
suffix:semicolon
id|icmpv6_send
c_func
(paren
id|skb2
comma
id|rel_type
comma
id|rel_code
comma
id|rel_info
comma
id|skb2-&gt;dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rt
)paren
id|dst_release
c_func
(paren
op_amp
id|rt-&gt;u.dst
)paren
suffix:semicolon
id|kfree_skb
c_func
(paren
id|skb2
)paren
suffix:semicolon
)brace
id|out
suffix:colon
id|read_unlock
c_func
(paren
op_amp
id|ip6ip6_lock
)paren
suffix:semicolon
)brace
DECL|function|ip6ip6_ecn_decapsulate
r_static
r_inline
r_void
id|ip6ip6_ecn_decapsulate
c_func
(paren
r_struct
id|ipv6hdr
op_star
id|outer_iph
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|ipv6hdr
op_star
id|inner_iph
op_assign
id|skb-&gt;nh.ipv6h
suffix:semicolon
r_if
c_cond
(paren
id|INET_ECN_is_ce
c_func
(paren
id|ipv6_get_dsfield
c_func
(paren
id|outer_iph
)paren
)paren
)paren
id|IP6_ECN_set_ce
c_func
(paren
id|inner_iph
)paren
suffix:semicolon
)brace
multiline_comment|/**&n; * ip6ip6_rcv - decapsulate IPv6 packet and retransmit it locally&n; *   @skb: received socket buffer&n; *&n; * Return: 0&n; **/
r_static
r_int
DECL|function|ip6ip6_rcv
id|ip6ip6_rcv
c_func
(paren
r_struct
id|sk_buff
op_star
op_star
id|pskb
comma
r_int
r_int
op_star
id|nhoffp
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
op_assign
op_star
id|pskb
suffix:semicolon
r_struct
id|ipv6hdr
op_star
id|ipv6h
suffix:semicolon
r_struct
id|ip6_tnl
op_star
id|t
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pskb_may_pull
c_func
(paren
id|skb
comma
r_sizeof
(paren
op_star
id|ipv6h
)paren
)paren
)paren
r_goto
id|discard
suffix:semicolon
id|ipv6h
op_assign
id|skb-&gt;nh.ipv6h
suffix:semicolon
id|read_lock
c_func
(paren
op_amp
id|ip6ip6_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|t
op_assign
id|ip6ip6_tnl_lookup
c_func
(paren
op_amp
id|ipv6h-&gt;saddr
comma
op_amp
id|ipv6h-&gt;daddr
)paren
)paren
op_ne
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|xfrm6_policy_check
c_func
(paren
l_int|NULL
comma
id|XFRM_POLICY_IN
comma
id|skb
)paren
)paren
(brace
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|t-&gt;parms.flags
op_amp
id|IP6_TNL_F_CAP_RCV
)paren
)paren
(brace
id|t-&gt;stat.rx_dropped
op_increment
suffix:semicolon
id|read_unlock
c_func
(paren
op_amp
id|ip6ip6_lock
)paren
suffix:semicolon
r_goto
id|discard
suffix:semicolon
)brace
id|secpath_reset
c_func
(paren
id|skb
)paren
suffix:semicolon
id|skb-&gt;mac.raw
op_assign
id|skb-&gt;nh.raw
suffix:semicolon
id|skb-&gt;nh.raw
op_assign
id|skb-&gt;data
suffix:semicolon
id|skb-&gt;protocol
op_assign
id|htons
c_func
(paren
id|ETH_P_IPV6
)paren
suffix:semicolon
id|skb-&gt;pkt_type
op_assign
id|PACKET_HOST
suffix:semicolon
id|memset
c_func
(paren
id|skb-&gt;cb
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|inet6_skb_parm
)paren
)paren
suffix:semicolon
id|skb-&gt;dev
op_assign
id|t-&gt;dev
suffix:semicolon
id|dst_release
c_func
(paren
id|skb-&gt;dst
)paren
suffix:semicolon
id|skb-&gt;dst
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|t-&gt;parms.flags
op_amp
id|IP6_TNL_F_RCV_DSCP_COPY
)paren
id|ipv6_copy_dscp
c_func
(paren
id|ipv6h
comma
id|skb-&gt;nh.ipv6h
)paren
suffix:semicolon
id|ip6ip6_ecn_decapsulate
c_func
(paren
id|ipv6h
comma
id|skb
)paren
suffix:semicolon
id|t-&gt;stat.rx_packets
op_increment
suffix:semicolon
id|t-&gt;stat.rx_bytes
op_add_assign
id|skb-&gt;len
suffix:semicolon
id|netif_rx
c_func
(paren
id|skb
)paren
suffix:semicolon
id|read_unlock
c_func
(paren
op_amp
id|ip6ip6_lock
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|read_unlock
c_func
(paren
op_amp
id|ip6ip6_lock
)paren
suffix:semicolon
id|icmpv6_send
c_func
(paren
id|skb
comma
id|ICMPV6_DEST_UNREACH
comma
id|ICMPV6_ADDR_UNREACH
comma
l_int|0
comma
id|skb-&gt;dev
)paren
suffix:semicolon
id|discard
suffix:colon
r_return
l_int|1
suffix:semicolon
)brace
DECL|function|create_tel
r_static
r_inline
r_struct
id|ipv6_txoptions
op_star
id|create_tel
c_func
(paren
id|__u8
id|encap_limit
)paren
(brace
r_struct
id|ipv6_tlv_tnl_enc_lim
op_star
id|tel
suffix:semicolon
r_struct
id|ipv6_txoptions
op_star
id|opt
suffix:semicolon
id|__u8
op_star
id|raw
suffix:semicolon
r_int
id|opt_len
op_assign
r_sizeof
(paren
op_star
id|opt
)paren
op_plus
l_int|8
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|opt
op_assign
id|kmalloc
c_func
(paren
id|opt_len
comma
id|GFP_ATOMIC
)paren
)paren
)paren
(brace
r_return
l_int|NULL
suffix:semicolon
)brace
id|memset
c_func
(paren
id|opt
comma
l_int|0
comma
id|opt_len
)paren
suffix:semicolon
id|opt-&gt;tot_len
op_assign
id|opt_len
suffix:semicolon
id|opt-&gt;dst0opt
op_assign
(paren
r_struct
id|ipv6_opt_hdr
op_star
)paren
(paren
id|opt
op_plus
l_int|1
)paren
suffix:semicolon
id|opt-&gt;opt_nflen
op_assign
l_int|8
suffix:semicolon
id|tel
op_assign
(paren
r_struct
id|ipv6_tlv_tnl_enc_lim
op_star
)paren
(paren
id|opt-&gt;dst0opt
op_plus
l_int|1
)paren
suffix:semicolon
id|tel-&gt;type
op_assign
id|IPV6_TLV_TNL_ENCAP_LIMIT
suffix:semicolon
id|tel-&gt;length
op_assign
l_int|1
suffix:semicolon
id|tel-&gt;encap_limit
op_assign
id|encap_limit
suffix:semicolon
id|raw
op_assign
(paren
id|__u8
op_star
)paren
id|opt-&gt;dst0opt
suffix:semicolon
id|raw
(braket
l_int|5
)braket
op_assign
id|IPV6_TLV_PADN
suffix:semicolon
id|raw
(braket
l_int|6
)braket
op_assign
l_int|1
suffix:semicolon
r_return
id|opt
suffix:semicolon
)brace
multiline_comment|/**&n; * ip6ip6_tnl_addr_conflict - compare packet addresses to tunnel&squot;s own&n; *   @t: the outgoing tunnel device&n; *   @hdr: IPv6 header from the incoming packet &n; *&n; * Description:&n; *   Avoid trivial tunneling loop by checking that tunnel exit-point &n; *   doesn&squot;t match source of incoming packet.&n; *&n; * Return: &n; *   1 if conflict,&n; *   0 else&n; **/
r_static
r_inline
r_int
DECL|function|ip6ip6_tnl_addr_conflict
id|ip6ip6_tnl_addr_conflict
c_func
(paren
r_struct
id|ip6_tnl
op_star
id|t
comma
r_struct
id|ipv6hdr
op_star
id|hdr
)paren
(brace
r_return
id|ipv6_addr_equal
c_func
(paren
op_amp
id|t-&gt;parms.raddr
comma
op_amp
id|hdr-&gt;saddr
)paren
suffix:semicolon
)brace
multiline_comment|/**&n; * ip6ip6_tnl_xmit - encapsulate packet and send &n; *   @skb: the outgoing socket buffer&n; *   @dev: the outgoing tunnel device &n; *&n; * Description:&n; *   Build new header and do some sanity checks on the packet before sending&n; *   it.&n; *&n; * Return: &n; *   0&n; **/
r_static
r_int
DECL|function|ip6ip6_tnl_xmit
id|ip6ip6_tnl_xmit
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|ip6_tnl
op_star
id|t
op_assign
(paren
r_struct
id|ip6_tnl
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_struct
id|net_device_stats
op_star
id|stats
op_assign
op_amp
id|t-&gt;stat
suffix:semicolon
r_struct
id|ipv6hdr
op_star
id|ipv6h
op_assign
id|skb-&gt;nh.ipv6h
suffix:semicolon
r_struct
id|ipv6_txoptions
op_star
id|opt
op_assign
l_int|NULL
suffix:semicolon
r_int
id|encap_limit
op_assign
op_minus
l_int|1
suffix:semicolon
id|__u16
id|offset
suffix:semicolon
r_struct
id|flowi
id|fl
suffix:semicolon
r_struct
id|dst_entry
op_star
id|dst
suffix:semicolon
r_struct
id|net_device
op_star
id|tdev
suffix:semicolon
r_int
id|mtu
suffix:semicolon
r_int
id|max_headroom
op_assign
r_sizeof
(paren
r_struct
id|ipv6hdr
)paren
suffix:semicolon
id|u8
id|proto
suffix:semicolon
r_int
id|err
suffix:semicolon
r_int
id|pkt_len
suffix:semicolon
r_int
id|dsfield
suffix:semicolon
r_if
c_cond
(paren
id|t-&gt;recursion
op_increment
)paren
(brace
id|stats-&gt;collisions
op_increment
suffix:semicolon
r_goto
id|tx_err
suffix:semicolon
)brace
r_if
c_cond
(paren
id|skb-&gt;protocol
op_ne
id|htons
c_func
(paren
id|ETH_P_IPV6
)paren
op_logical_or
op_logical_neg
(paren
id|t-&gt;parms.flags
op_amp
id|IP6_TNL_F_CAP_XMIT
)paren
op_logical_or
id|ip6ip6_tnl_addr_conflict
c_func
(paren
id|t
comma
id|ipv6h
)paren
)paren
(brace
r_goto
id|tx_err
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|offset
op_assign
id|parse_tlv_tnl_enc_lim
c_func
(paren
id|skb
comma
id|skb-&gt;nh.raw
)paren
)paren
OG
l_int|0
)paren
(brace
r_struct
id|ipv6_tlv_tnl_enc_lim
op_star
id|tel
suffix:semicolon
id|tel
op_assign
(paren
r_struct
id|ipv6_tlv_tnl_enc_lim
op_star
)paren
op_amp
id|skb-&gt;nh.raw
(braket
id|offset
)braket
suffix:semicolon
r_if
c_cond
(paren
id|tel-&gt;encap_limit
op_eq
l_int|0
)paren
(brace
id|icmpv6_send
c_func
(paren
id|skb
comma
id|ICMPV6_PARAMPROB
comma
id|ICMPV6_HDR_FIELD
comma
id|offset
op_plus
l_int|2
comma
id|skb-&gt;dev
)paren
suffix:semicolon
r_goto
id|tx_err
suffix:semicolon
)brace
id|encap_limit
op_assign
id|tel-&gt;encap_limit
op_minus
l_int|1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
(paren
id|t-&gt;parms.flags
op_amp
id|IP6_TNL_F_IGN_ENCAP_LIMIT
)paren
)paren
(brace
id|encap_limit
op_assign
id|t-&gt;parms.encap_limit
suffix:semicolon
)brace
id|memcpy
c_func
(paren
op_amp
id|fl
comma
op_amp
id|t-&gt;fl
comma
r_sizeof
(paren
id|fl
)paren
)paren
suffix:semicolon
id|proto
op_assign
id|fl.proto
suffix:semicolon
id|dsfield
op_assign
id|ipv6_get_dsfield
c_func
(paren
id|ipv6h
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|t-&gt;parms.flags
op_amp
id|IP6_TNL_F_USE_ORIG_TCLASS
)paren
)paren
id|fl.fl6_flowlabel
op_or_assign
(paren
op_star
(paren
id|__u32
op_star
)paren
id|ipv6h
op_amp
id|IPV6_TCLASS_MASK
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|t-&gt;parms.flags
op_amp
id|IP6_TNL_F_USE_ORIG_FLOWLABEL
)paren
)paren
id|fl.fl6_flowlabel
op_or_assign
(paren
op_star
(paren
id|__u32
op_star
)paren
id|ipv6h
op_amp
id|IPV6_FLOWLABEL_MASK
)paren
suffix:semicolon
r_if
c_cond
(paren
id|encap_limit
op_ge
l_int|0
op_logical_and
(paren
id|opt
op_assign
id|create_tel
c_func
(paren
id|encap_limit
)paren
)paren
op_eq
l_int|NULL
)paren
r_goto
id|tx_err
suffix:semicolon
r_if
c_cond
(paren
(paren
id|dst
op_assign
id|ip6_tnl_dst_check
c_func
(paren
id|t
)paren
)paren
op_ne
l_int|NULL
)paren
id|dst_hold
c_func
(paren
id|dst
)paren
suffix:semicolon
r_else
id|dst
op_assign
id|ip6_route_output
c_func
(paren
l_int|NULL
comma
op_amp
id|fl
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dst-&gt;error
op_logical_or
id|xfrm_lookup
c_func
(paren
op_amp
id|dst
comma
op_amp
id|fl
comma
l_int|NULL
comma
l_int|0
)paren
OL
l_int|0
)paren
r_goto
id|tx_err_link_failure
suffix:semicolon
id|tdev
op_assign
id|dst-&gt;dev
suffix:semicolon
r_if
c_cond
(paren
id|tdev
op_eq
id|dev
)paren
(brace
id|stats-&gt;collisions
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|net_ratelimit
c_func
(paren
)paren
)paren
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Local routing loop detected!&bslash;n&quot;
comma
id|t-&gt;parms.name
)paren
suffix:semicolon
r_goto
id|tx_err_dst_release
suffix:semicolon
)brace
id|mtu
op_assign
id|dst_pmtu
c_func
(paren
id|dst
)paren
op_minus
r_sizeof
(paren
op_star
id|ipv6h
)paren
suffix:semicolon
r_if
c_cond
(paren
id|opt
)paren
(brace
id|max_headroom
op_add_assign
l_int|8
suffix:semicolon
id|mtu
op_sub_assign
l_int|8
suffix:semicolon
)brace
r_if
c_cond
(paren
id|mtu
OL
id|IPV6_MIN_MTU
)paren
id|mtu
op_assign
id|IPV6_MIN_MTU
suffix:semicolon
r_if
c_cond
(paren
id|skb-&gt;dst
op_logical_and
id|mtu
OL
id|dst_pmtu
c_func
(paren
id|skb-&gt;dst
)paren
)paren
(brace
r_struct
id|rt6_info
op_star
id|rt
op_assign
(paren
r_struct
id|rt6_info
op_star
)paren
id|skb-&gt;dst
suffix:semicolon
id|rt-&gt;rt6i_flags
op_or_assign
id|RTF_MODIFIED
suffix:semicolon
id|rt-&gt;u.dst.metrics
(braket
id|RTAX_MTU
op_minus
l_int|1
)braket
op_assign
id|mtu
suffix:semicolon
)brace
r_if
c_cond
(paren
id|skb-&gt;len
OG
id|mtu
)paren
(brace
id|icmpv6_send
c_func
(paren
id|skb
comma
id|ICMPV6_PKT_TOOBIG
comma
l_int|0
comma
id|mtu
comma
id|dev
)paren
suffix:semicolon
r_goto
id|tx_err_dst_release
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * Okay, now see if we can stuff it in the buffer as-is.&n;&t; */
id|max_headroom
op_add_assign
id|LL_RESERVED_SPACE
c_func
(paren
id|tdev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb_headroom
c_func
(paren
id|skb
)paren
OL
id|max_headroom
op_logical_or
id|skb_cloned
c_func
(paren
id|skb
)paren
op_logical_or
id|skb_shared
c_func
(paren
id|skb
)paren
)paren
(brace
r_struct
id|sk_buff
op_star
id|new_skb
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|new_skb
op_assign
id|skb_realloc_headroom
c_func
(paren
id|skb
comma
id|max_headroom
)paren
)paren
)paren
r_goto
id|tx_err_dst_release
suffix:semicolon
r_if
c_cond
(paren
id|skb-&gt;sk
)paren
id|skb_set_owner_w
c_func
(paren
id|new_skb
comma
id|skb-&gt;sk
)paren
suffix:semicolon
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
id|skb
op_assign
id|new_skb
suffix:semicolon
)brace
id|dst_release
c_func
(paren
id|skb-&gt;dst
)paren
suffix:semicolon
id|skb-&gt;dst
op_assign
id|dst_clone
c_func
(paren
id|dst
)paren
suffix:semicolon
id|skb-&gt;h.raw
op_assign
id|skb-&gt;nh.raw
suffix:semicolon
r_if
c_cond
(paren
id|opt
)paren
id|ipv6_push_nfrag_opts
c_func
(paren
id|skb
comma
id|opt
comma
op_amp
id|proto
comma
l_int|NULL
)paren
suffix:semicolon
id|skb-&gt;nh.raw
op_assign
id|skb_push
c_func
(paren
id|skb
comma
r_sizeof
(paren
r_struct
id|ipv6hdr
)paren
)paren
suffix:semicolon
id|ipv6h
op_assign
id|skb-&gt;nh.ipv6h
suffix:semicolon
op_star
(paren
id|u32
op_star
)paren
id|ipv6h
op_assign
id|fl.fl6_flowlabel
op_or
id|htonl
c_func
(paren
l_int|0x60000000
)paren
suffix:semicolon
id|dsfield
op_assign
id|INET_ECN_encapsulate
c_func
(paren
l_int|0
comma
id|dsfield
)paren
suffix:semicolon
id|ipv6_change_dsfield
c_func
(paren
id|ipv6h
comma
op_complement
id|INET_ECN_MASK
comma
id|dsfield
)paren
suffix:semicolon
id|ipv6h-&gt;payload_len
op_assign
id|htons
c_func
(paren
id|skb-&gt;len
op_minus
r_sizeof
(paren
r_struct
id|ipv6hdr
)paren
)paren
suffix:semicolon
id|ipv6h-&gt;hop_limit
op_assign
id|t-&gt;parms.hop_limit
suffix:semicolon
id|ipv6h-&gt;nexthdr
op_assign
id|proto
suffix:semicolon
id|ipv6_addr_copy
c_func
(paren
op_amp
id|ipv6h-&gt;saddr
comma
op_amp
id|fl.fl6_src
)paren
suffix:semicolon
id|ipv6_addr_copy
c_func
(paren
op_amp
id|ipv6h-&gt;daddr
comma
op_amp
id|fl.fl6_dst
)paren
suffix:semicolon
id|nf_reset
c_func
(paren
id|skb
)paren
suffix:semicolon
id|pkt_len
op_assign
id|skb-&gt;len
suffix:semicolon
id|err
op_assign
id|NF_HOOK
c_func
(paren
id|PF_INET6
comma
id|NF_IP6_LOCAL_OUT
comma
id|skb
comma
l_int|NULL
comma
id|skb-&gt;dst-&gt;dev
comma
id|dst_output
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
op_eq
id|NET_XMIT_SUCCESS
op_logical_or
id|err
op_eq
id|NET_XMIT_CN
)paren
(brace
id|stats-&gt;tx_bytes
op_add_assign
id|pkt_len
suffix:semicolon
id|stats-&gt;tx_packets
op_increment
suffix:semicolon
)brace
r_else
(brace
id|stats-&gt;tx_errors
op_increment
suffix:semicolon
id|stats-&gt;tx_aborted_errors
op_increment
suffix:semicolon
)brace
id|ip6_tnl_dst_store
c_func
(paren
id|t
comma
id|dst
)paren
suffix:semicolon
r_if
c_cond
(paren
id|opt
)paren
id|kfree
c_func
(paren
id|opt
)paren
suffix:semicolon
id|t-&gt;recursion
op_decrement
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|tx_err_link_failure
suffix:colon
id|stats-&gt;tx_carrier_errors
op_increment
suffix:semicolon
id|dst_link_failure
c_func
(paren
id|skb
)paren
suffix:semicolon
id|tx_err_dst_release
suffix:colon
id|dst_release
c_func
(paren
id|dst
)paren
suffix:semicolon
r_if
c_cond
(paren
id|opt
)paren
id|kfree
c_func
(paren
id|opt
)paren
suffix:semicolon
id|tx_err
suffix:colon
id|stats-&gt;tx_errors
op_increment
suffix:semicolon
id|stats-&gt;tx_dropped
op_increment
suffix:semicolon
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
id|t-&gt;recursion
op_decrement
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|ip6_tnl_set_cap
r_static
r_void
id|ip6_tnl_set_cap
c_func
(paren
r_struct
id|ip6_tnl
op_star
id|t
)paren
(brace
r_struct
id|ip6_tnl_parm
op_star
id|p
op_assign
op_amp
id|t-&gt;parms
suffix:semicolon
r_struct
id|in6_addr
op_star
id|laddr
op_assign
op_amp
id|p-&gt;laddr
suffix:semicolon
r_struct
id|in6_addr
op_star
id|raddr
op_assign
op_amp
id|p-&gt;raddr
suffix:semicolon
r_int
id|ltype
op_assign
id|ipv6_addr_type
c_func
(paren
id|laddr
)paren
suffix:semicolon
r_int
id|rtype
op_assign
id|ipv6_addr_type
c_func
(paren
id|raddr
)paren
suffix:semicolon
id|p-&gt;flags
op_and_assign
op_complement
(paren
id|IP6_TNL_F_CAP_XMIT
op_or
id|IP6_TNL_F_CAP_RCV
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ltype
op_ne
id|IPV6_ADDR_ANY
op_logical_and
id|rtype
op_ne
id|IPV6_ADDR_ANY
op_logical_and
(paren
(paren
id|ltype
op_or
id|rtype
)paren
op_amp
(paren
id|IPV6_ADDR_UNICAST
op_or
id|IPV6_ADDR_LOOPBACK
op_or
id|IPV6_ADDR_LINKLOCAL
op_or
id|IPV6_ADDR_MAPPED
op_or
id|IPV6_ADDR_RESERVED
)paren
)paren
op_eq
id|IPV6_ADDR_UNICAST
)paren
(brace
r_struct
id|net_device
op_star
id|ldev
op_assign
l_int|NULL
suffix:semicolon
r_int
id|l_ok
op_assign
l_int|1
suffix:semicolon
r_int
id|r_ok
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;link
)paren
id|ldev
op_assign
id|dev_get_by_index
c_func
(paren
id|p-&gt;link
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ltype
op_amp
id|IPV6_ADDR_UNICAST
op_logical_and
op_logical_neg
id|ipv6_chk_addr
c_func
(paren
id|laddr
comma
id|ldev
comma
l_int|0
)paren
)paren
id|l_ok
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|rtype
op_amp
id|IPV6_ADDR_UNICAST
op_logical_and
id|ipv6_chk_addr
c_func
(paren
id|raddr
comma
l_int|NULL
comma
l_int|0
)paren
)paren
id|r_ok
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|l_ok
op_logical_and
id|r_ok
)paren
(brace
r_if
c_cond
(paren
id|ltype
op_amp
id|IPV6_ADDR_UNICAST
)paren
id|p-&gt;flags
op_or_assign
id|IP6_TNL_F_CAP_XMIT
suffix:semicolon
r_if
c_cond
(paren
id|rtype
op_amp
id|IPV6_ADDR_UNICAST
)paren
id|p-&gt;flags
op_or_assign
id|IP6_TNL_F_CAP_RCV
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ldev
)paren
id|dev_put
c_func
(paren
id|ldev
)paren
suffix:semicolon
)brace
)brace
DECL|function|ip6ip6_tnl_link_config
r_static
r_void
id|ip6ip6_tnl_link_config
c_func
(paren
r_struct
id|ip6_tnl
op_star
id|t
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
id|t-&gt;dev
suffix:semicolon
r_struct
id|ip6_tnl_parm
op_star
id|p
op_assign
op_amp
id|t-&gt;parms
suffix:semicolon
r_struct
id|flowi
op_star
id|fl
op_assign
op_amp
id|t-&gt;fl
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|dev-&gt;dev_addr
comma
op_amp
id|p-&gt;laddr
comma
r_sizeof
(paren
r_struct
id|in6_addr
)paren
)paren
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|dev-&gt;broadcast
comma
op_amp
id|p-&gt;raddr
comma
r_sizeof
(paren
r_struct
id|in6_addr
)paren
)paren
suffix:semicolon
multiline_comment|/* Set up flowi template */
id|ipv6_addr_copy
c_func
(paren
op_amp
id|fl-&gt;fl6_src
comma
op_amp
id|p-&gt;laddr
)paren
suffix:semicolon
id|ipv6_addr_copy
c_func
(paren
op_amp
id|fl-&gt;fl6_dst
comma
op_amp
id|p-&gt;raddr
)paren
suffix:semicolon
id|fl-&gt;oif
op_assign
id|p-&gt;link
suffix:semicolon
id|fl-&gt;fl6_flowlabel
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|p-&gt;flags
op_amp
id|IP6_TNL_F_USE_ORIG_TCLASS
)paren
)paren
id|fl-&gt;fl6_flowlabel
op_or_assign
id|IPV6_TCLASS_MASK
op_amp
id|p-&gt;flowinfo
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|p-&gt;flags
op_amp
id|IP6_TNL_F_USE_ORIG_FLOWLABEL
)paren
)paren
id|fl-&gt;fl6_flowlabel
op_or_assign
id|IPV6_FLOWLABEL_MASK
op_amp
id|p-&gt;flowinfo
suffix:semicolon
id|ip6_tnl_set_cap
c_func
(paren
id|t
)paren
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;flags
op_amp
id|IP6_TNL_F_CAP_XMIT
op_logical_and
id|p-&gt;flags
op_amp
id|IP6_TNL_F_CAP_RCV
)paren
id|dev-&gt;flags
op_or_assign
id|IFF_POINTOPOINT
suffix:semicolon
r_else
id|dev-&gt;flags
op_and_assign
op_complement
id|IFF_POINTOPOINT
suffix:semicolon
id|dev-&gt;iflink
op_assign
id|p-&gt;link
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;flags
op_amp
id|IP6_TNL_F_CAP_XMIT
)paren
(brace
r_struct
id|rt6_info
op_star
id|rt
op_assign
id|rt6_lookup
c_func
(paren
op_amp
id|p-&gt;raddr
comma
op_amp
id|p-&gt;laddr
comma
id|p-&gt;link
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rt
op_eq
l_int|NULL
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|rt-&gt;rt6i_dev
)paren
(brace
id|dev-&gt;hard_header_len
op_assign
id|rt-&gt;rt6i_dev-&gt;hard_header_len
op_plus
r_sizeof
(paren
r_struct
id|ipv6hdr
)paren
suffix:semicolon
id|dev-&gt;mtu
op_assign
id|rt-&gt;rt6i_dev-&gt;mtu
op_minus
r_sizeof
(paren
r_struct
id|ipv6hdr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;mtu
OL
id|IPV6_MIN_MTU
)paren
id|dev-&gt;mtu
op_assign
id|IPV6_MIN_MTU
suffix:semicolon
)brace
id|dst_release
c_func
(paren
op_amp
id|rt-&gt;u.dst
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/**&n; * ip6ip6_tnl_change - update the tunnel parameters&n; *   @t: tunnel to be changed&n; *   @p: tunnel configuration parameters&n; *   @active: != 0 if tunnel is ready for use&n; *&n; * Description:&n; *   ip6ip6_tnl_change() updates the tunnel parameters&n; **/
r_static
r_int
DECL|function|ip6ip6_tnl_change
id|ip6ip6_tnl_change
c_func
(paren
r_struct
id|ip6_tnl
op_star
id|t
comma
r_struct
id|ip6_tnl_parm
op_star
id|p
)paren
(brace
id|ipv6_addr_copy
c_func
(paren
op_amp
id|t-&gt;parms.laddr
comma
op_amp
id|p-&gt;laddr
)paren
suffix:semicolon
id|ipv6_addr_copy
c_func
(paren
op_amp
id|t-&gt;parms.raddr
comma
op_amp
id|p-&gt;raddr
)paren
suffix:semicolon
id|t-&gt;parms.flags
op_assign
id|p-&gt;flags
suffix:semicolon
id|t-&gt;parms.hop_limit
op_assign
id|p-&gt;hop_limit
suffix:semicolon
id|t-&gt;parms.encap_limit
op_assign
id|p-&gt;encap_limit
suffix:semicolon
id|t-&gt;parms.flowinfo
op_assign
id|p-&gt;flowinfo
suffix:semicolon
id|ip6ip6_tnl_link_config
c_func
(paren
id|t
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/**&n; * ip6ip6_tnl_ioctl - configure ipv6 tunnels from userspace &n; *   @dev: virtual device associated with tunnel&n; *   @ifr: parameters passed from userspace&n; *   @cmd: command to be performed&n; *&n; * Description:&n; *   ip6ip6_tnl_ioctl() is used for managing IPv6 tunnels &n; *   from userspace. &n; *&n; *   The possible commands are the following:&n; *     %SIOCGETTUNNEL: get tunnel parameters for device&n; *     %SIOCADDTUNNEL: add tunnel matching given tunnel parameters&n; *     %SIOCCHGTUNNEL: change tunnel parameters to those given&n; *     %SIOCDELTUNNEL: delete tunnel&n; *&n; *   The fallback device &quot;ip6tnl0&quot;, created during module &n; *   initialization, can be used for creating other tunnel devices.&n; *&n; * Return:&n; *   0 on success,&n; *   %-EFAULT if unable to copy data to or from userspace,&n; *   %-EPERM if current process hasn&squot;t %CAP_NET_ADMIN set&n; *   %-EINVAL if passed tunnel parameters are invalid,&n; *   %-EEXIST if changing a tunnel&squot;s parameters would cause a conflict&n; *   %-ENODEV if attempting to change or delete a nonexisting device&n; **/
r_static
r_int
DECL|function|ip6ip6_tnl_ioctl
id|ip6ip6_tnl_ioctl
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|ifreq
op_star
id|ifr
comma
r_int
id|cmd
)paren
(brace
r_int
id|err
op_assign
l_int|0
suffix:semicolon
r_int
id|create
suffix:semicolon
r_struct
id|ip6_tnl_parm
id|p
suffix:semicolon
r_struct
id|ip6_tnl
op_star
id|t
op_assign
l_int|NULL
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|SIOCGETTUNNEL
suffix:colon
r_if
c_cond
(paren
id|dev
op_eq
id|ip6ip6_fb_tnl_dev
)paren
(brace
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|p
comma
id|ifr-&gt;ifr_ifru.ifru_data
comma
r_sizeof
(paren
id|p
)paren
)paren
)paren
(brace
id|err
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|ip6ip6_tnl_locate
c_func
(paren
op_amp
id|p
comma
op_amp
id|t
comma
l_int|0
)paren
)paren
op_eq
op_minus
id|ENODEV
)paren
id|t
op_assign
(paren
r_struct
id|ip6_tnl
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_else
r_if
c_cond
(paren
id|err
)paren
r_break
suffix:semicolon
)brace
r_else
id|t
op_assign
(paren
r_struct
id|ip6_tnl
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|p
comma
op_amp
id|t-&gt;parms
comma
r_sizeof
(paren
id|p
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|ifr-&gt;ifr_ifru.ifru_data
comma
op_amp
id|p
comma
r_sizeof
(paren
id|p
)paren
)paren
)paren
(brace
id|err
op_assign
op_minus
id|EFAULT
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|SIOCADDTUNNEL
suffix:colon
r_case
id|SIOCCHGTUNNEL
suffix:colon
id|err
op_assign
op_minus
id|EPERM
suffix:semicolon
id|create
op_assign
(paren
id|cmd
op_eq
id|SIOCADDTUNNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_NET_ADMIN
)paren
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|p
comma
id|ifr-&gt;ifr_ifru.ifru_data
comma
r_sizeof
(paren
id|p
)paren
)paren
)paren
(brace
id|err
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|create
op_logical_and
id|dev
op_ne
id|ip6ip6_fb_tnl_dev
)paren
(brace
id|t
op_assign
(paren
r_struct
id|ip6_tnl
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|t
op_logical_and
(paren
id|err
op_assign
id|ip6ip6_tnl_locate
c_func
(paren
op_amp
id|p
comma
op_amp
id|t
comma
id|create
)paren
)paren
)paren
(brace
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cmd
op_eq
id|SIOCCHGTUNNEL
)paren
(brace
r_if
c_cond
(paren
id|t-&gt;dev
op_ne
id|dev
)paren
(brace
id|err
op_assign
op_minus
id|EEXIST
suffix:semicolon
r_break
suffix:semicolon
)brace
id|ip6ip6_tnl_unlink
c_func
(paren
id|t
)paren
suffix:semicolon
id|err
op_assign
id|ip6ip6_tnl_change
c_func
(paren
id|t
comma
op_amp
id|p
)paren
suffix:semicolon
id|ip6ip6_tnl_link
c_func
(paren
id|t
)paren
suffix:semicolon
id|netdev_state_change
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|ifr-&gt;ifr_ifru.ifru_data
comma
op_amp
id|t-&gt;parms
comma
r_sizeof
(paren
id|p
)paren
)paren
)paren
(brace
id|err
op_assign
op_minus
id|EFAULT
suffix:semicolon
)brace
r_else
(brace
id|err
op_assign
l_int|0
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|SIOCDELTUNNEL
suffix:colon
id|err
op_assign
op_minus
id|EPERM
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_NET_ADMIN
)paren
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|dev
op_eq
id|ip6ip6_fb_tnl_dev
)paren
(brace
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|p
comma
id|ifr-&gt;ifr_ifru.ifru_data
comma
r_sizeof
(paren
id|p
)paren
)paren
)paren
(brace
id|err
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_break
suffix:semicolon
)brace
id|err
op_assign
id|ip6ip6_tnl_locate
c_func
(paren
op_amp
id|p
comma
op_amp
id|t
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|t
op_eq
id|ip6ip6_fb_tnl_dev-&gt;priv
)paren
(brace
id|err
op_assign
op_minus
id|EPERM
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_else
(brace
id|t
op_assign
(paren
r_struct
id|ip6_tnl
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
)brace
id|err
op_assign
id|unregister_netdevice
c_func
(paren
id|t-&gt;dev
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|err
op_assign
op_minus
id|EINVAL
suffix:semicolon
)brace
r_return
id|err
suffix:semicolon
)brace
multiline_comment|/**&n; * ip6ip6_tnl_get_stats - return the stats for tunnel device &n; *   @dev: virtual device associated with tunnel&n; *&n; * Return: stats for device&n; **/
r_static
r_struct
id|net_device_stats
op_star
DECL|function|ip6ip6_tnl_get_stats
id|ip6ip6_tnl_get_stats
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_return
op_amp
(paren
(paren
(paren
r_struct
id|ip6_tnl
op_star
)paren
id|dev-&gt;priv
)paren
op_member_access_from_pointer
id|stat
)paren
suffix:semicolon
)brace
multiline_comment|/**&n; * ip6ip6_tnl_change_mtu - change mtu manually for tunnel device&n; *   @dev: virtual device associated with tunnel&n; *   @new_mtu: the new mtu&n; *&n; * Return:&n; *   0 on success,&n; *   %-EINVAL if mtu too small&n; **/
r_static
r_int
DECL|function|ip6ip6_tnl_change_mtu
id|ip6ip6_tnl_change_mtu
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|new_mtu
)paren
(brace
r_if
c_cond
(paren
id|new_mtu
OL
id|IPV6_MIN_MTU
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|dev-&gt;mtu
op_assign
id|new_mtu
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/**&n; * ip6ip6_tnl_dev_setup - setup virtual tunnel device&n; *   @dev: virtual device associated with tunnel&n; *&n; * Description:&n; *   Initialize function pointers and device parameters&n; **/
DECL|function|ip6ip6_tnl_dev_setup
r_static
r_void
id|ip6ip6_tnl_dev_setup
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
id|SET_MODULE_OWNER
c_func
(paren
id|dev
)paren
suffix:semicolon
id|dev-&gt;uninit
op_assign
id|ip6ip6_tnl_dev_uninit
suffix:semicolon
id|dev-&gt;destructor
op_assign
id|free_netdev
suffix:semicolon
id|dev-&gt;hard_start_xmit
op_assign
id|ip6ip6_tnl_xmit
suffix:semicolon
id|dev-&gt;get_stats
op_assign
id|ip6ip6_tnl_get_stats
suffix:semicolon
id|dev-&gt;do_ioctl
op_assign
id|ip6ip6_tnl_ioctl
suffix:semicolon
id|dev-&gt;change_mtu
op_assign
id|ip6ip6_tnl_change_mtu
suffix:semicolon
id|dev-&gt;type
op_assign
id|ARPHRD_TUNNEL6
suffix:semicolon
id|dev-&gt;hard_header_len
op_assign
id|LL_MAX_HEADER
op_plus
r_sizeof
(paren
r_struct
id|ipv6hdr
)paren
suffix:semicolon
id|dev-&gt;mtu
op_assign
id|ETH_DATA_LEN
op_minus
r_sizeof
(paren
r_struct
id|ipv6hdr
)paren
suffix:semicolon
id|dev-&gt;flags
op_or_assign
id|IFF_NOARP
suffix:semicolon
id|dev-&gt;addr_len
op_assign
r_sizeof
(paren
r_struct
id|in6_addr
)paren
suffix:semicolon
)brace
multiline_comment|/**&n; * ip6ip6_tnl_dev_init_gen - general initializer for all tunnel devices&n; *   @dev: virtual device associated with tunnel&n; **/
r_static
r_inline
r_void
DECL|function|ip6ip6_tnl_dev_init_gen
id|ip6ip6_tnl_dev_init_gen
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|ip6_tnl
op_star
id|t
op_assign
(paren
r_struct
id|ip6_tnl
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|t-&gt;fl.proto
op_assign
id|IPPROTO_IPV6
suffix:semicolon
id|t-&gt;dev
op_assign
id|dev
suffix:semicolon
id|strcpy
c_func
(paren
id|t-&gt;parms.name
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
multiline_comment|/**&n; * ip6ip6_tnl_dev_init - initializer for all non fallback tunnel devices&n; *   @dev: virtual device associated with tunnel&n; **/
r_static
r_int
DECL|function|ip6ip6_tnl_dev_init
id|ip6ip6_tnl_dev_init
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|ip6_tnl
op_star
id|t
op_assign
(paren
r_struct
id|ip6_tnl
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|ip6ip6_tnl_dev_init_gen
c_func
(paren
id|dev
)paren
suffix:semicolon
id|ip6ip6_tnl_link_config
c_func
(paren
id|t
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/**&n; * ip6ip6_fb_tnl_dev_init - initializer for fallback tunnel device&n; *   @dev: fallback device&n; *&n; * Return: 0&n; **/
r_static
r_int
DECL|function|ip6ip6_fb_tnl_dev_init
id|ip6ip6_fb_tnl_dev_init
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|ip6_tnl
op_star
id|t
op_assign
id|dev-&gt;priv
suffix:semicolon
id|ip6ip6_tnl_dev_init_gen
c_func
(paren
id|dev
)paren
suffix:semicolon
id|dev_hold
c_func
(paren
id|dev
)paren
suffix:semicolon
id|tnls_wc
(braket
l_int|0
)braket
op_assign
id|t
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|ip6ip6_handler
r_static
r_struct
id|xfrm6_tunnel
id|ip6ip6_handler
op_assign
(brace
dot
id|handler
op_assign
id|ip6ip6_rcv
comma
dot
id|err_handler
op_assign
id|ip6ip6_err
comma
)brace
suffix:semicolon
multiline_comment|/**&n; * ip6_tunnel_init - register protocol and reserve needed resources&n; *&n; * Return: 0 on success&n; **/
DECL|function|ip6_tunnel_init
r_static
r_int
id|__init
id|ip6_tunnel_init
c_func
(paren
r_void
)paren
(brace
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
id|xfrm6_tunnel_register
c_func
(paren
op_amp
id|ip6ip6_handler
)paren
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;ip6ip6 init: can&squot;t register tunnel&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EAGAIN
suffix:semicolon
)brace
id|ip6ip6_fb_tnl_dev
op_assign
id|alloc_netdev
c_func
(paren
r_sizeof
(paren
r_struct
id|ip6_tnl
)paren
comma
l_string|&quot;ip6tnl0&quot;
comma
id|ip6ip6_tnl_dev_setup
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ip6ip6_fb_tnl_dev
)paren
(brace
id|err
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|fail
suffix:semicolon
)brace
id|ip6ip6_fb_tnl_dev-&gt;init
op_assign
id|ip6ip6_fb_tnl_dev_init
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|register_netdev
c_func
(paren
id|ip6ip6_fb_tnl_dev
)paren
)paren
)paren
(brace
id|free_netdev
c_func
(paren
id|ip6ip6_fb_tnl_dev
)paren
suffix:semicolon
r_goto
id|fail
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
id|fail
suffix:colon
id|xfrm6_tunnel_deregister
c_func
(paren
op_amp
id|ip6ip6_handler
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
multiline_comment|/**&n; * ip6_tunnel_cleanup - free resources and unregister protocol&n; **/
DECL|function|ip6_tunnel_cleanup
r_static
r_void
id|__exit
id|ip6_tunnel_cleanup
c_func
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
id|xfrm6_tunnel_deregister
c_func
(paren
op_amp
id|ip6ip6_handler
)paren
OL
l_int|0
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;ip6ip6 close: can&squot;t deregister tunnel&bslash;n&quot;
)paren
suffix:semicolon
id|unregister_netdev
c_func
(paren
id|ip6ip6_fb_tnl_dev
)paren
suffix:semicolon
)brace
DECL|variable|ip6_tunnel_init
id|module_init
c_func
(paren
id|ip6_tunnel_init
)paren
suffix:semicolon
DECL|variable|ip6_tunnel_cleanup
id|module_exit
c_func
(paren
id|ip6_tunnel_cleanup
)paren
suffix:semicolon
eof
