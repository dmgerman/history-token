multiline_comment|/*&n; *&t;Multicast support for IPv6&n; *&t;Linux INET6 implementation &n; *&n; *&t;Authors:&n; *&t;Pedro Roque&t;&t;&lt;roque@di.fc.ul.pt&gt;&t;&n; *&n; *&t;$Id: mcast.c,v 1.40 2002/02/08 03:57:19 davem Exp $&n; *&n; *&t;Based on linux/ipv4/igmp.c and linux/ipv4/ip_sockglue.c &n; *&n; *&t;This program is free software; you can redistribute it and/or&n; *      modify it under the terms of the GNU General Public License&n; *      as published by the Free Software Foundation; either version&n; *      2 of the License, or (at your option) any later version.&n; */
multiline_comment|/* Changes:&n; *&n; *&t;yoshfuji&t;: fix format of router-alert option&n; *&t;YOSHIFUJI Hideaki @USAGI:&n; *&t;&t;Fixed source address for MLD message based on&n; *&t;&t;&lt;draft-ietf-magma-mld-source-05.txt&gt;.&n; *&t;YOSHIFUJI Hideaki @USAGI:&n; *&t;&t;- Ignore Queries for invalid addresses.&n; *&t;&t;- MLD for link-local addresses.&n; *&t;David L Stevens &lt;dlstevens@us.ibm.com&gt;:&n; *&t;&t;- MLDv2 support&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/socket.h&gt;
macro_line|#include &lt;linux/sockios.h&gt;
macro_line|#include &lt;linux/jiffies.h&gt;
macro_line|#include &lt;linux/times.h&gt;
macro_line|#include &lt;linux/net.h&gt;
macro_line|#include &lt;linux/in.h&gt;
macro_line|#include &lt;linux/in6.h&gt;
macro_line|#include &lt;linux/netdevice.h&gt;
macro_line|#include &lt;linux/if_arp.h&gt;
macro_line|#include &lt;linux/route.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/proc_fs.h&gt;
macro_line|#include &lt;linux/seq_file.h&gt;
macro_line|#include &lt;linux/netfilter.h&gt;
macro_line|#include &lt;linux/netfilter_ipv6.h&gt;
macro_line|#include &lt;net/sock.h&gt;
macro_line|#include &lt;net/snmp.h&gt;
macro_line|#include &lt;net/ipv6.h&gt;
macro_line|#include &lt;net/protocol.h&gt;
macro_line|#include &lt;net/if_inet6.h&gt;
macro_line|#include &lt;net/ndisc.h&gt;
macro_line|#include &lt;net/addrconf.h&gt;
macro_line|#include &lt;net/ip6_route.h&gt;
macro_line|#include &lt;net/ip6_checksum.h&gt;
multiline_comment|/* Set to 3 to get tracing... */
DECL|macro|MCAST_DEBUG
mdefine_line|#define MCAST_DEBUG 2
macro_line|#if MCAST_DEBUG &gt;= 3
DECL|macro|MDBG
mdefine_line|#define MDBG(x) printk x
macro_line|#else
DECL|macro|MDBG
mdefine_line|#define MDBG(x)
macro_line|#endif
multiline_comment|/*&n; *  These header formats should be in a separate include file, but icmpv6.h&n; *  doesn&squot;t have in6_addr defined in all cases, there is no __u128, and no&n; *  other files reference these.&n; *&n; *  &t;&t;&t;+-DLS 4/14/03&n; */
multiline_comment|/* Multicast Listener Discovery version 2 headers */
DECL|struct|mld2_grec
r_struct
id|mld2_grec
(brace
DECL|member|grec_type
id|__u8
id|grec_type
suffix:semicolon
DECL|member|grec_auxwords
id|__u8
id|grec_auxwords
suffix:semicolon
DECL|member|grec_nsrcs
id|__u16
id|grec_nsrcs
suffix:semicolon
DECL|member|grec_mca
r_struct
id|in6_addr
id|grec_mca
suffix:semicolon
DECL|member|grec_src
r_struct
id|in6_addr
id|grec_src
(braket
l_int|0
)braket
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|mld2_report
r_struct
id|mld2_report
(brace
DECL|member|type
id|__u8
id|type
suffix:semicolon
DECL|member|resv1
id|__u8
id|resv1
suffix:semicolon
DECL|member|csum
id|__u16
id|csum
suffix:semicolon
DECL|member|resv2
id|__u16
id|resv2
suffix:semicolon
DECL|member|ngrec
id|__u16
id|ngrec
suffix:semicolon
DECL|member|grec
r_struct
id|mld2_grec
id|grec
(braket
l_int|0
)braket
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|mld2_query
r_struct
id|mld2_query
(brace
DECL|member|type
id|__u8
id|type
suffix:semicolon
DECL|member|code
id|__u8
id|code
suffix:semicolon
DECL|member|csum
id|__u16
id|csum
suffix:semicolon
DECL|member|mrc
id|__u16
id|mrc
suffix:semicolon
DECL|member|resv1
id|__u16
id|resv1
suffix:semicolon
DECL|member|mca
r_struct
id|in6_addr
id|mca
suffix:semicolon
macro_line|#if defined(__LITTLE_ENDIAN_BITFIELD)
DECL|member|qrv
id|__u8
id|qrv
suffix:colon
l_int|3
comma
DECL|member|suppress
id|suppress
suffix:colon
l_int|1
comma
DECL|member|resv2
id|resv2
suffix:colon
l_int|4
suffix:semicolon
macro_line|#elif defined(__BIG_ENDIAN_BITFIELD)
DECL|member|resv2
id|__u8
id|resv2
suffix:colon
l_int|4
comma
DECL|member|suppress
id|suppress
suffix:colon
l_int|1
comma
DECL|member|qrv
id|qrv
suffix:colon
l_int|3
suffix:semicolon
macro_line|#else
macro_line|#error &quot;Please fix &lt;asm/byteorder.h&gt;&quot;
macro_line|#endif
DECL|member|qqic
id|__u8
id|qqic
suffix:semicolon
DECL|member|nsrcs
id|__u16
id|nsrcs
suffix:semicolon
DECL|member|srcs
r_struct
id|in6_addr
id|srcs
(braket
l_int|0
)braket
suffix:semicolon
)brace
suffix:semicolon
DECL|variable|mld2_all_mcr
r_struct
id|in6_addr
id|mld2_all_mcr
op_assign
id|MLD2_ALL_MCR_INIT
suffix:semicolon
multiline_comment|/* Big mc list lock for all the sockets */
r_static
id|DEFINE_RWLOCK
c_func
(paren
id|ipv6_sk_mc_lock
)paren
suffix:semicolon
DECL|variable|igmp6_socket
r_static
r_struct
id|socket
op_star
id|igmp6_socket
suffix:semicolon
r_int
id|__ipv6_dev_mc_dec
c_func
(paren
r_struct
id|inet6_dev
op_star
id|idev
comma
r_struct
id|in6_addr
op_star
id|addr
)paren
suffix:semicolon
r_static
r_void
id|igmp6_join_group
c_func
(paren
r_struct
id|ifmcaddr6
op_star
id|ma
)paren
suffix:semicolon
r_static
r_void
id|igmp6_leave_group
c_func
(paren
r_struct
id|ifmcaddr6
op_star
id|ma
)paren
suffix:semicolon
r_static
r_void
id|igmp6_timer_handler
c_func
(paren
r_int
r_int
id|data
)paren
suffix:semicolon
r_static
r_void
id|mld_gq_timer_expire
c_func
(paren
r_int
r_int
id|data
)paren
suffix:semicolon
r_static
r_void
id|mld_ifc_timer_expire
c_func
(paren
r_int
r_int
id|data
)paren
suffix:semicolon
r_static
r_void
id|mld_ifc_event
c_func
(paren
r_struct
id|inet6_dev
op_star
id|idev
)paren
suffix:semicolon
r_static
r_void
id|mld_add_delrec
c_func
(paren
r_struct
id|inet6_dev
op_star
id|idev
comma
r_struct
id|ifmcaddr6
op_star
id|pmc
)paren
suffix:semicolon
r_static
r_void
id|mld_del_delrec
c_func
(paren
r_struct
id|inet6_dev
op_star
id|idev
comma
r_struct
id|in6_addr
op_star
id|addr
)paren
suffix:semicolon
r_static
r_void
id|mld_clear_delrec
c_func
(paren
r_struct
id|inet6_dev
op_star
id|idev
)paren
suffix:semicolon
r_static
r_int
id|sf_setstate
c_func
(paren
r_struct
id|ifmcaddr6
op_star
id|pmc
)paren
suffix:semicolon
r_static
r_void
id|sf_markstate
c_func
(paren
r_struct
id|ifmcaddr6
op_star
id|pmc
)paren
suffix:semicolon
r_static
r_void
id|ip6_mc_clear_src
c_func
(paren
r_struct
id|ifmcaddr6
op_star
id|pmc
)paren
suffix:semicolon
r_int
id|ip6_mc_del_src
c_func
(paren
r_struct
id|inet6_dev
op_star
id|idev
comma
r_struct
id|in6_addr
op_star
id|pmca
comma
r_int
id|sfmode
comma
r_int
id|sfcount
comma
r_struct
id|in6_addr
op_star
id|psfsrc
comma
r_int
id|delta
)paren
suffix:semicolon
r_int
id|ip6_mc_add_src
c_func
(paren
r_struct
id|inet6_dev
op_star
id|idev
comma
r_struct
id|in6_addr
op_star
id|pmca
comma
r_int
id|sfmode
comma
r_int
id|sfcount
comma
r_struct
id|in6_addr
op_star
id|psfsrc
comma
r_int
id|delta
)paren
suffix:semicolon
r_int
id|ip6_mc_leave_src
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_struct
id|ipv6_mc_socklist
op_star
id|iml
comma
r_struct
id|inet6_dev
op_star
id|idev
)paren
suffix:semicolon
DECL|macro|IGMP6_UNSOLICITED_IVAL
mdefine_line|#define IGMP6_UNSOLICITED_IVAL&t;(10*HZ)
DECL|macro|MLD_QRV_DEFAULT
mdefine_line|#define MLD_QRV_DEFAULT&t;&t;2
DECL|macro|MLD_V1_SEEN
mdefine_line|#define MLD_V1_SEEN(idev) (ipv6_devconf.force_mld_version == 1 || &bslash;&n;&t;&t;(idev)-&gt;cnf.force_mld_version == 1 || &bslash;&n;&t;&t;((idev)-&gt;mc_v1_seen &amp;&amp; &bslash;&n;&t;&t;time_before(jiffies, (idev)-&gt;mc_v1_seen)))
DECL|macro|MLDV2_MASK
mdefine_line|#define MLDV2_MASK(value, nb) ((nb)&gt;=32 ? (value) : ((1&lt;&lt;(nb))-1) &amp; (value))
DECL|macro|MLDV2_EXP
mdefine_line|#define MLDV2_EXP(thresh, nbmant, nbexp, value) &bslash;&n;&t;((value) &lt; (thresh) ? (value) : &bslash;&n;&t;((MLDV2_MASK(value, nbmant) | (1&lt;&lt;(nbmant+nbexp))) &lt;&lt; &bslash;&n;&t;(MLDV2_MASK((value) &gt;&gt; (nbmant), nbexp) + (nbexp))))
DECL|macro|MLDV2_QQIC
mdefine_line|#define MLDV2_QQIC(value) MLDV2_EXP(0x80, 4, 3, value)
DECL|macro|MLDV2_MRC
mdefine_line|#define MLDV2_MRC(value) MLDV2_EXP(0x8000, 12, 3, value)
DECL|macro|IPV6_MLD_MAX_MSF
mdefine_line|#define IPV6_MLD_MAX_MSF&t;10
DECL|variable|sysctl_mld_max_msf
r_int
id|sysctl_mld_max_msf
op_assign
id|IPV6_MLD_MAX_MSF
suffix:semicolon
multiline_comment|/*&n; *&t;socket join on multicast group&n; */
DECL|function|ipv6_sock_mc_join
r_int
id|ipv6_sock_mc_join
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_int
id|ifindex
comma
r_struct
id|in6_addr
op_star
id|addr
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|ipv6_mc_socklist
op_star
id|mc_lst
suffix:semicolon
r_struct
id|ipv6_pinfo
op_star
id|np
op_assign
id|inet6_sk
c_func
(paren
id|sk
)paren
suffix:semicolon
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ipv6_addr_is_multicast
c_func
(paren
id|addr
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|mc_lst
op_assign
id|sock_kmalloc
c_func
(paren
id|sk
comma
r_sizeof
(paren
r_struct
id|ipv6_mc_socklist
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mc_lst
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|mc_lst-&gt;next
op_assign
l_int|NULL
suffix:semicolon
id|ipv6_addr_copy
c_func
(paren
op_amp
id|mc_lst-&gt;addr
comma
id|addr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ifindex
op_eq
l_int|0
)paren
(brace
r_struct
id|rt6_info
op_star
id|rt
suffix:semicolon
id|rt
op_assign
id|rt6_lookup
c_func
(paren
id|addr
comma
l_int|NULL
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rt
)paren
(brace
id|dev
op_assign
id|rt-&gt;rt6i_dev
suffix:semicolon
id|dev_hold
c_func
(paren
id|dev
)paren
suffix:semicolon
id|dst_release
c_func
(paren
op_amp
id|rt-&gt;u.dst
)paren
suffix:semicolon
)brace
)brace
r_else
id|dev
op_assign
id|dev_get_by_index
c_func
(paren
id|ifindex
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev
op_eq
l_int|NULL
)paren
(brace
id|sock_kfree_s
c_func
(paren
id|sk
comma
id|mc_lst
comma
r_sizeof
(paren
op_star
id|mc_lst
)paren
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|mc_lst-&gt;ifindex
op_assign
id|dev-&gt;ifindex
suffix:semicolon
id|mc_lst-&gt;sfmode
op_assign
id|MCAST_EXCLUDE
suffix:semicolon
id|mc_lst-&gt;sflist
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/*&n;&t; *&t;now add/increase the group membership on the device&n;&t; */
id|err
op_assign
id|ipv6_dev_mc_inc
c_func
(paren
id|dev
comma
id|addr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|sock_kfree_s
c_func
(paren
id|sk
comma
id|mc_lst
comma
r_sizeof
(paren
op_star
id|mc_lst
)paren
)paren
suffix:semicolon
id|dev_put
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
id|write_lock_bh
c_func
(paren
op_amp
id|ipv6_sk_mc_lock
)paren
suffix:semicolon
id|mc_lst-&gt;next
op_assign
id|np-&gt;ipv6_mc_list
suffix:semicolon
id|np-&gt;ipv6_mc_list
op_assign
id|mc_lst
suffix:semicolon
id|write_unlock_bh
c_func
(paren
op_amp
id|ipv6_sk_mc_lock
)paren
suffix:semicolon
id|dev_put
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;socket leave on multicast group&n; */
DECL|function|ipv6_sock_mc_drop
r_int
id|ipv6_sock_mc_drop
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_int
id|ifindex
comma
r_struct
id|in6_addr
op_star
id|addr
)paren
(brace
r_struct
id|ipv6_pinfo
op_star
id|np
op_assign
id|inet6_sk
c_func
(paren
id|sk
)paren
suffix:semicolon
r_struct
id|ipv6_mc_socklist
op_star
id|mc_lst
comma
op_star
op_star
id|lnk
suffix:semicolon
id|write_lock_bh
c_func
(paren
op_amp
id|ipv6_sk_mc_lock
)paren
suffix:semicolon
r_for
c_loop
(paren
id|lnk
op_assign
op_amp
id|np-&gt;ipv6_mc_list
suffix:semicolon
(paren
id|mc_lst
op_assign
op_star
id|lnk
)paren
op_ne
l_int|NULL
suffix:semicolon
id|lnk
op_assign
op_amp
id|mc_lst-&gt;next
)paren
(brace
r_if
c_cond
(paren
(paren
id|ifindex
op_eq
l_int|0
op_logical_or
id|mc_lst-&gt;ifindex
op_eq
id|ifindex
)paren
op_logical_and
id|ipv6_addr_equal
c_func
(paren
op_amp
id|mc_lst-&gt;addr
comma
id|addr
)paren
)paren
(brace
r_struct
id|net_device
op_star
id|dev
suffix:semicolon
op_star
id|lnk
op_assign
id|mc_lst-&gt;next
suffix:semicolon
id|write_unlock_bh
c_func
(paren
op_amp
id|ipv6_sk_mc_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|dev
op_assign
id|dev_get_by_index
c_func
(paren
id|mc_lst-&gt;ifindex
)paren
)paren
op_ne
l_int|NULL
)paren
(brace
r_struct
id|inet6_dev
op_star
id|idev
op_assign
id|in6_dev_get
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|idev
)paren
(brace
(paren
r_void
)paren
id|ip6_mc_leave_src
c_func
(paren
id|sk
comma
id|mc_lst
comma
id|idev
)paren
suffix:semicolon
id|__ipv6_dev_mc_dec
c_func
(paren
id|idev
comma
op_amp
id|mc_lst-&gt;addr
)paren
suffix:semicolon
id|in6_dev_put
c_func
(paren
id|idev
)paren
suffix:semicolon
)brace
id|dev_put
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
id|sock_kfree_s
c_func
(paren
id|sk
comma
id|mc_lst
comma
r_sizeof
(paren
op_star
id|mc_lst
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
id|write_unlock_bh
c_func
(paren
op_amp
id|ipv6_sk_mc_lock
)paren
suffix:semicolon
r_return
op_minus
id|ENOENT
suffix:semicolon
)brace
DECL|function|ip6_mc_find_dev
r_struct
id|inet6_dev
op_star
id|ip6_mc_find_dev
c_func
(paren
r_struct
id|in6_addr
op_star
id|group
comma
r_int
id|ifindex
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|inet6_dev
op_star
id|idev
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|ifindex
op_eq
l_int|0
)paren
(brace
r_struct
id|rt6_info
op_star
id|rt
suffix:semicolon
id|rt
op_assign
id|rt6_lookup
c_func
(paren
id|group
comma
l_int|NULL
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rt
)paren
(brace
id|dev
op_assign
id|rt-&gt;rt6i_dev
suffix:semicolon
id|dev_hold
c_func
(paren
id|dev
)paren
suffix:semicolon
id|dst_release
c_func
(paren
op_amp
id|rt-&gt;u.dst
)paren
suffix:semicolon
)brace
)brace
r_else
id|dev
op_assign
id|dev_get_by_index
c_func
(paren
id|ifindex
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev
)paren
r_return
l_int|NULL
suffix:semicolon
id|idev
op_assign
id|in6_dev_get
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|idev
)paren
(brace
id|dev_put
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|read_lock_bh
c_func
(paren
op_amp
id|idev-&gt;lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|idev-&gt;dead
)paren
(brace
id|read_unlock_bh
c_func
(paren
op_amp
id|idev-&gt;lock
)paren
suffix:semicolon
id|in6_dev_put
c_func
(paren
id|idev
)paren
suffix:semicolon
id|dev_put
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
r_return
id|idev
suffix:semicolon
)brace
DECL|function|ipv6_sock_mc_close
r_void
id|ipv6_sock_mc_close
c_func
(paren
r_struct
id|sock
op_star
id|sk
)paren
(brace
r_struct
id|ipv6_pinfo
op_star
id|np
op_assign
id|inet6_sk
c_func
(paren
id|sk
)paren
suffix:semicolon
r_struct
id|ipv6_mc_socklist
op_star
id|mc_lst
suffix:semicolon
id|write_lock_bh
c_func
(paren
op_amp
id|ipv6_sk_mc_lock
)paren
suffix:semicolon
r_while
c_loop
(paren
(paren
id|mc_lst
op_assign
id|np-&gt;ipv6_mc_list
)paren
op_ne
l_int|NULL
)paren
(brace
r_struct
id|net_device
op_star
id|dev
suffix:semicolon
id|np-&gt;ipv6_mc_list
op_assign
id|mc_lst-&gt;next
suffix:semicolon
id|write_unlock_bh
c_func
(paren
op_amp
id|ipv6_sk_mc_lock
)paren
suffix:semicolon
id|dev
op_assign
id|dev_get_by_index
c_func
(paren
id|mc_lst-&gt;ifindex
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev
)paren
(brace
r_struct
id|inet6_dev
op_star
id|idev
op_assign
id|in6_dev_get
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|idev
)paren
(brace
(paren
r_void
)paren
id|ip6_mc_leave_src
c_func
(paren
id|sk
comma
id|mc_lst
comma
id|idev
)paren
suffix:semicolon
id|__ipv6_dev_mc_dec
c_func
(paren
id|idev
comma
op_amp
id|mc_lst-&gt;addr
)paren
suffix:semicolon
id|in6_dev_put
c_func
(paren
id|idev
)paren
suffix:semicolon
)brace
id|dev_put
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
id|sock_kfree_s
c_func
(paren
id|sk
comma
id|mc_lst
comma
r_sizeof
(paren
op_star
id|mc_lst
)paren
)paren
suffix:semicolon
id|write_lock_bh
c_func
(paren
op_amp
id|ipv6_sk_mc_lock
)paren
suffix:semicolon
)brace
id|write_unlock_bh
c_func
(paren
op_amp
id|ipv6_sk_mc_lock
)paren
suffix:semicolon
)brace
DECL|function|ip6_mc_source
r_int
id|ip6_mc_source
c_func
(paren
r_int
id|add
comma
r_int
id|omode
comma
r_struct
id|sock
op_star
id|sk
comma
r_struct
id|group_source_req
op_star
id|pgsr
)paren
(brace
r_struct
id|in6_addr
op_star
id|source
comma
op_star
id|group
suffix:semicolon
r_struct
id|ipv6_mc_socklist
op_star
id|pmc
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
suffix:semicolon
r_struct
id|inet6_dev
op_star
id|idev
suffix:semicolon
r_struct
id|ipv6_pinfo
op_star
id|inet6
op_assign
id|inet6_sk
c_func
(paren
id|sk
)paren
suffix:semicolon
r_struct
id|ip6_sf_socklist
op_star
id|psl
suffix:semicolon
r_int
id|i
comma
id|j
comma
id|rv
suffix:semicolon
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
id|pgsr-&gt;gsr_group.ss_family
op_ne
id|AF_INET6
op_logical_or
id|pgsr-&gt;gsr_source.ss_family
op_ne
id|AF_INET6
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|source
op_assign
op_amp
(paren
(paren
r_struct
id|sockaddr_in6
op_star
)paren
op_amp
id|pgsr-&gt;gsr_source
)paren
op_member_access_from_pointer
id|sin6_addr
suffix:semicolon
id|group
op_assign
op_amp
(paren
(paren
r_struct
id|sockaddr_in6
op_star
)paren
op_amp
id|pgsr-&gt;gsr_group
)paren
op_member_access_from_pointer
id|sin6_addr
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ipv6_addr_is_multicast
c_func
(paren
id|group
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|idev
op_assign
id|ip6_mc_find_dev
c_func
(paren
id|group
comma
id|pgsr-&gt;gsr_interface
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|idev
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|dev
op_assign
id|idev-&gt;dev
suffix:semicolon
id|err
op_assign
op_minus
id|EADDRNOTAVAIL
suffix:semicolon
r_for
c_loop
(paren
id|pmc
op_assign
id|inet6-&gt;ipv6_mc_list
suffix:semicolon
id|pmc
suffix:semicolon
id|pmc
op_assign
id|pmc-&gt;next
)paren
(brace
r_if
c_cond
(paren
id|pgsr-&gt;gsr_interface
op_logical_and
id|pmc-&gt;ifindex
op_ne
id|pgsr-&gt;gsr_interface
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|ipv6_addr_equal
c_func
(paren
op_amp
id|pmc-&gt;addr
comma
id|group
)paren
)paren
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|pmc
)paren
multiline_comment|/* must have a prior join */
r_goto
id|done
suffix:semicolon
multiline_comment|/* if a source filter was set, must be the same mode as before */
r_if
c_cond
(paren
id|pmc-&gt;sflist
)paren
(brace
r_if
c_cond
(paren
id|pmc-&gt;sfmode
op_ne
id|omode
)paren
r_goto
id|done
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|pmc-&gt;sfmode
op_ne
id|omode
)paren
(brace
multiline_comment|/* allow mode switches for empty-set filters */
id|ip6_mc_add_src
c_func
(paren
id|idev
comma
id|group
comma
id|omode
comma
l_int|0
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
id|ip6_mc_del_src
c_func
(paren
id|idev
comma
id|group
comma
id|pmc-&gt;sfmode
comma
l_int|0
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
id|pmc-&gt;sfmode
op_assign
id|omode
suffix:semicolon
)brace
id|psl
op_assign
id|pmc-&gt;sflist
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|add
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|psl
)paren
r_goto
id|done
suffix:semicolon
id|rv
op_assign
op_logical_neg
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|psl-&gt;sl_count
suffix:semicolon
id|i
op_increment
)paren
(brace
id|rv
op_assign
id|memcmp
c_func
(paren
op_amp
id|psl-&gt;sl_addr
(braket
id|i
)braket
comma
id|source
comma
r_sizeof
(paren
r_struct
id|in6_addr
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rv
op_eq
l_int|0
)paren
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|rv
)paren
multiline_comment|/* source not found */
r_goto
id|done
suffix:semicolon
multiline_comment|/* update the interface filter */
id|ip6_mc_del_src
c_func
(paren
id|idev
comma
id|group
comma
id|omode
comma
l_int|1
comma
id|source
comma
l_int|1
)paren
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
id|i
op_plus
l_int|1
suffix:semicolon
id|j
OL
id|psl-&gt;sl_count
suffix:semicolon
id|j
op_increment
)paren
id|psl-&gt;sl_addr
(braket
id|j
op_minus
l_int|1
)braket
op_assign
id|psl-&gt;sl_addr
(braket
id|j
)braket
suffix:semicolon
id|psl-&gt;sl_count
op_decrement
suffix:semicolon
id|err
op_assign
l_int|0
suffix:semicolon
r_goto
id|done
suffix:semicolon
)brace
multiline_comment|/* else, add a new source to the filter */
r_if
c_cond
(paren
id|psl
op_logical_and
id|psl-&gt;sl_count
op_ge
id|sysctl_mld_max_msf
)paren
(brace
id|err
op_assign
op_minus
id|ENOBUFS
suffix:semicolon
r_goto
id|done
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|psl
op_logical_or
id|psl-&gt;sl_count
op_eq
id|psl-&gt;sl_max
)paren
(brace
r_struct
id|ip6_sf_socklist
op_star
id|newpsl
suffix:semicolon
r_int
id|count
op_assign
id|IP6_SFBLOCK
suffix:semicolon
r_if
c_cond
(paren
id|psl
)paren
id|count
op_add_assign
id|psl-&gt;sl_max
suffix:semicolon
id|newpsl
op_assign
(paren
r_struct
id|ip6_sf_socklist
op_star
)paren
id|sock_kmalloc
c_func
(paren
id|sk
comma
id|IP6_SFLSIZE
c_func
(paren
id|count
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|newpsl
)paren
(brace
id|err
op_assign
op_minus
id|ENOBUFS
suffix:semicolon
r_goto
id|done
suffix:semicolon
)brace
id|newpsl-&gt;sl_max
op_assign
id|count
suffix:semicolon
id|newpsl-&gt;sl_count
op_assign
id|count
op_minus
id|IP6_SFBLOCK
suffix:semicolon
r_if
c_cond
(paren
id|psl
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|psl-&gt;sl_count
suffix:semicolon
id|i
op_increment
)paren
id|newpsl-&gt;sl_addr
(braket
id|i
)braket
op_assign
id|psl-&gt;sl_addr
(braket
id|i
)braket
suffix:semicolon
id|sock_kfree_s
c_func
(paren
id|sk
comma
id|psl
comma
id|IP6_SFLSIZE
c_func
(paren
id|psl-&gt;sl_max
)paren
)paren
suffix:semicolon
)brace
id|pmc-&gt;sflist
op_assign
id|psl
op_assign
id|newpsl
suffix:semicolon
)brace
id|rv
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* &gt; 0 for insert logic below if sl_count is 0 */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|psl-&gt;sl_count
suffix:semicolon
id|i
op_increment
)paren
(brace
id|rv
op_assign
id|memcmp
c_func
(paren
op_amp
id|psl-&gt;sl_addr
(braket
id|i
)braket
comma
id|source
comma
r_sizeof
(paren
r_struct
id|in6_addr
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rv
op_eq
l_int|0
)paren
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|rv
op_eq
l_int|0
)paren
multiline_comment|/* address already there is an error */
r_goto
id|done
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
id|psl-&gt;sl_count
op_minus
l_int|1
suffix:semicolon
id|j
op_ge
id|i
suffix:semicolon
id|j
op_decrement
)paren
id|psl-&gt;sl_addr
(braket
id|j
op_plus
l_int|1
)braket
op_assign
id|psl-&gt;sl_addr
(braket
id|j
)braket
suffix:semicolon
id|psl-&gt;sl_addr
(braket
id|i
)braket
op_assign
op_star
id|source
suffix:semicolon
id|psl-&gt;sl_count
op_increment
suffix:semicolon
id|err
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* update the interface list */
id|ip6_mc_add_src
c_func
(paren
id|idev
comma
id|group
comma
id|omode
comma
l_int|1
comma
id|source
comma
l_int|1
)paren
suffix:semicolon
id|done
suffix:colon
id|read_unlock_bh
c_func
(paren
op_amp
id|idev-&gt;lock
)paren
suffix:semicolon
id|in6_dev_put
c_func
(paren
id|idev
)paren
suffix:semicolon
id|dev_put
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|ip6_mc_msfilter
r_int
id|ip6_mc_msfilter
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_struct
id|group_filter
op_star
id|gsf
)paren
(brace
r_struct
id|in6_addr
op_star
id|group
suffix:semicolon
r_struct
id|ipv6_mc_socklist
op_star
id|pmc
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
suffix:semicolon
r_struct
id|inet6_dev
op_star
id|idev
suffix:semicolon
r_struct
id|ipv6_pinfo
op_star
id|inet6
op_assign
id|inet6_sk
c_func
(paren
id|sk
)paren
suffix:semicolon
r_struct
id|ip6_sf_socklist
op_star
id|newpsl
comma
op_star
id|psl
suffix:semicolon
r_int
id|i
comma
id|err
suffix:semicolon
id|group
op_assign
op_amp
(paren
(paren
r_struct
id|sockaddr_in6
op_star
)paren
op_amp
id|gsf-&gt;gf_group
)paren
op_member_access_from_pointer
id|sin6_addr
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ipv6_addr_is_multicast
c_func
(paren
id|group
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|gsf-&gt;gf_fmode
op_ne
id|MCAST_INCLUDE
op_logical_and
id|gsf-&gt;gf_fmode
op_ne
id|MCAST_EXCLUDE
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|idev
op_assign
id|ip6_mc_find_dev
c_func
(paren
id|group
comma
id|gsf-&gt;gf_interface
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|idev
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|dev
op_assign
id|idev-&gt;dev
suffix:semicolon
id|err
op_assign
op_minus
id|EADDRNOTAVAIL
suffix:semicolon
r_for
c_loop
(paren
id|pmc
op_assign
id|inet6-&gt;ipv6_mc_list
suffix:semicolon
id|pmc
suffix:semicolon
id|pmc
op_assign
id|pmc-&gt;next
)paren
(brace
r_if
c_cond
(paren
id|pmc-&gt;ifindex
op_ne
id|gsf-&gt;gf_interface
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|ipv6_addr_equal
c_func
(paren
op_amp
id|pmc-&gt;addr
comma
id|group
)paren
)paren
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|pmc
)paren
multiline_comment|/* must have a prior join */
r_goto
id|done
suffix:semicolon
r_if
c_cond
(paren
id|gsf-&gt;gf_numsrc
)paren
(brace
id|newpsl
op_assign
(paren
r_struct
id|ip6_sf_socklist
op_star
)paren
id|sock_kmalloc
c_func
(paren
id|sk
comma
id|IP6_SFLSIZE
c_func
(paren
id|gsf-&gt;gf_numsrc
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|newpsl
)paren
(brace
id|err
op_assign
op_minus
id|ENOBUFS
suffix:semicolon
r_goto
id|done
suffix:semicolon
)brace
id|newpsl-&gt;sl_max
op_assign
id|newpsl-&gt;sl_count
op_assign
id|gsf-&gt;gf_numsrc
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|newpsl-&gt;sl_count
suffix:semicolon
op_increment
id|i
)paren
(brace
r_struct
id|sockaddr_in6
op_star
id|psin6
suffix:semicolon
id|psin6
op_assign
(paren
r_struct
id|sockaddr_in6
op_star
)paren
op_amp
id|gsf-&gt;gf_slist
(braket
id|i
)braket
suffix:semicolon
id|newpsl-&gt;sl_addr
(braket
id|i
)braket
op_assign
id|psin6-&gt;sin6_addr
suffix:semicolon
)brace
id|err
op_assign
id|ip6_mc_add_src
c_func
(paren
id|idev
comma
id|group
comma
id|gsf-&gt;gf_fmode
comma
id|newpsl-&gt;sl_count
comma
id|newpsl-&gt;sl_addr
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|sock_kfree_s
c_func
(paren
id|sk
comma
id|newpsl
comma
id|IP6_SFLSIZE
c_func
(paren
id|newpsl-&gt;sl_max
)paren
)paren
suffix:semicolon
r_goto
id|done
suffix:semicolon
)brace
)brace
r_else
id|newpsl
op_assign
l_int|NULL
suffix:semicolon
id|psl
op_assign
id|pmc-&gt;sflist
suffix:semicolon
r_if
c_cond
(paren
id|psl
)paren
(brace
(paren
r_void
)paren
id|ip6_mc_del_src
c_func
(paren
id|idev
comma
id|group
comma
id|pmc-&gt;sfmode
comma
id|psl-&gt;sl_count
comma
id|psl-&gt;sl_addr
comma
l_int|0
)paren
suffix:semicolon
id|sock_kfree_s
c_func
(paren
id|sk
comma
id|psl
comma
id|IP6_SFLSIZE
c_func
(paren
id|psl-&gt;sl_max
)paren
)paren
suffix:semicolon
)brace
r_else
(paren
r_void
)paren
id|ip6_mc_del_src
c_func
(paren
id|idev
comma
id|group
comma
id|pmc-&gt;sfmode
comma
l_int|0
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
id|pmc-&gt;sflist
op_assign
id|newpsl
suffix:semicolon
id|pmc-&gt;sfmode
op_assign
id|gsf-&gt;gf_fmode
suffix:semicolon
id|done
suffix:colon
id|read_unlock_bh
c_func
(paren
op_amp
id|idev-&gt;lock
)paren
suffix:semicolon
id|in6_dev_put
c_func
(paren
id|idev
)paren
suffix:semicolon
id|dev_put
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|ip6_mc_msfget
r_int
id|ip6_mc_msfget
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_struct
id|group_filter
op_star
id|gsf
comma
r_struct
id|group_filter
id|__user
op_star
id|optval
comma
r_int
id|__user
op_star
id|optlen
)paren
(brace
r_int
id|err
comma
id|i
comma
id|count
comma
id|copycount
suffix:semicolon
r_struct
id|in6_addr
op_star
id|group
suffix:semicolon
r_struct
id|ipv6_mc_socklist
op_star
id|pmc
suffix:semicolon
r_struct
id|inet6_dev
op_star
id|idev
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
suffix:semicolon
r_struct
id|ipv6_pinfo
op_star
id|inet6
op_assign
id|inet6_sk
c_func
(paren
id|sk
)paren
suffix:semicolon
r_struct
id|ip6_sf_socklist
op_star
id|psl
suffix:semicolon
id|group
op_assign
op_amp
(paren
(paren
r_struct
id|sockaddr_in6
op_star
)paren
op_amp
id|gsf-&gt;gf_group
)paren
op_member_access_from_pointer
id|sin6_addr
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ipv6_addr_is_multicast
c_func
(paren
id|group
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|idev
op_assign
id|ip6_mc_find_dev
c_func
(paren
id|group
comma
id|gsf-&gt;gf_interface
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|idev
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|dev
op_assign
id|idev-&gt;dev
suffix:semicolon
id|err
op_assign
op_minus
id|EADDRNOTAVAIL
suffix:semicolon
r_for
c_loop
(paren
id|pmc
op_assign
id|inet6-&gt;ipv6_mc_list
suffix:semicolon
id|pmc
suffix:semicolon
id|pmc
op_assign
id|pmc-&gt;next
)paren
(brace
r_if
c_cond
(paren
id|pmc-&gt;ifindex
op_ne
id|gsf-&gt;gf_interface
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|ipv6_addr_equal
c_func
(paren
id|group
comma
op_amp
id|pmc-&gt;addr
)paren
)paren
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|pmc
)paren
multiline_comment|/* must have a prior join */
r_goto
id|done
suffix:semicolon
id|gsf-&gt;gf_fmode
op_assign
id|pmc-&gt;sfmode
suffix:semicolon
id|psl
op_assign
id|pmc-&gt;sflist
suffix:semicolon
id|count
op_assign
id|psl
ques
c_cond
id|psl-&gt;sl_count
suffix:colon
l_int|0
suffix:semicolon
id|read_unlock_bh
c_func
(paren
op_amp
id|idev-&gt;lock
)paren
suffix:semicolon
id|in6_dev_put
c_func
(paren
id|idev
)paren
suffix:semicolon
id|dev_put
c_func
(paren
id|dev
)paren
suffix:semicolon
id|copycount
op_assign
id|count
OL
id|gsf-&gt;gf_numsrc
ques
c_cond
id|count
suffix:colon
id|gsf-&gt;gf_numsrc
suffix:semicolon
id|gsf-&gt;gf_numsrc
op_assign
id|count
suffix:semicolon
r_if
c_cond
(paren
id|put_user
c_func
(paren
id|GROUP_FILTER_SIZE
c_func
(paren
id|copycount
)paren
comma
id|optlen
)paren
op_logical_or
id|copy_to_user
c_func
(paren
id|optval
comma
id|gsf
comma
id|GROUP_FILTER_SIZE
c_func
(paren
l_int|0
)paren
)paren
)paren
(brace
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|copycount
suffix:semicolon
id|i
op_increment
)paren
(brace
r_struct
id|sockaddr_in6
op_star
id|psin6
suffix:semicolon
r_struct
id|sockaddr_storage
id|ss
suffix:semicolon
id|psin6
op_assign
(paren
r_struct
id|sockaddr_in6
op_star
)paren
op_amp
id|ss
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|ss
comma
l_int|0
comma
r_sizeof
(paren
id|ss
)paren
)paren
suffix:semicolon
id|psin6-&gt;sin6_family
op_assign
id|AF_INET6
suffix:semicolon
id|psin6-&gt;sin6_addr
op_assign
id|psl-&gt;sl_addr
(braket
id|i
)braket
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
op_amp
id|optval-&gt;gf_slist
(braket
id|i
)braket
comma
op_amp
id|ss
comma
r_sizeof
(paren
id|ss
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
id|done
suffix:colon
id|read_unlock_bh
c_func
(paren
op_amp
id|idev-&gt;lock
)paren
suffix:semicolon
id|in6_dev_put
c_func
(paren
id|idev
)paren
suffix:semicolon
id|dev_put
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|inet6_mc_check
r_int
id|inet6_mc_check
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_struct
id|in6_addr
op_star
id|mc_addr
comma
r_struct
id|in6_addr
op_star
id|src_addr
)paren
(brace
r_struct
id|ipv6_pinfo
op_star
id|np
op_assign
id|inet6_sk
c_func
(paren
id|sk
)paren
suffix:semicolon
r_struct
id|ipv6_mc_socklist
op_star
id|mc
suffix:semicolon
r_struct
id|ip6_sf_socklist
op_star
id|psl
suffix:semicolon
r_int
id|rv
op_assign
l_int|1
suffix:semicolon
id|read_lock
c_func
(paren
op_amp
id|ipv6_sk_mc_lock
)paren
suffix:semicolon
r_for
c_loop
(paren
id|mc
op_assign
id|np-&gt;ipv6_mc_list
suffix:semicolon
id|mc
suffix:semicolon
id|mc
op_assign
id|mc-&gt;next
)paren
(brace
r_if
c_cond
(paren
id|ipv6_addr_equal
c_func
(paren
op_amp
id|mc-&gt;addr
comma
id|mc_addr
)paren
)paren
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|mc
)paren
(brace
id|read_unlock
c_func
(paren
op_amp
id|ipv6_sk_mc_lock
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|psl
op_assign
id|mc-&gt;sflist
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|psl
)paren
(brace
id|rv
op_assign
id|mc-&gt;sfmode
op_eq
id|MCAST_EXCLUDE
suffix:semicolon
)brace
r_else
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|psl-&gt;sl_count
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|ipv6_addr_equal
c_func
(paren
op_amp
id|psl-&gt;sl_addr
(braket
id|i
)braket
comma
id|src_addr
)paren
)paren
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|mc-&gt;sfmode
op_eq
id|MCAST_INCLUDE
op_logical_and
id|i
op_ge
id|psl-&gt;sl_count
)paren
id|rv
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|mc-&gt;sfmode
op_eq
id|MCAST_EXCLUDE
op_logical_and
id|i
OL
id|psl-&gt;sl_count
)paren
id|rv
op_assign
l_int|0
suffix:semicolon
)brace
id|read_unlock
c_func
(paren
op_amp
id|ipv6_sk_mc_lock
)paren
suffix:semicolon
r_return
id|rv
suffix:semicolon
)brace
DECL|function|ma_put
r_static
r_void
id|ma_put
c_func
(paren
r_struct
id|ifmcaddr6
op_star
id|mc
)paren
(brace
r_if
c_cond
(paren
id|atomic_dec_and_test
c_func
(paren
op_amp
id|mc-&gt;mca_refcnt
)paren
)paren
(brace
id|in6_dev_put
c_func
(paren
id|mc-&gt;idev
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|mc
)paren
suffix:semicolon
)brace
)brace
DECL|function|igmp6_group_added
r_static
r_void
id|igmp6_group_added
c_func
(paren
r_struct
id|ifmcaddr6
op_star
id|mc
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
id|mc-&gt;idev-&gt;dev
suffix:semicolon
r_char
id|buf
(braket
id|MAX_ADDR_LEN
)braket
suffix:semicolon
id|spin_lock_bh
c_func
(paren
op_amp
id|mc-&gt;mca_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|mc-&gt;mca_flags
op_amp
id|MAF_LOADED
)paren
)paren
(brace
id|mc-&gt;mca_flags
op_or_assign
id|MAF_LOADED
suffix:semicolon
r_if
c_cond
(paren
id|ndisc_mc_map
c_func
(paren
op_amp
id|mc-&gt;mca_addr
comma
id|buf
comma
id|dev
comma
l_int|0
)paren
op_eq
l_int|0
)paren
id|dev_mc_add
c_func
(paren
id|dev
comma
id|buf
comma
id|dev-&gt;addr_len
comma
l_int|0
)paren
suffix:semicolon
)brace
id|spin_unlock_bh
c_func
(paren
op_amp
id|mc-&gt;mca_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|dev-&gt;flags
op_amp
id|IFF_UP
)paren
op_logical_or
(paren
id|mc-&gt;mca_flags
op_amp
id|MAF_NOREPORT
)paren
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|MLD_V1_SEEN
c_func
(paren
id|mc-&gt;idev
)paren
)paren
(brace
id|igmp6_join_group
c_func
(paren
id|mc
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/* else v2 */
id|mc-&gt;mca_crcount
op_assign
id|mc-&gt;idev-&gt;mc_qrv
suffix:semicolon
id|mld_ifc_event
c_func
(paren
id|mc-&gt;idev
)paren
suffix:semicolon
)brace
DECL|function|igmp6_group_dropped
r_static
r_void
id|igmp6_group_dropped
c_func
(paren
r_struct
id|ifmcaddr6
op_star
id|mc
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
id|mc-&gt;idev-&gt;dev
suffix:semicolon
r_char
id|buf
(braket
id|MAX_ADDR_LEN
)braket
suffix:semicolon
id|spin_lock_bh
c_func
(paren
op_amp
id|mc-&gt;mca_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mc-&gt;mca_flags
op_amp
id|MAF_LOADED
)paren
(brace
id|mc-&gt;mca_flags
op_and_assign
op_complement
id|MAF_LOADED
suffix:semicolon
r_if
c_cond
(paren
id|ndisc_mc_map
c_func
(paren
op_amp
id|mc-&gt;mca_addr
comma
id|buf
comma
id|dev
comma
l_int|0
)paren
op_eq
l_int|0
)paren
id|dev_mc_delete
c_func
(paren
id|dev
comma
id|buf
comma
id|dev-&gt;addr_len
comma
l_int|0
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|mc-&gt;mca_flags
op_amp
id|MAF_NOREPORT
)paren
r_goto
id|done
suffix:semicolon
id|spin_unlock_bh
c_func
(paren
op_amp
id|mc-&gt;mca_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|mc-&gt;idev-&gt;dead
)paren
id|igmp6_leave_group
c_func
(paren
id|mc
)paren
suffix:semicolon
id|spin_lock_bh
c_func
(paren
op_amp
id|mc-&gt;mca_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|del_timer
c_func
(paren
op_amp
id|mc-&gt;mca_timer
)paren
)paren
id|atomic_dec
c_func
(paren
op_amp
id|mc-&gt;mca_refcnt
)paren
suffix:semicolon
id|done
suffix:colon
id|ip6_mc_clear_src
c_func
(paren
id|mc
)paren
suffix:semicolon
id|spin_unlock_bh
c_func
(paren
op_amp
id|mc-&gt;mca_lock
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * deleted ifmcaddr6 manipulation&n; */
DECL|function|mld_add_delrec
r_static
r_void
id|mld_add_delrec
c_func
(paren
r_struct
id|inet6_dev
op_star
id|idev
comma
r_struct
id|ifmcaddr6
op_star
id|im
)paren
(brace
r_struct
id|ifmcaddr6
op_star
id|pmc
suffix:semicolon
multiline_comment|/* this is an &quot;ifmcaddr6&quot; for convenience; only the fields below&n;&t; * are actually used. In particular, the refcnt and users are not&n;&t; * used for management of the delete list. Using the same structure&n;&t; * for deleted items allows change reports to use common code with&n;&t; * non-deleted or query-response MCA&squot;s.&n;&t; */
id|pmc
op_assign
(paren
r_struct
id|ifmcaddr6
op_star
)paren
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|pmc
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pmc
)paren
r_return
suffix:semicolon
id|memset
c_func
(paren
id|pmc
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|pmc
)paren
)paren
suffix:semicolon
id|spin_lock_bh
c_func
(paren
op_amp
id|im-&gt;mca_lock
)paren
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|pmc-&gt;mca_lock
)paren
suffix:semicolon
id|pmc-&gt;idev
op_assign
id|im-&gt;idev
suffix:semicolon
id|in6_dev_hold
c_func
(paren
id|idev
)paren
suffix:semicolon
id|pmc-&gt;mca_addr
op_assign
id|im-&gt;mca_addr
suffix:semicolon
id|pmc-&gt;mca_crcount
op_assign
id|idev-&gt;mc_qrv
suffix:semicolon
id|pmc-&gt;mca_sfmode
op_assign
id|im-&gt;mca_sfmode
suffix:semicolon
r_if
c_cond
(paren
id|pmc-&gt;mca_sfmode
op_eq
id|MCAST_INCLUDE
)paren
(brace
r_struct
id|ip6_sf_list
op_star
id|psf
suffix:semicolon
id|pmc-&gt;mca_tomb
op_assign
id|im-&gt;mca_tomb
suffix:semicolon
id|pmc-&gt;mca_sources
op_assign
id|im-&gt;mca_sources
suffix:semicolon
id|im-&gt;mca_tomb
op_assign
id|im-&gt;mca_sources
op_assign
l_int|NULL
suffix:semicolon
r_for
c_loop
(paren
id|psf
op_assign
id|pmc-&gt;mca_sources
suffix:semicolon
id|psf
suffix:semicolon
id|psf
op_assign
id|psf-&gt;sf_next
)paren
id|psf-&gt;sf_crcount
op_assign
id|pmc-&gt;mca_crcount
suffix:semicolon
)brace
id|spin_unlock_bh
c_func
(paren
op_amp
id|im-&gt;mca_lock
)paren
suffix:semicolon
id|write_lock_bh
c_func
(paren
op_amp
id|idev-&gt;mc_lock
)paren
suffix:semicolon
id|pmc-&gt;next
op_assign
id|idev-&gt;mc_tomb
suffix:semicolon
id|idev-&gt;mc_tomb
op_assign
id|pmc
suffix:semicolon
id|write_unlock_bh
c_func
(paren
op_amp
id|idev-&gt;mc_lock
)paren
suffix:semicolon
)brace
DECL|function|mld_del_delrec
r_static
r_void
id|mld_del_delrec
c_func
(paren
r_struct
id|inet6_dev
op_star
id|idev
comma
r_struct
id|in6_addr
op_star
id|pmca
)paren
(brace
r_struct
id|ifmcaddr6
op_star
id|pmc
comma
op_star
id|pmc_prev
suffix:semicolon
r_struct
id|ip6_sf_list
op_star
id|psf
comma
op_star
id|psf_next
suffix:semicolon
id|write_lock_bh
c_func
(paren
op_amp
id|idev-&gt;mc_lock
)paren
suffix:semicolon
id|pmc_prev
op_assign
l_int|NULL
suffix:semicolon
r_for
c_loop
(paren
id|pmc
op_assign
id|idev-&gt;mc_tomb
suffix:semicolon
id|pmc
suffix:semicolon
id|pmc
op_assign
id|pmc-&gt;next
)paren
(brace
r_if
c_cond
(paren
id|ipv6_addr_equal
c_func
(paren
op_amp
id|pmc-&gt;mca_addr
comma
id|pmca
)paren
)paren
r_break
suffix:semicolon
id|pmc_prev
op_assign
id|pmc
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pmc
)paren
(brace
r_if
c_cond
(paren
id|pmc_prev
)paren
id|pmc_prev-&gt;next
op_assign
id|pmc-&gt;next
suffix:semicolon
r_else
id|idev-&gt;mc_tomb
op_assign
id|pmc-&gt;next
suffix:semicolon
)brace
id|write_unlock_bh
c_func
(paren
op_amp
id|idev-&gt;mc_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pmc
)paren
(brace
r_for
c_loop
(paren
id|psf
op_assign
id|pmc-&gt;mca_tomb
suffix:semicolon
id|psf
suffix:semicolon
id|psf
op_assign
id|psf_next
)paren
(brace
id|psf_next
op_assign
id|psf-&gt;sf_next
suffix:semicolon
id|kfree
c_func
(paren
id|psf
)paren
suffix:semicolon
)brace
id|in6_dev_put
c_func
(paren
id|pmc-&gt;idev
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|pmc
)paren
suffix:semicolon
)brace
)brace
DECL|function|mld_clear_delrec
r_static
r_void
id|mld_clear_delrec
c_func
(paren
r_struct
id|inet6_dev
op_star
id|idev
)paren
(brace
r_struct
id|ifmcaddr6
op_star
id|pmc
comma
op_star
id|nextpmc
suffix:semicolon
id|write_lock_bh
c_func
(paren
op_amp
id|idev-&gt;mc_lock
)paren
suffix:semicolon
id|pmc
op_assign
id|idev-&gt;mc_tomb
suffix:semicolon
id|idev-&gt;mc_tomb
op_assign
l_int|NULL
suffix:semicolon
id|write_unlock_bh
c_func
(paren
op_amp
id|idev-&gt;mc_lock
)paren
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
id|pmc
suffix:semicolon
id|pmc
op_assign
id|nextpmc
)paren
(brace
id|nextpmc
op_assign
id|pmc-&gt;next
suffix:semicolon
id|ip6_mc_clear_src
c_func
(paren
id|pmc
)paren
suffix:semicolon
id|in6_dev_put
c_func
(paren
id|pmc-&gt;idev
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|pmc
)paren
suffix:semicolon
)brace
multiline_comment|/* clear dead sources, too */
id|read_lock_bh
c_func
(paren
op_amp
id|idev-&gt;lock
)paren
suffix:semicolon
r_for
c_loop
(paren
id|pmc
op_assign
id|idev-&gt;mc_list
suffix:semicolon
id|pmc
suffix:semicolon
id|pmc
op_assign
id|pmc-&gt;next
)paren
(brace
r_struct
id|ip6_sf_list
op_star
id|psf
comma
op_star
id|psf_next
suffix:semicolon
id|spin_lock_bh
c_func
(paren
op_amp
id|pmc-&gt;mca_lock
)paren
suffix:semicolon
id|psf
op_assign
id|pmc-&gt;mca_tomb
suffix:semicolon
id|pmc-&gt;mca_tomb
op_assign
l_int|NULL
suffix:semicolon
id|spin_unlock_bh
c_func
(paren
op_amp
id|pmc-&gt;mca_lock
)paren
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
id|psf
suffix:semicolon
id|psf
op_assign
id|psf_next
)paren
(brace
id|psf_next
op_assign
id|psf-&gt;sf_next
suffix:semicolon
id|kfree
c_func
(paren
id|psf
)paren
suffix:semicolon
)brace
)brace
id|read_unlock_bh
c_func
(paren
op_amp
id|idev-&gt;lock
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;device multicast group inc (add if not found)&n; */
DECL|function|ipv6_dev_mc_inc
r_int
id|ipv6_dev_mc_inc
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|in6_addr
op_star
id|addr
)paren
(brace
r_struct
id|ifmcaddr6
op_star
id|mc
suffix:semicolon
r_struct
id|inet6_dev
op_star
id|idev
suffix:semicolon
id|idev
op_assign
id|in6_dev_get
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|idev
op_eq
l_int|NULL
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|write_lock_bh
c_func
(paren
op_amp
id|idev-&gt;lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|idev-&gt;dead
)paren
(brace
id|write_unlock_bh
c_func
(paren
op_amp
id|idev-&gt;lock
)paren
suffix:semicolon
id|in6_dev_put
c_func
(paren
id|idev
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
r_for
c_loop
(paren
id|mc
op_assign
id|idev-&gt;mc_list
suffix:semicolon
id|mc
suffix:semicolon
id|mc
op_assign
id|mc-&gt;next
)paren
(brace
r_if
c_cond
(paren
id|ipv6_addr_equal
c_func
(paren
op_amp
id|mc-&gt;mca_addr
comma
id|addr
)paren
)paren
(brace
id|mc-&gt;mca_users
op_increment
suffix:semicolon
id|write_unlock_bh
c_func
(paren
op_amp
id|idev-&gt;lock
)paren
suffix:semicolon
id|ip6_mc_add_src
c_func
(paren
id|idev
comma
op_amp
id|mc-&gt;mca_addr
comma
id|MCAST_EXCLUDE
comma
l_int|0
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
id|in6_dev_put
c_func
(paren
id|idev
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
multiline_comment|/*&n;&t; *&t;not found: create a new one.&n;&t; */
id|mc
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|ifmcaddr6
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mc
op_eq
l_int|NULL
)paren
(brace
id|write_unlock_bh
c_func
(paren
op_amp
id|idev-&gt;lock
)paren
suffix:semicolon
id|in6_dev_put
c_func
(paren
id|idev
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|memset
c_func
(paren
id|mc
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|ifmcaddr6
)paren
)paren
suffix:semicolon
id|init_timer
c_func
(paren
op_amp
id|mc-&gt;mca_timer
)paren
suffix:semicolon
id|mc-&gt;mca_timer.function
op_assign
id|igmp6_timer_handler
suffix:semicolon
id|mc-&gt;mca_timer.data
op_assign
(paren
r_int
r_int
)paren
id|mc
suffix:semicolon
id|ipv6_addr_copy
c_func
(paren
op_amp
id|mc-&gt;mca_addr
comma
id|addr
)paren
suffix:semicolon
id|mc-&gt;idev
op_assign
id|idev
suffix:semicolon
id|mc-&gt;mca_users
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* mca_stamp should be updated upon changes */
id|mc-&gt;mca_cstamp
op_assign
id|mc-&gt;mca_tstamp
op_assign
id|jiffies
suffix:semicolon
id|atomic_set
c_func
(paren
op_amp
id|mc-&gt;mca_refcnt
comma
l_int|2
)paren
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|mc-&gt;mca_lock
)paren
suffix:semicolon
multiline_comment|/* initial mode is (EX, empty) */
id|mc-&gt;mca_sfmode
op_assign
id|MCAST_EXCLUDE
suffix:semicolon
id|mc-&gt;mca_sfcount
(braket
id|MCAST_EXCLUDE
)braket
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|ipv6_addr_is_ll_all_nodes
c_func
(paren
op_amp
id|mc-&gt;mca_addr
)paren
op_logical_or
id|IPV6_ADDR_MC_SCOPE
c_func
(paren
op_amp
id|mc-&gt;mca_addr
)paren
OL
id|IPV6_ADDR_SCOPE_LINKLOCAL
)paren
id|mc-&gt;mca_flags
op_or_assign
id|MAF_NOREPORT
suffix:semicolon
id|mc-&gt;next
op_assign
id|idev-&gt;mc_list
suffix:semicolon
id|idev-&gt;mc_list
op_assign
id|mc
suffix:semicolon
id|write_unlock_bh
c_func
(paren
op_amp
id|idev-&gt;lock
)paren
suffix:semicolon
id|mld_del_delrec
c_func
(paren
id|idev
comma
op_amp
id|mc-&gt;mca_addr
)paren
suffix:semicolon
id|igmp6_group_added
c_func
(paren
id|mc
)paren
suffix:semicolon
id|ma_put
c_func
(paren
id|mc
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;device multicast group del&n; */
DECL|function|__ipv6_dev_mc_dec
r_int
id|__ipv6_dev_mc_dec
c_func
(paren
r_struct
id|inet6_dev
op_star
id|idev
comma
r_struct
id|in6_addr
op_star
id|addr
)paren
(brace
r_struct
id|ifmcaddr6
op_star
id|ma
comma
op_star
op_star
id|map
suffix:semicolon
id|write_lock_bh
c_func
(paren
op_amp
id|idev-&gt;lock
)paren
suffix:semicolon
r_for
c_loop
(paren
id|map
op_assign
op_amp
id|idev-&gt;mc_list
suffix:semicolon
(paren
id|ma
op_assign
op_star
id|map
)paren
op_ne
l_int|NULL
suffix:semicolon
id|map
op_assign
op_amp
id|ma-&gt;next
)paren
(brace
r_if
c_cond
(paren
id|ipv6_addr_equal
c_func
(paren
op_amp
id|ma-&gt;mca_addr
comma
id|addr
)paren
)paren
(brace
r_if
c_cond
(paren
op_decrement
id|ma-&gt;mca_users
op_eq
l_int|0
)paren
(brace
op_star
id|map
op_assign
id|ma-&gt;next
suffix:semicolon
id|write_unlock_bh
c_func
(paren
op_amp
id|idev-&gt;lock
)paren
suffix:semicolon
id|igmp6_group_dropped
c_func
(paren
id|ma
)paren
suffix:semicolon
id|ma_put
c_func
(paren
id|ma
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|write_unlock_bh
c_func
(paren
op_amp
id|idev-&gt;lock
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
id|write_unlock_bh
c_func
(paren
op_amp
id|idev-&gt;lock
)paren
suffix:semicolon
r_return
op_minus
id|ENOENT
suffix:semicolon
)brace
DECL|function|ipv6_dev_mc_dec
r_int
id|ipv6_dev_mc_dec
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|in6_addr
op_star
id|addr
)paren
(brace
r_struct
id|inet6_dev
op_star
id|idev
op_assign
id|in6_dev_get
c_func
(paren
id|dev
)paren
suffix:semicolon
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|idev
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|err
op_assign
id|__ipv6_dev_mc_dec
c_func
(paren
id|idev
comma
id|addr
)paren
suffix:semicolon
id|in6_dev_put
c_func
(paren
id|idev
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
multiline_comment|/*&n; * identify MLD packets for MLD filter exceptions&n; */
DECL|function|ipv6_is_mld
r_int
id|ipv6_is_mld
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_int
id|nexthdr
)paren
(brace
r_struct
id|icmp6hdr
op_star
id|pic
suffix:semicolon
r_if
c_cond
(paren
id|nexthdr
op_ne
id|IPPROTO_ICMPV6
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pskb_may_pull
c_func
(paren
id|skb
comma
r_sizeof
(paren
r_struct
id|icmp6hdr
)paren
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|pic
op_assign
(paren
r_struct
id|icmp6hdr
op_star
)paren
id|skb-&gt;h.raw
suffix:semicolon
r_switch
c_cond
(paren
id|pic-&gt;icmp6_type
)paren
(brace
r_case
id|ICMPV6_MGM_QUERY
suffix:colon
r_case
id|ICMPV6_MGM_REPORT
suffix:colon
r_case
id|ICMPV6_MGM_REDUCTION
suffix:colon
r_case
id|ICMPV6_MLD2_REPORT
suffix:colon
r_return
l_int|1
suffix:semicolon
r_default
suffix:colon
r_break
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;check if the interface/address pair is valid&n; */
DECL|function|ipv6_chk_mcast_addr
r_int
id|ipv6_chk_mcast_addr
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|in6_addr
op_star
id|group
comma
r_struct
id|in6_addr
op_star
id|src_addr
)paren
(brace
r_struct
id|inet6_dev
op_star
id|idev
suffix:semicolon
r_struct
id|ifmcaddr6
op_star
id|mc
suffix:semicolon
r_int
id|rv
op_assign
l_int|0
suffix:semicolon
id|idev
op_assign
id|in6_dev_get
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|idev
)paren
(brace
id|read_lock_bh
c_func
(paren
op_amp
id|idev-&gt;lock
)paren
suffix:semicolon
r_for
c_loop
(paren
id|mc
op_assign
id|idev-&gt;mc_list
suffix:semicolon
id|mc
suffix:semicolon
id|mc
op_assign
id|mc-&gt;next
)paren
(brace
r_if
c_cond
(paren
id|ipv6_addr_equal
c_func
(paren
op_amp
id|mc-&gt;mca_addr
comma
id|group
)paren
)paren
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|mc
)paren
(brace
r_if
c_cond
(paren
id|src_addr
op_logical_and
op_logical_neg
id|ipv6_addr_any
c_func
(paren
id|src_addr
)paren
)paren
(brace
r_struct
id|ip6_sf_list
op_star
id|psf
suffix:semicolon
id|spin_lock_bh
c_func
(paren
op_amp
id|mc-&gt;mca_lock
)paren
suffix:semicolon
r_for
c_loop
(paren
id|psf
op_assign
id|mc-&gt;mca_sources
suffix:semicolon
id|psf
suffix:semicolon
id|psf
op_assign
id|psf-&gt;sf_next
)paren
(brace
r_if
c_cond
(paren
id|ipv6_addr_equal
c_func
(paren
op_amp
id|psf-&gt;sf_addr
comma
id|src_addr
)paren
)paren
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|psf
)paren
id|rv
op_assign
id|psf-&gt;sf_count
(braket
id|MCAST_INCLUDE
)braket
op_logical_or
id|psf-&gt;sf_count
(braket
id|MCAST_EXCLUDE
)braket
op_ne
id|mc-&gt;mca_sfcount
(braket
id|MCAST_EXCLUDE
)braket
suffix:semicolon
r_else
id|rv
op_assign
id|mc-&gt;mca_sfcount
(braket
id|MCAST_EXCLUDE
)braket
op_ne
l_int|0
suffix:semicolon
id|spin_unlock_bh
c_func
(paren
op_amp
id|mc-&gt;mca_lock
)paren
suffix:semicolon
)brace
r_else
id|rv
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* don&squot;t filter unspecified source */
)brace
id|read_unlock_bh
c_func
(paren
op_amp
id|idev-&gt;lock
)paren
suffix:semicolon
id|in6_dev_put
c_func
(paren
id|idev
)paren
suffix:semicolon
)brace
r_return
id|rv
suffix:semicolon
)brace
DECL|function|mld_gq_start_timer
r_static
r_void
id|mld_gq_start_timer
c_func
(paren
r_struct
id|inet6_dev
op_star
id|idev
)paren
(brace
r_int
id|tv
op_assign
id|net_random
c_func
(paren
)paren
op_mod
id|idev-&gt;mc_maxdelay
suffix:semicolon
id|idev-&gt;mc_gq_running
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|mod_timer
c_func
(paren
op_amp
id|idev-&gt;mc_gq_timer
comma
id|jiffies
op_plus
id|tv
op_plus
l_int|2
)paren
)paren
id|in6_dev_hold
c_func
(paren
id|idev
)paren
suffix:semicolon
)brace
DECL|function|mld_ifc_start_timer
r_static
r_void
id|mld_ifc_start_timer
c_func
(paren
r_struct
id|inet6_dev
op_star
id|idev
comma
r_int
id|delay
)paren
(brace
r_int
id|tv
op_assign
id|net_random
c_func
(paren
)paren
op_mod
id|delay
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|mod_timer
c_func
(paren
op_amp
id|idev-&gt;mc_ifc_timer
comma
id|jiffies
op_plus
id|tv
op_plus
l_int|2
)paren
)paren
id|in6_dev_hold
c_func
(paren
id|idev
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;IGMP handling (alias multicast ICMPv6 messages)&n; */
DECL|function|igmp6_group_queried
r_static
r_void
id|igmp6_group_queried
c_func
(paren
r_struct
id|ifmcaddr6
op_star
id|ma
comma
r_int
r_int
id|resptime
)paren
(brace
r_int
r_int
id|delay
op_assign
id|resptime
suffix:semicolon
multiline_comment|/* Do not start timer for these addresses */
r_if
c_cond
(paren
id|ipv6_addr_is_ll_all_nodes
c_func
(paren
op_amp
id|ma-&gt;mca_addr
)paren
op_logical_or
id|IPV6_ADDR_MC_SCOPE
c_func
(paren
op_amp
id|ma-&gt;mca_addr
)paren
OL
id|IPV6_ADDR_SCOPE_LINKLOCAL
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|del_timer
c_func
(paren
op_amp
id|ma-&gt;mca_timer
)paren
)paren
(brace
id|atomic_dec
c_func
(paren
op_amp
id|ma-&gt;mca_refcnt
)paren
suffix:semicolon
id|delay
op_assign
id|ma-&gt;mca_timer.expires
op_minus
id|jiffies
suffix:semicolon
)brace
r_if
c_cond
(paren
id|delay
op_ge
id|resptime
)paren
(brace
r_if
c_cond
(paren
id|resptime
)paren
id|delay
op_assign
id|net_random
c_func
(paren
)paren
op_mod
id|resptime
suffix:semicolon
r_else
id|delay
op_assign
l_int|1
suffix:semicolon
)brace
id|ma-&gt;mca_timer.expires
op_assign
id|jiffies
op_plus
id|delay
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|mod_timer
c_func
(paren
op_amp
id|ma-&gt;mca_timer
comma
id|jiffies
op_plus
id|delay
)paren
)paren
id|atomic_inc
c_func
(paren
op_amp
id|ma-&gt;mca_refcnt
)paren
suffix:semicolon
id|ma-&gt;mca_flags
op_or_assign
id|MAF_TIMER_RUNNING
suffix:semicolon
)brace
DECL|function|mld_marksources
r_static
r_void
id|mld_marksources
c_func
(paren
r_struct
id|ifmcaddr6
op_star
id|pmc
comma
r_int
id|nsrcs
comma
r_struct
id|in6_addr
op_star
id|srcs
)paren
(brace
r_struct
id|ip6_sf_list
op_star
id|psf
suffix:semicolon
r_int
id|i
comma
id|scount
suffix:semicolon
id|scount
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|psf
op_assign
id|pmc-&gt;mca_sources
suffix:semicolon
id|psf
suffix:semicolon
id|psf
op_assign
id|psf-&gt;sf_next
)paren
(brace
r_if
c_cond
(paren
id|scount
op_eq
id|nsrcs
)paren
r_break
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|nsrcs
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|ipv6_addr_equal
c_func
(paren
op_amp
id|srcs
(braket
id|i
)braket
comma
op_amp
id|psf-&gt;sf_addr
)paren
)paren
(brace
id|psf-&gt;sf_gsresp
op_assign
l_int|1
suffix:semicolon
id|scount
op_increment
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
)brace
DECL|function|igmp6_event_query
r_int
id|igmp6_event_query
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|mld2_query
op_star
id|mlh2
op_assign
(paren
r_struct
id|mld2_query
op_star
)paren
id|skb-&gt;h.raw
suffix:semicolon
r_struct
id|ifmcaddr6
op_star
id|ma
suffix:semicolon
r_struct
id|in6_addr
op_star
id|group
suffix:semicolon
r_int
r_int
id|max_delay
suffix:semicolon
r_struct
id|inet6_dev
op_star
id|idev
suffix:semicolon
r_struct
id|icmp6hdr
op_star
id|hdr
suffix:semicolon
r_int
id|group_type
suffix:semicolon
r_int
id|mark
op_assign
l_int|0
suffix:semicolon
r_int
id|len
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pskb_may_pull
c_func
(paren
id|skb
comma
r_sizeof
(paren
r_struct
id|in6_addr
)paren
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
multiline_comment|/* compute payload length excluding extension headers */
id|len
op_assign
id|ntohs
c_func
(paren
id|skb-&gt;nh.ipv6h-&gt;payload_len
)paren
op_plus
r_sizeof
(paren
r_struct
id|ipv6hdr
)paren
suffix:semicolon
id|len
op_sub_assign
(paren
r_char
op_star
)paren
id|skb-&gt;h.raw
op_minus
(paren
r_char
op_star
)paren
id|skb-&gt;nh.ipv6h
suffix:semicolon
multiline_comment|/* Drop queries with not link local source */
r_if
c_cond
(paren
op_logical_neg
(paren
id|ipv6_addr_type
c_func
(paren
op_amp
id|skb-&gt;nh.ipv6h-&gt;saddr
)paren
op_amp
id|IPV6_ADDR_LINKLOCAL
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|idev
op_assign
id|in6_dev_get
c_func
(paren
id|skb-&gt;dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|idev
op_eq
l_int|NULL
)paren
r_return
l_int|0
suffix:semicolon
id|hdr
op_assign
(paren
r_struct
id|icmp6hdr
op_star
)paren
id|skb-&gt;h.raw
suffix:semicolon
id|group
op_assign
(paren
r_struct
id|in6_addr
op_star
)paren
(paren
id|hdr
op_plus
l_int|1
)paren
suffix:semicolon
id|group_type
op_assign
id|ipv6_addr_type
c_func
(paren
id|group
)paren
suffix:semicolon
r_if
c_cond
(paren
id|group_type
op_ne
id|IPV6_ADDR_ANY
op_logical_and
op_logical_neg
(paren
id|group_type
op_amp
id|IPV6_ADDR_MULTICAST
)paren
)paren
(brace
id|in6_dev_put
c_func
(paren
id|idev
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|len
op_eq
l_int|24
)paren
(brace
r_int
id|switchback
suffix:semicolon
multiline_comment|/* MLDv1 router present */
multiline_comment|/* Translate milliseconds to jiffies */
id|max_delay
op_assign
(paren
id|ntohs
c_func
(paren
id|hdr-&gt;icmp6_maxdelay
)paren
op_star
id|HZ
)paren
op_div
l_int|1000
suffix:semicolon
id|switchback
op_assign
(paren
id|idev-&gt;mc_qrv
op_plus
l_int|1
)paren
op_star
id|max_delay
suffix:semicolon
id|idev-&gt;mc_v1_seen
op_assign
id|jiffies
op_plus
id|switchback
suffix:semicolon
multiline_comment|/* cancel the interface change timer */
id|idev-&gt;mc_ifc_count
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|del_timer
c_func
(paren
op_amp
id|idev-&gt;mc_ifc_timer
)paren
)paren
id|__in6_dev_put
c_func
(paren
id|idev
)paren
suffix:semicolon
multiline_comment|/* clear deleted report items */
id|mld_clear_delrec
c_func
(paren
id|idev
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|len
op_ge
l_int|28
)paren
(brace
id|max_delay
op_assign
(paren
id|MLDV2_MRC
c_func
(paren
id|ntohs
c_func
(paren
id|mlh2-&gt;mrc
)paren
)paren
op_star
id|HZ
)paren
op_div
l_int|1000
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|max_delay
)paren
id|max_delay
op_assign
l_int|1
suffix:semicolon
id|idev-&gt;mc_maxdelay
op_assign
id|max_delay
suffix:semicolon
r_if
c_cond
(paren
id|mlh2-&gt;qrv
)paren
id|idev-&gt;mc_qrv
op_assign
id|mlh2-&gt;qrv
suffix:semicolon
r_if
c_cond
(paren
id|group_type
op_eq
id|IPV6_ADDR_ANY
)paren
(brace
multiline_comment|/* general query */
r_if
c_cond
(paren
id|mlh2-&gt;nsrcs
)paren
(brace
id|in6_dev_put
c_func
(paren
id|idev
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
multiline_comment|/* no sources allowed */
)brace
id|mld_gq_start_timer
c_func
(paren
id|idev
)paren
suffix:semicolon
id|in6_dev_put
c_func
(paren
id|idev
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* mark sources to include, if group &amp; source-specific */
id|mark
op_assign
id|mlh2-&gt;nsrcs
op_ne
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|in6_dev_put
c_func
(paren
id|idev
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|read_lock_bh
c_func
(paren
op_amp
id|idev-&gt;lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|group_type
op_eq
id|IPV6_ADDR_ANY
)paren
(brace
r_for
c_loop
(paren
id|ma
op_assign
id|idev-&gt;mc_list
suffix:semicolon
id|ma
suffix:semicolon
id|ma
op_assign
id|ma-&gt;next
)paren
(brace
id|spin_lock_bh
c_func
(paren
op_amp
id|ma-&gt;mca_lock
)paren
suffix:semicolon
id|igmp6_group_queried
c_func
(paren
id|ma
comma
id|max_delay
)paren
suffix:semicolon
id|spin_unlock_bh
c_func
(paren
op_amp
id|ma-&gt;mca_lock
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
r_for
c_loop
(paren
id|ma
op_assign
id|idev-&gt;mc_list
suffix:semicolon
id|ma
suffix:semicolon
id|ma
op_assign
id|ma-&gt;next
)paren
(brace
r_if
c_cond
(paren
id|group_type
op_ne
id|IPV6_ADDR_ANY
op_logical_and
op_logical_neg
id|ipv6_addr_equal
c_func
(paren
id|group
comma
op_amp
id|ma-&gt;mca_addr
)paren
)paren
r_continue
suffix:semicolon
id|spin_lock_bh
c_func
(paren
op_amp
id|ma-&gt;mca_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ma-&gt;mca_flags
op_amp
id|MAF_TIMER_RUNNING
)paren
(brace
multiline_comment|/* gsquery &lt;- gsquery &amp;&amp; mark */
r_if
c_cond
(paren
op_logical_neg
id|mark
)paren
id|ma-&gt;mca_flags
op_and_assign
op_complement
id|MAF_GSQUERY
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* gsquery &lt;- mark */
r_if
c_cond
(paren
id|mark
)paren
id|ma-&gt;mca_flags
op_or_assign
id|MAF_GSQUERY
suffix:semicolon
r_else
id|ma-&gt;mca_flags
op_and_assign
op_complement
id|MAF_GSQUERY
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ma-&gt;mca_flags
op_amp
id|MAF_GSQUERY
)paren
id|mld_marksources
c_func
(paren
id|ma
comma
id|ntohs
c_func
(paren
id|mlh2-&gt;nsrcs
)paren
comma
id|mlh2-&gt;srcs
)paren
suffix:semicolon
id|igmp6_group_queried
c_func
(paren
id|ma
comma
id|max_delay
)paren
suffix:semicolon
id|spin_unlock_bh
c_func
(paren
op_amp
id|ma-&gt;mca_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|group_type
op_ne
id|IPV6_ADDR_ANY
)paren
r_break
suffix:semicolon
)brace
)brace
id|read_unlock_bh
c_func
(paren
op_amp
id|idev-&gt;lock
)paren
suffix:semicolon
id|in6_dev_put
c_func
(paren
id|idev
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|igmp6_event_report
r_int
id|igmp6_event_report
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|ifmcaddr6
op_star
id|ma
suffix:semicolon
r_struct
id|in6_addr
op_star
id|addrp
suffix:semicolon
r_struct
id|inet6_dev
op_star
id|idev
suffix:semicolon
r_struct
id|icmp6hdr
op_star
id|hdr
suffix:semicolon
r_int
id|addr_type
suffix:semicolon
multiline_comment|/* Our own report looped back. Ignore it. */
r_if
c_cond
(paren
id|skb-&gt;pkt_type
op_eq
id|PACKET_LOOPBACK
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pskb_may_pull
c_func
(paren
id|skb
comma
r_sizeof
(paren
r_struct
id|in6_addr
)paren
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|hdr
op_assign
(paren
r_struct
id|icmp6hdr
op_star
)paren
id|skb-&gt;h.raw
suffix:semicolon
multiline_comment|/* Drop reports with not link local source */
id|addr_type
op_assign
id|ipv6_addr_type
c_func
(paren
op_amp
id|skb-&gt;nh.ipv6h-&gt;saddr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|addr_type
op_ne
id|IPV6_ADDR_ANY
op_logical_and
op_logical_neg
(paren
id|addr_type
op_amp
id|IPV6_ADDR_LINKLOCAL
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|addrp
op_assign
(paren
r_struct
id|in6_addr
op_star
)paren
(paren
id|hdr
op_plus
l_int|1
)paren
suffix:semicolon
id|idev
op_assign
id|in6_dev_get
c_func
(paren
id|skb-&gt;dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|idev
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
multiline_comment|/*&n;&t; *&t;Cancel the timer for this group&n;&t; */
id|read_lock_bh
c_func
(paren
op_amp
id|idev-&gt;lock
)paren
suffix:semicolon
r_for
c_loop
(paren
id|ma
op_assign
id|idev-&gt;mc_list
suffix:semicolon
id|ma
suffix:semicolon
id|ma
op_assign
id|ma-&gt;next
)paren
(brace
r_if
c_cond
(paren
id|ipv6_addr_equal
c_func
(paren
op_amp
id|ma-&gt;mca_addr
comma
id|addrp
)paren
)paren
(brace
id|spin_lock
c_func
(paren
op_amp
id|ma-&gt;mca_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|del_timer
c_func
(paren
op_amp
id|ma-&gt;mca_timer
)paren
)paren
id|atomic_dec
c_func
(paren
op_amp
id|ma-&gt;mca_refcnt
)paren
suffix:semicolon
id|ma-&gt;mca_flags
op_and_assign
op_complement
(paren
id|MAF_LAST_REPORTER
op_or
id|MAF_TIMER_RUNNING
)paren
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|ma-&gt;mca_lock
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|read_unlock_bh
c_func
(paren
op_amp
id|idev-&gt;lock
)paren
suffix:semicolon
id|in6_dev_put
c_func
(paren
id|idev
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|is_in
r_static
r_int
id|is_in
c_func
(paren
r_struct
id|ifmcaddr6
op_star
id|pmc
comma
r_struct
id|ip6_sf_list
op_star
id|psf
comma
r_int
id|type
comma
r_int
id|gdeleted
comma
r_int
id|sdeleted
)paren
(brace
r_switch
c_cond
(paren
id|type
)paren
(brace
r_case
id|MLD2_MODE_IS_INCLUDE
suffix:colon
r_case
id|MLD2_MODE_IS_EXCLUDE
suffix:colon
r_if
c_cond
(paren
id|gdeleted
op_logical_or
id|sdeleted
)paren
r_return
l_int|0
suffix:semicolon
r_return
op_logical_neg
(paren
(paren
id|pmc-&gt;mca_flags
op_amp
id|MAF_GSQUERY
)paren
op_logical_and
op_logical_neg
id|psf-&gt;sf_gsresp
)paren
suffix:semicolon
r_case
id|MLD2_CHANGE_TO_INCLUDE
suffix:colon
r_if
c_cond
(paren
id|gdeleted
op_logical_or
id|sdeleted
)paren
r_return
l_int|0
suffix:semicolon
r_return
id|psf-&gt;sf_count
(braket
id|MCAST_INCLUDE
)braket
op_ne
l_int|0
suffix:semicolon
r_case
id|MLD2_CHANGE_TO_EXCLUDE
suffix:colon
r_if
c_cond
(paren
id|gdeleted
op_logical_or
id|sdeleted
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|pmc-&gt;mca_sfcount
(braket
id|MCAST_EXCLUDE
)braket
op_eq
l_int|0
op_logical_or
id|psf-&gt;sf_count
(braket
id|MCAST_INCLUDE
)braket
)paren
r_return
l_int|0
suffix:semicolon
r_return
id|pmc-&gt;mca_sfcount
(braket
id|MCAST_EXCLUDE
)braket
op_eq
id|psf-&gt;sf_count
(braket
id|MCAST_EXCLUDE
)braket
suffix:semicolon
r_case
id|MLD2_ALLOW_NEW_SOURCES
suffix:colon
r_if
c_cond
(paren
id|gdeleted
op_logical_or
op_logical_neg
id|psf-&gt;sf_crcount
)paren
r_return
l_int|0
suffix:semicolon
r_return
(paren
id|pmc-&gt;mca_sfmode
op_eq
id|MCAST_INCLUDE
)paren
op_xor
id|sdeleted
suffix:semicolon
r_case
id|MLD2_BLOCK_OLD_SOURCES
suffix:colon
r_if
c_cond
(paren
id|pmc-&gt;mca_sfmode
op_eq
id|MCAST_INCLUDE
)paren
r_return
id|gdeleted
op_logical_or
(paren
id|psf-&gt;sf_crcount
op_logical_and
id|sdeleted
)paren
suffix:semicolon
r_return
id|psf-&gt;sf_crcount
op_logical_and
op_logical_neg
id|gdeleted
op_logical_and
op_logical_neg
id|sdeleted
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|mld_scount
id|mld_scount
c_func
(paren
r_struct
id|ifmcaddr6
op_star
id|pmc
comma
r_int
id|type
comma
r_int
id|gdeleted
comma
r_int
id|sdeleted
)paren
(brace
r_struct
id|ip6_sf_list
op_star
id|psf
suffix:semicolon
r_int
id|scount
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|psf
op_assign
id|pmc-&gt;mca_sources
suffix:semicolon
id|psf
suffix:semicolon
id|psf
op_assign
id|psf-&gt;sf_next
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|is_in
c_func
(paren
id|pmc
comma
id|psf
comma
id|type
comma
id|gdeleted
comma
id|sdeleted
)paren
)paren
r_continue
suffix:semicolon
id|scount
op_increment
suffix:semicolon
)brace
r_return
id|scount
suffix:semicolon
)brace
DECL|function|mld_newpack
r_static
r_struct
id|sk_buff
op_star
id|mld_newpack
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|size
)paren
(brace
r_struct
id|sock
op_star
id|sk
op_assign
id|igmp6_socket-&gt;sk
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_struct
id|mld2_report
op_star
id|pmr
suffix:semicolon
r_struct
id|in6_addr
id|addr_buf
suffix:semicolon
r_int
id|err
suffix:semicolon
id|u8
id|ra
(braket
l_int|8
)braket
op_assign
(brace
id|IPPROTO_ICMPV6
comma
l_int|0
comma
id|IPV6_TLV_ROUTERALERT
comma
l_int|2
comma
l_int|0
comma
l_int|0
comma
id|IPV6_TLV_PADN
comma
l_int|0
)brace
suffix:semicolon
multiline_comment|/* we assume size &gt; sizeof(ra) here */
id|skb
op_assign
id|sock_alloc_send_skb
c_func
(paren
id|sk
comma
id|size
op_plus
id|LL_RESERVED_SPACE
c_func
(paren
id|dev
)paren
comma
l_int|1
comma
op_amp
id|err
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_eq
l_int|0
)paren
r_return
l_int|NULL
suffix:semicolon
id|skb_reserve
c_func
(paren
id|skb
comma
id|LL_RESERVED_SPACE
c_func
(paren
id|dev
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;hard_header
)paren
(brace
r_int
r_char
id|ha
(braket
id|MAX_ADDR_LEN
)braket
suffix:semicolon
id|ndisc_mc_map
c_func
(paren
op_amp
id|mld2_all_mcr
comma
id|ha
comma
id|dev
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev
op_member_access_from_pointer
id|hard_header
c_func
(paren
id|skb
comma
id|dev
comma
id|ETH_P_IPV6
comma
id|ha
comma
l_int|NULL
comma
id|size
)paren
OL
l_int|0
)paren
(brace
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|ipv6_get_lladdr
c_func
(paren
id|dev
comma
op_amp
id|addr_buf
)paren
)paren
(brace
multiline_comment|/* &lt;draft-ietf-magma-mld-source-05.txt&gt;:&n;&t;&t; * use unspecified address as the source address &n;&t;&t; * when a valid link-local address is not available.&n;&t;&t; */
id|memset
c_func
(paren
op_amp
id|addr_buf
comma
l_int|0
comma
r_sizeof
(paren
id|addr_buf
)paren
)paren
suffix:semicolon
)brace
id|ip6_nd_hdr
c_func
(paren
id|sk
comma
id|skb
comma
id|dev
comma
op_amp
id|addr_buf
comma
op_amp
id|mld2_all_mcr
comma
id|NEXTHDR_HOP
comma
l_int|0
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|skb_put
c_func
(paren
id|skb
comma
r_sizeof
(paren
id|ra
)paren
)paren
comma
id|ra
comma
r_sizeof
(paren
id|ra
)paren
)paren
suffix:semicolon
id|pmr
op_assign
(paren
r_struct
id|mld2_report
op_star
)paren
id|skb_put
c_func
(paren
id|skb
comma
r_sizeof
(paren
op_star
id|pmr
)paren
)paren
suffix:semicolon
id|skb-&gt;h.raw
op_assign
(paren
r_int
r_char
op_star
)paren
id|pmr
suffix:semicolon
id|pmr-&gt;type
op_assign
id|ICMPV6_MLD2_REPORT
suffix:semicolon
id|pmr-&gt;resv1
op_assign
l_int|0
suffix:semicolon
id|pmr-&gt;csum
op_assign
l_int|0
suffix:semicolon
id|pmr-&gt;resv2
op_assign
l_int|0
suffix:semicolon
id|pmr-&gt;ngrec
op_assign
l_int|0
suffix:semicolon
r_return
id|skb
suffix:semicolon
)brace
DECL|function|mld_sendpack
r_static
r_void
id|mld_sendpack
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|ipv6hdr
op_star
id|pip6
op_assign
id|skb-&gt;nh.ipv6h
suffix:semicolon
r_struct
id|mld2_report
op_star
id|pmr
op_assign
(paren
r_struct
id|mld2_report
op_star
)paren
id|skb-&gt;h.raw
suffix:semicolon
r_int
id|payload_len
comma
id|mldlen
suffix:semicolon
r_struct
id|inet6_dev
op_star
id|idev
op_assign
id|in6_dev_get
c_func
(paren
id|skb-&gt;dev
)paren
suffix:semicolon
r_int
id|err
suffix:semicolon
id|IP6_INC_STATS
c_func
(paren
id|IPSTATS_MIB_OUTREQUESTS
)paren
suffix:semicolon
id|payload_len
op_assign
id|skb-&gt;tail
op_minus
(paren
r_int
r_char
op_star
)paren
id|skb-&gt;nh.ipv6h
op_minus
r_sizeof
(paren
r_struct
id|ipv6hdr
)paren
suffix:semicolon
id|mldlen
op_assign
id|skb-&gt;tail
op_minus
id|skb-&gt;h.raw
suffix:semicolon
id|pip6-&gt;payload_len
op_assign
id|htons
c_func
(paren
id|payload_len
)paren
suffix:semicolon
id|pmr-&gt;csum
op_assign
id|csum_ipv6_magic
c_func
(paren
op_amp
id|pip6-&gt;saddr
comma
op_amp
id|pip6-&gt;daddr
comma
id|mldlen
comma
id|IPPROTO_ICMPV6
comma
id|csum_partial
c_func
(paren
id|skb-&gt;h.raw
comma
id|mldlen
comma
l_int|0
)paren
)paren
suffix:semicolon
id|err
op_assign
id|NF_HOOK
c_func
(paren
id|PF_INET6
comma
id|NF_IP6_LOCAL_OUT
comma
id|skb
comma
l_int|NULL
comma
id|skb-&gt;dev
comma
id|dev_queue_xmit
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|err
)paren
(brace
id|ICMP6_INC_STATS
c_func
(paren
id|idev
comma
id|ICMP6_MIB_OUTMSGS
)paren
suffix:semicolon
id|IP6_INC_STATS
c_func
(paren
id|IPSTATS_MIB_OUTMCASTPKTS
)paren
suffix:semicolon
)brace
r_else
id|IP6_INC_STATS
c_func
(paren
id|IPSTATS_MIB_OUTDISCARDS
)paren
suffix:semicolon
r_if
c_cond
(paren
id|likely
c_func
(paren
id|idev
op_ne
l_int|NULL
)paren
)paren
id|in6_dev_put
c_func
(paren
id|idev
)paren
suffix:semicolon
)brace
DECL|function|grec_size
r_static
r_int
id|grec_size
c_func
(paren
r_struct
id|ifmcaddr6
op_star
id|pmc
comma
r_int
id|type
comma
r_int
id|gdel
comma
r_int
id|sdel
)paren
(brace
r_return
r_sizeof
(paren
r_struct
id|mld2_grec
)paren
op_plus
l_int|4
op_star
id|mld_scount
c_func
(paren
id|pmc
comma
id|type
comma
id|gdel
comma
id|sdel
)paren
suffix:semicolon
)brace
DECL|function|add_grhead
r_static
r_struct
id|sk_buff
op_star
id|add_grhead
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|ifmcaddr6
op_star
id|pmc
comma
r_int
id|type
comma
r_struct
id|mld2_grec
op_star
op_star
id|ppgr
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
id|pmc-&gt;idev-&gt;dev
suffix:semicolon
r_struct
id|mld2_report
op_star
id|pmr
suffix:semicolon
r_struct
id|mld2_grec
op_star
id|pgr
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
id|skb
op_assign
id|mld_newpack
c_func
(paren
id|dev
comma
id|dev-&gt;mtu
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
r_return
l_int|NULL
suffix:semicolon
id|pgr
op_assign
(paren
r_struct
id|mld2_grec
op_star
)paren
id|skb_put
c_func
(paren
id|skb
comma
r_sizeof
(paren
r_struct
id|mld2_grec
)paren
)paren
suffix:semicolon
id|pgr-&gt;grec_type
op_assign
id|type
suffix:semicolon
id|pgr-&gt;grec_auxwords
op_assign
l_int|0
suffix:semicolon
id|pgr-&gt;grec_nsrcs
op_assign
l_int|0
suffix:semicolon
id|pgr-&gt;grec_mca
op_assign
id|pmc-&gt;mca_addr
suffix:semicolon
multiline_comment|/* structure copy */
id|pmr
op_assign
(paren
r_struct
id|mld2_report
op_star
)paren
id|skb-&gt;h.raw
suffix:semicolon
id|pmr-&gt;ngrec
op_assign
id|htons
c_func
(paren
id|ntohs
c_func
(paren
id|pmr-&gt;ngrec
)paren
op_plus
l_int|1
)paren
suffix:semicolon
op_star
id|ppgr
op_assign
id|pgr
suffix:semicolon
r_return
id|skb
suffix:semicolon
)brace
DECL|macro|AVAILABLE
mdefine_line|#define AVAILABLE(skb) ((skb) ? ((skb)-&gt;dev ? (skb)-&gt;dev-&gt;mtu - (skb)-&gt;len : &bslash;&n;&t;skb_tailroom(skb)) : 0)
DECL|function|add_grec
r_static
r_struct
id|sk_buff
op_star
id|add_grec
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|ifmcaddr6
op_star
id|pmc
comma
r_int
id|type
comma
r_int
id|gdeleted
comma
r_int
id|sdeleted
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
id|pmc-&gt;idev-&gt;dev
suffix:semicolon
r_struct
id|mld2_report
op_star
id|pmr
suffix:semicolon
r_struct
id|mld2_grec
op_star
id|pgr
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|ip6_sf_list
op_star
id|psf
comma
op_star
id|psf_next
comma
op_star
id|psf_prev
comma
op_star
op_star
id|psf_list
suffix:semicolon
r_int
id|scount
comma
id|first
comma
id|isquery
comma
id|truncate
suffix:semicolon
r_if
c_cond
(paren
id|pmc-&gt;mca_flags
op_amp
id|MAF_NOREPORT
)paren
r_return
id|skb
suffix:semicolon
id|isquery
op_assign
id|type
op_eq
id|MLD2_MODE_IS_INCLUDE
op_logical_or
id|type
op_eq
id|MLD2_MODE_IS_EXCLUDE
suffix:semicolon
id|truncate
op_assign
id|type
op_eq
id|MLD2_MODE_IS_EXCLUDE
op_logical_or
id|type
op_eq
id|MLD2_CHANGE_TO_EXCLUDE
suffix:semicolon
id|psf_list
op_assign
id|sdeleted
ques
c_cond
op_amp
id|pmc-&gt;mca_tomb
suffix:colon
op_amp
id|pmc-&gt;mca_sources
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
op_star
id|psf_list
)paren
(brace
r_if
c_cond
(paren
id|type
op_eq
id|MLD2_ALLOW_NEW_SOURCES
op_logical_or
id|type
op_eq
id|MLD2_BLOCK_OLD_SOURCES
)paren
r_return
id|skb
suffix:semicolon
r_if
c_cond
(paren
id|pmc-&gt;mca_crcount
op_logical_or
id|isquery
)paren
(brace
multiline_comment|/* make sure we have room for group header and at&n;&t;&t;&t; * least one source.&n;&t;&t;&t; */
r_if
c_cond
(paren
id|skb
op_logical_and
id|AVAILABLE
c_func
(paren
id|skb
)paren
OL
r_sizeof
(paren
r_struct
id|mld2_grec
)paren
op_plus
r_sizeof
(paren
r_struct
id|in6_addr
)paren
)paren
(brace
id|mld_sendpack
c_func
(paren
id|skb
)paren
suffix:semicolon
id|skb
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/* add_grhead will get a new one */
)brace
id|skb
op_assign
id|add_grhead
c_func
(paren
id|skb
comma
id|pmc
comma
id|type
comma
op_amp
id|pgr
)paren
suffix:semicolon
)brace
r_return
id|skb
suffix:semicolon
)brace
id|pmr
op_assign
id|skb
ques
c_cond
(paren
r_struct
id|mld2_report
op_star
)paren
id|skb-&gt;h.raw
suffix:colon
l_int|NULL
suffix:semicolon
multiline_comment|/* EX and TO_EX get a fresh packet, if needed */
r_if
c_cond
(paren
id|truncate
)paren
(brace
r_if
c_cond
(paren
id|pmr
op_logical_and
id|pmr-&gt;ngrec
op_logical_and
id|AVAILABLE
c_func
(paren
id|skb
)paren
OL
id|grec_size
c_func
(paren
id|pmc
comma
id|type
comma
id|gdeleted
comma
id|sdeleted
)paren
)paren
(brace
r_if
c_cond
(paren
id|skb
)paren
id|mld_sendpack
c_func
(paren
id|skb
)paren
suffix:semicolon
id|skb
op_assign
id|mld_newpack
c_func
(paren
id|dev
comma
id|dev-&gt;mtu
)paren
suffix:semicolon
)brace
)brace
id|first
op_assign
l_int|1
suffix:semicolon
id|scount
op_assign
l_int|0
suffix:semicolon
id|psf_prev
op_assign
l_int|NULL
suffix:semicolon
r_for
c_loop
(paren
id|psf
op_assign
op_star
id|psf_list
suffix:semicolon
id|psf
suffix:semicolon
id|psf
op_assign
id|psf_next
)paren
(brace
r_struct
id|in6_addr
op_star
id|psrc
suffix:semicolon
id|psf_next
op_assign
id|psf-&gt;sf_next
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|is_in
c_func
(paren
id|pmc
comma
id|psf
comma
id|type
comma
id|gdeleted
comma
id|sdeleted
)paren
)paren
(brace
id|psf_prev
op_assign
id|psf
suffix:semicolon
r_continue
suffix:semicolon
)brace
multiline_comment|/* clear marks on query responses */
r_if
c_cond
(paren
id|isquery
)paren
id|psf-&gt;sf_gsresp
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|AVAILABLE
c_func
(paren
id|skb
)paren
OL
r_sizeof
(paren
op_star
id|psrc
)paren
op_plus
id|first
op_star
r_sizeof
(paren
r_struct
id|mld2_grec
)paren
)paren
(brace
r_if
c_cond
(paren
id|truncate
op_logical_and
op_logical_neg
id|first
)paren
r_break
suffix:semicolon
multiline_comment|/* truncate these */
r_if
c_cond
(paren
id|pgr
)paren
id|pgr-&gt;grec_nsrcs
op_assign
id|htons
c_func
(paren
id|scount
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
)paren
id|mld_sendpack
c_func
(paren
id|skb
)paren
suffix:semicolon
id|skb
op_assign
id|mld_newpack
c_func
(paren
id|dev
comma
id|dev-&gt;mtu
)paren
suffix:semicolon
id|first
op_assign
l_int|1
suffix:semicolon
id|scount
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|first
)paren
(brace
id|skb
op_assign
id|add_grhead
c_func
(paren
id|skb
comma
id|pmc
comma
id|type
comma
op_amp
id|pgr
)paren
suffix:semicolon
id|first
op_assign
l_int|0
suffix:semicolon
)brace
id|psrc
op_assign
(paren
r_struct
id|in6_addr
op_star
)paren
id|skb_put
c_func
(paren
id|skb
comma
r_sizeof
(paren
op_star
id|psrc
)paren
)paren
suffix:semicolon
op_star
id|psrc
op_assign
id|psf-&gt;sf_addr
suffix:semicolon
id|scount
op_increment
suffix:semicolon
r_if
c_cond
(paren
(paren
id|type
op_eq
id|MLD2_ALLOW_NEW_SOURCES
op_logical_or
id|type
op_eq
id|MLD2_BLOCK_OLD_SOURCES
)paren
op_logical_and
id|psf-&gt;sf_crcount
)paren
(brace
id|psf-&gt;sf_crcount
op_decrement
suffix:semicolon
r_if
c_cond
(paren
(paren
id|sdeleted
op_logical_or
id|gdeleted
)paren
op_logical_and
id|psf-&gt;sf_crcount
op_eq
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|psf_prev
)paren
id|psf_prev-&gt;sf_next
op_assign
id|psf-&gt;sf_next
suffix:semicolon
r_else
op_star
id|psf_list
op_assign
id|psf-&gt;sf_next
suffix:semicolon
id|kfree
c_func
(paren
id|psf
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
)brace
id|psf_prev
op_assign
id|psf
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pgr
)paren
id|pgr-&gt;grec_nsrcs
op_assign
id|htons
c_func
(paren
id|scount
)paren
suffix:semicolon
r_if
c_cond
(paren
id|isquery
)paren
id|pmc-&gt;mca_flags
op_and_assign
op_complement
id|MAF_GSQUERY
suffix:semicolon
multiline_comment|/* clear query state */
r_return
id|skb
suffix:semicolon
)brace
DECL|function|mld_send_report
r_static
r_void
id|mld_send_report
c_func
(paren
r_struct
id|inet6_dev
op_star
id|idev
comma
r_struct
id|ifmcaddr6
op_star
id|pmc
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
op_assign
l_int|NULL
suffix:semicolon
r_int
id|type
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pmc
)paren
(brace
id|read_lock_bh
c_func
(paren
op_amp
id|idev-&gt;lock
)paren
suffix:semicolon
r_for
c_loop
(paren
id|pmc
op_assign
id|idev-&gt;mc_list
suffix:semicolon
id|pmc
suffix:semicolon
id|pmc
op_assign
id|pmc-&gt;next
)paren
(brace
r_if
c_cond
(paren
id|pmc-&gt;mca_flags
op_amp
id|MAF_NOREPORT
)paren
r_continue
suffix:semicolon
id|spin_lock_bh
c_func
(paren
op_amp
id|pmc-&gt;mca_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pmc-&gt;mca_sfcount
(braket
id|MCAST_EXCLUDE
)braket
)paren
id|type
op_assign
id|MLD2_MODE_IS_EXCLUDE
suffix:semicolon
r_else
id|type
op_assign
id|MLD2_MODE_IS_INCLUDE
suffix:semicolon
id|skb
op_assign
id|add_grec
c_func
(paren
id|skb
comma
id|pmc
comma
id|type
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|spin_unlock_bh
c_func
(paren
op_amp
id|pmc-&gt;mca_lock
)paren
suffix:semicolon
)brace
id|read_unlock_bh
c_func
(paren
op_amp
id|idev-&gt;lock
)paren
suffix:semicolon
)brace
r_else
(brace
id|spin_lock_bh
c_func
(paren
op_amp
id|pmc-&gt;mca_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pmc-&gt;mca_sfcount
(braket
id|MCAST_EXCLUDE
)braket
)paren
id|type
op_assign
id|MLD2_MODE_IS_EXCLUDE
suffix:semicolon
r_else
id|type
op_assign
id|MLD2_MODE_IS_INCLUDE
suffix:semicolon
id|skb
op_assign
id|add_grec
c_func
(paren
id|skb
comma
id|pmc
comma
id|type
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|spin_unlock_bh
c_func
(paren
op_amp
id|pmc-&gt;mca_lock
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|skb
)paren
id|mld_sendpack
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * remove zero-count source records from a source filter list&n; */
DECL|function|mld_clear_zeros
r_static
r_void
id|mld_clear_zeros
c_func
(paren
r_struct
id|ip6_sf_list
op_star
op_star
id|ppsf
)paren
(brace
r_struct
id|ip6_sf_list
op_star
id|psf_prev
comma
op_star
id|psf_next
comma
op_star
id|psf
suffix:semicolon
id|psf_prev
op_assign
l_int|NULL
suffix:semicolon
r_for
c_loop
(paren
id|psf
op_assign
op_star
id|ppsf
suffix:semicolon
id|psf
suffix:semicolon
id|psf
op_assign
id|psf_next
)paren
(brace
id|psf_next
op_assign
id|psf-&gt;sf_next
suffix:semicolon
r_if
c_cond
(paren
id|psf-&gt;sf_crcount
op_eq
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|psf_prev
)paren
id|psf_prev-&gt;sf_next
op_assign
id|psf-&gt;sf_next
suffix:semicolon
r_else
op_star
id|ppsf
op_assign
id|psf-&gt;sf_next
suffix:semicolon
id|kfree
c_func
(paren
id|psf
)paren
suffix:semicolon
)brace
r_else
id|psf_prev
op_assign
id|psf
suffix:semicolon
)brace
)brace
DECL|function|mld_send_cr
r_static
r_void
id|mld_send_cr
c_func
(paren
r_struct
id|inet6_dev
op_star
id|idev
)paren
(brace
r_struct
id|ifmcaddr6
op_star
id|pmc
comma
op_star
id|pmc_prev
comma
op_star
id|pmc_next
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
op_assign
l_int|NULL
suffix:semicolon
r_int
id|type
comma
id|dtype
suffix:semicolon
id|read_lock_bh
c_func
(paren
op_amp
id|idev-&gt;lock
)paren
suffix:semicolon
id|write_lock_bh
c_func
(paren
op_amp
id|idev-&gt;mc_lock
)paren
suffix:semicolon
multiline_comment|/* deleted MCA&squot;s */
id|pmc_prev
op_assign
l_int|NULL
suffix:semicolon
r_for
c_loop
(paren
id|pmc
op_assign
id|idev-&gt;mc_tomb
suffix:semicolon
id|pmc
suffix:semicolon
id|pmc
op_assign
id|pmc_next
)paren
(brace
id|pmc_next
op_assign
id|pmc-&gt;next
suffix:semicolon
r_if
c_cond
(paren
id|pmc-&gt;mca_sfmode
op_eq
id|MCAST_INCLUDE
)paren
(brace
id|type
op_assign
id|MLD2_BLOCK_OLD_SOURCES
suffix:semicolon
id|dtype
op_assign
id|MLD2_BLOCK_OLD_SOURCES
suffix:semicolon
id|skb
op_assign
id|add_grec
c_func
(paren
id|skb
comma
id|pmc
comma
id|type
comma
l_int|1
comma
l_int|0
)paren
suffix:semicolon
id|skb
op_assign
id|add_grec
c_func
(paren
id|skb
comma
id|pmc
comma
id|dtype
comma
l_int|1
comma
l_int|1
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pmc-&gt;mca_crcount
)paren
(brace
id|pmc-&gt;mca_crcount
op_decrement
suffix:semicolon
r_if
c_cond
(paren
id|pmc-&gt;mca_sfmode
op_eq
id|MCAST_EXCLUDE
)paren
(brace
id|type
op_assign
id|MLD2_CHANGE_TO_INCLUDE
suffix:semicolon
id|skb
op_assign
id|add_grec
c_func
(paren
id|skb
comma
id|pmc
comma
id|type
comma
l_int|1
comma
l_int|0
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pmc-&gt;mca_crcount
op_eq
l_int|0
)paren
(brace
id|mld_clear_zeros
c_func
(paren
op_amp
id|pmc-&gt;mca_tomb
)paren
suffix:semicolon
id|mld_clear_zeros
c_func
(paren
op_amp
id|pmc-&gt;mca_sources
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|pmc-&gt;mca_crcount
op_eq
l_int|0
op_logical_and
op_logical_neg
id|pmc-&gt;mca_tomb
op_logical_and
op_logical_neg
id|pmc-&gt;mca_sources
)paren
(brace
r_if
c_cond
(paren
id|pmc_prev
)paren
id|pmc_prev-&gt;next
op_assign
id|pmc_next
suffix:semicolon
r_else
id|idev-&gt;mc_tomb
op_assign
id|pmc_next
suffix:semicolon
id|in6_dev_put
c_func
(paren
id|pmc-&gt;idev
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|pmc
)paren
suffix:semicolon
)brace
r_else
id|pmc_prev
op_assign
id|pmc
suffix:semicolon
)brace
id|write_unlock_bh
c_func
(paren
op_amp
id|idev-&gt;mc_lock
)paren
suffix:semicolon
multiline_comment|/* change recs */
r_for
c_loop
(paren
id|pmc
op_assign
id|idev-&gt;mc_list
suffix:semicolon
id|pmc
suffix:semicolon
id|pmc
op_assign
id|pmc-&gt;next
)paren
(brace
id|spin_lock_bh
c_func
(paren
op_amp
id|pmc-&gt;mca_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pmc-&gt;mca_sfcount
(braket
id|MCAST_EXCLUDE
)braket
)paren
(brace
id|type
op_assign
id|MLD2_BLOCK_OLD_SOURCES
suffix:semicolon
id|dtype
op_assign
id|MLD2_ALLOW_NEW_SOURCES
suffix:semicolon
)brace
r_else
(brace
id|type
op_assign
id|MLD2_ALLOW_NEW_SOURCES
suffix:semicolon
id|dtype
op_assign
id|MLD2_BLOCK_OLD_SOURCES
suffix:semicolon
)brace
id|skb
op_assign
id|add_grec
c_func
(paren
id|skb
comma
id|pmc
comma
id|type
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|skb
op_assign
id|add_grec
c_func
(paren
id|skb
comma
id|pmc
comma
id|dtype
comma
l_int|0
comma
l_int|1
)paren
suffix:semicolon
multiline_comment|/* deleted sources */
multiline_comment|/* filter mode changes */
r_if
c_cond
(paren
id|pmc-&gt;mca_crcount
)paren
(brace
id|pmc-&gt;mca_crcount
op_decrement
suffix:semicolon
r_if
c_cond
(paren
id|pmc-&gt;mca_sfmode
op_eq
id|MCAST_EXCLUDE
)paren
id|type
op_assign
id|MLD2_CHANGE_TO_EXCLUDE
suffix:semicolon
r_else
id|type
op_assign
id|MLD2_CHANGE_TO_INCLUDE
suffix:semicolon
id|skb
op_assign
id|add_grec
c_func
(paren
id|skb
comma
id|pmc
comma
id|type
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
)brace
id|spin_unlock_bh
c_func
(paren
op_amp
id|pmc-&gt;mca_lock
)paren
suffix:semicolon
)brace
id|read_unlock_bh
c_func
(paren
op_amp
id|idev-&gt;lock
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
r_return
suffix:semicolon
(paren
r_void
)paren
id|mld_sendpack
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
DECL|function|igmp6_send
r_static
r_void
id|igmp6_send
c_func
(paren
r_struct
id|in6_addr
op_star
id|addr
comma
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|type
)paren
(brace
r_struct
id|sock
op_star
id|sk
op_assign
id|igmp6_socket-&gt;sk
suffix:semicolon
r_struct
id|inet6_dev
op_star
id|idev
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_struct
id|icmp6hdr
op_star
id|hdr
suffix:semicolon
r_struct
id|in6_addr
op_star
id|snd_addr
suffix:semicolon
r_struct
id|in6_addr
op_star
id|addrp
suffix:semicolon
r_struct
id|in6_addr
id|addr_buf
suffix:semicolon
r_struct
id|in6_addr
id|all_routers
suffix:semicolon
r_int
id|err
comma
id|len
comma
id|payload_len
comma
id|full_len
suffix:semicolon
id|u8
id|ra
(braket
l_int|8
)braket
op_assign
(brace
id|IPPROTO_ICMPV6
comma
l_int|0
comma
id|IPV6_TLV_ROUTERALERT
comma
l_int|2
comma
l_int|0
comma
l_int|0
comma
id|IPV6_TLV_PADN
comma
l_int|0
)brace
suffix:semicolon
id|IP6_INC_STATS
c_func
(paren
id|IPSTATS_MIB_OUTREQUESTS
)paren
suffix:semicolon
id|snd_addr
op_assign
id|addr
suffix:semicolon
r_if
c_cond
(paren
id|type
op_eq
id|ICMPV6_MGM_REDUCTION
)paren
(brace
id|snd_addr
op_assign
op_amp
id|all_routers
suffix:semicolon
id|ipv6_addr_all_routers
c_func
(paren
op_amp
id|all_routers
)paren
suffix:semicolon
)brace
id|len
op_assign
r_sizeof
(paren
r_struct
id|icmp6hdr
)paren
op_plus
r_sizeof
(paren
r_struct
id|in6_addr
)paren
suffix:semicolon
id|payload_len
op_assign
id|len
op_plus
r_sizeof
(paren
id|ra
)paren
suffix:semicolon
id|full_len
op_assign
r_sizeof
(paren
r_struct
id|ipv6hdr
)paren
op_plus
id|payload_len
suffix:semicolon
id|skb
op_assign
id|sock_alloc_send_skb
c_func
(paren
id|sk
comma
id|LL_RESERVED_SPACE
c_func
(paren
id|dev
)paren
op_plus
id|full_len
comma
l_int|1
comma
op_amp
id|err
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_eq
l_int|NULL
)paren
(brace
id|IP6_INC_STATS
c_func
(paren
id|IPSTATS_MIB_OUTDISCARDS
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|skb_reserve
c_func
(paren
id|skb
comma
id|LL_RESERVED_SPACE
c_func
(paren
id|dev
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;hard_header
)paren
(brace
r_int
r_char
id|ha
(braket
id|MAX_ADDR_LEN
)braket
suffix:semicolon
id|ndisc_mc_map
c_func
(paren
id|snd_addr
comma
id|ha
comma
id|dev
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev
op_member_access_from_pointer
id|hard_header
c_func
(paren
id|skb
comma
id|dev
comma
id|ETH_P_IPV6
comma
id|ha
comma
l_int|NULL
comma
id|full_len
)paren
OL
l_int|0
)paren
r_goto
id|out
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ipv6_get_lladdr
c_func
(paren
id|dev
comma
op_amp
id|addr_buf
)paren
)paren
(brace
multiline_comment|/* &lt;draft-ietf-magma-mld-source-05.txt&gt;:&n;&t;&t; * use unspecified address as the source address &n;&t;&t; * when a valid link-local address is not available.&n;&t;&t; */
id|memset
c_func
(paren
op_amp
id|addr_buf
comma
l_int|0
comma
r_sizeof
(paren
id|addr_buf
)paren
)paren
suffix:semicolon
)brace
id|ip6_nd_hdr
c_func
(paren
id|sk
comma
id|skb
comma
id|dev
comma
op_amp
id|addr_buf
comma
id|snd_addr
comma
id|NEXTHDR_HOP
comma
id|payload_len
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|skb_put
c_func
(paren
id|skb
comma
r_sizeof
(paren
id|ra
)paren
)paren
comma
id|ra
comma
r_sizeof
(paren
id|ra
)paren
)paren
suffix:semicolon
id|hdr
op_assign
(paren
r_struct
id|icmp6hdr
op_star
)paren
id|skb_put
c_func
(paren
id|skb
comma
r_sizeof
(paren
r_struct
id|icmp6hdr
)paren
)paren
suffix:semicolon
id|memset
c_func
(paren
id|hdr
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|icmp6hdr
)paren
)paren
suffix:semicolon
id|hdr-&gt;icmp6_type
op_assign
id|type
suffix:semicolon
id|addrp
op_assign
(paren
r_struct
id|in6_addr
op_star
)paren
id|skb_put
c_func
(paren
id|skb
comma
r_sizeof
(paren
r_struct
id|in6_addr
)paren
)paren
suffix:semicolon
id|ipv6_addr_copy
c_func
(paren
id|addrp
comma
id|addr
)paren
suffix:semicolon
id|hdr-&gt;icmp6_cksum
op_assign
id|csum_ipv6_magic
c_func
(paren
op_amp
id|addr_buf
comma
id|snd_addr
comma
id|len
comma
id|IPPROTO_ICMPV6
comma
id|csum_partial
c_func
(paren
(paren
id|__u8
op_star
)paren
id|hdr
comma
id|len
comma
l_int|0
)paren
)paren
suffix:semicolon
id|idev
op_assign
id|in6_dev_get
c_func
(paren
id|skb-&gt;dev
)paren
suffix:semicolon
id|err
op_assign
id|NF_HOOK
c_func
(paren
id|PF_INET6
comma
id|NF_IP6_LOCAL_OUT
comma
id|skb
comma
l_int|NULL
comma
id|skb-&gt;dev
comma
id|dev_queue_xmit
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|err
)paren
(brace
r_if
c_cond
(paren
id|type
op_eq
id|ICMPV6_MGM_REDUCTION
)paren
id|ICMP6_INC_STATS
c_func
(paren
id|idev
comma
id|ICMP6_MIB_OUTGROUPMEMBREDUCTIONS
)paren
suffix:semicolon
r_else
id|ICMP6_INC_STATS
c_func
(paren
id|idev
comma
id|ICMP6_MIB_OUTGROUPMEMBRESPONSES
)paren
suffix:semicolon
id|ICMP6_INC_STATS
c_func
(paren
id|idev
comma
id|ICMP6_MIB_OUTMSGS
)paren
suffix:semicolon
id|IP6_INC_STATS
c_func
(paren
id|IPSTATS_MIB_OUTMCASTPKTS
)paren
suffix:semicolon
)brace
r_else
id|IP6_INC_STATS
c_func
(paren
id|IPSTATS_MIB_OUTDISCARDS
)paren
suffix:semicolon
r_if
c_cond
(paren
id|likely
c_func
(paren
id|idev
op_ne
l_int|NULL
)paren
)paren
id|in6_dev_put
c_func
(paren
id|idev
)paren
suffix:semicolon
r_return
suffix:semicolon
id|out
suffix:colon
id|IP6_INC_STATS
c_func
(paren
id|IPSTATS_MIB_OUTDISCARDS
)paren
suffix:semicolon
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
DECL|function|ip6_mc_del1_src
r_static
r_int
id|ip6_mc_del1_src
c_func
(paren
r_struct
id|ifmcaddr6
op_star
id|pmc
comma
r_int
id|sfmode
comma
r_struct
id|in6_addr
op_star
id|psfsrc
)paren
(brace
r_struct
id|ip6_sf_list
op_star
id|psf
comma
op_star
id|psf_prev
suffix:semicolon
r_int
id|rv
op_assign
l_int|0
suffix:semicolon
id|psf_prev
op_assign
l_int|NULL
suffix:semicolon
r_for
c_loop
(paren
id|psf
op_assign
id|pmc-&gt;mca_sources
suffix:semicolon
id|psf
suffix:semicolon
id|psf
op_assign
id|psf-&gt;sf_next
)paren
(brace
r_if
c_cond
(paren
id|ipv6_addr_equal
c_func
(paren
op_amp
id|psf-&gt;sf_addr
comma
id|psfsrc
)paren
)paren
r_break
suffix:semicolon
id|psf_prev
op_assign
id|psf
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|psf
op_logical_or
id|psf-&gt;sf_count
(braket
id|sfmode
)braket
op_eq
l_int|0
)paren
(brace
multiline_comment|/* source filter not found, or count wrong =&gt;  bug */
r_return
op_minus
id|ESRCH
suffix:semicolon
)brace
id|psf-&gt;sf_count
(braket
id|sfmode
)braket
op_decrement
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|psf-&gt;sf_count
(braket
id|MCAST_INCLUDE
)braket
op_logical_and
op_logical_neg
id|psf-&gt;sf_count
(braket
id|MCAST_EXCLUDE
)braket
)paren
(brace
r_struct
id|inet6_dev
op_star
id|idev
op_assign
id|pmc-&gt;idev
suffix:semicolon
multiline_comment|/* no more filters for this source */
r_if
c_cond
(paren
id|psf_prev
)paren
id|psf_prev-&gt;sf_next
op_assign
id|psf-&gt;sf_next
suffix:semicolon
r_else
id|pmc-&gt;mca_sources
op_assign
id|psf-&gt;sf_next
suffix:semicolon
r_if
c_cond
(paren
id|psf-&gt;sf_oldin
op_logical_and
op_logical_neg
(paren
id|pmc-&gt;mca_flags
op_amp
id|MAF_NOREPORT
)paren
op_logical_and
op_logical_neg
id|MLD_V1_SEEN
c_func
(paren
id|idev
)paren
)paren
(brace
id|psf-&gt;sf_crcount
op_assign
id|idev-&gt;mc_qrv
suffix:semicolon
id|psf-&gt;sf_next
op_assign
id|pmc-&gt;mca_tomb
suffix:semicolon
id|pmc-&gt;mca_tomb
op_assign
id|psf
suffix:semicolon
id|rv
op_assign
l_int|1
suffix:semicolon
)brace
r_else
id|kfree
c_func
(paren
id|psf
)paren
suffix:semicolon
)brace
r_return
id|rv
suffix:semicolon
)brace
DECL|function|ip6_mc_del_src
r_int
id|ip6_mc_del_src
c_func
(paren
r_struct
id|inet6_dev
op_star
id|idev
comma
r_struct
id|in6_addr
op_star
id|pmca
comma
r_int
id|sfmode
comma
r_int
id|sfcount
comma
r_struct
id|in6_addr
op_star
id|psfsrc
comma
r_int
id|delta
)paren
(brace
r_struct
id|ifmcaddr6
op_star
id|pmc
suffix:semicolon
r_int
id|changerec
op_assign
l_int|0
suffix:semicolon
r_int
id|i
comma
id|err
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|idev
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|read_lock_bh
c_func
(paren
op_amp
id|idev-&gt;lock
)paren
suffix:semicolon
r_for
c_loop
(paren
id|pmc
op_assign
id|idev-&gt;mc_list
suffix:semicolon
id|pmc
suffix:semicolon
id|pmc
op_assign
id|pmc-&gt;next
)paren
(brace
r_if
c_cond
(paren
id|ipv6_addr_equal
c_func
(paren
id|pmca
comma
op_amp
id|pmc-&gt;mca_addr
)paren
)paren
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|pmc
)paren
(brace
multiline_comment|/* MCA not found?? bug */
id|read_unlock_bh
c_func
(paren
op_amp
id|idev-&gt;lock
)paren
suffix:semicolon
r_return
op_minus
id|ESRCH
suffix:semicolon
)brace
id|spin_lock_bh
c_func
(paren
op_amp
id|pmc-&gt;mca_lock
)paren
suffix:semicolon
id|sf_markstate
c_func
(paren
id|pmc
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|delta
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|pmc-&gt;mca_sfcount
(braket
id|sfmode
)braket
)paren
(brace
id|spin_unlock_bh
c_func
(paren
op_amp
id|pmc-&gt;mca_lock
)paren
suffix:semicolon
id|read_unlock_bh
c_func
(paren
op_amp
id|idev-&gt;lock
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|pmc-&gt;mca_sfcount
(braket
id|sfmode
)braket
op_decrement
suffix:semicolon
)brace
id|err
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|sfcount
suffix:semicolon
id|i
op_increment
)paren
(brace
r_int
id|rv
op_assign
id|ip6_mc_del1_src
c_func
(paren
id|pmc
comma
id|sfmode
comma
op_amp
id|psfsrc
(braket
id|i
)braket
)paren
suffix:semicolon
id|changerec
op_or_assign
id|rv
OG
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|err
op_logical_and
id|rv
OL
l_int|0
)paren
id|err
op_assign
id|rv
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pmc-&gt;mca_sfmode
op_eq
id|MCAST_EXCLUDE
op_logical_and
id|pmc-&gt;mca_sfcount
(braket
id|MCAST_EXCLUDE
)braket
op_eq
l_int|0
op_logical_and
id|pmc-&gt;mca_sfcount
(braket
id|MCAST_INCLUDE
)braket
)paren
(brace
r_struct
id|ip6_sf_list
op_star
id|psf
suffix:semicolon
multiline_comment|/* filter mode change */
id|pmc-&gt;mca_sfmode
op_assign
id|MCAST_INCLUDE
suffix:semicolon
id|pmc-&gt;mca_crcount
op_assign
id|idev-&gt;mc_qrv
suffix:semicolon
id|idev-&gt;mc_ifc_count
op_assign
id|pmc-&gt;mca_crcount
suffix:semicolon
r_for
c_loop
(paren
id|psf
op_assign
id|pmc-&gt;mca_sources
suffix:semicolon
id|psf
suffix:semicolon
id|psf
op_assign
id|psf-&gt;sf_next
)paren
id|psf-&gt;sf_crcount
op_assign
l_int|0
suffix:semicolon
id|mld_ifc_event
c_func
(paren
id|pmc-&gt;idev
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|sf_setstate
c_func
(paren
id|pmc
)paren
op_logical_or
id|changerec
)paren
id|mld_ifc_event
c_func
(paren
id|pmc-&gt;idev
)paren
suffix:semicolon
id|spin_unlock_bh
c_func
(paren
op_amp
id|pmc-&gt;mca_lock
)paren
suffix:semicolon
id|read_unlock_bh
c_func
(paren
op_amp
id|idev-&gt;lock
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
multiline_comment|/*&n; * Add multicast single-source filter to the interface list&n; */
DECL|function|ip6_mc_add1_src
r_static
r_int
id|ip6_mc_add1_src
c_func
(paren
r_struct
id|ifmcaddr6
op_star
id|pmc
comma
r_int
id|sfmode
comma
r_struct
id|in6_addr
op_star
id|psfsrc
comma
r_int
id|delta
)paren
(brace
r_struct
id|ip6_sf_list
op_star
id|psf
comma
op_star
id|psf_prev
suffix:semicolon
id|psf_prev
op_assign
l_int|NULL
suffix:semicolon
r_for
c_loop
(paren
id|psf
op_assign
id|pmc-&gt;mca_sources
suffix:semicolon
id|psf
suffix:semicolon
id|psf
op_assign
id|psf-&gt;sf_next
)paren
(brace
r_if
c_cond
(paren
id|ipv6_addr_equal
c_func
(paren
op_amp
id|psf-&gt;sf_addr
comma
id|psfsrc
)paren
)paren
r_break
suffix:semicolon
id|psf_prev
op_assign
id|psf
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|psf
)paren
(brace
id|psf
op_assign
(paren
r_struct
id|ip6_sf_list
op_star
)paren
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|psf
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|psf
)paren
r_return
op_minus
id|ENOBUFS
suffix:semicolon
id|memset
c_func
(paren
id|psf
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|psf
)paren
)paren
suffix:semicolon
id|psf-&gt;sf_addr
op_assign
op_star
id|psfsrc
suffix:semicolon
r_if
c_cond
(paren
id|psf_prev
)paren
(brace
id|psf_prev-&gt;sf_next
op_assign
id|psf
suffix:semicolon
)brace
r_else
id|pmc-&gt;mca_sources
op_assign
id|psf
suffix:semicolon
)brace
id|psf-&gt;sf_count
(braket
id|sfmode
)braket
op_increment
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sf_markstate
r_static
r_void
id|sf_markstate
c_func
(paren
r_struct
id|ifmcaddr6
op_star
id|pmc
)paren
(brace
r_struct
id|ip6_sf_list
op_star
id|psf
suffix:semicolon
r_int
id|mca_xcount
op_assign
id|pmc-&gt;mca_sfcount
(braket
id|MCAST_EXCLUDE
)braket
suffix:semicolon
r_for
c_loop
(paren
id|psf
op_assign
id|pmc-&gt;mca_sources
suffix:semicolon
id|psf
suffix:semicolon
id|psf
op_assign
id|psf-&gt;sf_next
)paren
r_if
c_cond
(paren
id|pmc-&gt;mca_sfcount
(braket
id|MCAST_EXCLUDE
)braket
)paren
(brace
id|psf-&gt;sf_oldin
op_assign
id|mca_xcount
op_eq
id|psf-&gt;sf_count
(braket
id|MCAST_EXCLUDE
)braket
op_logical_and
op_logical_neg
id|psf-&gt;sf_count
(braket
id|MCAST_INCLUDE
)braket
suffix:semicolon
)brace
r_else
id|psf-&gt;sf_oldin
op_assign
id|psf-&gt;sf_count
(braket
id|MCAST_INCLUDE
)braket
op_ne
l_int|0
suffix:semicolon
)brace
DECL|function|sf_setstate
r_static
r_int
id|sf_setstate
c_func
(paren
r_struct
id|ifmcaddr6
op_star
id|pmc
)paren
(brace
r_struct
id|ip6_sf_list
op_star
id|psf
suffix:semicolon
r_int
id|mca_xcount
op_assign
id|pmc-&gt;mca_sfcount
(braket
id|MCAST_EXCLUDE
)braket
suffix:semicolon
r_int
id|qrv
op_assign
id|pmc-&gt;idev-&gt;mc_qrv
suffix:semicolon
r_int
id|new_in
comma
id|rv
suffix:semicolon
id|rv
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|psf
op_assign
id|pmc-&gt;mca_sources
suffix:semicolon
id|psf
suffix:semicolon
id|psf
op_assign
id|psf-&gt;sf_next
)paren
(brace
r_if
c_cond
(paren
id|pmc-&gt;mca_sfcount
(braket
id|MCAST_EXCLUDE
)braket
)paren
(brace
id|new_in
op_assign
id|mca_xcount
op_eq
id|psf-&gt;sf_count
(braket
id|MCAST_EXCLUDE
)braket
op_logical_and
op_logical_neg
id|psf-&gt;sf_count
(braket
id|MCAST_INCLUDE
)braket
suffix:semicolon
)brace
r_else
id|new_in
op_assign
id|psf-&gt;sf_count
(braket
id|MCAST_INCLUDE
)braket
op_ne
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|new_in
op_ne
id|psf-&gt;sf_oldin
)paren
(brace
id|psf-&gt;sf_crcount
op_assign
id|qrv
suffix:semicolon
id|rv
op_increment
suffix:semicolon
)brace
)brace
r_return
id|rv
suffix:semicolon
)brace
multiline_comment|/*&n; * Add multicast source filter list to the interface list&n; */
DECL|function|ip6_mc_add_src
r_int
id|ip6_mc_add_src
c_func
(paren
r_struct
id|inet6_dev
op_star
id|idev
comma
r_struct
id|in6_addr
op_star
id|pmca
comma
r_int
id|sfmode
comma
r_int
id|sfcount
comma
r_struct
id|in6_addr
op_star
id|psfsrc
comma
r_int
id|delta
)paren
(brace
r_struct
id|ifmcaddr6
op_star
id|pmc
suffix:semicolon
r_int
id|isexclude
suffix:semicolon
r_int
id|i
comma
id|err
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|idev
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|read_lock_bh
c_func
(paren
op_amp
id|idev-&gt;lock
)paren
suffix:semicolon
r_for
c_loop
(paren
id|pmc
op_assign
id|idev-&gt;mc_list
suffix:semicolon
id|pmc
suffix:semicolon
id|pmc
op_assign
id|pmc-&gt;next
)paren
(brace
r_if
c_cond
(paren
id|ipv6_addr_equal
c_func
(paren
id|pmca
comma
op_amp
id|pmc-&gt;mca_addr
)paren
)paren
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|pmc
)paren
(brace
multiline_comment|/* MCA not found?? bug */
id|read_unlock_bh
c_func
(paren
op_amp
id|idev-&gt;lock
)paren
suffix:semicolon
r_return
op_minus
id|ESRCH
suffix:semicolon
)brace
id|spin_lock_bh
c_func
(paren
op_amp
id|pmc-&gt;mca_lock
)paren
suffix:semicolon
id|sf_markstate
c_func
(paren
id|pmc
)paren
suffix:semicolon
id|isexclude
op_assign
id|pmc-&gt;mca_sfmode
op_eq
id|MCAST_EXCLUDE
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|delta
)paren
id|pmc-&gt;mca_sfcount
(braket
id|sfmode
)braket
op_increment
suffix:semicolon
id|err
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|sfcount
suffix:semicolon
id|i
op_increment
)paren
(brace
id|err
op_assign
id|ip6_mc_add1_src
c_func
(paren
id|pmc
comma
id|sfmode
comma
op_amp
id|psfsrc
(braket
id|i
)braket
comma
id|delta
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|err
)paren
(brace
r_int
id|j
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|delta
)paren
id|pmc-&gt;mca_sfcount
(braket
id|sfmode
)braket
op_decrement
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|i
suffix:semicolon
id|j
op_increment
)paren
(paren
r_void
)paren
id|ip6_mc_del1_src
c_func
(paren
id|pmc
comma
id|sfmode
comma
op_amp
id|psfsrc
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|isexclude
op_ne
(paren
id|pmc-&gt;mca_sfcount
(braket
id|MCAST_EXCLUDE
)braket
op_ne
l_int|0
)paren
)paren
(brace
r_struct
id|inet6_dev
op_star
id|idev
op_assign
id|pmc-&gt;idev
suffix:semicolon
r_struct
id|ip6_sf_list
op_star
id|psf
suffix:semicolon
multiline_comment|/* filter mode change */
r_if
c_cond
(paren
id|pmc-&gt;mca_sfcount
(braket
id|MCAST_EXCLUDE
)braket
)paren
id|pmc-&gt;mca_sfmode
op_assign
id|MCAST_EXCLUDE
suffix:semicolon
r_else
r_if
c_cond
(paren
id|pmc-&gt;mca_sfcount
(braket
id|MCAST_INCLUDE
)braket
)paren
id|pmc-&gt;mca_sfmode
op_assign
id|MCAST_INCLUDE
suffix:semicolon
multiline_comment|/* else no filters; keep old mode for reports */
id|pmc-&gt;mca_crcount
op_assign
id|idev-&gt;mc_qrv
suffix:semicolon
id|idev-&gt;mc_ifc_count
op_assign
id|pmc-&gt;mca_crcount
suffix:semicolon
r_for
c_loop
(paren
id|psf
op_assign
id|pmc-&gt;mca_sources
suffix:semicolon
id|psf
suffix:semicolon
id|psf
op_assign
id|psf-&gt;sf_next
)paren
id|psf-&gt;sf_crcount
op_assign
l_int|0
suffix:semicolon
id|mld_ifc_event
c_func
(paren
id|idev
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|sf_setstate
c_func
(paren
id|pmc
)paren
)paren
id|mld_ifc_event
c_func
(paren
id|idev
)paren
suffix:semicolon
id|spin_unlock_bh
c_func
(paren
op_amp
id|pmc-&gt;mca_lock
)paren
suffix:semicolon
id|read_unlock_bh
c_func
(paren
op_amp
id|idev-&gt;lock
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|ip6_mc_clear_src
r_static
r_void
id|ip6_mc_clear_src
c_func
(paren
r_struct
id|ifmcaddr6
op_star
id|pmc
)paren
(brace
r_struct
id|ip6_sf_list
op_star
id|psf
comma
op_star
id|nextpsf
suffix:semicolon
r_for
c_loop
(paren
id|psf
op_assign
id|pmc-&gt;mca_tomb
suffix:semicolon
id|psf
suffix:semicolon
id|psf
op_assign
id|nextpsf
)paren
(brace
id|nextpsf
op_assign
id|psf-&gt;sf_next
suffix:semicolon
id|kfree
c_func
(paren
id|psf
)paren
suffix:semicolon
)brace
id|pmc-&gt;mca_tomb
op_assign
l_int|NULL
suffix:semicolon
r_for
c_loop
(paren
id|psf
op_assign
id|pmc-&gt;mca_sources
suffix:semicolon
id|psf
suffix:semicolon
id|psf
op_assign
id|nextpsf
)paren
(brace
id|nextpsf
op_assign
id|psf-&gt;sf_next
suffix:semicolon
id|kfree
c_func
(paren
id|psf
)paren
suffix:semicolon
)brace
id|pmc-&gt;mca_sources
op_assign
l_int|NULL
suffix:semicolon
id|pmc-&gt;mca_sfmode
op_assign
id|MCAST_EXCLUDE
suffix:semicolon
id|pmc-&gt;mca_sfcount
(braket
id|MCAST_EXCLUDE
)braket
op_assign
l_int|0
suffix:semicolon
id|pmc-&gt;mca_sfcount
(braket
id|MCAST_EXCLUDE
)braket
op_assign
l_int|1
suffix:semicolon
)brace
DECL|function|igmp6_join_group
r_static
r_void
id|igmp6_join_group
c_func
(paren
r_struct
id|ifmcaddr6
op_star
id|ma
)paren
(brace
r_int
r_int
id|delay
suffix:semicolon
r_if
c_cond
(paren
id|ma-&gt;mca_flags
op_amp
id|MAF_NOREPORT
)paren
r_return
suffix:semicolon
id|igmp6_send
c_func
(paren
op_amp
id|ma-&gt;mca_addr
comma
id|ma-&gt;idev-&gt;dev
comma
id|ICMPV6_MGM_REPORT
)paren
suffix:semicolon
id|delay
op_assign
id|net_random
c_func
(paren
)paren
op_mod
id|IGMP6_UNSOLICITED_IVAL
suffix:semicolon
id|spin_lock_bh
c_func
(paren
op_amp
id|ma-&gt;mca_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|del_timer
c_func
(paren
op_amp
id|ma-&gt;mca_timer
)paren
)paren
(brace
id|atomic_dec
c_func
(paren
op_amp
id|ma-&gt;mca_refcnt
)paren
suffix:semicolon
id|delay
op_assign
id|ma-&gt;mca_timer.expires
op_minus
id|jiffies
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|mod_timer
c_func
(paren
op_amp
id|ma-&gt;mca_timer
comma
id|jiffies
op_plus
id|delay
)paren
)paren
id|atomic_inc
c_func
(paren
op_amp
id|ma-&gt;mca_refcnt
)paren
suffix:semicolon
id|ma-&gt;mca_flags
op_or_assign
id|MAF_TIMER_RUNNING
op_or
id|MAF_LAST_REPORTER
suffix:semicolon
id|spin_unlock_bh
c_func
(paren
op_amp
id|ma-&gt;mca_lock
)paren
suffix:semicolon
)brace
DECL|function|ip6_mc_leave_src
r_int
id|ip6_mc_leave_src
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_struct
id|ipv6_mc_socklist
op_star
id|iml
comma
r_struct
id|inet6_dev
op_star
id|idev
)paren
(brace
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
id|iml-&gt;sflist
op_eq
l_int|0
)paren
(brace
multiline_comment|/* any-source empty exclude case */
r_return
id|ip6_mc_del_src
c_func
(paren
id|idev
comma
op_amp
id|iml-&gt;addr
comma
id|iml-&gt;sfmode
comma
l_int|0
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
)brace
id|err
op_assign
id|ip6_mc_del_src
c_func
(paren
id|idev
comma
op_amp
id|iml-&gt;addr
comma
id|iml-&gt;sfmode
comma
id|iml-&gt;sflist-&gt;sl_count
comma
id|iml-&gt;sflist-&gt;sl_addr
comma
l_int|0
)paren
suffix:semicolon
id|sock_kfree_s
c_func
(paren
id|sk
comma
id|iml-&gt;sflist
comma
id|IP6_SFLSIZE
c_func
(paren
id|iml-&gt;sflist-&gt;sl_max
)paren
)paren
suffix:semicolon
id|iml-&gt;sflist
op_assign
l_int|NULL
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|igmp6_leave_group
r_static
r_void
id|igmp6_leave_group
c_func
(paren
r_struct
id|ifmcaddr6
op_star
id|ma
)paren
(brace
r_if
c_cond
(paren
id|MLD_V1_SEEN
c_func
(paren
id|ma-&gt;idev
)paren
)paren
(brace
r_if
c_cond
(paren
id|ma-&gt;mca_flags
op_amp
id|MAF_LAST_REPORTER
)paren
id|igmp6_send
c_func
(paren
op_amp
id|ma-&gt;mca_addr
comma
id|ma-&gt;idev-&gt;dev
comma
id|ICMPV6_MGM_REDUCTION
)paren
suffix:semicolon
)brace
r_else
(brace
id|mld_add_delrec
c_func
(paren
id|ma-&gt;idev
comma
id|ma
)paren
suffix:semicolon
id|mld_ifc_event
c_func
(paren
id|ma-&gt;idev
)paren
suffix:semicolon
)brace
)brace
DECL|function|mld_gq_timer_expire
r_static
r_void
id|mld_gq_timer_expire
c_func
(paren
r_int
r_int
id|data
)paren
(brace
r_struct
id|inet6_dev
op_star
id|idev
op_assign
(paren
r_struct
id|inet6_dev
op_star
)paren
id|data
suffix:semicolon
id|idev-&gt;mc_gq_running
op_assign
l_int|0
suffix:semicolon
id|mld_send_report
c_func
(paren
id|idev
comma
l_int|NULL
)paren
suffix:semicolon
id|__in6_dev_put
c_func
(paren
id|idev
)paren
suffix:semicolon
)brace
DECL|function|mld_ifc_timer_expire
r_static
r_void
id|mld_ifc_timer_expire
c_func
(paren
r_int
r_int
id|data
)paren
(brace
r_struct
id|inet6_dev
op_star
id|idev
op_assign
(paren
r_struct
id|inet6_dev
op_star
)paren
id|data
suffix:semicolon
id|mld_send_cr
c_func
(paren
id|idev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|idev-&gt;mc_ifc_count
)paren
(brace
id|idev-&gt;mc_ifc_count
op_decrement
suffix:semicolon
r_if
c_cond
(paren
id|idev-&gt;mc_ifc_count
)paren
id|mld_ifc_start_timer
c_func
(paren
id|idev
comma
id|idev-&gt;mc_maxdelay
)paren
suffix:semicolon
)brace
id|__in6_dev_put
c_func
(paren
id|idev
)paren
suffix:semicolon
)brace
DECL|function|mld_ifc_event
r_static
r_void
id|mld_ifc_event
c_func
(paren
r_struct
id|inet6_dev
op_star
id|idev
)paren
(brace
r_if
c_cond
(paren
id|MLD_V1_SEEN
c_func
(paren
id|idev
)paren
)paren
r_return
suffix:semicolon
id|idev-&gt;mc_ifc_count
op_assign
id|idev-&gt;mc_qrv
suffix:semicolon
id|mld_ifc_start_timer
c_func
(paren
id|idev
comma
l_int|1
)paren
suffix:semicolon
)brace
DECL|function|igmp6_timer_handler
r_static
r_void
id|igmp6_timer_handler
c_func
(paren
r_int
r_int
id|data
)paren
(brace
r_struct
id|ifmcaddr6
op_star
id|ma
op_assign
(paren
r_struct
id|ifmcaddr6
op_star
)paren
id|data
suffix:semicolon
r_if
c_cond
(paren
id|MLD_V1_SEEN
c_func
(paren
id|ma-&gt;idev
)paren
)paren
id|igmp6_send
c_func
(paren
op_amp
id|ma-&gt;mca_addr
comma
id|ma-&gt;idev-&gt;dev
comma
id|ICMPV6_MGM_REPORT
)paren
suffix:semicolon
r_else
id|mld_send_report
c_func
(paren
id|ma-&gt;idev
comma
id|ma
)paren
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|ma-&gt;mca_lock
)paren
suffix:semicolon
id|ma-&gt;mca_flags
op_or_assign
id|MAF_LAST_REPORTER
suffix:semicolon
id|ma-&gt;mca_flags
op_and_assign
op_complement
id|MAF_TIMER_RUNNING
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|ma-&gt;mca_lock
)paren
suffix:semicolon
id|ma_put
c_func
(paren
id|ma
)paren
suffix:semicolon
)brace
multiline_comment|/* Device going down */
DECL|function|ipv6_mc_down
r_void
id|ipv6_mc_down
c_func
(paren
r_struct
id|inet6_dev
op_star
id|idev
)paren
(brace
r_struct
id|ifmcaddr6
op_star
id|i
suffix:semicolon
multiline_comment|/* Withdraw multicast list */
id|read_lock_bh
c_func
(paren
op_amp
id|idev-&gt;lock
)paren
suffix:semicolon
id|idev-&gt;mc_ifc_count
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|del_timer
c_func
(paren
op_amp
id|idev-&gt;mc_ifc_timer
)paren
)paren
id|__in6_dev_put
c_func
(paren
id|idev
)paren
suffix:semicolon
id|idev-&gt;mc_gq_running
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|del_timer
c_func
(paren
op_amp
id|idev-&gt;mc_gq_timer
)paren
)paren
id|__in6_dev_put
c_func
(paren
id|idev
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|idev-&gt;mc_list
suffix:semicolon
id|i
suffix:semicolon
id|i
op_assign
id|i-&gt;next
)paren
id|igmp6_group_dropped
c_func
(paren
id|i
)paren
suffix:semicolon
id|read_unlock_bh
c_func
(paren
op_amp
id|idev-&gt;lock
)paren
suffix:semicolon
id|mld_clear_delrec
c_func
(paren
id|idev
)paren
suffix:semicolon
)brace
multiline_comment|/* Device going up */
DECL|function|ipv6_mc_up
r_void
id|ipv6_mc_up
c_func
(paren
r_struct
id|inet6_dev
op_star
id|idev
)paren
(brace
r_struct
id|ifmcaddr6
op_star
id|i
suffix:semicolon
multiline_comment|/* Install multicast list, except for all-nodes (already installed) */
id|read_lock_bh
c_func
(paren
op_amp
id|idev-&gt;lock
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|idev-&gt;mc_list
suffix:semicolon
id|i
suffix:semicolon
id|i
op_assign
id|i-&gt;next
)paren
id|igmp6_group_added
c_func
(paren
id|i
)paren
suffix:semicolon
id|read_unlock_bh
c_func
(paren
op_amp
id|idev-&gt;lock
)paren
suffix:semicolon
)brace
multiline_comment|/* IPv6 device initialization. */
DECL|function|ipv6_mc_init_dev
r_void
id|ipv6_mc_init_dev
c_func
(paren
r_struct
id|inet6_dev
op_star
id|idev
)paren
(brace
r_struct
id|in6_addr
id|maddr
suffix:semicolon
id|write_lock_bh
c_func
(paren
op_amp
id|idev-&gt;lock
)paren
suffix:semicolon
id|rwlock_init
c_func
(paren
op_amp
id|idev-&gt;mc_lock
)paren
suffix:semicolon
id|idev-&gt;mc_gq_running
op_assign
l_int|0
suffix:semicolon
id|init_timer
c_func
(paren
op_amp
id|idev-&gt;mc_gq_timer
)paren
suffix:semicolon
id|idev-&gt;mc_gq_timer.data
op_assign
(paren
r_int
r_int
)paren
id|idev
suffix:semicolon
id|idev-&gt;mc_gq_timer.function
op_assign
op_amp
id|mld_gq_timer_expire
suffix:semicolon
id|idev-&gt;mc_tomb
op_assign
l_int|NULL
suffix:semicolon
id|idev-&gt;mc_ifc_count
op_assign
l_int|0
suffix:semicolon
id|init_timer
c_func
(paren
op_amp
id|idev-&gt;mc_ifc_timer
)paren
suffix:semicolon
id|idev-&gt;mc_ifc_timer.data
op_assign
(paren
r_int
r_int
)paren
id|idev
suffix:semicolon
id|idev-&gt;mc_ifc_timer.function
op_assign
op_amp
id|mld_ifc_timer_expire
suffix:semicolon
id|idev-&gt;mc_qrv
op_assign
id|MLD_QRV_DEFAULT
suffix:semicolon
id|idev-&gt;mc_maxdelay
op_assign
id|IGMP6_UNSOLICITED_IVAL
suffix:semicolon
id|idev-&gt;mc_v1_seen
op_assign
l_int|0
suffix:semicolon
id|write_unlock_bh
c_func
(paren
op_amp
id|idev-&gt;lock
)paren
suffix:semicolon
multiline_comment|/* Add all-nodes address. */
id|ipv6_addr_all_nodes
c_func
(paren
op_amp
id|maddr
)paren
suffix:semicolon
id|ipv6_dev_mc_inc
c_func
(paren
id|idev-&gt;dev
comma
op_amp
id|maddr
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;Device is about to be destroyed: clean up.&n; */
DECL|function|ipv6_mc_destroy_dev
r_void
id|ipv6_mc_destroy_dev
c_func
(paren
r_struct
id|inet6_dev
op_star
id|idev
)paren
(brace
r_struct
id|ifmcaddr6
op_star
id|i
suffix:semicolon
r_struct
id|in6_addr
id|maddr
suffix:semicolon
multiline_comment|/* Deactivate timers */
id|ipv6_mc_down
c_func
(paren
id|idev
)paren
suffix:semicolon
multiline_comment|/* Delete all-nodes address. */
id|ipv6_addr_all_nodes
c_func
(paren
op_amp
id|maddr
)paren
suffix:semicolon
multiline_comment|/* We cannot call ipv6_dev_mc_dec() directly, our caller in&n;&t; * addrconf.c has NULL&squot;d out dev-&gt;ip6_ptr so in6_dev_get() will&n;&t; * fail.&n;&t; */
id|__ipv6_dev_mc_dec
c_func
(paren
id|idev
comma
op_amp
id|maddr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|idev-&gt;cnf.forwarding
)paren
(brace
id|ipv6_addr_all_routers
c_func
(paren
op_amp
id|maddr
)paren
suffix:semicolon
id|__ipv6_dev_mc_dec
c_func
(paren
id|idev
comma
op_amp
id|maddr
)paren
suffix:semicolon
)brace
id|write_lock_bh
c_func
(paren
op_amp
id|idev-&gt;lock
)paren
suffix:semicolon
r_while
c_loop
(paren
(paren
id|i
op_assign
id|idev-&gt;mc_list
)paren
op_ne
l_int|NULL
)paren
(brace
id|idev-&gt;mc_list
op_assign
id|i-&gt;next
suffix:semicolon
id|write_unlock_bh
c_func
(paren
op_amp
id|idev-&gt;lock
)paren
suffix:semicolon
id|igmp6_group_dropped
c_func
(paren
id|i
)paren
suffix:semicolon
id|ma_put
c_func
(paren
id|i
)paren
suffix:semicolon
id|write_lock_bh
c_func
(paren
op_amp
id|idev-&gt;lock
)paren
suffix:semicolon
)brace
id|write_unlock_bh
c_func
(paren
op_amp
id|idev-&gt;lock
)paren
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_PROC_FS
DECL|struct|igmp6_mc_iter_state
r_struct
id|igmp6_mc_iter_state
(brace
DECL|member|dev
r_struct
id|net_device
op_star
id|dev
suffix:semicolon
DECL|member|idev
r_struct
id|inet6_dev
op_star
id|idev
suffix:semicolon
)brace
suffix:semicolon
DECL|macro|igmp6_mc_seq_private
mdefine_line|#define igmp6_mc_seq_private(seq)&t;((struct igmp6_mc_iter_state *)(seq)-&gt;private)
DECL|function|igmp6_mc_get_first
r_static
r_inline
r_struct
id|ifmcaddr6
op_star
id|igmp6_mc_get_first
c_func
(paren
r_struct
id|seq_file
op_star
id|seq
)paren
(brace
r_struct
id|ifmcaddr6
op_star
id|im
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|igmp6_mc_iter_state
op_star
id|state
op_assign
id|igmp6_mc_seq_private
c_func
(paren
id|seq
)paren
suffix:semicolon
r_for
c_loop
(paren
id|state-&gt;dev
op_assign
id|dev_base
comma
id|state-&gt;idev
op_assign
l_int|NULL
suffix:semicolon
id|state-&gt;dev
suffix:semicolon
id|state-&gt;dev
op_assign
id|state-&gt;dev-&gt;next
)paren
(brace
r_struct
id|inet6_dev
op_star
id|idev
suffix:semicolon
id|idev
op_assign
id|in6_dev_get
c_func
(paren
id|state-&gt;dev
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|idev
)paren
r_continue
suffix:semicolon
id|read_lock_bh
c_func
(paren
op_amp
id|idev-&gt;lock
)paren
suffix:semicolon
id|im
op_assign
id|idev-&gt;mc_list
suffix:semicolon
r_if
c_cond
(paren
id|im
)paren
(brace
id|state-&gt;idev
op_assign
id|idev
suffix:semicolon
r_break
suffix:semicolon
)brace
id|read_unlock_bh
c_func
(paren
op_amp
id|idev-&gt;lock
)paren
suffix:semicolon
id|in6_dev_put
c_func
(paren
id|idev
)paren
suffix:semicolon
)brace
r_return
id|im
suffix:semicolon
)brace
DECL|function|igmp6_mc_get_next
r_static
r_struct
id|ifmcaddr6
op_star
id|igmp6_mc_get_next
c_func
(paren
r_struct
id|seq_file
op_star
id|seq
comma
r_struct
id|ifmcaddr6
op_star
id|im
)paren
(brace
r_struct
id|igmp6_mc_iter_state
op_star
id|state
op_assign
id|igmp6_mc_seq_private
c_func
(paren
id|seq
)paren
suffix:semicolon
id|im
op_assign
id|im-&gt;next
suffix:semicolon
r_while
c_loop
(paren
op_logical_neg
id|im
)paren
(brace
r_if
c_cond
(paren
id|likely
c_func
(paren
id|state-&gt;idev
op_ne
l_int|NULL
)paren
)paren
(brace
id|read_unlock_bh
c_func
(paren
op_amp
id|state-&gt;idev-&gt;lock
)paren
suffix:semicolon
id|in6_dev_put
c_func
(paren
id|state-&gt;idev
)paren
suffix:semicolon
)brace
id|state-&gt;dev
op_assign
id|state-&gt;dev-&gt;next
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|state-&gt;dev
)paren
(brace
id|state-&gt;idev
op_assign
l_int|NULL
suffix:semicolon
r_break
suffix:semicolon
)brace
id|state-&gt;idev
op_assign
id|in6_dev_get
c_func
(paren
id|state-&gt;dev
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|state-&gt;idev
)paren
r_continue
suffix:semicolon
id|read_lock_bh
c_func
(paren
op_amp
id|state-&gt;idev-&gt;lock
)paren
suffix:semicolon
id|im
op_assign
id|state-&gt;idev-&gt;mc_list
suffix:semicolon
)brace
r_return
id|im
suffix:semicolon
)brace
DECL|function|igmp6_mc_get_idx
r_static
r_struct
id|ifmcaddr6
op_star
id|igmp6_mc_get_idx
c_func
(paren
r_struct
id|seq_file
op_star
id|seq
comma
id|loff_t
id|pos
)paren
(brace
r_struct
id|ifmcaddr6
op_star
id|im
op_assign
id|igmp6_mc_get_first
c_func
(paren
id|seq
)paren
suffix:semicolon
r_if
c_cond
(paren
id|im
)paren
r_while
c_loop
(paren
id|pos
op_logical_and
(paren
id|im
op_assign
id|igmp6_mc_get_next
c_func
(paren
id|seq
comma
id|im
)paren
)paren
op_ne
l_int|NULL
)paren
op_decrement
id|pos
suffix:semicolon
r_return
id|pos
ques
c_cond
l_int|NULL
suffix:colon
id|im
suffix:semicolon
)brace
DECL|function|igmp6_mc_seq_start
r_static
r_void
op_star
id|igmp6_mc_seq_start
c_func
(paren
r_struct
id|seq_file
op_star
id|seq
comma
id|loff_t
op_star
id|pos
)paren
(brace
id|read_lock
c_func
(paren
op_amp
id|dev_base_lock
)paren
suffix:semicolon
r_return
id|igmp6_mc_get_idx
c_func
(paren
id|seq
comma
op_star
id|pos
)paren
suffix:semicolon
)brace
DECL|function|igmp6_mc_seq_next
r_static
r_void
op_star
id|igmp6_mc_seq_next
c_func
(paren
r_struct
id|seq_file
op_star
id|seq
comma
r_void
op_star
id|v
comma
id|loff_t
op_star
id|pos
)paren
(brace
r_struct
id|ifmcaddr6
op_star
id|im
suffix:semicolon
id|im
op_assign
id|igmp6_mc_get_next
c_func
(paren
id|seq
comma
id|v
)paren
suffix:semicolon
op_increment
op_star
id|pos
suffix:semicolon
r_return
id|im
suffix:semicolon
)brace
DECL|function|igmp6_mc_seq_stop
r_static
r_void
id|igmp6_mc_seq_stop
c_func
(paren
r_struct
id|seq_file
op_star
id|seq
comma
r_void
op_star
id|v
)paren
(brace
r_struct
id|igmp6_mc_iter_state
op_star
id|state
op_assign
id|igmp6_mc_seq_private
c_func
(paren
id|seq
)paren
suffix:semicolon
r_if
c_cond
(paren
id|likely
c_func
(paren
id|state-&gt;idev
op_ne
l_int|NULL
)paren
)paren
(brace
id|read_unlock_bh
c_func
(paren
op_amp
id|state-&gt;idev-&gt;lock
)paren
suffix:semicolon
id|in6_dev_put
c_func
(paren
id|state-&gt;idev
)paren
suffix:semicolon
id|state-&gt;idev
op_assign
l_int|NULL
suffix:semicolon
)brace
id|state-&gt;dev
op_assign
l_int|NULL
suffix:semicolon
id|read_unlock
c_func
(paren
op_amp
id|dev_base_lock
)paren
suffix:semicolon
)brace
DECL|function|igmp6_mc_seq_show
r_static
r_int
id|igmp6_mc_seq_show
c_func
(paren
r_struct
id|seq_file
op_star
id|seq
comma
r_void
op_star
id|v
)paren
(brace
r_struct
id|ifmcaddr6
op_star
id|im
op_assign
(paren
r_struct
id|ifmcaddr6
op_star
)paren
id|v
suffix:semicolon
r_struct
id|igmp6_mc_iter_state
op_star
id|state
op_assign
id|igmp6_mc_seq_private
c_func
(paren
id|seq
)paren
suffix:semicolon
id|seq_printf
c_func
(paren
id|seq
comma
l_string|&quot;%-4d %-15s %04x%04x%04x%04x%04x%04x%04x%04x %5d %08X %ld&bslash;n&quot;
comma
id|state-&gt;dev-&gt;ifindex
comma
id|state-&gt;dev-&gt;name
comma
id|NIP6
c_func
(paren
id|im-&gt;mca_addr
)paren
comma
id|im-&gt;mca_users
comma
id|im-&gt;mca_flags
comma
(paren
id|im-&gt;mca_flags
op_amp
id|MAF_TIMER_RUNNING
)paren
ques
c_cond
id|jiffies_to_clock_t
c_func
(paren
id|im-&gt;mca_timer.expires
op_minus
id|jiffies
)paren
suffix:colon
l_int|0
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|igmp6_mc_seq_ops
r_static
r_struct
id|seq_operations
id|igmp6_mc_seq_ops
op_assign
(brace
dot
id|start
op_assign
id|igmp6_mc_seq_start
comma
dot
id|next
op_assign
id|igmp6_mc_seq_next
comma
dot
id|stop
op_assign
id|igmp6_mc_seq_stop
comma
dot
id|show
op_assign
id|igmp6_mc_seq_show
comma
)brace
suffix:semicolon
DECL|function|igmp6_mc_seq_open
r_static
r_int
id|igmp6_mc_seq_open
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
(brace
r_struct
id|seq_file
op_star
id|seq
suffix:semicolon
r_int
id|rc
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_struct
id|igmp6_mc_iter_state
op_star
id|s
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|s
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|s
)paren
r_goto
id|out
suffix:semicolon
id|rc
op_assign
id|seq_open
c_func
(paren
id|file
comma
op_amp
id|igmp6_mc_seq_ops
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_goto
id|out_kfree
suffix:semicolon
id|seq
op_assign
id|file-&gt;private_data
suffix:semicolon
id|seq
op_member_access_from_pointer
r_private
op_assign
id|s
suffix:semicolon
id|memset
c_func
(paren
id|s
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|s
)paren
)paren
suffix:semicolon
id|out
suffix:colon
r_return
id|rc
suffix:semicolon
id|out_kfree
suffix:colon
id|kfree
c_func
(paren
id|s
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
DECL|variable|igmp6_mc_seq_fops
r_static
r_struct
id|file_operations
id|igmp6_mc_seq_fops
op_assign
(brace
dot
id|owner
op_assign
id|THIS_MODULE
comma
dot
id|open
op_assign
id|igmp6_mc_seq_open
comma
dot
id|read
op_assign
id|seq_read
comma
dot
id|llseek
op_assign
id|seq_lseek
comma
dot
id|release
op_assign
id|seq_release_private
comma
)brace
suffix:semicolon
DECL|struct|igmp6_mcf_iter_state
r_struct
id|igmp6_mcf_iter_state
(brace
DECL|member|dev
r_struct
id|net_device
op_star
id|dev
suffix:semicolon
DECL|member|idev
r_struct
id|inet6_dev
op_star
id|idev
suffix:semicolon
DECL|member|im
r_struct
id|ifmcaddr6
op_star
id|im
suffix:semicolon
)brace
suffix:semicolon
DECL|macro|igmp6_mcf_seq_private
mdefine_line|#define igmp6_mcf_seq_private(seq)&t;((struct igmp6_mcf_iter_state *)(seq)-&gt;private)
DECL|function|igmp6_mcf_get_first
r_static
r_inline
r_struct
id|ip6_sf_list
op_star
id|igmp6_mcf_get_first
c_func
(paren
r_struct
id|seq_file
op_star
id|seq
)paren
(brace
r_struct
id|ip6_sf_list
op_star
id|psf
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|ifmcaddr6
op_star
id|im
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|igmp6_mcf_iter_state
op_star
id|state
op_assign
id|igmp6_mcf_seq_private
c_func
(paren
id|seq
)paren
suffix:semicolon
r_for
c_loop
(paren
id|state-&gt;dev
op_assign
id|dev_base
comma
id|state-&gt;idev
op_assign
l_int|NULL
comma
id|state-&gt;im
op_assign
l_int|NULL
suffix:semicolon
id|state-&gt;dev
suffix:semicolon
id|state-&gt;dev
op_assign
id|state-&gt;dev-&gt;next
)paren
(brace
r_struct
id|inet6_dev
op_star
id|idev
suffix:semicolon
id|idev
op_assign
id|in6_dev_get
c_func
(paren
id|state-&gt;dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|unlikely
c_func
(paren
id|idev
op_eq
l_int|NULL
)paren
)paren
r_continue
suffix:semicolon
id|read_lock_bh
c_func
(paren
op_amp
id|idev-&gt;lock
)paren
suffix:semicolon
id|im
op_assign
id|idev-&gt;mc_list
suffix:semicolon
r_if
c_cond
(paren
id|likely
c_func
(paren
id|im
op_ne
l_int|NULL
)paren
)paren
(brace
id|spin_lock_bh
c_func
(paren
op_amp
id|im-&gt;mca_lock
)paren
suffix:semicolon
id|psf
op_assign
id|im-&gt;mca_sources
suffix:semicolon
r_if
c_cond
(paren
id|likely
c_func
(paren
id|psf
op_ne
l_int|NULL
)paren
)paren
(brace
id|state-&gt;im
op_assign
id|im
suffix:semicolon
id|state-&gt;idev
op_assign
id|idev
suffix:semicolon
r_break
suffix:semicolon
)brace
id|spin_unlock_bh
c_func
(paren
op_amp
id|im-&gt;mca_lock
)paren
suffix:semicolon
)brace
id|read_unlock_bh
c_func
(paren
op_amp
id|idev-&gt;lock
)paren
suffix:semicolon
id|in6_dev_put
c_func
(paren
id|idev
)paren
suffix:semicolon
)brace
r_return
id|psf
suffix:semicolon
)brace
DECL|function|igmp6_mcf_get_next
r_static
r_struct
id|ip6_sf_list
op_star
id|igmp6_mcf_get_next
c_func
(paren
r_struct
id|seq_file
op_star
id|seq
comma
r_struct
id|ip6_sf_list
op_star
id|psf
)paren
(brace
r_struct
id|igmp6_mcf_iter_state
op_star
id|state
op_assign
id|igmp6_mcf_seq_private
c_func
(paren
id|seq
)paren
suffix:semicolon
id|psf
op_assign
id|psf-&gt;sf_next
suffix:semicolon
r_while
c_loop
(paren
op_logical_neg
id|psf
)paren
(brace
id|spin_unlock_bh
c_func
(paren
op_amp
id|state-&gt;im-&gt;mca_lock
)paren
suffix:semicolon
id|state-&gt;im
op_assign
id|state-&gt;im-&gt;next
suffix:semicolon
r_while
c_loop
(paren
op_logical_neg
id|state-&gt;im
)paren
(brace
r_if
c_cond
(paren
id|likely
c_func
(paren
id|state-&gt;idev
op_ne
l_int|NULL
)paren
)paren
(brace
id|read_unlock_bh
c_func
(paren
op_amp
id|state-&gt;idev-&gt;lock
)paren
suffix:semicolon
id|in6_dev_put
c_func
(paren
id|state-&gt;idev
)paren
suffix:semicolon
)brace
id|state-&gt;dev
op_assign
id|state-&gt;dev-&gt;next
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|state-&gt;dev
)paren
(brace
id|state-&gt;idev
op_assign
l_int|NULL
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|state-&gt;idev
op_assign
id|in6_dev_get
c_func
(paren
id|state-&gt;dev
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|state-&gt;idev
)paren
r_continue
suffix:semicolon
id|read_lock_bh
c_func
(paren
op_amp
id|state-&gt;idev-&gt;lock
)paren
suffix:semicolon
id|state-&gt;im
op_assign
id|state-&gt;idev-&gt;mc_list
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|state-&gt;im
)paren
r_break
suffix:semicolon
id|spin_lock_bh
c_func
(paren
op_amp
id|state-&gt;im-&gt;mca_lock
)paren
suffix:semicolon
id|psf
op_assign
id|state-&gt;im-&gt;mca_sources
suffix:semicolon
)brace
id|out
suffix:colon
r_return
id|psf
suffix:semicolon
)brace
DECL|function|igmp6_mcf_get_idx
r_static
r_struct
id|ip6_sf_list
op_star
id|igmp6_mcf_get_idx
c_func
(paren
r_struct
id|seq_file
op_star
id|seq
comma
id|loff_t
id|pos
)paren
(brace
r_struct
id|ip6_sf_list
op_star
id|psf
op_assign
id|igmp6_mcf_get_first
c_func
(paren
id|seq
)paren
suffix:semicolon
r_if
c_cond
(paren
id|psf
)paren
r_while
c_loop
(paren
id|pos
op_logical_and
(paren
id|psf
op_assign
id|igmp6_mcf_get_next
c_func
(paren
id|seq
comma
id|psf
)paren
)paren
op_ne
l_int|NULL
)paren
op_decrement
id|pos
suffix:semicolon
r_return
id|pos
ques
c_cond
l_int|NULL
suffix:colon
id|psf
suffix:semicolon
)brace
DECL|function|igmp6_mcf_seq_start
r_static
r_void
op_star
id|igmp6_mcf_seq_start
c_func
(paren
r_struct
id|seq_file
op_star
id|seq
comma
id|loff_t
op_star
id|pos
)paren
(brace
id|read_lock
c_func
(paren
op_amp
id|dev_base_lock
)paren
suffix:semicolon
r_return
op_star
id|pos
ques
c_cond
id|igmp6_mcf_get_idx
c_func
(paren
id|seq
comma
op_star
id|pos
op_minus
l_int|1
)paren
suffix:colon
id|SEQ_START_TOKEN
suffix:semicolon
)brace
DECL|function|igmp6_mcf_seq_next
r_static
r_void
op_star
id|igmp6_mcf_seq_next
c_func
(paren
r_struct
id|seq_file
op_star
id|seq
comma
r_void
op_star
id|v
comma
id|loff_t
op_star
id|pos
)paren
(brace
r_struct
id|ip6_sf_list
op_star
id|psf
suffix:semicolon
r_if
c_cond
(paren
id|v
op_eq
id|SEQ_START_TOKEN
)paren
id|psf
op_assign
id|igmp6_mcf_get_first
c_func
(paren
id|seq
)paren
suffix:semicolon
r_else
id|psf
op_assign
id|igmp6_mcf_get_next
c_func
(paren
id|seq
comma
id|v
)paren
suffix:semicolon
op_increment
op_star
id|pos
suffix:semicolon
r_return
id|psf
suffix:semicolon
)brace
DECL|function|igmp6_mcf_seq_stop
r_static
r_void
id|igmp6_mcf_seq_stop
c_func
(paren
r_struct
id|seq_file
op_star
id|seq
comma
r_void
op_star
id|v
)paren
(brace
r_struct
id|igmp6_mcf_iter_state
op_star
id|state
op_assign
id|igmp6_mcf_seq_private
c_func
(paren
id|seq
)paren
suffix:semicolon
r_if
c_cond
(paren
id|likely
c_func
(paren
id|state-&gt;im
op_ne
l_int|NULL
)paren
)paren
(brace
id|spin_unlock_bh
c_func
(paren
op_amp
id|state-&gt;im-&gt;mca_lock
)paren
suffix:semicolon
id|state-&gt;im
op_assign
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|likely
c_func
(paren
id|state-&gt;idev
op_ne
l_int|NULL
)paren
)paren
(brace
id|read_unlock_bh
c_func
(paren
op_amp
id|state-&gt;idev-&gt;lock
)paren
suffix:semicolon
id|in6_dev_put
c_func
(paren
id|state-&gt;idev
)paren
suffix:semicolon
id|state-&gt;idev
op_assign
l_int|NULL
suffix:semicolon
)brace
id|state-&gt;dev
op_assign
l_int|NULL
suffix:semicolon
id|read_unlock
c_func
(paren
op_amp
id|dev_base_lock
)paren
suffix:semicolon
)brace
DECL|function|igmp6_mcf_seq_show
r_static
r_int
id|igmp6_mcf_seq_show
c_func
(paren
r_struct
id|seq_file
op_star
id|seq
comma
r_void
op_star
id|v
)paren
(brace
r_struct
id|ip6_sf_list
op_star
id|psf
op_assign
(paren
r_struct
id|ip6_sf_list
op_star
)paren
id|v
suffix:semicolon
r_struct
id|igmp6_mcf_iter_state
op_star
id|state
op_assign
id|igmp6_mcf_seq_private
c_func
(paren
id|seq
)paren
suffix:semicolon
r_if
c_cond
(paren
id|v
op_eq
id|SEQ_START_TOKEN
)paren
(brace
id|seq_printf
c_func
(paren
id|seq
comma
l_string|&quot;%3s %6s &quot;
l_string|&quot;%32s %32s %6s %6s&bslash;n&quot;
comma
l_string|&quot;Idx&quot;
comma
l_string|&quot;Device&quot;
comma
l_string|&quot;Multicast Address&quot;
comma
l_string|&quot;Source Address&quot;
comma
l_string|&quot;INC&quot;
comma
l_string|&quot;EXC&quot;
)paren
suffix:semicolon
)brace
r_else
(brace
id|seq_printf
c_func
(paren
id|seq
comma
l_string|&quot;%3d %6.6s &quot;
l_string|&quot;%04x%04x%04x%04x%04x%04x%04x%04x &quot;
l_string|&quot;%04x%04x%04x%04x%04x%04x%04x%04x &quot;
l_string|&quot;%6lu %6lu&bslash;n&quot;
comma
id|state-&gt;dev-&gt;ifindex
comma
id|state-&gt;dev-&gt;name
comma
id|NIP6
c_func
(paren
id|state-&gt;im-&gt;mca_addr
)paren
comma
id|NIP6
c_func
(paren
id|psf-&gt;sf_addr
)paren
comma
id|psf-&gt;sf_count
(braket
id|MCAST_INCLUDE
)braket
comma
id|psf-&gt;sf_count
(braket
id|MCAST_EXCLUDE
)braket
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|igmp6_mcf_seq_ops
r_static
r_struct
id|seq_operations
id|igmp6_mcf_seq_ops
op_assign
(brace
dot
id|start
op_assign
id|igmp6_mcf_seq_start
comma
dot
id|next
op_assign
id|igmp6_mcf_seq_next
comma
dot
id|stop
op_assign
id|igmp6_mcf_seq_stop
comma
dot
id|show
op_assign
id|igmp6_mcf_seq_show
comma
)brace
suffix:semicolon
DECL|function|igmp6_mcf_seq_open
r_static
r_int
id|igmp6_mcf_seq_open
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
(brace
r_struct
id|seq_file
op_star
id|seq
suffix:semicolon
r_int
id|rc
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_struct
id|igmp6_mcf_iter_state
op_star
id|s
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|s
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|s
)paren
r_goto
id|out
suffix:semicolon
id|rc
op_assign
id|seq_open
c_func
(paren
id|file
comma
op_amp
id|igmp6_mcf_seq_ops
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_goto
id|out_kfree
suffix:semicolon
id|seq
op_assign
id|file-&gt;private_data
suffix:semicolon
id|seq
op_member_access_from_pointer
r_private
op_assign
id|s
suffix:semicolon
id|memset
c_func
(paren
id|s
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|s
)paren
)paren
suffix:semicolon
id|out
suffix:colon
r_return
id|rc
suffix:semicolon
id|out_kfree
suffix:colon
id|kfree
c_func
(paren
id|s
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
DECL|variable|igmp6_mcf_seq_fops
r_static
r_struct
id|file_operations
id|igmp6_mcf_seq_fops
op_assign
(brace
dot
id|owner
op_assign
id|THIS_MODULE
comma
dot
id|open
op_assign
id|igmp6_mcf_seq_open
comma
dot
id|read
op_assign
id|seq_read
comma
dot
id|llseek
op_assign
id|seq_lseek
comma
dot
id|release
op_assign
id|seq_release_private
comma
)brace
suffix:semicolon
macro_line|#endif
DECL|function|igmp6_init
r_int
id|__init
id|igmp6_init
c_func
(paren
r_struct
id|net_proto_family
op_star
id|ops
)paren
(brace
r_struct
id|ipv6_pinfo
op_star
id|np
suffix:semicolon
r_struct
id|sock
op_star
id|sk
suffix:semicolon
r_int
id|err
suffix:semicolon
id|err
op_assign
id|sock_create_kern
c_func
(paren
id|PF_INET6
comma
id|SOCK_RAW
comma
id|IPPROTO_ICMPV6
comma
op_amp
id|igmp6_socket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;Failed to initialize the IGMP6 control socket (err %d).&bslash;n&quot;
comma
id|err
)paren
suffix:semicolon
id|igmp6_socket
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/* For safety. */
r_return
id|err
suffix:semicolon
)brace
id|sk
op_assign
id|igmp6_socket-&gt;sk
suffix:semicolon
id|sk-&gt;sk_allocation
op_assign
id|GFP_ATOMIC
suffix:semicolon
id|sk-&gt;sk_prot
op_member_access_from_pointer
id|unhash
c_func
(paren
id|sk
)paren
suffix:semicolon
id|np
op_assign
id|inet6_sk
c_func
(paren
id|sk
)paren
suffix:semicolon
id|np-&gt;hop_limit
op_assign
l_int|1
suffix:semicolon
macro_line|#ifdef CONFIG_PROC_FS
id|proc_net_fops_create
c_func
(paren
l_string|&quot;igmp6&quot;
comma
id|S_IRUGO
comma
op_amp
id|igmp6_mc_seq_fops
)paren
suffix:semicolon
id|proc_net_fops_create
c_func
(paren
l_string|&quot;mcfilter6&quot;
comma
id|S_IRUGO
comma
op_amp
id|igmp6_mcf_seq_fops
)paren
suffix:semicolon
macro_line|#endif
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|igmp6_cleanup
r_void
id|igmp6_cleanup
c_func
(paren
r_void
)paren
(brace
id|sock_release
c_func
(paren
id|igmp6_socket
)paren
suffix:semicolon
id|igmp6_socket
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/* for safety */
macro_line|#ifdef CONFIG_PROC_FS
id|proc_net_remove
c_func
(paren
l_string|&quot;mcfilter6&quot;
)paren
suffix:semicolon
id|proc_net_remove
c_func
(paren
l_string|&quot;igmp6&quot;
)paren
suffix:semicolon
macro_line|#endif
)brace
eof
