macro_line|#include &lt;net/xfrm.h&gt;
macro_line|#include &lt;net/ip.h&gt;
DECL|variable|xfrm6_type_map
r_static
r_struct
id|xfrm_type
op_star
id|xfrm6_type_map
(braket
l_int|256
)braket
suffix:semicolon
DECL|variable|xfrm6_type_lock
r_static
id|rwlock_t
id|xfrm6_type_lock
op_assign
id|RW_LOCK_UNLOCKED
suffix:semicolon
DECL|function|xfrm6_register_type
r_int
id|xfrm6_register_type
c_func
(paren
r_struct
id|xfrm_type
op_star
id|type
)paren
(brace
r_int
id|err
op_assign
l_int|0
suffix:semicolon
id|write_lock
c_func
(paren
op_amp
id|xfrm6_type_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|xfrm6_type_map
(braket
id|type-&gt;proto
)braket
op_eq
l_int|NULL
)paren
id|xfrm6_type_map
(braket
id|type-&gt;proto
)braket
op_assign
id|type
suffix:semicolon
r_else
id|err
op_assign
op_minus
id|EEXIST
suffix:semicolon
id|write_unlock
c_func
(paren
op_amp
id|xfrm6_type_lock
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|xfrm6_unregister_type
r_int
id|xfrm6_unregister_type
c_func
(paren
r_struct
id|xfrm_type
op_star
id|type
)paren
(brace
r_int
id|err
op_assign
l_int|0
suffix:semicolon
id|write_lock
c_func
(paren
op_amp
id|xfrm6_type_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|xfrm6_type_map
(braket
id|type-&gt;proto
)braket
op_ne
id|type
)paren
id|err
op_assign
op_minus
id|ENOENT
suffix:semicolon
r_else
id|xfrm6_type_map
(braket
id|type-&gt;proto
)braket
op_assign
l_int|NULL
suffix:semicolon
id|write_unlock
c_func
(paren
op_amp
id|xfrm6_type_lock
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|xfrm6_get_type
r_struct
id|xfrm_type
op_star
id|xfrm6_get_type
c_func
(paren
id|u8
id|proto
)paren
(brace
r_struct
id|xfrm_type
op_star
id|type
suffix:semicolon
id|read_lock
c_func
(paren
op_amp
id|xfrm6_type_lock
)paren
suffix:semicolon
id|type
op_assign
id|xfrm6_type_map
(braket
id|proto
)braket
suffix:semicolon
r_if
c_cond
(paren
id|type
op_logical_and
op_logical_neg
id|try_module_get
c_func
(paren
id|type-&gt;owner
)paren
)paren
id|type
op_assign
l_int|NULL
suffix:semicolon
id|read_unlock
c_func
(paren
op_amp
id|xfrm6_type_lock
)paren
suffix:semicolon
r_return
id|type
suffix:semicolon
)brace
eof
