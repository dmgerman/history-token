multiline_comment|/*&n; *&t;Linux INET6 implementation&n; *&t;FIB front-end.&n; *&n; *&t;Authors:&n; *&t;Pedro Roque&t;&t;&lt;roque@di.fc.ul.pt&gt;&t;&n; *&n; *&t;$Id: route.c,v 1.56 2001/10/31 21:55:55 davem Exp $&n; *&n; *&t;This program is free software; you can redistribute it and/or&n; *      modify it under the terms of the GNU General Public License&n; *      as published by the Free Software Foundation; either version&n; *      2 of the License, or (at your option) any later version.&n; */
multiline_comment|/*&t;Changes:&n; *&n; *&t;YOSHIFUJI Hideaki @USAGI&n; *&t;&t;reworked default router selection.&n; *&t;&t;- respect outgoing interface&n; *&t;&t;- select from (probably) reachable routers (i.e.&n; *&t;&t;routers in REACHABLE, STALE, DELAY or PROBE states).&n; *&t;&t;- always select the same router if it is (probably)&n; *&t;&t;reachable.  otherwise, round-robin the list.&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/socket.h&gt;
macro_line|#include &lt;linux/sockios.h&gt;
macro_line|#include &lt;linux/net.h&gt;
macro_line|#include &lt;linux/route.h&gt;
macro_line|#include &lt;linux/netdevice.h&gt;
macro_line|#include &lt;linux/in6.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/netlink.h&gt;
macro_line|#include &lt;linux/if_arp.h&gt;
macro_line|#ifdef &t;CONFIG_PROC_FS
macro_line|#include &lt;linux/proc_fs.h&gt;
macro_line|#endif
macro_line|#include &lt;net/snmp.h&gt;
macro_line|#include &lt;net/ipv6.h&gt;
macro_line|#include &lt;net/ip6_fib.h&gt;
macro_line|#include &lt;net/ip6_route.h&gt;
macro_line|#include &lt;net/ndisc.h&gt;
macro_line|#include &lt;net/addrconf.h&gt;
macro_line|#include &lt;net/tcp.h&gt;
macro_line|#include &lt;linux/rtnetlink.h&gt;
macro_line|#include &lt;net/dst.h&gt;
macro_line|#include &lt;net/xfrm.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#ifdef CONFIG_SYSCTL
macro_line|#include &lt;linux/sysctl.h&gt;
macro_line|#endif
multiline_comment|/* Set to 3 to get tracing. */
DECL|macro|RT6_DEBUG
mdefine_line|#define RT6_DEBUG 2
macro_line|#if RT6_DEBUG &gt;= 3
DECL|macro|RDBG
mdefine_line|#define RDBG(x) printk x
DECL|macro|RT6_TRACE
mdefine_line|#define RT6_TRACE(x...) printk(KERN_DEBUG x)
macro_line|#else
DECL|macro|RDBG
mdefine_line|#define RDBG(x)
DECL|macro|RT6_TRACE
mdefine_line|#define RT6_TRACE(x...) do { ; } while (0)
macro_line|#endif
DECL|variable|ip6_rt_max_size
r_static
r_int
id|ip6_rt_max_size
op_assign
l_int|4096
suffix:semicolon
DECL|variable|ip6_rt_gc_min_interval
r_static
r_int
id|ip6_rt_gc_min_interval
op_assign
l_int|5
op_star
id|HZ
suffix:semicolon
DECL|variable|ip6_rt_gc_timeout
r_static
r_int
id|ip6_rt_gc_timeout
op_assign
l_int|60
op_star
id|HZ
suffix:semicolon
DECL|variable|ip6_rt_gc_interval
r_int
id|ip6_rt_gc_interval
op_assign
l_int|30
op_star
id|HZ
suffix:semicolon
DECL|variable|ip6_rt_gc_elasticity
r_static
r_int
id|ip6_rt_gc_elasticity
op_assign
l_int|9
suffix:semicolon
DECL|variable|ip6_rt_mtu_expires
r_static
r_int
id|ip6_rt_mtu_expires
op_assign
l_int|10
op_star
l_int|60
op_star
id|HZ
suffix:semicolon
DECL|variable|ip6_rt_min_advmss
r_static
r_int
id|ip6_rt_min_advmss
op_assign
id|IPV6_MIN_MTU
op_minus
l_int|20
op_minus
l_int|40
suffix:semicolon
r_static
r_struct
id|rt6_info
op_star
id|ip6_rt_copy
c_func
(paren
r_struct
id|rt6_info
op_star
id|ort
)paren
suffix:semicolon
r_static
r_struct
id|dst_entry
op_star
id|ip6_dst_check
c_func
(paren
r_struct
id|dst_entry
op_star
id|dst
comma
id|u32
id|cookie
)paren
suffix:semicolon
r_static
r_struct
id|dst_entry
op_star
id|ip6_negative_advice
c_func
(paren
r_struct
id|dst_entry
op_star
)paren
suffix:semicolon
r_static
r_int
id|ip6_dst_gc
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_int
id|ip6_pkt_discard
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
)paren
suffix:semicolon
r_static
r_void
id|ip6_link_failure
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
)paren
suffix:semicolon
r_static
r_void
id|ip6_rt_update_pmtu
c_func
(paren
r_struct
id|dst_entry
op_star
id|dst
comma
id|u32
id|mtu
)paren
suffix:semicolon
DECL|variable|ip6_dst_ops
r_static
r_struct
id|dst_ops
id|ip6_dst_ops
op_assign
(brace
dot
id|family
op_assign
id|AF_INET6
comma
dot
id|protocol
op_assign
id|__constant_htons
c_func
(paren
id|ETH_P_IPV6
)paren
comma
dot
id|gc
op_assign
id|ip6_dst_gc
comma
dot
id|gc_thresh
op_assign
l_int|1024
comma
dot
id|check
op_assign
id|ip6_dst_check
comma
dot
id|negative_advice
op_assign
id|ip6_negative_advice
comma
dot
id|link_failure
op_assign
id|ip6_link_failure
comma
dot
id|update_pmtu
op_assign
id|ip6_rt_update_pmtu
comma
dot
id|entry_size
op_assign
r_sizeof
(paren
r_struct
id|rt6_info
)paren
comma
)brace
suffix:semicolon
DECL|variable|ip6_null_entry
r_struct
id|rt6_info
id|ip6_null_entry
op_assign
(brace
dot
id|u
op_assign
(brace
dot
id|dst
op_assign
(brace
dot
id|__refcnt
op_assign
id|ATOMIC_INIT
c_func
(paren
l_int|1
)paren
comma
dot
id|__use
op_assign
l_int|1
comma
dot
id|dev
op_assign
op_amp
id|loopback_dev
comma
dot
id|obsolete
op_assign
op_minus
l_int|1
comma
dot
id|error
op_assign
op_minus
id|ENETUNREACH
comma
dot
id|input
op_assign
id|ip6_pkt_discard
comma
dot
id|output
op_assign
id|ip6_pkt_discard
comma
dot
id|ops
op_assign
op_amp
id|ip6_dst_ops
comma
dot
id|path
op_assign
(paren
r_struct
id|dst_entry
op_star
)paren
op_amp
id|ip6_null_entry
comma
)brace
)brace
comma
dot
id|rt6i_flags
op_assign
(paren
id|RTF_REJECT
op_or
id|RTF_NONEXTHOP
)paren
comma
dot
id|rt6i_metric
op_assign
op_complement
(paren
id|u32
)paren
l_int|0
comma
dot
id|rt6i_hoplimit
op_assign
l_int|255
comma
dot
id|rt6i_ref
op_assign
id|ATOMIC_INIT
c_func
(paren
l_int|1
)paren
comma
)brace
suffix:semicolon
DECL|variable|ip6_routing_table
r_struct
id|fib6_node
id|ip6_routing_table
op_assign
(brace
l_int|NULL
comma
l_int|NULL
comma
l_int|NULL
comma
l_int|NULL
comma
op_amp
id|ip6_null_entry
comma
l_int|0
comma
id|RTN_ROOT
op_or
id|RTN_TL_ROOT
op_or
id|RTN_RTINFO
comma
l_int|0
)brace
suffix:semicolon
multiline_comment|/* Protects all the ip6 fib */
DECL|variable|rt6_lock
id|rwlock_t
id|rt6_lock
op_assign
id|RW_LOCK_UNLOCKED
suffix:semicolon
multiline_comment|/*&t;Dummy rt for ndisc */
DECL|function|ndisc_get_dummy_rt
r_struct
id|rt6_info
op_star
id|ndisc_get_dummy_rt
c_func
(paren
)paren
(brace
r_return
id|dst_alloc
c_func
(paren
op_amp
id|ip6_dst_ops
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;Route lookup. Any rt6_lock is implied.&n; */
DECL|function|rt6_device_match
r_static
id|__inline__
r_struct
id|rt6_info
op_star
id|rt6_device_match
c_func
(paren
r_struct
id|rt6_info
op_star
id|rt
comma
r_int
id|oif
comma
r_int
id|strict
)paren
(brace
r_struct
id|rt6_info
op_star
id|local
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|rt6_info
op_star
id|sprt
suffix:semicolon
r_if
c_cond
(paren
id|oif
)paren
(brace
r_for
c_loop
(paren
id|sprt
op_assign
id|rt
suffix:semicolon
id|sprt
suffix:semicolon
id|sprt
op_assign
id|sprt-&gt;u.next
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
id|sprt-&gt;rt6i_dev
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;ifindex
op_eq
id|oif
)paren
r_return
id|sprt
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;flags
op_amp
id|IFF_LOOPBACK
)paren
id|local
op_assign
id|sprt
suffix:semicolon
)brace
r_if
c_cond
(paren
id|local
)paren
r_return
id|local
suffix:semicolon
r_if
c_cond
(paren
id|strict
)paren
r_return
op_amp
id|ip6_null_entry
suffix:semicolon
)brace
r_return
id|rt
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;pointer to the last default router chosen. BH is disabled locally.&n; */
DECL|variable|rt6_dflt_pointer
r_static
r_struct
id|rt6_info
op_star
id|rt6_dflt_pointer
op_assign
l_int|NULL
suffix:semicolon
DECL|variable|rt6_dflt_lock
r_static
id|spinlock_t
id|rt6_dflt_lock
op_assign
id|SPIN_LOCK_UNLOCKED
suffix:semicolon
multiline_comment|/* Default Router Selection (RFC 2461 6.3.6) */
DECL|function|rt6_best_dflt
r_static
r_struct
id|rt6_info
op_star
id|rt6_best_dflt
c_func
(paren
r_struct
id|rt6_info
op_star
id|rt
comma
r_int
id|oif
)paren
(brace
r_struct
id|rt6_info
op_star
id|match
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|rt6_info
op_star
id|sprt
suffix:semicolon
r_int
id|mpri
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|sprt
op_assign
id|rt
suffix:semicolon
id|sprt
suffix:semicolon
id|sprt
op_assign
id|sprt-&gt;u.next
)paren
(brace
r_struct
id|neighbour
op_star
id|neigh
suffix:semicolon
r_int
id|m
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|oif
op_logical_or
(paren
id|sprt-&gt;rt6i_dev
op_logical_and
id|sprt-&gt;rt6i_dev-&gt;ifindex
op_eq
id|oif
)paren
)paren
id|m
op_add_assign
l_int|8
suffix:semicolon
r_if
c_cond
(paren
id|sprt
op_eq
id|rt6_dflt_pointer
)paren
id|m
op_add_assign
l_int|4
suffix:semicolon
r_if
c_cond
(paren
(paren
id|neigh
op_assign
id|sprt-&gt;rt6i_nexthop
)paren
op_ne
l_int|NULL
)paren
(brace
id|read_lock_bh
c_func
(paren
op_amp
id|neigh-&gt;lock
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|neigh-&gt;nud_state
)paren
(brace
r_case
id|NUD_REACHABLE
suffix:colon
id|m
op_add_assign
l_int|3
suffix:semicolon
r_break
suffix:semicolon
r_case
id|NUD_STALE
suffix:colon
r_case
id|NUD_DELAY
suffix:colon
r_case
id|NUD_PROBE
suffix:colon
id|m
op_add_assign
l_int|2
suffix:semicolon
r_break
suffix:semicolon
r_case
id|NUD_NOARP
suffix:colon
r_case
id|NUD_PERMANENT
suffix:colon
id|m
op_add_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|NUD_INCOMPLETE
suffix:colon
r_default
suffix:colon
id|read_unlock_bh
c_func
(paren
op_amp
id|neigh-&gt;lock
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|read_unlock_bh
c_func
(paren
op_amp
id|neigh-&gt;lock
)paren
suffix:semicolon
)brace
r_else
(brace
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
id|m
OG
id|mpri
op_logical_or
id|m
op_ge
l_int|12
)paren
(brace
id|match
op_assign
id|sprt
suffix:semicolon
id|mpri
op_assign
id|m
suffix:semicolon
r_if
c_cond
(paren
id|m
op_ge
l_int|12
)paren
(brace
multiline_comment|/* we choose the lastest default router if it&n;&t;&t;&t;&t; * is in (probably) reachable state.&n;&t;&t;&t;&t; * If route changed, we should do pmtu&n;&t;&t;&t;&t; * discovery. --yoshfuji&n;&t;&t;&t;&t; */
r_break
suffix:semicolon
)brace
)brace
)brace
id|spin_lock
c_func
(paren
op_amp
id|rt6_dflt_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|match
)paren
(brace
multiline_comment|/*&n;&t;&t; *&t;No default routers are known to be reachable.&n;&t;&t; *&t;SHOULD round robin&n;&t;&t; */
r_if
c_cond
(paren
id|rt6_dflt_pointer
)paren
(brace
r_for
c_loop
(paren
id|sprt
op_assign
id|rt6_dflt_pointer-&gt;u.next
suffix:semicolon
id|sprt
suffix:semicolon
id|sprt
op_assign
id|sprt-&gt;u.next
)paren
(brace
r_if
c_cond
(paren
id|sprt-&gt;u.dst.obsolete
op_le
l_int|0
op_logical_and
id|sprt-&gt;u.dst.error
op_eq
l_int|0
)paren
(brace
id|match
op_assign
id|sprt
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_for
c_loop
(paren
id|sprt
op_assign
id|rt
suffix:semicolon
op_logical_neg
id|match
op_logical_and
id|sprt
op_logical_and
id|sprt
op_ne
id|rt6_dflt_pointer
suffix:semicolon
id|sprt
op_assign
id|sprt-&gt;u.next
)paren
(brace
r_if
c_cond
(paren
id|sprt-&gt;u.dst.obsolete
op_le
l_int|0
op_logical_and
id|sprt-&gt;u.dst.error
op_eq
l_int|0
)paren
(brace
id|match
op_assign
id|sprt
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
)brace
)brace
r_if
c_cond
(paren
id|match
)paren
(brace
r_if
c_cond
(paren
id|rt6_dflt_pointer
op_ne
id|match
)paren
id|RT6_TRACE
c_func
(paren
l_string|&quot;changed default router: %p-&gt;%p&bslash;n&quot;
comma
id|rt6_dflt_pointer
comma
id|match
)paren
suffix:semicolon
id|rt6_dflt_pointer
op_assign
id|match
suffix:semicolon
)brace
id|spin_unlock
c_func
(paren
op_amp
id|rt6_dflt_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|match
)paren
(brace
multiline_comment|/*&n;&t;&t; * Last Resort: if no default routers found, &n;&t;&t; * use addrconf default route.&n;&t;&t; * We don&squot;t record this route.&n;&t;&t; */
r_for
c_loop
(paren
id|sprt
op_assign
id|ip6_routing_table.leaf
suffix:semicolon
id|sprt
suffix:semicolon
id|sprt
op_assign
id|sprt-&gt;u.next
)paren
(brace
r_if
c_cond
(paren
(paren
id|sprt-&gt;rt6i_flags
op_amp
id|RTF_DEFAULT
)paren
op_logical_and
(paren
op_logical_neg
id|oif
op_logical_or
(paren
id|sprt-&gt;rt6i_dev
op_logical_and
id|sprt-&gt;rt6i_dev-&gt;ifindex
op_eq
id|oif
)paren
)paren
)paren
(brace
id|match
op_assign
id|sprt
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
op_logical_neg
id|match
)paren
(brace
multiline_comment|/* no default route.  give up. */
id|match
op_assign
op_amp
id|ip6_null_entry
suffix:semicolon
)brace
)brace
r_return
id|match
suffix:semicolon
)brace
DECL|function|rt6_lookup
r_struct
id|rt6_info
op_star
id|rt6_lookup
c_func
(paren
r_struct
id|in6_addr
op_star
id|daddr
comma
r_struct
id|in6_addr
op_star
id|saddr
comma
r_int
id|oif
comma
r_int
id|strict
)paren
(brace
r_struct
id|fib6_node
op_star
id|fn
suffix:semicolon
r_struct
id|rt6_info
op_star
id|rt
suffix:semicolon
id|read_lock_bh
c_func
(paren
op_amp
id|rt6_lock
)paren
suffix:semicolon
id|fn
op_assign
id|fib6_lookup
c_func
(paren
op_amp
id|ip6_routing_table
comma
id|daddr
comma
id|saddr
)paren
suffix:semicolon
id|rt
op_assign
id|rt6_device_match
c_func
(paren
id|fn-&gt;leaf
comma
id|oif
comma
id|strict
)paren
suffix:semicolon
id|dst_hold
c_func
(paren
op_amp
id|rt-&gt;u.dst
)paren
suffix:semicolon
id|rt-&gt;u.dst.__use
op_increment
suffix:semicolon
id|read_unlock_bh
c_func
(paren
op_amp
id|rt6_lock
)paren
suffix:semicolon
id|rt-&gt;u.dst.lastuse
op_assign
id|jiffies
suffix:semicolon
r_if
c_cond
(paren
id|rt-&gt;u.dst.error
op_eq
l_int|0
)paren
r_return
id|rt
suffix:semicolon
id|dst_release
c_func
(paren
op_amp
id|rt-&gt;u.dst
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
multiline_comment|/* rt6_ins is called with FREE rt6_lock.&n;   It takes new route entry, the addition fails by any reason the&n;   route is freed. In any case, if caller does not hold it, it may&n;   be destroyed.&n; */
DECL|function|rt6_ins
r_static
r_int
id|rt6_ins
c_func
(paren
r_struct
id|rt6_info
op_star
id|rt
comma
r_struct
id|nlmsghdr
op_star
id|nlh
)paren
(brace
r_int
id|err
suffix:semicolon
id|write_lock_bh
c_func
(paren
op_amp
id|rt6_lock
)paren
suffix:semicolon
id|err
op_assign
id|fib6_add
c_func
(paren
op_amp
id|ip6_routing_table
comma
id|rt
comma
id|nlh
)paren
suffix:semicolon
id|write_unlock_bh
c_func
(paren
op_amp
id|rt6_lock
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
multiline_comment|/* No rt6_lock! If COW faild, the function returns dead route entry&n;   with dst-&gt;error set to errno value.&n; */
DECL|function|rt6_cow
r_static
r_struct
id|rt6_info
op_star
id|rt6_cow
c_func
(paren
r_struct
id|rt6_info
op_star
id|ort
comma
r_struct
id|in6_addr
op_star
id|daddr
comma
r_struct
id|in6_addr
op_star
id|saddr
)paren
(brace
r_int
id|err
suffix:semicolon
r_struct
id|rt6_info
op_star
id|rt
suffix:semicolon
multiline_comment|/*&n;&t; *&t;Clone the route.&n;&t; */
id|rt
op_assign
id|ip6_rt_copy
c_func
(paren
id|ort
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rt
)paren
(brace
id|ipv6_addr_copy
c_func
(paren
op_amp
id|rt-&gt;rt6i_dst.addr
comma
id|daddr
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|rt-&gt;rt6i_flags
op_amp
id|RTF_GATEWAY
)paren
)paren
id|ipv6_addr_copy
c_func
(paren
op_amp
id|rt-&gt;rt6i_gateway
comma
id|daddr
)paren
suffix:semicolon
id|rt-&gt;rt6i_dst.plen
op_assign
l_int|128
suffix:semicolon
id|rt-&gt;rt6i_flags
op_or_assign
id|RTF_CACHE
suffix:semicolon
id|rt-&gt;u.dst.flags
op_or_assign
id|DST_HOST
suffix:semicolon
macro_line|#ifdef CONFIG_IPV6_SUBTREES
r_if
c_cond
(paren
id|rt-&gt;rt6i_src.plen
op_logical_and
id|saddr
)paren
(brace
id|ipv6_addr_copy
c_func
(paren
op_amp
id|rt-&gt;rt6i_src.addr
comma
id|saddr
)paren
suffix:semicolon
id|rt-&gt;rt6i_src.plen
op_assign
l_int|128
suffix:semicolon
)brace
macro_line|#endif
id|rt-&gt;rt6i_nexthop
op_assign
id|ndisc_get_neigh
c_func
(paren
id|rt-&gt;rt6i_dev
comma
op_amp
id|rt-&gt;rt6i_gateway
)paren
suffix:semicolon
id|dst_hold
c_func
(paren
op_amp
id|rt-&gt;u.dst
)paren
suffix:semicolon
id|err
op_assign
id|rt6_ins
c_func
(paren
id|rt
comma
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
op_eq
l_int|0
)paren
r_return
id|rt
suffix:semicolon
id|rt-&gt;u.dst.error
op_assign
id|err
suffix:semicolon
r_return
id|rt
suffix:semicolon
)brace
id|dst_hold
c_func
(paren
op_amp
id|ip6_null_entry.u.dst
)paren
suffix:semicolon
r_return
op_amp
id|ip6_null_entry
suffix:semicolon
)brace
DECL|macro|BACKTRACK
mdefine_line|#define BACKTRACK() &bslash;&n;if (rt == &amp;ip6_null_entry &amp;&amp; strict) { &bslash;&n;       while ((fn = fn-&gt;parent) != NULL) { &bslash;&n;&t;&t;if (fn-&gt;fn_flags &amp; RTN_ROOT) { &bslash;&n;&t;&t;&t;dst_hold(&amp;rt-&gt;u.dst); &bslash;&n;&t;&t;&t;goto out; &bslash;&n;&t;&t;} &bslash;&n;&t;&t;if (fn-&gt;fn_flags &amp; RTN_RTINFO) &bslash;&n;&t;&t;&t;goto restart; &bslash;&n;&t;} &bslash;&n;}
DECL|function|ip6_route_input
r_void
id|ip6_route_input
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|fib6_node
op_star
id|fn
suffix:semicolon
r_struct
id|rt6_info
op_star
id|rt
suffix:semicolon
r_int
id|strict
suffix:semicolon
r_int
id|attempts
op_assign
l_int|3
suffix:semicolon
id|strict
op_assign
id|ipv6_addr_type
c_func
(paren
op_amp
id|skb-&gt;nh.ipv6h-&gt;daddr
)paren
op_amp
(paren
id|IPV6_ADDR_MULTICAST
op_or
id|IPV6_ADDR_LINKLOCAL
)paren
suffix:semicolon
id|relookup
suffix:colon
id|read_lock_bh
c_func
(paren
op_amp
id|rt6_lock
)paren
suffix:semicolon
id|fn
op_assign
id|fib6_lookup
c_func
(paren
op_amp
id|ip6_routing_table
comma
op_amp
id|skb-&gt;nh.ipv6h-&gt;daddr
comma
op_amp
id|skb-&gt;nh.ipv6h-&gt;saddr
)paren
suffix:semicolon
id|restart
suffix:colon
id|rt
op_assign
id|fn-&gt;leaf
suffix:semicolon
r_if
c_cond
(paren
(paren
id|rt-&gt;rt6i_flags
op_amp
id|RTF_CACHE
)paren
)paren
(brace
id|rt
op_assign
id|rt6_device_match
c_func
(paren
id|rt
comma
id|skb-&gt;dev-&gt;ifindex
comma
id|strict
)paren
suffix:semicolon
id|BACKTRACK
c_func
(paren
)paren
suffix:semicolon
id|dst_hold
c_func
(paren
op_amp
id|rt-&gt;u.dst
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|rt
op_assign
id|rt6_device_match
c_func
(paren
id|rt
comma
id|skb-&gt;dev-&gt;ifindex
comma
l_int|0
)paren
suffix:semicolon
id|BACKTRACK
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|rt-&gt;rt6i_nexthop
op_logical_and
op_logical_neg
(paren
id|rt-&gt;rt6i_flags
op_amp
id|RTF_NONEXTHOP
)paren
)paren
(brace
id|read_unlock_bh
c_func
(paren
op_amp
id|rt6_lock
)paren
suffix:semicolon
id|rt
op_assign
id|rt6_cow
c_func
(paren
id|rt
comma
op_amp
id|skb-&gt;nh.ipv6h-&gt;daddr
comma
op_amp
id|skb-&gt;nh.ipv6h-&gt;saddr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rt-&gt;u.dst.error
op_ne
op_minus
id|EEXIST
op_logical_or
op_decrement
id|attempts
op_le
l_int|0
)paren
r_goto
id|out2
suffix:semicolon
multiline_comment|/* Race condition! In the gap, when rt6_lock was&n;&t;&t;   released someone could insert this route.  Relookup.&n;&t;&t;*/
r_goto
id|relookup
suffix:semicolon
)brace
id|dst_hold
c_func
(paren
op_amp
id|rt-&gt;u.dst
)paren
suffix:semicolon
id|out
suffix:colon
id|read_unlock_bh
c_func
(paren
op_amp
id|rt6_lock
)paren
suffix:semicolon
id|out2
suffix:colon
id|rt-&gt;u.dst.lastuse
op_assign
id|jiffies
suffix:semicolon
id|rt-&gt;u.dst.__use
op_increment
suffix:semicolon
id|skb-&gt;dst
op_assign
(paren
r_struct
id|dst_entry
op_star
)paren
id|rt
suffix:semicolon
)brace
DECL|function|ip6_route_output
r_struct
id|dst_entry
op_star
id|ip6_route_output
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_struct
id|flowi
op_star
id|fl
)paren
(brace
r_struct
id|fib6_node
op_star
id|fn
suffix:semicolon
r_struct
id|rt6_info
op_star
id|rt
suffix:semicolon
r_int
id|strict
suffix:semicolon
r_int
id|attempts
op_assign
l_int|3
suffix:semicolon
id|strict
op_assign
id|ipv6_addr_type
c_func
(paren
id|fl-&gt;nl_u.ip6_u.daddr
)paren
op_amp
(paren
id|IPV6_ADDR_MULTICAST
op_or
id|IPV6_ADDR_LINKLOCAL
)paren
suffix:semicolon
id|relookup
suffix:colon
id|read_lock_bh
c_func
(paren
op_amp
id|rt6_lock
)paren
suffix:semicolon
id|fn
op_assign
id|fib6_lookup
c_func
(paren
op_amp
id|ip6_routing_table
comma
id|fl-&gt;nl_u.ip6_u.daddr
comma
id|fl-&gt;nl_u.ip6_u.saddr
)paren
suffix:semicolon
id|restart
suffix:colon
id|rt
op_assign
id|fn-&gt;leaf
suffix:semicolon
r_if
c_cond
(paren
(paren
id|rt-&gt;rt6i_flags
op_amp
id|RTF_CACHE
)paren
)paren
(brace
id|rt
op_assign
id|rt6_device_match
c_func
(paren
id|rt
comma
id|fl-&gt;oif
comma
id|strict
)paren
suffix:semicolon
id|BACKTRACK
c_func
(paren
)paren
suffix:semicolon
id|dst_hold
c_func
(paren
op_amp
id|rt-&gt;u.dst
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_if
c_cond
(paren
id|rt-&gt;rt6i_flags
op_amp
id|RTF_DEFAULT
)paren
(brace
r_if
c_cond
(paren
id|rt-&gt;rt6i_metric
op_ge
id|IP6_RT_PRIO_ADDRCONF
)paren
id|rt
op_assign
id|rt6_best_dflt
c_func
(paren
id|rt
comma
id|fl-&gt;oif
)paren
suffix:semicolon
)brace
r_else
(brace
id|rt
op_assign
id|rt6_device_match
c_func
(paren
id|rt
comma
id|fl-&gt;oif
comma
id|strict
)paren
suffix:semicolon
id|BACKTRACK
c_func
(paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|rt-&gt;rt6i_nexthop
op_logical_and
op_logical_neg
(paren
id|rt-&gt;rt6i_flags
op_amp
id|RTF_NONEXTHOP
)paren
)paren
(brace
id|read_unlock_bh
c_func
(paren
op_amp
id|rt6_lock
)paren
suffix:semicolon
id|rt
op_assign
id|rt6_cow
c_func
(paren
id|rt
comma
id|fl-&gt;nl_u.ip6_u.daddr
comma
id|fl-&gt;nl_u.ip6_u.saddr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rt-&gt;u.dst.error
op_ne
op_minus
id|EEXIST
op_logical_or
op_decrement
id|attempts
op_le
l_int|0
)paren
r_goto
id|out2
suffix:semicolon
multiline_comment|/* Race condition! In the gap, when rt6_lock was&n;&t;&t;   released someone could insert this route.  Relookup.&n;&t;&t;*/
r_goto
id|relookup
suffix:semicolon
)brace
id|dst_hold
c_func
(paren
op_amp
id|rt-&gt;u.dst
)paren
suffix:semicolon
id|out
suffix:colon
id|read_unlock_bh
c_func
(paren
op_amp
id|rt6_lock
)paren
suffix:semicolon
id|out2
suffix:colon
id|rt-&gt;u.dst.lastuse
op_assign
id|jiffies
suffix:semicolon
id|rt-&gt;u.dst.__use
op_increment
suffix:semicolon
r_return
op_amp
id|rt-&gt;u.dst
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;Destination cache support functions&n; */
DECL|function|ip6_dst_check
r_static
r_struct
id|dst_entry
op_star
id|ip6_dst_check
c_func
(paren
r_struct
id|dst_entry
op_star
id|dst
comma
id|u32
id|cookie
)paren
(brace
r_struct
id|rt6_info
op_star
id|rt
suffix:semicolon
id|rt
op_assign
(paren
r_struct
id|rt6_info
op_star
)paren
id|dst
suffix:semicolon
r_if
c_cond
(paren
id|rt
op_logical_and
id|rt-&gt;rt6i_node
op_logical_and
(paren
id|rt-&gt;rt6i_node-&gt;fn_sernum
op_eq
id|cookie
)paren
)paren
r_return
id|dst
suffix:semicolon
id|dst_release
c_func
(paren
id|dst
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
DECL|function|ip6_negative_advice
r_static
r_struct
id|dst_entry
op_star
id|ip6_negative_advice
c_func
(paren
r_struct
id|dst_entry
op_star
id|dst
)paren
(brace
r_struct
id|rt6_info
op_star
id|rt
op_assign
(paren
r_struct
id|rt6_info
op_star
)paren
id|dst
suffix:semicolon
r_if
c_cond
(paren
id|rt
)paren
(brace
r_if
c_cond
(paren
id|rt-&gt;rt6i_flags
op_amp
id|RTF_CACHE
)paren
id|ip6_del_rt
c_func
(paren
id|rt
comma
l_int|NULL
)paren
suffix:semicolon
r_else
id|dst_release
c_func
(paren
id|dst
)paren
suffix:semicolon
)brace
r_return
l_int|NULL
suffix:semicolon
)brace
DECL|function|ip6_link_failure
r_static
r_void
id|ip6_link_failure
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|rt6_info
op_star
id|rt
suffix:semicolon
id|icmpv6_send
c_func
(paren
id|skb
comma
id|ICMPV6_DEST_UNREACH
comma
id|ICMPV6_ADDR_UNREACH
comma
l_int|0
comma
id|skb-&gt;dev
)paren
suffix:semicolon
id|rt
op_assign
(paren
r_struct
id|rt6_info
op_star
)paren
id|skb-&gt;dst
suffix:semicolon
r_if
c_cond
(paren
id|rt
)paren
(brace
r_if
c_cond
(paren
id|rt-&gt;rt6i_flags
op_amp
id|RTF_CACHE
)paren
(brace
id|dst_set_expires
c_func
(paren
op_amp
id|rt-&gt;u.dst
comma
l_int|0
)paren
suffix:semicolon
id|rt-&gt;rt6i_flags
op_or_assign
id|RTF_EXPIRES
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|rt-&gt;rt6i_node
op_logical_and
(paren
id|rt-&gt;rt6i_flags
op_amp
id|RTF_DEFAULT
)paren
)paren
id|rt-&gt;rt6i_node-&gt;fn_sernum
op_assign
op_minus
l_int|1
suffix:semicolon
)brace
)brace
DECL|function|ip6_rt_update_pmtu
r_static
r_void
id|ip6_rt_update_pmtu
c_func
(paren
r_struct
id|dst_entry
op_star
id|dst
comma
id|u32
id|mtu
)paren
(brace
r_struct
id|rt6_info
op_star
id|rt6
op_assign
(paren
r_struct
id|rt6_info
op_star
)paren
id|dst
suffix:semicolon
r_if
c_cond
(paren
id|mtu
OL
id|dst_pmtu
c_func
(paren
id|dst
)paren
op_logical_and
id|rt6-&gt;rt6i_dst.plen
op_eq
l_int|128
)paren
(brace
id|rt6-&gt;rt6i_flags
op_or_assign
id|RTF_MODIFIED
suffix:semicolon
id|dst-&gt;metrics
(braket
id|RTAX_MTU
op_minus
l_int|1
)braket
op_assign
id|mtu
suffix:semicolon
)brace
)brace
DECL|function|ip6_dst_gc
r_static
r_int
id|ip6_dst_gc
c_func
(paren
)paren
(brace
r_static
r_int
id|expire
op_assign
l_int|30
op_star
id|HZ
suffix:semicolon
r_static
r_int
r_int
id|last_gc
suffix:semicolon
r_int
r_int
id|now
op_assign
id|jiffies
suffix:semicolon
r_if
c_cond
(paren
(paren
r_int
)paren
(paren
id|now
op_minus
id|last_gc
)paren
OL
id|ip6_rt_gc_min_interval
op_logical_and
id|atomic_read
c_func
(paren
op_amp
id|ip6_dst_ops.entries
)paren
op_le
id|ip6_rt_max_size
)paren
r_goto
id|out
suffix:semicolon
id|expire
op_increment
suffix:semicolon
id|fib6_run_gc
c_func
(paren
id|expire
)paren
suffix:semicolon
id|last_gc
op_assign
id|now
suffix:semicolon
r_if
c_cond
(paren
id|atomic_read
c_func
(paren
op_amp
id|ip6_dst_ops.entries
)paren
OL
id|ip6_dst_ops.gc_thresh
)paren
id|expire
op_assign
id|ip6_rt_gc_timeout
op_rshift
l_int|1
suffix:semicolon
id|out
suffix:colon
id|expire
op_sub_assign
id|expire
op_rshift
id|ip6_rt_gc_elasticity
suffix:semicolon
r_return
(paren
id|atomic_read
c_func
(paren
op_amp
id|ip6_dst_ops.entries
)paren
OG
id|ip6_rt_max_size
)paren
suffix:semicolon
)brace
multiline_comment|/* Clean host part of a prefix. Not necessary in radix tree,&n;   but results in cleaner routing tables.&n;&n;   Remove it only when all the things will work!&n; */
DECL|function|ipv6_addr_prefix
r_static
r_void
id|ipv6_addr_prefix
c_func
(paren
r_struct
id|in6_addr
op_star
id|pfx
comma
r_const
r_struct
id|in6_addr
op_star
id|addr
comma
r_int
id|plen
)paren
(brace
r_int
id|b
op_assign
id|plen
op_amp
l_int|0x7
suffix:semicolon
r_int
id|o
op_assign
id|plen
op_rshift
l_int|3
suffix:semicolon
id|memcpy
c_func
(paren
id|pfx-&gt;s6_addr
comma
id|addr
comma
id|o
)paren
suffix:semicolon
r_if
c_cond
(paren
id|o
OL
l_int|16
)paren
id|memset
c_func
(paren
id|pfx-&gt;s6_addr
op_plus
id|o
comma
l_int|0
comma
l_int|16
op_minus
id|o
)paren
suffix:semicolon
r_if
c_cond
(paren
id|b
op_ne
l_int|0
)paren
id|pfx-&gt;s6_addr
(braket
id|o
)braket
op_assign
id|addr-&gt;s6_addr
(braket
id|o
)braket
op_amp
(paren
l_int|0xff00
op_rshift
id|b
)paren
suffix:semicolon
)brace
DECL|function|ipv6_get_mtu
r_static
r_int
id|ipv6_get_mtu
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_int
id|mtu
op_assign
id|IPV6_MIN_MTU
suffix:semicolon
r_struct
id|inet6_dev
op_star
id|idev
suffix:semicolon
id|idev
op_assign
id|in6_dev_get
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|idev
)paren
(brace
id|mtu
op_assign
id|idev-&gt;cnf.mtu6
suffix:semicolon
id|in6_dev_put
c_func
(paren
id|idev
)paren
suffix:semicolon
)brace
r_return
id|mtu
suffix:semicolon
)brace
DECL|function|ipv6_get_hoplimit
r_static
r_int
id|ipv6_get_hoplimit
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_int
id|hoplimit
op_assign
id|ipv6_devconf.hop_limit
suffix:semicolon
r_struct
id|inet6_dev
op_star
id|idev
suffix:semicolon
id|idev
op_assign
id|in6_dev_get
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|idev
)paren
(brace
id|hoplimit
op_assign
id|idev-&gt;cnf.hop_limit
suffix:semicolon
id|in6_dev_put
c_func
(paren
id|idev
)paren
suffix:semicolon
)brace
r_return
id|hoplimit
suffix:semicolon
)brace
multiline_comment|/*&n; *&n; */
DECL|function|ip6_route_add
r_int
id|ip6_route_add
c_func
(paren
r_struct
id|in6_rtmsg
op_star
id|rtmsg
comma
r_struct
id|nlmsghdr
op_star
id|nlh
)paren
(brace
r_int
id|err
suffix:semicolon
r_struct
id|rtmsg
op_star
id|r
suffix:semicolon
r_struct
id|rt6_info
op_star
id|rt
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
op_assign
l_int|NULL
suffix:semicolon
r_int
id|addr_type
suffix:semicolon
r_if
c_cond
(paren
id|rtmsg-&gt;rtmsg_dst_len
OG
l_int|128
op_logical_or
id|rtmsg-&gt;rtmsg_src_len
OG
l_int|128
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
macro_line|#ifndef CONFIG_IPV6_SUBTREES
r_if
c_cond
(paren
id|rtmsg-&gt;rtmsg_src_len
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|rtmsg-&gt;rtmsg_metric
op_eq
l_int|0
)paren
id|rtmsg-&gt;rtmsg_metric
op_assign
id|IP6_RT_PRIO_USER
suffix:semicolon
id|rt
op_assign
id|dst_alloc
c_func
(paren
op_amp
id|ip6_dst_ops
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rt
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|rt-&gt;u.dst.obsolete
op_assign
op_minus
l_int|1
suffix:semicolon
id|rt-&gt;rt6i_expires
op_assign
id|rtmsg-&gt;rtmsg_info
suffix:semicolon
r_if
c_cond
(paren
id|nlh
op_logical_and
(paren
id|r
op_assign
id|NLMSG_DATA
c_func
(paren
id|nlh
)paren
)paren
)paren
(brace
id|rt-&gt;rt6i_protocol
op_assign
id|r-&gt;rtm_protocol
suffix:semicolon
)brace
r_else
(brace
id|rt-&gt;rt6i_protocol
op_assign
id|RTPROT_BOOT
suffix:semicolon
)brace
id|addr_type
op_assign
id|ipv6_addr_type
c_func
(paren
op_amp
id|rtmsg-&gt;rtmsg_dst
)paren
suffix:semicolon
r_if
c_cond
(paren
id|addr_type
op_amp
id|IPV6_ADDR_MULTICAST
)paren
id|rt-&gt;u.dst.input
op_assign
id|ip6_mc_input
suffix:semicolon
r_else
id|rt-&gt;u.dst.input
op_assign
id|ip6_forward
suffix:semicolon
id|rt-&gt;u.dst.output
op_assign
id|ip6_output
suffix:semicolon
r_if
c_cond
(paren
id|rtmsg-&gt;rtmsg_ifindex
)paren
(brace
id|dev
op_assign
id|dev_get_by_index
c_func
(paren
id|rtmsg-&gt;rtmsg_ifindex
)paren
suffix:semicolon
id|err
op_assign
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
id|dev
op_eq
l_int|NULL
)paren
r_goto
id|out
suffix:semicolon
)brace
id|ipv6_addr_prefix
c_func
(paren
op_amp
id|rt-&gt;rt6i_dst.addr
comma
op_amp
id|rtmsg-&gt;rtmsg_dst
comma
id|rtmsg-&gt;rtmsg_dst_len
)paren
suffix:semicolon
id|rt-&gt;rt6i_dst.plen
op_assign
id|rtmsg-&gt;rtmsg_dst_len
suffix:semicolon
r_if
c_cond
(paren
id|rt-&gt;rt6i_dst.plen
op_eq
l_int|128
)paren
id|rt-&gt;u.dst.flags
op_assign
id|DST_HOST
suffix:semicolon
macro_line|#ifdef CONFIG_IPV6_SUBTREES
id|ipv6_addr_prefix
c_func
(paren
op_amp
id|rt-&gt;rt6i_src.addr
comma
op_amp
id|rtmsg-&gt;rtmsg_src
comma
id|rtmsg-&gt;rtmsg_src_len
)paren
suffix:semicolon
id|rt-&gt;rt6i_src.plen
op_assign
id|rtmsg-&gt;rtmsg_src_len
suffix:semicolon
macro_line|#endif
id|rt-&gt;rt6i_metric
op_assign
id|rtmsg-&gt;rtmsg_metric
suffix:semicolon
multiline_comment|/* We cannot add true routes via loopback here,&n;&t;   they would result in kernel looping; promote them to reject routes&n;&t; */
r_if
c_cond
(paren
(paren
id|rtmsg-&gt;rtmsg_flags
op_amp
id|RTF_REJECT
)paren
op_logical_or
(paren
id|dev
op_logical_and
(paren
id|dev-&gt;flags
op_amp
id|IFF_LOOPBACK
)paren
op_logical_and
op_logical_neg
(paren
id|addr_type
op_amp
id|IPV6_ADDR_LOOPBACK
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
id|dev
)paren
id|dev_put
c_func
(paren
id|dev
)paren
suffix:semicolon
id|dev
op_assign
op_amp
id|loopback_dev
suffix:semicolon
id|dev_hold
c_func
(paren
id|dev
)paren
suffix:semicolon
id|rt-&gt;u.dst.output
op_assign
id|ip6_pkt_discard
suffix:semicolon
id|rt-&gt;u.dst.input
op_assign
id|ip6_pkt_discard
suffix:semicolon
id|rt-&gt;u.dst.error
op_assign
op_minus
id|ENETUNREACH
suffix:semicolon
id|rt-&gt;rt6i_flags
op_assign
id|RTF_REJECT
op_or
id|RTF_NONEXTHOP
suffix:semicolon
r_goto
id|install_route
suffix:semicolon
)brace
r_if
c_cond
(paren
id|rtmsg-&gt;rtmsg_flags
op_amp
id|RTF_GATEWAY
)paren
(brace
r_struct
id|in6_addr
op_star
id|gw_addr
suffix:semicolon
r_int
id|gwa_type
suffix:semicolon
id|gw_addr
op_assign
op_amp
id|rtmsg-&gt;rtmsg_gateway
suffix:semicolon
id|ipv6_addr_copy
c_func
(paren
op_amp
id|rt-&gt;rt6i_gateway
comma
op_amp
id|rtmsg-&gt;rtmsg_gateway
)paren
suffix:semicolon
id|gwa_type
op_assign
id|ipv6_addr_type
c_func
(paren
id|gw_addr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|gwa_type
op_ne
(paren
id|IPV6_ADDR_LINKLOCAL
op_or
id|IPV6_ADDR_UNICAST
)paren
)paren
(brace
r_struct
id|rt6_info
op_star
id|grt
suffix:semicolon
multiline_comment|/* IPv6 strictly inhibits using not link-local&n;&t;&t;&t;   addresses as nexthop address.&n;&t;&t;&t;   Otherwise, router will not able to send redirects.&n;&t;&t;&t;   It is very good, but in some (rare!) curcumstances&n;&t;&t;&t;   (SIT, PtP, NBMA NOARP links) it is handy to allow&n;&t;&t;&t;   some exceptions. --ANK&n;&t;&t;&t; */
id|err
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|gwa_type
op_amp
id|IPV6_ADDR_UNICAST
)paren
)paren
r_goto
id|out
suffix:semicolon
id|grt
op_assign
id|rt6_lookup
c_func
(paren
id|gw_addr
comma
l_int|NULL
comma
id|rtmsg-&gt;rtmsg_ifindex
comma
l_int|1
)paren
suffix:semicolon
id|err
op_assign
op_minus
id|EHOSTUNREACH
suffix:semicolon
r_if
c_cond
(paren
id|grt
op_eq
l_int|NULL
)paren
r_goto
id|out
suffix:semicolon
r_if
c_cond
(paren
id|dev
)paren
(brace
r_if
c_cond
(paren
id|dev
op_ne
id|grt-&gt;rt6i_dev
)paren
(brace
id|dst_release
c_func
(paren
op_amp
id|grt-&gt;u.dst
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
)brace
r_else
(brace
id|dev
op_assign
id|grt-&gt;rt6i_dev
suffix:semicolon
id|dev_hold
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|grt-&gt;rt6i_flags
op_amp
id|RTF_GATEWAY
)paren
)paren
id|err
op_assign
l_int|0
suffix:semicolon
id|dst_release
c_func
(paren
op_amp
id|grt-&gt;u.dst
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_goto
id|out
suffix:semicolon
)brace
id|err
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|dev
op_eq
l_int|NULL
op_logical_or
(paren
id|dev-&gt;flags
op_amp
id|IFF_LOOPBACK
)paren
)paren
r_goto
id|out
suffix:semicolon
)brace
id|err
op_assign
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
id|dev
op_eq
l_int|NULL
)paren
r_goto
id|out
suffix:semicolon
r_if
c_cond
(paren
id|rtmsg-&gt;rtmsg_flags
op_amp
(paren
id|RTF_GATEWAY
op_or
id|RTF_NONEXTHOP
)paren
)paren
(brace
id|rt-&gt;rt6i_nexthop
op_assign
id|__neigh_lookup_errno
c_func
(paren
op_amp
id|nd_tbl
comma
op_amp
id|rt-&gt;rt6i_gateway
comma
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|IS_ERR
c_func
(paren
id|rt-&gt;rt6i_nexthop
)paren
)paren
(brace
id|err
op_assign
id|PTR_ERR
c_func
(paren
id|rt-&gt;rt6i_nexthop
)paren
suffix:semicolon
id|rt-&gt;rt6i_nexthop
op_assign
l_int|NULL
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|ipv6_addr_is_multicast
c_func
(paren
op_amp
id|rt-&gt;rt6i_dst.addr
)paren
)paren
id|rt-&gt;rt6i_hoplimit
op_assign
id|IPV6_DEFAULT_MCASTHOPS
suffix:semicolon
r_else
id|rt-&gt;rt6i_hoplimit
op_assign
id|ipv6_get_hoplimit
c_func
(paren
id|dev
)paren
suffix:semicolon
id|rt-&gt;rt6i_flags
op_assign
id|rtmsg-&gt;rtmsg_flags
suffix:semicolon
id|install_route
suffix:colon
id|rt-&gt;u.dst.metrics
(braket
id|RTAX_MTU
op_minus
l_int|1
)braket
op_assign
id|ipv6_get_mtu
c_func
(paren
id|dev
)paren
suffix:semicolon
id|rt-&gt;u.dst.metrics
(braket
id|RTAX_ADVMSS
op_minus
l_int|1
)braket
op_assign
id|max_t
c_func
(paren
r_int
r_int
comma
id|dst_pmtu
c_func
(paren
op_amp
id|rt-&gt;u.dst
)paren
op_minus
l_int|60
comma
id|ip6_rt_min_advmss
)paren
suffix:semicolon
multiline_comment|/* Maximal non-jumbo IPv6 payload is 65535 and corresponding&n;&t;   MSS is 65535 - tcp_header_size. 65535 is also valid and&n;&t;   means: &quot;any MSS, rely only on pmtu discovery&quot;&n;&t; */
r_if
c_cond
(paren
id|dst_metric
c_func
(paren
op_amp
id|rt-&gt;u.dst
comma
id|RTAX_ADVMSS
)paren
OG
l_int|65535
op_minus
l_int|20
)paren
id|rt-&gt;u.dst.metrics
(braket
id|RTAX_ADVMSS
op_minus
l_int|1
)braket
op_assign
l_int|65535
suffix:semicolon
id|rt-&gt;u.dst.dev
op_assign
id|dev
suffix:semicolon
r_return
id|rt6_ins
c_func
(paren
id|rt
comma
id|nlh
)paren
suffix:semicolon
id|out
suffix:colon
r_if
c_cond
(paren
id|dev
)paren
id|dev_put
c_func
(paren
id|dev
)paren
suffix:semicolon
id|dst_free
c_func
(paren
(paren
r_struct
id|dst_entry
op_star
)paren
id|rt
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|ip6_del_rt
r_int
id|ip6_del_rt
c_func
(paren
r_struct
id|rt6_info
op_star
id|rt
comma
r_struct
id|nlmsghdr
op_star
id|nlh
)paren
(brace
r_int
id|err
suffix:semicolon
id|write_lock_bh
c_func
(paren
op_amp
id|rt6_lock
)paren
suffix:semicolon
id|spin_lock_bh
c_func
(paren
op_amp
id|rt6_dflt_lock
)paren
suffix:semicolon
id|rt6_dflt_pointer
op_assign
l_int|NULL
suffix:semicolon
id|spin_unlock_bh
c_func
(paren
op_amp
id|rt6_dflt_lock
)paren
suffix:semicolon
id|dst_release
c_func
(paren
op_amp
id|rt-&gt;u.dst
)paren
suffix:semicolon
id|err
op_assign
id|fib6_del
c_func
(paren
id|rt
comma
id|nlh
)paren
suffix:semicolon
id|write_unlock_bh
c_func
(paren
op_amp
id|rt6_lock
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|ip6_route_del
r_static
r_int
id|ip6_route_del
c_func
(paren
r_struct
id|in6_rtmsg
op_star
id|rtmsg
comma
r_struct
id|nlmsghdr
op_star
id|nlh
)paren
(brace
r_struct
id|fib6_node
op_star
id|fn
suffix:semicolon
r_struct
id|rt6_info
op_star
id|rt
suffix:semicolon
r_int
id|err
op_assign
op_minus
id|ESRCH
suffix:semicolon
id|read_lock_bh
c_func
(paren
op_amp
id|rt6_lock
)paren
suffix:semicolon
id|fn
op_assign
id|fib6_locate
c_func
(paren
op_amp
id|ip6_routing_table
comma
op_amp
id|rtmsg-&gt;rtmsg_dst
comma
id|rtmsg-&gt;rtmsg_dst_len
comma
op_amp
id|rtmsg-&gt;rtmsg_src
comma
id|rtmsg-&gt;rtmsg_src_len
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fn
)paren
(brace
r_for
c_loop
(paren
id|rt
op_assign
id|fn-&gt;leaf
suffix:semicolon
id|rt
suffix:semicolon
id|rt
op_assign
id|rt-&gt;u.next
)paren
(brace
r_if
c_cond
(paren
id|rtmsg-&gt;rtmsg_ifindex
op_logical_and
(paren
id|rt-&gt;rt6i_dev
op_eq
l_int|NULL
op_logical_or
id|rt-&gt;rt6i_dev-&gt;ifindex
op_ne
id|rtmsg-&gt;rtmsg_ifindex
)paren
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|rtmsg-&gt;rtmsg_flags
op_amp
id|RTF_GATEWAY
op_logical_and
id|ipv6_addr_cmp
c_func
(paren
op_amp
id|rtmsg-&gt;rtmsg_gateway
comma
op_amp
id|rt-&gt;rt6i_gateway
)paren
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|rtmsg-&gt;rtmsg_metric
op_logical_and
id|rtmsg-&gt;rtmsg_metric
op_ne
id|rt-&gt;rt6i_metric
)paren
r_continue
suffix:semicolon
id|dst_hold
c_func
(paren
op_amp
id|rt-&gt;u.dst
)paren
suffix:semicolon
id|read_unlock_bh
c_func
(paren
op_amp
id|rt6_lock
)paren
suffix:semicolon
r_return
id|ip6_del_rt
c_func
(paren
id|rt
comma
id|nlh
)paren
suffix:semicolon
)brace
)brace
id|read_unlock_bh
c_func
(paren
op_amp
id|rt6_lock
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;Handle redirects&n; */
DECL|function|rt6_redirect
r_void
id|rt6_redirect
c_func
(paren
r_struct
id|in6_addr
op_star
id|dest
comma
r_struct
id|in6_addr
op_star
id|saddr
comma
r_struct
id|neighbour
op_star
id|neigh
comma
r_int
id|on_link
)paren
(brace
r_struct
id|rt6_info
op_star
id|rt
comma
op_star
id|nrt
suffix:semicolon
multiline_comment|/* Locate old route to this destination. */
id|rt
op_assign
id|rt6_lookup
c_func
(paren
id|dest
comma
l_int|NULL
comma
id|neigh-&gt;dev-&gt;ifindex
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rt
op_eq
l_int|NULL
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|neigh-&gt;dev
op_ne
id|rt-&gt;rt6i_dev
)paren
r_goto
id|out
suffix:semicolon
multiline_comment|/* Redirect received -&gt; path was valid.&n;&t;   Look, redirects are sent only in response to data packets,&n;&t;   so that this nexthop apparently is reachable. --ANK&n;&t; */
id|dst_confirm
c_func
(paren
op_amp
id|rt-&gt;u.dst
)paren
suffix:semicolon
multiline_comment|/* Duplicate redirect: silently ignore. */
r_if
c_cond
(paren
id|neigh
op_eq
id|rt-&gt;u.dst.neighbour
)paren
r_goto
id|out
suffix:semicolon
multiline_comment|/* Current route is on-link; redirect is always invalid.&n;&t;   &n;&t;   Seems, previous statement is not true. It could&n;&t;   be node, which looks for us as on-link (f.e. proxy ndisc)&n;&t;   But then router serving it might decide, that we should&n;&t;   know truth 8)8) --ANK (980726).&n;&t; */
r_if
c_cond
(paren
op_logical_neg
(paren
id|rt-&gt;rt6i_flags
op_amp
id|RTF_GATEWAY
)paren
)paren
r_goto
id|out
suffix:semicolon
multiline_comment|/*&n;&t; *&t;RFC 1970 specifies that redirects should only be&n;&t; *&t;accepted if they come from the nexthop to the target.&n;&t; *&t;Due to the way default routers are chosen, this notion&n;&t; *&t;is a bit fuzzy and one might need to check all default&n;&t; *&t;routers.&n;&t; */
r_if
c_cond
(paren
id|ipv6_addr_cmp
c_func
(paren
id|saddr
comma
op_amp
id|rt-&gt;rt6i_gateway
)paren
)paren
(brace
r_if
c_cond
(paren
id|rt-&gt;rt6i_flags
op_amp
id|RTF_DEFAULT
)paren
(brace
r_struct
id|rt6_info
op_star
id|rt1
suffix:semicolon
id|read_lock
c_func
(paren
op_amp
id|rt6_lock
)paren
suffix:semicolon
r_for
c_loop
(paren
id|rt1
op_assign
id|ip6_routing_table.leaf
suffix:semicolon
id|rt1
suffix:semicolon
id|rt1
op_assign
id|rt1-&gt;u.next
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|ipv6_addr_cmp
c_func
(paren
id|saddr
comma
op_amp
id|rt1-&gt;rt6i_gateway
)paren
)paren
(brace
id|dst_hold
c_func
(paren
op_amp
id|rt1-&gt;u.dst
)paren
suffix:semicolon
id|dst_release
c_func
(paren
op_amp
id|rt-&gt;u.dst
)paren
suffix:semicolon
id|read_unlock
c_func
(paren
op_amp
id|rt6_lock
)paren
suffix:semicolon
id|rt
op_assign
id|rt1
suffix:semicolon
r_goto
id|source_ok
suffix:semicolon
)brace
)brace
id|read_unlock
c_func
(paren
op_amp
id|rt6_lock
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|net_ratelimit
c_func
(paren
)paren
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;rt6_redirect: source isn&squot;t a valid nexthop &quot;
l_string|&quot;for redirect target&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|source_ok
suffix:colon
multiline_comment|/*&n;&t; *&t;We have finally decided to accept it.&n;&t; */
id|nrt
op_assign
id|ip6_rt_copy
c_func
(paren
id|rt
)paren
suffix:semicolon
r_if
c_cond
(paren
id|nrt
op_eq
l_int|NULL
)paren
r_goto
id|out
suffix:semicolon
id|nrt-&gt;rt6i_flags
op_assign
id|RTF_GATEWAY
op_or
id|RTF_UP
op_or
id|RTF_DYNAMIC
op_or
id|RTF_CACHE
suffix:semicolon
r_if
c_cond
(paren
id|on_link
)paren
id|nrt-&gt;rt6i_flags
op_and_assign
op_complement
id|RTF_GATEWAY
suffix:semicolon
id|ipv6_addr_copy
c_func
(paren
op_amp
id|nrt-&gt;rt6i_dst.addr
comma
id|dest
)paren
suffix:semicolon
id|nrt-&gt;rt6i_dst.plen
op_assign
l_int|128
suffix:semicolon
id|nrt-&gt;u.dst.flags
op_or_assign
id|DST_HOST
suffix:semicolon
id|ipv6_addr_copy
c_func
(paren
op_amp
id|nrt-&gt;rt6i_gateway
comma
(paren
r_struct
id|in6_addr
op_star
)paren
id|neigh-&gt;primary_key
)paren
suffix:semicolon
id|nrt-&gt;rt6i_nexthop
op_assign
id|neigh_clone
c_func
(paren
id|neigh
)paren
suffix:semicolon
multiline_comment|/* Reset pmtu, it may be better */
id|nrt-&gt;u.dst.metrics
(braket
id|RTAX_MTU
op_minus
l_int|1
)braket
op_assign
id|ipv6_get_mtu
c_func
(paren
id|neigh-&gt;dev
)paren
suffix:semicolon
id|nrt-&gt;u.dst.metrics
(braket
id|RTAX_ADVMSS
op_minus
l_int|1
)braket
op_assign
id|max_t
c_func
(paren
r_int
r_int
comma
id|dst_pmtu
c_func
(paren
op_amp
id|nrt-&gt;u.dst
)paren
op_minus
l_int|60
comma
id|ip6_rt_min_advmss
)paren
suffix:semicolon
r_if
c_cond
(paren
id|nrt-&gt;u.dst.metrics
(braket
id|RTAX_ADVMSS
op_minus
l_int|1
)braket
OG
l_int|65535
op_minus
l_int|20
)paren
id|nrt-&gt;u.dst.metrics
(braket
id|RTAX_ADVMSS
op_minus
l_int|1
)braket
op_assign
l_int|65535
suffix:semicolon
id|nrt-&gt;rt6i_hoplimit
op_assign
id|ipv6_get_hoplimit
c_func
(paren
id|neigh-&gt;dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rt6_ins
c_func
(paren
id|nrt
comma
l_int|NULL
)paren
)paren
r_goto
id|out
suffix:semicolon
r_if
c_cond
(paren
id|rt-&gt;rt6i_flags
op_amp
id|RTF_CACHE
)paren
(brace
id|ip6_del_rt
c_func
(paren
id|rt
comma
l_int|NULL
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|out
suffix:colon
id|dst_release
c_func
(paren
op_amp
id|rt-&gt;u.dst
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;Handle ICMP &quot;packet too big&quot; messages&n; *&t;i.e. Path MTU discovery&n; */
DECL|function|rt6_pmtu_discovery
r_void
id|rt6_pmtu_discovery
c_func
(paren
r_struct
id|in6_addr
op_star
id|daddr
comma
r_struct
id|in6_addr
op_star
id|saddr
comma
r_struct
id|net_device
op_star
id|dev
comma
id|u32
id|pmtu
)paren
(brace
r_struct
id|rt6_info
op_star
id|rt
comma
op_star
id|nrt
suffix:semicolon
r_if
c_cond
(paren
id|pmtu
OL
id|IPV6_MIN_MTU
)paren
(brace
r_if
c_cond
(paren
id|net_ratelimit
c_func
(paren
)paren
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;rt6_pmtu_discovery: invalid MTU value %d&bslash;n&quot;
comma
id|pmtu
)paren
suffix:semicolon
multiline_comment|/* According to RFC1981, the PMTU is set to the IPv6 minimum&n;&t;&t;   link MTU if the node receives a Packet Too Big message&n;&t;&t;   reporting next-hop MTU that is less than the IPv6 minimum MTU.&n;&t;&t;   */
id|pmtu
op_assign
id|IPV6_MIN_MTU
suffix:semicolon
)brace
id|rt
op_assign
id|rt6_lookup
c_func
(paren
id|daddr
comma
id|saddr
comma
id|dev-&gt;ifindex
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rt
op_eq
l_int|NULL
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|pmtu
op_ge
id|dst_pmtu
c_func
(paren
op_amp
id|rt-&gt;u.dst
)paren
)paren
r_goto
id|out
suffix:semicolon
multiline_comment|/* New mtu received -&gt; path was valid.&n;&t;   They are sent only in response to data packets,&n;&t;   so that this nexthop apparently is reachable. --ANK&n;&t; */
id|dst_confirm
c_func
(paren
op_amp
id|rt-&gt;u.dst
)paren
suffix:semicolon
multiline_comment|/* Host route. If it is static, it would be better&n;&t;   not to override it, but add new one, so that&n;&t;   when cache entry will expire old pmtu&n;&t;   would return automatically.&n;&t; */
r_if
c_cond
(paren
id|rt-&gt;rt6i_flags
op_amp
id|RTF_CACHE
)paren
(brace
id|rt-&gt;u.dst.metrics
(braket
id|RTAX_MTU
op_minus
l_int|1
)braket
op_assign
id|pmtu
suffix:semicolon
id|dst_set_expires
c_func
(paren
op_amp
id|rt-&gt;u.dst
comma
id|ip6_rt_mtu_expires
)paren
suffix:semicolon
id|rt-&gt;rt6i_flags
op_or_assign
id|RTF_MODIFIED
op_or
id|RTF_EXPIRES
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
multiline_comment|/* Network route.&n;&t;   Two cases are possible:&n;&t;   1. It is connected route. Action: COW&n;&t;   2. It is gatewayed route or NONEXTHOP route. Action: clone it.&n;&t; */
r_if
c_cond
(paren
op_logical_neg
id|rt-&gt;rt6i_nexthop
op_logical_and
op_logical_neg
(paren
id|rt-&gt;rt6i_flags
op_amp
id|RTF_NONEXTHOP
)paren
)paren
(brace
id|nrt
op_assign
id|rt6_cow
c_func
(paren
id|rt
comma
id|daddr
comma
id|saddr
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|nrt-&gt;u.dst.error
)paren
(brace
id|nrt-&gt;u.dst.metrics
(braket
id|RTAX_MTU
op_minus
l_int|1
)braket
op_assign
id|pmtu
suffix:semicolon
multiline_comment|/* According to RFC 1981, detecting PMTU increase shouldn&squot;t be&n;&t;&t;&t;   happened within 5 mins, the recommended timer is 10 mins.&n;&t;&t;&t;   Here this route expiration time is set to ip6_rt_mtu_expires&n;&t;&t;&t;   which is 10 mins. After 10 mins the decreased pmtu is expired&n;&t;&t;&t;   and detecting PMTU increase will be automatically happened.&n;&t;&t;&t; */
id|dst_set_expires
c_func
(paren
op_amp
id|nrt-&gt;u.dst
comma
id|ip6_rt_mtu_expires
)paren
suffix:semicolon
id|nrt-&gt;rt6i_flags
op_or_assign
id|RTF_DYNAMIC
op_or
id|RTF_EXPIRES
suffix:semicolon
id|dst_release
c_func
(paren
op_amp
id|nrt-&gt;u.dst
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
id|nrt
op_assign
id|ip6_rt_copy
c_func
(paren
id|rt
)paren
suffix:semicolon
r_if
c_cond
(paren
id|nrt
op_eq
l_int|NULL
)paren
r_goto
id|out
suffix:semicolon
id|ipv6_addr_copy
c_func
(paren
op_amp
id|nrt-&gt;rt6i_dst.addr
comma
id|daddr
)paren
suffix:semicolon
id|nrt-&gt;rt6i_dst.plen
op_assign
l_int|128
suffix:semicolon
id|nrt-&gt;u.dst.flags
op_or_assign
id|DST_HOST
suffix:semicolon
id|nrt-&gt;rt6i_nexthop
op_assign
id|neigh_clone
c_func
(paren
id|rt-&gt;rt6i_nexthop
)paren
suffix:semicolon
id|dst_set_expires
c_func
(paren
op_amp
id|nrt-&gt;u.dst
comma
id|ip6_rt_mtu_expires
)paren
suffix:semicolon
id|nrt-&gt;rt6i_flags
op_or_assign
id|RTF_DYNAMIC
op_or
id|RTF_CACHE
op_or
id|RTF_EXPIRES
suffix:semicolon
id|nrt-&gt;u.dst.metrics
(braket
id|RTAX_MTU
op_minus
l_int|1
)braket
op_assign
id|pmtu
suffix:semicolon
id|rt6_ins
c_func
(paren
id|nrt
comma
l_int|NULL
)paren
suffix:semicolon
)brace
id|out
suffix:colon
id|dst_release
c_func
(paren
op_amp
id|rt-&gt;u.dst
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;Misc support functions&n; */
DECL|function|ip6_rt_copy
r_static
r_struct
id|rt6_info
op_star
id|ip6_rt_copy
c_func
(paren
r_struct
id|rt6_info
op_star
id|ort
)paren
(brace
r_struct
id|rt6_info
op_star
id|rt
suffix:semicolon
id|rt
op_assign
id|dst_alloc
c_func
(paren
op_amp
id|ip6_dst_ops
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rt
)paren
(brace
id|rt-&gt;u.dst.input
op_assign
id|ort-&gt;u.dst.input
suffix:semicolon
id|rt-&gt;u.dst.output
op_assign
id|ort-&gt;u.dst.output
suffix:semicolon
id|memcpy
c_func
(paren
id|rt-&gt;u.dst.metrics
comma
id|ort-&gt;u.dst.metrics
comma
id|RTAX_MAX
op_star
r_sizeof
(paren
id|u32
)paren
)paren
suffix:semicolon
id|rt-&gt;u.dst.dev
op_assign
id|ort-&gt;u.dst.dev
suffix:semicolon
r_if
c_cond
(paren
id|rt-&gt;u.dst.dev
)paren
id|dev_hold
c_func
(paren
id|rt-&gt;u.dst.dev
)paren
suffix:semicolon
id|rt-&gt;u.dst.lastuse
op_assign
id|jiffies
suffix:semicolon
id|rt-&gt;rt6i_hoplimit
op_assign
id|ort-&gt;rt6i_hoplimit
suffix:semicolon
id|rt-&gt;rt6i_expires
op_assign
l_int|0
suffix:semicolon
id|ipv6_addr_copy
c_func
(paren
op_amp
id|rt-&gt;rt6i_gateway
comma
op_amp
id|ort-&gt;rt6i_gateway
)paren
suffix:semicolon
id|rt-&gt;rt6i_flags
op_assign
id|ort-&gt;rt6i_flags
op_amp
op_complement
id|RTF_EXPIRES
suffix:semicolon
id|rt-&gt;rt6i_metric
op_assign
l_int|0
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|rt-&gt;rt6i_dst
comma
op_amp
id|ort-&gt;rt6i_dst
comma
r_sizeof
(paren
r_struct
id|rt6key
)paren
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_IPV6_SUBTREES
id|memcpy
c_func
(paren
op_amp
id|rt-&gt;rt6i_src
comma
op_amp
id|ort-&gt;rt6i_src
comma
r_sizeof
(paren
r_struct
id|rt6key
)paren
)paren
suffix:semicolon
macro_line|#endif
)brace
r_return
id|rt
suffix:semicolon
)brace
DECL|function|rt6_get_dflt_router
r_struct
id|rt6_info
op_star
id|rt6_get_dflt_router
c_func
(paren
r_struct
id|in6_addr
op_star
id|addr
comma
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|rt6_info
op_star
id|rt
suffix:semicolon
r_struct
id|fib6_node
op_star
id|fn
suffix:semicolon
id|fn
op_assign
op_amp
id|ip6_routing_table
suffix:semicolon
id|write_lock_bh
c_func
(paren
op_amp
id|rt6_lock
)paren
suffix:semicolon
r_for
c_loop
(paren
id|rt
op_assign
id|fn-&gt;leaf
suffix:semicolon
id|rt
suffix:semicolon
id|rt
op_assign
id|rt-&gt;u.next
)paren
(brace
r_if
c_cond
(paren
id|dev
op_eq
id|rt-&gt;rt6i_dev
op_logical_and
id|ipv6_addr_cmp
c_func
(paren
op_amp
id|rt-&gt;rt6i_gateway
comma
id|addr
)paren
op_eq
l_int|0
)paren
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|rt
)paren
id|dst_hold
c_func
(paren
op_amp
id|rt-&gt;u.dst
)paren
suffix:semicolon
id|write_unlock_bh
c_func
(paren
op_amp
id|rt6_lock
)paren
suffix:semicolon
r_return
id|rt
suffix:semicolon
)brace
DECL|function|rt6_add_dflt_router
r_struct
id|rt6_info
op_star
id|rt6_add_dflt_router
c_func
(paren
r_struct
id|in6_addr
op_star
id|gwaddr
comma
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|in6_rtmsg
id|rtmsg
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|rtmsg
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|in6_rtmsg
)paren
)paren
suffix:semicolon
id|rtmsg.rtmsg_type
op_assign
id|RTMSG_NEWROUTE
suffix:semicolon
id|ipv6_addr_copy
c_func
(paren
op_amp
id|rtmsg.rtmsg_gateway
comma
id|gwaddr
)paren
suffix:semicolon
id|rtmsg.rtmsg_metric
op_assign
l_int|1024
suffix:semicolon
id|rtmsg.rtmsg_flags
op_assign
id|RTF_GATEWAY
op_or
id|RTF_ADDRCONF
op_or
id|RTF_DEFAULT
op_or
id|RTF_UP
suffix:semicolon
id|rtmsg.rtmsg_ifindex
op_assign
id|dev-&gt;ifindex
suffix:semicolon
id|ip6_route_add
c_func
(paren
op_amp
id|rtmsg
comma
l_int|NULL
)paren
suffix:semicolon
r_return
id|rt6_get_dflt_router
c_func
(paren
id|gwaddr
comma
id|dev
)paren
suffix:semicolon
)brace
DECL|function|rt6_purge_dflt_routers
r_void
id|rt6_purge_dflt_routers
c_func
(paren
r_int
id|last_resort
)paren
(brace
r_struct
id|rt6_info
op_star
id|rt
suffix:semicolon
id|u32
id|flags
suffix:semicolon
r_if
c_cond
(paren
id|last_resort
)paren
id|flags
op_assign
id|RTF_ALLONLINK
suffix:semicolon
r_else
id|flags
op_assign
id|RTF_DEFAULT
op_or
id|RTF_ADDRCONF
suffix:semicolon
id|restart
suffix:colon
id|read_lock_bh
c_func
(paren
op_amp
id|rt6_lock
)paren
suffix:semicolon
r_for
c_loop
(paren
id|rt
op_assign
id|ip6_routing_table.leaf
suffix:semicolon
id|rt
suffix:semicolon
id|rt
op_assign
id|rt-&gt;u.next
)paren
(brace
r_if
c_cond
(paren
id|rt-&gt;rt6i_flags
op_amp
id|flags
)paren
(brace
id|dst_hold
c_func
(paren
op_amp
id|rt-&gt;u.dst
)paren
suffix:semicolon
id|spin_lock_bh
c_func
(paren
op_amp
id|rt6_dflt_lock
)paren
suffix:semicolon
id|rt6_dflt_pointer
op_assign
l_int|NULL
suffix:semicolon
id|spin_unlock_bh
c_func
(paren
op_amp
id|rt6_dflt_lock
)paren
suffix:semicolon
id|read_unlock_bh
c_func
(paren
op_amp
id|rt6_lock
)paren
suffix:semicolon
id|ip6_del_rt
c_func
(paren
id|rt
comma
l_int|NULL
)paren
suffix:semicolon
r_goto
id|restart
suffix:semicolon
)brace
)brace
id|read_unlock_bh
c_func
(paren
op_amp
id|rt6_lock
)paren
suffix:semicolon
)brace
DECL|function|ipv6_route_ioctl
r_int
id|ipv6_route_ioctl
c_func
(paren
r_int
r_int
id|cmd
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|in6_rtmsg
id|rtmsg
suffix:semicolon
r_int
id|err
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|SIOCADDRT
suffix:colon
multiline_comment|/* Add a route */
r_case
id|SIOCDELRT
suffix:colon
multiline_comment|/* Delete a route */
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_NET_ADMIN
)paren
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
id|err
op_assign
id|copy_from_user
c_func
(paren
op_amp
id|rtmsg
comma
id|arg
comma
r_sizeof
(paren
r_struct
id|in6_rtmsg
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|rtnl_lock
c_func
(paren
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|SIOCADDRT
suffix:colon
id|err
op_assign
id|ip6_route_add
c_func
(paren
op_amp
id|rtmsg
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIOCDELRT
suffix:colon
id|err
op_assign
id|ip6_route_del
c_func
(paren
op_amp
id|rtmsg
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|err
op_assign
op_minus
id|EINVAL
suffix:semicolon
)brace
id|rtnl_unlock
c_func
(paren
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;Drop the packet on the floor&n; */
DECL|function|ip6_pkt_discard
r_int
id|ip6_pkt_discard
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
id|IP6_INC_STATS
c_func
(paren
id|Ip6OutNoRoutes
)paren
suffix:semicolon
id|icmpv6_send
c_func
(paren
id|skb
comma
id|ICMPV6_DEST_UNREACH
comma
id|ICMPV6_ADDR_UNREACH
comma
l_int|0
comma
id|skb-&gt;dev
)paren
suffix:semicolon
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;Add address&n; */
DECL|function|ip6_rt_addr_add
r_int
id|ip6_rt_addr_add
c_func
(paren
r_struct
id|in6_addr
op_star
id|addr
comma
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|rt6_info
op_star
id|rt
suffix:semicolon
id|rt
op_assign
id|dst_alloc
c_func
(paren
op_amp
id|ip6_dst_ops
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rt
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|rt-&gt;u.dst.flags
op_assign
id|DST_HOST
suffix:semicolon
id|rt-&gt;u.dst.input
op_assign
id|ip6_input
suffix:semicolon
id|rt-&gt;u.dst.output
op_assign
id|ip6_output
suffix:semicolon
id|rt-&gt;rt6i_dev
op_assign
id|dev_get_by_name
c_func
(paren
l_string|&quot;lo&quot;
)paren
suffix:semicolon
id|rt-&gt;u.dst.metrics
(braket
id|RTAX_MTU
op_minus
l_int|1
)braket
op_assign
id|ipv6_get_mtu
c_func
(paren
id|rt-&gt;rt6i_dev
)paren
suffix:semicolon
id|rt-&gt;u.dst.metrics
(braket
id|RTAX_ADVMSS
op_minus
l_int|1
)braket
op_assign
id|max_t
c_func
(paren
r_int
r_int
comma
id|dst_pmtu
c_func
(paren
op_amp
id|rt-&gt;u.dst
)paren
op_minus
l_int|60
comma
id|ip6_rt_min_advmss
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rt-&gt;u.dst.metrics
(braket
id|RTAX_ADVMSS
op_minus
l_int|1
)braket
OG
l_int|65535
op_minus
l_int|20
)paren
id|rt-&gt;u.dst.metrics
(braket
id|RTAX_ADVMSS
op_minus
l_int|1
)braket
op_assign
l_int|65535
suffix:semicolon
id|rt-&gt;rt6i_hoplimit
op_assign
id|ipv6_get_hoplimit
c_func
(paren
id|rt-&gt;rt6i_dev
)paren
suffix:semicolon
id|rt-&gt;u.dst.obsolete
op_assign
op_minus
l_int|1
suffix:semicolon
id|rt-&gt;rt6i_flags
op_assign
id|RTF_UP
op_or
id|RTF_NONEXTHOP
suffix:semicolon
id|rt-&gt;rt6i_nexthop
op_assign
id|ndisc_get_neigh
c_func
(paren
id|rt-&gt;rt6i_dev
comma
op_amp
id|rt-&gt;rt6i_gateway
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rt-&gt;rt6i_nexthop
op_eq
l_int|NULL
)paren
(brace
id|dst_free
c_func
(paren
(paren
r_struct
id|dst_entry
op_star
)paren
id|rt
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|ipv6_addr_copy
c_func
(paren
op_amp
id|rt-&gt;rt6i_dst.addr
comma
id|addr
)paren
suffix:semicolon
id|rt-&gt;rt6i_dst.plen
op_assign
l_int|128
suffix:semicolon
id|rt6_ins
c_func
(paren
id|rt
comma
l_int|NULL
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* Delete address. Warning: you should check that this address&n;   disappeared before calling this function.&n; */
DECL|function|ip6_rt_addr_del
r_int
id|ip6_rt_addr_del
c_func
(paren
r_struct
id|in6_addr
op_star
id|addr
comma
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|rt6_info
op_star
id|rt
suffix:semicolon
r_int
id|err
op_assign
op_minus
id|ENOENT
suffix:semicolon
id|rt
op_assign
id|rt6_lookup
c_func
(paren
id|addr
comma
l_int|NULL
comma
id|loopback_dev.ifindex
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rt
)paren
(brace
r_if
c_cond
(paren
id|rt-&gt;rt6i_dst.plen
op_eq
l_int|128
)paren
id|err
op_assign
id|ip6_del_rt
c_func
(paren
id|rt
comma
l_int|NULL
)paren
suffix:semicolon
r_else
id|dst_release
c_func
(paren
op_amp
id|rt-&gt;u.dst
)paren
suffix:semicolon
)brace
r_return
id|err
suffix:semicolon
)brace
DECL|function|fib6_ifdown
r_static
r_int
id|fib6_ifdown
c_func
(paren
r_struct
id|rt6_info
op_star
id|rt
comma
r_void
op_star
id|arg
)paren
(brace
r_if
c_cond
(paren
(paren
(paren
r_void
op_star
)paren
id|rt-&gt;rt6i_dev
op_eq
id|arg
op_logical_or
id|arg
op_eq
l_int|NULL
)paren
op_logical_and
id|rt
op_ne
op_amp
id|ip6_null_entry
)paren
(brace
id|RT6_TRACE
c_func
(paren
l_string|&quot;deleted by ifdown %p&bslash;n&quot;
comma
id|rt
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|rt6_ifdown
r_void
id|rt6_ifdown
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
id|write_lock_bh
c_func
(paren
op_amp
id|rt6_lock
)paren
suffix:semicolon
id|fib6_clean_tree
c_func
(paren
op_amp
id|ip6_routing_table
comma
id|fib6_ifdown
comma
l_int|0
comma
id|dev
)paren
suffix:semicolon
id|write_unlock_bh
c_func
(paren
op_amp
id|rt6_lock
)paren
suffix:semicolon
)brace
DECL|struct|rt6_mtu_change_arg
r_struct
id|rt6_mtu_change_arg
(brace
DECL|member|dev
r_struct
id|net_device
op_star
id|dev
suffix:semicolon
DECL|member|mtu
r_int
id|mtu
suffix:semicolon
)brace
suffix:semicolon
DECL|function|rt6_mtu_change_route
r_static
r_int
id|rt6_mtu_change_route
c_func
(paren
r_struct
id|rt6_info
op_star
id|rt
comma
r_void
op_star
id|p_arg
)paren
(brace
r_struct
id|rt6_mtu_change_arg
op_star
id|arg
op_assign
(paren
r_struct
id|rt6_mtu_change_arg
op_star
)paren
id|p_arg
suffix:semicolon
r_struct
id|inet6_dev
op_star
id|idev
suffix:semicolon
multiline_comment|/* In IPv6 pmtu discovery is not optional,&n;&t;   so that RTAX_MTU lock cannot disable it.&n;&t;   We still use this lock to block changes&n;&t;   caused by addrconf/ndisc.&n;&t;*/
id|idev
op_assign
id|__in6_dev_get
c_func
(paren
id|arg-&gt;dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|idev
op_eq
l_int|NULL
)paren
r_return
l_int|0
suffix:semicolon
multiline_comment|/* For administrative MTU increase, there is no way to discover&n;&t;   IPv6 PMTU increase, so PMTU increase should be updated here.&n;&t;   Since RFC 1981 doesn&squot;t include administrative MTU increase&n;&t;   update PMTU increase is a MUST. (i.e. jumbo frame)&n;&t; */
multiline_comment|/*&n;&t;   If new MTU is less than route PMTU, this new MTU will be the&n;&t;   lowest MTU in the path, update the route PMTU to refect PMTU&n;&t;   decreases; if new MTU is greater than route PMTU, and the&n;&t;   old MTU is the lowest MTU in the path, update the route PMTU&n;&t;   to refect the increase. In this case if the other nodes&squot; MTU&n;&t;   also have the lowest MTU, TOO BIG MESSAGE will be lead to&n;&t;   PMTU discouvery.&n;&t; */
r_if
c_cond
(paren
id|rt-&gt;rt6i_dev
op_eq
id|arg-&gt;dev
op_logical_and
op_logical_neg
id|dst_metric_locked
c_func
(paren
op_amp
id|rt-&gt;u.dst
comma
id|RTAX_MTU
)paren
op_logical_and
(paren
id|dst_pmtu
c_func
(paren
op_amp
id|rt-&gt;u.dst
)paren
OG
id|arg-&gt;mtu
op_logical_or
(paren
id|dst_pmtu
c_func
(paren
op_amp
id|rt-&gt;u.dst
)paren
OL
id|arg-&gt;mtu
op_logical_and
id|dst_pmtu
c_func
(paren
op_amp
id|rt-&gt;u.dst
)paren
op_eq
id|idev-&gt;cnf.mtu6
)paren
)paren
)paren
id|rt-&gt;u.dst.metrics
(braket
id|RTAX_MTU
op_minus
l_int|1
)braket
op_assign
id|arg-&gt;mtu
suffix:semicolon
id|rt-&gt;u.dst.metrics
(braket
id|RTAX_ADVMSS
op_minus
l_int|1
)braket
op_assign
id|max_t
c_func
(paren
r_int
r_int
comma
id|arg-&gt;mtu
op_minus
l_int|60
comma
id|ip6_rt_min_advmss
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rt-&gt;u.dst.metrics
(braket
id|RTAX_ADVMSS
op_minus
l_int|1
)braket
OG
l_int|65535
op_minus
l_int|20
)paren
id|rt-&gt;u.dst.metrics
(braket
id|RTAX_ADVMSS
op_minus
l_int|1
)braket
op_assign
l_int|65535
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|rt6_mtu_change
r_void
id|rt6_mtu_change
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|mtu
)paren
(brace
r_struct
id|rt6_mtu_change_arg
id|arg
suffix:semicolon
id|arg.dev
op_assign
id|dev
suffix:semicolon
id|arg.mtu
op_assign
id|mtu
suffix:semicolon
id|read_lock_bh
c_func
(paren
op_amp
id|rt6_lock
)paren
suffix:semicolon
id|fib6_clean_tree
c_func
(paren
op_amp
id|ip6_routing_table
comma
id|rt6_mtu_change_route
comma
l_int|0
comma
op_amp
id|arg
)paren
suffix:semicolon
id|read_unlock_bh
c_func
(paren
op_amp
id|rt6_lock
)paren
suffix:semicolon
)brace
DECL|function|inet6_rtm_to_rtmsg
r_static
r_int
id|inet6_rtm_to_rtmsg
c_func
(paren
r_struct
id|rtmsg
op_star
id|r
comma
r_struct
id|rtattr
op_star
op_star
id|rta
comma
r_struct
id|in6_rtmsg
op_star
id|rtmsg
)paren
(brace
id|memset
c_func
(paren
id|rtmsg
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|rtmsg
)paren
)paren
suffix:semicolon
id|rtmsg-&gt;rtmsg_dst_len
op_assign
id|r-&gt;rtm_dst_len
suffix:semicolon
id|rtmsg-&gt;rtmsg_src_len
op_assign
id|r-&gt;rtm_src_len
suffix:semicolon
id|rtmsg-&gt;rtmsg_flags
op_assign
id|RTF_UP
suffix:semicolon
r_if
c_cond
(paren
id|r-&gt;rtm_type
op_eq
id|RTN_UNREACHABLE
)paren
id|rtmsg-&gt;rtmsg_flags
op_or_assign
id|RTF_REJECT
suffix:semicolon
r_if
c_cond
(paren
id|rta
(braket
id|RTA_GATEWAY
op_minus
l_int|1
)braket
)paren
(brace
r_if
c_cond
(paren
id|rta
(braket
id|RTA_GATEWAY
op_minus
l_int|1
)braket
op_member_access_from_pointer
id|rta_len
op_ne
id|RTA_LENGTH
c_func
(paren
l_int|16
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|rtmsg-&gt;rtmsg_gateway
comma
id|RTA_DATA
c_func
(paren
id|rta
(braket
id|RTA_GATEWAY
op_minus
l_int|1
)braket
)paren
comma
l_int|16
)paren
suffix:semicolon
id|rtmsg-&gt;rtmsg_flags
op_or_assign
id|RTF_GATEWAY
suffix:semicolon
)brace
r_if
c_cond
(paren
id|rta
(braket
id|RTA_DST
op_minus
l_int|1
)braket
)paren
(brace
r_if
c_cond
(paren
id|RTA_PAYLOAD
c_func
(paren
id|rta
(braket
id|RTA_DST
op_minus
l_int|1
)braket
)paren
OL
(paren
(paren
id|r-&gt;rtm_dst_len
op_plus
l_int|7
)paren
op_rshift
l_int|3
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|rtmsg-&gt;rtmsg_dst
comma
id|RTA_DATA
c_func
(paren
id|rta
(braket
id|RTA_DST
op_minus
l_int|1
)braket
)paren
comma
(paren
(paren
id|r-&gt;rtm_dst_len
op_plus
l_int|7
)paren
op_rshift
l_int|3
)paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|rta
(braket
id|RTA_SRC
op_minus
l_int|1
)braket
)paren
(brace
r_if
c_cond
(paren
id|RTA_PAYLOAD
c_func
(paren
id|rta
(braket
id|RTA_SRC
op_minus
l_int|1
)braket
)paren
OL
(paren
(paren
id|r-&gt;rtm_src_len
op_plus
l_int|7
)paren
op_rshift
l_int|3
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|rtmsg-&gt;rtmsg_src
comma
id|RTA_DATA
c_func
(paren
id|rta
(braket
id|RTA_SRC
op_minus
l_int|1
)braket
)paren
comma
(paren
(paren
id|r-&gt;rtm_src_len
op_plus
l_int|7
)paren
op_rshift
l_int|3
)paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|rta
(braket
id|RTA_OIF
op_minus
l_int|1
)braket
)paren
(brace
r_if
c_cond
(paren
id|rta
(braket
id|RTA_OIF
op_minus
l_int|1
)braket
op_member_access_from_pointer
id|rta_len
op_ne
id|RTA_LENGTH
c_func
(paren
r_sizeof
(paren
r_int
)paren
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|rtmsg-&gt;rtmsg_ifindex
comma
id|RTA_DATA
c_func
(paren
id|rta
(braket
id|RTA_OIF
op_minus
l_int|1
)braket
)paren
comma
r_sizeof
(paren
r_int
)paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|rta
(braket
id|RTA_PRIORITY
op_minus
l_int|1
)braket
)paren
(brace
r_if
c_cond
(paren
id|rta
(braket
id|RTA_PRIORITY
op_minus
l_int|1
)braket
op_member_access_from_pointer
id|rta_len
op_ne
id|RTA_LENGTH
c_func
(paren
l_int|4
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|rtmsg-&gt;rtmsg_metric
comma
id|RTA_DATA
c_func
(paren
id|rta
(braket
id|RTA_PRIORITY
op_minus
l_int|1
)braket
)paren
comma
l_int|4
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|inet6_rtm_delroute
r_int
id|inet6_rtm_delroute
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|nlmsghdr
op_star
id|nlh
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|rtmsg
op_star
id|r
op_assign
id|NLMSG_DATA
c_func
(paren
id|nlh
)paren
suffix:semicolon
r_struct
id|in6_rtmsg
id|rtmsg
suffix:semicolon
r_if
c_cond
(paren
id|inet6_rtm_to_rtmsg
c_func
(paren
id|r
comma
id|arg
comma
op_amp
id|rtmsg
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_return
id|ip6_route_del
c_func
(paren
op_amp
id|rtmsg
comma
id|nlh
)paren
suffix:semicolon
)brace
DECL|function|inet6_rtm_newroute
r_int
id|inet6_rtm_newroute
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|nlmsghdr
op_star
id|nlh
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|rtmsg
op_star
id|r
op_assign
id|NLMSG_DATA
c_func
(paren
id|nlh
)paren
suffix:semicolon
r_struct
id|in6_rtmsg
id|rtmsg
suffix:semicolon
r_if
c_cond
(paren
id|inet6_rtm_to_rtmsg
c_func
(paren
id|r
comma
id|arg
comma
op_amp
id|rtmsg
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_return
id|ip6_route_add
c_func
(paren
op_amp
id|rtmsg
comma
id|nlh
)paren
suffix:semicolon
)brace
DECL|struct|rt6_rtnl_dump_arg
r_struct
id|rt6_rtnl_dump_arg
(brace
DECL|member|skb
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
DECL|member|cb
r_struct
id|netlink_callback
op_star
id|cb
suffix:semicolon
)brace
suffix:semicolon
DECL|function|rt6_fill_node
r_static
r_int
id|rt6_fill_node
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|rt6_info
op_star
id|rt
comma
r_struct
id|in6_addr
op_star
id|dst
comma
r_struct
id|in6_addr
op_star
id|src
comma
r_int
id|iif
comma
r_int
id|type
comma
id|u32
id|pid
comma
id|u32
id|seq
comma
r_struct
id|nlmsghdr
op_star
id|in_nlh
)paren
(brace
r_struct
id|rtmsg
op_star
id|rtm
suffix:semicolon
r_struct
id|nlmsghdr
op_star
id|nlh
suffix:semicolon
r_int
r_char
op_star
id|b
op_assign
id|skb-&gt;tail
suffix:semicolon
r_struct
id|rta_cacheinfo
id|ci
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pid
op_logical_and
id|in_nlh
)paren
(brace
id|pid
op_assign
id|in_nlh-&gt;nlmsg_pid
suffix:semicolon
)brace
id|nlh
op_assign
id|NLMSG_PUT
c_func
(paren
id|skb
comma
id|pid
comma
id|seq
comma
id|type
comma
r_sizeof
(paren
op_star
id|rtm
)paren
)paren
suffix:semicolon
id|rtm
op_assign
id|NLMSG_DATA
c_func
(paren
id|nlh
)paren
suffix:semicolon
id|rtm-&gt;rtm_family
op_assign
id|AF_INET6
suffix:semicolon
id|rtm-&gt;rtm_dst_len
op_assign
id|rt-&gt;rt6i_dst.plen
suffix:semicolon
id|rtm-&gt;rtm_src_len
op_assign
id|rt-&gt;rt6i_src.plen
suffix:semicolon
id|rtm-&gt;rtm_tos
op_assign
l_int|0
suffix:semicolon
id|rtm-&gt;rtm_table
op_assign
id|RT_TABLE_MAIN
suffix:semicolon
r_if
c_cond
(paren
id|rt-&gt;rt6i_flags
op_amp
id|RTF_REJECT
)paren
id|rtm-&gt;rtm_type
op_assign
id|RTN_UNREACHABLE
suffix:semicolon
r_else
r_if
c_cond
(paren
id|rt-&gt;rt6i_dev
op_logical_and
(paren
id|rt-&gt;rt6i_dev-&gt;flags
op_amp
id|IFF_LOOPBACK
)paren
)paren
id|rtm-&gt;rtm_type
op_assign
id|RTN_LOCAL
suffix:semicolon
r_else
id|rtm-&gt;rtm_type
op_assign
id|RTN_UNICAST
suffix:semicolon
id|rtm-&gt;rtm_flags
op_assign
l_int|0
suffix:semicolon
id|rtm-&gt;rtm_scope
op_assign
id|RT_SCOPE_UNIVERSE
suffix:semicolon
id|rtm-&gt;rtm_protocol
op_assign
id|rt-&gt;rt6i_protocol
suffix:semicolon
r_if
c_cond
(paren
id|rt-&gt;rt6i_flags
op_amp
id|RTF_DYNAMIC
)paren
id|rtm-&gt;rtm_protocol
op_assign
id|RTPROT_REDIRECT
suffix:semicolon
r_else
r_if
c_cond
(paren
id|rt-&gt;rt6i_flags
op_amp
(paren
id|RTF_ADDRCONF
op_or
id|RTF_ALLONLINK
)paren
)paren
id|rtm-&gt;rtm_protocol
op_assign
id|RTPROT_KERNEL
suffix:semicolon
r_else
r_if
c_cond
(paren
id|rt-&gt;rt6i_flags
op_amp
id|RTF_DEFAULT
)paren
id|rtm-&gt;rtm_protocol
op_assign
id|RTPROT_RA
suffix:semicolon
r_if
c_cond
(paren
id|rt-&gt;rt6i_flags
op_amp
id|RTF_CACHE
)paren
id|rtm-&gt;rtm_flags
op_or_assign
id|RTM_F_CLONED
suffix:semicolon
r_if
c_cond
(paren
id|dst
)paren
(brace
id|RTA_PUT
c_func
(paren
id|skb
comma
id|RTA_DST
comma
l_int|16
comma
id|dst
)paren
suffix:semicolon
id|rtm-&gt;rtm_dst_len
op_assign
l_int|128
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|rtm-&gt;rtm_dst_len
)paren
id|RTA_PUT
c_func
(paren
id|skb
comma
id|RTA_DST
comma
l_int|16
comma
op_amp
id|rt-&gt;rt6i_dst.addr
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_IPV6_SUBTREES
r_if
c_cond
(paren
id|src
)paren
(brace
id|RTA_PUT
c_func
(paren
id|skb
comma
id|RTA_SRC
comma
l_int|16
comma
id|src
)paren
suffix:semicolon
id|rtm-&gt;rtm_src_len
op_assign
l_int|128
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|rtm-&gt;rtm_src_len
)paren
id|RTA_PUT
c_func
(paren
id|skb
comma
id|RTA_SRC
comma
l_int|16
comma
op_amp
id|rt-&gt;rt6i_src.addr
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|iif
)paren
id|RTA_PUT
c_func
(paren
id|skb
comma
id|RTA_IIF
comma
l_int|4
comma
op_amp
id|iif
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|dst
)paren
(brace
r_struct
id|in6_addr
id|saddr_buf
suffix:semicolon
r_if
c_cond
(paren
id|ipv6_get_saddr
c_func
(paren
op_amp
id|rt-&gt;u.dst
comma
id|dst
comma
op_amp
id|saddr_buf
)paren
op_eq
l_int|0
)paren
id|RTA_PUT
c_func
(paren
id|skb
comma
id|RTA_PREFSRC
comma
l_int|16
comma
op_amp
id|saddr_buf
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|rtnetlink_put_metrics
c_func
(paren
id|skb
comma
id|rt-&gt;u.dst.metrics
)paren
OL
l_int|0
)paren
r_goto
id|rtattr_failure
suffix:semicolon
r_if
c_cond
(paren
id|rt-&gt;u.dst.neighbour
)paren
id|RTA_PUT
c_func
(paren
id|skb
comma
id|RTA_GATEWAY
comma
l_int|16
comma
op_amp
id|rt-&gt;u.dst.neighbour-&gt;primary_key
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rt-&gt;u.dst.dev
)paren
id|RTA_PUT
c_func
(paren
id|skb
comma
id|RTA_OIF
comma
r_sizeof
(paren
r_int
)paren
comma
op_amp
id|rt-&gt;rt6i_dev-&gt;ifindex
)paren
suffix:semicolon
id|RTA_PUT
c_func
(paren
id|skb
comma
id|RTA_PRIORITY
comma
l_int|4
comma
op_amp
id|rt-&gt;rt6i_metric
)paren
suffix:semicolon
id|ci.rta_lastuse
op_assign
id|jiffies
op_minus
id|rt-&gt;u.dst.lastuse
suffix:semicolon
r_if
c_cond
(paren
id|rt-&gt;rt6i_expires
)paren
id|ci.rta_expires
op_assign
id|rt-&gt;rt6i_expires
op_minus
id|jiffies
suffix:semicolon
r_else
id|ci.rta_expires
op_assign
l_int|0
suffix:semicolon
id|ci.rta_used
op_assign
id|rt-&gt;u.dst.__use
suffix:semicolon
id|ci.rta_clntref
op_assign
id|atomic_read
c_func
(paren
op_amp
id|rt-&gt;u.dst.__refcnt
)paren
suffix:semicolon
id|ci.rta_error
op_assign
id|rt-&gt;u.dst.error
suffix:semicolon
id|ci.rta_id
op_assign
l_int|0
suffix:semicolon
id|ci.rta_ts
op_assign
l_int|0
suffix:semicolon
id|ci.rta_tsage
op_assign
l_int|0
suffix:semicolon
id|RTA_PUT
c_func
(paren
id|skb
comma
id|RTA_CACHEINFO
comma
r_sizeof
(paren
id|ci
)paren
comma
op_amp
id|ci
)paren
suffix:semicolon
id|nlh-&gt;nlmsg_len
op_assign
id|skb-&gt;tail
op_minus
id|b
suffix:semicolon
r_return
id|skb-&gt;len
suffix:semicolon
id|nlmsg_failure
suffix:colon
id|rtattr_failure
suffix:colon
id|skb_trim
c_func
(paren
id|skb
comma
id|b
op_minus
id|skb-&gt;data
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
DECL|function|rt6_dump_route
r_static
r_int
id|rt6_dump_route
c_func
(paren
r_struct
id|rt6_info
op_star
id|rt
comma
r_void
op_star
id|p_arg
)paren
(brace
r_struct
id|rt6_rtnl_dump_arg
op_star
id|arg
op_assign
(paren
r_struct
id|rt6_rtnl_dump_arg
op_star
)paren
id|p_arg
suffix:semicolon
r_return
id|rt6_fill_node
c_func
(paren
id|arg-&gt;skb
comma
id|rt
comma
l_int|NULL
comma
l_int|NULL
comma
l_int|0
comma
id|RTM_NEWROUTE
comma
id|NETLINK_CB
c_func
(paren
id|arg-&gt;cb-&gt;skb
)paren
dot
id|pid
comma
id|arg-&gt;cb-&gt;nlh-&gt;nlmsg_seq
comma
l_int|NULL
)paren
suffix:semicolon
)brace
DECL|function|fib6_dump_node
r_static
r_int
id|fib6_dump_node
c_func
(paren
r_struct
id|fib6_walker_t
op_star
id|w
)paren
(brace
r_int
id|res
suffix:semicolon
r_struct
id|rt6_info
op_star
id|rt
suffix:semicolon
r_for
c_loop
(paren
id|rt
op_assign
id|w-&gt;leaf
suffix:semicolon
id|rt
suffix:semicolon
id|rt
op_assign
id|rt-&gt;u.next
)paren
(brace
id|res
op_assign
id|rt6_dump_route
c_func
(paren
id|rt
comma
id|w-&gt;args
)paren
suffix:semicolon
r_if
c_cond
(paren
id|res
OL
l_int|0
)paren
(brace
multiline_comment|/* Frame is full, suspend walking */
id|w-&gt;leaf
op_assign
id|rt
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|BUG_TRAP
c_func
(paren
id|res
op_ne
l_int|0
)paren
suffix:semicolon
)brace
id|w-&gt;leaf
op_assign
l_int|NULL
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|fib6_dump_end
r_static
r_void
id|fib6_dump_end
c_func
(paren
r_struct
id|netlink_callback
op_star
id|cb
)paren
(brace
r_struct
id|fib6_walker_t
op_star
id|w
op_assign
(paren
r_void
op_star
)paren
id|cb-&gt;args
(braket
l_int|0
)braket
suffix:semicolon
r_if
c_cond
(paren
id|w
)paren
(brace
id|cb-&gt;args
(braket
l_int|0
)braket
op_assign
l_int|0
suffix:semicolon
id|fib6_walker_unlink
c_func
(paren
id|w
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|w
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cb-&gt;args
(braket
l_int|1
)braket
)paren
(brace
id|cb-&gt;done
op_assign
(paren
r_void
op_star
)paren
id|cb-&gt;args
(braket
l_int|1
)braket
suffix:semicolon
id|cb-&gt;args
(braket
l_int|1
)braket
op_assign
l_int|0
suffix:semicolon
)brace
)brace
DECL|function|fib6_dump_done
r_static
r_int
id|fib6_dump_done
c_func
(paren
r_struct
id|netlink_callback
op_star
id|cb
)paren
(brace
id|fib6_dump_end
c_func
(paren
id|cb
)paren
suffix:semicolon
r_return
id|cb
op_member_access_from_pointer
id|done
c_func
(paren
id|cb
)paren
suffix:semicolon
)brace
DECL|function|inet6_dump_fib
r_int
id|inet6_dump_fib
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|netlink_callback
op_star
id|cb
)paren
(brace
r_struct
id|rt6_rtnl_dump_arg
id|arg
suffix:semicolon
r_struct
id|fib6_walker_t
op_star
id|w
suffix:semicolon
r_int
id|res
suffix:semicolon
id|arg.skb
op_assign
id|skb
suffix:semicolon
id|arg.cb
op_assign
id|cb
suffix:semicolon
id|w
op_assign
(paren
r_void
op_star
)paren
id|cb-&gt;args
(braket
l_int|0
)braket
suffix:semicolon
r_if
c_cond
(paren
id|w
op_eq
l_int|NULL
)paren
(brace
multiline_comment|/* New dump:&n;&t;&t; * &n;&t;&t; * 1. hook callback destructor.&n;&t;&t; */
id|cb-&gt;args
(braket
l_int|1
)braket
op_assign
(paren
r_int
)paren
id|cb-&gt;done
suffix:semicolon
id|cb-&gt;done
op_assign
id|fib6_dump_done
suffix:semicolon
multiline_comment|/*&n;&t;&t; * 2. allocate and initialize walker.&n;&t;&t; */
id|w
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|w
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|w
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|RT6_TRACE
c_func
(paren
l_string|&quot;dump&lt;%p&quot;
comma
id|w
)paren
suffix:semicolon
id|memset
c_func
(paren
id|w
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|w
)paren
)paren
suffix:semicolon
id|w-&gt;root
op_assign
op_amp
id|ip6_routing_table
suffix:semicolon
id|w-&gt;func
op_assign
id|fib6_dump_node
suffix:semicolon
id|w-&gt;args
op_assign
op_amp
id|arg
suffix:semicolon
id|cb-&gt;args
(braket
l_int|0
)braket
op_assign
(paren
r_int
)paren
id|w
suffix:semicolon
id|read_lock_bh
c_func
(paren
op_amp
id|rt6_lock
)paren
suffix:semicolon
id|res
op_assign
id|fib6_walk
c_func
(paren
id|w
)paren
suffix:semicolon
id|read_unlock_bh
c_func
(paren
op_amp
id|rt6_lock
)paren
suffix:semicolon
)brace
r_else
(brace
id|w-&gt;args
op_assign
op_amp
id|arg
suffix:semicolon
id|read_lock_bh
c_func
(paren
op_amp
id|rt6_lock
)paren
suffix:semicolon
id|res
op_assign
id|fib6_walk_continue
c_func
(paren
id|w
)paren
suffix:semicolon
id|read_unlock_bh
c_func
(paren
op_amp
id|rt6_lock
)paren
suffix:semicolon
)brace
macro_line|#if RT6_DEBUG &gt;= 3
r_if
c_cond
(paren
id|res
op_le
l_int|0
op_logical_and
id|skb-&gt;len
op_eq
l_int|0
)paren
id|RT6_TRACE
c_func
(paren
l_string|&quot;%p&gt;dump end&bslash;n&quot;
comma
id|w
)paren
suffix:semicolon
macro_line|#endif
id|res
op_assign
id|res
OL
l_int|0
ques
c_cond
id|res
suffix:colon
id|skb-&gt;len
suffix:semicolon
multiline_comment|/* res &lt; 0 is an error. (really, impossible)&n;&t;   res == 0 means that dump is complete, but skb still can contain data.&n;&t;   res &gt; 0 dump is not complete, but frame is full.&n;&t; */
multiline_comment|/* Destroy walker, if dump of this table is complete. */
r_if
c_cond
(paren
id|res
op_le
l_int|0
)paren
id|fib6_dump_end
c_func
(paren
id|cb
)paren
suffix:semicolon
r_return
id|res
suffix:semicolon
)brace
DECL|function|inet6_rtm_getroute
r_int
id|inet6_rtm_getroute
c_func
(paren
r_struct
id|sk_buff
op_star
id|in_skb
comma
r_struct
id|nlmsghdr
op_star
id|nlh
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|rtattr
op_star
op_star
id|rta
op_assign
id|arg
suffix:semicolon
r_int
id|iif
op_assign
l_int|0
suffix:semicolon
r_int
id|err
op_assign
op_minus
id|ENOBUFS
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_struct
id|flowi
id|fl
suffix:semicolon
r_struct
id|rt6_info
op_star
id|rt
suffix:semicolon
id|skb
op_assign
id|alloc_skb
c_func
(paren
id|NLMSG_GOODSIZE
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_eq
l_int|NULL
)paren
r_goto
id|out
suffix:semicolon
multiline_comment|/* Reserve room for dummy headers, this skb can pass&n;&t;   through good chunk of routing engine.&n;&t; */
id|skb-&gt;mac.raw
op_assign
id|skb-&gt;data
suffix:semicolon
id|skb_reserve
c_func
(paren
id|skb
comma
id|MAX_HEADER
op_plus
r_sizeof
(paren
r_struct
id|ipv6hdr
)paren
)paren
suffix:semicolon
id|fl.proto
op_assign
l_int|0
suffix:semicolon
id|fl.nl_u.ip6_u.daddr
op_assign
l_int|NULL
suffix:semicolon
id|fl.nl_u.ip6_u.saddr
op_assign
l_int|NULL
suffix:semicolon
id|fl.uli_u.icmpt.type
op_assign
l_int|0
suffix:semicolon
id|fl.uli_u.icmpt.code
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|rta
(braket
id|RTA_SRC
op_minus
l_int|1
)braket
)paren
id|fl.nl_u.ip6_u.saddr
op_assign
(paren
r_struct
id|in6_addr
op_star
)paren
id|RTA_DATA
c_func
(paren
id|rta
(braket
id|RTA_SRC
op_minus
l_int|1
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rta
(braket
id|RTA_DST
op_minus
l_int|1
)braket
)paren
id|fl.nl_u.ip6_u.daddr
op_assign
(paren
r_struct
id|in6_addr
op_star
)paren
id|RTA_DATA
c_func
(paren
id|rta
(braket
id|RTA_DST
op_minus
l_int|1
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rta
(braket
id|RTA_IIF
op_minus
l_int|1
)braket
)paren
id|memcpy
c_func
(paren
op_amp
id|iif
comma
id|RTA_DATA
c_func
(paren
id|rta
(braket
id|RTA_IIF
op_minus
l_int|1
)braket
)paren
comma
r_sizeof
(paren
r_int
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|iif
)paren
(brace
r_struct
id|net_device
op_star
id|dev
suffix:semicolon
id|dev
op_assign
id|__dev_get_by_index
c_func
(paren
id|iif
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev
)paren
(brace
id|err
op_assign
op_minus
id|ENODEV
suffix:semicolon
r_goto
id|out_free
suffix:semicolon
)brace
)brace
id|fl.oif
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|rta
(braket
id|RTA_OIF
op_minus
l_int|1
)braket
)paren
id|memcpy
c_func
(paren
op_amp
id|fl.oif
comma
id|RTA_DATA
c_func
(paren
id|rta
(braket
id|RTA_OIF
op_minus
l_int|1
)braket
)paren
comma
r_sizeof
(paren
r_int
)paren
)paren
suffix:semicolon
id|rt
op_assign
(paren
r_struct
id|rt6_info
op_star
)paren
id|ip6_route_output
c_func
(paren
l_int|NULL
comma
op_amp
id|fl
)paren
suffix:semicolon
id|skb-&gt;dst
op_assign
op_amp
id|rt-&gt;u.dst
suffix:semicolon
id|NETLINK_CB
c_func
(paren
id|skb
)paren
dot
id|dst_pid
op_assign
id|NETLINK_CB
c_func
(paren
id|in_skb
)paren
dot
id|pid
suffix:semicolon
id|err
op_assign
id|rt6_fill_node
c_func
(paren
id|skb
comma
id|rt
comma
id|fl.nl_u.ip6_u.daddr
comma
id|fl.nl_u.ip6_u.saddr
comma
id|iif
comma
id|RTM_NEWROUTE
comma
id|NETLINK_CB
c_func
(paren
id|in_skb
)paren
dot
id|pid
comma
id|nlh-&gt;nlmsg_seq
comma
id|nlh
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
(brace
id|err
op_assign
op_minus
id|EMSGSIZE
suffix:semicolon
r_goto
id|out_free
suffix:semicolon
)brace
id|err
op_assign
id|netlink_unicast
c_func
(paren
id|rtnl
comma
id|skb
comma
id|NETLINK_CB
c_func
(paren
id|in_skb
)paren
dot
id|pid
comma
id|MSG_DONTWAIT
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OG
l_int|0
)paren
id|err
op_assign
l_int|0
suffix:semicolon
id|out
suffix:colon
r_return
id|err
suffix:semicolon
id|out_free
suffix:colon
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
DECL|function|inet6_rt_notify
r_void
id|inet6_rt_notify
c_func
(paren
r_int
id|event
comma
r_struct
id|rt6_info
op_star
id|rt
comma
r_struct
id|nlmsghdr
op_star
id|nlh
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_int
id|size
op_assign
id|NLMSG_SPACE
c_func
(paren
r_sizeof
(paren
r_struct
id|rtmsg
)paren
op_plus
l_int|256
)paren
suffix:semicolon
id|skb
op_assign
id|alloc_skb
c_func
(paren
id|size
comma
id|gfp_any
c_func
(paren
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
(brace
id|netlink_set_err
c_func
(paren
id|rtnl
comma
l_int|0
comma
id|RTMGRP_IPV6_ROUTE
comma
id|ENOBUFS
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|rt6_fill_node
c_func
(paren
id|skb
comma
id|rt
comma
l_int|NULL
comma
l_int|NULL
comma
l_int|0
comma
id|event
comma
l_int|0
comma
l_int|0
comma
id|nlh
)paren
OL
l_int|0
)paren
(brace
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
id|netlink_set_err
c_func
(paren
id|rtnl
comma
l_int|0
comma
id|RTMGRP_IPV6_ROUTE
comma
id|EINVAL
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|NETLINK_CB
c_func
(paren
id|skb
)paren
dot
id|dst_groups
op_assign
id|RTMGRP_IPV6_ROUTE
suffix:semicolon
id|netlink_broadcast
c_func
(paren
id|rtnl
comma
id|skb
comma
l_int|0
comma
id|RTMGRP_IPV6_ROUTE
comma
id|gfp_any
c_func
(paren
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;/proc&n; */
macro_line|#ifdef CONFIG_PROC_FS
DECL|macro|RT6_INFO_LEN
mdefine_line|#define RT6_INFO_LEN (32 + 4 + 32 + 4 + 32 + 40 + 5 + 1)
DECL|struct|rt6_proc_arg
r_struct
id|rt6_proc_arg
(brace
DECL|member|buffer
r_char
op_star
id|buffer
suffix:semicolon
DECL|member|offset
r_int
id|offset
suffix:semicolon
DECL|member|length
r_int
id|length
suffix:semicolon
DECL|member|skip
r_int
id|skip
suffix:semicolon
DECL|member|len
r_int
id|len
suffix:semicolon
)brace
suffix:semicolon
DECL|function|rt6_info_route
r_static
r_int
id|rt6_info_route
c_func
(paren
r_struct
id|rt6_info
op_star
id|rt
comma
r_void
op_star
id|p_arg
)paren
(brace
r_struct
id|rt6_proc_arg
op_star
id|arg
op_assign
(paren
r_struct
id|rt6_proc_arg
op_star
)paren
id|p_arg
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|arg-&gt;skip
OL
id|arg-&gt;offset
op_div
id|RT6_INFO_LEN
)paren
(brace
id|arg-&gt;skip
op_increment
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|arg-&gt;len
op_ge
id|arg-&gt;length
)paren
r_return
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|16
suffix:semicolon
id|i
op_increment
)paren
(brace
id|sprintf
c_func
(paren
id|arg-&gt;buffer
op_plus
id|arg-&gt;len
comma
l_string|&quot;%02x&quot;
comma
id|rt-&gt;rt6i_dst.addr.s6_addr
(braket
id|i
)braket
)paren
suffix:semicolon
id|arg-&gt;len
op_add_assign
l_int|2
suffix:semicolon
)brace
id|arg-&gt;len
op_add_assign
id|sprintf
c_func
(paren
id|arg-&gt;buffer
op_plus
id|arg-&gt;len
comma
l_string|&quot; %02x &quot;
comma
id|rt-&gt;rt6i_dst.plen
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_IPV6_SUBTREES
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|16
suffix:semicolon
id|i
op_increment
)paren
(brace
id|sprintf
c_func
(paren
id|arg-&gt;buffer
op_plus
id|arg-&gt;len
comma
l_string|&quot;%02x&quot;
comma
id|rt-&gt;rt6i_src.addr.s6_addr
(braket
id|i
)braket
)paren
suffix:semicolon
id|arg-&gt;len
op_add_assign
l_int|2
suffix:semicolon
)brace
id|arg-&gt;len
op_add_assign
id|sprintf
c_func
(paren
id|arg-&gt;buffer
op_plus
id|arg-&gt;len
comma
l_string|&quot; %02x &quot;
comma
id|rt-&gt;rt6i_src.plen
)paren
suffix:semicolon
macro_line|#else
id|sprintf
c_func
(paren
id|arg-&gt;buffer
op_plus
id|arg-&gt;len
comma
l_string|&quot;00000000000000000000000000000000 00 &quot;
)paren
suffix:semicolon
id|arg-&gt;len
op_add_assign
l_int|36
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|rt-&gt;rt6i_nexthop
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|16
suffix:semicolon
id|i
op_increment
)paren
(brace
id|sprintf
c_func
(paren
id|arg-&gt;buffer
op_plus
id|arg-&gt;len
comma
l_string|&quot;%02x&quot;
comma
id|rt-&gt;rt6i_nexthop-&gt;primary_key
(braket
id|i
)braket
)paren
suffix:semicolon
id|arg-&gt;len
op_add_assign
l_int|2
suffix:semicolon
)brace
)brace
r_else
(brace
id|sprintf
c_func
(paren
id|arg-&gt;buffer
op_plus
id|arg-&gt;len
comma
l_string|&quot;00000000000000000000000000000000&quot;
)paren
suffix:semicolon
id|arg-&gt;len
op_add_assign
l_int|32
suffix:semicolon
)brace
id|arg-&gt;len
op_add_assign
id|sprintf
c_func
(paren
id|arg-&gt;buffer
op_plus
id|arg-&gt;len
comma
l_string|&quot; %08x %08x %08x %08x %8s&bslash;n&quot;
comma
id|rt-&gt;rt6i_metric
comma
id|atomic_read
c_func
(paren
op_amp
id|rt-&gt;u.dst.__refcnt
)paren
comma
id|rt-&gt;u.dst.__use
comma
id|rt-&gt;rt6i_flags
comma
id|rt-&gt;rt6i_dev
ques
c_cond
id|rt-&gt;rt6i_dev-&gt;name
suffix:colon
l_string|&quot;&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|rt6_proc_info
r_static
r_int
id|rt6_proc_info
c_func
(paren
r_char
op_star
id|buffer
comma
r_char
op_star
op_star
id|start
comma
id|off_t
id|offset
comma
r_int
id|length
)paren
(brace
r_struct
id|rt6_proc_arg
id|arg
suffix:semicolon
id|arg.buffer
op_assign
id|buffer
suffix:semicolon
id|arg.offset
op_assign
id|offset
suffix:semicolon
id|arg.length
op_assign
id|length
suffix:semicolon
id|arg.skip
op_assign
l_int|0
suffix:semicolon
id|arg.len
op_assign
l_int|0
suffix:semicolon
id|read_lock_bh
c_func
(paren
op_amp
id|rt6_lock
)paren
suffix:semicolon
id|fib6_clean_tree
c_func
(paren
op_amp
id|ip6_routing_table
comma
id|rt6_info_route
comma
l_int|0
comma
op_amp
id|arg
)paren
suffix:semicolon
id|read_unlock_bh
c_func
(paren
op_amp
id|rt6_lock
)paren
suffix:semicolon
op_star
id|start
op_assign
id|buffer
suffix:semicolon
r_if
c_cond
(paren
id|offset
)paren
op_star
id|start
op_add_assign
id|offset
op_mod
id|RT6_INFO_LEN
suffix:semicolon
id|arg.len
op_sub_assign
id|offset
op_mod
id|RT6_INFO_LEN
suffix:semicolon
r_if
c_cond
(paren
id|arg.len
OG
id|length
)paren
id|arg.len
op_assign
id|length
suffix:semicolon
r_if
c_cond
(paren
id|arg.len
OL
l_int|0
)paren
id|arg.len
op_assign
l_int|0
suffix:semicolon
r_return
id|arg.len
suffix:semicolon
)brace
r_extern
r_struct
id|rt6_statistics
id|rt6_stats
suffix:semicolon
DECL|function|rt6_proc_stats
r_static
r_int
id|rt6_proc_stats
c_func
(paren
r_char
op_star
id|buffer
comma
r_char
op_star
op_star
id|start
comma
id|off_t
id|offset
comma
r_int
id|length
)paren
(brace
r_int
id|len
suffix:semicolon
id|len
op_assign
id|sprintf
c_func
(paren
id|buffer
comma
l_string|&quot;%04x %04x %04x %04x %04x %04x&bslash;n&quot;
comma
id|rt6_stats.fib_nodes
comma
id|rt6_stats.fib_route_nodes
comma
id|rt6_stats.fib_rt_alloc
comma
id|rt6_stats.fib_rt_entries
comma
id|rt6_stats.fib_rt_cache
comma
id|atomic_read
c_func
(paren
op_amp
id|ip6_dst_ops.entries
)paren
)paren
suffix:semicolon
id|len
op_sub_assign
id|offset
suffix:semicolon
r_if
c_cond
(paren
id|len
OG
id|length
)paren
id|len
op_assign
id|length
suffix:semicolon
r_if
c_cond
(paren
id|len
OL
l_int|0
)paren
(brace
id|len
op_assign
l_int|0
suffix:semicolon
)brace
op_star
id|start
op_assign
id|buffer
op_plus
id|offset
suffix:semicolon
r_return
id|len
suffix:semicolon
)brace
macro_line|#endif&t;/* CONFIG_PROC_FS */
macro_line|#ifdef CONFIG_SYSCTL
DECL|variable|flush_delay
r_static
r_int
id|flush_delay
suffix:semicolon
r_static
DECL|function|ipv6_sysctl_rtcache_flush
r_int
id|ipv6_sysctl_rtcache_flush
c_func
(paren
id|ctl_table
op_star
id|ctl
comma
r_int
id|write
comma
r_struct
id|file
op_star
id|filp
comma
r_void
op_star
id|buffer
comma
r_int
op_star
id|lenp
)paren
(brace
r_if
c_cond
(paren
id|write
)paren
(brace
id|proc_dointvec
c_func
(paren
id|ctl
comma
id|write
comma
id|filp
comma
id|buffer
comma
id|lenp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|flush_delay
OL
l_int|0
)paren
id|flush_delay
op_assign
l_int|0
suffix:semicolon
id|fib6_run_gc
c_func
(paren
(paren
r_int
r_int
)paren
id|flush_delay
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_else
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
DECL|variable|ipv6_route_table
id|ctl_table
id|ipv6_route_table
(braket
)braket
op_assign
(brace
(brace
dot
id|ctl_name
op_assign
id|NET_IPV6_ROUTE_FLUSH
comma
dot
id|procname
op_assign
l_string|&quot;flush&quot;
comma
dot
id|data
op_assign
op_amp
id|flush_delay
comma
dot
id|maxlen
op_assign
r_sizeof
(paren
r_int
)paren
comma
dot
id|mode
op_assign
l_int|0644
comma
dot
id|proc_handler
op_assign
op_amp
id|ipv6_sysctl_rtcache_flush
)brace
comma
(brace
dot
id|ctl_name
op_assign
id|NET_IPV6_ROUTE_GC_THRESH
comma
dot
id|procname
op_assign
l_string|&quot;gc_thresh&quot;
comma
dot
id|data
op_assign
op_amp
id|ip6_dst_ops.gc_thresh
comma
dot
id|maxlen
op_assign
r_sizeof
(paren
r_int
)paren
comma
dot
id|mode
op_assign
l_int|0644
comma
dot
id|proc_handler
op_assign
op_amp
id|proc_dointvec
comma
)brace
comma
(brace
dot
id|ctl_name
op_assign
id|NET_IPV6_ROUTE_MAX_SIZE
comma
dot
id|procname
op_assign
l_string|&quot;max_size&quot;
comma
dot
id|data
op_assign
op_amp
id|ip6_rt_max_size
comma
dot
id|maxlen
op_assign
r_sizeof
(paren
r_int
)paren
comma
dot
id|mode
op_assign
l_int|0644
comma
dot
id|proc_handler
op_assign
op_amp
id|proc_dointvec
comma
)brace
comma
(brace
dot
id|ctl_name
op_assign
id|NET_IPV6_ROUTE_GC_MIN_INTERVAL
comma
dot
id|procname
op_assign
l_string|&quot;gc_min_interval&quot;
comma
dot
id|data
op_assign
op_amp
id|ip6_rt_gc_min_interval
comma
dot
id|maxlen
op_assign
r_sizeof
(paren
r_int
)paren
comma
dot
id|mode
op_assign
l_int|0644
comma
dot
id|proc_handler
op_assign
op_amp
id|proc_dointvec_jiffies
comma
dot
id|strategy
op_assign
op_amp
id|sysctl_jiffies
comma
)brace
comma
(brace
dot
id|ctl_name
op_assign
id|NET_IPV6_ROUTE_GC_TIMEOUT
comma
dot
id|procname
op_assign
l_string|&quot;gc_timeout&quot;
comma
dot
id|data
op_assign
op_amp
id|ip6_rt_gc_timeout
comma
dot
id|maxlen
op_assign
r_sizeof
(paren
r_int
)paren
comma
dot
id|mode
op_assign
l_int|0644
comma
dot
id|proc_handler
op_assign
op_amp
id|proc_dointvec_jiffies
comma
dot
id|strategy
op_assign
op_amp
id|sysctl_jiffies
comma
)brace
comma
(brace
dot
id|ctl_name
op_assign
id|NET_IPV6_ROUTE_GC_INTERVAL
comma
dot
id|procname
op_assign
l_string|&quot;gc_interval&quot;
comma
dot
id|data
op_assign
op_amp
id|ip6_rt_gc_interval
comma
dot
id|maxlen
op_assign
r_sizeof
(paren
r_int
)paren
comma
dot
id|mode
op_assign
l_int|0644
comma
dot
id|proc_handler
op_assign
op_amp
id|proc_dointvec_jiffies
comma
dot
id|strategy
op_assign
op_amp
id|sysctl_jiffies
comma
)brace
comma
(brace
dot
id|ctl_name
op_assign
id|NET_IPV6_ROUTE_GC_ELASTICITY
comma
dot
id|procname
op_assign
l_string|&quot;gc_elasticity&quot;
comma
dot
id|data
op_assign
op_amp
id|ip6_rt_gc_elasticity
comma
dot
id|maxlen
op_assign
r_sizeof
(paren
r_int
)paren
comma
dot
id|mode
op_assign
l_int|0644
comma
dot
id|proc_handler
op_assign
op_amp
id|proc_dointvec_jiffies
comma
dot
id|strategy
op_assign
op_amp
id|sysctl_jiffies
comma
)brace
comma
(brace
dot
id|ctl_name
op_assign
id|NET_IPV6_ROUTE_MTU_EXPIRES
comma
dot
id|procname
op_assign
l_string|&quot;mtu_expires&quot;
comma
dot
id|data
op_assign
op_amp
id|ip6_rt_mtu_expires
comma
dot
id|maxlen
op_assign
r_sizeof
(paren
r_int
)paren
comma
dot
id|mode
op_assign
l_int|0644
comma
dot
id|proc_handler
op_assign
op_amp
id|proc_dointvec_jiffies
comma
dot
id|strategy
op_assign
op_amp
id|sysctl_jiffies
comma
)brace
comma
(brace
dot
id|ctl_name
op_assign
id|NET_IPV6_ROUTE_MIN_ADVMSS
comma
dot
id|procname
op_assign
l_string|&quot;min_adv_mss&quot;
comma
dot
id|data
op_assign
op_amp
id|ip6_rt_min_advmss
comma
dot
id|maxlen
op_assign
r_sizeof
(paren
r_int
)paren
comma
dot
id|mode
op_assign
l_int|0644
comma
dot
id|proc_handler
op_assign
op_amp
id|proc_dointvec_jiffies
comma
dot
id|strategy
op_assign
op_amp
id|sysctl_jiffies
comma
)brace
comma
)brace
suffix:semicolon
macro_line|#endif
DECL|function|ip6_route_init
r_void
id|__init
id|ip6_route_init
c_func
(paren
r_void
)paren
(brace
id|ip6_dst_ops.kmem_cachep
op_assign
id|kmem_cache_create
c_func
(paren
l_string|&quot;ip6_dst_cache&quot;
comma
r_sizeof
(paren
r_struct
id|rt6_info
)paren
comma
l_int|0
comma
id|SLAB_HWCACHE_ALIGN
comma
l_int|NULL
comma
l_int|NULL
)paren
suffix:semicolon
id|fib6_init
c_func
(paren
)paren
suffix:semicolon
macro_line|#ifdef &t;CONFIG_PROC_FS
id|proc_net_create
c_func
(paren
l_string|&quot;ipv6_route&quot;
comma
l_int|0
comma
id|rt6_proc_info
)paren
suffix:semicolon
id|proc_net_create
c_func
(paren
l_string|&quot;rt6_stats&quot;
comma
l_int|0
comma
id|rt6_proc_stats
)paren
suffix:semicolon
macro_line|#endif
id|xfrm6_init
c_func
(paren
)paren
suffix:semicolon
)brace
macro_line|#ifdef MODULE
DECL|function|ip6_route_cleanup
r_void
id|ip6_route_cleanup
c_func
(paren
r_void
)paren
(brace
macro_line|#ifdef CONFIG_PROC_FS
id|proc_net_remove
c_func
(paren
l_string|&quot;ipv6_route&quot;
)paren
suffix:semicolon
id|proc_net_remove
c_func
(paren
l_string|&quot;rt6_stats&quot;
)paren
suffix:semicolon
macro_line|#endif
id|xfrm6_fini
c_func
(paren
)paren
suffix:semicolon
id|rt6_ifdown
c_func
(paren
l_int|NULL
)paren
suffix:semicolon
id|fib6_gc_cleanup
c_func
(paren
)paren
suffix:semicolon
)brace
macro_line|#endif&t;/* MODULE */
eof
