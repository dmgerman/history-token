multiline_comment|/*&n; *&t;Neighbour Discovery for IPv6&n; *&t;Linux INET6 implementation &n; *&n; *&t;Authors:&n; *&t;Pedro Roque&t;&t;&lt;roque@di.fc.ul.pt&gt;&t;&n; *&t;Mike Shaver&t;&t;&lt;shaver@ingenia.com&gt;&n; *&n; *&t;This program is free software; you can redistribute it and/or&n; *      modify it under the terms of the GNU General Public License&n; *      as published by the Free Software Foundation; either version&n; *      2 of the License, or (at your option) any later version.&n; */
multiline_comment|/*&n; *&t;Changes:&n; *&n; *&t;Lars Fenneberg&t;&t;&t;:&t;fixed MTU setting on receipt&n; *&t;&t;&t;&t;&t;&t;of an RA.&n; *&n; *&t;Janos Farkas&t;&t;&t;:&t;kmalloc failure checks&n; *&t;Alexey Kuznetsov&t;&t;:&t;state machine reworked&n; *&t;&t;&t;&t;&t;&t;and moved to net/core.&n; *&t;Pekka Savola&t;&t;&t;:&t;RFC2461 validation&n; *&t;YOSHIFUJI Hideaki @USAGI&t;:&t;Verify ND options properly&n; */
multiline_comment|/* Set to 3 to get tracing... */
DECL|macro|ND_DEBUG
mdefine_line|#define ND_DEBUG 1
DECL|macro|ND_PRINTK
mdefine_line|#define ND_PRINTK(fmt, args...) do { if (net_ratelimit()) { printk(fmt, ## args); } } while(0)
DECL|macro|ND_NOPRINTK
mdefine_line|#define ND_NOPRINTK(x...) do { ; } while(0)
DECL|macro|ND_PRINTK0
mdefine_line|#define ND_PRINTK0 ND_PRINTK
DECL|macro|ND_PRINTK1
mdefine_line|#define ND_PRINTK1 ND_NOPRINTK
DECL|macro|ND_PRINTK2
mdefine_line|#define ND_PRINTK2 ND_NOPRINTK
DECL|macro|ND_PRINTK3
mdefine_line|#define ND_PRINTK3 ND_NOPRINTK
macro_line|#if ND_DEBUG &gt;= 1
DECL|macro|ND_PRINTK1
macro_line|#undef ND_PRINTK1
DECL|macro|ND_PRINTK1
mdefine_line|#define ND_PRINTK1 ND_PRINTK
macro_line|#endif
macro_line|#if ND_DEBUG &gt;= 2
DECL|macro|ND_PRINTK2
macro_line|#undef ND_PRINTK2
DECL|macro|ND_PRINTK2
mdefine_line|#define ND_PRINTK2 ND_PRINTK
macro_line|#endif
macro_line|#if ND_DEBUG &gt;= 3
DECL|macro|ND_PRINTK3
macro_line|#undef ND_PRINTK3
DECL|macro|ND_PRINTK3
mdefine_line|#define ND_PRINTK3 ND_PRINTK
macro_line|#endif
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/socket.h&gt;
macro_line|#include &lt;linux/sockios.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/net.h&gt;
macro_line|#include &lt;linux/in6.h&gt;
macro_line|#include &lt;linux/route.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/rcupdate.h&gt;
macro_line|#ifdef CONFIG_SYSCTL
macro_line|#include &lt;linux/sysctl.h&gt;
macro_line|#endif
macro_line|#include &lt;linux/if_arp.h&gt;
macro_line|#include &lt;linux/ipv6.h&gt;
macro_line|#include &lt;linux/icmpv6.h&gt;
macro_line|#include &lt;linux/jhash.h&gt;
macro_line|#include &lt;net/sock.h&gt;
macro_line|#include &lt;net/snmp.h&gt;
macro_line|#include &lt;net/ipv6.h&gt;
macro_line|#include &lt;net/protocol.h&gt;
macro_line|#include &lt;net/ndisc.h&gt;
macro_line|#include &lt;net/ip6_route.h&gt;
macro_line|#include &lt;net/addrconf.h&gt;
macro_line|#include &lt;net/icmp.h&gt;
macro_line|#include &lt;net/flow.h&gt;
macro_line|#include &lt;net/ip6_checksum.h&gt;
macro_line|#include &lt;linux/proc_fs.h&gt;
macro_line|#include &lt;linux/netfilter.h&gt;
macro_line|#include &lt;linux/netfilter_ipv6.h&gt;
DECL|variable|ndisc_socket
r_static
r_struct
id|socket
op_star
id|ndisc_socket
suffix:semicolon
r_static
id|u32
id|ndisc_hash
c_func
(paren
r_const
r_void
op_star
id|pkey
comma
r_const
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|ndisc_constructor
c_func
(paren
r_struct
id|neighbour
op_star
id|neigh
)paren
suffix:semicolon
r_static
r_void
id|ndisc_solicit
c_func
(paren
r_struct
id|neighbour
op_star
id|neigh
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
suffix:semicolon
r_static
r_void
id|ndisc_error_report
c_func
(paren
r_struct
id|neighbour
op_star
id|neigh
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
suffix:semicolon
r_static
r_int
id|pndisc_constructor
c_func
(paren
r_struct
id|pneigh_entry
op_star
id|n
)paren
suffix:semicolon
r_static
r_void
id|pndisc_destructor
c_func
(paren
r_struct
id|pneigh_entry
op_star
id|n
)paren
suffix:semicolon
r_static
r_void
id|pndisc_redo
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
)paren
suffix:semicolon
DECL|variable|ndisc_generic_ops
r_static
r_struct
id|neigh_ops
id|ndisc_generic_ops
op_assign
(brace
dot
id|family
op_assign
id|AF_INET6
comma
dot
id|solicit
op_assign
id|ndisc_solicit
comma
dot
id|error_report
op_assign
id|ndisc_error_report
comma
dot
id|output
op_assign
id|neigh_resolve_output
comma
dot
id|connected_output
op_assign
id|neigh_connected_output
comma
dot
id|hh_output
op_assign
id|dev_queue_xmit
comma
dot
id|queue_xmit
op_assign
id|dev_queue_xmit
comma
)brace
suffix:semicolon
DECL|variable|ndisc_hh_ops
r_static
r_struct
id|neigh_ops
id|ndisc_hh_ops
op_assign
(brace
dot
id|family
op_assign
id|AF_INET6
comma
dot
id|solicit
op_assign
id|ndisc_solicit
comma
dot
id|error_report
op_assign
id|ndisc_error_report
comma
dot
id|output
op_assign
id|neigh_resolve_output
comma
dot
id|connected_output
op_assign
id|neigh_resolve_output
comma
dot
id|hh_output
op_assign
id|dev_queue_xmit
comma
dot
id|queue_xmit
op_assign
id|dev_queue_xmit
comma
)brace
suffix:semicolon
DECL|variable|ndisc_direct_ops
r_static
r_struct
id|neigh_ops
id|ndisc_direct_ops
op_assign
(brace
dot
id|family
op_assign
id|AF_INET6
comma
dot
id|output
op_assign
id|dev_queue_xmit
comma
dot
id|connected_output
op_assign
id|dev_queue_xmit
comma
dot
id|hh_output
op_assign
id|dev_queue_xmit
comma
dot
id|queue_xmit
op_assign
id|dev_queue_xmit
comma
)brace
suffix:semicolon
DECL|variable|nd_tbl
r_struct
id|neigh_table
id|nd_tbl
op_assign
(brace
dot
id|family
op_assign
id|AF_INET6
comma
dot
id|entry_size
op_assign
r_sizeof
(paren
r_struct
id|neighbour
)paren
op_plus
r_sizeof
(paren
r_struct
id|in6_addr
)paren
comma
dot
id|key_len
op_assign
r_sizeof
(paren
r_struct
id|in6_addr
)paren
comma
dot
id|hash
op_assign
id|ndisc_hash
comma
dot
id|constructor
op_assign
id|ndisc_constructor
comma
dot
id|pconstructor
op_assign
id|pndisc_constructor
comma
dot
id|pdestructor
op_assign
id|pndisc_destructor
comma
dot
id|proxy_redo
op_assign
id|pndisc_redo
comma
dot
id|id
op_assign
l_string|&quot;ndisc_cache&quot;
comma
dot
id|parms
op_assign
(brace
dot
id|tbl
op_assign
op_amp
id|nd_tbl
comma
dot
id|base_reachable_time
op_assign
l_int|30
op_star
id|HZ
comma
dot
id|retrans_time
op_assign
l_int|1
op_star
id|HZ
comma
dot
id|gc_staletime
op_assign
l_int|60
op_star
id|HZ
comma
dot
id|reachable_time
op_assign
l_int|30
op_star
id|HZ
comma
dot
id|delay_probe_time
op_assign
l_int|5
op_star
id|HZ
comma
dot
id|queue_len
op_assign
l_int|3
comma
dot
id|ucast_probes
op_assign
l_int|3
comma
dot
id|mcast_probes
op_assign
l_int|3
comma
dot
id|anycast_delay
op_assign
l_int|1
op_star
id|HZ
comma
dot
id|proxy_delay
op_assign
(paren
l_int|8
op_star
id|HZ
)paren
op_div
l_int|10
comma
dot
id|proxy_qlen
op_assign
l_int|64
comma
)brace
comma
dot
id|gc_interval
op_assign
l_int|30
op_star
id|HZ
comma
dot
id|gc_thresh1
op_assign
l_int|128
comma
dot
id|gc_thresh2
op_assign
l_int|512
comma
dot
id|gc_thresh3
op_assign
l_int|1024
comma
)brace
suffix:semicolon
multiline_comment|/* ND options */
DECL|struct|ndisc_options
r_struct
id|ndisc_options
(brace
DECL|member|nd_opt_array
r_struct
id|nd_opt_hdr
op_star
id|nd_opt_array
(braket
l_int|7
)braket
suffix:semicolon
DECL|member|nd_opt_piend
r_struct
id|nd_opt_hdr
op_star
id|nd_opt_piend
suffix:semicolon
)brace
suffix:semicolon
DECL|macro|nd_opts_src_lladdr
mdefine_line|#define nd_opts_src_lladdr&t;nd_opt_array[ND_OPT_SOURCE_LL_ADDR]
DECL|macro|nd_opts_tgt_lladdr
mdefine_line|#define nd_opts_tgt_lladdr&t;nd_opt_array[ND_OPT_TARGET_LL_ADDR]
DECL|macro|nd_opts_pi
mdefine_line|#define nd_opts_pi&t;&t;nd_opt_array[ND_OPT_PREFIX_INFO]
DECL|macro|nd_opts_pi_end
mdefine_line|#define nd_opts_pi_end&t;&t;nd_opt_piend
DECL|macro|nd_opts_rh
mdefine_line|#define nd_opts_rh&t;&t;nd_opt_array[ND_OPT_REDIRECT_HDR]
DECL|macro|nd_opts_mtu
mdefine_line|#define nd_opts_mtu&t;&t;nd_opt_array[ND_OPT_MTU]
DECL|macro|NDISC_OPT_SPACE
mdefine_line|#define NDISC_OPT_SPACE(len) (((len)+2+7)&amp;~7)
DECL|function|ndisc_fill_option
r_static
id|u8
op_star
id|ndisc_fill_option
c_func
(paren
id|u8
op_star
id|opt
comma
r_int
id|type
comma
r_void
op_star
id|data
comma
r_int
id|data_len
)paren
(brace
r_int
id|space
op_assign
id|NDISC_OPT_SPACE
c_func
(paren
id|data_len
)paren
suffix:semicolon
id|opt
(braket
l_int|0
)braket
op_assign
id|type
suffix:semicolon
id|opt
(braket
l_int|1
)braket
op_assign
id|space
op_rshift
l_int|3
suffix:semicolon
id|memcpy
c_func
(paren
id|opt
op_plus
l_int|2
comma
id|data
comma
id|data_len
)paren
suffix:semicolon
id|data_len
op_add_assign
l_int|2
suffix:semicolon
id|opt
op_add_assign
id|data_len
suffix:semicolon
r_if
c_cond
(paren
(paren
id|space
op_sub_assign
id|data_len
)paren
OG
l_int|0
)paren
id|memset
c_func
(paren
id|opt
comma
l_int|0
comma
id|space
)paren
suffix:semicolon
r_return
id|opt
op_plus
id|space
suffix:semicolon
)brace
DECL|function|ndisc_next_option
r_static
r_struct
id|nd_opt_hdr
op_star
id|ndisc_next_option
c_func
(paren
r_struct
id|nd_opt_hdr
op_star
id|cur
comma
r_struct
id|nd_opt_hdr
op_star
id|end
)paren
(brace
r_int
id|type
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cur
op_logical_or
op_logical_neg
id|end
op_logical_or
id|cur
op_ge
id|end
)paren
r_return
l_int|NULL
suffix:semicolon
id|type
op_assign
id|cur-&gt;nd_opt_type
suffix:semicolon
r_do
(brace
id|cur
op_assign
(paren
(paren
r_void
op_star
)paren
id|cur
)paren
op_plus
(paren
id|cur-&gt;nd_opt_len
op_lshift
l_int|3
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
id|cur
OL
id|end
op_logical_and
id|cur-&gt;nd_opt_type
op_ne
id|type
)paren
(brace
suffix:semicolon
)brace
r_return
(paren
id|cur
op_le
id|end
op_logical_and
id|cur-&gt;nd_opt_type
op_eq
id|type
ques
c_cond
id|cur
suffix:colon
l_int|NULL
)paren
suffix:semicolon
)brace
DECL|function|ndisc_parse_options
r_static
r_struct
id|ndisc_options
op_star
id|ndisc_parse_options
c_func
(paren
id|u8
op_star
id|opt
comma
r_int
id|opt_len
comma
r_struct
id|ndisc_options
op_star
id|ndopts
)paren
(brace
r_struct
id|nd_opt_hdr
op_star
id|nd_opt
op_assign
(paren
r_struct
id|nd_opt_hdr
op_star
)paren
id|opt
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|nd_opt
op_logical_or
id|opt_len
OL
l_int|0
op_logical_or
op_logical_neg
id|ndopts
)paren
r_return
l_int|NULL
suffix:semicolon
id|memset
c_func
(paren
id|ndopts
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|ndopts
)paren
)paren
suffix:semicolon
r_while
c_loop
(paren
id|opt_len
)paren
(brace
r_int
id|l
suffix:semicolon
r_if
c_cond
(paren
id|opt_len
OL
r_sizeof
(paren
r_struct
id|nd_opt_hdr
)paren
)paren
r_return
l_int|NULL
suffix:semicolon
id|l
op_assign
id|nd_opt-&gt;nd_opt_len
op_lshift
l_int|3
suffix:semicolon
r_if
c_cond
(paren
id|opt_len
OL
id|l
op_logical_or
id|l
op_eq
l_int|0
)paren
r_return
l_int|NULL
suffix:semicolon
r_switch
c_cond
(paren
id|nd_opt-&gt;nd_opt_type
)paren
(brace
r_case
id|ND_OPT_SOURCE_LL_ADDR
suffix:colon
r_case
id|ND_OPT_TARGET_LL_ADDR
suffix:colon
r_case
id|ND_OPT_MTU
suffix:colon
r_case
id|ND_OPT_REDIRECT_HDR
suffix:colon
r_if
c_cond
(paren
id|ndopts-&gt;nd_opt_array
(braket
id|nd_opt-&gt;nd_opt_type
)braket
)paren
(brace
id|ND_PRINTK2
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s(): duplicated ND6 option found: type=%d&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|nd_opt-&gt;nd_opt_type
)paren
suffix:semicolon
)brace
r_else
(brace
id|ndopts-&gt;nd_opt_array
(braket
id|nd_opt-&gt;nd_opt_type
)braket
op_assign
id|nd_opt
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|ND_OPT_PREFIX_INFO
suffix:colon
id|ndopts-&gt;nd_opts_pi_end
op_assign
id|nd_opt
suffix:semicolon
r_if
c_cond
(paren
id|ndopts-&gt;nd_opt_array
(braket
id|nd_opt-&gt;nd_opt_type
)braket
op_eq
l_int|0
)paren
id|ndopts-&gt;nd_opt_array
(braket
id|nd_opt-&gt;nd_opt_type
)braket
op_assign
id|nd_opt
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
multiline_comment|/*&n;&t;&t;&t; * Unknown options must be silently ignored,&n;&t;&t;&t; * to accommodate future extension to the protocol.&n;&t;&t;&t; */
id|ND_PRINTK2
c_func
(paren
id|KERN_NOTICE
l_string|&quot;%s(): ignored unsupported option; type=%d, len=%d&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|nd_opt-&gt;nd_opt_type
comma
id|nd_opt-&gt;nd_opt_len
)paren
suffix:semicolon
)brace
id|opt_len
op_sub_assign
id|l
suffix:semicolon
id|nd_opt
op_assign
(paren
(paren
r_void
op_star
)paren
id|nd_opt
)paren
op_plus
id|l
suffix:semicolon
)brace
r_return
id|ndopts
suffix:semicolon
)brace
DECL|function|ndisc_mc_map
r_int
id|ndisc_mc_map
c_func
(paren
r_struct
id|in6_addr
op_star
id|addr
comma
r_char
op_star
id|buf
comma
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|dir
)paren
(brace
r_switch
c_cond
(paren
id|dev-&gt;type
)paren
(brace
r_case
id|ARPHRD_ETHER
suffix:colon
r_case
id|ARPHRD_IEEE802
suffix:colon
multiline_comment|/* Not sure. Check it later. --ANK */
r_case
id|ARPHRD_FDDI
suffix:colon
id|ipv6_eth_mc_map
c_func
(paren
id|addr
comma
id|buf
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|ARPHRD_IEEE802_TR
suffix:colon
id|ipv6_tr_mc_map
c_func
(paren
id|addr
comma
id|buf
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|ARPHRD_ARCNET
suffix:colon
id|ipv6_arcnet_mc_map
c_func
(paren
id|addr
comma
id|buf
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|ARPHRD_INFINIBAND
suffix:colon
id|ipv6_ib_mc_map
c_func
(paren
id|addr
comma
id|buf
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_default
suffix:colon
(brace
)brace
r_if
c_cond
(paren
id|dir
)paren
(brace
id|memcpy
c_func
(paren
id|buf
comma
id|dev-&gt;broadcast
comma
id|dev-&gt;addr_len
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
DECL|function|ndisc_hash
r_static
id|u32
id|ndisc_hash
c_func
(paren
r_const
r_void
op_star
id|pkey
comma
r_const
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_const
id|u32
op_star
id|p32
op_assign
id|pkey
suffix:semicolon
id|u32
id|addr_hash
comma
id|i
suffix:semicolon
id|addr_hash
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
(paren
r_sizeof
(paren
r_struct
id|in6_addr
)paren
op_div
r_sizeof
(paren
id|u32
)paren
)paren
suffix:semicolon
id|i
op_increment
)paren
id|addr_hash
op_xor_assign
op_star
id|p32
op_increment
suffix:semicolon
r_return
id|jhash_2words
c_func
(paren
id|addr_hash
comma
id|dev-&gt;ifindex
comma
id|nd_tbl.hash_rnd
)paren
suffix:semicolon
)brace
DECL|function|ndisc_constructor
r_static
r_int
id|ndisc_constructor
c_func
(paren
r_struct
id|neighbour
op_star
id|neigh
)paren
(brace
r_struct
id|in6_addr
op_star
id|addr
op_assign
(paren
r_struct
id|in6_addr
op_star
)paren
op_amp
id|neigh-&gt;primary_key
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
op_assign
id|neigh-&gt;dev
suffix:semicolon
r_struct
id|inet6_dev
op_star
id|in6_dev
suffix:semicolon
r_struct
id|neigh_parms
op_star
id|parms
suffix:semicolon
r_int
id|is_multicast
op_assign
id|ipv6_addr_is_multicast
c_func
(paren
id|addr
)paren
suffix:semicolon
id|rcu_read_lock
c_func
(paren
)paren
suffix:semicolon
id|in6_dev
op_assign
id|in6_dev_get
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|in6_dev
op_eq
l_int|NULL
)paren
(brace
id|rcu_read_unlock
c_func
(paren
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|parms
op_assign
id|in6_dev-&gt;nd_parms
suffix:semicolon
id|__neigh_parms_put
c_func
(paren
id|neigh-&gt;parms
)paren
suffix:semicolon
id|neigh-&gt;parms
op_assign
id|neigh_parms_clone
c_func
(paren
id|parms
)paren
suffix:semicolon
id|rcu_read_unlock
c_func
(paren
)paren
suffix:semicolon
id|neigh-&gt;type
op_assign
id|is_multicast
ques
c_cond
id|RTN_MULTICAST
suffix:colon
id|RTN_UNICAST
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;hard_header
op_eq
l_int|NULL
)paren
(brace
id|neigh-&gt;nud_state
op_assign
id|NUD_NOARP
suffix:semicolon
id|neigh-&gt;ops
op_assign
op_amp
id|ndisc_direct_ops
suffix:semicolon
id|neigh-&gt;output
op_assign
id|neigh-&gt;ops-&gt;queue_xmit
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|is_multicast
)paren
(brace
id|neigh-&gt;nud_state
op_assign
id|NUD_NOARP
suffix:semicolon
id|ndisc_mc_map
c_func
(paren
id|addr
comma
id|neigh-&gt;ha
comma
id|dev
comma
l_int|1
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|dev-&gt;flags
op_amp
(paren
id|IFF_NOARP
op_or
id|IFF_LOOPBACK
)paren
)paren
(brace
id|neigh-&gt;nud_state
op_assign
id|NUD_NOARP
suffix:semicolon
id|memcpy
c_func
(paren
id|neigh-&gt;ha
comma
id|dev-&gt;dev_addr
comma
id|dev-&gt;addr_len
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;flags
op_amp
id|IFF_LOOPBACK
)paren
id|neigh-&gt;type
op_assign
id|RTN_LOCAL
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|dev-&gt;flags
op_amp
id|IFF_POINTOPOINT
)paren
(brace
id|neigh-&gt;nud_state
op_assign
id|NUD_NOARP
suffix:semicolon
id|memcpy
c_func
(paren
id|neigh-&gt;ha
comma
id|dev-&gt;broadcast
comma
id|dev-&gt;addr_len
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dev-&gt;hard_header_cache
)paren
id|neigh-&gt;ops
op_assign
op_amp
id|ndisc_hh_ops
suffix:semicolon
r_else
id|neigh-&gt;ops
op_assign
op_amp
id|ndisc_generic_ops
suffix:semicolon
r_if
c_cond
(paren
id|neigh-&gt;nud_state
op_amp
id|NUD_VALID
)paren
id|neigh-&gt;output
op_assign
id|neigh-&gt;ops-&gt;connected_output
suffix:semicolon
r_else
id|neigh-&gt;output
op_assign
id|neigh-&gt;ops-&gt;output
suffix:semicolon
)brace
id|in6_dev_put
c_func
(paren
id|in6_dev
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|pndisc_constructor
r_static
r_int
id|pndisc_constructor
c_func
(paren
r_struct
id|pneigh_entry
op_star
id|n
)paren
(brace
r_struct
id|in6_addr
op_star
id|addr
op_assign
(paren
r_struct
id|in6_addr
op_star
)paren
op_amp
id|n-&gt;key
suffix:semicolon
r_struct
id|in6_addr
id|maddr
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
op_assign
id|n-&gt;dev
suffix:semicolon
r_if
c_cond
(paren
id|dev
op_eq
l_int|NULL
op_logical_or
id|__in6_dev_get
c_func
(paren
id|dev
)paren
op_eq
l_int|NULL
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|addrconf_addr_solict_mult
c_func
(paren
id|addr
comma
op_amp
id|maddr
)paren
suffix:semicolon
id|ipv6_dev_mc_inc
c_func
(paren
id|dev
comma
op_amp
id|maddr
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|pndisc_destructor
r_static
r_void
id|pndisc_destructor
c_func
(paren
r_struct
id|pneigh_entry
op_star
id|n
)paren
(brace
r_struct
id|in6_addr
op_star
id|addr
op_assign
(paren
r_struct
id|in6_addr
op_star
)paren
op_amp
id|n-&gt;key
suffix:semicolon
r_struct
id|in6_addr
id|maddr
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
op_assign
id|n-&gt;dev
suffix:semicolon
r_if
c_cond
(paren
id|dev
op_eq
l_int|NULL
op_logical_or
id|__in6_dev_get
c_func
(paren
id|dev
)paren
op_eq
l_int|NULL
)paren
r_return
suffix:semicolon
id|addrconf_addr_solict_mult
c_func
(paren
id|addr
comma
op_amp
id|maddr
)paren
suffix:semicolon
id|ipv6_dev_mc_dec
c_func
(paren
id|dev
comma
op_amp
id|maddr
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;Send a Neighbour Advertisement&n; */
DECL|function|ndisc_flow_init
r_static
r_inline
r_void
id|ndisc_flow_init
c_func
(paren
r_struct
id|flowi
op_star
id|fl
comma
id|u8
id|type
comma
r_struct
id|in6_addr
op_star
id|saddr
comma
r_struct
id|in6_addr
op_star
id|daddr
)paren
(brace
id|memset
c_func
(paren
id|fl
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|fl
)paren
)paren
suffix:semicolon
id|ipv6_addr_copy
c_func
(paren
op_amp
id|fl-&gt;fl6_src
comma
id|saddr
)paren
suffix:semicolon
id|ipv6_addr_copy
c_func
(paren
op_amp
id|fl-&gt;fl6_dst
comma
id|daddr
)paren
suffix:semicolon
id|fl-&gt;proto
op_assign
id|IPPROTO_ICMPV6
suffix:semicolon
id|fl-&gt;fl_icmp_type
op_assign
id|type
suffix:semicolon
id|fl-&gt;fl_icmp_code
op_assign
l_int|0
suffix:semicolon
)brace
DECL|function|ndisc_send_na
r_static
r_void
id|ndisc_send_na
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|neighbour
op_star
id|neigh
comma
r_struct
id|in6_addr
op_star
id|daddr
comma
r_struct
id|in6_addr
op_star
id|solicited_addr
comma
r_int
id|router
comma
r_int
id|solicited
comma
r_int
id|override
comma
r_int
id|inc_opt
)paren
(brace
r_struct
id|in6_addr
id|tmpaddr
suffix:semicolon
r_struct
id|inet6_ifaddr
op_star
id|ifp
suffix:semicolon
r_struct
id|inet6_dev
op_star
id|idev
suffix:semicolon
r_struct
id|flowi
id|fl
suffix:semicolon
r_struct
id|dst_entry
op_star
id|dst
suffix:semicolon
r_struct
id|sock
op_star
id|sk
op_assign
id|ndisc_socket-&gt;sk
suffix:semicolon
r_struct
id|in6_addr
op_star
id|src_addr
suffix:semicolon
r_struct
id|nd_msg
op_star
id|msg
suffix:semicolon
r_int
id|len
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_int
id|err
suffix:semicolon
id|len
op_assign
r_sizeof
(paren
r_struct
id|icmp6hdr
)paren
op_plus
r_sizeof
(paren
r_struct
id|in6_addr
)paren
suffix:semicolon
multiline_comment|/* for anycast or proxy, solicited_addr != src_addr */
id|ifp
op_assign
id|ipv6_get_ifaddr
c_func
(paren
id|solicited_addr
comma
id|dev
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ifp
)paren
(brace
id|src_addr
op_assign
id|solicited_addr
suffix:semicolon
id|in6_ifa_put
c_func
(paren
id|ifp
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|ipv6_dev_get_saddr
c_func
(paren
id|dev
comma
id|daddr
comma
op_amp
id|tmpaddr
)paren
)paren
r_return
suffix:semicolon
id|src_addr
op_assign
op_amp
id|tmpaddr
suffix:semicolon
)brace
id|ndisc_flow_init
c_func
(paren
op_amp
id|fl
comma
id|NDISC_NEIGHBOUR_ADVERTISEMENT
comma
id|src_addr
comma
id|daddr
)paren
suffix:semicolon
id|dst
op_assign
id|ndisc_dst_alloc
c_func
(paren
id|dev
comma
id|neigh
comma
id|daddr
comma
id|ip6_output
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dst
)paren
r_return
suffix:semicolon
id|err
op_assign
id|xfrm_lookup
c_func
(paren
op_amp
id|dst
comma
op_amp
id|fl
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
(brace
id|dst_release
c_func
(paren
id|dst
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|inc_opt
)paren
(brace
r_if
c_cond
(paren
id|dev-&gt;addr_len
)paren
id|len
op_add_assign
id|NDISC_OPT_SPACE
c_func
(paren
id|dev-&gt;addr_len
)paren
suffix:semicolon
r_else
id|inc_opt
op_assign
l_int|0
suffix:semicolon
)brace
id|skb
op_assign
id|sock_alloc_send_skb
c_func
(paren
id|sk
comma
id|MAX_HEADER
op_plus
id|len
op_plus
id|LL_RESERVED_SPACE
c_func
(paren
id|dev
)paren
comma
l_int|1
comma
op_amp
id|err
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_eq
l_int|NULL
)paren
(brace
id|ND_PRINTK0
c_func
(paren
id|KERN_ERR
l_string|&quot;ICMPv6 NA: %s() failed to allocate an skb.&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|dst_release
c_func
(paren
id|dst
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|skb_reserve
c_func
(paren
id|skb
comma
id|LL_RESERVED_SPACE
c_func
(paren
id|dev
)paren
)paren
suffix:semicolon
id|ip6_nd_hdr
c_func
(paren
id|sk
comma
id|skb
comma
id|dev
comma
id|src_addr
comma
id|daddr
comma
id|IPPROTO_ICMPV6
comma
id|len
)paren
suffix:semicolon
id|msg
op_assign
(paren
r_struct
id|nd_msg
op_star
)paren
id|skb_put
c_func
(paren
id|skb
comma
id|len
)paren
suffix:semicolon
id|skb-&gt;h.raw
op_assign
(paren
r_int
r_char
op_star
)paren
id|msg
suffix:semicolon
id|msg-&gt;icmph.icmp6_type
op_assign
id|NDISC_NEIGHBOUR_ADVERTISEMENT
suffix:semicolon
id|msg-&gt;icmph.icmp6_code
op_assign
l_int|0
suffix:semicolon
id|msg-&gt;icmph.icmp6_cksum
op_assign
l_int|0
suffix:semicolon
id|msg-&gt;icmph.icmp6_unused
op_assign
l_int|0
suffix:semicolon
id|msg-&gt;icmph.icmp6_router
op_assign
id|router
suffix:semicolon
id|msg-&gt;icmph.icmp6_solicited
op_assign
id|solicited
suffix:semicolon
id|msg-&gt;icmph.icmp6_override
op_assign
op_logical_neg
op_logical_neg
id|override
suffix:semicolon
multiline_comment|/* Set the target address. */
id|ipv6_addr_copy
c_func
(paren
op_amp
id|msg-&gt;target
comma
id|solicited_addr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|inc_opt
)paren
id|ndisc_fill_option
c_func
(paren
id|msg-&gt;opt
comma
id|ND_OPT_TARGET_LL_ADDR
comma
id|dev-&gt;dev_addr
comma
id|dev-&gt;addr_len
)paren
suffix:semicolon
multiline_comment|/* checksum */
id|msg-&gt;icmph.icmp6_cksum
op_assign
id|csum_ipv6_magic
c_func
(paren
id|src_addr
comma
id|daddr
comma
id|len
comma
id|IPPROTO_ICMPV6
comma
id|csum_partial
c_func
(paren
(paren
id|__u8
op_star
)paren
id|msg
comma
id|len
comma
l_int|0
)paren
)paren
suffix:semicolon
id|skb-&gt;dst
op_assign
id|dst
suffix:semicolon
id|idev
op_assign
id|in6_dev_get
c_func
(paren
id|dst-&gt;dev
)paren
suffix:semicolon
id|IP6_INC_STATS
c_func
(paren
id|IPSTATS_MIB_OUTREQUESTS
)paren
suffix:semicolon
id|err
op_assign
id|NF_HOOK
c_func
(paren
id|PF_INET6
comma
id|NF_IP6_LOCAL_OUT
comma
id|skb
comma
l_int|NULL
comma
id|dst-&gt;dev
comma
id|dst_output
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|err
)paren
(brace
id|ICMP6_INC_STATS
c_func
(paren
id|idev
comma
id|ICMP6_MIB_OUTNEIGHBORADVERTISEMENTS
)paren
suffix:semicolon
id|ICMP6_INC_STATS
c_func
(paren
id|idev
comma
id|ICMP6_MIB_OUTMSGS
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|likely
c_func
(paren
id|idev
op_ne
l_int|NULL
)paren
)paren
id|in6_dev_put
c_func
(paren
id|idev
)paren
suffix:semicolon
)brace
DECL|function|ndisc_send_ns
r_void
id|ndisc_send_ns
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|neighbour
op_star
id|neigh
comma
r_struct
id|in6_addr
op_star
id|solicit
comma
r_struct
id|in6_addr
op_star
id|daddr
comma
r_struct
id|in6_addr
op_star
id|saddr
)paren
(brace
r_struct
id|flowi
id|fl
suffix:semicolon
r_struct
id|dst_entry
op_star
id|dst
suffix:semicolon
r_struct
id|inet6_dev
op_star
id|idev
suffix:semicolon
r_struct
id|sock
op_star
id|sk
op_assign
id|ndisc_socket-&gt;sk
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_struct
id|nd_msg
op_star
id|msg
suffix:semicolon
r_struct
id|in6_addr
id|addr_buf
suffix:semicolon
r_int
id|len
suffix:semicolon
r_int
id|err
suffix:semicolon
r_int
id|send_llinfo
suffix:semicolon
r_if
c_cond
(paren
id|saddr
op_eq
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
id|ipv6_get_lladdr
c_func
(paren
id|dev
comma
op_amp
id|addr_buf
)paren
)paren
r_return
suffix:semicolon
id|saddr
op_assign
op_amp
id|addr_buf
suffix:semicolon
)brace
id|ndisc_flow_init
c_func
(paren
op_amp
id|fl
comma
id|NDISC_NEIGHBOUR_SOLICITATION
comma
id|saddr
comma
id|daddr
)paren
suffix:semicolon
id|dst
op_assign
id|ndisc_dst_alloc
c_func
(paren
id|dev
comma
id|neigh
comma
id|daddr
comma
id|ip6_output
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dst
)paren
r_return
suffix:semicolon
id|err
op_assign
id|xfrm_lookup
c_func
(paren
op_amp
id|dst
comma
op_amp
id|fl
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
(brace
id|dst_release
c_func
(paren
id|dst
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|len
op_assign
r_sizeof
(paren
r_struct
id|icmp6hdr
)paren
op_plus
r_sizeof
(paren
r_struct
id|in6_addr
)paren
suffix:semicolon
id|send_llinfo
op_assign
id|dev-&gt;addr_len
op_logical_and
op_logical_neg
id|ipv6_addr_any
c_func
(paren
id|saddr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|send_llinfo
)paren
id|len
op_add_assign
id|NDISC_OPT_SPACE
c_func
(paren
id|dev-&gt;addr_len
)paren
suffix:semicolon
id|skb
op_assign
id|sock_alloc_send_skb
c_func
(paren
id|sk
comma
id|MAX_HEADER
op_plus
id|len
op_plus
id|LL_RESERVED_SPACE
c_func
(paren
id|dev
)paren
comma
l_int|1
comma
op_amp
id|err
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_eq
l_int|NULL
)paren
(brace
id|ND_PRINTK0
c_func
(paren
id|KERN_ERR
l_string|&quot;ICMPv6 NA: %s() failed to allocate an skb.&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|dst_release
c_func
(paren
id|dst
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|skb_reserve
c_func
(paren
id|skb
comma
id|LL_RESERVED_SPACE
c_func
(paren
id|dev
)paren
)paren
suffix:semicolon
id|ip6_nd_hdr
c_func
(paren
id|sk
comma
id|skb
comma
id|dev
comma
id|saddr
comma
id|daddr
comma
id|IPPROTO_ICMPV6
comma
id|len
)paren
suffix:semicolon
id|msg
op_assign
(paren
r_struct
id|nd_msg
op_star
)paren
id|skb_put
c_func
(paren
id|skb
comma
id|len
)paren
suffix:semicolon
id|skb-&gt;h.raw
op_assign
(paren
r_int
r_char
op_star
)paren
id|msg
suffix:semicolon
id|msg-&gt;icmph.icmp6_type
op_assign
id|NDISC_NEIGHBOUR_SOLICITATION
suffix:semicolon
id|msg-&gt;icmph.icmp6_code
op_assign
l_int|0
suffix:semicolon
id|msg-&gt;icmph.icmp6_cksum
op_assign
l_int|0
suffix:semicolon
id|msg-&gt;icmph.icmp6_unused
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Set the target address. */
id|ipv6_addr_copy
c_func
(paren
op_amp
id|msg-&gt;target
comma
id|solicit
)paren
suffix:semicolon
r_if
c_cond
(paren
id|send_llinfo
)paren
id|ndisc_fill_option
c_func
(paren
id|msg-&gt;opt
comma
id|ND_OPT_SOURCE_LL_ADDR
comma
id|dev-&gt;dev_addr
comma
id|dev-&gt;addr_len
)paren
suffix:semicolon
multiline_comment|/* checksum */
id|msg-&gt;icmph.icmp6_cksum
op_assign
id|csum_ipv6_magic
c_func
(paren
op_amp
id|skb-&gt;nh.ipv6h-&gt;saddr
comma
id|daddr
comma
id|len
comma
id|IPPROTO_ICMPV6
comma
id|csum_partial
c_func
(paren
(paren
id|__u8
op_star
)paren
id|msg
comma
id|len
comma
l_int|0
)paren
)paren
suffix:semicolon
multiline_comment|/* send it! */
id|skb-&gt;dst
op_assign
id|dst
suffix:semicolon
id|idev
op_assign
id|in6_dev_get
c_func
(paren
id|dst-&gt;dev
)paren
suffix:semicolon
id|IP6_INC_STATS
c_func
(paren
id|IPSTATS_MIB_OUTREQUESTS
)paren
suffix:semicolon
id|err
op_assign
id|NF_HOOK
c_func
(paren
id|PF_INET6
comma
id|NF_IP6_LOCAL_OUT
comma
id|skb
comma
l_int|NULL
comma
id|dst-&gt;dev
comma
id|dst_output
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|err
)paren
(brace
id|ICMP6_INC_STATS
c_func
(paren
id|idev
comma
id|ICMP6_MIB_OUTNEIGHBORSOLICITS
)paren
suffix:semicolon
id|ICMP6_INC_STATS
c_func
(paren
id|idev
comma
id|ICMP6_MIB_OUTMSGS
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|likely
c_func
(paren
id|idev
op_ne
l_int|NULL
)paren
)paren
id|in6_dev_put
c_func
(paren
id|idev
)paren
suffix:semicolon
)brace
DECL|function|ndisc_send_rs
r_void
id|ndisc_send_rs
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|in6_addr
op_star
id|saddr
comma
r_struct
id|in6_addr
op_star
id|daddr
)paren
(brace
r_struct
id|flowi
id|fl
suffix:semicolon
r_struct
id|dst_entry
op_star
id|dst
suffix:semicolon
r_struct
id|inet6_dev
op_star
id|idev
suffix:semicolon
r_struct
id|sock
op_star
id|sk
op_assign
id|ndisc_socket-&gt;sk
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_struct
id|icmp6hdr
op_star
id|hdr
suffix:semicolon
id|__u8
op_star
id|opt
suffix:semicolon
r_int
id|len
suffix:semicolon
r_int
id|err
suffix:semicolon
id|ndisc_flow_init
c_func
(paren
op_amp
id|fl
comma
id|NDISC_ROUTER_SOLICITATION
comma
id|saddr
comma
id|daddr
)paren
suffix:semicolon
id|dst
op_assign
id|ndisc_dst_alloc
c_func
(paren
id|dev
comma
l_int|NULL
comma
id|daddr
comma
id|ip6_output
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dst
)paren
r_return
suffix:semicolon
id|err
op_assign
id|xfrm_lookup
c_func
(paren
op_amp
id|dst
comma
op_amp
id|fl
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
(brace
id|dst_release
c_func
(paren
id|dst
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|len
op_assign
r_sizeof
(paren
r_struct
id|icmp6hdr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;addr_len
)paren
id|len
op_add_assign
id|NDISC_OPT_SPACE
c_func
(paren
id|dev-&gt;addr_len
)paren
suffix:semicolon
id|skb
op_assign
id|sock_alloc_send_skb
c_func
(paren
id|sk
comma
id|MAX_HEADER
op_plus
id|len
op_plus
id|LL_RESERVED_SPACE
c_func
(paren
id|dev
)paren
comma
l_int|1
comma
op_amp
id|err
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_eq
l_int|NULL
)paren
(brace
id|ND_PRINTK0
c_func
(paren
id|KERN_ERR
l_string|&quot;ICMPv6 RS: %s() failed to allocate an skb.&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|dst_release
c_func
(paren
id|dst
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|skb_reserve
c_func
(paren
id|skb
comma
id|LL_RESERVED_SPACE
c_func
(paren
id|dev
)paren
)paren
suffix:semicolon
id|ip6_nd_hdr
c_func
(paren
id|sk
comma
id|skb
comma
id|dev
comma
id|saddr
comma
id|daddr
comma
id|IPPROTO_ICMPV6
comma
id|len
)paren
suffix:semicolon
id|hdr
op_assign
(paren
r_struct
id|icmp6hdr
op_star
)paren
id|skb_put
c_func
(paren
id|skb
comma
id|len
)paren
suffix:semicolon
id|skb-&gt;h.raw
op_assign
(paren
r_int
r_char
op_star
)paren
id|hdr
suffix:semicolon
id|hdr-&gt;icmp6_type
op_assign
id|NDISC_ROUTER_SOLICITATION
suffix:semicolon
id|hdr-&gt;icmp6_code
op_assign
l_int|0
suffix:semicolon
id|hdr-&gt;icmp6_cksum
op_assign
l_int|0
suffix:semicolon
id|hdr-&gt;icmp6_unused
op_assign
l_int|0
suffix:semicolon
id|opt
op_assign
(paren
id|u8
op_star
)paren
(paren
id|hdr
op_plus
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;addr_len
)paren
id|ndisc_fill_option
c_func
(paren
id|opt
comma
id|ND_OPT_SOURCE_LL_ADDR
comma
id|dev-&gt;dev_addr
comma
id|dev-&gt;addr_len
)paren
suffix:semicolon
multiline_comment|/* checksum */
id|hdr-&gt;icmp6_cksum
op_assign
id|csum_ipv6_magic
c_func
(paren
op_amp
id|skb-&gt;nh.ipv6h-&gt;saddr
comma
id|daddr
comma
id|len
comma
id|IPPROTO_ICMPV6
comma
id|csum_partial
c_func
(paren
(paren
id|__u8
op_star
)paren
id|hdr
comma
id|len
comma
l_int|0
)paren
)paren
suffix:semicolon
multiline_comment|/* send it! */
id|skb-&gt;dst
op_assign
id|dst
suffix:semicolon
id|idev
op_assign
id|in6_dev_get
c_func
(paren
id|dst-&gt;dev
)paren
suffix:semicolon
id|IP6_INC_STATS
c_func
(paren
id|IPSTATS_MIB_OUTREQUESTS
)paren
suffix:semicolon
id|err
op_assign
id|NF_HOOK
c_func
(paren
id|PF_INET6
comma
id|NF_IP6_LOCAL_OUT
comma
id|skb
comma
l_int|NULL
comma
id|dst-&gt;dev
comma
id|dst_output
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|err
)paren
(brace
id|ICMP6_INC_STATS
c_func
(paren
id|idev
comma
id|ICMP6_MIB_OUTROUTERSOLICITS
)paren
suffix:semicolon
id|ICMP6_INC_STATS
c_func
(paren
id|idev
comma
id|ICMP6_MIB_OUTMSGS
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|likely
c_func
(paren
id|idev
op_ne
l_int|NULL
)paren
)paren
id|in6_dev_put
c_func
(paren
id|idev
)paren
suffix:semicolon
)brace
DECL|function|ndisc_error_report
r_static
r_void
id|ndisc_error_report
c_func
(paren
r_struct
id|neighbour
op_star
id|neigh
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
multiline_comment|/*&n;&t; *&t;&quot;The sender MUST return an ICMP&n;&t; *&t; destination unreachable&quot;&n;&t; */
id|dst_link_failure
c_func
(paren
id|skb
)paren
suffix:semicolon
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
multiline_comment|/* Called with locked neigh: either read or both */
DECL|function|ndisc_solicit
r_static
r_void
id|ndisc_solicit
c_func
(paren
r_struct
id|neighbour
op_star
id|neigh
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|in6_addr
op_star
id|saddr
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|in6_addr
id|mcaddr
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
op_assign
id|neigh-&gt;dev
suffix:semicolon
r_struct
id|in6_addr
op_star
id|target
op_assign
(paren
r_struct
id|in6_addr
op_star
)paren
op_amp
id|neigh-&gt;primary_key
suffix:semicolon
r_int
id|probes
op_assign
id|atomic_read
c_func
(paren
op_amp
id|neigh-&gt;probes
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_logical_and
id|ipv6_chk_addr
c_func
(paren
op_amp
id|skb-&gt;nh.ipv6h-&gt;saddr
comma
id|dev
comma
l_int|1
)paren
)paren
id|saddr
op_assign
op_amp
id|skb-&gt;nh.ipv6h-&gt;saddr
suffix:semicolon
r_if
c_cond
(paren
(paren
id|probes
op_sub_assign
id|neigh-&gt;parms-&gt;ucast_probes
)paren
OL
l_int|0
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|neigh-&gt;nud_state
op_amp
id|NUD_VALID
)paren
)paren
(brace
id|ND_PRINTK1
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s(): trying to ucast probe in NUD_INVALID: &quot;
l_string|&quot;%04x:%04x:%04x:%04x:%04x:%04x:%04x:%04x&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|NIP6
c_func
(paren
op_star
id|target
)paren
)paren
suffix:semicolon
)brace
id|ndisc_send_ns
c_func
(paren
id|dev
comma
id|neigh
comma
id|target
comma
id|target
comma
id|saddr
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|probes
op_sub_assign
id|neigh-&gt;parms-&gt;app_probes
)paren
OL
l_int|0
)paren
(brace
macro_line|#ifdef CONFIG_ARPD
id|neigh_app_ns
c_func
(paren
id|neigh
)paren
suffix:semicolon
macro_line|#endif
)brace
r_else
(brace
id|addrconf_addr_solict_mult
c_func
(paren
id|target
comma
op_amp
id|mcaddr
)paren
suffix:semicolon
id|ndisc_send_ns
c_func
(paren
id|dev
comma
l_int|NULL
comma
id|target
comma
op_amp
id|mcaddr
comma
id|saddr
)paren
suffix:semicolon
)brace
)brace
DECL|function|ndisc_recv_ns
r_static
r_void
id|ndisc_recv_ns
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|nd_msg
op_star
id|msg
op_assign
(paren
r_struct
id|nd_msg
op_star
)paren
id|skb-&gt;h.raw
suffix:semicolon
r_struct
id|in6_addr
op_star
id|saddr
op_assign
op_amp
id|skb-&gt;nh.ipv6h-&gt;saddr
suffix:semicolon
r_struct
id|in6_addr
op_star
id|daddr
op_assign
op_amp
id|skb-&gt;nh.ipv6h-&gt;daddr
suffix:semicolon
id|u8
op_star
id|lladdr
op_assign
l_int|NULL
suffix:semicolon
r_int
id|lladdrlen
op_assign
l_int|0
suffix:semicolon
id|u32
id|ndoptlen
op_assign
id|skb-&gt;tail
op_minus
id|msg-&gt;opt
suffix:semicolon
r_struct
id|ndisc_options
id|ndopts
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
op_assign
id|skb-&gt;dev
suffix:semicolon
r_struct
id|inet6_ifaddr
op_star
id|ifp
suffix:semicolon
r_struct
id|inet6_dev
op_star
id|idev
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|neighbour
op_star
id|neigh
suffix:semicolon
r_int
id|dad
op_assign
id|ipv6_addr_any
c_func
(paren
id|saddr
)paren
suffix:semicolon
r_int
id|inc
suffix:semicolon
r_if
c_cond
(paren
id|ipv6_addr_is_multicast
c_func
(paren
op_amp
id|msg-&gt;target
)paren
)paren
(brace
id|ND_PRINTK2
c_func
(paren
id|KERN_WARNING
l_string|&quot;ICMPv6 NS: multicast target address&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * RFC2461 7.1.1:&n;&t; * DAD has to be destined for solicited node multicast address.&n;&t; */
r_if
c_cond
(paren
id|dad
op_logical_and
op_logical_neg
(paren
id|daddr-&gt;s6_addr32
(braket
l_int|0
)braket
op_eq
id|htonl
c_func
(paren
l_int|0xff020000
)paren
op_logical_and
id|daddr-&gt;s6_addr32
(braket
l_int|1
)braket
op_eq
id|htonl
c_func
(paren
l_int|0x00000000
)paren
op_logical_and
id|daddr-&gt;s6_addr32
(braket
l_int|2
)braket
op_eq
id|htonl
c_func
(paren
l_int|0x00000001
)paren
op_logical_and
id|daddr-&gt;s6_addr
(braket
l_int|12
)braket
op_eq
l_int|0xff
)paren
)paren
(brace
id|ND_PRINTK2
c_func
(paren
id|KERN_WARNING
l_string|&quot;ICMPv6 NS: bad DAD packet (wrong destination)&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|ndisc_parse_options
c_func
(paren
id|msg-&gt;opt
comma
id|ndoptlen
comma
op_amp
id|ndopts
)paren
)paren
(brace
id|ND_PRINTK2
c_func
(paren
id|KERN_WARNING
l_string|&quot;ICMPv6 NS: invalid ND options&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ndopts.nd_opts_src_lladdr
)paren
(brace
id|lladdr
op_assign
(paren
id|u8
op_star
)paren
(paren
id|ndopts.nd_opts_src_lladdr
op_plus
l_int|1
)paren
suffix:semicolon
id|lladdrlen
op_assign
id|ndopts.nd_opts_src_lladdr-&gt;nd_opt_len
op_lshift
l_int|3
suffix:semicolon
r_if
c_cond
(paren
id|lladdrlen
op_ne
id|NDISC_OPT_SPACE
c_func
(paren
id|dev-&gt;addr_len
)paren
)paren
(brace
id|ND_PRINTK2
c_func
(paren
id|KERN_WARNING
l_string|&quot;ICMPv6 NS: invalid link-layer address length&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/* RFC2461 7.1.1:&n;&t; &t; *&t;If the IP source address is the unspecified address, &n;&t;&t; *&t;there MUST NOT be source link-layer address option &n;&t;&t; *&t;in the message.&n;&t;&t; */
r_if
c_cond
(paren
id|dad
)paren
(brace
id|ND_PRINTK2
c_func
(paren
id|KERN_WARNING
l_string|&quot;ICMPv6 NS: bad DAD packet (link-layer address option)&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
)brace
id|inc
op_assign
id|ipv6_addr_is_multicast
c_func
(paren
id|daddr
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ifp
op_assign
id|ipv6_get_ifaddr
c_func
(paren
op_amp
id|msg-&gt;target
comma
id|dev
comma
l_int|1
)paren
)paren
op_ne
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
id|ifp-&gt;flags
op_amp
id|IFA_F_TENTATIVE
)paren
(brace
multiline_comment|/* Address is tentative. If the source&n;&t;&t;&t;   is unspecified address, it is someone&n;&t;&t;&t;   does DAD, otherwise we ignore solicitations&n;&t;&t;&t;   until DAD timer expires.&n;&t;&t;&t; */
r_if
c_cond
(paren
op_logical_neg
id|dad
)paren
r_goto
id|out
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;type
op_eq
id|ARPHRD_IEEE802_TR
)paren
(brace
r_int
r_char
op_star
id|sadr
op_assign
id|skb-&gt;mac.raw
suffix:semicolon
r_if
c_cond
(paren
(paren
(paren
id|sadr
(braket
l_int|8
)braket
op_xor
id|dev-&gt;dev_addr
(braket
l_int|0
)braket
)paren
op_amp
l_int|0x7f
)paren
op_eq
l_int|0
op_logical_and
id|sadr
(braket
l_int|9
)braket
op_eq
id|dev-&gt;dev_addr
(braket
l_int|1
)braket
op_logical_and
id|sadr
(braket
l_int|10
)braket
op_eq
id|dev-&gt;dev_addr
(braket
l_int|2
)braket
op_logical_and
id|sadr
(braket
l_int|11
)braket
op_eq
id|dev-&gt;dev_addr
(braket
l_int|3
)braket
op_logical_and
id|sadr
(braket
l_int|12
)braket
op_eq
id|dev-&gt;dev_addr
(braket
l_int|4
)braket
op_logical_and
id|sadr
(braket
l_int|13
)braket
op_eq
id|dev-&gt;dev_addr
(braket
l_int|5
)braket
)paren
(brace
multiline_comment|/* looped-back to us */
r_goto
id|out
suffix:semicolon
)brace
)brace
id|addrconf_dad_failure
c_func
(paren
id|ifp
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|idev
op_assign
id|ifp-&gt;idev
suffix:semicolon
)brace
r_else
(brace
id|idev
op_assign
id|in6_dev_get
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|idev
)paren
(brace
multiline_comment|/* XXX: count this drop? */
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ipv6_chk_acast_addr
c_func
(paren
id|dev
comma
op_amp
id|msg-&gt;target
)paren
op_logical_or
(paren
id|idev-&gt;cnf.forwarding
op_logical_and
id|pneigh_lookup
c_func
(paren
op_amp
id|nd_tbl
comma
op_amp
id|msg-&gt;target
comma
id|dev
comma
l_int|0
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
id|skb-&gt;stamp.tv_sec
op_ne
id|LOCALLY_ENQUEUED
op_logical_and
id|skb-&gt;pkt_type
op_ne
id|PACKET_HOST
op_logical_and
id|inc
op_ne
l_int|0
op_logical_and
id|idev-&gt;nd_parms-&gt;proxy_delay
op_ne
l_int|0
)paren
(brace
multiline_comment|/*&n;&t;&t;&t;&t; * for anycast or proxy,&n;&t;&t;&t;&t; * sender should delay its response &n;&t;&t;&t;&t; * by a random time between 0 and &n;&t;&t;&t;&t; * MAX_ANYCAST_DELAY_TIME seconds.&n;&t;&t;&t;&t; * (RFC2461) -- yoshfuji&n;&t;&t;&t;&t; */
r_struct
id|sk_buff
op_star
id|n
op_assign
id|skb_clone
c_func
(paren
id|skb
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|n
)paren
id|pneigh_enqueue
c_func
(paren
op_amp
id|nd_tbl
comma
id|idev-&gt;nd_parms
comma
id|n
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
)brace
r_else
r_goto
id|out
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dad
)paren
(brace
r_struct
id|in6_addr
id|maddr
suffix:semicolon
id|ipv6_addr_all_nodes
c_func
(paren
op_amp
id|maddr
)paren
suffix:semicolon
id|ndisc_send_na
c_func
(paren
id|dev
comma
l_int|NULL
comma
op_amp
id|maddr
comma
op_amp
id|msg-&gt;target
comma
id|idev-&gt;cnf.forwarding
comma
l_int|0
comma
(paren
id|ifp
op_ne
l_int|NULL
)paren
comma
l_int|1
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_if
c_cond
(paren
id|inc
)paren
id|NEIGH_CACHE_STAT_INC
c_func
(paren
op_amp
id|nd_tbl
comma
id|rcv_probes_mcast
)paren
suffix:semicolon
r_else
id|NEIGH_CACHE_STAT_INC
c_func
(paren
op_amp
id|nd_tbl
comma
id|rcv_probes_ucast
)paren
suffix:semicolon
multiline_comment|/* &n;&t; *&t;update / create cache entry&n;&t; *&t;for the source address&n;&t; */
id|neigh
op_assign
id|__neigh_lookup
c_func
(paren
op_amp
id|nd_tbl
comma
id|saddr
comma
id|dev
comma
op_logical_neg
id|inc
op_logical_or
id|lladdr
op_logical_or
op_logical_neg
id|dev-&gt;addr_len
)paren
suffix:semicolon
r_if
c_cond
(paren
id|neigh
)paren
id|neigh_update
c_func
(paren
id|neigh
comma
id|lladdr
comma
id|NUD_STALE
comma
id|NEIGH_UPDATE_F_WEAK_OVERRIDE
op_or
id|NEIGH_UPDATE_F_OVERRIDE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|neigh
op_logical_or
op_logical_neg
id|dev-&gt;hard_header
)paren
(brace
id|ndisc_send_na
c_func
(paren
id|dev
comma
id|neigh
comma
id|saddr
comma
op_amp
id|msg-&gt;target
comma
id|idev-&gt;cnf.forwarding
comma
l_int|1
comma
(paren
id|ifp
op_ne
l_int|NULL
op_logical_and
id|inc
)paren
comma
id|inc
)paren
suffix:semicolon
r_if
c_cond
(paren
id|neigh
)paren
id|neigh_release
c_func
(paren
id|neigh
)paren
suffix:semicolon
)brace
id|out
suffix:colon
r_if
c_cond
(paren
id|ifp
)paren
id|in6_ifa_put
c_func
(paren
id|ifp
)paren
suffix:semicolon
r_else
id|in6_dev_put
c_func
(paren
id|idev
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|function|ndisc_recv_na
r_static
r_void
id|ndisc_recv_na
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|nd_msg
op_star
id|msg
op_assign
(paren
r_struct
id|nd_msg
op_star
)paren
id|skb-&gt;h.raw
suffix:semicolon
r_struct
id|in6_addr
op_star
id|saddr
op_assign
op_amp
id|skb-&gt;nh.ipv6h-&gt;saddr
suffix:semicolon
r_struct
id|in6_addr
op_star
id|daddr
op_assign
op_amp
id|skb-&gt;nh.ipv6h-&gt;daddr
suffix:semicolon
id|u8
op_star
id|lladdr
op_assign
l_int|NULL
suffix:semicolon
r_int
id|lladdrlen
op_assign
l_int|0
suffix:semicolon
id|u32
id|ndoptlen
op_assign
id|skb-&gt;tail
op_minus
id|msg-&gt;opt
suffix:semicolon
r_struct
id|ndisc_options
id|ndopts
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
op_assign
id|skb-&gt;dev
suffix:semicolon
r_struct
id|inet6_ifaddr
op_star
id|ifp
suffix:semicolon
r_struct
id|neighbour
op_star
id|neigh
suffix:semicolon
r_if
c_cond
(paren
id|skb-&gt;len
OL
r_sizeof
(paren
r_struct
id|nd_msg
)paren
)paren
(brace
id|ND_PRINTK2
c_func
(paren
id|KERN_WARNING
l_string|&quot;ICMPv6 NA: packet too short&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ipv6_addr_is_multicast
c_func
(paren
op_amp
id|msg-&gt;target
)paren
)paren
(brace
id|ND_PRINTK2
c_func
(paren
id|KERN_WARNING
l_string|&quot;ICMPv6 NA: target address is multicast.&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ipv6_addr_is_multicast
c_func
(paren
id|daddr
)paren
op_logical_and
id|msg-&gt;icmph.icmp6_solicited
)paren
(brace
id|ND_PRINTK2
c_func
(paren
id|KERN_WARNING
l_string|&quot;ICMPv6 NA: solicited NA is multicasted.&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|ndisc_parse_options
c_func
(paren
id|msg-&gt;opt
comma
id|ndoptlen
comma
op_amp
id|ndopts
)paren
)paren
(brace
id|ND_PRINTK2
c_func
(paren
id|KERN_WARNING
l_string|&quot;ICMPv6 NS: invalid ND option&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ndopts.nd_opts_tgt_lladdr
)paren
(brace
id|lladdr
op_assign
(paren
id|u8
op_star
)paren
(paren
id|ndopts.nd_opts_tgt_lladdr
op_plus
l_int|1
)paren
suffix:semicolon
id|lladdrlen
op_assign
id|ndopts.nd_opts_tgt_lladdr-&gt;nd_opt_len
op_lshift
l_int|3
suffix:semicolon
r_if
c_cond
(paren
id|lladdrlen
op_ne
id|NDISC_OPT_SPACE
c_func
(paren
id|dev-&gt;addr_len
)paren
)paren
(brace
id|ND_PRINTK2
c_func
(paren
id|KERN_WARNING
l_string|&quot;ICMPv6 NA: invalid link-layer address length&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
(paren
id|ifp
op_assign
id|ipv6_get_ifaddr
c_func
(paren
op_amp
id|msg-&gt;target
comma
id|dev
comma
l_int|1
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
id|ifp-&gt;flags
op_amp
id|IFA_F_TENTATIVE
)paren
(brace
id|addrconf_dad_failure
c_func
(paren
id|ifp
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/* What should we make now? The advertisement&n;&t;&t;   is invalid, but ndisc specs say nothing&n;&t;&t;   about it. It could be misconfiguration, or&n;&t;&t;   an smart proxy agent tries to help us :-)&n;&t;&t; */
id|ND_PRINTK1
c_func
(paren
id|KERN_WARNING
l_string|&quot;ICMPv6 NA: someone advertises our address on %s!&bslash;n&quot;
comma
id|ifp-&gt;idev-&gt;dev-&gt;name
)paren
suffix:semicolon
id|in6_ifa_put
c_func
(paren
id|ifp
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|neigh
op_assign
id|neigh_lookup
c_func
(paren
op_amp
id|nd_tbl
comma
op_amp
id|msg-&gt;target
comma
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|neigh
)paren
(brace
id|u8
id|old_flags
op_assign
id|neigh-&gt;flags
suffix:semicolon
r_if
c_cond
(paren
id|neigh-&gt;nud_state
op_amp
id|NUD_FAILED
)paren
r_goto
id|out
suffix:semicolon
id|neigh_update
c_func
(paren
id|neigh
comma
id|lladdr
comma
id|msg-&gt;icmph.icmp6_solicited
ques
c_cond
id|NUD_REACHABLE
suffix:colon
id|NUD_STALE
comma
id|NEIGH_UPDATE_F_WEAK_OVERRIDE
op_or
(paren
id|msg-&gt;icmph.icmp6_override
ques
c_cond
id|NEIGH_UPDATE_F_OVERRIDE
suffix:colon
l_int|0
)paren
op_or
id|NEIGH_UPDATE_F_OVERRIDE_ISROUTER
op_or
(paren
id|msg-&gt;icmph.icmp6_router
ques
c_cond
id|NEIGH_UPDATE_F_ISROUTER
suffix:colon
l_int|0
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|old_flags
op_amp
op_complement
id|neigh-&gt;flags
)paren
op_amp
id|NTF_ROUTER
)paren
(brace
multiline_comment|/*&n;&t;&t;&t; * Change: router to host&n;&t;&t;&t; */
r_struct
id|rt6_info
op_star
id|rt
suffix:semicolon
id|rt
op_assign
id|rt6_get_dflt_router
c_func
(paren
id|saddr
comma
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rt
)paren
id|ip6_del_rt
c_func
(paren
id|rt
comma
l_int|NULL
comma
l_int|NULL
)paren
suffix:semicolon
)brace
id|out
suffix:colon
id|neigh_release
c_func
(paren
id|neigh
)paren
suffix:semicolon
)brace
)brace
DECL|function|ndisc_recv_rs
r_static
r_void
id|ndisc_recv_rs
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|rs_msg
op_star
id|rs_msg
op_assign
(paren
r_struct
id|rs_msg
op_star
)paren
id|skb-&gt;h.raw
suffix:semicolon
r_int
r_int
id|ndoptlen
op_assign
id|skb-&gt;len
op_minus
r_sizeof
(paren
op_star
id|rs_msg
)paren
suffix:semicolon
r_struct
id|neighbour
op_star
id|neigh
suffix:semicolon
r_struct
id|inet6_dev
op_star
id|idev
suffix:semicolon
r_struct
id|in6_addr
op_star
id|saddr
op_assign
op_amp
id|skb-&gt;nh.ipv6h-&gt;saddr
suffix:semicolon
r_struct
id|ndisc_options
id|ndopts
suffix:semicolon
id|u8
op_star
id|lladdr
op_assign
l_int|NULL
suffix:semicolon
r_int
id|lladdrlen
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|skb-&gt;len
OL
r_sizeof
(paren
op_star
id|rs_msg
)paren
)paren
r_return
suffix:semicolon
id|idev
op_assign
id|in6_dev_get
c_func
(paren
id|skb-&gt;dev
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|idev
)paren
(brace
r_if
c_cond
(paren
id|net_ratelimit
c_func
(paren
)paren
)paren
id|ND_PRINTK1
c_func
(paren
l_string|&quot;ICMP6 RS: can&squot;t find in6 device&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/* Don&squot;t accept RS if we&squot;re not in router mode */
r_if
c_cond
(paren
op_logical_neg
id|idev-&gt;cnf.forwarding
)paren
r_goto
id|out
suffix:semicolon
multiline_comment|/*&n;&t; * Don&squot;t update NCE if src = ::;&n;&t; * this implies that the source node has no ip address assigned yet.&n;&t; */
r_if
c_cond
(paren
id|ipv6_addr_any
c_func
(paren
id|saddr
)paren
)paren
r_goto
id|out
suffix:semicolon
multiline_comment|/* Parse ND options */
r_if
c_cond
(paren
op_logical_neg
id|ndisc_parse_options
c_func
(paren
id|rs_msg-&gt;opt
comma
id|ndoptlen
comma
op_amp
id|ndopts
)paren
)paren
(brace
r_if
c_cond
(paren
id|net_ratelimit
c_func
(paren
)paren
)paren
id|ND_PRINTK2
c_func
(paren
l_string|&quot;ICMP6 NS: invalid ND option, ignored&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ndopts.nd_opts_src_lladdr
)paren
(brace
id|lladdr
op_assign
(paren
id|u8
op_star
)paren
(paren
id|ndopts.nd_opts_src_lladdr
op_plus
l_int|1
)paren
suffix:semicolon
id|lladdrlen
op_assign
id|ndopts.nd_opts_src_lladdr-&gt;nd_opt_len
op_lshift
l_int|3
suffix:semicolon
r_if
c_cond
(paren
id|lladdrlen
op_ne
id|NDISC_OPT_SPACE
c_func
(paren
id|skb-&gt;dev-&gt;addr_len
)paren
)paren
r_goto
id|out
suffix:semicolon
)brace
id|neigh
op_assign
id|__neigh_lookup
c_func
(paren
op_amp
id|nd_tbl
comma
id|saddr
comma
id|skb-&gt;dev
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|neigh
)paren
(brace
id|neigh_update
c_func
(paren
id|neigh
comma
id|lladdr
comma
id|NUD_STALE
comma
id|NEIGH_UPDATE_F_WEAK_OVERRIDE
op_or
id|NEIGH_UPDATE_F_OVERRIDE
op_or
id|NEIGH_UPDATE_F_OVERRIDE_ISROUTER
)paren
suffix:semicolon
id|neigh_release
c_func
(paren
id|neigh
)paren
suffix:semicolon
)brace
id|out
suffix:colon
id|in6_dev_put
c_func
(paren
id|idev
)paren
suffix:semicolon
)brace
DECL|function|ndisc_router_discovery
r_static
r_void
id|ndisc_router_discovery
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|ra_msg
op_star
id|ra_msg
op_assign
(paren
r_struct
id|ra_msg
op_star
)paren
id|skb-&gt;h.raw
suffix:semicolon
r_struct
id|neighbour
op_star
id|neigh
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|inet6_dev
op_star
id|in6_dev
suffix:semicolon
r_struct
id|rt6_info
op_star
id|rt
suffix:semicolon
r_int
id|lifetime
suffix:semicolon
r_struct
id|ndisc_options
id|ndopts
suffix:semicolon
r_int
id|optlen
suffix:semicolon
id|__u8
op_star
id|opt
op_assign
(paren
id|__u8
op_star
)paren
(paren
id|ra_msg
op_plus
l_int|1
)paren
suffix:semicolon
id|optlen
op_assign
(paren
id|skb-&gt;tail
op_minus
id|skb-&gt;h.raw
)paren
op_minus
r_sizeof
(paren
r_struct
id|ra_msg
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|ipv6_addr_type
c_func
(paren
op_amp
id|skb-&gt;nh.ipv6h-&gt;saddr
)paren
op_amp
id|IPV6_ADDR_LINKLOCAL
)paren
)paren
(brace
id|ND_PRINTK2
c_func
(paren
id|KERN_WARNING
l_string|&quot;ICMPv6 RA: source address is not link-local.&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|optlen
OL
l_int|0
)paren
(brace
id|ND_PRINTK2
c_func
(paren
id|KERN_WARNING
l_string|&quot;ICMPv6 RA: packet too short&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/*&n;&t; *&t;set the RA_RECV flag in the interface&n;&t; */
id|in6_dev
op_assign
id|in6_dev_get
c_func
(paren
id|skb-&gt;dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|in6_dev
op_eq
l_int|NULL
)paren
(brace
id|ND_PRINTK0
c_func
(paren
id|KERN_ERR
l_string|&quot;ICMPv6 RA: can&squot;t find inet6 device for %s.&bslash;n&quot;
comma
id|skb-&gt;dev-&gt;name
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|in6_dev-&gt;cnf.forwarding
op_logical_or
op_logical_neg
id|in6_dev-&gt;cnf.accept_ra
)paren
(brace
id|in6_dev_put
c_func
(paren
id|in6_dev
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|ndisc_parse_options
c_func
(paren
id|opt
comma
id|optlen
comma
op_amp
id|ndopts
)paren
)paren
(brace
id|in6_dev_put
c_func
(paren
id|in6_dev
)paren
suffix:semicolon
id|ND_PRINTK2
c_func
(paren
id|KERN_WARNING
l_string|&quot;ICMP6 RA: invalid ND options&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|in6_dev-&gt;if_flags
op_amp
id|IF_RS_SENT
)paren
(brace
multiline_comment|/*&n;&t;&t; *&t;flag that an RA was received after an RS was sent&n;&t;&t; *&t;out on this interface.&n;&t;&t; */
id|in6_dev-&gt;if_flags
op_or_assign
id|IF_RA_RCVD
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * Remember the managed/otherconf flags from most recently&n;&t; * received RA message (RFC 2462) -- yoshfuji&n;&t; */
id|in6_dev-&gt;if_flags
op_assign
(paren
id|in6_dev-&gt;if_flags
op_amp
op_complement
(paren
id|IF_RA_MANAGED
op_or
id|IF_RA_OTHERCONF
)paren
)paren
op_or
(paren
id|ra_msg-&gt;icmph.icmp6_addrconf_managed
ques
c_cond
id|IF_RA_MANAGED
suffix:colon
l_int|0
)paren
op_or
(paren
id|ra_msg-&gt;icmph.icmp6_addrconf_other
ques
c_cond
id|IF_RA_OTHERCONF
suffix:colon
l_int|0
)paren
suffix:semicolon
id|lifetime
op_assign
id|ntohs
c_func
(paren
id|ra_msg-&gt;icmph.icmp6_rt_lifetime
)paren
suffix:semicolon
id|rt
op_assign
id|rt6_get_dflt_router
c_func
(paren
op_amp
id|skb-&gt;nh.ipv6h-&gt;saddr
comma
id|skb-&gt;dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rt
)paren
id|neigh
op_assign
id|rt-&gt;rt6i_nexthop
suffix:semicolon
r_if
c_cond
(paren
id|rt
op_logical_and
id|lifetime
op_eq
l_int|0
)paren
(brace
id|neigh_clone
c_func
(paren
id|neigh
)paren
suffix:semicolon
id|ip6_del_rt
c_func
(paren
id|rt
comma
l_int|NULL
comma
l_int|NULL
)paren
suffix:semicolon
id|rt
op_assign
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|rt
op_eq
l_int|NULL
op_logical_and
id|lifetime
)paren
(brace
id|ND_PRINTK3
c_func
(paren
id|KERN_DEBUG
l_string|&quot;ICMPv6 RA: adding default router.&bslash;n&quot;
)paren
suffix:semicolon
id|rt
op_assign
id|rt6_add_dflt_router
c_func
(paren
op_amp
id|skb-&gt;nh.ipv6h-&gt;saddr
comma
id|skb-&gt;dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rt
op_eq
l_int|NULL
)paren
(brace
id|ND_PRINTK0
c_func
(paren
id|KERN_ERR
l_string|&quot;ICMPv6 RA: %s() failed to add default route.&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|in6_dev_put
c_func
(paren
id|in6_dev
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|neigh
op_assign
id|rt-&gt;rt6i_nexthop
suffix:semicolon
r_if
c_cond
(paren
id|neigh
op_eq
l_int|NULL
)paren
(brace
id|ND_PRINTK0
c_func
(paren
id|KERN_ERR
l_string|&quot;ICMPv6 RA: %s() got default router without neighbour.&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|dst_release
c_func
(paren
op_amp
id|rt-&gt;u.dst
)paren
suffix:semicolon
id|in6_dev_put
c_func
(paren
id|in6_dev
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|neigh-&gt;flags
op_or_assign
id|NTF_ROUTER
suffix:semicolon
)brace
r_if
c_cond
(paren
id|rt
)paren
id|rt-&gt;rt6i_expires
op_assign
id|jiffies
op_plus
(paren
id|HZ
op_star
id|lifetime
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ra_msg-&gt;icmph.icmp6_hop_limit
)paren
id|in6_dev-&gt;cnf.hop_limit
op_assign
id|ra_msg-&gt;icmph.icmp6_hop_limit
suffix:semicolon
multiline_comment|/*&n;&t; *&t;Update Reachable Time and Retrans Timer&n;&t; */
r_if
c_cond
(paren
id|in6_dev-&gt;nd_parms
)paren
(brace
r_int
r_int
id|rtime
op_assign
id|ntohl
c_func
(paren
id|ra_msg-&gt;retrans_timer
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rtime
op_logical_and
id|rtime
op_div
l_int|1000
OL
id|MAX_SCHEDULE_TIMEOUT
op_div
id|HZ
)paren
(brace
id|rtime
op_assign
(paren
id|rtime
op_star
id|HZ
)paren
op_div
l_int|1000
suffix:semicolon
r_if
c_cond
(paren
id|rtime
OL
id|HZ
op_div
l_int|10
)paren
id|rtime
op_assign
id|HZ
op_div
l_int|10
suffix:semicolon
id|in6_dev-&gt;nd_parms-&gt;retrans_time
op_assign
id|rtime
suffix:semicolon
id|in6_dev-&gt;tstamp
op_assign
id|jiffies
suffix:semicolon
id|inet6_ifinfo_notify
c_func
(paren
id|RTM_NEWLINK
comma
id|in6_dev
)paren
suffix:semicolon
)brace
id|rtime
op_assign
id|ntohl
c_func
(paren
id|ra_msg-&gt;reachable_time
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rtime
op_logical_and
id|rtime
op_div
l_int|1000
OL
id|MAX_SCHEDULE_TIMEOUT
op_div
(paren
l_int|3
op_star
id|HZ
)paren
)paren
(brace
id|rtime
op_assign
(paren
id|rtime
op_star
id|HZ
)paren
op_div
l_int|1000
suffix:semicolon
r_if
c_cond
(paren
id|rtime
OL
id|HZ
op_div
l_int|10
)paren
id|rtime
op_assign
id|HZ
op_div
l_int|10
suffix:semicolon
r_if
c_cond
(paren
id|rtime
op_ne
id|in6_dev-&gt;nd_parms-&gt;base_reachable_time
)paren
(brace
id|in6_dev-&gt;nd_parms-&gt;base_reachable_time
op_assign
id|rtime
suffix:semicolon
id|in6_dev-&gt;nd_parms-&gt;gc_staletime
op_assign
l_int|3
op_star
id|rtime
suffix:semicolon
id|in6_dev-&gt;nd_parms-&gt;reachable_time
op_assign
id|neigh_rand_reach_time
c_func
(paren
id|rtime
)paren
suffix:semicolon
id|in6_dev-&gt;tstamp
op_assign
id|jiffies
suffix:semicolon
id|inet6_ifinfo_notify
c_func
(paren
id|RTM_NEWLINK
comma
id|in6_dev
)paren
suffix:semicolon
)brace
)brace
)brace
multiline_comment|/*&n;&t; *&t;Process options.&n;&t; */
r_if
c_cond
(paren
op_logical_neg
id|neigh
)paren
id|neigh
op_assign
id|__neigh_lookup
c_func
(paren
op_amp
id|nd_tbl
comma
op_amp
id|skb-&gt;nh.ipv6h-&gt;saddr
comma
id|skb-&gt;dev
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|neigh
)paren
(brace
id|u8
op_star
id|lladdr
op_assign
l_int|NULL
suffix:semicolon
r_int
id|lladdrlen
suffix:semicolon
r_if
c_cond
(paren
id|ndopts.nd_opts_src_lladdr
)paren
(brace
id|lladdr
op_assign
(paren
id|u8
op_star
)paren
(paren
(paren
id|ndopts.nd_opts_src_lladdr
)paren
op_plus
l_int|1
)paren
suffix:semicolon
id|lladdrlen
op_assign
id|ndopts.nd_opts_src_lladdr-&gt;nd_opt_len
op_lshift
l_int|3
suffix:semicolon
r_if
c_cond
(paren
id|lladdrlen
op_ne
id|NDISC_OPT_SPACE
c_func
(paren
id|skb-&gt;dev-&gt;addr_len
)paren
)paren
(brace
id|ND_PRINTK2
c_func
(paren
id|KERN_WARNING
l_string|&quot;ICMPv6 RA: invalid link-layer address length&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
)brace
id|neigh_update
c_func
(paren
id|neigh
comma
id|lladdr
comma
id|NUD_STALE
comma
id|NEIGH_UPDATE_F_WEAK_OVERRIDE
op_or
id|NEIGH_UPDATE_F_OVERRIDE
op_or
id|NEIGH_UPDATE_F_OVERRIDE_ISROUTER
op_or
id|NEIGH_UPDATE_F_ISROUTER
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ndopts.nd_opts_pi
)paren
(brace
r_struct
id|nd_opt_hdr
op_star
id|p
suffix:semicolon
r_for
c_loop
(paren
id|p
op_assign
id|ndopts.nd_opts_pi
suffix:semicolon
id|p
suffix:semicolon
id|p
op_assign
id|ndisc_next_option
c_func
(paren
id|p
comma
id|ndopts.nd_opts_pi_end
)paren
)paren
(brace
id|addrconf_prefix_rcv
c_func
(paren
id|skb-&gt;dev
comma
(paren
id|u8
op_star
)paren
id|p
comma
(paren
id|p-&gt;nd_opt_len
)paren
op_lshift
l_int|3
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|ndopts.nd_opts_mtu
)paren
(brace
id|u32
id|mtu
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|mtu
comma
(paren
(paren
id|u8
op_star
)paren
(paren
id|ndopts.nd_opts_mtu
op_plus
l_int|1
)paren
)paren
op_plus
l_int|2
comma
r_sizeof
(paren
id|mtu
)paren
)paren
suffix:semicolon
id|mtu
op_assign
id|ntohl
c_func
(paren
id|mtu
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mtu
template_param
id|skb-&gt;dev-&gt;mtu
)paren
(brace
id|ND_PRINTK2
c_func
(paren
id|KERN_WARNING
l_string|&quot;ICMPv6 RA: invalid mtu: %d&bslash;n&quot;
comma
id|mtu
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|in6_dev-&gt;cnf.mtu6
op_ne
id|mtu
)paren
(brace
id|in6_dev-&gt;cnf.mtu6
op_assign
id|mtu
suffix:semicolon
r_if
c_cond
(paren
id|rt
)paren
id|rt-&gt;u.dst.metrics
(braket
id|RTAX_MTU
op_minus
l_int|1
)braket
op_assign
id|mtu
suffix:semicolon
id|rt6_mtu_change
c_func
(paren
id|skb-&gt;dev
comma
id|mtu
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|ndopts.nd_opts_tgt_lladdr
op_logical_or
id|ndopts.nd_opts_rh
)paren
(brace
id|ND_PRINTK2
c_func
(paren
id|KERN_WARNING
l_string|&quot;ICMPv6 RA: invalid RA options&quot;
)paren
suffix:semicolon
)brace
id|out
suffix:colon
r_if
c_cond
(paren
id|rt
)paren
id|dst_release
c_func
(paren
op_amp
id|rt-&gt;u.dst
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|neigh
)paren
id|neigh_release
c_func
(paren
id|neigh
)paren
suffix:semicolon
id|in6_dev_put
c_func
(paren
id|in6_dev
)paren
suffix:semicolon
)brace
DECL|function|ndisc_redirect_rcv
r_static
r_void
id|ndisc_redirect_rcv
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|inet6_dev
op_star
id|in6_dev
suffix:semicolon
r_struct
id|icmp6hdr
op_star
id|icmph
suffix:semicolon
r_struct
id|in6_addr
op_star
id|dest
suffix:semicolon
r_struct
id|in6_addr
op_star
id|target
suffix:semicolon
multiline_comment|/* new first hop to destination */
r_struct
id|neighbour
op_star
id|neigh
suffix:semicolon
r_int
id|on_link
op_assign
l_int|0
suffix:semicolon
r_struct
id|ndisc_options
id|ndopts
suffix:semicolon
r_int
id|optlen
suffix:semicolon
id|u8
op_star
id|lladdr
op_assign
l_int|NULL
suffix:semicolon
r_int
id|lladdrlen
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|ipv6_addr_type
c_func
(paren
op_amp
id|skb-&gt;nh.ipv6h-&gt;saddr
)paren
op_amp
id|IPV6_ADDR_LINKLOCAL
)paren
)paren
(brace
id|ND_PRINTK2
c_func
(paren
id|KERN_WARNING
l_string|&quot;ICMPv6 Redirect: source address is not link-local.&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|optlen
op_assign
id|skb-&gt;tail
op_minus
id|skb-&gt;h.raw
suffix:semicolon
id|optlen
op_sub_assign
r_sizeof
(paren
r_struct
id|icmp6hdr
)paren
op_plus
l_int|2
op_star
r_sizeof
(paren
r_struct
id|in6_addr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|optlen
OL
l_int|0
)paren
(brace
id|ND_PRINTK2
c_func
(paren
id|KERN_WARNING
l_string|&quot;ICMPv6 Redirect: packet too short&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|icmph
op_assign
(paren
r_struct
id|icmp6hdr
op_star
)paren
id|skb-&gt;h.raw
suffix:semicolon
id|target
op_assign
(paren
r_struct
id|in6_addr
op_star
)paren
(paren
id|icmph
op_plus
l_int|1
)paren
suffix:semicolon
id|dest
op_assign
id|target
op_plus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|ipv6_addr_is_multicast
c_func
(paren
id|dest
)paren
)paren
(brace
id|ND_PRINTK2
c_func
(paren
id|KERN_WARNING
l_string|&quot;ICMPv6 Redirect: destination address is multicast.&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ipv6_addr_equal
c_func
(paren
id|dest
comma
id|target
)paren
)paren
(brace
id|on_link
op_assign
l_int|1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
(paren
id|ipv6_addr_type
c_func
(paren
id|target
)paren
op_amp
id|IPV6_ADDR_LINKLOCAL
)paren
)paren
(brace
id|ND_PRINTK2
c_func
(paren
id|KERN_WARNING
l_string|&quot;ICMPv6 Redirect: target address is not link-local.&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|in6_dev
op_assign
id|in6_dev_get
c_func
(paren
id|skb-&gt;dev
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|in6_dev
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|in6_dev-&gt;cnf.forwarding
op_logical_or
op_logical_neg
id|in6_dev-&gt;cnf.accept_redirects
)paren
(brace
id|in6_dev_put
c_func
(paren
id|in6_dev
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/* RFC2461 8.1: &n;&t; *&t;The IP source address of the Redirect MUST be the same as the current&n;&t; *&t;first-hop router for the specified ICMP Destination Address.&n;&t; */
r_if
c_cond
(paren
op_logical_neg
id|ndisc_parse_options
c_func
(paren
(paren
id|u8
op_star
)paren
(paren
id|dest
op_plus
l_int|1
)paren
comma
id|optlen
comma
op_amp
id|ndopts
)paren
)paren
(brace
id|ND_PRINTK2
c_func
(paren
id|KERN_WARNING
l_string|&quot;ICMPv6 Redirect: invalid ND options&bslash;n&quot;
)paren
suffix:semicolon
id|in6_dev_put
c_func
(paren
id|in6_dev
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ndopts.nd_opts_tgt_lladdr
)paren
(brace
id|lladdr
op_assign
(paren
id|u8
op_star
)paren
(paren
id|ndopts.nd_opts_tgt_lladdr
op_plus
l_int|1
)paren
suffix:semicolon
id|lladdrlen
op_assign
id|ndopts.nd_opts_tgt_lladdr-&gt;nd_opt_len
op_lshift
l_int|3
suffix:semicolon
r_if
c_cond
(paren
id|lladdrlen
op_ne
id|NDISC_OPT_SPACE
c_func
(paren
id|skb-&gt;dev-&gt;addr_len
)paren
)paren
(brace
id|ND_PRINTK2
c_func
(paren
id|KERN_WARNING
l_string|&quot;ICMPv6 Redirect: invalid link-layer address length&bslash;n&quot;
)paren
suffix:semicolon
id|in6_dev_put
c_func
(paren
id|in6_dev
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
)brace
id|neigh
op_assign
id|__neigh_lookup
c_func
(paren
op_amp
id|nd_tbl
comma
id|target
comma
id|skb-&gt;dev
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|neigh
)paren
(brace
id|rt6_redirect
c_func
(paren
id|dest
comma
op_amp
id|skb-&gt;nh.ipv6h-&gt;saddr
comma
id|neigh
comma
id|lladdr
comma
id|on_link
)paren
suffix:semicolon
id|neigh_release
c_func
(paren
id|neigh
)paren
suffix:semicolon
)brace
id|in6_dev_put
c_func
(paren
id|in6_dev
)paren
suffix:semicolon
)brace
DECL|function|ndisc_send_redirect
r_void
id|ndisc_send_redirect
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|neighbour
op_star
id|neigh
comma
r_struct
id|in6_addr
op_star
id|target
)paren
(brace
r_struct
id|sock
op_star
id|sk
op_assign
id|ndisc_socket-&gt;sk
suffix:semicolon
r_int
id|len
op_assign
r_sizeof
(paren
r_struct
id|icmp6hdr
)paren
op_plus
l_int|2
op_star
r_sizeof
(paren
r_struct
id|in6_addr
)paren
suffix:semicolon
r_struct
id|sk_buff
op_star
id|buff
suffix:semicolon
r_struct
id|icmp6hdr
op_star
id|icmph
suffix:semicolon
r_struct
id|in6_addr
id|saddr_buf
suffix:semicolon
r_struct
id|in6_addr
op_star
id|addrp
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
suffix:semicolon
r_struct
id|rt6_info
op_star
id|rt
suffix:semicolon
r_struct
id|dst_entry
op_star
id|dst
suffix:semicolon
r_struct
id|inet6_dev
op_star
id|idev
suffix:semicolon
r_struct
id|flowi
id|fl
suffix:semicolon
id|u8
op_star
id|opt
suffix:semicolon
r_int
id|rd_len
suffix:semicolon
r_int
id|err
suffix:semicolon
r_int
id|hlen
suffix:semicolon
id|dev
op_assign
id|skb-&gt;dev
suffix:semicolon
r_if
c_cond
(paren
id|ipv6_get_lladdr
c_func
(paren
id|dev
comma
op_amp
id|saddr_buf
)paren
)paren
(brace
id|ND_PRINTK2
c_func
(paren
id|KERN_WARNING
l_string|&quot;ICMPv6 Redirect: no link-local address on %s&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|ndisc_flow_init
c_func
(paren
op_amp
id|fl
comma
id|NDISC_REDIRECT
comma
op_amp
id|saddr_buf
comma
op_amp
id|skb-&gt;nh.ipv6h-&gt;saddr
)paren
suffix:semicolon
id|rt
op_assign
id|rt6_lookup
c_func
(paren
op_amp
id|skb-&gt;nh.ipv6h-&gt;saddr
comma
l_int|NULL
comma
id|dev-&gt;ifindex
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rt
op_eq
l_int|NULL
)paren
r_return
suffix:semicolon
id|dst
op_assign
op_amp
id|rt-&gt;u.dst
suffix:semicolon
id|err
op_assign
id|xfrm_lookup
c_func
(paren
op_amp
id|dst
comma
op_amp
id|fl
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|dst_release
c_func
(paren
id|dst
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|rt
op_assign
(paren
r_struct
id|rt6_info
op_star
)paren
id|dst
suffix:semicolon
r_if
c_cond
(paren
id|rt-&gt;rt6i_flags
op_amp
id|RTF_GATEWAY
)paren
(brace
id|ND_PRINTK2
c_func
(paren
id|KERN_WARNING
l_string|&quot;ICMPv6 Redirect: destination is not a neighbour.&bslash;n&quot;
)paren
suffix:semicolon
id|dst_release
c_func
(paren
id|dst
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|xrlim_allow
c_func
(paren
id|dst
comma
l_int|1
op_star
id|HZ
)paren
)paren
(brace
id|dst_release
c_func
(paren
id|dst
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dev-&gt;addr_len
)paren
(brace
r_if
c_cond
(paren
id|neigh-&gt;nud_state
op_amp
id|NUD_VALID
)paren
(brace
id|len
op_add_assign
id|NDISC_OPT_SPACE
c_func
(paren
id|dev-&gt;addr_len
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* If nexthop is not valid, do not redirect!&n;&t;&t;&t;   We will make it later, when will be sure,&n;&t;&t;&t;   that it is alive.&n;&t;&t;&t; */
id|dst_release
c_func
(paren
id|dst
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
)brace
id|rd_len
op_assign
id|min_t
c_func
(paren
r_int
r_int
comma
id|IPV6_MIN_MTU
op_minus
r_sizeof
(paren
r_struct
id|ipv6hdr
)paren
op_minus
id|len
comma
id|skb-&gt;len
op_plus
l_int|8
)paren
suffix:semicolon
id|rd_len
op_and_assign
op_complement
l_int|0x7
suffix:semicolon
id|len
op_add_assign
id|rd_len
suffix:semicolon
id|buff
op_assign
id|sock_alloc_send_skb
c_func
(paren
id|sk
comma
id|MAX_HEADER
op_plus
id|len
op_plus
id|LL_RESERVED_SPACE
c_func
(paren
id|dev
)paren
comma
l_int|1
comma
op_amp
id|err
)paren
suffix:semicolon
r_if
c_cond
(paren
id|buff
op_eq
l_int|NULL
)paren
(brace
id|ND_PRINTK0
c_func
(paren
id|KERN_ERR
l_string|&quot;ICMPv6 Redirect: %s() failed to allocate an skb.&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|dst_release
c_func
(paren
id|dst
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|hlen
op_assign
l_int|0
suffix:semicolon
id|skb_reserve
c_func
(paren
id|buff
comma
id|LL_RESERVED_SPACE
c_func
(paren
id|dev
)paren
)paren
suffix:semicolon
id|ip6_nd_hdr
c_func
(paren
id|sk
comma
id|buff
comma
id|dev
comma
op_amp
id|saddr_buf
comma
op_amp
id|skb-&gt;nh.ipv6h-&gt;saddr
comma
id|IPPROTO_ICMPV6
comma
id|len
)paren
suffix:semicolon
id|icmph
op_assign
(paren
r_struct
id|icmp6hdr
op_star
)paren
id|skb_put
c_func
(paren
id|buff
comma
id|len
)paren
suffix:semicolon
id|buff-&gt;h.raw
op_assign
(paren
r_int
r_char
op_star
)paren
id|icmph
suffix:semicolon
id|memset
c_func
(paren
id|icmph
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|icmp6hdr
)paren
)paren
suffix:semicolon
id|icmph-&gt;icmp6_type
op_assign
id|NDISC_REDIRECT
suffix:semicolon
multiline_comment|/*&n;&t; *&t;copy target and destination addresses&n;&t; */
id|addrp
op_assign
(paren
r_struct
id|in6_addr
op_star
)paren
(paren
id|icmph
op_plus
l_int|1
)paren
suffix:semicolon
id|ipv6_addr_copy
c_func
(paren
id|addrp
comma
id|target
)paren
suffix:semicolon
id|addrp
op_increment
suffix:semicolon
id|ipv6_addr_copy
c_func
(paren
id|addrp
comma
op_amp
id|skb-&gt;nh.ipv6h-&gt;daddr
)paren
suffix:semicolon
id|opt
op_assign
(paren
id|u8
op_star
)paren
(paren
id|addrp
op_plus
l_int|1
)paren
suffix:semicolon
multiline_comment|/*&n;&t; *&t;include target_address option&n;&t; */
r_if
c_cond
(paren
id|dev-&gt;addr_len
)paren
id|opt
op_assign
id|ndisc_fill_option
c_func
(paren
id|opt
comma
id|ND_OPT_TARGET_LL_ADDR
comma
id|neigh-&gt;ha
comma
id|dev-&gt;addr_len
)paren
suffix:semicolon
multiline_comment|/*&n;&t; *&t;build redirect option and copy skb over to the new packet.&n;&t; */
id|memset
c_func
(paren
id|opt
comma
l_int|0
comma
l_int|8
)paren
suffix:semicolon
op_star
(paren
id|opt
op_increment
)paren
op_assign
id|ND_OPT_REDIRECT_HDR
suffix:semicolon
op_star
(paren
id|opt
op_increment
)paren
op_assign
(paren
id|rd_len
op_rshift
l_int|3
)paren
suffix:semicolon
id|opt
op_add_assign
l_int|6
suffix:semicolon
id|memcpy
c_func
(paren
id|opt
comma
id|skb-&gt;nh.ipv6h
comma
id|rd_len
op_minus
l_int|8
)paren
suffix:semicolon
id|icmph-&gt;icmp6_cksum
op_assign
id|csum_ipv6_magic
c_func
(paren
op_amp
id|saddr_buf
comma
op_amp
id|skb-&gt;nh.ipv6h-&gt;saddr
comma
id|len
comma
id|IPPROTO_ICMPV6
comma
id|csum_partial
c_func
(paren
(paren
id|u8
op_star
)paren
id|icmph
comma
id|len
comma
l_int|0
)paren
)paren
suffix:semicolon
id|buff-&gt;dst
op_assign
id|dst
suffix:semicolon
id|idev
op_assign
id|in6_dev_get
c_func
(paren
id|dst-&gt;dev
)paren
suffix:semicolon
id|IP6_INC_STATS
c_func
(paren
id|IPSTATS_MIB_OUTREQUESTS
)paren
suffix:semicolon
id|err
op_assign
id|NF_HOOK
c_func
(paren
id|PF_INET6
comma
id|NF_IP6_LOCAL_OUT
comma
id|buff
comma
l_int|NULL
comma
id|dst-&gt;dev
comma
id|dst_output
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|err
)paren
(brace
id|ICMP6_INC_STATS
c_func
(paren
id|idev
comma
id|ICMP6_MIB_OUTREDIRECTS
)paren
suffix:semicolon
id|ICMP6_INC_STATS
c_func
(paren
id|idev
comma
id|ICMP6_MIB_OUTMSGS
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|likely
c_func
(paren
id|idev
op_ne
l_int|NULL
)paren
)paren
id|in6_dev_put
c_func
(paren
id|idev
)paren
suffix:semicolon
)brace
DECL|function|pndisc_redo
r_static
r_void
id|pndisc_redo
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
id|ndisc_rcv
c_func
(paren
id|skb
)paren
suffix:semicolon
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
DECL|function|ndisc_rcv
r_int
id|ndisc_rcv
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|nd_msg
op_star
id|msg
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pskb_may_pull
c_func
(paren
id|skb
comma
id|skb-&gt;len
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|msg
op_assign
(paren
r_struct
id|nd_msg
op_star
)paren
id|skb-&gt;h.raw
suffix:semicolon
id|__skb_push
c_func
(paren
id|skb
comma
id|skb-&gt;data
op_minus
id|skb-&gt;h.raw
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb-&gt;nh.ipv6h-&gt;hop_limit
op_ne
l_int|255
)paren
(brace
id|ND_PRINTK2
c_func
(paren
id|KERN_WARNING
l_string|&quot;ICMPv6 NDISC: invalid hop-limit: %d&bslash;n&quot;
comma
id|skb-&gt;nh.ipv6h-&gt;hop_limit
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|msg-&gt;icmph.icmp6_code
op_ne
l_int|0
)paren
(brace
id|ND_PRINTK2
c_func
(paren
id|KERN_WARNING
l_string|&quot;ICMPv6 NDISC: invalid ICMPv6 code: %d&bslash;n&quot;
comma
id|msg-&gt;icmph.icmp6_code
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|msg-&gt;icmph.icmp6_type
)paren
(brace
r_case
id|NDISC_NEIGHBOUR_SOLICITATION
suffix:colon
id|ndisc_recv_ns
c_func
(paren
id|skb
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|NDISC_NEIGHBOUR_ADVERTISEMENT
suffix:colon
id|ndisc_recv_na
c_func
(paren
id|skb
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|NDISC_ROUTER_SOLICITATION
suffix:colon
id|ndisc_recv_rs
c_func
(paren
id|skb
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|NDISC_ROUTER_ADVERTISEMENT
suffix:colon
id|ndisc_router_discovery
c_func
(paren
id|skb
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|NDISC_REDIRECT
suffix:colon
id|ndisc_redirect_rcv
c_func
(paren
id|skb
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|ndisc_netdev_event
r_static
r_int
id|ndisc_netdev_event
c_func
(paren
r_struct
id|notifier_block
op_star
id|this
comma
r_int
r_int
id|event
comma
r_void
op_star
id|ptr
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
id|ptr
suffix:semicolon
r_switch
c_cond
(paren
id|event
)paren
(brace
r_case
id|NETDEV_CHANGEADDR
suffix:colon
id|neigh_changeaddr
c_func
(paren
op_amp
id|nd_tbl
comma
id|dev
)paren
suffix:semicolon
id|fib6_run_gc
c_func
(paren
l_int|0
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|NETDEV_DOWN
suffix:colon
id|neigh_ifdown
c_func
(paren
op_amp
id|nd_tbl
comma
id|dev
)paren
suffix:semicolon
id|fib6_run_gc
c_func
(paren
l_int|0
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_break
suffix:semicolon
)brace
r_return
id|NOTIFY_DONE
suffix:semicolon
)brace
DECL|variable|ndisc_netdev_notifier
r_static
r_struct
id|notifier_block
id|ndisc_netdev_notifier
op_assign
(brace
dot
id|notifier_call
op_assign
id|ndisc_netdev_event
comma
)brace
suffix:semicolon
macro_line|#ifdef CONFIG_SYSCTL
DECL|function|ndisc_ifinfo_sysctl_change
r_int
id|ndisc_ifinfo_sysctl_change
c_func
(paren
r_struct
id|ctl_table
op_star
id|ctl
comma
r_int
id|write
comma
r_struct
id|file
op_star
id|filp
comma
r_void
id|__user
op_star
id|buffer
comma
r_int
op_star
id|lenp
comma
id|loff_t
op_star
id|ppos
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
id|ctl-&gt;extra1
suffix:semicolon
r_struct
id|inet6_dev
op_star
id|idev
suffix:semicolon
r_if
c_cond
(paren
id|write
op_logical_and
id|dev
op_logical_and
(paren
id|idev
op_assign
id|in6_dev_get
c_func
(paren
id|dev
)paren
)paren
op_ne
l_int|NULL
)paren
(brace
id|idev-&gt;tstamp
op_assign
id|jiffies
suffix:semicolon
id|inet6_ifinfo_notify
c_func
(paren
id|RTM_NEWLINK
comma
id|idev
)paren
suffix:semicolon
id|in6_dev_put
c_func
(paren
id|idev
)paren
suffix:semicolon
)brace
r_return
id|proc_dointvec
c_func
(paren
id|ctl
comma
id|write
comma
id|filp
comma
id|buffer
comma
id|lenp
comma
id|ppos
)paren
suffix:semicolon
)brace
macro_line|#endif
DECL|function|ndisc_init
r_int
id|__init
id|ndisc_init
c_func
(paren
r_struct
id|net_proto_family
op_star
id|ops
)paren
(brace
r_struct
id|ipv6_pinfo
op_star
id|np
suffix:semicolon
r_struct
id|sock
op_star
id|sk
suffix:semicolon
r_int
id|err
suffix:semicolon
id|err
op_assign
id|sock_create_kern
c_func
(paren
id|PF_INET6
comma
id|SOCK_RAW
comma
id|IPPROTO_ICMPV6
comma
op_amp
id|ndisc_socket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
(brace
id|ND_PRINTK0
c_func
(paren
id|KERN_ERR
l_string|&quot;ICMPv6 NDISC: Failed to initialize the control socket (err %d).&bslash;n&quot;
comma
id|err
)paren
suffix:semicolon
id|ndisc_socket
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/* For safety. */
r_return
id|err
suffix:semicolon
)brace
id|sk
op_assign
id|ndisc_socket-&gt;sk
suffix:semicolon
id|np
op_assign
id|inet6_sk
c_func
(paren
id|sk
)paren
suffix:semicolon
id|sk-&gt;sk_allocation
op_assign
id|GFP_ATOMIC
suffix:semicolon
id|np-&gt;hop_limit
op_assign
l_int|255
suffix:semicolon
multiline_comment|/* Do not loopback ndisc messages */
id|np-&gt;mc_loop
op_assign
l_int|0
suffix:semicolon
id|sk-&gt;sk_prot
op_member_access_from_pointer
id|unhash
c_func
(paren
id|sk
)paren
suffix:semicolon
multiline_comment|/*&n;         * Initialize the neighbour table&n;         */
id|neigh_table_init
c_func
(paren
op_amp
id|nd_tbl
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_SYSCTL
id|neigh_sysctl_register
c_func
(paren
l_int|NULL
comma
op_amp
id|nd_tbl.parms
comma
id|NET_IPV6
comma
id|NET_IPV6_NEIGH
comma
l_string|&quot;ipv6&quot;
comma
op_amp
id|ndisc_ifinfo_sysctl_change
)paren
suffix:semicolon
macro_line|#endif
id|register_netdevice_notifier
c_func
(paren
op_amp
id|ndisc_netdev_notifier
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|ndisc_cleanup
r_void
id|ndisc_cleanup
c_func
(paren
r_void
)paren
(brace
macro_line|#ifdef CONFIG_SYSCTL
id|neigh_sysctl_unregister
c_func
(paren
op_amp
id|nd_tbl.parms
)paren
suffix:semicolon
macro_line|#endif
id|neigh_table_clear
c_func
(paren
op_amp
id|nd_tbl
)paren
suffix:semicolon
id|sock_release
c_func
(paren
id|ndisc_socket
)paren
suffix:semicolon
id|ndisc_socket
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/* For safety. */
)brace
eof
