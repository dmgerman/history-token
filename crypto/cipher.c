multiline_comment|/*&n; * Cryptographic API.&n; *&n; * Cipher operations.&n; *&n; * Copyright (c) 2002 James Morris &lt;jmorris@intercode.com.au&gt;&n; * Generic scatterwalk code by Adam J. Richter &lt;adam@yggdrasil.com&gt;.&n; *&n; * This program is free software; you can redistribute it and/or modify it&n; * under the terms of the GNU General Public License as published by the Free&n; * Software Foundation; either version 2 of the License, or (at your option) &n; * any later version.&n; *&n; */
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/crypto.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/pagemap.h&gt;
macro_line|#include &lt;linux/highmem.h&gt;
macro_line|#include &lt;asm/scatterlist.h&gt;
macro_line|#include &quot;internal.h&quot;
DECL|typedef|cryptfn_t
r_typedef
r_void
(paren
id|cryptfn_t
)paren
(paren
r_void
op_star
comma
id|u8
op_star
comma
r_const
id|u8
op_star
)paren
suffix:semicolon
DECL|typedef|procfn_t
r_typedef
r_void
(paren
id|procfn_t
)paren
(paren
r_struct
id|crypto_tfm
op_star
comma
id|u8
op_star
comma
id|u8
op_star
comma
id|cryptfn_t
comma
r_int
id|enc
)paren
suffix:semicolon
DECL|struct|scatter_walk
r_struct
id|scatter_walk
(brace
DECL|member|sg
r_struct
id|scatterlist
op_star
id|sg
suffix:semicolon
DECL|member|page
r_struct
id|page
op_star
id|page
suffix:semicolon
DECL|member|data
r_void
op_star
id|data
suffix:semicolon
DECL|member|len_this_page
r_int
r_int
id|len_this_page
suffix:semicolon
DECL|member|len_this_segment
r_int
r_int
id|len_this_segment
suffix:semicolon
DECL|member|offset
r_int
r_int
id|offset
suffix:semicolon
)brace
suffix:semicolon
DECL|variable|crypto_km_types
r_enum
id|km_type
id|crypto_km_types
(braket
)braket
op_assign
(brace
id|KM_USER0
comma
id|KM_USER1
comma
id|KM_SOFTIRQ0
comma
id|KM_SOFTIRQ1
comma
)brace
suffix:semicolon
DECL|function|xor_64
r_static
r_inline
r_void
id|xor_64
c_func
(paren
id|u8
op_star
id|a
comma
r_const
id|u8
op_star
id|b
)paren
(brace
(paren
(paren
id|u32
op_star
)paren
id|a
)paren
(braket
l_int|0
)braket
op_xor_assign
(paren
(paren
id|u32
op_star
)paren
id|b
)paren
(braket
l_int|0
)braket
suffix:semicolon
(paren
(paren
id|u32
op_star
)paren
id|a
)paren
(braket
l_int|1
)braket
op_xor_assign
(paren
(paren
id|u32
op_star
)paren
id|b
)paren
(braket
l_int|1
)braket
suffix:semicolon
)brace
DECL|function|xor_128
r_static
r_inline
r_void
id|xor_128
c_func
(paren
id|u8
op_star
id|a
comma
r_const
id|u8
op_star
id|b
)paren
(brace
(paren
(paren
id|u32
op_star
)paren
id|a
)paren
(braket
l_int|0
)braket
op_xor_assign
(paren
(paren
id|u32
op_star
)paren
id|b
)paren
(braket
l_int|0
)braket
suffix:semicolon
(paren
(paren
id|u32
op_star
)paren
id|a
)paren
(braket
l_int|1
)braket
op_xor_assign
(paren
(paren
id|u32
op_star
)paren
id|b
)paren
(braket
l_int|1
)braket
suffix:semicolon
(paren
(paren
id|u32
op_star
)paren
id|a
)paren
(braket
l_int|2
)braket
op_xor_assign
(paren
(paren
id|u32
op_star
)paren
id|b
)paren
(braket
l_int|2
)braket
suffix:semicolon
(paren
(paren
id|u32
op_star
)paren
id|a
)paren
(braket
l_int|3
)braket
op_xor_assign
(paren
(paren
id|u32
op_star
)paren
id|b
)paren
(braket
l_int|3
)braket
suffix:semicolon
)brace
multiline_comment|/* Define sg_next is an inline routine now in case we want to change&n;   scatterlist to a linked list later. */
DECL|function|sg_next
r_static
r_inline
r_struct
id|scatterlist
op_star
id|sg_next
c_func
(paren
r_struct
id|scatterlist
op_star
id|sg
)paren
(brace
r_return
id|sg
op_plus
l_int|1
suffix:semicolon
)brace
DECL|function|which_buf
r_void
op_star
id|which_buf
c_func
(paren
r_struct
id|scatter_walk
op_star
id|walk
comma
r_int
r_int
id|nbytes
comma
r_void
op_star
id|scratch
)paren
(brace
r_if
c_cond
(paren
id|nbytes
op_le
id|walk-&gt;len_this_page
op_logical_and
(paren
(paren
(paren
r_int
r_int
)paren
id|walk-&gt;data
)paren
op_amp
(paren
id|PAGE_CACHE_SIZE
op_minus
l_int|1
)paren
)paren
op_plus
id|nbytes
op_le
id|PAGE_CACHE_SIZE
)paren
r_return
id|walk-&gt;data
suffix:semicolon
r_else
r_return
id|scratch
suffix:semicolon
)brace
DECL|function|memcpy_dir
r_static
r_void
id|memcpy_dir
c_func
(paren
r_void
op_star
id|buf
comma
r_void
op_star
id|sgdata
comma
r_int
id|nbytes
comma
r_int
id|out
)paren
(brace
r_if
c_cond
(paren
id|out
)paren
id|memcpy
c_func
(paren
id|sgdata
comma
id|buf
comma
id|nbytes
)paren
suffix:semicolon
r_else
id|memcpy
c_func
(paren
id|buf
comma
id|sgdata
comma
id|nbytes
)paren
suffix:semicolon
)brace
DECL|function|scatterwalk_start
r_static
r_void
id|scatterwalk_start
c_func
(paren
r_struct
id|scatter_walk
op_star
id|walk
comma
r_struct
id|scatterlist
op_star
id|sg
)paren
(brace
r_int
r_int
id|rest_of_page
suffix:semicolon
id|walk-&gt;sg
op_assign
id|sg
suffix:semicolon
id|walk-&gt;page
op_assign
id|sg-&gt;page
suffix:semicolon
id|walk-&gt;len_this_segment
op_assign
id|sg-&gt;length
suffix:semicolon
id|rest_of_page
op_assign
id|PAGE_CACHE_SIZE
op_minus
(paren
id|sg-&gt;offset
op_amp
(paren
id|PAGE_CACHE_SIZE
op_minus
l_int|1
)paren
)paren
suffix:semicolon
id|walk-&gt;len_this_page
op_assign
id|min
c_func
(paren
id|sg-&gt;length
comma
id|rest_of_page
)paren
suffix:semicolon
id|walk-&gt;offset
op_assign
id|sg-&gt;offset
suffix:semicolon
)brace
DECL|function|scatterwalk_map
r_static
r_void
id|scatterwalk_map
c_func
(paren
r_struct
id|scatter_walk
op_star
id|walk
comma
r_int
id|out
)paren
(brace
id|walk-&gt;data
op_assign
id|crypto_kmap
c_func
(paren
id|walk-&gt;page
comma
id|out
)paren
op_plus
id|walk-&gt;offset
suffix:semicolon
)brace
DECL|function|scatter_page_done
r_static
r_void
id|scatter_page_done
c_func
(paren
r_struct
id|scatter_walk
op_star
id|walk
comma
r_int
id|out
comma
r_int
r_int
id|more
)paren
(brace
multiline_comment|/* walk-&gt;data may be pointing the first byte of the next page;&n;&t;   however, we know we transfered at least one byte.  So,&n;&t;   walk-&gt;data - 1 will be a virutual address in the mapped page. */
r_if
c_cond
(paren
id|out
)paren
id|flush_dcache_page
c_func
(paren
id|walk-&gt;page
)paren
suffix:semicolon
r_if
c_cond
(paren
id|more
)paren
(brace
id|walk-&gt;len_this_segment
op_sub_assign
id|walk-&gt;len_this_page
suffix:semicolon
r_if
c_cond
(paren
id|walk-&gt;len_this_segment
)paren
(brace
id|walk-&gt;page
op_increment
suffix:semicolon
id|walk-&gt;len_this_page
op_assign
id|min
c_func
(paren
id|walk-&gt;len_this_segment
comma
(paren
r_int
)paren
id|PAGE_CACHE_SIZE
)paren
suffix:semicolon
id|walk-&gt;offset
op_assign
l_int|0
suffix:semicolon
)brace
r_else
id|scatterwalk_start
c_func
(paren
id|walk
comma
id|sg_next
c_func
(paren
id|walk-&gt;sg
)paren
)paren
suffix:semicolon
)brace
)brace
DECL|function|scatter_done
r_static
r_void
id|scatter_done
c_func
(paren
r_struct
id|scatter_walk
op_star
id|walk
comma
r_int
id|out
comma
r_int
id|more
)paren
(brace
id|crypto_kunmap
c_func
(paren
id|walk-&gt;data
comma
id|out
)paren
suffix:semicolon
r_if
c_cond
(paren
id|walk-&gt;len_this_page
op_eq
l_int|0
op_logical_or
op_logical_neg
id|more
)paren
id|scatter_page_done
c_func
(paren
id|walk
comma
id|out
comma
id|more
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Do not call this unless the total length of all of the fragments &n; * has been verified as multiple of the block size.&n; */
DECL|function|copy_chunks
r_static
r_int
id|copy_chunks
c_func
(paren
r_void
op_star
id|buf
comma
r_struct
id|scatter_walk
op_star
id|walk
comma
r_int
id|nbytes
comma
r_int
id|out
)paren
(brace
r_if
c_cond
(paren
id|buf
op_ne
id|walk-&gt;data
)paren
(brace
r_while
c_loop
(paren
id|nbytes
OG
id|walk-&gt;len_this_page
)paren
(brace
id|memcpy_dir
c_func
(paren
id|buf
comma
id|walk-&gt;data
comma
id|walk-&gt;len_this_page
comma
id|out
)paren
suffix:semicolon
id|buf
op_add_assign
id|walk-&gt;len_this_page
suffix:semicolon
id|nbytes
op_sub_assign
id|walk-&gt;len_this_page
suffix:semicolon
id|crypto_kunmap
c_func
(paren
id|walk-&gt;data
comma
id|out
)paren
suffix:semicolon
id|scatter_page_done
c_func
(paren
id|walk
comma
id|out
comma
l_int|1
)paren
suffix:semicolon
id|scatterwalk_map
c_func
(paren
id|walk
comma
id|out
)paren
suffix:semicolon
)brace
id|memcpy_dir
c_func
(paren
id|buf
comma
id|walk-&gt;data
comma
id|nbytes
comma
id|out
)paren
suffix:semicolon
)brace
id|walk-&gt;offset
op_add_assign
id|nbytes
suffix:semicolon
id|walk-&gt;len_this_page
op_sub_assign
id|nbytes
suffix:semicolon
id|walk-&gt;len_this_segment
op_sub_assign
id|nbytes
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* &n; * Generic encrypt/decrypt wrapper for ciphers, handles operations across&n; * multiple page boundaries by using temporary blocks.  In user context,&n; * the kernel is given a chance to schedule us once per block.&n; */
DECL|function|crypt
r_static
r_int
id|crypt
c_func
(paren
r_struct
id|crypto_tfm
op_star
id|tfm
comma
r_struct
id|scatterlist
op_star
id|dst
comma
r_struct
id|scatterlist
op_star
id|src
comma
r_int
r_int
id|nbytes
comma
id|cryptfn_t
id|crfn
comma
id|procfn_t
id|prfn
comma
r_int
id|enc
)paren
(brace
r_struct
id|scatter_walk
id|walk_in
comma
id|walk_out
suffix:semicolon
r_const
r_int
r_int
id|bsize
op_assign
id|crypto_tfm_alg_blocksize
c_func
(paren
id|tfm
)paren
suffix:semicolon
id|u8
id|tmp_src
(braket
id|nbytes
OG
id|src-&gt;length
ques
c_cond
id|bsize
suffix:colon
l_int|0
)braket
suffix:semicolon
id|u8
id|tmp_dst
(braket
id|nbytes
OG
id|dst-&gt;length
ques
c_cond
id|bsize
suffix:colon
l_int|0
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|nbytes
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|nbytes
op_mod
id|bsize
)paren
(brace
id|tfm-&gt;crt_flags
op_or_assign
id|CRYPTO_TFM_RES_BAD_BLOCK_LEN
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|scatterwalk_start
c_func
(paren
op_amp
id|walk_in
comma
id|src
)paren
suffix:semicolon
id|scatterwalk_start
c_func
(paren
op_amp
id|walk_out
comma
id|dst
)paren
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
(brace
id|u8
op_star
id|src_p
comma
op_star
id|dst_p
suffix:semicolon
id|scatterwalk_map
c_func
(paren
op_amp
id|walk_in
comma
l_int|0
)paren
suffix:semicolon
id|scatterwalk_map
c_func
(paren
op_amp
id|walk_out
comma
l_int|1
)paren
suffix:semicolon
id|src_p
op_assign
id|which_buf
c_func
(paren
op_amp
id|walk_in
comma
id|bsize
comma
id|tmp_src
)paren
suffix:semicolon
id|dst_p
op_assign
id|which_buf
c_func
(paren
op_amp
id|walk_out
comma
id|bsize
comma
id|tmp_dst
)paren
suffix:semicolon
id|nbytes
op_sub_assign
id|bsize
suffix:semicolon
id|copy_chunks
c_func
(paren
id|src_p
comma
op_amp
id|walk_in
comma
id|bsize
comma
l_int|0
)paren
suffix:semicolon
id|prfn
c_func
(paren
id|tfm
comma
id|dst_p
comma
id|src_p
comma
id|crfn
comma
id|enc
)paren
suffix:semicolon
id|scatter_done
c_func
(paren
op_amp
id|walk_in
comma
l_int|0
comma
id|nbytes
)paren
suffix:semicolon
id|copy_chunks
c_func
(paren
id|dst_p
comma
op_amp
id|walk_out
comma
id|bsize
comma
l_int|1
)paren
suffix:semicolon
id|scatter_done
c_func
(paren
op_amp
id|walk_out
comma
l_int|1
comma
id|nbytes
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|nbytes
)paren
r_return
l_int|0
suffix:semicolon
id|crypto_yield
c_func
(paren
id|tfm
)paren
suffix:semicolon
)brace
)brace
DECL|function|cbc_process
r_static
r_void
id|cbc_process
c_func
(paren
r_struct
id|crypto_tfm
op_star
id|tfm
comma
id|u8
op_star
id|dst
comma
id|u8
op_star
id|src
comma
id|cryptfn_t
id|fn
comma
r_int
id|enc
)paren
(brace
multiline_comment|/* Null encryption */
r_if
c_cond
(paren
op_logical_neg
id|tfm-&gt;crt_cipher.cit_iv
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|enc
)paren
(brace
id|tfm-&gt;crt_u.cipher
dot
id|cit_xor_block
c_func
(paren
id|tfm-&gt;crt_cipher.cit_iv
comma
id|src
)paren
suffix:semicolon
id|fn
c_func
(paren
id|tfm-&gt;crt_ctx
comma
id|dst
comma
id|tfm-&gt;crt_cipher.cit_iv
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|tfm-&gt;crt_cipher.cit_iv
comma
id|dst
comma
id|crypto_tfm_alg_blocksize
c_func
(paren
id|tfm
)paren
)paren
suffix:semicolon
)brace
r_else
(brace
r_const
r_int
id|need_stack
op_assign
(paren
id|src
op_eq
id|dst
)paren
suffix:semicolon
id|u8
id|stack
(braket
id|need_stack
ques
c_cond
id|crypto_tfm_alg_blocksize
c_func
(paren
id|tfm
)paren
suffix:colon
l_int|0
)braket
suffix:semicolon
id|u8
op_star
id|buf
op_assign
id|need_stack
ques
c_cond
id|stack
suffix:colon
id|dst
suffix:semicolon
id|fn
c_func
(paren
id|tfm-&gt;crt_ctx
comma
id|buf
comma
id|src
)paren
suffix:semicolon
id|tfm-&gt;crt_u.cipher
dot
id|cit_xor_block
c_func
(paren
id|buf
comma
id|tfm-&gt;crt_cipher.cit_iv
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|tfm-&gt;crt_cipher.cit_iv
comma
id|src
comma
id|crypto_tfm_alg_blocksize
c_func
(paren
id|tfm
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|buf
op_ne
id|dst
)paren
id|memcpy
c_func
(paren
id|dst
comma
id|buf
comma
id|crypto_tfm_alg_blocksize
c_func
(paren
id|tfm
)paren
)paren
suffix:semicolon
)brace
)brace
DECL|function|ecb_process
r_static
r_void
id|ecb_process
c_func
(paren
r_struct
id|crypto_tfm
op_star
id|tfm
comma
id|u8
op_star
id|dst
comma
id|u8
op_star
id|src
comma
id|cryptfn_t
id|fn
comma
r_int
id|enc
)paren
(brace
id|fn
c_func
(paren
id|tfm-&gt;crt_ctx
comma
id|dst
comma
id|src
)paren
suffix:semicolon
)brace
DECL|function|setkey
r_static
r_int
id|setkey
c_func
(paren
r_struct
id|crypto_tfm
op_star
id|tfm
comma
r_const
id|u8
op_star
id|key
comma
r_int
r_int
id|keylen
)paren
(brace
r_struct
id|cipher_alg
op_star
id|cia
op_assign
op_amp
id|tfm-&gt;__crt_alg-&gt;cra_cipher
suffix:semicolon
r_if
c_cond
(paren
id|keylen
template_param
id|cia-&gt;cia_max_keysize
)paren
(brace
id|tfm-&gt;crt_flags
op_or_assign
id|CRYPTO_TFM_RES_BAD_KEY_LEN
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_else
r_return
id|cia
op_member_access_from_pointer
id|cia_setkey
c_func
(paren
id|tfm-&gt;crt_ctx
comma
id|key
comma
id|keylen
comma
op_amp
id|tfm-&gt;crt_flags
)paren
suffix:semicolon
)brace
DECL|function|ecb_encrypt
r_static
r_int
id|ecb_encrypt
c_func
(paren
r_struct
id|crypto_tfm
op_star
id|tfm
comma
r_struct
id|scatterlist
op_star
id|dst
comma
r_struct
id|scatterlist
op_star
id|src
comma
r_int
r_int
id|nbytes
)paren
(brace
r_return
id|crypt
c_func
(paren
id|tfm
comma
id|dst
comma
id|src
comma
id|nbytes
comma
id|tfm-&gt;__crt_alg-&gt;cra_cipher.cia_encrypt
comma
id|ecb_process
comma
l_int|1
)paren
suffix:semicolon
)brace
DECL|function|ecb_decrypt
r_static
r_int
id|ecb_decrypt
c_func
(paren
r_struct
id|crypto_tfm
op_star
id|tfm
comma
r_struct
id|scatterlist
op_star
id|dst
comma
r_struct
id|scatterlist
op_star
id|src
comma
r_int
r_int
id|nbytes
)paren
(brace
r_return
id|crypt
c_func
(paren
id|tfm
comma
id|dst
comma
id|src
comma
id|nbytes
comma
id|tfm-&gt;__crt_alg-&gt;cra_cipher.cia_decrypt
comma
id|ecb_process
comma
l_int|1
)paren
suffix:semicolon
)brace
DECL|function|cbc_encrypt
r_static
r_int
id|cbc_encrypt
c_func
(paren
r_struct
id|crypto_tfm
op_star
id|tfm
comma
r_struct
id|scatterlist
op_star
id|dst
comma
r_struct
id|scatterlist
op_star
id|src
comma
r_int
r_int
id|nbytes
)paren
(brace
r_return
id|crypt
c_func
(paren
id|tfm
comma
id|dst
comma
id|src
comma
id|nbytes
comma
id|tfm-&gt;__crt_alg-&gt;cra_cipher.cia_encrypt
comma
id|cbc_process
comma
l_int|1
)paren
suffix:semicolon
)brace
DECL|function|cbc_decrypt
r_static
r_int
id|cbc_decrypt
c_func
(paren
r_struct
id|crypto_tfm
op_star
id|tfm
comma
r_struct
id|scatterlist
op_star
id|dst
comma
r_struct
id|scatterlist
op_star
id|src
comma
r_int
r_int
id|nbytes
)paren
(brace
r_return
id|crypt
c_func
(paren
id|tfm
comma
id|dst
comma
id|src
comma
id|nbytes
comma
id|tfm-&gt;__crt_alg-&gt;cra_cipher.cia_decrypt
comma
id|cbc_process
comma
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|nocrypt
r_static
r_int
id|nocrypt
c_func
(paren
r_struct
id|crypto_tfm
op_star
id|tfm
comma
r_struct
id|scatterlist
op_star
id|dst
comma
r_struct
id|scatterlist
op_star
id|src
comma
r_int
r_int
id|nbytes
)paren
(brace
r_return
op_minus
id|ENOSYS
suffix:semicolon
)brace
DECL|function|crypto_init_cipher_flags
r_int
id|crypto_init_cipher_flags
c_func
(paren
r_struct
id|crypto_tfm
op_star
id|tfm
comma
id|u32
id|flags
)paren
(brace
id|u32
id|mode
op_assign
id|flags
op_amp
id|CRYPTO_TFM_MODE_MASK
suffix:semicolon
id|tfm-&gt;crt_cipher.cit_mode
op_assign
id|mode
ques
c_cond
id|mode
suffix:colon
id|CRYPTO_TFM_MODE_ECB
suffix:semicolon
r_if
c_cond
(paren
id|flags
op_amp
id|CRYPTO_TFM_REQ_WEAK_KEY
)paren
id|tfm-&gt;crt_flags
op_assign
id|CRYPTO_TFM_REQ_WEAK_KEY
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|crypto_init_cipher_ops
r_int
id|crypto_init_cipher_ops
c_func
(paren
r_struct
id|crypto_tfm
op_star
id|tfm
)paren
(brace
r_int
id|ret
op_assign
l_int|0
suffix:semicolon
r_struct
id|crypto_alg
op_star
id|alg
op_assign
id|tfm-&gt;__crt_alg
suffix:semicolon
r_struct
id|cipher_tfm
op_star
id|ops
op_assign
op_amp
id|tfm-&gt;crt_cipher
suffix:semicolon
id|ops-&gt;cit_setkey
op_assign
id|setkey
suffix:semicolon
r_switch
c_cond
(paren
id|tfm-&gt;crt_cipher.cit_mode
)paren
(brace
r_case
id|CRYPTO_TFM_MODE_ECB
suffix:colon
id|ops-&gt;cit_encrypt
op_assign
id|ecb_encrypt
suffix:semicolon
id|ops-&gt;cit_decrypt
op_assign
id|ecb_decrypt
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CRYPTO_TFM_MODE_CBC
suffix:colon
id|ops-&gt;cit_encrypt
op_assign
id|cbc_encrypt
suffix:semicolon
id|ops-&gt;cit_decrypt
op_assign
id|cbc_decrypt
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CRYPTO_TFM_MODE_CFB
suffix:colon
id|ops-&gt;cit_encrypt
op_assign
id|nocrypt
suffix:semicolon
id|ops-&gt;cit_decrypt
op_assign
id|nocrypt
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CRYPTO_TFM_MODE_CTR
suffix:colon
id|ops-&gt;cit_encrypt
op_assign
id|nocrypt
suffix:semicolon
id|ops-&gt;cit_decrypt
op_assign
id|nocrypt
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|BUG
c_func
(paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|alg-&gt;cra_cipher.cia_ivsize
op_logical_and
id|ops-&gt;cit_mode
op_ne
id|CRYPTO_TFM_MODE_ECB
)paren
(brace
r_switch
c_cond
(paren
id|crypto_tfm_alg_blocksize
c_func
(paren
id|tfm
)paren
)paren
(brace
r_case
l_int|8
suffix:colon
id|ops-&gt;cit_xor_block
op_assign
id|xor_64
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|16
suffix:colon
id|ops-&gt;cit_xor_block
op_assign
id|xor_128
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: block size %u not supported&bslash;n&quot;
comma
id|crypto_tfm_alg_name
c_func
(paren
id|tfm
)paren
comma
id|crypto_tfm_alg_blocksize
c_func
(paren
id|tfm
)paren
)paren
suffix:semicolon
id|ret
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|ops-&gt;cit_iv
op_assign
id|kmalloc
c_func
(paren
id|alg-&gt;cra_cipher.cia_ivsize
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ops-&gt;cit_iv
op_eq
l_int|NULL
)paren
id|ret
op_assign
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|out
suffix:colon
r_return
id|ret
suffix:semicolon
)brace
DECL|function|crypto_exit_cipher_ops
r_void
id|crypto_exit_cipher_ops
c_func
(paren
r_struct
id|crypto_tfm
op_star
id|tfm
)paren
(brace
r_if
c_cond
(paren
id|tfm-&gt;crt_cipher.cit_iv
)paren
id|kfree
c_func
(paren
id|tfm-&gt;crt_cipher.cit_iv
)paren
suffix:semicolon
)brace
eof
