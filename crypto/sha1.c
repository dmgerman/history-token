multiline_comment|/*&n; * Cryptographic API.&n; *&n; * SHA1 Secure Hash Algorithm.&n; *&n; * Derived from cryptoapi implementation, adapted for in-place&n; * scatterlist interface.&n; *&n; * Copyright (c) Alan Smithee.&n; * Copyright (c) Andrew McDonald &lt;andrew@mcdonald.org.uk&gt;&n; * Copyright (c) Jean-Francois Dive &lt;jef@linuxbe.org&gt;&n; *&n; * This program is free software; you can redistribute it and/or modify it&n; * under the terms of the GNU General Public License as published by the Free&n; * Software Foundation; either version 2 of the License, or (at your option)&n; * any later version.&n; *&n; */
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/crypto.h&gt;
macro_line|#include &lt;linux/cryptohash.h&gt;
macro_line|#include &lt;asm/scatterlist.h&gt;
macro_line|#include &lt;asm/byteorder.h&gt;
DECL|macro|SHA1_DIGEST_SIZE
mdefine_line|#define SHA1_DIGEST_SIZE&t;20
DECL|macro|SHA1_HMAC_BLOCK_SIZE
mdefine_line|#define SHA1_HMAC_BLOCK_SIZE&t;64
DECL|struct|sha1_ctx
r_struct
id|sha1_ctx
(brace
DECL|member|count
id|u64
id|count
suffix:semicolon
DECL|member|state
id|u32
id|state
(braket
l_int|5
)braket
suffix:semicolon
DECL|member|buffer
id|u8
id|buffer
(braket
l_int|64
)braket
suffix:semicolon
)brace
suffix:semicolon
DECL|function|sha1_init
r_static
r_void
id|sha1_init
c_func
(paren
r_void
op_star
id|ctx
)paren
(brace
r_struct
id|sha1_ctx
op_star
id|sctx
op_assign
id|ctx
suffix:semicolon
r_static
r_const
r_struct
id|sha1_ctx
id|initstate
op_assign
(brace
l_int|0
comma
(brace
l_int|0x67452301
comma
l_int|0xEFCDAB89
comma
l_int|0x98BADCFE
comma
l_int|0x10325476
comma
l_int|0xC3D2E1F0
)brace
comma
(brace
l_int|0
comma
)brace
)brace
suffix:semicolon
op_star
id|sctx
op_assign
id|initstate
suffix:semicolon
)brace
DECL|function|sha1_update
r_static
r_void
id|sha1_update
c_func
(paren
r_void
op_star
id|ctx
comma
r_const
id|u8
op_star
id|data
comma
r_int
r_int
id|len
)paren
(brace
r_struct
id|sha1_ctx
op_star
id|sctx
op_assign
id|ctx
suffix:semicolon
r_int
r_int
id|i
comma
id|j
suffix:semicolon
id|u32
id|temp
(braket
id|SHA_WORKSPACE_WORDS
)braket
suffix:semicolon
id|j
op_assign
(paren
id|sctx-&gt;count
op_rshift
l_int|3
)paren
op_amp
l_int|0x3f
suffix:semicolon
id|sctx-&gt;count
op_add_assign
id|len
op_lshift
l_int|3
suffix:semicolon
r_if
c_cond
(paren
(paren
id|j
op_plus
id|len
)paren
OG
l_int|63
)paren
(brace
id|memcpy
c_func
(paren
op_amp
id|sctx-&gt;buffer
(braket
id|j
)braket
comma
id|data
comma
(paren
id|i
op_assign
l_int|64
op_minus
id|j
)paren
)paren
suffix:semicolon
id|sha_transform
c_func
(paren
id|sctx-&gt;state
comma
id|sctx-&gt;buffer
comma
id|temp
)paren
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
id|i
op_plus
l_int|63
OL
id|len
suffix:semicolon
id|i
op_add_assign
l_int|64
)paren
(brace
id|sha_transform
c_func
(paren
id|sctx-&gt;state
comma
op_amp
id|data
(braket
id|i
)braket
comma
id|temp
)paren
suffix:semicolon
)brace
id|j
op_assign
l_int|0
suffix:semicolon
)brace
r_else
id|i
op_assign
l_int|0
suffix:semicolon
id|memset
c_func
(paren
id|temp
comma
l_int|0
comma
r_sizeof
(paren
id|temp
)paren
)paren
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|sctx-&gt;buffer
(braket
id|j
)braket
comma
op_amp
id|data
(braket
id|i
)braket
comma
id|len
op_minus
id|i
)paren
suffix:semicolon
)brace
multiline_comment|/* Add padding and return the message digest. */
DECL|function|sha1_final
r_static
r_void
id|sha1_final
c_func
(paren
r_void
op_star
id|ctx
comma
id|u8
op_star
id|out
)paren
(brace
r_struct
id|sha1_ctx
op_star
id|sctx
op_assign
id|ctx
suffix:semicolon
id|u32
id|i
comma
id|j
comma
id|index
comma
id|padlen
suffix:semicolon
id|u64
id|t
suffix:semicolon
id|u8
id|bits
(braket
l_int|8
)braket
op_assign
(brace
l_int|0
comma
)brace
suffix:semicolon
r_static
r_const
id|u8
id|padding
(braket
l_int|64
)braket
op_assign
(brace
l_int|0x80
comma
)brace
suffix:semicolon
id|t
op_assign
id|sctx-&gt;count
suffix:semicolon
id|bits
(braket
l_int|7
)braket
op_assign
l_int|0xff
op_amp
id|t
suffix:semicolon
id|t
op_rshift_assign
l_int|8
suffix:semicolon
id|bits
(braket
l_int|6
)braket
op_assign
l_int|0xff
op_amp
id|t
suffix:semicolon
id|t
op_rshift_assign
l_int|8
suffix:semicolon
id|bits
(braket
l_int|5
)braket
op_assign
l_int|0xff
op_amp
id|t
suffix:semicolon
id|t
op_rshift_assign
l_int|8
suffix:semicolon
id|bits
(braket
l_int|4
)braket
op_assign
l_int|0xff
op_amp
id|t
suffix:semicolon
id|t
op_rshift_assign
l_int|8
suffix:semicolon
id|bits
(braket
l_int|3
)braket
op_assign
l_int|0xff
op_amp
id|t
suffix:semicolon
id|t
op_rshift_assign
l_int|8
suffix:semicolon
id|bits
(braket
l_int|2
)braket
op_assign
l_int|0xff
op_amp
id|t
suffix:semicolon
id|t
op_rshift_assign
l_int|8
suffix:semicolon
id|bits
(braket
l_int|1
)braket
op_assign
l_int|0xff
op_amp
id|t
suffix:semicolon
id|t
op_rshift_assign
l_int|8
suffix:semicolon
id|bits
(braket
l_int|0
)braket
op_assign
l_int|0xff
op_amp
id|t
suffix:semicolon
multiline_comment|/* Pad out to 56 mod 64 */
id|index
op_assign
(paren
id|sctx-&gt;count
op_rshift
l_int|3
)paren
op_amp
l_int|0x3f
suffix:semicolon
id|padlen
op_assign
(paren
id|index
OL
l_int|56
)paren
ques
c_cond
(paren
l_int|56
op_minus
id|index
)paren
suffix:colon
(paren
(paren
l_int|64
op_plus
l_int|56
)paren
op_minus
id|index
)paren
suffix:semicolon
id|sha1_update
c_func
(paren
id|sctx
comma
id|padding
comma
id|padlen
)paren
suffix:semicolon
multiline_comment|/* Append length */
id|sha1_update
c_func
(paren
id|sctx
comma
id|bits
comma
r_sizeof
id|bits
)paren
suffix:semicolon
multiline_comment|/* Store state in digest */
r_for
c_loop
(paren
id|i
op_assign
id|j
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|5
suffix:semicolon
id|i
op_increment
comma
id|j
op_add_assign
l_int|4
)paren
(brace
id|u32
id|t2
op_assign
id|sctx-&gt;state
(braket
id|i
)braket
suffix:semicolon
id|out
(braket
id|j
op_plus
l_int|3
)braket
op_assign
id|t2
op_amp
l_int|0xff
suffix:semicolon
id|t2
op_rshift_assign
l_int|8
suffix:semicolon
id|out
(braket
id|j
op_plus
l_int|2
)braket
op_assign
id|t2
op_amp
l_int|0xff
suffix:semicolon
id|t2
op_rshift_assign
l_int|8
suffix:semicolon
id|out
(braket
id|j
op_plus
l_int|1
)braket
op_assign
id|t2
op_amp
l_int|0xff
suffix:semicolon
id|t2
op_rshift_assign
l_int|8
suffix:semicolon
id|out
(braket
id|j
)braket
op_assign
id|t2
op_amp
l_int|0xff
suffix:semicolon
)brace
multiline_comment|/* Wipe context */
id|memset
c_func
(paren
id|sctx
comma
l_int|0
comma
r_sizeof
op_star
id|sctx
)paren
suffix:semicolon
)brace
DECL|variable|alg
r_static
r_struct
id|crypto_alg
id|alg
op_assign
(brace
dot
id|cra_name
op_assign
l_string|&quot;sha1&quot;
comma
dot
id|cra_flags
op_assign
id|CRYPTO_ALG_TYPE_DIGEST
comma
dot
id|cra_blocksize
op_assign
id|SHA1_HMAC_BLOCK_SIZE
comma
dot
id|cra_ctxsize
op_assign
r_sizeof
(paren
r_struct
id|sha1_ctx
)paren
comma
dot
id|cra_module
op_assign
id|THIS_MODULE
comma
dot
id|cra_list
op_assign
id|LIST_HEAD_INIT
c_func
(paren
id|alg.cra_list
)paren
comma
dot
id|cra_u
op_assign
(brace
dot
id|digest
op_assign
(brace
dot
id|dia_digestsize
op_assign
id|SHA1_DIGEST_SIZE
comma
dot
id|dia_init
op_assign
id|sha1_init
comma
dot
id|dia_update
op_assign
id|sha1_update
comma
dot
id|dia_final
op_assign
id|sha1_final
)brace
)brace
)brace
suffix:semicolon
DECL|function|init
r_static
r_int
id|__init
id|init
c_func
(paren
r_void
)paren
(brace
r_return
id|crypto_register_alg
c_func
(paren
op_amp
id|alg
)paren
suffix:semicolon
)brace
DECL|function|fini
r_static
r_void
id|__exit
id|fini
c_func
(paren
r_void
)paren
(brace
id|crypto_unregister_alg
c_func
(paren
op_amp
id|alg
)paren
suffix:semicolon
)brace
DECL|variable|init
id|module_init
c_func
(paren
id|init
)paren
suffix:semicolon
DECL|variable|fini
id|module_exit
c_func
(paren
id|fini
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;SHA1 Secure Hash Algorithm&quot;
)paren
suffix:semicolon
eof
