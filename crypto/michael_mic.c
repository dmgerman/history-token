multiline_comment|/*&n; * Cryptographic API&n; *&n; * Michael MIC (IEEE 802.11i/TKIP) keyed digest&n; *&n; * Copyright (c) 2004 Jouni Malinen &lt;jkmaline@cc.hut.fi&gt;&n; *&n; * This program is free software; you can redistribute it and/or modify&n; * it under the terms of the GNU General Public License version 2 as&n; * published by the Free Software Foundation.&n; */
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/crypto.h&gt;
DECL|struct|michael_mic_ctx
r_struct
id|michael_mic_ctx
(brace
DECL|member|pending
id|u8
id|pending
(braket
l_int|4
)braket
suffix:semicolon
DECL|member|pending_len
r_int
id|pending_len
suffix:semicolon
DECL|member|l
DECL|member|r
id|u32
id|l
comma
id|r
suffix:semicolon
)brace
suffix:semicolon
DECL|function|rotl
r_static
r_inline
id|u32
id|rotl
c_func
(paren
id|u32
id|val
comma
r_int
id|bits
)paren
(brace
r_return
(paren
id|val
op_lshift
id|bits
)paren
op_or
(paren
id|val
op_rshift
(paren
l_int|32
op_minus
id|bits
)paren
)paren
suffix:semicolon
)brace
DECL|function|rotr
r_static
r_inline
id|u32
id|rotr
c_func
(paren
id|u32
id|val
comma
r_int
id|bits
)paren
(brace
r_return
(paren
id|val
op_rshift
id|bits
)paren
op_or
(paren
id|val
op_lshift
(paren
l_int|32
op_minus
id|bits
)paren
)paren
suffix:semicolon
)brace
DECL|function|xswap
r_static
r_inline
id|u32
id|xswap
c_func
(paren
id|u32
id|val
)paren
(brace
r_return
(paren
(paren
id|val
op_amp
l_int|0x00ff00ff
)paren
op_lshift
l_int|8
)paren
op_or
(paren
(paren
id|val
op_amp
l_int|0xff00ff00
)paren
op_rshift
l_int|8
)paren
suffix:semicolon
)brace
DECL|macro|michael_block
mdefine_line|#define michael_block(l, r)&t;&bslash;&n;do {&t;&t;&t;&t;&bslash;&n;&t;r ^= rotl(l, 17);&t;&bslash;&n;&t;l += r;&t;&t;&t;&bslash;&n;&t;r ^= xswap(l);&t;&t;&bslash;&n;&t;l += r;&t;&t;&t;&bslash;&n;&t;r ^= rotl(l, 3);&t;&bslash;&n;&t;l += r;&t;&t;&t;&bslash;&n;&t;r ^= rotr(l, 2);&t;&bslash;&n;&t;l += r;&t;&t;&t;&bslash;&n;} while (0)
DECL|function|get_le32
r_static
r_inline
id|u32
id|get_le32
c_func
(paren
r_const
id|u8
op_star
id|p
)paren
(brace
r_return
id|p
(braket
l_int|0
)braket
op_or
(paren
id|p
(braket
l_int|1
)braket
op_lshift
l_int|8
)paren
op_or
(paren
id|p
(braket
l_int|2
)braket
op_lshift
l_int|16
)paren
op_or
(paren
id|p
(braket
l_int|3
)braket
op_lshift
l_int|24
)paren
suffix:semicolon
)brace
DECL|function|put_le32
r_static
r_inline
r_void
id|put_le32
c_func
(paren
id|u8
op_star
id|p
comma
id|u32
id|v
)paren
(brace
id|p
(braket
l_int|0
)braket
op_assign
id|v
suffix:semicolon
id|p
(braket
l_int|1
)braket
op_assign
id|v
op_rshift
l_int|8
suffix:semicolon
id|p
(braket
l_int|2
)braket
op_assign
id|v
op_rshift
l_int|16
suffix:semicolon
id|p
(braket
l_int|3
)braket
op_assign
id|v
op_rshift
l_int|24
suffix:semicolon
)brace
DECL|function|michael_init
r_static
r_void
id|michael_init
c_func
(paren
r_void
op_star
id|ctx
)paren
(brace
r_struct
id|michael_mic_ctx
op_star
id|mctx
op_assign
id|ctx
suffix:semicolon
id|mctx-&gt;pending_len
op_assign
l_int|0
suffix:semicolon
)brace
DECL|function|michael_update
r_static
r_void
id|michael_update
c_func
(paren
r_void
op_star
id|ctx
comma
r_const
id|u8
op_star
id|data
comma
r_int
r_int
id|len
)paren
(brace
r_struct
id|michael_mic_ctx
op_star
id|mctx
op_assign
id|ctx
suffix:semicolon
r_if
c_cond
(paren
id|mctx-&gt;pending_len
)paren
(brace
r_int
id|flen
op_assign
l_int|4
op_minus
id|mctx-&gt;pending_len
suffix:semicolon
r_if
c_cond
(paren
id|flen
OG
id|len
)paren
id|flen
op_assign
id|len
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|mctx-&gt;pending
(braket
id|mctx-&gt;pending_len
)braket
comma
id|data
comma
id|flen
)paren
suffix:semicolon
id|mctx-&gt;pending_len
op_add_assign
id|flen
suffix:semicolon
id|data
op_add_assign
id|flen
suffix:semicolon
id|len
op_sub_assign
id|flen
suffix:semicolon
r_if
c_cond
(paren
id|mctx-&gt;pending_len
OL
l_int|4
)paren
r_return
suffix:semicolon
id|mctx-&gt;l
op_xor_assign
id|get_le32
c_func
(paren
id|mctx-&gt;pending
)paren
suffix:semicolon
id|michael_block
c_func
(paren
id|mctx-&gt;l
comma
id|mctx-&gt;r
)paren
suffix:semicolon
id|mctx-&gt;pending_len
op_assign
l_int|0
suffix:semicolon
)brace
r_while
c_loop
(paren
id|len
op_ge
l_int|4
)paren
(brace
id|mctx-&gt;l
op_xor_assign
id|get_le32
c_func
(paren
id|data
)paren
suffix:semicolon
id|michael_block
c_func
(paren
id|mctx-&gt;l
comma
id|mctx-&gt;r
)paren
suffix:semicolon
id|data
op_add_assign
l_int|4
suffix:semicolon
id|len
op_sub_assign
l_int|4
suffix:semicolon
)brace
r_if
c_cond
(paren
id|len
OG
l_int|0
)paren
(brace
id|mctx-&gt;pending_len
op_assign
id|len
suffix:semicolon
id|memcpy
c_func
(paren
id|mctx-&gt;pending
comma
id|data
comma
id|len
)paren
suffix:semicolon
)brace
)brace
DECL|function|michael_final
r_static
r_void
id|michael_final
c_func
(paren
r_void
op_star
id|ctx
comma
id|u8
op_star
id|out
)paren
(brace
r_struct
id|michael_mic_ctx
op_star
id|mctx
op_assign
id|ctx
suffix:semicolon
id|u8
op_star
id|data
op_assign
id|mctx-&gt;pending
suffix:semicolon
multiline_comment|/* Last block and padding (0x5a, 4..7 x 0) */
r_switch
c_cond
(paren
id|mctx-&gt;pending_len
)paren
(brace
r_case
l_int|0
suffix:colon
id|mctx-&gt;l
op_xor_assign
l_int|0x5a
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|1
suffix:colon
id|mctx-&gt;l
op_xor_assign
id|data
(braket
l_int|0
)braket
op_or
l_int|0x5a00
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
id|mctx-&gt;l
op_xor_assign
id|data
(braket
l_int|0
)braket
op_or
(paren
id|data
(braket
l_int|1
)braket
op_lshift
l_int|8
)paren
op_or
l_int|0x5a0000
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|3
suffix:colon
id|mctx-&gt;l
op_xor_assign
id|data
(braket
l_int|0
)braket
op_or
(paren
id|data
(braket
l_int|1
)braket
op_lshift
l_int|8
)paren
op_or
(paren
id|data
(braket
l_int|2
)braket
op_lshift
l_int|16
)paren
op_or
l_int|0x5a000000
suffix:semicolon
r_break
suffix:semicolon
)brace
id|michael_block
c_func
(paren
id|mctx-&gt;l
comma
id|mctx-&gt;r
)paren
suffix:semicolon
multiline_comment|/* l ^= 0; */
id|michael_block
c_func
(paren
id|mctx-&gt;l
comma
id|mctx-&gt;r
)paren
suffix:semicolon
id|put_le32
c_func
(paren
id|out
comma
id|mctx-&gt;l
)paren
suffix:semicolon
id|put_le32
c_func
(paren
id|out
op_plus
l_int|4
comma
id|mctx-&gt;r
)paren
suffix:semicolon
)brace
DECL|function|michael_setkey
r_static
r_int
id|michael_setkey
c_func
(paren
r_void
op_star
id|ctx
comma
r_const
id|u8
op_star
id|key
comma
r_int
r_int
id|keylen
comma
id|u32
op_star
id|flags
)paren
(brace
r_struct
id|michael_mic_ctx
op_star
id|mctx
op_assign
id|ctx
suffix:semicolon
r_if
c_cond
(paren
id|keylen
op_ne
l_int|8
)paren
(brace
r_if
c_cond
(paren
id|flags
)paren
op_star
id|flags
op_assign
id|CRYPTO_TFM_RES_BAD_KEY_LEN
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|mctx-&gt;l
op_assign
id|get_le32
c_func
(paren
id|key
)paren
suffix:semicolon
id|mctx-&gt;r
op_assign
id|get_le32
c_func
(paren
id|key
op_plus
l_int|4
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|michael_mic_alg
r_static
r_struct
id|crypto_alg
id|michael_mic_alg
op_assign
(brace
dot
id|cra_name
op_assign
l_string|&quot;michael_mic&quot;
comma
dot
id|cra_flags
op_assign
id|CRYPTO_ALG_TYPE_DIGEST
comma
dot
id|cra_blocksize
op_assign
l_int|8
comma
dot
id|cra_ctxsize
op_assign
r_sizeof
(paren
r_struct
id|michael_mic_ctx
)paren
comma
dot
id|cra_module
op_assign
id|THIS_MODULE
comma
dot
id|cra_list
op_assign
id|LIST_HEAD_INIT
c_func
(paren
id|michael_mic_alg.cra_list
)paren
comma
dot
id|cra_u
op_assign
(brace
dot
id|digest
op_assign
(brace
dot
id|dia_digestsize
op_assign
l_int|8
comma
dot
id|dia_init
op_assign
id|michael_init
comma
dot
id|dia_update
op_assign
id|michael_update
comma
dot
id|dia_final
op_assign
id|michael_final
comma
dot
id|dia_setkey
op_assign
id|michael_setkey
)brace
)brace
)brace
suffix:semicolon
DECL|function|michael_mic_init
r_static
r_int
id|__init
id|michael_mic_init
c_func
(paren
r_void
)paren
(brace
r_return
id|crypto_register_alg
c_func
(paren
op_amp
id|michael_mic_alg
)paren
suffix:semicolon
)brace
DECL|function|michael_mic_exit
r_static
r_void
id|__exit
id|michael_mic_exit
c_func
(paren
r_void
)paren
(brace
id|crypto_unregister_alg
c_func
(paren
op_amp
id|michael_mic_alg
)paren
suffix:semicolon
)brace
DECL|variable|michael_mic_init
id|module_init
c_func
(paren
id|michael_mic_init
)paren
suffix:semicolon
DECL|variable|michael_mic_exit
id|module_exit
c_func
(paren
id|michael_mic_exit
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL v2&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;Michael MIC&quot;
)paren
suffix:semicolon
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Jouni Malinen &lt;jkmaline@cc.hut.fi&gt;&quot;
)paren
suffix:semicolon
eof
