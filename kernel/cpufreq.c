multiline_comment|/*&n; *  linux/kernel/cpufreq.c&n; *&n; *  Copyright (C) 2001 Russell King&n; *            (C) 2002 - 2003 Dominik Brodowski &lt;linux@brodo.de&gt;&n; *&n; *  $Id: cpufreq.c,v 1.59 2003/01/20 17:31:48 db Exp $&n; *&n; * This program is free software; you can redistribute it and/or modify&n; * it under the terms of the GNU General Public License version 2 as&n; * published by the Free Software Foundation.&n; *&n; */
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/notifier.h&gt;
macro_line|#include &lt;linux/cpufreq.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/spinlock.h&gt;
macro_line|#include &lt;linux/device.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/cpu.h&gt;
macro_line|#include &lt;linux/completion.h&gt;
multiline_comment|/**&n; * The &quot;cpufreq driver&quot; - the arch- or hardware-dependend low&n; * level driver of CPUFreq support, and its locking mutex. &n; * cpu_max_freq is in kHz.&n; */
DECL|variable|cpufreq_driver
r_static
r_struct
id|cpufreq_driver
op_star
id|cpufreq_driver
suffix:semicolon
r_static
id|DECLARE_MUTEX
(paren
id|cpufreq_driver_sem
)paren
suffix:semicolon
multiline_comment|/**&n; * Two notifier lists: the &quot;policy&quot; list is involved in the &n; * validation process for a new CPU frequency policy; the &n; * &quot;transition&quot; list for kernel code that needs to handle&n; * changes to devices when the CPU clock speed changes.&n; * The mutex locks both lists. If both cpufreq_driver_sem&n; * and cpufreq_notifier_sem need to be hold, get cpufreq_driver_sem&n; * first.&n; */
DECL|variable|cpufreq_policy_notifier_list
r_static
r_struct
id|notifier_block
op_star
id|cpufreq_policy_notifier_list
suffix:semicolon
DECL|variable|cpufreq_transition_notifier_list
r_static
r_struct
id|notifier_block
op_star
id|cpufreq_transition_notifier_list
suffix:semicolon
r_static
id|DECLARE_RWSEM
(paren
id|cpufreq_notifier_rwsem
)paren
suffix:semicolon
r_static
id|LIST_HEAD
c_func
(paren
id|cpufreq_governor_list
)paren
suffix:semicolon
r_static
id|DECLARE_MUTEX
(paren
id|cpufreq_governor_sem
)paren
suffix:semicolon
DECL|function|cpufreq_cpu_get
r_static
r_int
id|cpufreq_cpu_get
c_func
(paren
r_int
r_int
id|cpu
)paren
(brace
r_if
c_cond
(paren
id|cpu
op_ge
id|NR_CPUS
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cpufreq_driver
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|try_module_get
c_func
(paren
id|cpufreq_driver-&gt;owner
)paren
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|kobject_get
c_func
(paren
op_amp
id|cpufreq_driver-&gt;policy
(braket
id|cpu
)braket
dot
id|kobj
)paren
)paren
(brace
id|module_put
c_func
(paren
id|cpufreq_driver-&gt;owner
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_return
l_int|1
suffix:semicolon
)brace
DECL|function|cpufreq_cpu_put
r_static
r_void
id|cpufreq_cpu_put
c_func
(paren
r_int
r_int
id|cpu
)paren
(brace
id|kobject_put
c_func
(paren
op_amp
id|cpufreq_driver-&gt;policy
(braket
id|cpu
)braket
dot
id|kobj
)paren
suffix:semicolon
id|module_put
c_func
(paren
id|cpufreq_driver-&gt;owner
)paren
suffix:semicolon
)brace
multiline_comment|/*********************************************************************&n; *                          SYSFS INTERFACE                          *&n; *********************************************************************/
multiline_comment|/**&n; * cpufreq_parse_governor - parse a governor string&n; */
DECL|function|cpufreq_parse_governor
r_int
id|cpufreq_parse_governor
(paren
r_char
op_star
id|str_governor
comma
r_int
r_int
op_star
id|policy
comma
r_struct
id|cpufreq_governor
op_star
op_star
id|governor
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|strnicmp
c_func
(paren
id|str_governor
comma
l_string|&quot;performance&quot;
comma
id|CPUFREQ_NAME_LEN
)paren
)paren
(brace
op_star
id|policy
op_assign
id|CPUFREQ_POLICY_PERFORMANCE
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strnicmp
c_func
(paren
id|str_governor
comma
l_string|&quot;powersave&quot;
comma
id|CPUFREQ_NAME_LEN
)paren
)paren
(brace
op_star
id|policy
op_assign
id|CPUFREQ_POLICY_POWERSAVE
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_else
(brace
r_struct
id|cpufreq_governor
op_star
id|t
suffix:semicolon
id|down
c_func
(paren
op_amp
id|cpufreq_governor_sem
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cpufreq_driver
op_logical_or
op_logical_neg
id|cpufreq_driver-&gt;target
)paren
r_goto
id|out
suffix:semicolon
id|list_for_each_entry
c_func
(paren
id|t
comma
op_amp
id|cpufreq_governor_list
comma
id|governor_list
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|strnicmp
c_func
(paren
id|str_governor
comma
id|t-&gt;name
comma
id|CPUFREQ_NAME_LEN
)paren
)paren
(brace
op_star
id|governor
op_assign
id|t
suffix:semicolon
op_star
id|policy
op_assign
id|CPUFREQ_POLICY_GOVERNOR
suffix:semicolon
id|up
c_func
(paren
op_amp
id|cpufreq_governor_sem
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
id|out
suffix:colon
id|up
c_func
(paren
op_amp
id|cpufreq_governor_sem
)paren
suffix:semicolon
)brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
DECL|variable|cpufreq_parse_governor
id|EXPORT_SYMBOL_GPL
c_func
(paren
id|cpufreq_parse_governor
)paren
suffix:semicolon
multiline_comment|/* drivers/base/cpu.c */
r_extern
r_struct
id|sysdev_class
id|cpu_sysdev_class
suffix:semicolon
multiline_comment|/**&n; * cpufreq_per_cpu_attr_read() / show_##file_name() - print out cpufreq information&n; *&n; * Write out information from cpufreq_driver-&gt;policy[cpu]; object must be&n; * &quot;unsigned int&quot;.&n; */
DECL|macro|show_one
mdefine_line|#define show_one(file_name, object)&t;&t; &t;&t;&t;&bslash;&n;static ssize_t show_##file_name &t;&t;&t;&t;&t;&bslash;&n;(struct cpufreq_policy * policy, char *buf)&t;&t;&t;&t;&bslash;&n;{&t;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;return sprintf (buf, &quot;%u&bslash;n&quot;, policy-&gt;object);&t;&t;&t;&bslash;&n;}
id|show_one
c_func
(paren
id|cpuinfo_min_freq
comma
id|cpuinfo.min_freq
)paren
suffix:semicolon
id|show_one
c_func
(paren
id|cpuinfo_max_freq
comma
id|cpuinfo.max_freq
)paren
suffix:semicolon
id|show_one
c_func
(paren
id|scaling_min_freq
comma
id|min
)paren
suffix:semicolon
id|show_one
c_func
(paren
id|scaling_max_freq
comma
id|max
)paren
suffix:semicolon
multiline_comment|/**&n; * cpufreq_per_cpu_attr_write() / store_##file_name() - sysfs write access&n; */
DECL|macro|store_one
mdefine_line|#define store_one(file_name, object)&t;&t;&t;&bslash;&n;static ssize_t store_##file_name&t;&t;&t;&t;&t;&bslash;&n;(struct cpufreq_policy * policy, const char *buf, size_t count)&t;&t;&bslash;&n;{&t;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;unsigned int ret = -EINVAL;&t;&t;&t;&t;&t;&bslash;&n;&t;struct cpufreq_policy new_policy;&t;&t;&t;&t;&bslash;&n;&t;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;ret = cpufreq_get_policy(&amp;new_policy, policy-&gt;cpu);&t;&t;&bslash;&n;&t;if (ret)&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&t;return -EINVAL;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;ret = sscanf (buf, &quot;%u&quot;, &amp;new_policy.object);&t;&t;&t;&bslash;&n;&t;if (ret != 1)&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&t;return -EINVAL;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;ret = cpufreq_set_policy(&amp;new_policy);&t;&t;&t;&t;&bslash;&n;&t;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;return ret ? ret : count;&t;&t;&t;&t;&t;&bslash;&n;}
id|store_one
c_func
(paren
id|scaling_min_freq
comma
id|min
)paren
suffix:semicolon
id|store_one
c_func
(paren
id|scaling_max_freq
comma
id|max
)paren
suffix:semicolon
multiline_comment|/**&n; * show_scaling_governor - show the current policy for the specified CPU&n; */
DECL|function|show_scaling_governor
r_static
id|ssize_t
id|show_scaling_governor
(paren
r_struct
id|cpufreq_policy
op_star
id|policy
comma
r_char
op_star
id|buf
)paren
(brace
r_switch
c_cond
(paren
id|policy-&gt;policy
)paren
(brace
r_case
id|CPUFREQ_POLICY_POWERSAVE
suffix:colon
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;powersave&bslash;n&quot;
)paren
suffix:semicolon
r_case
id|CPUFREQ_POLICY_PERFORMANCE
suffix:colon
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;performance&bslash;n&quot;
)paren
suffix:semicolon
r_case
id|CPUFREQ_POLICY_GOVERNOR
suffix:colon
r_return
id|snprintf
c_func
(paren
id|buf
comma
id|CPUFREQ_NAME_LEN
comma
l_string|&quot;%s&bslash;n&quot;
comma
id|policy-&gt;governor-&gt;name
)paren
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
)brace
multiline_comment|/**&n; * store_scaling_governor - store policy for the specified CPU&n; */
DECL|function|store_scaling_governor
r_static
id|ssize_t
id|store_scaling_governor
(paren
r_struct
id|cpufreq_policy
op_star
id|policy
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
)paren
(brace
r_int
r_int
id|ret
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_char
id|str_governor
(braket
l_int|16
)braket
suffix:semicolon
r_struct
id|cpufreq_policy
id|new_policy
suffix:semicolon
id|ret
op_assign
id|cpufreq_get_policy
c_func
(paren
op_amp
id|new_policy
comma
id|policy-&gt;cpu
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
r_return
id|ret
suffix:semicolon
id|ret
op_assign
id|sscanf
(paren
id|buf
comma
l_string|&quot;%15s&quot;
comma
id|str_governor
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
op_ne
l_int|1
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|cpufreq_parse_governor
c_func
(paren
id|str_governor
comma
op_amp
id|new_policy.policy
comma
op_amp
id|new_policy.governor
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|ret
op_assign
id|cpufreq_set_policy
c_func
(paren
op_amp
id|new_policy
)paren
suffix:semicolon
r_return
id|ret
ques
c_cond
id|ret
suffix:colon
id|count
suffix:semicolon
)brace
multiline_comment|/**&n; * show_scaling_driver - show the cpufreq driver currently loaded&n; */
DECL|function|show_scaling_driver
r_static
id|ssize_t
id|show_scaling_driver
(paren
r_struct
id|cpufreq_policy
op_star
id|policy
comma
r_char
op_star
id|buf
)paren
(brace
r_return
id|snprintf
c_func
(paren
id|buf
comma
id|CPUFREQ_NAME_LEN
comma
l_string|&quot;%s&bslash;n&quot;
comma
id|cpufreq_driver-&gt;name
)paren
suffix:semicolon
)brace
multiline_comment|/**&n; * show_scaling_available_governors - show the available CPUfreq governors&n; */
DECL|function|show_scaling_available_governors
r_static
id|ssize_t
id|show_scaling_available_governors
(paren
r_struct
id|cpufreq_policy
op_star
id|policy
comma
r_char
op_star
id|buf
)paren
(brace
id|ssize_t
id|i
op_assign
l_int|0
suffix:semicolon
r_struct
id|cpufreq_governor
op_star
id|t
suffix:semicolon
id|i
op_add_assign
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;performance powersave&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cpufreq_driver-&gt;target
)paren
r_goto
id|out
suffix:semicolon
id|list_for_each_entry
c_func
(paren
id|t
comma
op_amp
id|cpufreq_governor_list
comma
id|governor_list
)paren
(brace
r_if
c_cond
(paren
id|i
op_ge
(paren
id|ssize_t
)paren
(paren
(paren
id|PAGE_SIZE
op_div
r_sizeof
(paren
r_char
)paren
)paren
op_minus
(paren
id|CPUFREQ_NAME_LEN
op_plus
l_int|2
)paren
)paren
)paren
r_goto
id|out
suffix:semicolon
id|i
op_add_assign
id|snprintf
c_func
(paren
op_amp
id|buf
(braket
id|i
)braket
comma
id|CPUFREQ_NAME_LEN
comma
l_string|&quot; %s&quot;
comma
id|t-&gt;name
)paren
suffix:semicolon
)brace
id|out
suffix:colon
id|i
op_add_assign
id|sprintf
c_func
(paren
op_amp
id|buf
(braket
id|i
)braket
comma
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|i
suffix:semicolon
)brace
DECL|macro|define_one_ro
mdefine_line|#define define_one_ro(_name) &bslash;&n;struct freq_attr _name = { &bslash;&n;&t;.attr = { .name = __stringify(_name), .mode = 0444 }, &bslash;&n;&t;.show = show_##_name, &bslash;&n;}
DECL|macro|define_one_rw
mdefine_line|#define define_one_rw(_name) &bslash;&n;struct freq_attr _name = { &bslash;&n;&t;.attr = { .name = __stringify(_name), .mode = 0644 }, &bslash;&n;&t;.show = show_##_name, &bslash;&n;&t;.store = store_##_name, &bslash;&n;}
DECL|variable|cpuinfo_min_freq
id|define_one_ro
c_func
(paren
id|cpuinfo_min_freq
)paren
suffix:semicolon
DECL|variable|cpuinfo_max_freq
id|define_one_ro
c_func
(paren
id|cpuinfo_max_freq
)paren
suffix:semicolon
DECL|variable|scaling_available_governors
id|define_one_ro
c_func
(paren
id|scaling_available_governors
)paren
suffix:semicolon
DECL|variable|scaling_driver
id|define_one_ro
c_func
(paren
id|scaling_driver
)paren
suffix:semicolon
DECL|variable|scaling_min_freq
id|define_one_rw
c_func
(paren
id|scaling_min_freq
)paren
suffix:semicolon
DECL|variable|scaling_max_freq
id|define_one_rw
c_func
(paren
id|scaling_max_freq
)paren
suffix:semicolon
DECL|variable|scaling_governor
id|define_one_rw
c_func
(paren
id|scaling_governor
)paren
suffix:semicolon
DECL|variable|default_attrs
r_static
r_struct
id|attribute
op_star
id|default_attrs
(braket
)braket
op_assign
(brace
op_amp
id|cpuinfo_min_freq.attr
comma
op_amp
id|cpuinfo_max_freq.attr
comma
op_amp
id|scaling_min_freq.attr
comma
op_amp
id|scaling_max_freq.attr
comma
op_amp
id|scaling_governor.attr
comma
op_amp
id|scaling_driver.attr
comma
op_amp
id|scaling_available_governors.attr
comma
l_int|NULL
)brace
suffix:semicolon
DECL|macro|to_policy
mdefine_line|#define to_policy(k) container_of(k,struct cpufreq_policy,kobj)
DECL|macro|to_attr
mdefine_line|#define to_attr(a) container_of(a,struct freq_attr,attr)
DECL|function|show
r_static
id|ssize_t
id|show
c_func
(paren
r_struct
id|kobject
op_star
id|kobj
comma
r_struct
id|attribute
op_star
id|attr
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|cpufreq_policy
op_star
id|policy
op_assign
id|to_policy
c_func
(paren
id|kobj
)paren
suffix:semicolon
r_struct
id|freq_attr
op_star
id|fattr
op_assign
id|to_attr
c_func
(paren
id|attr
)paren
suffix:semicolon
id|ssize_t
id|ret
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cpufreq_cpu_get
c_func
(paren
id|policy-&gt;cpu
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|ret
op_assign
id|fattr-&gt;show
ques
c_cond
id|fattr
op_member_access_from_pointer
id|show
c_func
(paren
id|policy
comma
id|buf
)paren
suffix:colon
l_int|0
suffix:semicolon
id|cpufreq_cpu_put
c_func
(paren
id|policy-&gt;cpu
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|function|store
r_static
id|ssize_t
id|store
c_func
(paren
r_struct
id|kobject
op_star
id|kobj
comma
r_struct
id|attribute
op_star
id|attr
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
)paren
(brace
r_struct
id|cpufreq_policy
op_star
id|policy
op_assign
id|to_policy
c_func
(paren
id|kobj
)paren
suffix:semicolon
r_struct
id|freq_attr
op_star
id|fattr
op_assign
id|to_attr
c_func
(paren
id|attr
)paren
suffix:semicolon
id|ssize_t
id|ret
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cpufreq_cpu_get
c_func
(paren
id|policy-&gt;cpu
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|ret
op_assign
id|fattr-&gt;store
ques
c_cond
id|fattr
op_member_access_from_pointer
id|store
c_func
(paren
id|policy
comma
id|buf
comma
id|count
)paren
suffix:colon
l_int|0
suffix:semicolon
id|cpufreq_cpu_put
c_func
(paren
id|policy-&gt;cpu
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|function|cpufreq_sysfs_release
r_static
r_void
id|cpufreq_sysfs_release
c_func
(paren
r_struct
id|kobject
op_star
id|kobj
)paren
(brace
r_struct
id|cpufreq_policy
op_star
id|policy
op_assign
id|to_policy
c_func
(paren
id|kobj
)paren
suffix:semicolon
id|complete
c_func
(paren
op_amp
id|policy-&gt;kobj_unregister
)paren
suffix:semicolon
)brace
DECL|variable|sysfs_ops
r_static
r_struct
id|sysfs_ops
id|sysfs_ops
op_assign
(brace
dot
id|show
op_assign
id|show
comma
dot
id|store
op_assign
id|store
comma
)brace
suffix:semicolon
DECL|variable|ktype_cpufreq
r_static
r_struct
id|kobj_type
id|ktype_cpufreq
op_assign
(brace
dot
id|sysfs_ops
op_assign
op_amp
id|sysfs_ops
comma
dot
id|default_attrs
op_assign
id|default_attrs
comma
dot
id|release
op_assign
id|cpufreq_sysfs_release
comma
)brace
suffix:semicolon
multiline_comment|/**&n; * cpufreq_add_dev - add a CPU device&n; *&n; * Adds the cpufreq interface for a CPU device. &n; */
DECL|function|cpufreq_add_dev
r_static
r_int
id|cpufreq_add_dev
(paren
r_struct
id|sys_device
op_star
id|sys_dev
)paren
(brace
r_int
r_int
id|cpu
op_assign
id|sys_dev-&gt;id
suffix:semicolon
r_int
id|ret
op_assign
l_int|0
suffix:semicolon
r_struct
id|cpufreq_policy
id|new_policy
suffix:semicolon
r_struct
id|cpufreq_policy
op_star
id|policy
suffix:semicolon
r_struct
id|freq_attr
op_star
op_star
id|drv_attr
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|try_module_get
c_func
(paren
id|cpufreq_driver-&gt;owner
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
multiline_comment|/* call driver. From then on the cpufreq must be able&n;&t; * to accept all calls to -&gt;verify and -&gt;setpolicy for this CPU&n;&t; */
id|policy
op_assign
op_amp
id|cpufreq_driver-&gt;policy
(braket
id|cpu
)braket
suffix:semicolon
id|policy-&gt;cpu
op_assign
id|cpu
suffix:semicolon
id|ret
op_assign
id|cpufreq_driver
op_member_access_from_pointer
id|init
c_func
(paren
id|policy
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
r_goto
id|out
suffix:semicolon
multiline_comment|/* set default policy on this CPU */
id|down
c_func
(paren
op_amp
id|cpufreq_driver_sem
)paren
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|new_policy
comma
id|policy
comma
r_sizeof
(paren
r_struct
id|cpufreq_policy
)paren
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|cpufreq_driver_sem
)paren
suffix:semicolon
id|init_MUTEX
c_func
(paren
op_amp
id|policy-&gt;lock
)paren
suffix:semicolon
id|init_completion
c_func
(paren
op_amp
id|policy-&gt;kobj_unregister
)paren
suffix:semicolon
multiline_comment|/* prepare interface data */
id|policy-&gt;kobj.parent
op_assign
op_amp
id|sys_dev-&gt;kobj
suffix:semicolon
id|policy-&gt;kobj.ktype
op_assign
op_amp
id|ktype_cpufreq
suffix:semicolon
id|strlcpy
c_func
(paren
id|policy-&gt;kobj.name
comma
l_string|&quot;cpufreq&quot;
comma
id|KOBJ_NAME_LEN
)paren
suffix:semicolon
id|ret
op_assign
id|kobject_register
c_func
(paren
op_amp
id|policy-&gt;kobj
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
r_goto
id|out
suffix:semicolon
multiline_comment|/* set up files for this cpu device */
id|drv_attr
op_assign
id|cpufreq_driver-&gt;attr
suffix:semicolon
r_while
c_loop
(paren
(paren
id|drv_attr
)paren
op_logical_and
(paren
op_star
id|drv_attr
)paren
)paren
(brace
id|sysfs_create_file
c_func
(paren
op_amp
id|policy-&gt;kobj
comma
op_amp
(paren
(paren
op_star
id|drv_attr
)paren
op_member_access_from_pointer
id|attr
)paren
)paren
suffix:semicolon
id|drv_attr
op_increment
suffix:semicolon
)brace
multiline_comment|/* set default policy */
id|ret
op_assign
id|cpufreq_set_policy
c_func
(paren
op_amp
id|new_policy
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
(brace
id|kobject_unregister
c_func
(paren
op_amp
id|policy-&gt;kobj
)paren
suffix:semicolon
id|wait_for_completion
c_func
(paren
op_amp
id|policy-&gt;kobj_unregister
)paren
suffix:semicolon
)brace
id|out
suffix:colon
id|module_put
c_func
(paren
id|cpufreq_driver-&gt;owner
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
multiline_comment|/**&n; * cpufreq_remove_dev - remove a CPU device&n; *&n; * Removes the cpufreq interface for a CPU device.&n; */
DECL|function|cpufreq_remove_dev
r_static
r_int
id|cpufreq_remove_dev
(paren
r_struct
id|sys_device
op_star
id|sys_dev
)paren
(brace
r_int
r_int
id|cpu
op_assign
id|sys_dev-&gt;id
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|kobject_get
c_func
(paren
op_amp
id|cpufreq_driver-&gt;policy
(braket
id|cpu
)braket
dot
id|kobj
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|down
c_func
(paren
op_amp
id|cpufreq_driver_sem
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|cpufreq_driver-&gt;target
)paren
op_logical_and
(paren
id|cpufreq_driver-&gt;policy
(braket
id|cpu
)braket
dot
id|policy
op_eq
id|CPUFREQ_POLICY_GOVERNOR
)paren
)paren
(brace
id|cpufreq_driver-&gt;policy
(braket
id|cpu
)braket
dot
id|governor
op_member_access_from_pointer
id|governor
c_func
(paren
op_amp
id|cpufreq_driver-&gt;policy
(braket
id|cpu
)braket
comma
id|CPUFREQ_GOV_STOP
)paren
suffix:semicolon
id|module_put
c_func
(paren
id|cpufreq_driver-&gt;policy
(braket
id|cpu
)braket
dot
id|governor-&gt;owner
)paren
suffix:semicolon
)brace
multiline_comment|/* we may call driver-&gt;exit here without checking for try_module_exit&n;&t; * as it&squot;s either the driver which wants to unload or we have a CPU&n;&t; * removal AND driver removal at the same time...&n;&t; */
r_if
c_cond
(paren
id|cpufreq_driver
op_member_access_from_pointer
m_exit
)paren
id|cpufreq_driver
op_member_access_from_pointer
m_exit
(paren
op_amp
id|cpufreq_driver-&gt;policy
(braket
id|cpu
)braket
)paren
suffix:semicolon
id|kobject_unregister
c_func
(paren
op_amp
id|cpufreq_driver-&gt;policy
(braket
id|cpu
)braket
dot
id|kobj
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|cpufreq_driver_sem
)paren
suffix:semicolon
id|kobject_put
c_func
(paren
op_amp
id|cpufreq_driver-&gt;policy
(braket
id|cpu
)braket
dot
id|kobj
)paren
suffix:semicolon
multiline_comment|/* we need to make sure that the underlying kobj is actually&n;&t; * destroyed before we proceed e.g. with cpufreq driver module&n;&t; * unloading&n;&t; */
id|wait_for_completion
c_func
(paren
op_amp
id|cpufreq_driver-&gt;policy
(braket
id|cpu
)braket
dot
id|kobj_unregister
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/**&n; *&t;cpufreq_restore - restore the CPU clock frequency after resume&n; *&n; *&t;Restore the CPU clock frequency so that our idea of the current&n; *&t;frequency reflects the actual hardware.&n; */
DECL|function|cpufreq_restore
r_static
r_int
id|cpufreq_restore
c_func
(paren
r_struct
id|sys_device
op_star
id|sysdev
)paren
(brace
r_int
id|cpu
op_assign
id|sysdev-&gt;id
suffix:semicolon
r_int
r_int
id|ret
op_assign
l_int|0
suffix:semicolon
r_struct
id|cpufreq_policy
id|policy
suffix:semicolon
r_if
c_cond
(paren
id|cpu_online
c_func
(paren
id|cpu
)paren
op_logical_and
id|cpufreq_cpu_get
c_func
(paren
id|cpu
)paren
)paren
(brace
id|down
c_func
(paren
op_amp
id|cpufreq_driver_sem
)paren
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|policy
comma
op_amp
id|cpufreq_driver-&gt;policy
(braket
id|cpu
)braket
comma
r_sizeof
(paren
r_struct
id|cpufreq_policy
)paren
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|cpufreq_driver_sem
)paren
suffix:semicolon
id|ret
op_assign
id|cpufreq_set_policy
c_func
(paren
op_amp
id|policy
)paren
suffix:semicolon
id|cpufreq_cpu_put
c_func
(paren
id|cpu
)paren
suffix:semicolon
)brace
r_return
id|ret
suffix:semicolon
)brace
DECL|variable|cpufreq_sysdev_driver
r_static
r_struct
id|sysdev_driver
id|cpufreq_sysdev_driver
op_assign
(brace
dot
id|add
op_assign
id|cpufreq_add_dev
comma
dot
id|remove
op_assign
id|cpufreq_remove_dev
comma
dot
id|restore
op_assign
id|cpufreq_restore
comma
)brace
suffix:semicolon
multiline_comment|/*********************************************************************&n; *                     NOTIFIER LISTS INTERFACE                      *&n; *********************************************************************/
multiline_comment|/**&n; *&t;cpufreq_register_notifier - register a driver with cpufreq&n; *&t;@nb: notifier function to register&n; *      @list: CPUFREQ_TRANSITION_NOTIFIER or CPUFREQ_POLICY_NOTIFIER&n; *&n; *&t;Add a driver to one of two lists: either a list of drivers that &n; *      are notified about clock rate changes (once before and once after&n; *      the transition), or a list of drivers that are notified about&n; *      changes in cpufreq policy.&n; *&n; *&t;This function may sleep, and has the same return conditions as&n; *&t;notifier_chain_register.&n; */
DECL|function|cpufreq_register_notifier
r_int
id|cpufreq_register_notifier
c_func
(paren
r_struct
id|notifier_block
op_star
id|nb
comma
r_int
r_int
id|list
)paren
(brace
r_int
id|ret
suffix:semicolon
id|down_write
c_func
(paren
op_amp
id|cpufreq_notifier_rwsem
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|list
)paren
(brace
r_case
id|CPUFREQ_TRANSITION_NOTIFIER
suffix:colon
id|ret
op_assign
id|notifier_chain_register
c_func
(paren
op_amp
id|cpufreq_transition_notifier_list
comma
id|nb
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CPUFREQ_POLICY_NOTIFIER
suffix:colon
id|ret
op_assign
id|notifier_chain_register
c_func
(paren
op_amp
id|cpufreq_policy_notifier_list
comma
id|nb
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|ret
op_assign
op_minus
id|EINVAL
suffix:semicolon
)brace
id|up_write
c_func
(paren
op_amp
id|cpufreq_notifier_rwsem
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|variable|cpufreq_register_notifier
id|EXPORT_SYMBOL
c_func
(paren
id|cpufreq_register_notifier
)paren
suffix:semicolon
multiline_comment|/**&n; *&t;cpufreq_unregister_notifier - unregister a driver with cpufreq&n; *&t;@nb: notifier block to be unregistered&n; *      @list: CPUFREQ_TRANSITION_NOTIFIER or CPUFREQ_POLICY_NOTIFIER&n; *&n; *&t;Remove a driver from the CPU frequency notifier list.&n; *&n; *&t;This function may sleep, and has the same return conditions as&n; *&t;notifier_chain_unregister.&n; */
DECL|function|cpufreq_unregister_notifier
r_int
id|cpufreq_unregister_notifier
c_func
(paren
r_struct
id|notifier_block
op_star
id|nb
comma
r_int
r_int
id|list
)paren
(brace
r_int
id|ret
suffix:semicolon
id|down_write
c_func
(paren
op_amp
id|cpufreq_notifier_rwsem
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|list
)paren
(brace
r_case
id|CPUFREQ_TRANSITION_NOTIFIER
suffix:colon
id|ret
op_assign
id|notifier_chain_unregister
c_func
(paren
op_amp
id|cpufreq_transition_notifier_list
comma
id|nb
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CPUFREQ_POLICY_NOTIFIER
suffix:colon
id|ret
op_assign
id|notifier_chain_unregister
c_func
(paren
op_amp
id|cpufreq_policy_notifier_list
comma
id|nb
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|ret
op_assign
op_minus
id|EINVAL
suffix:semicolon
)brace
id|up_write
c_func
(paren
op_amp
id|cpufreq_notifier_rwsem
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|variable|cpufreq_unregister_notifier
id|EXPORT_SYMBOL
c_func
(paren
id|cpufreq_unregister_notifier
)paren
suffix:semicolon
multiline_comment|/*********************************************************************&n; *                              GOVERNORS                            *&n; *********************************************************************/
DECL|function|cpufreq_driver_target
r_inline
r_int
id|cpufreq_driver_target
c_func
(paren
r_struct
id|cpufreq_policy
op_star
id|policy
comma
r_int
r_int
id|target_freq
comma
r_int
r_int
id|relation
)paren
(brace
r_int
r_int
id|ret
suffix:semicolon
r_int
r_int
id|cpu
op_assign
id|policy-&gt;cpu
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cpufreq_cpu_get
c_func
(paren
id|cpu
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|down
c_func
(paren
op_amp
id|cpufreq_driver-&gt;policy
(braket
id|cpu
)braket
dot
id|lock
)paren
suffix:semicolon
id|ret
op_assign
id|cpufreq_driver
op_member_access_from_pointer
id|target
c_func
(paren
id|policy
comma
id|target_freq
comma
id|relation
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|cpufreq_driver-&gt;policy
(braket
id|cpu
)braket
dot
id|lock
)paren
suffix:semicolon
id|cpufreq_cpu_put
c_func
(paren
id|cpu
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|variable|cpufreq_driver_target
id|EXPORT_SYMBOL_GPL
c_func
(paren
id|cpufreq_driver_target
)paren
suffix:semicolon
DECL|function|cpufreq_governor
r_int
id|cpufreq_governor
c_func
(paren
r_int
r_int
id|cpu
comma
r_int
r_int
id|event
)paren
(brace
r_int
id|ret
op_assign
l_int|0
suffix:semicolon
r_struct
id|cpufreq_policy
op_star
id|policy
op_assign
op_amp
id|cpufreq_driver-&gt;policy
(braket
id|cpu
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cpufreq_cpu_get
c_func
(paren
id|cpu
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_switch
c_cond
(paren
id|policy-&gt;policy
)paren
(brace
r_case
id|CPUFREQ_POLICY_POWERSAVE
suffix:colon
r_if
c_cond
(paren
(paren
id|event
op_eq
id|CPUFREQ_GOV_LIMITS
)paren
op_logical_or
(paren
id|event
op_eq
id|CPUFREQ_GOV_START
)paren
)paren
(brace
id|down
c_func
(paren
op_amp
id|cpufreq_driver-&gt;policy
(braket
id|cpu
)braket
dot
id|lock
)paren
suffix:semicolon
id|ret
op_assign
id|cpufreq_driver
op_member_access_from_pointer
id|target
c_func
(paren
id|policy
comma
id|policy-&gt;min
comma
id|CPUFREQ_RELATION_L
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|cpufreq_driver-&gt;policy
(braket
id|cpu
)braket
dot
id|lock
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|CPUFREQ_POLICY_PERFORMANCE
suffix:colon
r_if
c_cond
(paren
(paren
id|event
op_eq
id|CPUFREQ_GOV_LIMITS
)paren
op_logical_or
(paren
id|event
op_eq
id|CPUFREQ_GOV_START
)paren
)paren
(brace
id|down
c_func
(paren
op_amp
id|cpufreq_driver-&gt;policy
(braket
id|cpu
)braket
dot
id|lock
)paren
suffix:semicolon
id|ret
op_assign
id|cpufreq_driver
op_member_access_from_pointer
id|target
c_func
(paren
id|policy
comma
id|policy-&gt;max
comma
id|CPUFREQ_RELATION_H
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|cpufreq_driver-&gt;policy
(braket
id|cpu
)braket
dot
id|lock
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|CPUFREQ_POLICY_GOVERNOR
suffix:colon
id|ret
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|try_module_get
c_func
(paren
id|cpufreq_driver-&gt;policy
(braket
id|cpu
)braket
dot
id|governor-&gt;owner
)paren
)paren
r_break
suffix:semicolon
id|ret
op_assign
id|cpufreq_driver-&gt;policy
(braket
id|cpu
)braket
dot
id|governor
op_member_access_from_pointer
id|governor
c_func
(paren
id|policy
comma
id|event
)paren
suffix:semicolon
multiline_comment|/* we keep one module reference alive for each CPU governed by this CPU */
r_if
c_cond
(paren
(paren
id|event
op_ne
id|CPUFREQ_GOV_START
)paren
op_logical_or
id|ret
)paren
id|module_put
c_func
(paren
id|cpufreq_driver-&gt;policy
(braket
id|cpu
)braket
dot
id|governor-&gt;owner
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|event
op_eq
id|CPUFREQ_GOV_STOP
)paren
op_logical_and
op_logical_neg
id|ret
)paren
id|module_put
c_func
(paren
id|cpufreq_driver-&gt;policy
(braket
id|cpu
)braket
dot
id|governor-&gt;owner
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|ret
op_assign
op_minus
id|EINVAL
suffix:semicolon
)brace
id|cpufreq_cpu_put
c_func
(paren
id|cpu
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|variable|cpufreq_governor
id|EXPORT_SYMBOL_GPL
c_func
(paren
id|cpufreq_governor
)paren
suffix:semicolon
DECL|function|cpufreq_register_governor
r_int
id|cpufreq_register_governor
c_func
(paren
r_struct
id|cpufreq_governor
op_star
id|governor
)paren
(brace
r_struct
id|cpufreq_governor
op_star
id|t
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|governor
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|strnicmp
c_func
(paren
id|governor-&gt;name
comma
l_string|&quot;powersave&quot;
comma
id|CPUFREQ_NAME_LEN
)paren
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|strnicmp
c_func
(paren
id|governor-&gt;name
comma
l_string|&quot;performance&quot;
comma
id|CPUFREQ_NAME_LEN
)paren
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
id|down
c_func
(paren
op_amp
id|cpufreq_governor_sem
)paren
suffix:semicolon
id|list_for_each_entry
c_func
(paren
id|t
comma
op_amp
id|cpufreq_governor_list
comma
id|governor_list
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|strnicmp
c_func
(paren
id|governor-&gt;name
comma
id|t-&gt;name
comma
id|CPUFREQ_NAME_LEN
)paren
)paren
(brace
id|up
c_func
(paren
op_amp
id|cpufreq_governor_sem
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
)brace
id|list_add
c_func
(paren
op_amp
id|governor-&gt;governor_list
comma
op_amp
id|cpufreq_governor_list
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|cpufreq_governor_sem
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|cpufreq_register_governor
id|EXPORT_SYMBOL_GPL
c_func
(paren
id|cpufreq_register_governor
)paren
suffix:semicolon
DECL|function|cpufreq_unregister_governor
r_void
id|cpufreq_unregister_governor
c_func
(paren
r_struct
id|cpufreq_governor
op_star
id|governor
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|governor
)paren
r_return
suffix:semicolon
id|down
c_func
(paren
op_amp
id|cpufreq_governor_sem
)paren
suffix:semicolon
id|list_del
c_func
(paren
op_amp
id|governor-&gt;governor_list
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|cpufreq_governor_sem
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|variable|cpufreq_unregister_governor
id|EXPORT_SYMBOL_GPL
c_func
(paren
id|cpufreq_unregister_governor
)paren
suffix:semicolon
multiline_comment|/*********************************************************************&n; *                          POLICY INTERFACE                         *&n; *********************************************************************/
multiline_comment|/**&n; * cpufreq_get_policy - get the current cpufreq_policy&n; * @policy: struct cpufreq_policy into which the current cpufreq_policy is written&n; *&n; * Reads the current cpufreq policy.&n; */
DECL|function|cpufreq_get_policy
r_int
id|cpufreq_get_policy
c_func
(paren
r_struct
id|cpufreq_policy
op_star
id|policy
comma
r_int
r_int
id|cpu
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|policy
op_logical_or
op_logical_neg
id|cpufreq_cpu_get
c_func
(paren
id|cpu
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|down
c_func
(paren
op_amp
id|cpufreq_driver_sem
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|policy
comma
op_amp
id|cpufreq_driver-&gt;policy
(braket
id|cpu
)braket
comma
r_sizeof
(paren
r_struct
id|cpufreq_policy
)paren
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|cpufreq_driver_sem
)paren
suffix:semicolon
id|cpufreq_cpu_put
c_func
(paren
id|cpu
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|cpufreq_get_policy
id|EXPORT_SYMBOL
c_func
(paren
id|cpufreq_get_policy
)paren
suffix:semicolon
multiline_comment|/**&n; *&t;cpufreq_set_policy - set a new CPUFreq policy&n; *&t;@policy: policy to be set.&n; *&n; *&t;Sets a new CPU frequency and voltage scaling policy.&n; */
DECL|function|cpufreq_set_policy
r_int
id|cpufreq_set_policy
c_func
(paren
r_struct
id|cpufreq_policy
op_star
id|policy
)paren
(brace
r_int
id|ret
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|policy
op_logical_or
op_logical_neg
id|cpufreq_cpu_get
c_func
(paren
id|policy-&gt;cpu
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|down
c_func
(paren
op_amp
id|cpufreq_driver_sem
)paren
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|policy-&gt;cpuinfo
comma
op_amp
id|cpufreq_driver-&gt;policy
(braket
id|policy-&gt;cpu
)braket
dot
id|cpuinfo
comma
r_sizeof
(paren
r_struct
id|cpufreq_cpuinfo
)paren
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|cpufreq_driver_sem
)paren
suffix:semicolon
multiline_comment|/* verify the cpu speed can be set within this limit */
id|ret
op_assign
id|cpufreq_driver
op_member_access_from_pointer
id|verify
c_func
(paren
id|policy
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
r_goto
id|error_out
suffix:semicolon
id|down_read
c_func
(paren
op_amp
id|cpufreq_notifier_rwsem
)paren
suffix:semicolon
multiline_comment|/* adjust if necessary - all reasons */
id|notifier_call_chain
c_func
(paren
op_amp
id|cpufreq_policy_notifier_list
comma
id|CPUFREQ_ADJUST
comma
id|policy
)paren
suffix:semicolon
multiline_comment|/* adjust if necessary - hardware incompatibility*/
id|notifier_call_chain
c_func
(paren
op_amp
id|cpufreq_policy_notifier_list
comma
id|CPUFREQ_INCOMPATIBLE
comma
id|policy
)paren
suffix:semicolon
multiline_comment|/* verify the cpu speed can be set within this limit,&n;&t;   which might be different to the first one */
id|ret
op_assign
id|cpufreq_driver
op_member_access_from_pointer
id|verify
c_func
(paren
id|policy
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
(brace
id|up_read
c_func
(paren
op_amp
id|cpufreq_notifier_rwsem
)paren
suffix:semicolon
r_goto
id|error_out
suffix:semicolon
)brace
multiline_comment|/* notification of the new policy */
id|notifier_call_chain
c_func
(paren
op_amp
id|cpufreq_policy_notifier_list
comma
id|CPUFREQ_NOTIFY
comma
id|policy
)paren
suffix:semicolon
id|up_read
c_func
(paren
op_amp
id|cpufreq_notifier_rwsem
)paren
suffix:semicolon
multiline_comment|/* from here on we limit it to one limit and/or governor change running at the moment */
id|down
c_func
(paren
op_amp
id|cpufreq_driver_sem
)paren
suffix:semicolon
id|cpufreq_driver-&gt;policy
(braket
id|policy-&gt;cpu
)braket
dot
id|min
op_assign
id|policy-&gt;min
suffix:semicolon
id|cpufreq_driver-&gt;policy
(braket
id|policy-&gt;cpu
)braket
dot
id|max
op_assign
id|policy-&gt;max
suffix:semicolon
r_if
c_cond
(paren
id|cpufreq_driver-&gt;setpolicy
)paren
(brace
id|cpufreq_driver-&gt;policy
(braket
id|policy-&gt;cpu
)braket
dot
id|policy
op_assign
id|policy-&gt;policy
suffix:semicolon
id|ret
op_assign
id|cpufreq_driver
op_member_access_from_pointer
id|setpolicy
c_func
(paren
id|policy
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
(paren
id|policy-&gt;policy
op_ne
id|cpufreq_driver-&gt;policy
(braket
id|policy-&gt;cpu
)braket
dot
id|policy
)paren
op_logical_or
(paren
(paren
id|policy-&gt;policy
op_eq
id|CPUFREQ_POLICY_GOVERNOR
)paren
op_logical_and
(paren
id|policy-&gt;governor
op_ne
id|cpufreq_driver-&gt;policy
(braket
id|policy-&gt;cpu
)braket
dot
id|governor
)paren
)paren
)paren
(brace
r_int
r_int
id|old_pol
op_assign
id|cpufreq_driver-&gt;policy
(braket
id|policy-&gt;cpu
)braket
dot
id|policy
suffix:semicolon
r_struct
id|cpufreq_governor
op_star
id|old_gov
op_assign
id|cpufreq_driver-&gt;policy
(braket
id|policy-&gt;cpu
)braket
dot
id|governor
suffix:semicolon
multiline_comment|/* end old governor */
id|cpufreq_governor
c_func
(paren
id|policy-&gt;cpu
comma
id|CPUFREQ_GOV_STOP
)paren
suffix:semicolon
id|cpufreq_driver-&gt;policy
(braket
id|policy-&gt;cpu
)braket
dot
id|policy
op_assign
id|policy-&gt;policy
suffix:semicolon
id|cpufreq_driver-&gt;policy
(braket
id|policy-&gt;cpu
)braket
dot
id|governor
op_assign
id|policy-&gt;governor
suffix:semicolon
multiline_comment|/* start new governor */
r_if
c_cond
(paren
id|cpufreq_governor
c_func
(paren
id|policy-&gt;cpu
comma
id|CPUFREQ_GOV_START
)paren
)paren
(brace
id|cpufreq_driver-&gt;policy
(braket
id|policy-&gt;cpu
)braket
dot
id|policy
op_assign
id|old_pol
suffix:semicolon
id|cpufreq_driver-&gt;policy
(braket
id|policy-&gt;cpu
)braket
dot
id|governor
op_assign
id|old_gov
suffix:semicolon
id|cpufreq_governor
c_func
(paren
id|policy-&gt;cpu
comma
id|CPUFREQ_GOV_START
)paren
suffix:semicolon
)brace
multiline_comment|/* might be a policy change, too */
id|cpufreq_governor
c_func
(paren
id|policy-&gt;cpu
comma
id|CPUFREQ_GOV_LIMITS
)paren
suffix:semicolon
)brace
r_else
(brace
id|cpufreq_governor
c_func
(paren
id|policy-&gt;cpu
comma
id|CPUFREQ_GOV_LIMITS
)paren
suffix:semicolon
)brace
)brace
id|up
c_func
(paren
op_amp
id|cpufreq_driver_sem
)paren
suffix:semicolon
id|error_out
suffix:colon
id|cpufreq_cpu_put
c_func
(paren
id|policy-&gt;cpu
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|variable|cpufreq_set_policy
id|EXPORT_SYMBOL
c_func
(paren
id|cpufreq_set_policy
)paren
suffix:semicolon
multiline_comment|/*********************************************************************&n; *            EXTERNALLY AFFECTING FREQUENCY CHANGES                 *&n; *********************************************************************/
multiline_comment|/**&n; * adjust_jiffies - adjust the system &quot;loops_per_jiffy&quot;&n; *&n; * This function alters the system &quot;loops_per_jiffy&quot; for the clock&n; * speed change. Note that loops_per_jiffy cannot be updated on SMP&n; * systems as each CPU might be scaled differently. So, use the arch &n; * per-CPU loops_per_jiffy value wherever possible.&n; */
macro_line|#ifndef CONFIG_SMP
DECL|variable|l_p_j_ref
r_static
r_int
r_int
id|l_p_j_ref
op_assign
l_int|0
suffix:semicolon
DECL|variable|l_p_j_ref_freq
r_static
r_int
r_int
id|l_p_j_ref_freq
op_assign
l_int|0
suffix:semicolon
DECL|function|adjust_jiffies
r_static
r_inline
r_void
id|adjust_jiffies
c_func
(paren
r_int
r_int
id|val
comma
r_struct
id|cpufreq_freqs
op_star
id|ci
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|l_p_j_ref_freq
)paren
(brace
id|l_p_j_ref
op_assign
id|loops_per_jiffy
suffix:semicolon
id|l_p_j_ref_freq
op_assign
id|ci-&gt;old
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|val
op_eq
id|CPUFREQ_PRECHANGE
op_logical_and
id|ci-&gt;old
OL
id|ci
op_member_access_from_pointer
r_new
)paren
op_logical_or
(paren
id|val
op_eq
id|CPUFREQ_POSTCHANGE
op_logical_and
id|ci-&gt;old
OG
id|ci
op_member_access_from_pointer
r_new
)paren
)paren
id|loops_per_jiffy
op_assign
id|cpufreq_scale
c_func
(paren
id|l_p_j_ref
comma
id|l_p_j_ref_freq
comma
id|ci
op_member_access_from_pointer
r_new
)paren
suffix:semicolon
)brace
macro_line|#else
DECL|macro|adjust_jiffies
mdefine_line|#define adjust_jiffies(x...) do {} while (0)
macro_line|#endif
multiline_comment|/**&n; * cpufreq_notify_transition - call notifier chain and adjust_jiffies on frequency transition&n; *&n; * This function calls the transition notifiers and the &quot;adjust_jiffies&quot; function. It is called&n; * twice on all CPU frequency changes that have external effects. &n; */
DECL|function|cpufreq_notify_transition
r_void
id|cpufreq_notify_transition
c_func
(paren
r_struct
id|cpufreq_freqs
op_star
id|freqs
comma
r_int
r_int
id|state
)paren
(brace
id|down_read
c_func
(paren
op_amp
id|cpufreq_notifier_rwsem
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|state
)paren
(brace
r_case
id|CPUFREQ_PRECHANGE
suffix:colon
id|notifier_call_chain
c_func
(paren
op_amp
id|cpufreq_transition_notifier_list
comma
id|CPUFREQ_PRECHANGE
comma
id|freqs
)paren
suffix:semicolon
id|adjust_jiffies
c_func
(paren
id|CPUFREQ_PRECHANGE
comma
id|freqs
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CPUFREQ_POSTCHANGE
suffix:colon
id|adjust_jiffies
c_func
(paren
id|CPUFREQ_POSTCHANGE
comma
id|freqs
)paren
suffix:semicolon
id|notifier_call_chain
c_func
(paren
op_amp
id|cpufreq_transition_notifier_list
comma
id|CPUFREQ_POSTCHANGE
comma
id|freqs
)paren
suffix:semicolon
id|cpufreq_driver-&gt;policy
(braket
id|freqs-&gt;cpu
)braket
dot
id|cur
op_assign
id|freqs
op_member_access_from_pointer
r_new
suffix:semicolon
r_break
suffix:semicolon
)brace
id|up_read
c_func
(paren
op_amp
id|cpufreq_notifier_rwsem
)paren
suffix:semicolon
)brace
DECL|variable|cpufreq_notify_transition
id|EXPORT_SYMBOL_GPL
c_func
(paren
id|cpufreq_notify_transition
)paren
suffix:semicolon
multiline_comment|/*********************************************************************&n; *               REGISTER / UNREGISTER CPUFREQ DRIVER                *&n; *********************************************************************/
multiline_comment|/**&n; * cpufreq_register_driver - register a CPU Frequency driver&n; * @driver_data: A struct cpufreq_driver containing the values#&n; * submitted by the CPU Frequency driver.&n; *&n; *   Registers a CPU Frequency driver to this core code. This code &n; * returns zero on success, -EBUSY when another driver got here first&n; * (and isn&squot;t unregistered in the meantime). &n; *&n; */
DECL|function|cpufreq_register_driver
r_int
id|cpufreq_register_driver
c_func
(paren
r_struct
id|cpufreq_driver
op_star
id|driver_data
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|driver_data
op_logical_or
op_logical_neg
id|driver_data-&gt;verify
op_logical_or
op_logical_neg
id|driver_data-&gt;init
op_logical_or
(paren
(paren
op_logical_neg
id|driver_data-&gt;setpolicy
)paren
op_logical_and
(paren
op_logical_neg
id|driver_data-&gt;target
)paren
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|down
c_func
(paren
op_amp
id|cpufreq_driver_sem
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cpufreq_driver
)paren
(brace
id|up
c_func
(paren
op_amp
id|cpufreq_driver_sem
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
id|cpufreq_driver
op_assign
id|driver_data
suffix:semicolon
id|up
c_func
(paren
op_amp
id|cpufreq_driver_sem
)paren
suffix:semicolon
id|cpufreq_driver-&gt;policy
op_assign
id|kmalloc
c_func
(paren
id|NR_CPUS
op_star
r_sizeof
(paren
r_struct
id|cpufreq_policy
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cpufreq_driver-&gt;policy
)paren
(brace
id|cpufreq_driver
op_assign
l_int|NULL
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|memset
c_func
(paren
id|cpufreq_driver-&gt;policy
comma
l_int|0
comma
id|NR_CPUS
op_star
r_sizeof
(paren
r_struct
id|cpufreq_policy
)paren
)paren
suffix:semicolon
r_return
id|sysdev_driver_register
c_func
(paren
op_amp
id|cpu_sysdev_class
comma
op_amp
id|cpufreq_sysdev_driver
)paren
suffix:semicolon
)brace
DECL|variable|cpufreq_register_driver
id|EXPORT_SYMBOL_GPL
c_func
(paren
id|cpufreq_register_driver
)paren
suffix:semicolon
multiline_comment|/**&n; * cpufreq_unregister_driver - unregister the current CPUFreq driver&n; *&n; *    Unregister the current CPUFreq driver. Only call this if you have &n; * the right to do so, i.e. if you have succeeded in initialising before!&n; * Returns zero if successful, and -EINVAL if the cpufreq_driver is&n; * currently not initialised.&n; */
DECL|function|cpufreq_unregister_driver
r_int
id|cpufreq_unregister_driver
c_func
(paren
r_struct
id|cpufreq_driver
op_star
id|driver
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|cpufreq_driver
op_logical_or
(paren
id|driver
op_ne
id|cpufreq_driver
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|sysdev_driver_unregister
c_func
(paren
op_amp
id|cpu_sysdev_class
comma
op_amp
id|cpufreq_sysdev_driver
)paren
suffix:semicolon
id|down
c_func
(paren
op_amp
id|cpufreq_driver_sem
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|cpufreq_driver-&gt;policy
)paren
suffix:semicolon
id|cpufreq_driver
op_assign
l_int|NULL
suffix:semicolon
id|up
c_func
(paren
op_amp
id|cpufreq_driver_sem
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|cpufreq_unregister_driver
id|EXPORT_SYMBOL_GPL
c_func
(paren
id|cpufreq_unregister_driver
)paren
suffix:semicolon
eof
