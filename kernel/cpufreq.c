multiline_comment|/*&n; *  linux/kernel/cpufreq.c&n; *&n; *  Copyright (C) 2001 Russell King&n; *            (C) 2002 - 2003 Dominik Brodowski &lt;linux@brodo.de&gt;&n; *&n; *  $Id: cpufreq.c,v 1.59 2003/01/20 17:31:48 db Exp $&n; *&n; * This program is free software; you can redistribute it and/or modify&n; * it under the terms of the GNU General Public License version 2 as&n; * published by the Free Software Foundation.&n; *&n; */
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/notifier.h&gt;
macro_line|#include &lt;linux/cpufreq.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/spinlock.h&gt;
macro_line|#include &lt;linux/device.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
multiline_comment|/**&n; * The &quot;cpufreq driver&quot; - the arch- or hardware-dependend low&n; * level driver of CPUFreq support, and its locking mutex. &n; * cpu_max_freq is in kHz.&n; */
DECL|variable|cpufreq_driver
r_static
r_struct
id|cpufreq_driver
op_star
id|cpufreq_driver
suffix:semicolon
r_static
id|DECLARE_MUTEX
(paren
id|cpufreq_driver_sem
)paren
suffix:semicolon
multiline_comment|/**&n; * Two notifier lists: the &quot;policy&quot; list is involved in the &n; * validation process for a new CPU frequency policy; the &n; * &quot;transition&quot; list for kernel code that needs to handle&n; * changes to devices when the CPU clock speed changes.&n; * The mutex locks both lists. If both cpufreq_driver_sem&n; * and cpufreq_notifier_sem need to be hold, get cpufreq_driver_sem&n; * first.&n; */
DECL|variable|cpufreq_policy_notifier_list
r_static
r_struct
id|notifier_block
op_star
id|cpufreq_policy_notifier_list
suffix:semicolon
DECL|variable|cpufreq_transition_notifier_list
r_static
r_struct
id|notifier_block
op_star
id|cpufreq_transition_notifier_list
suffix:semicolon
r_static
id|DECLARE_MUTEX
(paren
id|cpufreq_notifier_sem
)paren
suffix:semicolon
DECL|variable|cpufreq_governor_list
id|LIST_HEAD
c_func
(paren
id|cpufreq_governor_list
)paren
suffix:semicolon
r_static
r_int
id|cpufreq_governor
c_func
(paren
r_int
r_int
id|cpu
comma
r_int
r_int
id|event
)paren
suffix:semicolon
multiline_comment|/*********************************************************************&n; *                          SYSFS INTERFACE                          *&n; *********************************************************************/
multiline_comment|/**&n; * cpufreq_parse_governor - parse a governor string&n; */
DECL|function|cpufreq_parse_governor
r_int
id|cpufreq_parse_governor
(paren
r_char
op_star
id|str_governor
comma
r_int
r_int
op_star
id|policy
comma
r_struct
id|cpufreq_governor
op_star
op_star
id|governor
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|strnicmp
c_func
(paren
id|str_governor
comma
l_string|&quot;performance&quot;
comma
id|CPUFREQ_NAME_LEN
)paren
)paren
(brace
op_star
id|policy
op_assign
id|CPUFREQ_POLICY_PERFORMANCE
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strnicmp
c_func
(paren
id|str_governor
comma
l_string|&quot;powersave&quot;
comma
id|CPUFREQ_NAME_LEN
)paren
)paren
(brace
op_star
id|policy
op_assign
id|CPUFREQ_POLICY_POWERSAVE
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_else
(brace
r_struct
id|cpufreq_governor
op_star
id|t
suffix:semicolon
id|down
c_func
(paren
op_amp
id|cpufreq_driver_sem
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cpufreq_driver
op_logical_or
op_logical_neg
id|cpufreq_driver-&gt;target
)paren
r_goto
id|out
suffix:semicolon
id|list_for_each_entry
c_func
(paren
id|t
comma
op_amp
id|cpufreq_governor_list
comma
id|governor_list
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|strnicmp
c_func
(paren
id|str_governor
comma
id|t-&gt;name
comma
id|CPUFREQ_NAME_LEN
)paren
)paren
(brace
op_star
id|governor
op_assign
id|t
suffix:semicolon
op_star
id|policy
op_assign
id|CPUFREQ_POLICY_GOVERNOR
suffix:semicolon
id|up
c_func
(paren
op_amp
id|cpufreq_driver_sem
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
id|out
suffix:colon
id|up
c_func
(paren
op_amp
id|cpufreq_driver_sem
)paren
suffix:semicolon
)brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
DECL|variable|cpufreq_parse_governor
id|EXPORT_SYMBOL_GPL
c_func
(paren
id|cpufreq_parse_governor
)paren
suffix:semicolon
multiline_comment|/* forward declarations */
r_static
r_int
id|cpufreq_add_dev
(paren
r_struct
id|device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|cpufreq_remove_dev
(paren
r_struct
id|intf_data
op_star
id|dev
)paren
suffix:semicolon
multiline_comment|/* drivers/base/cpu.c */
r_extern
r_struct
id|device_class
id|cpu_devclass
suffix:semicolon
DECL|variable|cpufreq_interface
r_static
r_struct
id|device_interface
id|cpufreq_interface
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;cpufreq&quot;
comma
dot
id|devclass
op_assign
op_amp
id|cpu_devclass
comma
dot
id|add_device
op_assign
op_amp
id|cpufreq_add_dev
comma
dot
id|remove_device
op_assign
op_amp
id|cpufreq_remove_dev
comma
dot
id|kset
op_assign
(brace
dot
id|subsys
op_assign
op_amp
id|cpu_devclass.subsys
comma
)brace
comma
dot
id|devnum
op_assign
l_int|0
comma
)brace
suffix:semicolon
DECL|function|to_cpu_nr
r_static
r_inline
r_int
id|to_cpu_nr
(paren
r_struct
id|device
op_star
id|dev
)paren
(brace
r_struct
id|sys_device
op_star
id|cpu_sys_dev
op_assign
id|container_of
c_func
(paren
id|dev
comma
r_struct
id|sys_device
comma
id|dev
)paren
suffix:semicolon
r_return
(paren
id|cpu_sys_dev-&gt;id
)paren
suffix:semicolon
)brace
multiline_comment|/**&n; * cpufreq_per_cpu_attr_read() / show_##file_name() - print out cpufreq information&n; *&n; * Write out information from cpufreq_driver-&gt;policy[cpu]; object must be&n; * &quot;unsigned int&quot;.&n; */
DECL|macro|cpufreq_per_cpu_attr_read
mdefine_line|#define cpufreq_per_cpu_attr_read(file_name, object) &t;&t;&t;&bslash;&n;static ssize_t show_##file_name &t;&t;&t;&t;&t;&bslash;&n;(struct device *dev, char *buf)&t;&t;&t;&t;&t;&t;&bslash;&n;{&t;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;unsigned int value = 0;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;if (!dev)&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&t;return 0;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;down(&amp;cpufreq_driver_sem);&t;&t;&t;&t;&t;&bslash;&n;&t;if (cpufreq_driver)&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&t;value = cpufreq_driver-&gt;policy[to_cpu_nr(dev)].object;&t;&bslash;&n;&t;up(&amp;cpufreq_driver_sem);&t;&t;&t;&t;&t;&bslash;&n;&t;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;return sprintf (buf, &quot;%u&bslash;n&quot;, value);&t;&t;&t;&t;&bslash;&n;}
multiline_comment|/**&n; * cpufreq_per_cpu_attr_write() / store_##file_name() - sysfs write access&n; */
DECL|macro|cpufreq_per_cpu_attr_write
mdefine_line|#define cpufreq_per_cpu_attr_write(file_name, object)&t;&t;&t;&bslash;&n;static ssize_t store_##file_name&t;&t;&t;&t;&t;&bslash;&n;(struct device *dev, const char *buf, size_t count)&t;&t;&t;&bslash;&n;{&t;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;unsigned int ret = -EINVAL;&t;&t;&t;&t;&t;&bslash;&n;&t;struct cpufreq_policy policy;&t;&t;&t;&t;&t;&bslash;&n;&t;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;if (!dev)&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&t;return 0;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;ret = cpufreq_get_policy(&amp;policy, to_cpu_nr(dev));&t;&t;&bslash;&n;&t;if (ret)&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&t;return ret;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;ret = sscanf (buf, &quot;%u&quot;, &amp;policy.object);&t;&t;&t;&bslash;&n;&t;if (ret != 1)&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&t;return -EINVAL;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;ret = cpufreq_set_policy(&amp;policy);&t;&t;&t;&t;&bslash;&n;&t;if (ret)&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&t;return ret;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;return count;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;}
multiline_comment|/**&n; * show_scaling_governor - show the current policy for the specified CPU&n; */
DECL|function|show_scaling_governor
r_static
id|ssize_t
id|show_scaling_governor
(paren
r_struct
id|device
op_star
id|dev
comma
r_char
op_star
id|buf
)paren
(brace
r_int
r_int
id|value
op_assign
l_int|0
suffix:semicolon
r_char
id|value2
(braket
id|CPUFREQ_NAME_LEN
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev
)paren
r_return
l_int|0
suffix:semicolon
id|down
c_func
(paren
op_amp
id|cpufreq_driver_sem
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cpufreq_driver
)paren
id|value
op_assign
id|cpufreq_driver-&gt;policy
(braket
id|to_cpu_nr
c_func
(paren
id|dev
)paren
)braket
dot
id|policy
suffix:semicolon
r_if
c_cond
(paren
id|value
op_eq
id|CPUFREQ_POLICY_GOVERNOR
)paren
id|strncpy
c_func
(paren
id|value2
comma
id|cpufreq_driver-&gt;policy
(braket
id|to_cpu_nr
c_func
(paren
id|dev
)paren
)braket
dot
id|governor-&gt;name
comma
id|CPUFREQ_NAME_LEN
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|cpufreq_driver_sem
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|value
)paren
(brace
r_case
id|CPUFREQ_POLICY_POWERSAVE
suffix:colon
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;powersave&bslash;n&quot;
)paren
suffix:semicolon
r_case
id|CPUFREQ_POLICY_PERFORMANCE
suffix:colon
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;performance&bslash;n&quot;
)paren
suffix:semicolon
r_case
id|CPUFREQ_POLICY_GOVERNOR
suffix:colon
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%s&bslash;n&quot;
comma
id|value2
)paren
suffix:semicolon
)brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
multiline_comment|/**&n; * store_scaling_governor - store policy for the specified CPU&n; */
r_static
id|ssize_t
DECL|function|store_scaling_governor
id|store_scaling_governor
(paren
r_struct
id|device
op_star
id|dev
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
)paren
(brace
r_int
r_int
id|ret
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_char
id|str_governor
(braket
l_int|16
)braket
suffix:semicolon
r_struct
id|cpufreq_policy
id|policy
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev
)paren
r_return
l_int|0
suffix:semicolon
id|ret
op_assign
id|cpufreq_get_policy
c_func
(paren
op_amp
id|policy
comma
id|to_cpu_nr
c_func
(paren
id|dev
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
r_return
id|ret
suffix:semicolon
id|ret
op_assign
id|sscanf
(paren
id|buf
comma
l_string|&quot;%15s&quot;
comma
id|str_governor
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
op_ne
l_int|1
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|cpufreq_parse_governor
c_func
(paren
id|str_governor
comma
op_amp
id|policy.policy
comma
op_amp
id|policy.governor
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|ret
op_assign
id|cpufreq_set_policy
c_func
(paren
op_amp
id|policy
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
r_return
id|ret
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
multiline_comment|/**&n; * show_scaling_governor - show the current policy for the specified CPU&n; */
DECL|function|show_scaling_driver
r_static
id|ssize_t
id|show_scaling_driver
(paren
r_struct
id|device
op_star
id|dev
comma
r_char
op_star
id|buf
)paren
(brace
r_char
id|value
(braket
id|CPUFREQ_NAME_LEN
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev
)paren
r_return
l_int|0
suffix:semicolon
id|down
c_func
(paren
op_amp
id|cpufreq_driver_sem
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cpufreq_driver
)paren
id|strncpy
c_func
(paren
id|value
comma
id|cpufreq_driver-&gt;name
comma
id|CPUFREQ_NAME_LEN
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|cpufreq_driver_sem
)paren
suffix:semicolon
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%s&bslash;n&quot;
comma
id|value
)paren
suffix:semicolon
)brace
multiline_comment|/**&n; * show_available_govs - show the available CPUfreq governors&n; */
DECL|function|show_available_govs
r_static
id|ssize_t
id|show_available_govs
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_char
op_star
id|buf
)paren
(brace
id|ssize_t
id|i
op_assign
l_int|0
suffix:semicolon
r_struct
id|cpufreq_governor
op_star
id|t
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev
)paren
r_return
l_int|0
suffix:semicolon
id|i
op_add_assign
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;performance powersave&quot;
)paren
suffix:semicolon
id|down
c_func
(paren
op_amp
id|cpufreq_driver_sem
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cpufreq_driver
op_logical_or
op_logical_neg
id|cpufreq_driver-&gt;target
)paren
r_goto
id|out
suffix:semicolon
id|list_for_each_entry
c_func
(paren
id|t
comma
op_amp
id|cpufreq_governor_list
comma
id|governor_list
)paren
(brace
r_if
c_cond
(paren
id|i
op_ge
(paren
id|ssize_t
)paren
(paren
(paren
id|PAGE_SIZE
op_div
r_sizeof
(paren
r_char
)paren
)paren
op_minus
(paren
id|CPUFREQ_NAME_LEN
op_plus
l_int|2
)paren
)paren
)paren
r_goto
id|out
suffix:semicolon
id|i
op_add_assign
id|snprintf
c_func
(paren
op_amp
id|buf
(braket
id|i
)braket
comma
id|CPUFREQ_NAME_LEN
comma
l_string|&quot; %s&quot;
comma
id|t-&gt;name
)paren
suffix:semicolon
)brace
id|out
suffix:colon
id|up
c_func
(paren
op_amp
id|cpufreq_driver_sem
)paren
suffix:semicolon
id|i
op_add_assign
id|sprintf
c_func
(paren
op_amp
id|buf
(braket
id|i
)braket
comma
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|i
suffix:semicolon
)brace
multiline_comment|/**&n; * cpufreq_per_cpu_attr_ro - read-only cpufreq per-CPU file&n; */
DECL|macro|cpufreq_per_cpu_attr_ro
mdefine_line|#define cpufreq_per_cpu_attr_ro(file_name, object)&t;&t;&t;&bslash;&n;cpufreq_per_cpu_attr_read(file_name, object) &t;&t;&t;&t;&bslash;&n;static DEVICE_ATTR(file_name, S_IRUGO, show_##file_name, NULL);
multiline_comment|/**&n; * cpufreq_per_cpu_attr_rw - read-write cpufreq per-CPU file&n; */
DECL|macro|cpufreq_per_cpu_attr_rw
mdefine_line|#define cpufreq_per_cpu_attr_rw(file_name, object) &t;&t;&t;&bslash;&n;cpufreq_per_cpu_attr_read(file_name, object) &t;&t;&t;&t;&bslash;&n;cpufreq_per_cpu_attr_write(file_name, object) &t;&t;&t;&t;&bslash;&n;static DEVICE_ATTR(file_name, (S_IRUGO | S_IWUSR), show_##file_name, store_##file_name);
multiline_comment|/* create the file functions */
id|cpufreq_per_cpu_attr_ro
c_func
(paren
id|cpuinfo_min_freq
comma
id|cpuinfo.min_freq
)paren
suffix:semicolon
id|cpufreq_per_cpu_attr_ro
c_func
(paren
id|cpuinfo_max_freq
comma
id|cpuinfo.max_freq
)paren
suffix:semicolon
id|cpufreq_per_cpu_attr_rw
c_func
(paren
id|scaling_min_freq
comma
id|min
)paren
suffix:semicolon
id|cpufreq_per_cpu_attr_rw
c_func
(paren
id|scaling_max_freq
comma
id|max
)paren
suffix:semicolon
r_static
id|DEVICE_ATTR
c_func
(paren
id|scaling_governor
comma
(paren
id|S_IRUGO
op_or
id|S_IWUSR
)paren
comma
id|show_scaling_governor
comma
id|store_scaling_governor
)paren
suffix:semicolon
r_static
id|DEVICE_ATTR
c_func
(paren
id|scaling_driver
comma
id|S_IRUGO
comma
id|show_scaling_driver
comma
l_int|NULL
)paren
suffix:semicolon
r_static
id|DEVICE_ATTR
c_func
(paren
id|available_scaling_governors
comma
id|S_IRUGO
comma
id|show_available_govs
comma
l_int|NULL
)paren
suffix:semicolon
multiline_comment|/**&n; * cpufreq_add_dev - add a CPU device&n; *&n; * Adds the cpufreq interface for a CPU device. &n; */
DECL|function|cpufreq_add_dev
r_static
r_int
id|cpufreq_add_dev
(paren
r_struct
id|device
op_star
id|dev
)paren
(brace
r_int
r_int
id|cpu
op_assign
id|to_cpu_nr
c_func
(paren
id|dev
)paren
suffix:semicolon
r_int
id|ret
op_assign
l_int|0
suffix:semicolon
r_struct
id|cpufreq_policy
id|policy
suffix:semicolon
id|down
c_func
(paren
op_amp
id|cpufreq_driver_sem
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cpufreq_driver
)paren
(brace
id|up
c_func
(paren
op_amp
id|cpufreq_driver_sem
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
multiline_comment|/* call driver. From then on the cpufreq must be able&n;&t; * to accept all calls to -&gt;verify and -&gt;setpolicy for this CPU&n;&t; */
id|cpufreq_driver-&gt;policy
(braket
id|cpu
)braket
dot
id|cpu
op_assign
id|cpu
suffix:semicolon
r_if
c_cond
(paren
id|cpufreq_driver-&gt;init
)paren
(brace
id|ret
op_assign
id|cpufreq_driver
op_member_access_from_pointer
id|init
c_func
(paren
op_amp
id|cpufreq_driver-&gt;policy
(braket
id|cpu
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
(brace
id|up
c_func
(paren
op_amp
id|cpufreq_driver_sem
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
)brace
multiline_comment|/* set default policy on this CPU */
id|memcpy
c_func
(paren
op_amp
id|policy
comma
op_amp
id|cpufreq_driver-&gt;policy
(braket
id|cpu
)braket
comma
r_sizeof
(paren
r_struct
id|cpufreq_policy
)paren
)paren
suffix:semicolon
multiline_comment|/* 2.4-API init for this CPU */
macro_line|#ifdef CONFIG_CPU_FREQ_24_API
id|cpu_min_freq
(braket
id|cpu
)braket
op_assign
id|cpufreq_driver-&gt;policy
(braket
id|cpu
)braket
dot
id|cpuinfo.min_freq
suffix:semicolon
id|cpu_max_freq
(braket
id|cpu
)braket
op_assign
id|cpufreq_driver-&gt;policy
(braket
id|cpu
)braket
dot
id|cpuinfo.max_freq
suffix:semicolon
id|cpu_cur_freq
(braket
id|cpu
)braket
op_assign
id|cpufreq_driver-&gt;cpu_cur_freq
(braket
id|cpu
)braket
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|cpufreq_driver-&gt;target
)paren
id|cpufreq_governor
c_func
(paren
id|cpu
comma
id|CPUFREQ_GOV_START
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|cpufreq_driver_sem
)paren
suffix:semicolon
id|ret
op_assign
id|cpufreq_set_policy
c_func
(paren
op_amp
id|policy
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|down
c_func
(paren
op_amp
id|cpufreq_driver_sem
)paren
suffix:semicolon
multiline_comment|/* prepare interface data */
id|cpufreq_driver-&gt;policy
(braket
id|cpu
)braket
dot
id|intf.dev
op_assign
id|dev
suffix:semicolon
id|cpufreq_driver-&gt;policy
(braket
id|cpu
)braket
dot
id|intf.intf
op_assign
op_amp
id|cpufreq_interface
suffix:semicolon
id|strncpy
c_func
(paren
id|cpufreq_driver-&gt;policy
(braket
id|cpu
)braket
dot
id|intf.kobj.name
comma
id|cpufreq_interface.name
comma
id|KOBJ_NAME_LEN
)paren
suffix:semicolon
id|cpufreq_driver-&gt;policy
(braket
id|cpu
)braket
dot
id|intf.kobj.parent
op_assign
op_amp
(paren
id|dev-&gt;kobj
)paren
suffix:semicolon
id|cpufreq_driver-&gt;policy
(braket
id|cpu
)braket
dot
id|intf.kobj.kset
op_assign
op_amp
(paren
id|cpufreq_interface.kset
)paren
suffix:semicolon
multiline_comment|/* add interface */
multiline_comment|/* currently commented out due to deadlock */
singleline_comment|//ret = interface_add_data(&amp;(cpufreq_driver-&gt;policy[cpu].intf));
r_if
c_cond
(paren
id|ret
)paren
(brace
id|up
c_func
(paren
op_amp
id|cpufreq_driver_sem
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
multiline_comment|/* create files */
id|device_create_file
(paren
id|dev
comma
op_amp
id|dev_attr_cpuinfo_min_freq
)paren
suffix:semicolon
id|device_create_file
(paren
id|dev
comma
op_amp
id|dev_attr_cpuinfo_max_freq
)paren
suffix:semicolon
id|device_create_file
(paren
id|dev
comma
op_amp
id|dev_attr_scaling_min_freq
)paren
suffix:semicolon
id|device_create_file
(paren
id|dev
comma
op_amp
id|dev_attr_scaling_max_freq
)paren
suffix:semicolon
id|device_create_file
(paren
id|dev
comma
op_amp
id|dev_attr_scaling_governor
)paren
suffix:semicolon
id|device_create_file
(paren
id|dev
comma
op_amp
id|dev_attr_scaling_driver
)paren
suffix:semicolon
id|device_create_file
(paren
id|dev
comma
op_amp
id|dev_attr_available_scaling_governors
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|cpufreq_driver_sem
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
multiline_comment|/**&n; * cpufreq_remove_dev - remove a CPU device&n; *&n; * Removes the cpufreq interface for a CPU device. Is called with&n; * cpufreq_driver_sem locked.&n; */
DECL|function|cpufreq_remove_dev
r_static
r_int
id|cpufreq_remove_dev
(paren
r_struct
id|intf_data
op_star
id|intf
)paren
(brace
r_struct
id|device
op_star
id|dev
op_assign
id|intf-&gt;dev
suffix:semicolon
r_int
r_int
id|cpu
op_assign
id|to_cpu_nr
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cpufreq_driver-&gt;target
)paren
id|cpufreq_governor
c_func
(paren
id|cpu
comma
id|CPUFREQ_GOV_STOP
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cpufreq_driver
op_member_access_from_pointer
m_exit
)paren
id|cpufreq_driver
op_member_access_from_pointer
m_exit
(paren
op_amp
id|cpufreq_driver-&gt;policy
(braket
id|cpu
)braket
)paren
suffix:semicolon
id|device_remove_file
(paren
id|dev
comma
op_amp
id|dev_attr_cpuinfo_min_freq
)paren
suffix:semicolon
id|device_remove_file
(paren
id|dev
comma
op_amp
id|dev_attr_cpuinfo_max_freq
)paren
suffix:semicolon
id|device_remove_file
(paren
id|dev
comma
op_amp
id|dev_attr_scaling_min_freq
)paren
suffix:semicolon
id|device_remove_file
(paren
id|dev
comma
op_amp
id|dev_attr_scaling_max_freq
)paren
suffix:semicolon
id|device_remove_file
(paren
id|dev
comma
op_amp
id|dev_attr_scaling_governor
)paren
suffix:semicolon
id|device_remove_file
(paren
id|dev
comma
op_amp
id|dev_attr_scaling_driver
)paren
suffix:semicolon
id|device_remove_file
(paren
id|dev
comma
op_amp
id|dev_attr_available_scaling_governors
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*********************************************************************&n; *                     NOTIFIER LISTS INTERFACE                      *&n; *********************************************************************/
multiline_comment|/**&n; *&t;cpufreq_register_notifier - register a driver with cpufreq&n; *&t;@nb: notifier function to register&n; *      @list: CPUFREQ_TRANSITION_NOTIFIER or CPUFREQ_POLICY_NOTIFIER&n; *&n; *&t;Add a driver to one of two lists: either a list of drivers that &n; *      are notified about clock rate changes (once before and once after&n; *      the transition), or a list of drivers that are notified about&n; *      changes in cpufreq policy.&n; *&n; *&t;This function may sleep, and has the same return conditions as&n; *&t;notifier_chain_register.&n; */
DECL|function|cpufreq_register_notifier
r_int
id|cpufreq_register_notifier
c_func
(paren
r_struct
id|notifier_block
op_star
id|nb
comma
r_int
r_int
id|list
)paren
(brace
r_int
id|ret
suffix:semicolon
id|down
c_func
(paren
op_amp
id|cpufreq_notifier_sem
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|list
)paren
(brace
r_case
id|CPUFREQ_TRANSITION_NOTIFIER
suffix:colon
id|ret
op_assign
id|notifier_chain_register
c_func
(paren
op_amp
id|cpufreq_transition_notifier_list
comma
id|nb
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CPUFREQ_POLICY_NOTIFIER
suffix:colon
id|ret
op_assign
id|notifier_chain_register
c_func
(paren
op_amp
id|cpufreq_policy_notifier_list
comma
id|nb
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|ret
op_assign
op_minus
id|EINVAL
suffix:semicolon
)brace
id|up
c_func
(paren
op_amp
id|cpufreq_notifier_sem
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|variable|cpufreq_register_notifier
id|EXPORT_SYMBOL
c_func
(paren
id|cpufreq_register_notifier
)paren
suffix:semicolon
multiline_comment|/**&n; *&t;cpufreq_unregister_notifier - unregister a driver with cpufreq&n; *&t;@nb: notifier block to be unregistered&n; *      @list: CPUFREQ_TRANSITION_NOTIFIER or CPUFREQ_POLICY_NOTIFIER&n; *&n; *&t;Remove a driver from the CPU frequency notifier list.&n; *&n; *&t;This function may sleep, and has the same return conditions as&n; *&t;notifier_chain_unregister.&n; */
DECL|function|cpufreq_unregister_notifier
r_int
id|cpufreq_unregister_notifier
c_func
(paren
r_struct
id|notifier_block
op_star
id|nb
comma
r_int
r_int
id|list
)paren
(brace
r_int
id|ret
suffix:semicolon
id|down
c_func
(paren
op_amp
id|cpufreq_notifier_sem
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|list
)paren
(brace
r_case
id|CPUFREQ_TRANSITION_NOTIFIER
suffix:colon
id|ret
op_assign
id|notifier_chain_unregister
c_func
(paren
op_amp
id|cpufreq_transition_notifier_list
comma
id|nb
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CPUFREQ_POLICY_NOTIFIER
suffix:colon
id|ret
op_assign
id|notifier_chain_unregister
c_func
(paren
op_amp
id|cpufreq_policy_notifier_list
comma
id|nb
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|ret
op_assign
op_minus
id|EINVAL
suffix:semicolon
)brace
id|up
c_func
(paren
op_amp
id|cpufreq_notifier_sem
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|variable|cpufreq_unregister_notifier
id|EXPORT_SYMBOL
c_func
(paren
id|cpufreq_unregister_notifier
)paren
suffix:semicolon
multiline_comment|/*********************************************************************&n; *                              GOVERNORS                            *&n; *********************************************************************/
DECL|function|cpufreq_driver_target_l
r_inline
r_int
id|cpufreq_driver_target_l
c_func
(paren
r_struct
id|cpufreq_policy
op_star
id|policy
comma
r_int
r_int
id|target_freq
comma
r_int
r_int
id|relation
)paren
(brace
r_int
r_int
id|ret
suffix:semicolon
id|down
c_func
(paren
op_amp
id|cpufreq_driver_sem
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cpufreq_driver
)paren
id|ret
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_else
id|ret
op_assign
id|cpufreq_driver
op_member_access_from_pointer
id|target
c_func
(paren
id|policy
comma
id|target_freq
comma
id|relation
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|cpufreq_driver_sem
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|variable|cpufreq_driver_target_l
id|EXPORT_SYMBOL_GPL
c_func
(paren
id|cpufreq_driver_target_l
)paren
suffix:semicolon
DECL|function|cpufreq_driver_target
r_inline
r_int
id|cpufreq_driver_target
c_func
(paren
r_struct
id|cpufreq_policy
op_star
id|policy
comma
r_int
r_int
id|target_freq
comma
r_int
r_int
id|relation
)paren
(brace
r_return
id|cpufreq_driver
op_member_access_from_pointer
id|target
c_func
(paren
id|policy
comma
id|target_freq
comma
id|relation
)paren
suffix:semicolon
)brace
DECL|variable|cpufreq_driver_target
id|EXPORT_SYMBOL_GPL
c_func
(paren
id|cpufreq_driver_target
)paren
suffix:semicolon
DECL|function|cpufreq_governor
r_static
r_int
id|cpufreq_governor
c_func
(paren
r_int
r_int
id|cpu
comma
r_int
r_int
id|event
)paren
(brace
r_int
id|ret
op_assign
l_int|0
suffix:semicolon
r_struct
id|cpufreq_policy
op_star
id|policy
op_assign
op_amp
id|cpufreq_driver-&gt;policy
(braket
id|cpu
)braket
suffix:semicolon
r_switch
c_cond
(paren
id|policy-&gt;policy
)paren
(brace
r_case
id|CPUFREQ_POLICY_POWERSAVE
suffix:colon
r_if
c_cond
(paren
(paren
id|event
op_eq
id|CPUFREQ_GOV_LIMITS
)paren
op_logical_or
(paren
id|event
op_eq
id|CPUFREQ_GOV_START
)paren
)paren
id|ret
op_assign
id|cpufreq_driver
op_member_access_from_pointer
id|target
c_func
(paren
id|policy
comma
id|policy-&gt;min
comma
id|CPUFREQ_RELATION_L
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CPUFREQ_POLICY_PERFORMANCE
suffix:colon
r_if
c_cond
(paren
(paren
id|event
op_eq
id|CPUFREQ_GOV_LIMITS
)paren
op_logical_or
(paren
id|event
op_eq
id|CPUFREQ_GOV_START
)paren
)paren
id|ret
op_assign
id|cpufreq_driver
op_member_access_from_pointer
id|target
c_func
(paren
id|policy
comma
id|policy-&gt;max
comma
id|CPUFREQ_RELATION_H
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CPUFREQ_POLICY_GOVERNOR
suffix:colon
id|ret
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|event
op_eq
id|CPUFREQ_GOV_START
)paren
r_if
c_cond
(paren
op_logical_neg
id|try_module_get
c_func
(paren
id|cpufreq_driver-&gt;policy
(braket
id|cpu
)braket
dot
id|governor-&gt;owner
)paren
)paren
r_break
suffix:semicolon
id|ret
op_assign
id|cpufreq_driver-&gt;policy
(braket
id|cpu
)braket
dot
id|governor
op_member_access_from_pointer
id|governor
c_func
(paren
id|policy
comma
id|event
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|event
op_eq
id|CPUFREQ_GOV_STOP
)paren
op_logical_or
(paren
id|ret
op_logical_and
(paren
id|event
op_eq
id|CPUFREQ_GOV_START
)paren
)paren
)paren
id|module_put
c_func
(paren
id|cpufreq_driver-&gt;policy
(braket
id|cpu
)braket
dot
id|governor-&gt;owner
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|ret
op_assign
op_minus
id|EINVAL
suffix:semicolon
)brace
r_return
id|ret
suffix:semicolon
)brace
DECL|function|cpufreq_governor_l
r_int
id|cpufreq_governor_l
c_func
(paren
r_int
r_int
id|cpu
comma
r_int
r_int
id|event
)paren
(brace
r_int
id|ret
op_assign
l_int|0
suffix:semicolon
id|down
c_func
(paren
op_amp
id|cpufreq_driver_sem
)paren
suffix:semicolon
id|ret
op_assign
id|cpufreq_governor
c_func
(paren
id|cpu
comma
id|event
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|cpufreq_driver_sem
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|variable|cpufreq_governor_l
id|EXPORT_SYMBOL_GPL
c_func
(paren
id|cpufreq_governor_l
)paren
suffix:semicolon
DECL|function|cpufreq_register_governor
r_int
id|cpufreq_register_governor
c_func
(paren
r_struct
id|cpufreq_governor
op_star
id|governor
)paren
(brace
r_struct
id|cpufreq_governor
op_star
id|t
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|governor
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|strnicmp
c_func
(paren
id|governor-&gt;name
comma
l_string|&quot;powersave&quot;
comma
id|CPUFREQ_NAME_LEN
)paren
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|strnicmp
c_func
(paren
id|governor-&gt;name
comma
l_string|&quot;performance&quot;
comma
id|CPUFREQ_NAME_LEN
)paren
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
id|down
c_func
(paren
op_amp
id|cpufreq_driver_sem
)paren
suffix:semicolon
id|list_for_each_entry
c_func
(paren
id|t
comma
op_amp
id|cpufreq_governor_list
comma
id|governor_list
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|strnicmp
c_func
(paren
id|governor-&gt;name
comma
id|t-&gt;name
comma
id|CPUFREQ_NAME_LEN
)paren
)paren
(brace
id|up
c_func
(paren
op_amp
id|cpufreq_driver_sem
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
)brace
id|list_add
c_func
(paren
op_amp
id|governor-&gt;governor_list
comma
op_amp
id|cpufreq_governor_list
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|cpufreq_driver_sem
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|cpufreq_register_governor
id|EXPORT_SYMBOL_GPL
c_func
(paren
id|cpufreq_register_governor
)paren
suffix:semicolon
DECL|function|cpufreq_unregister_governor
r_void
id|cpufreq_unregister_governor
c_func
(paren
r_struct
id|cpufreq_governor
op_star
id|governor
)paren
(brace
r_int
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|governor
)paren
r_return
suffix:semicolon
id|down
c_func
(paren
op_amp
id|cpufreq_driver_sem
)paren
suffix:semicolon
multiline_comment|/* &n;&t; * Unless the user uses rmmod -f, we can be safe. But we never&n;&t; * know, so check whether if it&squot;s currently used. If so,&n;&t; * stop it and replace it with the default governor.&n;&t; */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NR_CPUS
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|cpufreq_driver
op_logical_and
(paren
id|cpufreq_driver-&gt;policy
(braket
id|i
)braket
dot
id|policy
op_eq
id|CPUFREQ_POLICY_GOVERNOR
)paren
op_logical_and
(paren
id|cpufreq_driver-&gt;policy
(braket
id|i
)braket
dot
id|governor
op_eq
id|governor
)paren
)paren
(brace
id|cpufreq_governor
c_func
(paren
id|i
comma
id|CPUFREQ_GOV_STOP
)paren
suffix:semicolon
id|cpufreq_driver-&gt;policy
(braket
id|i
)braket
dot
id|policy
op_assign
id|CPUFREQ_POLICY_PERFORMANCE
suffix:semicolon
id|cpufreq_governor
c_func
(paren
id|i
comma
id|CPUFREQ_GOV_START
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* now we can safely remove it from the list */
id|list_del
c_func
(paren
op_amp
id|governor-&gt;governor_list
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|cpufreq_driver_sem
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|variable|cpufreq_unregister_governor
id|EXPORT_SYMBOL_GPL
c_func
(paren
id|cpufreq_unregister_governor
)paren
suffix:semicolon
multiline_comment|/*********************************************************************&n; *                          POLICY INTERFACE                         *&n; *********************************************************************/
multiline_comment|/**&n; * cpufreq_get_policy - get the current cpufreq_policy&n; * @policy: struct cpufreq_policy into which the current cpufreq_policy is written&n; *&n; * Reads the current cpufreq policy.&n; */
DECL|function|cpufreq_get_policy
r_int
id|cpufreq_get_policy
c_func
(paren
r_struct
id|cpufreq_policy
op_star
id|policy
comma
r_int
r_int
id|cpu
)paren
(brace
id|down
c_func
(paren
op_amp
id|cpufreq_driver_sem
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cpufreq_driver
op_logical_or
op_logical_neg
id|policy
op_logical_or
(paren
id|cpu
op_ge
id|NR_CPUS
)paren
op_logical_or
(paren
op_logical_neg
id|cpu_online
c_func
(paren
id|cpu
)paren
)paren
)paren
(brace
id|up
c_func
(paren
op_amp
id|cpufreq_driver_sem
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|memcpy
c_func
(paren
id|policy
comma
op_amp
id|cpufreq_driver-&gt;policy
(braket
id|cpu
)braket
comma
r_sizeof
(paren
r_struct
id|cpufreq_policy
)paren
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|cpufreq_driver_sem
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|cpufreq_get_policy
id|EXPORT_SYMBOL
c_func
(paren
id|cpufreq_get_policy
)paren
suffix:semicolon
multiline_comment|/**&n; *&t;cpufreq_set_policy - set a new CPUFreq policy&n; *&t;@policy: policy to be set.&n; *&n; *&t;Sets a new CPU frequency and voltage scaling policy.&n; */
DECL|function|cpufreq_set_policy
r_int
id|cpufreq_set_policy
c_func
(paren
r_struct
id|cpufreq_policy
op_star
id|policy
)paren
(brace
r_int
id|ret
suffix:semicolon
id|down
c_func
(paren
op_amp
id|cpufreq_driver_sem
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cpufreq_driver
op_logical_or
op_logical_neg
id|policy
op_logical_or
(paren
id|policy-&gt;cpu
op_ge
id|NR_CPUS
)paren
op_logical_or
(paren
op_logical_neg
id|cpu_online
c_func
(paren
id|policy-&gt;cpu
)paren
)paren
)paren
(brace
id|up
c_func
(paren
op_amp
id|cpufreq_driver_sem
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|memcpy
c_func
(paren
op_amp
id|policy-&gt;cpuinfo
comma
op_amp
id|cpufreq_driver-&gt;policy
(braket
id|policy-&gt;cpu
)braket
dot
id|cpuinfo
comma
r_sizeof
(paren
r_struct
id|cpufreq_cpuinfo
)paren
)paren
suffix:semicolon
multiline_comment|/* verify the cpu speed can be set within this limit */
id|ret
op_assign
id|cpufreq_driver
op_member_access_from_pointer
id|verify
c_func
(paren
id|policy
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
(brace
id|up
c_func
(paren
op_amp
id|cpufreq_driver_sem
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
id|down
c_func
(paren
op_amp
id|cpufreq_notifier_sem
)paren
suffix:semicolon
multiline_comment|/* adjust if necessary - all reasons */
id|notifier_call_chain
c_func
(paren
op_amp
id|cpufreq_policy_notifier_list
comma
id|CPUFREQ_ADJUST
comma
id|policy
)paren
suffix:semicolon
multiline_comment|/* adjust if necessary - hardware incompatibility*/
id|notifier_call_chain
c_func
(paren
op_amp
id|cpufreq_policy_notifier_list
comma
id|CPUFREQ_INCOMPATIBLE
comma
id|policy
)paren
suffix:semicolon
multiline_comment|/* verify the cpu speed can be set within this limit,&n;&t;   which might be different to the first one */
id|ret
op_assign
id|cpufreq_driver
op_member_access_from_pointer
id|verify
c_func
(paren
id|policy
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
(brace
id|up
c_func
(paren
op_amp
id|cpufreq_notifier_sem
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|cpufreq_driver_sem
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
multiline_comment|/* notification of the new policy */
id|notifier_call_chain
c_func
(paren
op_amp
id|cpufreq_policy_notifier_list
comma
id|CPUFREQ_NOTIFY
comma
id|policy
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|cpufreq_notifier_sem
)paren
suffix:semicolon
id|cpufreq_driver-&gt;policy
(braket
id|policy-&gt;cpu
)braket
dot
id|min
op_assign
id|policy-&gt;min
suffix:semicolon
id|cpufreq_driver-&gt;policy
(braket
id|policy-&gt;cpu
)braket
dot
id|max
op_assign
id|policy-&gt;max
suffix:semicolon
r_if
c_cond
(paren
id|cpufreq_driver-&gt;setpolicy
)paren
(brace
id|cpufreq_driver-&gt;policy
(braket
id|policy-&gt;cpu
)braket
dot
id|policy
op_assign
id|policy-&gt;policy
suffix:semicolon
id|ret
op_assign
id|cpufreq_driver
op_member_access_from_pointer
id|setpolicy
c_func
(paren
id|policy
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
(paren
id|policy-&gt;policy
op_ne
id|cpufreq_driver-&gt;policy
(braket
id|policy-&gt;cpu
)braket
dot
id|policy
)paren
op_logical_or
(paren
(paren
id|policy-&gt;policy
op_eq
id|CPUFREQ_POLICY_GOVERNOR
)paren
op_logical_and
(paren
id|policy-&gt;governor
op_ne
id|cpufreq_driver-&gt;policy
(braket
id|policy-&gt;cpu
)braket
dot
id|governor
)paren
)paren
)paren
(brace
r_int
r_int
id|old_pol
op_assign
id|cpufreq_driver-&gt;policy
(braket
id|policy-&gt;cpu
)braket
dot
id|policy
suffix:semicolon
r_struct
id|cpufreq_governor
op_star
id|old_gov
op_assign
id|cpufreq_driver-&gt;policy
(braket
id|policy-&gt;cpu
)braket
dot
id|governor
suffix:semicolon
multiline_comment|/* end old governor */
id|cpufreq_governor
c_func
(paren
id|policy-&gt;cpu
comma
id|CPUFREQ_GOV_STOP
)paren
suffix:semicolon
id|cpufreq_driver-&gt;policy
(braket
id|policy-&gt;cpu
)braket
dot
id|policy
op_assign
id|policy-&gt;policy
suffix:semicolon
id|cpufreq_driver-&gt;policy
(braket
id|policy-&gt;cpu
)braket
dot
id|governor
op_assign
id|policy-&gt;governor
suffix:semicolon
multiline_comment|/* start new governor */
r_if
c_cond
(paren
id|cpufreq_governor
c_func
(paren
id|policy-&gt;cpu
comma
id|CPUFREQ_GOV_START
)paren
)paren
(brace
id|cpufreq_driver-&gt;policy
(braket
id|policy-&gt;cpu
)braket
dot
id|policy
op_assign
id|old_pol
suffix:semicolon
id|cpufreq_driver-&gt;policy
(braket
id|policy-&gt;cpu
)braket
dot
id|governor
op_assign
id|old_gov
suffix:semicolon
id|cpufreq_governor
c_func
(paren
id|policy-&gt;cpu
comma
id|CPUFREQ_GOV_START
)paren
suffix:semicolon
)brace
multiline_comment|/* might be a policy change, too */
id|cpufreq_governor
c_func
(paren
id|policy-&gt;cpu
comma
id|CPUFREQ_GOV_LIMITS
)paren
suffix:semicolon
)brace
r_else
(brace
id|cpufreq_governor
c_func
(paren
id|policy-&gt;cpu
comma
id|CPUFREQ_GOV_LIMITS
)paren
suffix:semicolon
)brace
)brace
id|up
c_func
(paren
op_amp
id|cpufreq_driver_sem
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|variable|cpufreq_set_policy
id|EXPORT_SYMBOL
c_func
(paren
id|cpufreq_set_policy
)paren
suffix:semicolon
multiline_comment|/*********************************************************************&n; *            EXTERNALLY AFFECTING FREQUENCY CHANGES                 *&n; *********************************************************************/
multiline_comment|/**&n; * adjust_jiffies - adjust the system &quot;loops_per_jiffy&quot;&n; *&n; * This function alters the system &quot;loops_per_jiffy&quot; for the clock&n; * speed change. Note that loops_per_jiffy cannot be updated on SMP&n; * systems as each CPU might be scaled differently. So, use the arch &n; * per-CPU loops_per_jiffy value wherever possible.&n; */
macro_line|#ifndef CONFIG_SMP
DECL|variable|l_p_j_ref
r_static
r_int
r_int
id|l_p_j_ref
op_assign
l_int|0
suffix:semicolon
DECL|variable|l_p_j_ref_freq
r_static
r_int
r_int
id|l_p_j_ref_freq
op_assign
l_int|0
suffix:semicolon
DECL|function|adjust_jiffies
r_static
r_inline
r_void
id|adjust_jiffies
c_func
(paren
r_int
r_int
id|val
comma
r_struct
id|cpufreq_freqs
op_star
id|ci
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|l_p_j_ref_freq
)paren
(brace
id|l_p_j_ref
op_assign
id|loops_per_jiffy
suffix:semicolon
id|l_p_j_ref_freq
op_assign
id|ci-&gt;old
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|val
op_eq
id|CPUFREQ_PRECHANGE
op_logical_and
id|ci-&gt;old
OL
id|ci
op_member_access_from_pointer
r_new
)paren
op_logical_or
(paren
id|val
op_eq
id|CPUFREQ_POSTCHANGE
op_logical_and
id|ci-&gt;old
OG
id|ci
op_member_access_from_pointer
r_new
)paren
)paren
id|loops_per_jiffy
op_assign
id|cpufreq_scale
c_func
(paren
id|l_p_j_ref
comma
id|l_p_j_ref_freq
comma
id|ci
op_member_access_from_pointer
r_new
)paren
suffix:semicolon
)brace
macro_line|#else
DECL|macro|adjust_jiffies
mdefine_line|#define adjust_jiffies(x...) do {} while (0)
macro_line|#endif
multiline_comment|/**&n; * cpufreq_notify_transition - call notifier chain and adjust_jiffies on frequency transition&n; *&n; * This function calls the transition notifiers and the &quot;adjust_jiffies&quot; function. It is called&n; * twice on all CPU frequency changes that have external effects. &n; */
DECL|function|cpufreq_notify_transition
r_void
id|cpufreq_notify_transition
c_func
(paren
r_struct
id|cpufreq_freqs
op_star
id|freqs
comma
r_int
r_int
id|state
)paren
(brace
id|down
c_func
(paren
op_amp
id|cpufreq_notifier_sem
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|state
)paren
(brace
r_case
id|CPUFREQ_PRECHANGE
suffix:colon
id|notifier_call_chain
c_func
(paren
op_amp
id|cpufreq_transition_notifier_list
comma
id|CPUFREQ_PRECHANGE
comma
id|freqs
)paren
suffix:semicolon
id|adjust_jiffies
c_func
(paren
id|CPUFREQ_PRECHANGE
comma
id|freqs
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CPUFREQ_POSTCHANGE
suffix:colon
id|adjust_jiffies
c_func
(paren
id|CPUFREQ_POSTCHANGE
comma
id|freqs
)paren
suffix:semicolon
id|notifier_call_chain
c_func
(paren
op_amp
id|cpufreq_transition_notifier_list
comma
id|CPUFREQ_POSTCHANGE
comma
id|freqs
)paren
suffix:semicolon
id|cpufreq_driver-&gt;policy
(braket
id|freqs-&gt;cpu
)braket
dot
id|cur
op_assign
id|freqs
op_member_access_from_pointer
r_new
suffix:semicolon
r_break
suffix:semicolon
)brace
id|up
c_func
(paren
op_amp
id|cpufreq_notifier_sem
)paren
suffix:semicolon
)brace
DECL|variable|cpufreq_notify_transition
id|EXPORT_SYMBOL_GPL
c_func
(paren
id|cpufreq_notify_transition
)paren
suffix:semicolon
multiline_comment|/*********************************************************************&n; *               REGISTER / UNREGISTER CPUFREQ DRIVER                *&n; *********************************************************************/
multiline_comment|/**&n; * cpufreq_register_driver - register a CPU Frequency driver&n; * @driver_data: A struct cpufreq_driver containing the values#&n; * submitted by the CPU Frequency driver.&n; *&n; *   Registers a CPU Frequency driver to this core code. This code &n; * returns zero on success, -EBUSY when another driver got here first&n; * (and isn&squot;t unregistered in the meantime). &n; *&n; */
DECL|function|cpufreq_register_driver
r_int
id|cpufreq_register_driver
c_func
(paren
r_struct
id|cpufreq_driver
op_star
id|driver_data
)paren
(brace
r_int
id|ret
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|cpufreq_driver
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|driver_data
op_logical_or
op_logical_neg
id|driver_data-&gt;verify
op_logical_or
(paren
(paren
op_logical_neg
id|driver_data-&gt;setpolicy
)paren
op_logical_and
(paren
op_logical_neg
id|driver_data-&gt;target
)paren
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|down
c_func
(paren
op_amp
id|cpufreq_driver_sem
)paren
suffix:semicolon
id|cpufreq_driver
op_assign
id|driver_data
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cpufreq_driver-&gt;policy
)paren
(brace
multiline_comment|/* then we need per-CPU init */
r_if
c_cond
(paren
op_logical_neg
id|cpufreq_driver-&gt;init
)paren
(brace
id|up
c_func
(paren
op_amp
id|cpufreq_driver_sem
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|cpufreq_driver-&gt;policy
op_assign
id|kmalloc
c_func
(paren
id|NR_CPUS
op_star
r_sizeof
(paren
r_struct
id|cpufreq_policy
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cpufreq_driver-&gt;policy
)paren
(brace
id|up
c_func
(paren
op_amp
id|cpufreq_driver_sem
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|memset
c_func
(paren
id|cpufreq_driver-&gt;policy
comma
l_int|0
comma
id|NR_CPUS
op_star
r_sizeof
(paren
r_struct
id|cpufreq_policy
)paren
)paren
suffix:semicolon
)brace
id|up
c_func
(paren
op_amp
id|cpufreq_driver_sem
)paren
suffix:semicolon
id|ret
op_assign
id|interface_register
c_func
(paren
op_amp
id|cpufreq_interface
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|variable|cpufreq_register_driver
id|EXPORT_SYMBOL_GPL
c_func
(paren
id|cpufreq_register_driver
)paren
suffix:semicolon
multiline_comment|/**&n; * cpufreq_unregister_driver - unregister the current CPUFreq driver&n; *&n; *    Unregister the current CPUFreq driver. Only call this if you have &n; * the right to do so, i.e. if you have succeeded in initialising before!&n; * Returns zero if successful, and -EINVAL if the cpufreq_driver is&n; * currently not initialised.&n; */
DECL|function|cpufreq_unregister_driver
r_int
id|cpufreq_unregister_driver
c_func
(paren
r_struct
id|cpufreq_driver
op_star
id|driver
)paren
(brace
id|down
c_func
(paren
op_amp
id|cpufreq_driver_sem
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cpufreq_driver
op_logical_or
(paren
(paren
id|driver
op_ne
id|cpufreq_driver
)paren
op_logical_and
(paren
id|driver
op_ne
l_int|NULL
)paren
)paren
)paren
(brace
multiline_comment|/* compat */
id|up
c_func
(paren
op_amp
id|cpufreq_driver_sem
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
multiline_comment|/* remove this workaround as soon as interface_add_data works */
(brace
r_int
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NR_CPUS
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|cpu_online
c_func
(paren
id|i
)paren
)paren
id|cpufreq_remove_dev
c_func
(paren
op_amp
id|cpufreq_driver-&gt;policy
(braket
id|i
)braket
dot
id|intf
)paren
suffix:semicolon
)brace
)brace
id|interface_unregister
c_func
(paren
op_amp
id|cpufreq_interface
)paren
suffix:semicolon
r_if
c_cond
(paren
id|driver
)paren
id|kfree
c_func
(paren
id|cpufreq_driver-&gt;policy
)paren
suffix:semicolon
id|cpufreq_driver
op_assign
l_int|NULL
suffix:semicolon
id|up
c_func
(paren
op_amp
id|cpufreq_driver_sem
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|cpufreq_unregister_driver
id|EXPORT_SYMBOL_GPL
c_func
(paren
id|cpufreq_unregister_driver
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_PM
multiline_comment|/**&n; *&t;cpufreq_restore - restore the CPU clock frequency after resume&n; *&n; *&t;Restore the CPU clock frequency so that our idea of the current&n; *&t;frequency reflects the actual hardware.&n; */
DECL|function|cpufreq_restore
r_int
id|cpufreq_restore
c_func
(paren
r_void
)paren
(brace
r_struct
id|cpufreq_policy
id|policy
suffix:semicolon
r_int
r_int
id|i
suffix:semicolon
r_int
r_int
id|ret
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|in_interrupt
c_func
(paren
)paren
)paren
id|panic
c_func
(paren
l_string|&quot;cpufreq_restore() called from interrupt context!&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NR_CPUS
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|cpu_online
c_func
(paren
id|i
)paren
)paren
r_continue
suffix:semicolon
id|down
c_func
(paren
op_amp
id|cpufreq_driver_sem
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cpufreq_driver
)paren
(brace
id|up
c_func
(paren
op_amp
id|cpufreq_driver_sem
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|memcpy
c_func
(paren
op_amp
id|policy
comma
op_amp
id|cpufreq_driver-&gt;policy
(braket
id|i
)braket
comma
r_sizeof
(paren
r_struct
id|cpufreq_policy
)paren
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|cpufreq_driver_sem
)paren
suffix:semicolon
id|ret
op_add_assign
id|cpufreq_set_policy
c_func
(paren
op_amp
id|policy
)paren
suffix:semicolon
)brace
r_return
id|ret
suffix:semicolon
)brace
DECL|variable|cpufreq_restore
id|EXPORT_SYMBOL_GPL
c_func
(paren
id|cpufreq_restore
)paren
suffix:semicolon
macro_line|#else
DECL|macro|cpufreq_restore
mdefine_line|#define cpufreq_restore() do {} while (0)
macro_line|#endif /* CONFIG_PM */
eof
