multiline_comment|/*&n; *  linux/kernel/cpufreq.c&n; *&n; *  Copyright (C) 2001 Russell King&n; *            (C) 2002 Dominik Brodowski &lt;linux@brodo.de&gt;&n; *&n; *  $Id: cpufreq.c,v 1.50 2002/11/11 15:35:48 db Exp $&n; *&n; * This program is free software; you can redistribute it and/or modify&n; * it under the terms of the GNU General Public License version 2 as&n; * published by the Free Software Foundation.&n; *&n; */
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/notifier.h&gt;
macro_line|#include &lt;linux/cpufreq.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/spinlock.h&gt;
macro_line|#include &lt;linux/device.h&gt;
macro_line|#ifdef CONFIG_CPU_FREQ_PROC_INTF
macro_line|#include &lt;linux/ctype.h&gt;
macro_line|#include &lt;linux/proc_fs.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#endif
macro_line|#ifdef CONFIG_CPU_FREQ_24_API
macro_line|#include &lt;linux/proc_fs.h&gt;
macro_line|#include &lt;linux/sysctl.h&gt;
macro_line|#endif
multiline_comment|/**&n; * The &quot;cpufreq driver&quot; - the arch- or hardware-dependend low&n; * level driver of CPUFreq support, and its locking mutex. &n; * cpu_max_freq is in kHz.&n; */
DECL|variable|cpufreq_driver
r_static
r_struct
id|cpufreq_driver
op_star
id|cpufreq_driver
suffix:semicolon
r_static
id|DECLARE_MUTEX
(paren
id|cpufreq_driver_sem
)paren
suffix:semicolon
multiline_comment|/**&n; * Two notifier lists: the &quot;policy&quot; list is involved in the &n; * validation process for a new CPU frequency policy; the &n; * &quot;transition&quot; list for kernel code that needs to handle&n; * changes to devices when the CPU clock speed changes.&n; * The mutex locks both lists. If both cpufreq_driver_sem&n; * and cpufreq_notifier_sem need to be hold, get cpufreq_driver_sem&n; * first.&n; */
DECL|variable|cpufreq_policy_notifier_list
r_static
r_struct
id|notifier_block
op_star
id|cpufreq_policy_notifier_list
suffix:semicolon
DECL|variable|cpufreq_transition_notifier_list
r_static
r_struct
id|notifier_block
op_star
id|cpufreq_transition_notifier_list
suffix:semicolon
r_static
id|DECLARE_MUTEX
(paren
id|cpufreq_notifier_sem
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_CPU_FREQ_24_API
multiline_comment|/**&n; * A few values needed by the 2.4.-compatible API&n; */
DECL|variable|cpu_max_freq
r_static
r_int
r_int
id|cpu_max_freq
(braket
id|NR_CPUS
)braket
suffix:semicolon
DECL|variable|cpu_min_freq
r_static
r_int
r_int
id|cpu_min_freq
(braket
id|NR_CPUS
)braket
suffix:semicolon
DECL|variable|cpu_cur_freq
r_static
r_int
r_int
id|cpu_cur_freq
(braket
id|NR_CPUS
)braket
suffix:semicolon
macro_line|#endif
multiline_comment|/*********************************************************************&n; *                          SYSFS INTERFACE                          *&n; *********************************************************************/
multiline_comment|/**&n; * cpufreq_parse_governor - parse a governor string&n; */
DECL|function|cpufreq_parse_governor
r_static
r_int
id|cpufreq_parse_governor
(paren
r_char
op_star
id|str_governor
comma
r_int
r_int
op_star
id|governor
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|strnicmp
c_func
(paren
id|str_governor
comma
l_string|&quot;performance&quot;
comma
l_int|11
)paren
)paren
(brace
op_star
id|governor
op_assign
id|CPUFREQ_POLICY_PERFORMANCE
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strnicmp
c_func
(paren
id|str_governor
comma
l_string|&quot;powersave&quot;
comma
l_int|9
)paren
)paren
(brace
op_star
id|governor
op_assign
id|CPUFREQ_POLICY_POWERSAVE
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_else
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
multiline_comment|/* forward declarations */
r_static
r_int
id|cpufreq_add_dev
(paren
r_struct
id|device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|cpufreq_remove_dev
(paren
r_struct
id|intf_data
op_star
id|dev
)paren
suffix:semicolon
multiline_comment|/* drivers/base/cpu.c */
r_extern
r_struct
id|device_class
id|cpu_devclass
suffix:semicolon
DECL|variable|cpufreq_interface
r_static
r_struct
id|device_interface
id|cpufreq_interface
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;cpufreq&quot;
comma
dot
id|devclass
op_assign
op_amp
id|cpu_devclass
comma
dot
id|add_device
op_assign
op_amp
id|cpufreq_add_dev
comma
dot
id|remove_device
op_assign
op_amp
id|cpufreq_remove_dev
comma
dot
id|kset
op_assign
(brace
dot
id|subsys
op_assign
op_amp
id|cpu_devclass.subsys
comma
)brace
comma
dot
id|devnum
op_assign
l_int|0
comma
)brace
suffix:semicolon
DECL|function|to_cpu_nr
r_static
r_inline
r_int
id|to_cpu_nr
(paren
r_struct
id|device
op_star
id|dev
)paren
(brace
r_struct
id|sys_device
op_star
id|cpu_sys_dev
op_assign
id|container_of
c_func
(paren
id|dev
comma
r_struct
id|sys_device
comma
id|dev
)paren
suffix:semicolon
r_return
(paren
id|cpu_sys_dev-&gt;id
)paren
suffix:semicolon
)brace
multiline_comment|/**&n; * cpufreq_per_cpu_attr_read() / show_##file_name() - print out cpufreq information&n; *&n; * Write out information from cpufreq_driver-&gt;policy[cpu]; object must be&n; * &quot;unsigned int&quot;.&n; */
DECL|macro|cpufreq_per_cpu_attr_read
mdefine_line|#define cpufreq_per_cpu_attr_read(file_name, object) &t;&t;&t;&bslash;&n;static ssize_t show_##file_name &t;&t;&t;&t;&t;&bslash;&n;(struct device *dev, char *buf)&t;&t;&t;&t;&t;&t;&bslash;&n;{&t;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;unsigned int value = 0;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;if (!dev)&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&t;return 0;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;down(&amp;cpufreq_driver_sem);&t;&t;&t;&t;&t;&bslash;&n;&t;if (cpufreq_driver)&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&t;value = cpufreq_driver-&gt;policy[to_cpu_nr(dev)].object;&t;&bslash;&n;&t;up(&amp;cpufreq_driver_sem);&t;&t;&t;&t;&t;&bslash;&n;&t;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;return sprintf (buf, &quot;%u&bslash;n&quot;, value);&t;&t;&t;&t;&bslash;&n;}
multiline_comment|/**&n; * cpufreq_per_cpu_attr_write() / store_##file_name() - sysfs write access&n; */
DECL|macro|cpufreq_per_cpu_attr_write
mdefine_line|#define cpufreq_per_cpu_attr_write(file_name, object)&t;&t;&t;&bslash;&n;static ssize_t store_##file_name&t;&t;&t;&t;&t;&bslash;&n;(struct device *dev, const char *buf, size_t count)&t;&t;&t;&bslash;&n;{&t;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;unsigned int ret = -EINVAL;&t;&t;&t;&t;&t;&bslash;&n;&t;struct cpufreq_policy policy;&t;&t;&t;&t;&t;&bslash;&n;&t;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;if (!dev)&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&t;return 0;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;ret = cpufreq_get_policy(&amp;policy, to_cpu_nr(dev));&t;&t;&bslash;&n;&t;if (ret)&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&t;return ret;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;ret = sscanf (buf, &quot;%u&quot;, &amp;policy.object);&t;&t;&t;&bslash;&n;&t;if (ret != 1)&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&t;return -EINVAL;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;ret = cpufreq_set_policy(&amp;policy);&t;&t;&t;&t;&bslash;&n;&t;if (ret)&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&t;return ret;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;return count;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;}
multiline_comment|/**&n; * show_scaling_governor - show the current policy for the specified CPU&n; */
DECL|function|show_scaling_governor
r_static
id|ssize_t
id|show_scaling_governor
(paren
r_struct
id|device
op_star
id|dev
comma
r_char
op_star
id|buf
)paren
(brace
r_int
r_int
id|value
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev
)paren
r_return
l_int|0
suffix:semicolon
id|down
c_func
(paren
op_amp
id|cpufreq_driver_sem
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cpufreq_driver
)paren
id|value
op_assign
id|cpufreq_driver-&gt;policy
(braket
id|to_cpu_nr
c_func
(paren
id|dev
)paren
)braket
dot
id|policy
suffix:semicolon
id|up
c_func
(paren
op_amp
id|cpufreq_driver_sem
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|value
)paren
(brace
r_case
id|CPUFREQ_POLICY_POWERSAVE
suffix:colon
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;powersave&bslash;n&quot;
)paren
suffix:semicolon
r_case
id|CPUFREQ_POLICY_PERFORMANCE
suffix:colon
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;performance&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
multiline_comment|/**&n; * store_scaling_governor - store policy for the specified CPU&n; */
r_static
id|ssize_t
DECL|function|store_scaling_governor
id|store_scaling_governor
(paren
r_struct
id|device
op_star
id|dev
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
)paren
(brace
r_int
r_int
id|ret
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_char
id|str_governor
(braket
l_int|16
)braket
suffix:semicolon
r_struct
id|cpufreq_policy
id|policy
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev
)paren
r_return
l_int|0
suffix:semicolon
id|ret
op_assign
id|cpufreq_get_policy
c_func
(paren
op_amp
id|policy
comma
id|to_cpu_nr
c_func
(paren
id|dev
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
r_return
id|ret
suffix:semicolon
id|ret
op_assign
id|sscanf
(paren
id|buf
comma
l_string|&quot;%15s&quot;
comma
id|str_governor
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
op_ne
l_int|1
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|cpufreq_parse_governor
c_func
(paren
id|str_governor
comma
op_amp
id|policy.policy
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|ret
op_assign
id|cpufreq_set_policy
c_func
(paren
op_amp
id|policy
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
r_return
id|ret
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
multiline_comment|/**&n; * show_scaling_governor - show the current policy for the specified CPU&n; */
DECL|function|show_scaling_driver
r_static
id|ssize_t
id|show_scaling_driver
(paren
r_struct
id|device
op_star
id|dev
comma
r_char
op_star
id|buf
)paren
(brace
r_char
id|value
(braket
id|CPUFREQ_NAME_LEN
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev
)paren
r_return
l_int|0
suffix:semicolon
id|down
c_func
(paren
op_amp
id|cpufreq_driver_sem
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cpufreq_driver
)paren
id|strncpy
c_func
(paren
id|value
comma
id|cpufreq_driver-&gt;name
comma
id|CPUFREQ_NAME_LEN
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|cpufreq_driver_sem
)paren
suffix:semicolon
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%s&bslash;n&quot;
comma
id|value
)paren
suffix:semicolon
)brace
multiline_comment|/**&n; * cpufreq_per_cpu_attr_ro - read-only cpufreq per-CPU file&n; */
DECL|macro|cpufreq_per_cpu_attr_ro
mdefine_line|#define cpufreq_per_cpu_attr_ro(file_name, object)&t;&t;&t;&bslash;&n;cpufreq_per_cpu_attr_read(file_name, object) &t;&t;&t;&t;&bslash;&n;static DEVICE_ATTR(file_name, S_IRUGO, show_##file_name, NULL);
multiline_comment|/**&n; * cpufreq_per_cpu_attr_rw - read-write cpufreq per-CPU file&n; */
DECL|macro|cpufreq_per_cpu_attr_rw
mdefine_line|#define cpufreq_per_cpu_attr_rw(file_name, object) &t;&t;&t;&bslash;&n;cpufreq_per_cpu_attr_read(file_name, object) &t;&t;&t;&t;&bslash;&n;cpufreq_per_cpu_attr_write(file_name, object) &t;&t;&t;&t;&bslash;&n;static DEVICE_ATTR(file_name, (S_IRUGO | S_IWUSR), show_##file_name, store_##file_name);
multiline_comment|/* create the file functions */
id|cpufreq_per_cpu_attr_ro
c_func
(paren
id|cpuinfo_min_freq
comma
id|cpuinfo.min_freq
)paren
suffix:semicolon
id|cpufreq_per_cpu_attr_ro
c_func
(paren
id|cpuinfo_max_freq
comma
id|cpuinfo.max_freq
)paren
suffix:semicolon
id|cpufreq_per_cpu_attr_rw
c_func
(paren
id|scaling_min_freq
comma
id|min
)paren
suffix:semicolon
id|cpufreq_per_cpu_attr_rw
c_func
(paren
id|scaling_max_freq
comma
id|max
)paren
suffix:semicolon
r_static
id|DEVICE_ATTR
c_func
(paren
id|scaling_governor
comma
(paren
id|S_IRUGO
op_or
id|S_IWUSR
)paren
comma
id|show_scaling_governor
comma
id|store_scaling_governor
)paren
suffix:semicolon
r_static
id|DEVICE_ATTR
c_func
(paren
id|scaling_driver
comma
id|S_IRUGO
comma
id|show_scaling_driver
comma
l_int|NULL
)paren
suffix:semicolon
multiline_comment|/**&n; * cpufreq_add_dev - add a CPU device&n; *&n; * Adds the cpufreq interface for a CPU device. &n; */
DECL|function|cpufreq_add_dev
r_static
r_int
id|cpufreq_add_dev
(paren
r_struct
id|device
op_star
id|dev
)paren
(brace
r_int
r_int
id|cpu
op_assign
id|to_cpu_nr
c_func
(paren
id|dev
)paren
suffix:semicolon
r_int
id|ret
op_assign
l_int|0
suffix:semicolon
r_struct
id|cpufreq_policy
id|policy
suffix:semicolon
id|down
c_func
(paren
op_amp
id|cpufreq_driver_sem
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cpufreq_driver
)paren
(brace
id|up
c_func
(paren
op_amp
id|cpufreq_driver_sem
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
multiline_comment|/* call driver. From then on the cpufreq must be able&n;&t; * to accept all calls to -&gt;verify and -&gt;setpolicy for this CPU&n;&t; */
id|cpufreq_driver-&gt;policy
(braket
id|cpu
)braket
dot
id|cpu
op_assign
id|cpu
suffix:semicolon
r_if
c_cond
(paren
id|cpufreq_driver-&gt;init
)paren
(brace
id|ret
op_assign
id|cpufreq_driver
op_member_access_from_pointer
id|init
c_func
(paren
op_amp
id|cpufreq_driver-&gt;policy
(braket
id|cpu
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
(brace
id|up
c_func
(paren
op_amp
id|cpufreq_driver_sem
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
)brace
multiline_comment|/* set default policy on this CPU */
id|policy.policy
op_assign
id|cpufreq_driver-&gt;policy
(braket
id|cpu
)braket
dot
id|policy
suffix:semicolon
id|policy.min
op_assign
id|cpufreq_driver-&gt;policy
(braket
id|cpu
)braket
dot
id|min
suffix:semicolon
id|policy.max
op_assign
id|cpufreq_driver-&gt;policy
(braket
id|cpu
)braket
dot
id|max
suffix:semicolon
id|policy.cpu
op_assign
id|cpu
suffix:semicolon
id|up
c_func
(paren
op_amp
id|cpufreq_driver_sem
)paren
suffix:semicolon
id|ret
op_assign
id|cpufreq_set_policy
c_func
(paren
op_amp
id|policy
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|down
c_func
(paren
op_amp
id|cpufreq_driver_sem
)paren
suffix:semicolon
multiline_comment|/* 2.4-API init for this CPU */
macro_line|#ifdef CONFIG_CPU_FREQ_24_API
id|cpu_min_freq
(braket
id|cpu
)braket
op_assign
id|cpufreq_driver-&gt;policy
(braket
id|cpu
)braket
dot
id|cpuinfo.min_freq
suffix:semicolon
id|cpu_max_freq
(braket
id|cpu
)braket
op_assign
id|cpufreq_driver-&gt;policy
(braket
id|cpu
)braket
dot
id|cpuinfo.max_freq
suffix:semicolon
id|cpu_cur_freq
(braket
id|cpu
)braket
op_assign
id|cpufreq_driver-&gt;cpu_cur_freq
(braket
id|cpu
)braket
suffix:semicolon
macro_line|#endif
multiline_comment|/* prepare interface data */
id|cpufreq_driver-&gt;policy
(braket
id|cpu
)braket
dot
id|intf.dev
op_assign
id|dev
suffix:semicolon
id|cpufreq_driver-&gt;policy
(braket
id|cpu
)braket
dot
id|intf.intf
op_assign
op_amp
id|cpufreq_interface
suffix:semicolon
id|strncpy
c_func
(paren
id|cpufreq_driver-&gt;policy
(braket
id|cpu
)braket
dot
id|intf.kobj.name
comma
id|cpufreq_interface.name
comma
id|KOBJ_NAME_LEN
)paren
suffix:semicolon
id|cpufreq_driver-&gt;policy
(braket
id|cpu
)braket
dot
id|intf.kobj.parent
op_assign
op_amp
(paren
id|dev-&gt;kobj
)paren
suffix:semicolon
id|cpufreq_driver-&gt;policy
(braket
id|cpu
)braket
dot
id|intf.kobj.kset
op_assign
op_amp
(paren
id|cpufreq_interface.kset
)paren
suffix:semicolon
multiline_comment|/* add interface */
multiline_comment|/* currently commented out due to deadlock */
singleline_comment|//ret = interface_add_data(&amp;(cpufreq_driver-&gt;policy[cpu].intf));
r_if
c_cond
(paren
id|ret
)paren
(brace
id|up
c_func
(paren
op_amp
id|cpufreq_driver_sem
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
multiline_comment|/* create files */
id|device_create_file
(paren
id|dev
comma
op_amp
id|dev_attr_cpuinfo_min_freq
)paren
suffix:semicolon
id|device_create_file
(paren
id|dev
comma
op_amp
id|dev_attr_cpuinfo_max_freq
)paren
suffix:semicolon
id|device_create_file
(paren
id|dev
comma
op_amp
id|dev_attr_scaling_min_freq
)paren
suffix:semicolon
id|device_create_file
(paren
id|dev
comma
op_amp
id|dev_attr_scaling_max_freq
)paren
suffix:semicolon
id|device_create_file
(paren
id|dev
comma
op_amp
id|dev_attr_scaling_governor
)paren
suffix:semicolon
id|device_create_file
(paren
id|dev
comma
op_amp
id|dev_attr_scaling_driver
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|cpufreq_driver_sem
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
multiline_comment|/**&n; * cpufreq_remove_dev - remove a CPU device&n; *&n; * Removes the cpufreq interface for a CPU device. Is called with&n; * cpufreq_driver_sem locked.&n; */
DECL|function|cpufreq_remove_dev
r_static
r_int
id|cpufreq_remove_dev
(paren
r_struct
id|intf_data
op_star
id|intf
)paren
(brace
r_struct
id|device
op_star
id|dev
op_assign
id|intf-&gt;dev
suffix:semicolon
r_int
r_int
id|cpu
op_assign
id|to_cpu_nr
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cpufreq_driver
op_member_access_from_pointer
m_exit
)paren
id|cpufreq_driver
op_member_access_from_pointer
m_exit
(paren
op_amp
id|cpufreq_driver-&gt;policy
(braket
id|cpu
)braket
)paren
suffix:semicolon
id|device_remove_file
(paren
id|dev
comma
op_amp
id|dev_attr_cpuinfo_min_freq
)paren
suffix:semicolon
id|device_remove_file
(paren
id|dev
comma
op_amp
id|dev_attr_cpuinfo_max_freq
)paren
suffix:semicolon
id|device_remove_file
(paren
id|dev
comma
op_amp
id|dev_attr_scaling_min_freq
)paren
suffix:semicolon
id|device_remove_file
(paren
id|dev
comma
op_amp
id|dev_attr_scaling_max_freq
)paren
suffix:semicolon
id|device_remove_file
(paren
id|dev
comma
op_amp
id|dev_attr_scaling_governor
)paren
suffix:semicolon
id|device_remove_file
(paren
id|dev
comma
op_amp
id|dev_attr_scaling_governor
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*********************************************************************&n; *                      /proc/cpufreq INTERFACE                      *&n; *********************************************************************/
macro_line|#ifdef CONFIG_CPU_FREQ_PROC_INTF
multiline_comment|/**&n; * cpufreq_parse_policy - parse a policy string&n; * @input_string: the string to parse.&n; * @policy: the policy written inside input_string&n; *&n; * This function parses a &quot;policy string&quot; - something the user echo&squot;es into&n; * /proc/cpufreq or gives as boot parameter - into a struct cpufreq_policy.&n; * If there are invalid/missing entries, they are replaced with current&n; * cpufreq policy.&n; */
DECL|function|cpufreq_parse_policy
r_static
r_int
id|cpufreq_parse_policy
c_func
(paren
r_char
id|input_string
(braket
l_int|42
)braket
comma
r_struct
id|cpufreq_policy
op_star
id|policy
)paren
(brace
r_int
r_int
id|min
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|max
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|cpu
op_assign
l_int|0
suffix:semicolon
r_char
id|str_governor
(braket
l_int|16
)braket
suffix:semicolon
r_struct
id|cpufreq_policy
id|current_policy
suffix:semicolon
r_int
r_int
id|result
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|policy
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|policy-&gt;min
op_assign
l_int|0
suffix:semicolon
id|policy-&gt;max
op_assign
l_int|0
suffix:semicolon
id|policy-&gt;policy
op_assign
l_int|0
suffix:semicolon
id|policy-&gt;cpu
op_assign
id|CPUFREQ_ALL_CPUS
suffix:semicolon
r_if
c_cond
(paren
id|sscanf
c_func
(paren
id|input_string
comma
l_string|&quot;%d:%d:%d:%15s&quot;
comma
op_amp
id|cpu
comma
op_amp
id|min
comma
op_amp
id|max
comma
id|str_governor
)paren
op_eq
l_int|4
)paren
(brace
id|policy-&gt;min
op_assign
id|min
suffix:semicolon
id|policy-&gt;max
op_assign
id|max
suffix:semicolon
id|policy-&gt;cpu
op_assign
id|cpu
suffix:semicolon
id|result
op_assign
l_int|0
suffix:semicolon
r_goto
id|scan_policy
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sscanf
c_func
(paren
id|input_string
comma
l_string|&quot;%d%%%d%%%d%%%15s&quot;
comma
op_amp
id|cpu
comma
op_amp
id|min
comma
op_amp
id|max
comma
id|str_governor
)paren
op_eq
l_int|4
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|cpufreq_get_policy
c_func
(paren
op_amp
id|current_policy
comma
id|cpu
)paren
)paren
(brace
id|policy-&gt;min
op_assign
(paren
id|min
op_star
id|current_policy.cpuinfo.max_freq
)paren
op_div
l_int|100
suffix:semicolon
id|policy-&gt;max
op_assign
(paren
id|max
op_star
id|current_policy.cpuinfo.max_freq
)paren
op_div
l_int|100
suffix:semicolon
id|policy-&gt;cpu
op_assign
id|cpu
suffix:semicolon
id|result
op_assign
l_int|0
suffix:semicolon
r_goto
id|scan_policy
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|sscanf
c_func
(paren
id|input_string
comma
l_string|&quot;%d:%d:%15s&quot;
comma
op_amp
id|min
comma
op_amp
id|max
comma
id|str_governor
)paren
op_eq
l_int|3
)paren
(brace
id|policy-&gt;min
op_assign
id|min
suffix:semicolon
id|policy-&gt;max
op_assign
id|max
suffix:semicolon
id|result
op_assign
l_int|0
suffix:semicolon
r_goto
id|scan_policy
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sscanf
c_func
(paren
id|input_string
comma
l_string|&quot;%d%%%d%%%15s&quot;
comma
op_amp
id|min
comma
op_amp
id|max
comma
id|str_governor
)paren
op_eq
l_int|3
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|cpufreq_get_policy
c_func
(paren
op_amp
id|current_policy
comma
id|cpu
)paren
)paren
(brace
id|policy-&gt;min
op_assign
(paren
id|min
op_star
id|current_policy.cpuinfo.max_freq
)paren
op_div
l_int|100
suffix:semicolon
id|policy-&gt;max
op_assign
(paren
id|max
op_star
id|current_policy.cpuinfo.max_freq
)paren
op_div
l_int|100
suffix:semicolon
id|result
op_assign
l_int|0
suffix:semicolon
r_goto
id|scan_policy
suffix:semicolon
)brace
)brace
r_return
op_minus
id|EINVAL
suffix:semicolon
id|scan_policy
suffix:colon
id|result
op_assign
id|cpufreq_parse_governor
c_func
(paren
id|str_governor
comma
op_amp
id|policy-&gt;policy
)paren
suffix:semicolon
r_return
id|result
suffix:semicolon
)brace
multiline_comment|/**&n; * cpufreq_proc_read - read /proc/cpufreq&n; *&n; * This function prints out the current cpufreq policy.&n; */
DECL|function|cpufreq_proc_read
r_static
r_int
id|cpufreq_proc_read
(paren
r_char
op_star
id|page
comma
r_char
op_star
op_star
id|start
comma
id|off_t
id|off
comma
r_int
id|count
comma
r_int
op_star
id|eof
comma
r_void
op_star
id|data
)paren
(brace
r_char
op_star
id|p
op_assign
id|page
suffix:semicolon
r_int
id|len
op_assign
l_int|0
suffix:semicolon
r_struct
id|cpufreq_policy
id|policy
suffix:semicolon
r_int
r_int
id|min_pctg
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|max_pctg
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|i
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|off
op_ne
l_int|0
)paren
r_goto
id|end
suffix:semicolon
id|p
op_add_assign
id|sprintf
c_func
(paren
id|p
comma
l_string|&quot;          minimum CPU frequency  -  maximum CPU frequency  -  policy&bslash;n&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NR_CPUS
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|cpu_online
c_func
(paren
id|i
)paren
)paren
r_continue
suffix:semicolon
id|cpufreq_get_policy
c_func
(paren
op_amp
id|policy
comma
id|i
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|policy.cpuinfo.max_freq
)paren
r_continue
suffix:semicolon
id|min_pctg
op_assign
(paren
id|policy.min
op_star
l_int|100
)paren
op_div
id|policy.cpuinfo.max_freq
suffix:semicolon
id|max_pctg
op_assign
(paren
id|policy.max
op_star
l_int|100
)paren
op_div
id|policy.cpuinfo.max_freq
suffix:semicolon
id|p
op_add_assign
id|sprintf
c_func
(paren
id|p
comma
l_string|&quot;CPU%3d    %9d kHz (%3d %%)  -  %9d kHz (%3d %%)  -  &quot;
comma
id|i
comma
id|policy.min
comma
id|min_pctg
comma
id|policy.max
comma
id|max_pctg
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|policy.policy
)paren
(brace
r_case
id|CPUFREQ_POLICY_POWERSAVE
suffix:colon
id|p
op_add_assign
id|sprintf
c_func
(paren
id|p
comma
l_string|&quot;powersave&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CPUFREQ_POLICY_PERFORMANCE
suffix:colon
id|p
op_add_assign
id|sprintf
c_func
(paren
id|p
comma
l_string|&quot;performance&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|p
op_add_assign
id|sprintf
c_func
(paren
id|p
comma
l_string|&quot;INVALID&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|end
suffix:colon
id|len
op_assign
(paren
id|p
op_minus
id|page
)paren
suffix:semicolon
r_if
c_cond
(paren
id|len
op_le
id|off
op_plus
id|count
)paren
op_star
id|eof
op_assign
l_int|1
suffix:semicolon
op_star
id|start
op_assign
id|page
op_plus
id|off
suffix:semicolon
id|len
op_sub_assign
id|off
suffix:semicolon
r_if
c_cond
(paren
id|len
OG
id|count
)paren
id|len
op_assign
id|count
suffix:semicolon
r_if
c_cond
(paren
id|len
OL
l_int|0
)paren
id|len
op_assign
l_int|0
suffix:semicolon
r_return
id|len
suffix:semicolon
)brace
multiline_comment|/**&n; * cpufreq_proc_write - handles writing into /proc/cpufreq&n; *&n; * This function calls the parsing script and then sets the policy&n; * accordingly.&n; */
DECL|function|cpufreq_proc_write
r_static
r_int
id|cpufreq_proc_write
(paren
r_struct
id|file
op_star
id|file
comma
r_const
r_char
op_star
id|buffer
comma
r_int
r_int
id|count
comma
r_void
op_star
id|data
)paren
(brace
r_int
id|result
op_assign
l_int|0
suffix:semicolon
r_char
id|proc_string
(braket
l_int|42
)braket
op_assign
(brace
l_char|&squot;&bslash;0&squot;
)brace
suffix:semicolon
r_struct
id|cpufreq_policy
id|policy
suffix:semicolon
r_int
r_int
id|i
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
(paren
id|count
OG
r_sizeof
(paren
id|proc_string
)paren
op_minus
l_int|1
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
id|proc_string
comma
id|buffer
comma
id|count
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|proc_string
(braket
id|count
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
id|result
op_assign
id|cpufreq_parse_policy
c_func
(paren
id|proc_string
comma
op_amp
id|policy
)paren
suffix:semicolon
r_if
c_cond
(paren
id|result
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|policy.cpu
op_eq
id|CPUFREQ_ALL_CPUS
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NR_CPUS
suffix:semicolon
id|i
op_increment
)paren
(brace
id|policy.cpu
op_assign
id|i
suffix:semicolon
r_if
c_cond
(paren
id|cpu_online
c_func
(paren
id|i
)paren
)paren
id|cpufreq_set_policy
c_func
(paren
op_amp
id|policy
)paren
suffix:semicolon
)brace
)brace
r_else
id|cpufreq_set_policy
c_func
(paren
op_amp
id|policy
)paren
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
multiline_comment|/**&n; * cpufreq_proc_init - add &quot;cpufreq&quot; to the /proc root directory&n; *&n; * This function adds &quot;cpufreq&quot; to the /proc root directory.&n; */
DECL|function|cpufreq_proc_init
r_static
r_int
r_int
id|cpufreq_proc_init
(paren
r_void
)paren
(brace
r_struct
id|proc_dir_entry
op_star
id|entry
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/* are these acceptable values? */
id|entry
op_assign
id|create_proc_entry
c_func
(paren
l_string|&quot;cpufreq&quot;
comma
id|S_IFREG
op_or
id|S_IRUGO
op_or
id|S_IWUSR
comma
op_amp
id|proc_root
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|entry
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;unable to create /proc/cpufreq entry&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
r_else
(brace
id|entry-&gt;read_proc
op_assign
id|cpufreq_proc_read
suffix:semicolon
id|entry-&gt;write_proc
op_assign
id|cpufreq_proc_write
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/**&n; * cpufreq_proc_exit - removes &quot;cpufreq&quot; from the /proc root directory.&n; *&n; * This function removes &quot;cpufreq&quot; from the /proc root directory.&n; */
DECL|function|cpufreq_proc_exit
r_static
r_void
id|cpufreq_proc_exit
(paren
r_void
)paren
(brace
id|remove_proc_entry
c_func
(paren
l_string|&quot;cpufreq&quot;
comma
op_amp
id|proc_root
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
macro_line|#else
DECL|macro|cpufreq_proc_init
mdefine_line|#define cpufreq_proc_init() do {} while(0)
DECL|macro|cpufreq_proc_exit
mdefine_line|#define cpufreq_proc_exit() do {} while(0)
macro_line|#endif /* CONFIG_CPU_FREQ_PROC_INTF */
multiline_comment|/*********************************************************************&n; *                      /proc/sys/cpu/ INTERFACE                     *&n; *********************************************************************/
macro_line|#ifdef CONFIG_CPU_FREQ_24_API
multiline_comment|/** &n; * cpufreq_set - set the CPU frequency&n; * @freq: target frequency in kHz&n; * @cpu: CPU for which the frequency is to be set&n; *&n; * Sets the CPU frequency to freq.&n; */
DECL|function|cpufreq_set
r_int
id|cpufreq_set
c_func
(paren
r_int
r_int
id|freq
comma
r_int
r_int
id|cpu
)paren
(brace
r_struct
id|cpufreq_policy
id|policy
suffix:semicolon
id|down
c_func
(paren
op_amp
id|cpufreq_driver_sem
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cpufreq_driver
op_logical_or
op_logical_neg
id|freq
op_logical_or
(paren
id|cpu
OG
id|NR_CPUS
)paren
)paren
(brace
id|up
c_func
(paren
op_amp
id|cpufreq_driver_sem
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|policy.min
op_assign
id|freq
suffix:semicolon
id|policy.max
op_assign
id|freq
suffix:semicolon
id|policy.policy
op_assign
id|CPUFREQ_POLICY_POWERSAVE
suffix:semicolon
id|policy.cpu
op_assign
id|cpu
suffix:semicolon
id|up
c_func
(paren
op_amp
id|cpufreq_driver_sem
)paren
suffix:semicolon
r_if
c_cond
(paren
id|policy.cpu
op_eq
id|CPUFREQ_ALL_CPUS
)paren
(brace
r_int
r_int
id|i
suffix:semicolon
r_int
r_int
id|ret
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NR_CPUS
suffix:semicolon
id|i
op_increment
)paren
(brace
id|policy.cpu
op_assign
id|i
suffix:semicolon
r_if
c_cond
(paren
id|cpu_online
c_func
(paren
id|i
)paren
)paren
id|ret
op_or_assign
id|cpufreq_set_policy
c_func
(paren
op_amp
id|policy
)paren
suffix:semicolon
)brace
r_return
id|ret
suffix:semicolon
)brace
r_else
r_return
id|cpufreq_set_policy
c_func
(paren
op_amp
id|policy
)paren
suffix:semicolon
)brace
DECL|variable|cpufreq_set
id|EXPORT_SYMBOL_GPL
c_func
(paren
id|cpufreq_set
)paren
suffix:semicolon
multiline_comment|/** &n; * cpufreq_setmax - set the CPU to the maximum frequency&n; * @cpu - affected cpu;&n; *&n; * Sets the CPU frequency to the maximum frequency supported by&n; * this CPU.&n; */
DECL|function|cpufreq_setmax
r_int
id|cpufreq_setmax
c_func
(paren
r_int
r_int
id|cpu
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|cpu_online
c_func
(paren
id|cpu
)paren
op_logical_and
(paren
id|cpu
op_ne
id|CPUFREQ_ALL_CPUS
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_return
id|cpufreq_set
c_func
(paren
id|cpu_max_freq
(braket
id|cpu
)braket
comma
id|cpu
)paren
suffix:semicolon
)brace
DECL|variable|cpufreq_setmax
id|EXPORT_SYMBOL_GPL
c_func
(paren
id|cpufreq_setmax
)paren
suffix:semicolon
multiline_comment|/** &n; * cpufreq_get - get the current CPU frequency (in kHz)&n; * @cpu: CPU number - currently without effect.&n; *&n; * Get the CPU current (static) CPU frequency&n; */
DECL|function|cpufreq_get
r_int
r_int
id|cpufreq_get
c_func
(paren
r_int
r_int
id|cpu
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|cpu_online
c_func
(paren
id|cpu
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_return
id|cpu_cur_freq
(braket
id|cpu
)braket
suffix:semicolon
)brace
DECL|variable|cpufreq_get
id|EXPORT_SYMBOL
c_func
(paren
id|cpufreq_get
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_SYSCTL
multiline_comment|/*********************** cpufreq_sysctl interface ********************/
r_static
r_int
DECL|function|cpufreq_procctl
id|cpufreq_procctl
c_func
(paren
id|ctl_table
op_star
id|ctl
comma
r_int
id|write
comma
r_struct
id|file
op_star
id|filp
comma
r_void
op_star
id|buffer
comma
r_int
op_star
id|lenp
)paren
(brace
r_char
id|buf
(braket
l_int|16
)braket
comma
op_star
id|p
suffix:semicolon
r_int
id|cpu
op_assign
(paren
r_int
)paren
id|ctl-&gt;extra1
suffix:semicolon
r_int
id|len
comma
id|left
op_assign
op_star
id|lenp
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|left
op_logical_or
(paren
id|filp-&gt;f_pos
op_logical_and
op_logical_neg
id|write
)paren
op_logical_or
op_logical_neg
id|cpu_online
c_func
(paren
id|cpu
)paren
)paren
(brace
op_star
id|lenp
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|write
)paren
(brace
r_int
r_int
id|freq
suffix:semicolon
id|len
op_assign
id|left
suffix:semicolon
r_if
c_cond
(paren
id|left
OG
r_sizeof
(paren
id|buf
)paren
)paren
id|left
op_assign
r_sizeof
(paren
id|buf
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
id|buf
comma
id|buffer
comma
id|left
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|buf
(braket
r_sizeof
(paren
id|buf
)paren
op_minus
l_int|1
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
id|freq
op_assign
id|simple_strtoul
c_func
(paren
id|buf
comma
op_amp
id|p
comma
l_int|0
)paren
suffix:semicolon
id|cpufreq_set
c_func
(paren
id|freq
comma
id|cpu
)paren
suffix:semicolon
)brace
r_else
(brace
id|len
op_assign
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%d&bslash;n&quot;
comma
id|cpufreq_get
c_func
(paren
id|cpu
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|len
OG
id|left
)paren
id|len
op_assign
id|left
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|buffer
comma
id|buf
comma
id|len
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
op_star
id|lenp
op_assign
id|len
suffix:semicolon
id|filp-&gt;f_pos
op_add_assign
id|len
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|cpufreq_sysctl
id|cpufreq_sysctl
c_func
(paren
id|ctl_table
op_star
id|table
comma
r_int
op_star
id|name
comma
r_int
id|nlen
comma
r_void
op_star
id|oldval
comma
r_int
op_star
id|oldlenp
comma
r_void
op_star
id|newval
comma
r_int
id|newlen
comma
r_void
op_star
op_star
id|context
)paren
(brace
r_int
id|cpu
op_assign
(paren
r_int
)paren
id|table-&gt;extra1
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cpu_online
c_func
(paren
id|cpu
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|oldval
op_logical_and
id|oldlenp
)paren
(brace
r_int
id|oldlen
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|oldlen
comma
id|oldlenp
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|oldlen
op_ne
r_sizeof
(paren
r_int
r_int
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|put_user
c_func
(paren
id|cpufreq_get
c_func
(paren
id|cpu
)paren
comma
(paren
r_int
r_int
op_star
)paren
id|oldval
)paren
op_logical_or
id|put_user
c_func
(paren
r_sizeof
(paren
r_int
r_int
)paren
comma
id|oldlenp
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
r_if
c_cond
(paren
id|newval
op_logical_and
id|newlen
)paren
(brace
r_int
r_int
id|freq
suffix:semicolon
r_if
c_cond
(paren
id|newlen
op_ne
r_sizeof
(paren
r_int
r_int
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|freq
comma
(paren
r_int
r_int
op_star
)paren
id|newval
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|cpufreq_set
c_func
(paren
id|freq
comma
id|cpu
)paren
suffix:semicolon
)brace
r_return
l_int|1
suffix:semicolon
)brace
multiline_comment|/* ctl_table ctl_cpu_vars_{0,1,...,(NR_CPUS-1)} */
multiline_comment|/* due to NR_CPUS tweaking, a lot of if/endifs are required, sorry */
id|CTL_TABLE_CPU_VARS
c_func
(paren
l_int|0
)paren
suffix:semicolon
macro_line|#if NR_CPUS &gt; 1
id|CTL_TABLE_CPU_VARS
c_func
(paren
l_int|1
)paren
suffix:semicolon
macro_line|#endif
macro_line|#if NR_CPUS &gt; 2
id|CTL_TABLE_CPU_VARS
c_func
(paren
l_int|2
)paren
suffix:semicolon
macro_line|#endif
macro_line|#if NR_CPUS &gt; 3
id|CTL_TABLE_CPU_VARS
c_func
(paren
l_int|3
)paren
suffix:semicolon
macro_line|#endif
macro_line|#if NR_CPUS &gt; 4
id|CTL_TABLE_CPU_VARS
c_func
(paren
l_int|4
)paren
suffix:semicolon
macro_line|#endif
macro_line|#if NR_CPUS &gt; 5
id|CTL_TABLE_CPU_VARS
c_func
(paren
l_int|5
)paren
suffix:semicolon
macro_line|#endif
macro_line|#if NR_CPUS &gt; 6
id|CTL_TABLE_CPU_VARS
c_func
(paren
l_int|6
)paren
suffix:semicolon
macro_line|#endif
macro_line|#if NR_CPUS &gt; 7
id|CTL_TABLE_CPU_VARS
c_func
(paren
l_int|7
)paren
suffix:semicolon
macro_line|#endif
macro_line|#if NR_CPUS &gt; 8
id|CTL_TABLE_CPU_VARS
c_func
(paren
l_int|8
)paren
suffix:semicolon
macro_line|#endif
macro_line|#if NR_CPUS &gt; 9
id|CTL_TABLE_CPU_VARS
c_func
(paren
l_int|9
)paren
suffix:semicolon
macro_line|#endif
macro_line|#if NR_CPUS &gt; 10
id|CTL_TABLE_CPU_VARS
c_func
(paren
l_int|10
)paren
suffix:semicolon
macro_line|#endif
macro_line|#if NR_CPUS &gt; 11
id|CTL_TABLE_CPU_VARS
c_func
(paren
l_int|11
)paren
suffix:semicolon
macro_line|#endif
macro_line|#if NR_CPUS &gt; 12
id|CTL_TABLE_CPU_VARS
c_func
(paren
l_int|12
)paren
suffix:semicolon
macro_line|#endif
macro_line|#if NR_CPUS &gt; 13
id|CTL_TABLE_CPU_VARS
c_func
(paren
l_int|13
)paren
suffix:semicolon
macro_line|#endif
macro_line|#if NR_CPUS &gt; 14
id|CTL_TABLE_CPU_VARS
c_func
(paren
l_int|14
)paren
suffix:semicolon
macro_line|#endif
macro_line|#if NR_CPUS &gt; 15
id|CTL_TABLE_CPU_VARS
c_func
(paren
l_int|15
)paren
suffix:semicolon
macro_line|#endif
macro_line|#if NR_CPUS &gt; 16
id|CTL_TABLE_CPU_VARS
c_func
(paren
l_int|16
)paren
suffix:semicolon
macro_line|#endif
macro_line|#if NR_CPUS &gt; 17
id|CTL_TABLE_CPU_VARS
c_func
(paren
l_int|17
)paren
suffix:semicolon
macro_line|#endif
macro_line|#if NR_CPUS &gt; 18
id|CTL_TABLE_CPU_VARS
c_func
(paren
l_int|18
)paren
suffix:semicolon
macro_line|#endif
macro_line|#if NR_CPUS &gt; 19
id|CTL_TABLE_CPU_VARS
c_func
(paren
l_int|19
)paren
suffix:semicolon
macro_line|#endif
macro_line|#if NR_CPUS &gt; 20
id|CTL_TABLE_CPU_VARS
c_func
(paren
l_int|20
)paren
suffix:semicolon
macro_line|#endif
macro_line|#if NR_CPUS &gt; 21
id|CTL_TABLE_CPU_VARS
c_func
(paren
l_int|21
)paren
suffix:semicolon
macro_line|#endif
macro_line|#if NR_CPUS &gt; 22
id|CTL_TABLE_CPU_VARS
c_func
(paren
l_int|22
)paren
suffix:semicolon
macro_line|#endif
macro_line|#if NR_CPUS &gt; 23
id|CTL_TABLE_CPU_VARS
c_func
(paren
l_int|23
)paren
suffix:semicolon
macro_line|#endif
macro_line|#if NR_CPUS &gt; 24
id|CTL_TABLE_CPU_VARS
c_func
(paren
l_int|24
)paren
suffix:semicolon
macro_line|#endif
macro_line|#if NR_CPUS &gt; 25
id|CTL_TABLE_CPU_VARS
c_func
(paren
l_int|25
)paren
suffix:semicolon
macro_line|#endif
macro_line|#if NR_CPUS &gt; 26
id|CTL_TABLE_CPU_VARS
c_func
(paren
l_int|26
)paren
suffix:semicolon
macro_line|#endif
macro_line|#if NR_CPUS &gt; 27
id|CTL_TABLE_CPU_VARS
c_func
(paren
l_int|27
)paren
suffix:semicolon
macro_line|#endif
macro_line|#if NR_CPUS &gt; 28
id|CTL_TABLE_CPU_VARS
c_func
(paren
l_int|28
)paren
suffix:semicolon
macro_line|#endif
macro_line|#if NR_CPUS &gt; 29
id|CTL_TABLE_CPU_VARS
c_func
(paren
l_int|29
)paren
suffix:semicolon
macro_line|#endif
macro_line|#if NR_CPUS &gt; 30
id|CTL_TABLE_CPU_VARS
c_func
(paren
l_int|30
)paren
suffix:semicolon
macro_line|#endif
macro_line|#if NR_CPUS &gt; 31
id|CTL_TABLE_CPU_VARS
c_func
(paren
l_int|31
)paren
suffix:semicolon
macro_line|#endif
macro_line|#if NR_CPUS &gt; 32
macro_line|#error please extend CPU enumeration
macro_line|#endif
multiline_comment|/* due to NR_CPUS tweaking, a lot of if/endifs are required, sorry */
DECL|variable|ctl_cpu_table
r_static
id|ctl_table
id|ctl_cpu_table
(braket
id|NR_CPUS
op_plus
l_int|1
)braket
op_assign
(brace
id|CPU_ENUM
c_func
(paren
l_int|0
)paren
comma
macro_line|#if NR_CPUS &gt; 1
id|CPU_ENUM
c_func
(paren
l_int|1
)paren
comma
macro_line|#endif
macro_line|#if NR_CPUS &gt; 2
id|CPU_ENUM
c_func
(paren
l_int|2
)paren
comma
macro_line|#endif
macro_line|#if NR_CPUS &gt; 3
id|CPU_ENUM
c_func
(paren
l_int|3
)paren
comma
macro_line|#endif
macro_line|#if NR_CPUS &gt; 4
id|CPU_ENUM
c_func
(paren
l_int|4
)paren
comma
macro_line|#endif
macro_line|#if NR_CPUS &gt; 5
id|CPU_ENUM
c_func
(paren
l_int|5
)paren
comma
macro_line|#endif
macro_line|#if NR_CPUS &gt; 6
id|CPU_ENUM
c_func
(paren
l_int|6
)paren
comma
macro_line|#endif
macro_line|#if NR_CPUS &gt; 7
id|CPU_ENUM
c_func
(paren
l_int|7
)paren
comma
macro_line|#endif
macro_line|#if NR_CPUS &gt; 8
id|CPU_ENUM
c_func
(paren
l_int|8
)paren
comma
macro_line|#endif
macro_line|#if NR_CPUS &gt; 9
id|CPU_ENUM
c_func
(paren
l_int|9
)paren
comma
macro_line|#endif
macro_line|#if NR_CPUS &gt; 10
id|CPU_ENUM
c_func
(paren
l_int|10
)paren
comma
macro_line|#endif
macro_line|#if NR_CPUS &gt; 11
id|CPU_ENUM
c_func
(paren
l_int|11
)paren
comma
macro_line|#endif
macro_line|#if NR_CPUS &gt; 12
id|CPU_ENUM
c_func
(paren
l_int|12
)paren
comma
macro_line|#endif
macro_line|#if NR_CPUS &gt; 13
id|CPU_ENUM
c_func
(paren
l_int|13
)paren
comma
macro_line|#endif
macro_line|#if NR_CPUS &gt; 14
id|CPU_ENUM
c_func
(paren
l_int|14
)paren
comma
macro_line|#endif
macro_line|#if NR_CPUS &gt; 15
id|CPU_ENUM
c_func
(paren
l_int|15
)paren
comma
macro_line|#endif
macro_line|#if NR_CPUS &gt; 16
id|CPU_ENUM
c_func
(paren
l_int|16
)paren
comma
macro_line|#endif
macro_line|#if NR_CPUS &gt; 17
id|CPU_ENUM
c_func
(paren
l_int|17
)paren
comma
macro_line|#endif
macro_line|#if NR_CPUS &gt; 18
id|CPU_ENUM
c_func
(paren
l_int|18
)paren
comma
macro_line|#endif
macro_line|#if NR_CPUS &gt; 19
id|CPU_ENUM
c_func
(paren
l_int|19
)paren
comma
macro_line|#endif
macro_line|#if NR_CPUS &gt; 20
id|CPU_ENUM
c_func
(paren
l_int|20
)paren
comma
macro_line|#endif
macro_line|#if NR_CPUS &gt; 21
id|CPU_ENUM
c_func
(paren
l_int|21
)paren
comma
macro_line|#endif
macro_line|#if NR_CPUS &gt; 22
id|CPU_ENUM
c_func
(paren
l_int|22
)paren
comma
macro_line|#endif
macro_line|#if NR_CPUS &gt; 23
id|CPU_ENUM
c_func
(paren
l_int|23
)paren
comma
macro_line|#endif
macro_line|#if NR_CPUS &gt; 24
id|CPU_ENUM
c_func
(paren
l_int|24
)paren
comma
macro_line|#endif
macro_line|#if NR_CPUS &gt; 25
id|CPU_ENUM
c_func
(paren
l_int|25
)paren
comma
macro_line|#endif
macro_line|#if NR_CPUS &gt; 26
id|CPU_ENUM
c_func
(paren
l_int|26
)paren
comma
macro_line|#endif
macro_line|#if NR_CPUS &gt; 27
id|CPU_ENUM
c_func
(paren
l_int|27
)paren
comma
macro_line|#endif
macro_line|#if NR_CPUS &gt; 28
id|CPU_ENUM
c_func
(paren
l_int|28
)paren
comma
macro_line|#endif
macro_line|#if NR_CPUS &gt; 29
id|CPU_ENUM
c_func
(paren
l_int|29
)paren
comma
macro_line|#endif
macro_line|#if NR_CPUS &gt; 30
id|CPU_ENUM
c_func
(paren
l_int|30
)paren
comma
macro_line|#endif
macro_line|#if NR_CPUS &gt; 31
id|CPU_ENUM
c_func
(paren
l_int|31
)paren
comma
macro_line|#endif
macro_line|#if NR_CPUS &gt; 32
macro_line|#error please extend CPU enumeration
macro_line|#endif
(brace
dot
id|ctl_name
op_assign
l_int|0
comma
)brace
)brace
suffix:semicolon
DECL|variable|ctl_cpu
r_static
id|ctl_table
id|ctl_cpu
(braket
l_int|2
)braket
op_assign
(brace
(brace
dot
id|ctl_name
op_assign
id|CTL_CPU
comma
dot
id|procname
op_assign
l_string|&quot;cpu&quot;
comma
dot
id|mode
op_assign
l_int|0555
comma
dot
id|child
op_assign
id|ctl_cpu_table
comma
)brace
comma
(brace
dot
id|ctl_name
op_assign
l_int|0
comma
)brace
)brace
suffix:semicolon
DECL|variable|cpufreq_sysctl_table
r_struct
id|ctl_table_header
op_star
id|cpufreq_sysctl_table
suffix:semicolon
DECL|function|cpufreq_sysctl_init
r_static
r_inline
r_void
id|cpufreq_sysctl_init
c_func
(paren
r_void
)paren
(brace
id|cpufreq_sysctl_table
op_assign
id|register_sysctl_table
c_func
(paren
id|ctl_cpu
comma
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|cpufreq_sysctl_exit
r_static
r_inline
r_void
id|cpufreq_sysctl_exit
c_func
(paren
r_void
)paren
(brace
id|unregister_sysctl_table
c_func
(paren
id|cpufreq_sysctl_table
)paren
suffix:semicolon
)brace
macro_line|#else
DECL|macro|cpufreq_sysctl_init
mdefine_line|#define cpufreq_sysctl_init() do {} while(0)
DECL|macro|cpufreq_sysctl_exit
mdefine_line|#define cpufreq_sysctl_exit() do {} while(0)
macro_line|#endif /* CONFIG_SYSCTL */
macro_line|#endif /* CONFIG_CPU_FREQ_24_API */
multiline_comment|/*********************************************************************&n; *                     NOTIFIER LISTS INTERFACE                      *&n; *********************************************************************/
multiline_comment|/**&n; *&t;cpufreq_register_notifier - register a driver with cpufreq&n; *&t;@nb: notifier function to register&n; *      @list: CPUFREQ_TRANSITION_NOTIFIER or CPUFREQ_POLICY_NOTIFIER&n; *&n; *&t;Add a driver to one of two lists: either a list of drivers that &n; *      are notified about clock rate changes (once before and once after&n; *      the transition), or a list of drivers that are notified about&n; *      changes in cpufreq policy.&n; *&n; *&t;This function may sleep, and has the same return conditions as&n; *&t;notifier_chain_register.&n; */
DECL|function|cpufreq_register_notifier
r_int
id|cpufreq_register_notifier
c_func
(paren
r_struct
id|notifier_block
op_star
id|nb
comma
r_int
r_int
id|list
)paren
(brace
r_int
id|ret
suffix:semicolon
id|down
c_func
(paren
op_amp
id|cpufreq_notifier_sem
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|list
)paren
(brace
r_case
id|CPUFREQ_TRANSITION_NOTIFIER
suffix:colon
id|ret
op_assign
id|notifier_chain_register
c_func
(paren
op_amp
id|cpufreq_transition_notifier_list
comma
id|nb
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CPUFREQ_POLICY_NOTIFIER
suffix:colon
id|ret
op_assign
id|notifier_chain_register
c_func
(paren
op_amp
id|cpufreq_policy_notifier_list
comma
id|nb
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|ret
op_assign
op_minus
id|EINVAL
suffix:semicolon
)brace
id|up
c_func
(paren
op_amp
id|cpufreq_notifier_sem
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|variable|cpufreq_register_notifier
id|EXPORT_SYMBOL
c_func
(paren
id|cpufreq_register_notifier
)paren
suffix:semicolon
multiline_comment|/**&n; *&t;cpufreq_unregister_notifier - unregister a driver with cpufreq&n; *&t;@nb: notifier block to be unregistered&n; *      @list: CPUFREQ_TRANSITION_NOTIFIER or CPUFREQ_POLICY_NOTIFIER&n; *&n; *&t;Remove a driver from the CPU frequency notifier list.&n; *&n; *&t;This function may sleep, and has the same return conditions as&n; *&t;notifier_chain_unregister.&n; */
DECL|function|cpufreq_unregister_notifier
r_int
id|cpufreq_unregister_notifier
c_func
(paren
r_struct
id|notifier_block
op_star
id|nb
comma
r_int
r_int
id|list
)paren
(brace
r_int
id|ret
suffix:semicolon
id|down
c_func
(paren
op_amp
id|cpufreq_notifier_sem
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|list
)paren
(brace
r_case
id|CPUFREQ_TRANSITION_NOTIFIER
suffix:colon
id|ret
op_assign
id|notifier_chain_unregister
c_func
(paren
op_amp
id|cpufreq_transition_notifier_list
comma
id|nb
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CPUFREQ_POLICY_NOTIFIER
suffix:colon
id|ret
op_assign
id|notifier_chain_unregister
c_func
(paren
op_amp
id|cpufreq_policy_notifier_list
comma
id|nb
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|ret
op_assign
op_minus
id|EINVAL
suffix:semicolon
)brace
id|up
c_func
(paren
op_amp
id|cpufreq_notifier_sem
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|variable|cpufreq_unregister_notifier
id|EXPORT_SYMBOL
c_func
(paren
id|cpufreq_unregister_notifier
)paren
suffix:semicolon
multiline_comment|/*********************************************************************&n; *                          POLICY INTERFACE                         *&n; *********************************************************************/
multiline_comment|/**&n; * cpufreq_get_policy - get the current cpufreq_policy&n; * @policy: struct cpufreq_policy into which the current cpufreq_policy is written&n; *&n; * Reads the current cpufreq policy.&n; */
DECL|function|cpufreq_get_policy
r_int
id|cpufreq_get_policy
c_func
(paren
r_struct
id|cpufreq_policy
op_star
id|policy
comma
r_int
r_int
id|cpu
)paren
(brace
id|down
c_func
(paren
op_amp
id|cpufreq_driver_sem
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cpufreq_driver
op_logical_or
op_logical_neg
id|policy
op_logical_or
(paren
id|cpu
op_ge
id|NR_CPUS
)paren
op_logical_or
(paren
op_logical_neg
id|cpu_online
c_func
(paren
id|cpu
)paren
)paren
)paren
(brace
id|up
c_func
(paren
op_amp
id|cpufreq_driver_sem
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|policy-&gt;min
op_assign
id|cpufreq_driver-&gt;policy
(braket
id|cpu
)braket
dot
id|min
suffix:semicolon
id|policy-&gt;max
op_assign
id|cpufreq_driver-&gt;policy
(braket
id|cpu
)braket
dot
id|max
suffix:semicolon
id|policy-&gt;policy
op_assign
id|cpufreq_driver-&gt;policy
(braket
id|cpu
)braket
dot
id|policy
suffix:semicolon
id|policy-&gt;cpuinfo.max_freq
op_assign
id|cpufreq_driver-&gt;policy
(braket
id|cpu
)braket
dot
id|cpuinfo.max_freq
suffix:semicolon
id|policy-&gt;cpuinfo.min_freq
op_assign
id|cpufreq_driver-&gt;policy
(braket
id|cpu
)braket
dot
id|cpuinfo.min_freq
suffix:semicolon
id|policy-&gt;cpuinfo.transition_latency
op_assign
id|cpufreq_driver-&gt;policy
(braket
id|cpu
)braket
dot
id|cpuinfo.transition_latency
suffix:semicolon
id|policy-&gt;cpu
op_assign
id|cpu
suffix:semicolon
id|up
c_func
(paren
op_amp
id|cpufreq_driver_sem
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|cpufreq_get_policy
id|EXPORT_SYMBOL
c_func
(paren
id|cpufreq_get_policy
)paren
suffix:semicolon
multiline_comment|/**&n; *&t;cpufreq_set_policy - set a new CPUFreq policy&n; *&t;@policy: policy to be set.&n; *&n; *&t;Sets a new CPU frequency and voltage scaling policy.&n; */
DECL|function|cpufreq_set_policy
r_int
id|cpufreq_set_policy
c_func
(paren
r_struct
id|cpufreq_policy
op_star
id|policy
)paren
(brace
r_int
id|ret
suffix:semicolon
id|down
c_func
(paren
op_amp
id|cpufreq_driver_sem
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cpufreq_driver
op_logical_or
op_logical_neg
id|cpufreq_driver-&gt;verify
op_logical_or
op_logical_neg
id|cpufreq_driver-&gt;setpolicy
op_logical_or
op_logical_neg
id|policy
op_logical_or
(paren
id|policy-&gt;cpu
op_ge
id|NR_CPUS
)paren
op_logical_or
(paren
op_logical_neg
id|cpu_online
c_func
(paren
id|policy-&gt;cpu
)paren
)paren
)paren
(brace
id|up
c_func
(paren
op_amp
id|cpufreq_driver_sem
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|policy-&gt;cpuinfo.max_freq
op_assign
id|cpufreq_driver-&gt;policy
(braket
id|policy-&gt;cpu
)braket
dot
id|cpuinfo.max_freq
suffix:semicolon
id|policy-&gt;cpuinfo.min_freq
op_assign
id|cpufreq_driver-&gt;policy
(braket
id|policy-&gt;cpu
)braket
dot
id|cpuinfo.min_freq
suffix:semicolon
id|policy-&gt;cpuinfo.transition_latency
op_assign
id|cpufreq_driver-&gt;policy
(braket
id|policy-&gt;cpu
)braket
dot
id|cpuinfo.transition_latency
suffix:semicolon
multiline_comment|/* verify the cpu speed can be set within this limit */
id|ret
op_assign
id|cpufreq_driver
op_member_access_from_pointer
id|verify
c_func
(paren
id|policy
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
(brace
id|up
c_func
(paren
op_amp
id|cpufreq_driver_sem
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
id|down
c_func
(paren
op_amp
id|cpufreq_notifier_sem
)paren
suffix:semicolon
multiline_comment|/* adjust if neccessary - all reasons */
id|notifier_call_chain
c_func
(paren
op_amp
id|cpufreq_policy_notifier_list
comma
id|CPUFREQ_ADJUST
comma
id|policy
)paren
suffix:semicolon
multiline_comment|/* adjust if neccessary - hardware incompatibility*/
id|notifier_call_chain
c_func
(paren
op_amp
id|cpufreq_policy_notifier_list
comma
id|CPUFREQ_INCOMPATIBLE
comma
id|policy
)paren
suffix:semicolon
multiline_comment|/* verify the cpu speed can be set within this limit,&n;&t;   which might be different to the first one */
id|ret
op_assign
id|cpufreq_driver
op_member_access_from_pointer
id|verify
c_func
(paren
id|policy
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
(brace
id|up
c_func
(paren
op_amp
id|cpufreq_notifier_sem
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|cpufreq_driver_sem
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
multiline_comment|/* notification of the new policy */
id|notifier_call_chain
c_func
(paren
op_amp
id|cpufreq_policy_notifier_list
comma
id|CPUFREQ_NOTIFY
comma
id|policy
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|cpufreq_notifier_sem
)paren
suffix:semicolon
id|cpufreq_driver-&gt;policy
(braket
id|policy-&gt;cpu
)braket
dot
id|min
op_assign
id|policy-&gt;min
suffix:semicolon
id|cpufreq_driver-&gt;policy
(braket
id|policy-&gt;cpu
)braket
dot
id|max
op_assign
id|policy-&gt;max
suffix:semicolon
id|cpufreq_driver-&gt;policy
(braket
id|policy-&gt;cpu
)braket
dot
id|policy
op_assign
id|policy-&gt;policy
suffix:semicolon
macro_line|#ifdef CONFIG_CPU_FREQ_24_API
id|cpu_cur_freq
(braket
id|policy-&gt;cpu
)braket
op_assign
id|policy-&gt;max
suffix:semicolon
macro_line|#endif
id|ret
op_assign
id|cpufreq_driver
op_member_access_from_pointer
id|setpolicy
c_func
(paren
id|policy
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|cpufreq_driver_sem
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|variable|cpufreq_set_policy
id|EXPORT_SYMBOL
c_func
(paren
id|cpufreq_set_policy
)paren
suffix:semicolon
multiline_comment|/*********************************************************************&n; *            EXTERNALLY AFFECTING FREQUENCY CHANGES                 *&n; *********************************************************************/
multiline_comment|/**&n; * adjust_jiffies - adjust the system &quot;loops_per_jiffy&quot;&n; *&n; * This function alters the system &quot;loops_per_jiffy&quot; for the clock&n; * speed change. Note that loops_per_jiffy cannot be updated on SMP&n; * systems as each CPU might be scaled differently. So, use the arch &n; * per-CPU loops_per_jiffy value wherever possible.&n; */
macro_line|#ifndef CONFIG_SMP
DECL|variable|l_p_j_ref
r_static
r_int
r_int
id|l_p_j_ref
op_assign
l_int|0
suffix:semicolon
DECL|variable|l_p_j_ref_freq
r_static
r_int
r_int
id|l_p_j_ref_freq
op_assign
l_int|0
suffix:semicolon
DECL|function|adjust_jiffies
r_static
r_inline
r_void
id|adjust_jiffies
c_func
(paren
r_int
r_int
id|val
comma
r_struct
id|cpufreq_freqs
op_star
id|ci
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|l_p_j_ref_freq
)paren
(brace
id|l_p_j_ref
op_assign
id|loops_per_jiffy
suffix:semicolon
id|l_p_j_ref_freq
op_assign
id|ci-&gt;old
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|val
op_eq
id|CPUFREQ_PRECHANGE
op_logical_and
id|ci-&gt;old
OL
id|ci
op_member_access_from_pointer
r_new
)paren
op_logical_or
(paren
id|val
op_eq
id|CPUFREQ_POSTCHANGE
op_logical_and
id|ci-&gt;old
OG
id|ci
op_member_access_from_pointer
r_new
)paren
)paren
id|loops_per_jiffy
op_assign
id|cpufreq_scale
c_func
(paren
id|l_p_j_ref
comma
id|l_p_j_ref_freq
comma
id|ci
op_member_access_from_pointer
r_new
)paren
suffix:semicolon
)brace
macro_line|#else
DECL|macro|adjust_jiffies
mdefine_line|#define adjust_jiffies(x...) do {} while (0)
macro_line|#endif
multiline_comment|/**&n; * cpufreq_notify_transition - call notifier chain and adjust_jiffies on frequency transition&n; *&n; * This function calls the transition notifiers and the &quot;adjust_jiffies&quot; function. It is called&n; * twice on all CPU frequency changes that have external effects. &n; */
DECL|function|cpufreq_notify_transition
r_void
id|cpufreq_notify_transition
c_func
(paren
r_struct
id|cpufreq_freqs
op_star
id|freqs
comma
r_int
r_int
id|state
)paren
(brace
id|down
c_func
(paren
op_amp
id|cpufreq_notifier_sem
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|state
)paren
(brace
r_case
id|CPUFREQ_PRECHANGE
suffix:colon
id|notifier_call_chain
c_func
(paren
op_amp
id|cpufreq_transition_notifier_list
comma
id|CPUFREQ_PRECHANGE
comma
id|freqs
)paren
suffix:semicolon
id|adjust_jiffies
c_func
(paren
id|CPUFREQ_PRECHANGE
comma
id|freqs
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CPUFREQ_POSTCHANGE
suffix:colon
id|adjust_jiffies
c_func
(paren
id|CPUFREQ_POSTCHANGE
comma
id|freqs
)paren
suffix:semicolon
id|notifier_call_chain
c_func
(paren
op_amp
id|cpufreq_transition_notifier_list
comma
id|CPUFREQ_POSTCHANGE
comma
id|freqs
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_CPU_FREQ_24_API
id|cpu_cur_freq
(braket
id|freqs-&gt;cpu
)braket
op_assign
id|freqs
op_member_access_from_pointer
r_new
suffix:semicolon
macro_line|#endif
r_break
suffix:semicolon
)brace
id|up
c_func
(paren
op_amp
id|cpufreq_notifier_sem
)paren
suffix:semicolon
)brace
DECL|variable|cpufreq_notify_transition
id|EXPORT_SYMBOL_GPL
c_func
(paren
id|cpufreq_notify_transition
)paren
suffix:semicolon
multiline_comment|/*********************************************************************&n; *               REGISTER / UNREGISTER CPUFREQ DRIVER                *&n; *********************************************************************/
multiline_comment|/**&n; * cpufreq_register_driver - register a CPU Frequency driver&n; * @driver_data: A struct cpufreq_driver containing the values#&n; * submitted by the CPU Frequency driver.&n; *&n; *   Registers a CPU Frequency driver to this core code. This code &n; * returns zero on success, -EBUSY when another driver got here first&n; * (and isn&squot;t unregistered in the meantime). &n; *&n; */
DECL|function|cpufreq_register_driver
r_int
id|cpufreq_register_driver
c_func
(paren
r_struct
id|cpufreq_driver
op_star
id|driver_data
)paren
(brace
r_int
id|ret
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|cpufreq_driver
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|driver_data
op_logical_or
op_logical_neg
id|driver_data-&gt;verify
op_logical_or
op_logical_neg
id|driver_data-&gt;setpolicy
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|down
c_func
(paren
op_amp
id|cpufreq_driver_sem
)paren
suffix:semicolon
id|cpufreq_driver
op_assign
id|driver_data
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cpufreq_driver-&gt;policy
)paren
(brace
multiline_comment|/* then we need per-CPU init */
r_if
c_cond
(paren
op_logical_neg
id|cpufreq_driver-&gt;init
)paren
(brace
id|up
c_func
(paren
op_amp
id|cpufreq_driver_sem
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|cpufreq_driver-&gt;policy
op_assign
id|kmalloc
c_func
(paren
id|NR_CPUS
op_star
r_sizeof
(paren
r_struct
id|cpufreq_policy
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cpufreq_driver-&gt;policy
)paren
(brace
id|up
c_func
(paren
op_amp
id|cpufreq_driver_sem
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
)brace
id|up
c_func
(paren
op_amp
id|cpufreq_driver_sem
)paren
suffix:semicolon
id|cpufreq_proc_init
c_func
(paren
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_CPU_FREQ_24_API
id|cpufreq_sysctl_init
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif
id|ret
op_assign
id|interface_register
c_func
(paren
op_amp
id|cpufreq_interface
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|variable|cpufreq_register_driver
id|EXPORT_SYMBOL_GPL
c_func
(paren
id|cpufreq_register_driver
)paren
suffix:semicolon
multiline_comment|/**&n; * cpufreq_unregister_driver - unregister the current CPUFreq driver&n; *&n; *    Unregister the current CPUFreq driver. Only call this if you have &n; * the right to do so, i.e. if you have succeeded in initialising before!&n; * Returns zero if successful, and -EINVAL if the cpufreq_driver is&n; * currently not initialised.&n; */
DECL|function|cpufreq_unregister_driver
r_int
id|cpufreq_unregister_driver
c_func
(paren
r_struct
id|cpufreq_driver
op_star
id|driver
)paren
(brace
id|down
c_func
(paren
op_amp
id|cpufreq_driver_sem
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cpufreq_driver
op_logical_or
(paren
(paren
id|driver
op_ne
id|cpufreq_driver
)paren
op_logical_and
(paren
id|driver
op_ne
l_int|NULL
)paren
)paren
)paren
(brace
multiline_comment|/* compat */
id|up
c_func
(paren
op_amp
id|cpufreq_driver_sem
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|cpufreq_proc_exit
c_func
(paren
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_CPU_FREQ_24_API
id|cpufreq_sysctl_exit
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/* remove this workaround as soon as interface_add_data works */
(brace
r_int
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NR_CPUS
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|cpu_online
c_func
(paren
id|i
)paren
)paren
id|cpufreq_remove_dev
c_func
(paren
op_amp
id|cpufreq_driver-&gt;policy
(braket
id|i
)braket
dot
id|intf
)paren
suffix:semicolon
)brace
)brace
id|interface_unregister
c_func
(paren
op_amp
id|cpufreq_interface
)paren
suffix:semicolon
r_if
c_cond
(paren
id|driver
)paren
id|kfree
c_func
(paren
id|cpufreq_driver-&gt;policy
)paren
suffix:semicolon
id|cpufreq_driver
op_assign
l_int|NULL
suffix:semicolon
id|up
c_func
(paren
op_amp
id|cpufreq_driver_sem
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|cpufreq_unregister_driver
id|EXPORT_SYMBOL_GPL
c_func
(paren
id|cpufreq_unregister_driver
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_PM
multiline_comment|/**&n; *&t;cpufreq_restore - restore the CPU clock frequency after resume&n; *&n; *&t;Restore the CPU clock frequency so that our idea of the current&n; *&t;frequency reflects the actual hardware.&n; */
DECL|function|cpufreq_restore
r_int
id|cpufreq_restore
c_func
(paren
r_void
)paren
(brace
r_struct
id|cpufreq_policy
id|policy
suffix:semicolon
r_int
r_int
id|i
suffix:semicolon
r_int
r_int
id|ret
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|in_interrupt
c_func
(paren
)paren
)paren
id|panic
c_func
(paren
l_string|&quot;cpufreq_restore() called from interrupt context!&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NR_CPUS
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|cpu_online
c_func
(paren
id|i
)paren
)paren
r_continue
suffix:semicolon
id|down
c_func
(paren
op_amp
id|cpufreq_driver_sem
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cpufreq_driver
)paren
(brace
id|up
c_func
(paren
op_amp
id|cpufreq_driver_sem
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|policy.min
op_assign
id|cpufreq_driver-&gt;policy
(braket
id|i
)braket
dot
id|min
suffix:semicolon
id|policy.max
op_assign
id|cpufreq_driver-&gt;policy
(braket
id|i
)braket
dot
id|max
suffix:semicolon
id|policy.policy
op_assign
id|cpufreq_driver-&gt;policy
(braket
id|i
)braket
dot
id|policy
suffix:semicolon
id|policy.cpu
op_assign
id|i
suffix:semicolon
id|up
c_func
(paren
op_amp
id|cpufreq_driver_sem
)paren
suffix:semicolon
id|ret
op_add_assign
id|cpufreq_set_policy
c_func
(paren
op_amp
id|policy
)paren
suffix:semicolon
)brace
r_return
id|ret
suffix:semicolon
)brace
DECL|variable|cpufreq_restore
id|EXPORT_SYMBOL_GPL
c_func
(paren
id|cpufreq_restore
)paren
suffix:semicolon
macro_line|#else
DECL|macro|cpufreq_restore
mdefine_line|#define cpufreq_restore() do {} while (0)
macro_line|#endif /* CONFIG_PM */
multiline_comment|/*********************************************************************&n; *                     FREQUENCY TABLE HELPERS                       *&n; *********************************************************************/
DECL|function|cpufreq_frequency_table_cpuinfo
r_int
id|cpufreq_frequency_table_cpuinfo
c_func
(paren
r_struct
id|cpufreq_policy
op_star
id|policy
comma
r_struct
id|cpufreq_frequency_table
op_star
id|table
)paren
(brace
r_int
r_int
id|min_freq
op_assign
op_complement
l_int|0
suffix:semicolon
r_int
r_int
id|max_freq
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|i
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
(paren
id|table
(braket
id|i
)braket
dot
id|frequency
op_ne
id|CPUFREQ_TABLE_END
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
r_int
r_int
id|freq
op_assign
id|table
(braket
id|i
)braket
dot
id|frequency
suffix:semicolon
r_if
c_cond
(paren
id|freq
op_eq
id|CPUFREQ_ENTRY_INVALID
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|freq
OL
id|min_freq
)paren
id|min_freq
op_assign
id|freq
suffix:semicolon
r_if
c_cond
(paren
id|freq
OG
id|max_freq
)paren
id|max_freq
op_assign
id|freq
suffix:semicolon
)brace
id|policy-&gt;min
op_assign
id|policy-&gt;cpuinfo.min_freq
op_assign
id|min_freq
suffix:semicolon
id|policy-&gt;max
op_assign
id|policy-&gt;cpuinfo.max_freq
op_assign
id|max_freq
suffix:semicolon
r_if
c_cond
(paren
id|policy-&gt;min
op_eq
op_complement
l_int|0
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_else
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|cpufreq_frequency_table_cpuinfo
id|EXPORT_SYMBOL_GPL
c_func
(paren
id|cpufreq_frequency_table_cpuinfo
)paren
suffix:semicolon
DECL|function|cpufreq_frequency_table_verify
r_int
id|cpufreq_frequency_table_verify
c_func
(paren
r_struct
id|cpufreq_policy
op_star
id|policy
comma
r_struct
id|cpufreq_frequency_table
op_star
id|table
)paren
(brace
r_int
r_int
id|next_larger
op_assign
op_complement
l_int|0
suffix:semicolon
r_int
r_int
id|i
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|count
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cpu_online
c_func
(paren
id|policy-&gt;cpu
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|cpufreq_verify_within_limits
c_func
(paren
id|policy
comma
id|policy-&gt;cpuinfo.min_freq
comma
id|policy-&gt;cpuinfo.max_freq
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
(paren
id|table
(braket
id|i
)braket
dot
id|frequency
op_ne
id|CPUFREQ_TABLE_END
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
r_int
r_int
id|freq
op_assign
id|table
(braket
id|i
)braket
dot
id|frequency
suffix:semicolon
r_if
c_cond
(paren
id|freq
op_eq
id|CPUFREQ_ENTRY_INVALID
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
(paren
id|freq
op_ge
id|policy-&gt;min
)paren
op_logical_and
(paren
id|freq
op_le
id|policy-&gt;max
)paren
)paren
id|count
op_increment
suffix:semicolon
r_else
r_if
c_cond
(paren
(paren
id|next_larger
OG
id|freq
)paren
op_logical_and
(paren
id|freq
OG
id|policy-&gt;max
)paren
)paren
id|next_larger
op_assign
id|freq
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|count
)paren
id|policy-&gt;max
op_assign
id|next_larger
suffix:semicolon
id|cpufreq_verify_within_limits
c_func
(paren
id|policy
comma
id|policy-&gt;cpuinfo.min_freq
comma
id|policy-&gt;cpuinfo.max_freq
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|cpufreq_frequency_table_verify
id|EXPORT_SYMBOL_GPL
c_func
(paren
id|cpufreq_frequency_table_verify
)paren
suffix:semicolon
DECL|function|cpufreq_frequency_table_setpolicy
r_int
id|cpufreq_frequency_table_setpolicy
c_func
(paren
r_struct
id|cpufreq_policy
op_star
id|policy
comma
r_struct
id|cpufreq_frequency_table
op_star
id|table
comma
r_int
r_int
op_star
id|index
)paren
(brace
r_struct
id|cpufreq_frequency_table
id|optimal
op_assign
(brace
dot
id|index
op_assign
op_complement
l_int|0
comma
)brace
suffix:semicolon
r_int
r_int
id|i
suffix:semicolon
r_switch
c_cond
(paren
id|policy-&gt;policy
)paren
(brace
r_case
id|CPUFREQ_POLICY_PERFORMANCE
suffix:colon
id|optimal.frequency
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CPUFREQ_POLICY_POWERSAVE
suffix:colon
id|optimal.frequency
op_assign
op_complement
l_int|0
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|cpu_online
c_func
(paren
id|policy-&gt;cpu
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
(paren
id|table
(braket
id|i
)braket
dot
id|frequency
op_ne
id|CPUFREQ_TABLE_END
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
r_int
r_int
id|freq
op_assign
id|table
(braket
id|i
)braket
dot
id|frequency
suffix:semicolon
r_if
c_cond
(paren
id|freq
op_eq
id|CPUFREQ_ENTRY_INVALID
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
(paren
id|freq
OL
id|policy-&gt;min
)paren
op_logical_or
(paren
id|freq
OG
id|policy-&gt;max
)paren
)paren
r_continue
suffix:semicolon
r_switch
c_cond
(paren
id|policy-&gt;policy
)paren
(brace
r_case
id|CPUFREQ_POLICY_PERFORMANCE
suffix:colon
r_if
c_cond
(paren
id|optimal.frequency
op_le
id|freq
)paren
(brace
id|optimal.frequency
op_assign
id|freq
suffix:semicolon
id|optimal.index
op_assign
id|i
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|CPUFREQ_POLICY_POWERSAVE
suffix:colon
r_if
c_cond
(paren
id|optimal.frequency
op_ge
id|freq
)paren
(brace
id|optimal.frequency
op_assign
id|freq
suffix:semicolon
id|optimal.index
op_assign
id|i
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|optimal.index
OG
id|i
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
op_star
id|index
op_assign
id|optimal.index
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|cpufreq_frequency_table_setpolicy
id|EXPORT_SYMBOL_GPL
c_func
(paren
id|cpufreq_frequency_table_setpolicy
)paren
suffix:semicolon
eof
