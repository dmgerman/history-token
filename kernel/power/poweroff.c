multiline_comment|/*&n; * poweroff.c - sysrq handler to gracefully power down machine.&n; *&n; * This file is released under the GPL v2&n; */
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/sysrq.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/pm.h&gt;
macro_line|#include &lt;linux/workqueue.h&gt;
multiline_comment|/*&n; * When the user hits Sys-Rq o to power down the machine this is the&n; * callback we use.&n; */
DECL|function|do_poweroff
r_static
r_void
id|do_poweroff
c_func
(paren
r_void
op_star
id|dummy
)paren
(brace
r_if
c_cond
(paren
id|pm_power_off
)paren
id|pm_power_off
c_func
(paren
)paren
suffix:semicolon
)brace
r_static
id|DECLARE_WORK
c_func
(paren
id|poweroff_work
comma
id|do_poweroff
comma
l_int|NULL
)paren
suffix:semicolon
DECL|function|handle_poweroff
r_static
r_void
id|handle_poweroff
c_func
(paren
r_int
id|key
comma
r_struct
id|pt_regs
op_star
id|pt_regs
comma
r_struct
id|tty_struct
op_star
id|tty
)paren
(brace
id|schedule_work
c_func
(paren
op_amp
id|poweroff_work
)paren
suffix:semicolon
)brace
DECL|variable|sysrq_poweroff_op
r_static
r_struct
id|sysrq_key_op
id|sysrq_poweroff_op
op_assign
(brace
dot
id|handler
op_assign
id|handle_poweroff
comma
dot
id|help_msg
op_assign
l_string|&quot;powerOff&quot;
comma
dot
id|action_msg
op_assign
l_string|&quot;Power Off&quot;
)brace
suffix:semicolon
DECL|function|pm_sysrq_init
r_static
r_int
id|pm_sysrq_init
c_func
(paren
r_void
)paren
(brace
id|register_sysrq_key
c_func
(paren
l_char|&squot;o&squot;
comma
op_amp
id|sysrq_poweroff_op
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|pm_sysrq_init
id|subsys_initcall
c_func
(paren
id|pm_sysrq_init
)paren
suffix:semicolon
eof
