multiline_comment|/*&n; * kernel/power/main.c - PM subsystem core functionality.&n; *&n; * Copyright (c) 2003 Patrick Mochel&n; * Copyright (c) 2003 Open Source Development Lab&n; * &n; * This file is release under the GPLv2&n; *&n; */
macro_line|#include &lt;linux/kobject.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/pm.h&gt;
DECL|function|standby
r_static
r_int
id|standby
c_func
(paren
r_void
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|suspend
r_static
r_int
id|suspend
c_func
(paren
r_void
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|hibernate
r_static
r_int
id|hibernate
c_func
(paren
r_void
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|macro|decl_state
mdefine_line|#define decl_state(_name) &bslash;&n;&t;{ .name = __stringify(_name), .fn = _name }
DECL|struct|pm_state
r_struct
id|pm_state
(brace
DECL|member|name
r_char
op_star
id|name
suffix:semicolon
DECL|member|fn
r_int
(paren
op_star
id|fn
)paren
(paren
r_void
)paren
suffix:semicolon
DECL|variable|pm_states
)brace
id|pm_states
(braket
)braket
op_assign
(brace
id|decl_state
c_func
(paren
id|standby
)paren
comma
id|decl_state
c_func
(paren
id|suspend
)paren
comma
id|decl_state
c_func
(paren
id|hibernate
)paren
comma
(brace
l_int|NULL
)brace
comma
)brace
suffix:semicolon
DECL|function|enter_state
r_static
r_int
id|enter_state
c_func
(paren
r_struct
id|pm_state
op_star
id|state
)paren
(brace
r_return
id|state
op_member_access_from_pointer
id|fn
c_func
(paren
)paren
suffix:semicolon
)brace
id|decl_subsys
c_func
(paren
id|power
comma
l_int|NULL
comma
l_int|NULL
)paren
suffix:semicolon
DECL|macro|power_attr
mdefine_line|#define power_attr(_name) &bslash;&n;static struct subsys_attribute _name##_attr = {&t;&bslash;&n;&t;.attr&t;= {&t;&t;&t;&t;&bslash;&n;&t;&t;.name = __stringify(_name),&t;&bslash;&n;&t;&t;.mode = 0644,&t;&t;&t;&bslash;&n;&t;},&t;&t;&t;&t;&t;&bslash;&n;&t;.show&t;= _name##_show,&t;&t;&t;&bslash;&n;&t;.store&t;= _name##_store,&t;&t;&bslash;&n;}
multiline_comment|/**&n; *&t;state - control system power state.&n; *&n; *&t;show() returns what states are supported, which is hard-coded to&n; *&t;&squot;standby&squot; (Power-On Suspend), &squot;suspend&squot; (Suspend-to-RAM), and&n; *&t;&squot;hibernate&squot; (Suspend-to-Disk).&n; *&n; *&t;store() accepts one of those strings, translates it into the &n; *&t;proper enumerated value, and initiates a suspend transition.&n; */
DECL|function|state_show
r_static
id|ssize_t
id|state_show
c_func
(paren
r_struct
id|subsystem
op_star
id|subsys
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|pm_state
op_star
id|state
suffix:semicolon
r_char
op_star
id|s
op_assign
id|buf
suffix:semicolon
r_for
c_loop
(paren
id|state
op_assign
op_amp
id|pm_states
(braket
l_int|0
)braket
suffix:semicolon
id|state-&gt;name
suffix:semicolon
id|state
op_increment
)paren
id|s
op_add_assign
id|sprintf
c_func
(paren
id|s
comma
l_string|&quot;%s &quot;
comma
id|state-&gt;name
)paren
suffix:semicolon
id|s
op_add_assign
id|sprintf
c_func
(paren
id|s
comma
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
r_return
(paren
id|s
op_minus
id|buf
)paren
suffix:semicolon
)brace
DECL|function|state_store
r_static
id|ssize_t
id|state_store
c_func
(paren
r_struct
id|subsystem
op_star
id|s
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|n
)paren
(brace
r_struct
id|pm_state
op_star
id|state
suffix:semicolon
r_int
id|error
suffix:semicolon
r_char
op_star
id|end
op_assign
id|strchr
c_func
(paren
id|buf
comma
l_char|&squot;&bslash;n&squot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|end
)paren
op_star
id|end
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
r_for
c_loop
(paren
id|state
op_assign
op_amp
id|pm_states
(braket
l_int|0
)braket
suffix:semicolon
id|state
suffix:semicolon
id|state
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|buf
comma
id|state-&gt;name
)paren
)paren
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|state
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|error
op_assign
id|enter_state
c_func
(paren
id|state
)paren
suffix:semicolon
r_return
id|error
ques
c_cond
id|error
suffix:colon
id|n
suffix:semicolon
)brace
DECL|variable|state
id|power_attr
c_func
(paren
id|state
)paren
suffix:semicolon
DECL|variable|g
r_static
r_struct
id|attribute
op_star
id|g
(braket
)braket
op_assign
(brace
op_amp
id|state_attr.attr
comma
l_int|NULL
comma
)brace
suffix:semicolon
DECL|variable|attr_group
r_static
r_struct
id|attribute_group
id|attr_group
op_assign
(brace
dot
id|attrs
op_assign
id|g
comma
)brace
suffix:semicolon
DECL|function|pm_init
r_static
r_int
id|pm_init
c_func
(paren
r_void
)paren
(brace
r_int
id|error
op_assign
id|subsystem_register
c_func
(paren
op_amp
id|power_subsys
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|error
)paren
id|error
op_assign
id|sysfs_create_group
c_func
(paren
op_amp
id|power_subsys.kset.kobj
comma
op_amp
id|attr_group
)paren
suffix:semicolon
r_return
id|error
suffix:semicolon
)brace
DECL|variable|pm_init
id|core_initcall
c_func
(paren
id|pm_init
)paren
suffix:semicolon
eof
