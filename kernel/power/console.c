multiline_comment|/*&n; * drivers/power/process.c - Functions for saving/restoring console.&n; *&n; * Originally from swsusp.&n; */
macro_line|#include &lt;linux/vt_kern.h&gt;
macro_line|#include &lt;linux/kbd_kern.h&gt;
macro_line|#include &lt;linux/console.h&gt;
macro_line|#include &quot;power.h&quot;
DECL|variable|new_loglevel
r_static
r_int
id|new_loglevel
op_assign
l_int|10
suffix:semicolon
DECL|variable|orig_loglevel
r_static
r_int
id|orig_loglevel
suffix:semicolon
macro_line|#ifdef SUSPEND_CONSOLE
DECL|variable|orig_fgconsole
DECL|variable|orig_kmsg
r_static
r_int
id|orig_fgconsole
comma
id|orig_kmsg
suffix:semicolon
macro_line|#endif
DECL|function|pm_prepare_console
r_int
id|pm_prepare_console
c_func
(paren
r_void
)paren
(brace
id|orig_loglevel
op_assign
id|console_loglevel
suffix:semicolon
id|console_loglevel
op_assign
id|new_loglevel
suffix:semicolon
macro_line|#ifdef SUSPEND_CONSOLE
id|acquire_console_sem
c_func
(paren
)paren
suffix:semicolon
id|orig_fgconsole
op_assign
id|fg_console
suffix:semicolon
r_if
c_cond
(paren
id|vc_allocate
c_func
(paren
id|SUSPEND_CONSOLE
)paren
)paren
(brace
multiline_comment|/* we can&squot;t have a free VC for now. Too bad,&n;&t;   * we don&squot;t want to mess the screen for now. */
id|release_console_sem
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|set_console
c_func
(paren
id|SUSPEND_CONSOLE
)paren
suffix:semicolon
id|release_console_sem
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|vt_waitactive
c_func
(paren
id|SUSPEND_CONSOLE
)paren
)paren
(brace
id|pr_debug
c_func
(paren
l_string|&quot;Suspend: Can&squot;t switch VCs.&quot;
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|orig_kmsg
op_assign
id|kmsg_redirect
suffix:semicolon
id|kmsg_redirect
op_assign
id|SUSPEND_CONSOLE
suffix:semicolon
macro_line|#endif
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|pm_restore_console
r_void
id|pm_restore_console
c_func
(paren
r_void
)paren
(brace
id|console_loglevel
op_assign
id|orig_loglevel
suffix:semicolon
macro_line|#ifdef SUSPEND_CONSOLE
id|acquire_console_sem
c_func
(paren
)paren
suffix:semicolon
id|set_console
c_func
(paren
id|orig_fgconsole
)paren
suffix:semicolon
id|release_console_sem
c_func
(paren
)paren
suffix:semicolon
id|kmsg_redirect
op_assign
id|orig_kmsg
suffix:semicolon
macro_line|#endif
r_return
suffix:semicolon
)brace
eof
