multiline_comment|/*&n; *  linux/kernel/profile.c&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/profile.h&gt;
macro_line|#include &lt;linux/bootmem.h&gt;
macro_line|#include &lt;linux/notifier.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;asm/sections.h&gt;
DECL|variable|prof_buffer
r_int
r_int
op_star
id|prof_buffer
suffix:semicolon
DECL|variable|prof_len
r_int
r_int
id|prof_len
suffix:semicolon
DECL|variable|prof_shift
r_int
r_int
id|prof_shift
suffix:semicolon
DECL|variable|prof_on
r_int
id|prof_on
suffix:semicolon
DECL|function|profile_setup
r_int
id|__init
id|profile_setup
c_func
(paren
r_char
op_star
id|str
)paren
(brace
r_int
id|par
suffix:semicolon
r_if
c_cond
(paren
id|get_option
c_func
(paren
op_amp
id|str
comma
op_amp
id|par
)paren
)paren
(brace
id|prof_shift
op_assign
id|par
suffix:semicolon
id|prof_on
op_assign
l_int|1
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;kernel profiling enabled&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_return
l_int|1
suffix:semicolon
)brace
DECL|function|profile_init
r_void
id|__init
id|profile_init
c_func
(paren
r_void
)paren
(brace
r_int
r_int
id|size
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|prof_on
)paren
r_return
suffix:semicolon
multiline_comment|/* only text is profiled */
id|prof_len
op_assign
id|_etext
op_minus
id|_stext
suffix:semicolon
id|prof_len
op_rshift_assign
id|prof_shift
suffix:semicolon
id|size
op_assign
id|prof_len
op_star
r_sizeof
(paren
r_int
r_int
)paren
op_plus
id|PAGE_SIZE
op_minus
l_int|1
suffix:semicolon
id|prof_buffer
op_assign
(paren
r_int
r_int
op_star
)paren
id|alloc_bootmem
c_func
(paren
id|size
)paren
suffix:semicolon
)brace
multiline_comment|/* Profile event notifications */
macro_line|#ifdef CONFIG_PROFILING
r_static
id|DECLARE_RWSEM
c_func
(paren
id|profile_rwsem
)paren
suffix:semicolon
DECL|variable|exit_task_notifier
r_static
r_struct
id|notifier_block
op_star
id|exit_task_notifier
suffix:semicolon
DECL|variable|exit_mmap_notifier
r_static
r_struct
id|notifier_block
op_star
id|exit_mmap_notifier
suffix:semicolon
DECL|variable|exec_unmap_notifier
r_static
r_struct
id|notifier_block
op_star
id|exec_unmap_notifier
suffix:semicolon
DECL|function|profile_exit_task
r_void
id|profile_exit_task
c_func
(paren
r_struct
id|task_struct
op_star
id|task
)paren
(brace
id|down_read
c_func
(paren
op_amp
id|profile_rwsem
)paren
suffix:semicolon
id|notifier_call_chain
c_func
(paren
op_amp
id|exit_task_notifier
comma
l_int|0
comma
id|task
)paren
suffix:semicolon
id|up_read
c_func
(paren
op_amp
id|profile_rwsem
)paren
suffix:semicolon
)brace
DECL|function|profile_exit_mmap
r_void
id|profile_exit_mmap
c_func
(paren
r_struct
id|mm_struct
op_star
id|mm
)paren
(brace
id|down_read
c_func
(paren
op_amp
id|profile_rwsem
)paren
suffix:semicolon
id|notifier_call_chain
c_func
(paren
op_amp
id|exit_mmap_notifier
comma
l_int|0
comma
id|mm
)paren
suffix:semicolon
id|up_read
c_func
(paren
op_amp
id|profile_rwsem
)paren
suffix:semicolon
)brace
DECL|function|profile_exec_unmap
r_void
id|profile_exec_unmap
c_func
(paren
r_struct
id|mm_struct
op_star
id|mm
)paren
(brace
id|down_read
c_func
(paren
op_amp
id|profile_rwsem
)paren
suffix:semicolon
id|notifier_call_chain
c_func
(paren
op_amp
id|exec_unmap_notifier
comma
l_int|0
comma
id|mm
)paren
suffix:semicolon
id|up_read
c_func
(paren
op_amp
id|profile_rwsem
)paren
suffix:semicolon
)brace
DECL|function|profile_event_register
r_int
id|profile_event_register
c_func
(paren
r_enum
id|profile_type
id|type
comma
r_struct
id|notifier_block
op_star
id|n
)paren
(brace
r_int
id|err
op_assign
op_minus
id|EINVAL
suffix:semicolon
id|down_write
c_func
(paren
op_amp
id|profile_rwsem
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|type
)paren
(brace
r_case
id|EXIT_TASK
suffix:colon
id|err
op_assign
id|notifier_chain_register
c_func
(paren
op_amp
id|exit_task_notifier
comma
id|n
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|EXIT_MMAP
suffix:colon
id|err
op_assign
id|notifier_chain_register
c_func
(paren
op_amp
id|exit_mmap_notifier
comma
id|n
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|EXEC_UNMAP
suffix:colon
id|err
op_assign
id|notifier_chain_register
c_func
(paren
op_amp
id|exec_unmap_notifier
comma
id|n
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|up_write
c_func
(paren
op_amp
id|profile_rwsem
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|profile_event_unregister
r_int
id|profile_event_unregister
c_func
(paren
r_enum
id|profile_type
id|type
comma
r_struct
id|notifier_block
op_star
id|n
)paren
(brace
r_int
id|err
op_assign
op_minus
id|EINVAL
suffix:semicolon
id|down_write
c_func
(paren
op_amp
id|profile_rwsem
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|type
)paren
(brace
r_case
id|EXIT_TASK
suffix:colon
id|err
op_assign
id|notifier_chain_unregister
c_func
(paren
op_amp
id|exit_task_notifier
comma
id|n
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|EXIT_MMAP
suffix:colon
id|err
op_assign
id|notifier_chain_unregister
c_func
(paren
op_amp
id|exit_mmap_notifier
comma
id|n
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|EXEC_UNMAP
suffix:colon
id|err
op_assign
id|notifier_chain_unregister
c_func
(paren
op_amp
id|exec_unmap_notifier
comma
id|n
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|up_write
c_func
(paren
op_amp
id|profile_rwsem
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|variable|profile_listeners
r_static
r_struct
id|notifier_block
op_star
id|profile_listeners
suffix:semicolon
DECL|variable|profile_lock
r_static
id|rwlock_t
id|profile_lock
op_assign
id|RW_LOCK_UNLOCKED
suffix:semicolon
DECL|function|register_profile_notifier
r_int
id|register_profile_notifier
c_func
(paren
r_struct
id|notifier_block
op_star
id|nb
)paren
(brace
r_int
id|err
suffix:semicolon
id|write_lock_irq
c_func
(paren
op_amp
id|profile_lock
)paren
suffix:semicolon
id|err
op_assign
id|notifier_chain_register
c_func
(paren
op_amp
id|profile_listeners
comma
id|nb
)paren
suffix:semicolon
id|write_unlock_irq
c_func
(paren
op_amp
id|profile_lock
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|unregister_profile_notifier
r_int
id|unregister_profile_notifier
c_func
(paren
r_struct
id|notifier_block
op_star
id|nb
)paren
(brace
r_int
id|err
suffix:semicolon
id|write_lock_irq
c_func
(paren
op_amp
id|profile_lock
)paren
suffix:semicolon
id|err
op_assign
id|notifier_chain_unregister
c_func
(paren
op_amp
id|profile_listeners
comma
id|nb
)paren
suffix:semicolon
id|write_unlock_irq
c_func
(paren
op_amp
id|profile_lock
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|profile_hook
r_void
id|profile_hook
c_func
(paren
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
id|read_lock
c_func
(paren
op_amp
id|profile_lock
)paren
suffix:semicolon
id|notifier_call_chain
c_func
(paren
op_amp
id|profile_listeners
comma
l_int|0
comma
id|regs
)paren
suffix:semicolon
id|read_unlock
c_func
(paren
op_amp
id|profile_lock
)paren
suffix:semicolon
)brace
DECL|variable|register_profile_notifier
id|EXPORT_SYMBOL_GPL
c_func
(paren
id|register_profile_notifier
)paren
suffix:semicolon
DECL|variable|unregister_profile_notifier
id|EXPORT_SYMBOL_GPL
c_func
(paren
id|unregister_profile_notifier
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_PROFILING */
DECL|variable|profile_event_register
id|EXPORT_SYMBOL_GPL
c_func
(paren
id|profile_event_register
)paren
suffix:semicolon
DECL|variable|profile_event_unregister
id|EXPORT_SYMBOL_GPL
c_func
(paren
id|profile_event_unregister
)paren
suffix:semicolon
eof
